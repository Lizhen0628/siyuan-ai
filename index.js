"use strict";var sc=Object.defineProperty;var ic=(n,e,t)=>e in n?sc(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Re=(n,e,t)=>ic(n,typeof e!="symbol"?e+"":e,t);const pt=require("siyuan");async function bn(n,e){let t=await pt.fetchSyncPost(n,e);return t.code===0?t.data:null}async function ac(n,e,t,r,s){return bn("/api/block/insertBlock",{dataType:n,data:e,nextID:t,previousID:r,parentID:s})}async function oc(n,e,t){return bn("/api/block/appendBlock",{dataType:n,data:e,parentID:t})}async function lc(n){return bn("/api/block/deleteBlock",{id:n})}async function $a(n,e=7e3){return bn("/api/notification/pushMsg",{msg:n,timeout:e})}async function Ua(n,e=7e3){return bn("/api/notification/pushErrMsg",{msg:n,timeout:e})}function me(){}const ja=n=>n;function Qn(n,e){for(const t in e)n[t]=e[t];return n}function qa(n){return n()}function bi(){return Object.create(null)}function we(n){n.forEach(qa)}function hn(n){return typeof n=="function"}function ke(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let On;function cc(n,e){return n===e?!0:(On||(On=document.createElement("a")),On.href=e,n===On.href)}function uc(n){return Object.keys(n).length===0}function xs(n,e,t,r){if(n){const s=Ha(n,e,t,r);return n[0](s)}}function Ha(n,e,t,r){return n[1]&&r?Qn(t.ctx.slice(),n[1](r(e))):t.ctx}function Os(n,e,t,r){if(n[2]&&r){const s=n[2](r(t));if(e.dirty===void 0)return s;if(typeof s=="object"){const i=[],a=Math.max(e.dirty.length,s.length);for(let o=0;o<a;o+=1)i[o]=e.dirty[o]|s[o];return i}return e.dirty|s}return e.dirty}function Ms(n,e,t,r,s,i){if(s){const a=Ha(e,t,r,i);n.p(a,s)}}function Ts(n){if(n.ctx.length>32){const e=[],t=n.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function Si(n){const e={};for(const t in n)t[0]!=="$"&&(e[t]=n[t]);return e}const fc=["",!0,1,"true","contenteditable"],Wa=typeof window<"u";let dc=Wa?()=>window.performance.now():()=>Date.now(),Is=Wa?n=>requestAnimationFrame(n):me;const Nt=new Set;function Va(n){Nt.forEach(e=>{e.c(n)||(Nt.delete(e),e.f())}),Nt.size!==0&&Is(Va)}function hc(n){let e;return Nt.size===0&&Is(Va),{promise:new Promise(t=>{Nt.add(e={c:n,f:t})}),abort(){Nt.delete(e)}}}function y(n,e){n.appendChild(e)}function Ja(n){if(!n)return document;const e=n.getRootNode?n.getRootNode():n.ownerDocument;return e&&e.host?e:n.ownerDocument}function mc(n){const e=P("style");return e.textContent="/* empty */",pc(Ja(n),e),e.sheet}function pc(n,e){return y(n.head||n,e),e.sheet}function K(n,e,t){n.insertBefore(e,t||null)}function z(n){n.parentNode&&n.parentNode.removeChild(n)}function mn(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function P(n){return document.createElement(n)}function _e(n){return document.createTextNode(n)}function I(){return _e(" ")}function Fs(){return _e("")}function X(n,e,t,r){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}function gc(n){return function(e){return e.stopPropagation(),n.call(this,e)}}function k(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}const _c=["width","height"];function Ei(n,e){const t=Object.getOwnPropertyDescriptors(n.__proto__);for(const r in e)e[r]==null?n.removeAttribute(r):r==="style"?n.style.cssText=e[r]:r==="__value"?n.value=n[r]=e[r]:t[r]&&t[r].set&&_c.indexOf(r)===-1?n[r]=e[r]:k(n,r,e[r])}function ns(n){return n===""?null:+n}function yc(n){return Array.from(n.childNodes)}function qe(n,e){e=""+e,n.data!==e&&(n.data=e)}function wc(n,e){e=""+e,n.wholeText!==e&&(n.data=e)}function bc(n,e,t){~fc.indexOf(t)?wc(n,e):qe(n,e)}function Fe(n,e){n.value=e??""}function M(n,e,t,r){t==null?n.style.removeProperty(e):n.style.setProperty(e,t,"")}function Ai(n,e,t){for(let r=0;r<n.options.length;r+=1){const s=n.options[r];if(s.__value===e){s.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function Sc(n){const e=n.querySelector(":checked");return e&&e.__value}function ie(n,e,t){n.classList.toggle(e,!!t)}function Xa(n,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:r})}const Zn=new Map;let er=0;function Ec(n){let e=5381,t=n.length;for(;t--;)e=(e<<5)-e^n.charCodeAt(t);return e>>>0}function Ac(n,e){const t={stylesheet:mc(e),rules:{}};return Zn.set(n,t),t}function ki(n,e,t,r,s,i,a,o=0){const l=16.666/r;let c=`{
`;for(let g=0;g<=1;g+=l){const C=e+(t-e)*i(g);c+=g*100+`%{${a(C,1-C)}}
`}const f=c+`100% {${a(t,1-t)}}
}`,u=`__svelte_${Ec(f)}_${o}`,h=Ja(n),{stylesheet:m,rules:d}=Zn.get(h)||Ac(h,n);d[u]||(d[u]=!0,m.insertRule(`@keyframes ${u} ${f}`,m.cssRules.length));const p=n.style.animation||"";return n.style.animation=`${p?`${p}, `:""}${u} ${r}ms linear ${s}ms 1 both`,er+=1,u}function kc(n,e){const t=(n.style.animation||"").split(", "),r=t.filter(e?i=>i.indexOf(e)<0:i=>i.indexOf("__svelte")===-1),s=t.length-r.length;s&&(n.style.animation=r.join(", "),er-=s,er||vc())}function vc(){Is(()=>{er||(Zn.forEach(n=>{const{ownerNode:e}=n.stylesheet;e&&z(e)}),Zn.clear())})}let pn;function cn(n){pn=n}function Ns(){if(!pn)throw new Error("Function called outside component initialization");return pn}function za(n){Ns().$$.on_mount.push(n)}function Pc(n){Ns().$$.after_update.push(n)}function mr(){const n=Ns();return(e,t,{cancelable:r=!1}={})=>{const s=n.$$.callbacks[e];if(s){const i=Xa(e,t,{cancelable:r});return s.slice().forEach(a=>{a.call(n,i)}),!i.defaultPrevented}return!0}}function Cc(n,e){const t=n.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}const xt=[],ye=[];let Dt=[];const rs=[],Rc=Promise.resolve();let ss=!1;function xc(){ss||(ss=!0,Rc.then(Ka))}function At(n){Dt.push(n)}function $e(n){rs.push(n)}const Tr=new Set;let vt=0;function Ka(){if(vt!==0)return;const n=pn;do{try{for(;vt<xt.length;){const e=xt[vt];vt++,cn(e),Oc(e.$$)}}catch(e){throw xt.length=0,vt=0,e}for(cn(null),xt.length=0,vt=0;ye.length;)ye.pop()();for(let e=0;e<Dt.length;e+=1){const t=Dt[e];Tr.has(t)||(Tr.add(t),t())}Dt.length=0}while(xt.length);for(;rs.length;)rs.pop()();ss=!1,Tr.clear(),cn(n)}function Oc(n){if(n.fragment!==null){n.update(),we(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(At)}}function Mc(n){const e=[],t=[];Dt.forEach(r=>n.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),Dt=e}let Kt;function Tc(){return Kt||(Kt=Promise.resolve(),Kt.then(()=>{Kt=null})),Kt}function Ir(n,e,t){n.dispatchEvent(Xa(`${e?"intro":"outro"}${t}`))}const qn=new Set;let st;function bt(){st={r:0,c:[],p:st}}function St(){st.r||we(st.c),st=st.p}function q(n,e){n&&n.i&&(qn.delete(n),n.i(e))}function W(n,e,t,r){if(n&&n.o){if(qn.has(n))return;qn.add(n),st.c.push(()=>{qn.delete(n),r&&(t&&n.d(1),r())}),n.o(e)}else r&&r()}const Ic={duration:0};function tr(n,e,t,r){let i=e(n,t,{direction:"both"}),a=r?0:1,o=null,l=null,c=null,f;function u(){c&&kc(n,c)}function h(d,p){const g=d.b-a;return p*=Math.abs(g),{a,b:d.b,d:g,duration:p,start:d.start,end:d.start+p,group:d.group}}function m(d){const{delay:p=0,duration:g=300,easing:C=ja,tick:w=me,css:_}=i||Ic,b={start:dc()+p,b:d};d||(b.group=st,st.r+=1),"inert"in n&&(d?f!==void 0&&(n.inert=f):(f=n.inert,n.inert=!0)),o||l?l=b:(_&&(u(),c=ki(n,a,d,g,p,C,_)),d&&w(0,1),o=h(b,g),At(()=>Ir(n,d,"start")),hc(S=>{if(l&&S>l.start&&(o=h(l,g),l=null,Ir(n,o.b,"start"),_&&(u(),c=ki(n,a,o.b,o.duration,0,C,i.css))),o){if(S>=o.end)w(a=o.b,1-a),Ir(n,o.b,"end"),l||(o.b?u():--o.group.r||we(o.group.c)),o=null;else if(S>=o.start){const O=S-o.start;a=o.a+o.d*C(O/o.duration),w(a,1-a)}}return!!(o||l)}))}return{run(d){hn(i)?Tc().then(()=>{i=i({direction:d?"in":"out"}),m(d)}):m(d)},end(){u(),o=l=null}}}function Te(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function Fc(n,e){n.d(1),e.delete(n.key)}function Nc(n,e){W(n,1,1,()=>{e.delete(n.key)})}function Ga(n,e,t,r,s,i,a,o,l,c,f,u){let h=n.length,m=i.length,d=h;const p={};for(;d--;)p[n[d].key]=d;const g=[],C=new Map,w=new Map,_=[];for(d=m;d--;){const x=u(s,i,d),R=t(x);let D=a.get(R);D?_.push(()=>D.p(x,e)):(D=c(R,x),D.c()),C.set(R,g[d]=D),R in p&&w.set(R,Math.abs(d-p[R]))}const b=new Set,S=new Set;function O(x){q(x,1),x.m(o,f),a.set(x.key,x),f=x.first,m--}for(;h&&m;){const x=g[m-1],R=n[h-1],D=x.key,E=R.key;x===R?(f=x.first,h--,m--):C.has(E)?!a.has(D)||b.has(D)?O(x):S.has(E)?h--:w.get(D)>w.get(E)?(S.add(D),O(x)):(b.add(E),h--):(l(R,a),h--)}for(;h--;){const x=n[h];C.has(x.key)||l(x,a)}for(;m;)O(g[m-1]);return we(_),g}function Dc(n,e){const t={},r={},s={$$scope:1};let i=n.length;for(;i--;){const a=n[i],o=e[i];if(o){for(const l in a)l in o||(r[l]=1);for(const l in o)s[l]||(t[l]=o[l],s[l]=1);n[i]=o}else for(const l in a)s[l]=1}for(const a in r)a in t||(t[a]=void 0);return t}function Ue(n,e,t){const r=n.$$.props[e];r!==void 0&&(n.$$.bound[r]=t,t(n.$$.ctx[r]))}function ue(n){n&&n.c()}function le(n,e,t){const{fragment:r,after_update:s}=n.$$;r&&r.m(e,t),At(()=>{const i=n.$$.on_mount.map(qa).filter(hn);n.$$.on_destroy?n.$$.on_destroy.push(...i):we(i),n.$$.on_mount=[]}),s.forEach(At)}function ce(n,e){const t=n.$$;t.fragment!==null&&(Mc(t.after_update),we(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Bc(n,e){n.$$.dirty[0]===-1&&(xt.push(n),xc(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function ve(n,e,t,r,s,i,a=null,o=[-1]){const l=pn;cn(n);const c=n.$$={fragment:null,ctx:[],props:i,update:me,not_equal:s,bound:bi(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:bi(),dirty:o,skip_bound:!1,root:e.target||l.$$.root};a&&a(c.root);let f=!1;if(c.ctx=t?t(n,e.props||{},(u,h,...m)=>{const d=m.length?m[0]:h;return c.ctx&&s(c.ctx[u],c.ctx[u]=d)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](d),f&&Bc(n,u)),h}):[],c.update(),f=!0,we(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const u=yc(e.target);c.fragment&&c.fragment.l(u),u.forEach(z)}else c.fragment&&c.fragment.c();e.intro&&q(n.$$.fragment),le(n,e.target,e.anchor),Ka()}cn(l)}class Pe{constructor(){Re(this,"$$");Re(this,"$$set")}$destroy(){ce(this,1),this.$destroy=me}$on(e,t){if(!hn(t))return me;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!uc(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Lc="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Lc);const is="RFC3986",as={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},$c="RFC1738",Uc=Array.isArray,Ye=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),Fr=1024,jc=(n,e,t,r,s)=>{if(n.length===0)return n;let i=n;if(typeof n=="symbol"?i=Symbol.prototype.toString.call(n):typeof n!="string"&&(i=String(n)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=Fr){const l=i.length>=Fr?i.slice(o,o+Fr):i,c=[];for(let f=0;f<l.length;++f){let u=l.charCodeAt(f);if(u===45||u===46||u===95||u===126||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||s===$c&&(u===40||u===41)){c[c.length]=l.charAt(f);continue}if(u<128){c[c.length]=Ye[u];continue}if(u<2048){c[c.length]=Ye[192|u>>6]+Ye[128|u&63];continue}if(u<55296||u>=57344){c[c.length]=Ye[224|u>>12]+Ye[128|u>>6&63]+Ye[128|u&63];continue}f+=1,u=65536+((u&1023)<<10|l.charCodeAt(f)&1023),c[c.length]=Ye[240|u>>18]+Ye[128|u>>12&63]+Ye[128|u>>6&63]+Ye[128|u&63]}a+=c.join("")}return a};function qc(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function vi(n,e){if(Uc(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const Hc=Object.prototype.hasOwnProperty,Ya={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},Ze=Array.isArray,Wc=Array.prototype.push,Qa=function(n,e){Wc.apply(n,Ze(e)?e:[e])},Vc=Date.prototype.toISOString,he={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:jc,encodeValuesOnly:!1,format:is,formatter:as[is],indices:!1,serializeDate(n){return Vc.call(n)},skipNulls:!1,strictNullHandling:!1};function Jc(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const Nr={};function Za(n,e,t,r,s,i,a,o,l,c,f,u,h,m,d,p,g,C){let w=n,_=C,b=0,S=!1;for(;(_=_.get(Nr))!==void 0&&!S;){const E=_.get(n);if(b+=1,typeof E<"u"){if(E===b)throw new RangeError("Cyclic object value");S=!0}typeof _.get(Nr)>"u"&&(b=0)}if(typeof c=="function"?w=c(e,w):w instanceof Date?w=h==null?void 0:h(w):t==="comma"&&Ze(w)&&(w=vi(w,function(E){return E instanceof Date?h==null?void 0:h(E):E})),w===null){if(i)return l&&!p?l(e,he.encoder,g,"key",m):e;w=""}if(Jc(w)||qc(w)){if(l){const E=p?e:l(e,he.encoder,g,"key",m);return[(d==null?void 0:d(E))+"="+(d==null?void 0:d(l(w,he.encoder,g,"value",m)))]}return[(d==null?void 0:d(e))+"="+(d==null?void 0:d(String(w)))]}const O=[];if(typeof w>"u")return O;let x;if(t==="comma"&&Ze(w))p&&l&&(w=vi(w,l)),x=[{value:w.length>0?w.join(",")||null:void 0}];else if(Ze(c))x=c;else{const E=Object.keys(w);x=f?E.sort(f):E}const R=o?String(e).replace(/\./g,"%2E"):String(e),D=r&&Ze(w)&&w.length===1?R+"[]":R;if(s&&Ze(w)&&w.length===0)return D+"[]";for(let E=0;E<x.length;++E){const v=x[E],se=typeof v=="object"&&typeof v.value<"u"?v.value:w[v];if(a&&se===null)continue;const Ce=u&&o?v.replace(/\./g,"%2E"):v,B=Ze(w)?typeof t=="function"?t(D,Ce):D:D+(u?"."+Ce:"["+Ce+"]");C.set(n,b);const F=new WeakMap;F.set(Nr,C),Qa(O,Za(se,B,t,r,s,i,a,o,t==="comma"&&p&&Ze(w)?null:l,c,f,u,h,m,d,p,g,F))}return O}function Xc(n=he){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||he.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=is;if(typeof n.format<"u"){if(!Hc.call(as,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=as[t];let s=he.filter;(typeof n.filter=="function"||Ze(n.filter))&&(s=n.filter);let i;if(n.arrayFormat&&n.arrayFormat in Ya?i=n.arrayFormat:"indices"in n?i=n.indices?"indices":"repeat":i=he.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:he.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:he.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:he.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:he.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?he.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:he.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:he.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:he.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:he.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:he.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:he.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:he.strictNullHandling}}function zc(n,e={}){let t=n;const r=Xc(e);let s,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):Ze(r.filter)&&(i=r.filter,s=i);const a=[];if(typeof t!="object"||t===null)return"";const o=Ya[r.arrayFormat],l=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);const c=new WeakMap;for(let h=0;h<s.length;++h){const m=s[h];r.skipNulls&&t[m]===null||Qa(a,Za(t[m],m,o,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}const f=a.join(r.delimiter);let u=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),f.length>0?u+f:""}const Ot="4.78.1";let Pi=!1,un,eo,to,os,no,ro,so,io,ao;function Kc(n,e={auto:!1}){if(Pi)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(un)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${un}'\``);Pi=e.auto,un=n.kind,eo=n.fetch,to=n.FormData,os=n.File,no=n.ReadableStream,ro=n.getMultipartRequestOptions,so=n.getDefaultAgent,io=n.fileFromPath,ao=n.isFsReadStream}let Gc=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Yc({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new Gc(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}un||Kc(Yc(),{auto:!0});class J extends Error{}let Ne=class ls extends J{constructor(e,t,r,s){super(`${ls.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new pr({message:r,cause:fs(t)});const i=t==null?void 0:t.error;return e===400?new oo(e,i,r,s):e===401?new lo(e,i,r,s):e===403?new co(e,i,r,s):e===404?new uo(e,i,r,s):e===409?new fo(e,i,r,s):e===422?new ho(e,i,r,s):e===429?new mo(e,i,r,s):e>=500?new po(e,i,r,s):new ls(e,i,r,s)}},Je=class extends Ne{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},pr=class extends Ne{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Ds=class extends pr{constructor({message:e}={}){super({message:e??"Request timed out."})}},oo=class extends Ne{},lo=class extends Ne{},co=class extends Ne{},uo=class extends Ne{},fo=class extends Ne{},ho=class extends Ne{},mo=class extends Ne{},po=class extends Ne{};class go extends J{constructor(){super("Could not parse response content as the length limit was reached")}}class _o extends J{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}let gr=class cs{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=cs.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(cs.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new J(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new J(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new J("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};gr.NEWLINE_CHARS=new Set([`
`,"\r"]);gr.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let gn=class tn{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of Qc(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null){let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(o&&o.error)throw new Ne(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(a.event=="error")throw new Ne(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new tn(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new gr,o=yo(e);for await(const l of o)for(const c of a.decode(l))yield c;for(const l of a.flush())yield l}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new tn(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new tn(()=>s(e),this.controller),new tn(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new no({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}};async function*Qc(n,e){if(!n.body)throw e.abort(),new J("Attempted to iterate over a response with no body");const t=new tu,r=new gr,s=yo(n.body);for await(const i of Zc(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*Zc(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=eu(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function eu(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}let tu=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=nu(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function nu(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function yo(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const wo=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",bo=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&_r(n),_r=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",ru=n=>bo(n)||wo(n)||ao(n);async function So(n,e,t){var s;if(n=await n,bo(n))return n;if(wo(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=_r(i)?[await i.arrayBuffer()]:[i];return new os(a,e,t)}const r=await su(n);if(e||(e=au(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new os(r,e,t)}async function su(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(_r(n))e.push(await n.arrayBuffer());else if(ou(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${iu(n)}`);return e}function iu(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function au(n){var e;return Dr(n.name)||Dr(n.filename)||((e=Dr(n.path))==null?void 0:e.split(/[\\/]/).pop())}const Dr=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},ou=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Ci=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",jt=async n=>{const e=await lu(n.body);return ro(e,n)},lu=async n=>{const e=new to;return await Promise.all(Object.entries(n||{}).map(([t,r])=>us(e,t,r))),e},us=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(ru(t)){const r=await So(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>us(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>us(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var cu=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},uu=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Mn;async function Eo(n){const{response:e}=n;if(n.options.stream)return Bt("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):gn.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return Bt("response",e.status,e.url,e.headers,i),Ao(i,e)}const s=await e.text();return Bt("response",e.status,e.url,e.headers,s),s}function Ao(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}let ko=class vo extends Promise{constructor(e,t=Eo){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new vo(this.responsePromise,async t=>Ao(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},fu=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Br("maxRetries",t),this.timeout=Br("timeout",r),this.httpAgent=s,this.fetch=i??eo}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),..._u(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Su()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&_r(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var p;const{method:r,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:Ci(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),c=this.buildURL(s,i);"timeout"in e&&Br("timeout",e.timeout);const f=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??so(c),h=f+1e3;typeof((p=u==null?void 0:u.options)==null?void 0:p.timeout)=="number"&&h>(u.options.timeout??0)&&(u.options.timeout=h),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const m=this.buildHeaders({options:e,headers:a,contentLength:l,retryCount:t});return{req:{method:r,...o&&{body:o},headers:m,...u&&{agent:u},signal:e.signal??null},url:c,timeout:f}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const a=this.defaultHeaders(e);return Mi(i,a),Mi(i,t),Ci(e.body)&&un!=="node"&&delete i["content-type"],Ti(a,"x-stainless-retry-count")===void 0&&Ti(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return Ne.generate(e,t,r,s)}request(e,t=null){return new ko(this.makeRequest(e,t))}async makeRequest(e,t){var u,h;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),Bt("request",a,r,i.headers),(u=r.signal)!=null&&u.aborted)throw new Je;const l=new AbortController,c=await this.fetchWithTimeout(a,i,o,l).catch(fs);if(c instanceof Error){if((h=r.signal)!=null&&h.aborted)throw new Je;if(t)return this.retryRequest(r,t);throw c.name==="AbortError"?new Ds:new pr({cause:c})}const f=hu(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const w=`retrying, ${t} attempts remaining`;return Bt(`response (error; ${w})`,c.status,a,f),this.retryRequest(r,t,f)}const m=await c.text().catch(w=>fs(w).message),d=yu(m),p=d?void 0:m;throw Bt(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,f,p),this.makeStatusError(c.status,d,p,f)}return{response:c,options:r,controller:l}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new du(this,r,e)}buildURL(e,t){const r=bu(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Co(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new J(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r),l={signal:s.signal,...a};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Sn(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ot}`}},Po=class{constructor(e,t,r,s){Mn.set(this,void 0),cu(this,Mn,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new J("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await uu(this,Mn,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Mn=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},du=class extends ko{constructor(e,t,r){super(t,async s=>new r(e,s.response,await Eo(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}};const hu=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),mu={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},De=n=>typeof n=="object"&&n!==null&&!Co(n)&&Object.keys(n).every(e=>Ro(mu,e)),pu=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ot,"X-Stainless-OS":xi(Deno.build.os),"X-Stainless-Arch":Ri(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ot,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ot,"X-Stainless-OS":xi(process.platform),"X-Stainless-Arch":Ri(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=gu();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ot,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ot,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function gu(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const Ri=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",xi=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Oi;const _u=()=>Oi??(Oi=pu()),yu=n=>{try{return JSON.parse(n)}catch{return}},wu=/^[a-z][a-z0-9+.-]*:/i,bu=n=>wu.test(n),Sn=n=>new Promise(e=>setTimeout(e,n)),Br=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new J(`${n} must be an integer`);if(e<0)throw new J(`${n} must be a positive integer`);return e},fs=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)},Tn=n=>{var e,t,r,s,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,n))==null?void 0:i.trim()};function Co(n){if(!n)return!0;for(const e in n)return!1;return!0}function Ro(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Mi(n,e){for(const t in e){if(!Ro(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function Bt(n,...e){var t;typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const Su=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),Eu=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Au=n=>typeof(n==null?void 0:n.get)=="function",Ti=(n,e)=>{var r;const t=e.toLowerCase();if(Au(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=n.get(i);if(a)return a}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};function Lr(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}let ku=class extends Po{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}};class ze extends Po{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}}let Q=class{constructor(e){this._client=e}},xo=class extends Q{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},Bs=class extends Q{constructor(){super(...arguments),this.completions=new xo(this._client)}};Bs.Completions=xo;class Oo extends Q{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class Mo extends Q{create(e,t){return this._client.post("/audio/transcriptions",jt({body:e,...t}))}}class To extends Q{create(e,t){return this._client.post("/audio/translations",jt({body:e,...t}))}}class En extends Q{constructor(){super(...arguments),this.transcriptions=new Mo(this._client),this.translations=new To(this._client),this.speech=new Oo(this._client)}}En.Transcriptions=Mo;En.Translations=To;En.Speech=Oo;let Ls=class extends Q{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return De(e)?this.list({},e):this._client.getAPIList("/batches",$s,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}};class $s extends ze{}Ls.BatchesPage=$s;class Us extends Q{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return De(e)?this.list({},e):this._client.getAPIList("/assistants",js,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class js extends ze{}Us.AssistantsPage=js;function Ii(n){return typeof n.parse=="function"}const Lt=n=>(n==null?void 0:n.role)==="assistant",Io=n=>(n==null?void 0:n.role)==="function",Fo=n=>(n==null?void 0:n.role)==="tool";var We=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},re=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ds,Hn,Wn,nn,rn,Vn,sn,rt,an,nr,rr,Mt,No;class Do{constructor(){ds.add(this),this.controller=new AbortController,Hn.set(this,void 0),Wn.set(this,()=>{}),nn.set(this,()=>{}),rn.set(this,void 0),Vn.set(this,()=>{}),sn.set(this,()=>{}),rt.set(this,{}),an.set(this,!1),nr.set(this,!1),rr.set(this,!1),Mt.set(this,!1),We(this,Hn,new Promise((e,t)=>{We(this,Wn,e,"f"),We(this,nn,t,"f")}),"f"),We(this,rn,new Promise((e,t)=>{We(this,Vn,e,"f"),We(this,sn,t,"f")}),"f"),re(this,Hn,"f").catch(()=>{}),re(this,rn,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},re(this,ds,"m",No).bind(this))},0)}_connected(){this.ended||(re(this,Wn,"f").call(this),this._emit("connect"))}get ended(){return re(this,an,"f")}get errored(){return re(this,nr,"f")}get aborted(){return re(this,rr,"f")}abort(){this.controller.abort()}on(e,t){return(re(this,rt,"f")[e]||(re(this,rt,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=re(this,rt,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(re(this,rt,"f")[e]||(re(this,rt,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{We(this,Mt,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){We(this,Mt,!0,"f"),await re(this,rn,"f")}_emit(e,...t){if(re(this,an,"f"))return;e==="end"&&(We(this,an,!0,"f"),re(this,Vn,"f").call(this));const r=re(this,rt,"f")[e];if(r&&(re(this,rt,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!re(this,Mt,"f")&&!(r!=null&&r.length)&&Promise.reject(s),re(this,nn,"f").call(this,s),re(this,sn,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!re(this,Mt,"f")&&!(r!=null&&r.length)&&Promise.reject(s),re(this,nn,"f").call(this,s),re(this,sn,"f").call(this,s),this._emit("end")}}_emitFinal(){}}Hn=new WeakMap,Wn=new WeakMap,nn=new WeakMap,rn=new WeakMap,Vn=new WeakMap,sn=new WeakMap,rt=new WeakMap,an=new WeakMap,nr=new WeakMap,rr=new WeakMap,Mt=new WeakMap,ds=new WeakSet,No=function(e){if(We(this,nr,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Je),e instanceof Je)return We(this,rr,!0,"f"),this._emit("abort",e);if(e instanceof J)return this._emit("error",e);if(e instanceof Error){const t=new J(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new J(String(e)))};function Bo(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function An(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function vu(n,e){return!e||!Lo(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:qs(n,e)}function qs(n,e){const t=n.choices.map(r=>{var s;if(r.finish_reason==="length")throw new go;if(r.finish_reason==="content_filter")throw new _o;return{...r,message:{...r.message,tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(i=>Cu(e,i)))??[],parsed:r.message.content&&!r.message.refusal?Pu(e,r.message.content):null}}});return{...n,choices:t}}function Pu(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function Cu(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:An(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function Ru(n,e){var r;if(!n)return!1;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return An(t)||(t==null?void 0:t.function.strict)||!1}function Lo(n){var e;return Bo(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>An(t)||t.type==="function"&&t.function.strict===!0))??!1}function xu(n){for(const e of n??[]){if(e.type!=="function")throw new J(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new J(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Me=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Se,hs,sr,ms,ps,gs,$o,_s;const Fi=10;class Uo extends Do{constructor(){super(...arguments),Se.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Io(e)||Fo(e))&&e.content)this._emit("functionCallResult",e.content);else if(Lt(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Lt(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new J("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Me(this,Se,"m",hs).call(this)}async finalMessage(){return await this.done(),Me(this,Se,"m",sr).call(this)}async finalFunctionCall(){return await this.done(),Me(this,Se,"m",ms).call(this)}async finalFunctionCallResult(){return await this.done(),Me(this,Se,"m",ps).call(this)}async totalUsage(){return await this.done(),Me(this,Se,"m",gs).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=Me(this,Se,"m",sr).call(this);t&&this._emit("finalMessage",t);const r=Me(this,Se,"m",hs).call(this);r&&this._emit("finalContent",r);const s=Me(this,Se,"m",ms).call(this);s&&this._emit("finalFunctionCall",s);const i=Me(this,Se,"m",ps).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",Me(this,Se,"m",gs).call(this))}async _createChatCompletion(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Me(this,Se,"m",$o).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(qs(i,t))}async _runChatCompletion(e,t,r){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var h;const s="function",{function_call:i="auto",stream:a,...o}=t,l=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:c=Fi}=r||{},f={};for(const m of t.functions)f[m.name||m.function.name]=m;const u=t.functions.map(m=>({name:m.name||m.function.name,parameters:m.parameters,description:m.description}));for(const m of t.messages)this._addMessage(m,!1);for(let m=0;m<c;++m){const p=(h=(await this._createChatCompletion(e,{...o,function_call:i,functions:u,messages:[...this.messages]},r)).choices[0])==null?void 0:h.message;if(!p)throw new J("missing message in ChatCompletion response");if(!p.function_call)return;const{name:g,arguments:C}=p.function_call,w=f[g];if(w){if(l&&l!==g){const O=`Invalid function_call: ${JSON.stringify(g)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:g,content:O});continue}}else{const O=`Invalid function_call: ${JSON.stringify(g)}. Available options are: ${u.map(x=>JSON.stringify(x.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:g,content:O});continue}let _;try{_=Ii(w)?await w.parse(C):C}catch(O){this._addMessage({role:s,name:g,content:O instanceof Error?O.message:String(O)});continue}const b=await w.function(_,this),S=Me(this,Se,"m",_s).call(this,b);if(this._addMessage({role:s,name:g,content:S}),l)return}}async _runTools(e,t,r){var m,d,p;const s="tool",{tool_choice:i="auto",stream:a,...o}=t,l=typeof i!="string"&&((m=i==null?void 0:i.function)==null?void 0:m.name),{maxChatCompletions:c=Fi}=r||{},f=t.tools.map(g=>{if(An(g)){if(!g.$callback)throw new J("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:g.$callback,name:g.function.name,description:g.function.description||"",parameters:g.function.parameters,parse:g.$parseRaw,strict:!0}}}return g}),u={};for(const g of f)g.type==="function"&&(u[g.function.name||g.function.function.name]=g.function);const h="tools"in t?f.map(g=>g.type==="function"?{type:"function",function:{name:g.function.name||g.function.function.name,parameters:g.function.parameters,description:g.function.description,strict:g.function.strict}}:g):void 0;for(const g of t.messages)this._addMessage(g,!1);for(let g=0;g<c;++g){const w=(d=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:h,messages:[...this.messages]},r)).choices[0])==null?void 0:d.message;if(!w)throw new J("missing message in ChatCompletion response");if(!((p=w.tool_calls)!=null&&p.length))return;for(const _ of w.tool_calls){if(_.type!=="function")continue;const b=_.id,{name:S,arguments:O}=_.function,x=u[S];if(x){if(l&&l!==S){const v=`Invalid tool_call: ${JSON.stringify(S)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:b,content:v});continue}}else{const v=`Invalid tool_call: ${JSON.stringify(S)}. Available options are: ${Object.keys(u).map(se=>JSON.stringify(se)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:b,content:v});continue}let R;try{R=Ii(x)?await x.parse(O):O}catch(v){const se=v instanceof Error?v.message:String(v);this._addMessage({role:s,tool_call_id:b,content:se});continue}const D=await x.function(R,this),E=Me(this,Se,"m",_s).call(this,D);if(this._addMessage({role:s,tool_call_id:b,content:E}),l)return}}}}Se=new WeakSet,hs=function(){return Me(this,Se,"m",sr).call(this).content??null},sr=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Lt(t)){const{function_call:r,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return r&&(i.function_call=r),i}}throw new J("stream ended without producing a ChatCompletionMessage with role=assistant")},ms=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(Lt(s)&&(s!=null&&s.function_call))return s.function_call;if(Lt(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},ps=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Io(t)&&t.content!=null||Fo(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},gs=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},$o=function(e){if(e.n!=null&&e.n>1)throw new J("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},_s=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class _n extends Uo{static runFunctions(e,t,r){const s=new _n,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new _n,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),Lt(e)&&e.content&&this._emit("content",e.content)}}const jo=1,qo=2,Ho=4,Wo=8,Vo=16,Jo=32,Xo=64,zo=128,Ko=256,Go=zo|Ko,Yo=Vo|Jo|Go|Xo,Qo=jo|qo|Yo,Zo=Ho|Wo,Ou=Qo|Zo,ge={STR:jo,NUM:qo,ARR:Ho,OBJ:Wo,NULL:Vo,BOOL:Jo,NAN:Xo,INFINITY:zo,MINUS_INFINITY:Ko,INF:Go,SPECIAL:Yo,ATOM:Qo,COLLECTION:Zo,ALL:Ou};class Mu extends Error{}class Tu extends Error{}function Iu(n,e=ge.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return Fu(n.trim(),e)}const Fu=(n,e)=>{const t=n.length;let r=0;const s=h=>{throw new Mu(`${h} at position ${r}`)},i=h=>{throw new Tu(`${h} at position ${r}`)},a=()=>(u(),r>=t&&s("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?l():n[r]==="["?c():n.substring(r,r+4)==="null"||ge.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||ge.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||ge.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||ge.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||ge.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||ge.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):f()),o=()=>{const h=r;let m=!1;for(r++;r<t&&(n[r]!=='"'||m&&n[r-1]==="\\");)m=n[r]==="\\"?!m:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(h,++r-Number(m)))}catch(d){i(String(d))}else if(ge.STR&e)try{return JSON.parse(n.substring(h,r-Number(m))+'"')}catch{return JSON.parse(n.substring(h,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{r++,u();const h={};try{for(;n[r]!=="}";){if(u(),r>=t&&ge.OBJ&e)return h;const m=o();u(),r++;try{const d=a();Object.defineProperty(h,m,{value:d,writable:!0,enumerable:!0,configurable:!0})}catch(d){if(ge.OBJ&e)return h;throw d}u(),n[r]===","&&r++}}catch{if(ge.OBJ&e)return h;s("Expected '}' at end of object")}return r++,h},c=()=>{r++;const h=[];try{for(;n[r]!=="]";)h.push(a()),u(),n[r]===","&&r++}catch{if(ge.ARR&e)return h;s("Expected ']' at end of array")}return r++,h},f=()=>{if(r===0){n==="-"&&ge.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(m){if(ge.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}i(String(m))}}const h=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(ge.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(h,r))}catch{n.substring(h,r)==="-"&&ge.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(h,n.lastIndexOf("e")))}catch(d){i(String(d))}}},u=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return a()},Ni=n=>Iu(n,ge.ALL^ge.NUM);var Pt=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},ee=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},de,tt,Ct,at,$r,In,Ur,jr,qr,Fn,Hr,Di;class yn extends Uo{constructor(e){super(),de.add(this),tt.set(this,void 0),Ct.set(this,void 0),at.set(this,void 0),Pt(this,tt,e,"f"),Pt(this,Ct,[],"f")}get currentChatCompletionSnapshot(){return ee(this,at,"f")}static fromReadableStream(e){const t=new yn(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const s=new yn(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var a;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),ee(this,de,"m",$r).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)ee(this,de,"m",Ur).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new Je;return this._addChatCompletion(ee(this,de,"m",Fn).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),ee(this,de,"m",$r).call(this),this._connected();const s=gn.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(ee(this,de,"m",Fn).call(this)),ee(this,de,"m",Ur).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new Je;return this._addChatCompletion(ee(this,de,"m",Fn).call(this))}[(tt=new WeakMap,Ct=new WeakMap,at=new WeakMap,de=new WeakSet,$r=function(){this.ended||Pt(this,at,void 0,"f")},In=function(t){let r=ee(this,Ct,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},ee(this,Ct,"f")[t.index]=r,r)},Ur=function(t){var s,i,a,o,l,c,f,u,h,m,d,p,g,C,w;if(this.ended)return;const r=ee(this,de,"m",Di).call(this,t);this._emit("chunk",t,r);for(const _ of t.choices){const b=r.choices[_.index];_.delta.content!=null&&((s=b.message)==null?void 0:s.role)==="assistant"&&((i=b.message)!=null&&i.content)&&(this._emit("content",_.delta.content,b.message.content),this._emit("content.delta",{delta:_.delta.content,snapshot:b.message.content,parsed:b.message.parsed})),_.delta.refusal!=null&&((a=b.message)==null?void 0:a.role)==="assistant"&&((o=b.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:_.delta.refusal,snapshot:b.message.refusal}),((l=_.logprobs)==null?void 0:l.content)!=null&&((c=b.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(f=_.logprobs)==null?void 0:f.content,snapshot:((u=b.logprobs)==null?void 0:u.content)??[]}),((h=_.logprobs)==null?void 0:h.refusal)!=null&&((m=b.message)==null?void 0:m.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(d=_.logprobs)==null?void 0:d.refusal,snapshot:((p=b.logprobs)==null?void 0:p.refusal)??[]});const S=ee(this,de,"m",In).call(this,b);b.finish_reason&&(ee(this,de,"m",qr).call(this,b),S.current_tool_call_index!=null&&ee(this,de,"m",jr).call(this,b,S.current_tool_call_index));for(const O of _.delta.tool_calls??[])S.current_tool_call_index!==O.index&&(ee(this,de,"m",qr).call(this,b),S.current_tool_call_index!=null&&ee(this,de,"m",jr).call(this,b,S.current_tool_call_index)),S.current_tool_call_index=O.index;for(const O of _.delta.tool_calls??[]){const x=(g=b.message.tool_calls)==null?void 0:g[O.index];x!=null&&x.type&&((x==null?void 0:x.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(C=x.function)==null?void 0:C.name,index:O.index,arguments:x.function.arguments,parsed_arguments:x.function.parsed_arguments,arguments_delta:((w=O.function)==null?void 0:w.arguments)??""}):(x==null||x.type,void 0))}}},jr=function(t,r){var a,o,l;if(ee(this,de,"m",In).call(this,t).done_tool_calls.has(r))return;const i=(a=t.message.tool_calls)==null?void 0:a[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const c=(l=(o=ee(this,tt,"f"))==null?void 0:o.tools)==null?void 0:l.find(f=>f.type==="function"&&f.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:An(c)?c.$parseRaw(i.function.arguments):c!=null&&c.function.strict?JSON.parse(i.function.arguments):null})}else i.type},qr=function(t){var s,i;const r=ee(this,de,"m",In).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const a=ee(this,de,"m",Hr).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Fn=function(){if(this.ended)throw new J("stream has ended, this shouldn't happen");const t=ee(this,at,"f");if(!t)throw new J("request ended without sending any chunks");return Pt(this,at,void 0,"f"),Pt(this,Ct,[],"f"),Nu(t,ee(this,tt,"f"))},Hr=function(){var r;const t=(r=ee(this,tt,"f"))==null?void 0:r.response_format;return Bo(t)?t:null},Di=function(t){var r,s,i,a;let o=ee(this,at,"f");const{choices:l,...c}=t;o?Object.assign(o,c):o=Pt(this,at,{...c,choices:[]},"f");for(const{delta:f,finish_reason:u,index:h,logprobs:m=null,...d}of t.choices){let p=o.choices[h];if(p||(p=o.choices[h]={finish_reason:u,index:h,message:{},logprobs:m,...d}),m)if(!p.logprobs)p.logprobs=Object.assign({},m);else{const{content:O,refusal:x,...R}=m;Object.assign(p.logprobs,R),O&&((r=p.logprobs).content??(r.content=[]),p.logprobs.content.push(...O)),x&&((s=p.logprobs).refusal??(s.refusal=[]),p.logprobs.refusal.push(...x))}if(u&&(p.finish_reason=u,ee(this,tt,"f")&&Lo(ee(this,tt,"f")))){if(u==="length")throw new go;if(u==="content_filter")throw new _o}if(Object.assign(p,d),!f)continue;const{content:g,refusal:C,function_call:w,role:_,tool_calls:b,...S}=f;if(Object.assign(p.message,S),C&&(p.message.refusal=(p.message.refusal||"")+C),_&&(p.message.role=_),w&&(p.message.function_call?(w.name&&(p.message.function_call.name=w.name),w.arguments&&((i=p.message.function_call).arguments??(i.arguments=""),p.message.function_call.arguments+=w.arguments)):p.message.function_call=w),g&&(p.message.content=(p.message.content||"")+g,!p.message.refusal&&ee(this,de,"m",Hr).call(this)&&(p.message.parsed=Ni(p.message.content))),b){p.message.tool_calls||(p.message.tool_calls=[]);for(const{index:O,id:x,type:R,function:D,...E}of b){const v=(a=p.message.tool_calls)[O]??(a[O]={});Object.assign(v,E),x&&(v.id=x),R&&(v.type=R),D&&(v.function??(v.function={name:D.name??"",arguments:""})),D!=null&&D.name&&(v.function.name=D.name),D!=null&&D.arguments&&(v.function.arguments+=D.arguments,Ru(ee(this,tt,"f"),v)&&(v.function.parsed_arguments=Ni(v.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new gn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Nu(n,e){const{id:t,choices:r,created:s,model:i,system_fingerprint:a,...o}=n,l={...o,id:t,choices:r.map(({message:c,finish_reason:f,index:u,logprobs:h,...m})=>{if(!f)throw new J(`missing finish_reason for choice ${u}`);const{content:d=null,function_call:p,tool_calls:g,...C}=c,w=c.role;if(!w)throw new J(`missing role for choice ${u}`);if(p){const{arguments:_,name:b}=p;if(_==null)throw new J(`missing function_call.arguments for choice ${u}`);if(!b)throw new J(`missing function_call.name for choice ${u}`);return{...m,message:{content:d,function_call:{arguments:_,name:b},role:w,refusal:c.refusal??null},finish_reason:f,index:u,logprobs:h}}return g?{...m,index:u,finish_reason:f,logprobs:h,message:{...C,role:w,content:d,refusal:c.refusal??null,tool_calls:g.map((_,b)=>{const{function:S,type:O,id:x,...R}=_,{arguments:D,name:E,...v}=S||{};if(x==null)throw new J(`missing choices[${u}].tool_calls[${b}].id
${Nn(n)}`);if(O==null)throw new J(`missing choices[${u}].tool_calls[${b}].type
${Nn(n)}`);if(E==null)throw new J(`missing choices[${u}].tool_calls[${b}].function.name
${Nn(n)}`);if(D==null)throw new J(`missing choices[${u}].tool_calls[${b}].function.arguments
${Nn(n)}`);return{...R,id:x,type:O,function:{...v,name:E,arguments:D}}})}}:{...m,message:{...C,content:d,role:w,refusal:c.refusal??null},finish_reason:f,index:u,logprobs:h}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return vu(l,e)}function Nn(n){return JSON.stringify(n)}class $t extends yn{static fromReadableStream(e){const t=new $t(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const s=new $t(null),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new $t(t),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}let el=class extends Q{parse(e,t){return xu(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>qs(r,e))}runFunctions(e,t){return e.stream?$t.runFunctions(this._client,e,t):_n.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?$t.runTools(this._client,e,t):_n.runTools(this._client,e,t)}stream(e,t){return yn.createChatCompletion(this._client,e,t)}},tl=class extends Q{constructor(){super(...arguments),this.completions=new el(this._client)}};(function(n){n.Completions=el})(tl);class nl extends Q{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Hs extends Q{constructor(){super(...arguments),this.sessions=new nl(this._client)}}Hs.Sessions=nl;var $=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Be=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},be,ys,et,Jn,Ve,gt,Ft,mt,ir,Le,Xn,zn,fn,on,ln,Bi,Li,$i,Ui,ji,qi,Hi;class Xe extends Do{constructor(){super(...arguments),be.add(this),ys.set(this,[]),et.set(this,{}),Jn.set(this,{}),Ve.set(this,void 0),gt.set(this,void 0),Ft.set(this,void 0),mt.set(this,void 0),ir.set(this,void 0),Le.set(this,void 0),Xn.set(this,void 0),zn.set(this,void 0),fn.set(this,void 0)}[(ys=new WeakMap,et=new WeakMap,Jn=new WeakMap,Ve=new WeakMap,gt=new WeakMap,Ft=new WeakMap,mt=new WeakMap,ir=new WeakMap,Le=new WeakMap,Xn=new WeakMap,zn=new WeakMap,fn=new WeakMap,be=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Xe;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=gn.fromReadableStream(e,this.controller);for await(const a of s)$(this,be,"m",on).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new Je;return this._addRun($(this,be,"m",ln).call(this))}toReadableStream(){return new gn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,i){const a=new Xe;return a._run(()=>a._runToolAssistantStream(e,t,r,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,r,s,i){var c;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},l=await e.submitToolOutputs(t,r,o,{...i,signal:this.controller.signal});this._connected();for await(const f of l)$(this,be,"m",on).call(this,f);if((c=l.controller.signal)!=null&&c.aborted)throw new Je;return this._addRun($(this,be,"m",ln).call(this))}static createThreadAssistantStream(e,t,r){const s=new Xe;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){const i=new Xe;return i._run(()=>i._runAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return $(this,Xn,"f")}currentRun(){return $(this,zn,"f")}currentMessageSnapshot(){return $(this,Ve,"f")}currentRunStepSnapshot(){return $(this,fn,"f")}async finalRunSteps(){return await this.done(),Object.values($(this,et,"f"))}async finalMessages(){return await this.done(),Object.values($(this,Jn,"f"))}async finalRun(){if(await this.done(),!$(this,gt,"f"))throw Error("Final run was not received.");return $(this,gt,"f")}async _createThreadAssistantStream(e,t,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const l of a)$(this,be,"m",on).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new Je;return this._addRun($(this,be,"m",ln).call(this))}async _createAssistantStream(e,t,r,s){var l;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const c of o)$(this,be,"m",on).call(this,c);if((l=o.controller.signal)!=null&&l.aborted)throw new Je;return this._addRun($(this,be,"m",ln).call(this))}static accumulateDelta(e,t){for(const[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(Lr(i)&&Lr(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(const a of s){if(!Lr(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=i[o];l==null?i.push(a):i[o]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,i){return await this._createToolAssistantStream(r,e,t,s,i)}}on=function(e){if(!this.ended)switch(Be(this,Xn,e,"f"),$(this,be,"m",$i).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":$(this,be,"m",Hi).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":$(this,be,"m",Li).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":$(this,be,"m",Bi).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},ln=function(){if(this.ended)throw new J("stream has ended, this shouldn't happen");if(!$(this,gt,"f"))throw Error("Final run has not been received");return $(this,gt,"f")},Bi=function(e){const[t,r]=$(this,be,"m",ji).call(this,e,$(this,Ve,"f"));Be(this,Ve,t,"f"),$(this,Jn,"f")[t.id]=t;for(const s of r){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=$(this,Ft,"f")){if($(this,mt,"f"))switch($(this,mt,"f").type){case"text":this._emit("textDone",$(this,mt,"f").text,$(this,Ve,"f"));break;case"image_file":this._emit("imageFileDone",$(this,mt,"f").image_file,$(this,Ve,"f"));break}Be(this,Ft,s.index,"f")}Be(this,mt,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if($(this,Ft,"f")!==void 0){const s=e.data.content[$(this,Ft,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,$(this,Ve,"f"));break;case"text":this._emit("textDone",s.text,$(this,Ve,"f"));break}}$(this,Ve,"f")&&this._emit("messageDone",e.data),Be(this,Ve,void 0,"f")}},Li=function(e){const t=$(this,be,"m",Ui).call(this,e);switch(Be(this,fn,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==$(this,ir,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):($(this,Le,"f")&&this._emit("toolCallDone",$(this,Le,"f")),Be(this,ir,i.index,"f"),Be(this,Le,t.step_details.tool_calls[i.index],"f"),$(this,Le,"f")&&this._emit("toolCallCreated",$(this,Le,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Be(this,fn,void 0,"f"),e.data.step_details.type=="tool_calls"&&$(this,Le,"f")&&(this._emit("toolCallDone",$(this,Le,"f")),Be(this,Le,void 0,"f")),this._emit("runStepDone",e.data,t);break}},$i=function(e){$(this,ys,"f").push(e),this._emit("event",e)},Ui=function(e){switch(e.event){case"thread.run.step.created":return $(this,et,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=$(this,et,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=Xe.accumulateDelta(t,r.delta);$(this,et,"f")[e.data.id]=s}return $(this,et,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":$(this,et,"f")[e.data.id]=e.data;break}if($(this,et,"f")[e.data.id])return $(this,et,"f")[e.data.id];throw new Error("No snapshot available")},ji=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=$(this,be,"m",qi).call(this,i,a)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},qi=function(e,t){return Xe.accumulateDelta(t,e)},Hi=function(e){switch(Be(this,zn,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Be(this,gt,e.data,"f"),$(this,Le,"f")&&(this._emit("toolCallDone",$(this,Le,"f")),Be(this,Le,void 0,"f"));break}};let Ws=class extends Q{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return De(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Vs,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}};class Vs extends ze{}Ws.MessagesPage=Vs;class Js extends Q{retrieve(e,t,r,s={},i){return De(s)?this.retrieve(e,t,r,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,r={},s){return De(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Xs,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Xs extends ze{}Js.RunStepsPage=Xs;class kn extends Q{constructor(){super(...arguments),this.steps=new Js(this._client)}create(e,t,r){const{include:s,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return De(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,zs,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return Xe.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await Sn(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return Xe.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,s){const i=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,r,s){return Xe.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}}class zs extends ze{}kn.RunsPage=zs;kn.Steps=Js;kn.RunStepsPage=Xs;class qt extends Q{constructor(){super(...arguments),this.runs=new kn(this._client),this.messages=new Ws(this._client)}create(e={},t){return De(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return Xe.createThreadAssistantStream(e,this._client.beta.threads,t)}}qt.Runs=kn;qt.RunsPage=zs;qt.Messages=Ws;qt.MessagesPage=Vs;const Du=async n=>{const e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};let Ks=class extends Q{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},r){return De(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,yr,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...r,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=i.response.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await Sn(o);break;case"failed":case"completed":return a}}}async upload(e,t,r){const s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){const s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}};class yr extends ze{}Ks.VectorStoreFilesPage=yr;class rl extends Q{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r={},s){return De(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,yr,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await Sn(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,t.length),o=this._client,l=t.values(),c=[...r];async function f(h){for(let m of h){const d=await o.files.create({file:m,purpose:"assistants"},s);c.push(d.id)}}const u=Array(a).fill(l).map(f);return await Du(u),await this.createAndPoll(e,{file_ids:c})}}class Ht extends Q{constructor(){super(...arguments),this.files=new Ks(this._client),this.fileBatches=new rl(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return De(e)?this.list({},e):this._client.getAPIList("/vector_stores",Gs,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Gs extends ze{}Ht.VectorStoresPage=Gs;Ht.Files=Ks;Ht.VectorStoreFilesPage=yr;Ht.FileBatches=rl;let ut=class extends Q{constructor(){super(...arguments),this.realtime=new Hs(this._client),this.vectorStores=new Ht(this._client),this.chat=new tl(this._client),this.assistants=new Us(this._client),this.threads=new qt(this._client)}};ut.Realtime=Hs;ut.VectorStores=Ht;ut.VectorStoresPage=Gs;ut.Assistants=Us;ut.AssistantsPage=js;ut.Threads=qt;let sl=class extends Q{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};class il extends Q{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class Ys extends Q{create(e,t){return this._client.post("/files",jt({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return De(e)?this.list({},e):this._client.getAPIList("/files",Qs,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await Sn(t),a=await this.retrieve(e),Date.now()-i>r)throw new Ds({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class Qs extends ze{}Ys.FileObjectsPage=Qs;class Zs extends Q{list(e,t={},r){return De(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,ei,{query:t,...r})}}class ei extends ze{}Zs.FineTuningJobCheckpointsPage=ei;class Wt extends Q{constructor(){super(...arguments),this.checkpoints=new Zs(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return De(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",ti,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return De(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,ni,{query:t,...r})}}class ti extends ze{}class ni extends ze{}Wt.FineTuningJobsPage=ti;Wt.FineTuningJobEventsPage=ni;Wt.Checkpoints=Zs;Wt.FineTuningJobCheckpointsPage=ei;class vn extends Q{constructor(){super(...arguments),this.jobs=new Wt(this._client)}}vn.Jobs=Wt;vn.FineTuningJobsPage=ti;vn.FineTuningJobEventsPage=ni;class al extends Q{createVariation(e,t){return this._client.post("/images/variations",jt({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",jt({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}let ri=class extends Q{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",si,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}};class si extends ku{}ri.ModelsPage=si;class ol extends Q{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class ll extends Q{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,jt({body:t,...r}))}}class ii extends Q{constructor(){super(...arguments),this.parts=new ll(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}}ii.Parts=ll;var cl;class G extends fu{constructor({baseURL:e=Tn("OPENAI_BASE_URL"),apiKey:t=Tn("OPENAI_API_KEY"),organization:r=Tn("OPENAI_ORG_ID")??null,project:s=Tn("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new J("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:r,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&Eu())throw new J(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new sl(this),this.chat=new Bs(this),this.embeddings=new il(this),this.files=new Ys(this),this.images=new al(this),this.audio=new En(this),this.moderations=new ol(this),this.models=new ri(this),this.fineTuning=new vn(this),this.beta=new ut(this),this.batches=new Ls(this),this.uploads=new ii(this),this._options=a,this.apiKey=t,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return zc(e,{arrayFormat:"brackets"})}}cl=G;G.OpenAI=cl;G.DEFAULT_TIMEOUT=6e5;G.OpenAIError=J;G.APIError=Ne;G.APIConnectionError=pr;G.APIConnectionTimeoutError=Ds;G.APIUserAbortError=Je;G.NotFoundError=uo;G.ConflictError=fo;G.RateLimitError=mo;G.BadRequestError=oo;G.AuthenticationError=lo;G.InternalServerError=po;G.PermissionDeniedError=co;G.UnprocessableEntityError=ho;G.toFile=So;G.fileFromPath=io;G.Completions=sl;G.Chat=Bs;G.Embeddings=il;G.Files=Ys;G.FileObjectsPage=Qs;G.Images=al;G.Audio=En;G.Moderations=ol;G.Models=ri;G.ModelsPage=si;G.FineTuning=vn;G.Beta=ut;G.Batches=Ls;G.BatchesPage=$s;G.Uploads=ii;const Tt="0.33.1";let Wi=!1,dn,ul,ws,fl,dl,hl;function Bu(n,e={auto:!1}){if(Wi)throw new Error(`you must \`import '@anthropic-ai/sdk/shims/${n.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(dn)throw new Error(`can't \`import '@anthropic-ai/sdk/shims/${n.kind}'\` after \`import '@anthropic-ai/sdk/shims/${dn}'\``);Wi=e.auto,dn=n.kind,ul=n.fetch,ws=n.File,fl=n.ReadableStream,dl=n.getDefaultAgent,hl=n.fileFromPath}class Lu{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function $u({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from '@anthropic-ai/sdk'`:\n- `import '@anthropic-ai/sdk/shims/node'` (if you're running on Node)\n- `import '@anthropic-ai/sdk/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new Lu(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:a=>!1}}dn||Bu($u(),{auto:!0});class ne extends Error{}class Ae extends ne{constructor(e,t,r,s){super(`${Ae.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["request-id"],this.error=t}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new wr({message:r,cause:bs(t)});const i=t;return e===400?new pl(e,i,r,s):e===401?new gl(e,i,r,s):e===403?new _l(e,i,r,s):e===404?new yl(e,i,r,s):e===409?new wl(e,i,r,s):e===422?new bl(e,i,r,s):e===429?new Sl(e,i,r,s):e>=500?new El(e,i,r,s):new Ae(e,i,r,s)}}class _t extends Ae{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class wr extends Ae{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class ml extends wr{constructor({message:e}={}){super({message:e??"Request timed out."})}}class pl extends Ae{}class gl extends Ae{}class _l extends Ae{}class yl extends Ae{}class wl extends Ae{}class bl extends Ae{}class Sl extends Ae{}class El extends Ae{}class ct{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=ct.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(ct.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new ne(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new ne(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new ne("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}ct.NEWLINE_CHARS=new Set([`
`,"\r"]);ct.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class lt{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of Uu(e,t)){if(a.event==="completion")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event==="message_start"||a.event==="message_delta"||a.event==="message_stop"||a.event==="content_block_start"||a.event==="content_block_delta"||a.event==="content_block_stop")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event!=="ping"&&a.event==="error")throw Ae.generate(void 0,`SSE Error: ${a.data}`,a.data,vl(e.headers))}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new lt(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new ct,o=ai(e);for await(const l of o)for(const c of a.decode(l))yield c;for(const l of a.flush())yield l}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new lt(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new lt(()=>s(e),this.controller),new lt(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new fl({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*Uu(n,e){if(!n.body)throw e.abort(),new ne("Attempted to iterate over a response with no body");const t=new Hu,r=new ct,s=ai(n.body);for await(const i of ju(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*ju(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=qu(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function qu(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}class Hu{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=Wu(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function Wu(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function ai(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Vu=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Ju=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&br(n),br=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function";async function Xu(n,e,t){var s;if(n=await n,Ju(n))return n;if(Vu(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=br(i)?[await i.arrayBuffer()]:[i];return new ws(a,e,t)}const r=await zu(n);if(e||(e=Gu(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new ws(r,e,t)}async function zu(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(br(n))e.push(await n.arrayBuffer());else if(Yu(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${Ku(n)}`);return e}function Ku(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Gu(n){var e;return Wr(n.name)||Wr(n.filename)||((e=Wr(n.path))==null?void 0:e.split(/[\\/]/).pop())}const Wr=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Yu=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Vi=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var Qu=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Zu=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Dn;async function Al(n){const{response:e}=n;if(n.options.stream)return Ut("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):lt.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return Ut("response",e.status,e.url,e.headers,i),kl(i,e)}const s=await e.text();return Ut("response",e.status,e.url,e.headers,s),s}function kl(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}class Sr extends Promise{constructor(e,t=Al){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Sr(this.responsePromise,async t=>kl(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class ef{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Vr("maxRetries",t),this.timeout=Vr("timeout",r),this.httpAgent=s,this.fetch=i??ul}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...of(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${df()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&br(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var p;const{method:r,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:Vi(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),c=this.buildURL(s,i);"timeout"in e&&Vr("timeout",e.timeout);const f=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??dl(c),h=f+1e3;typeof((p=u==null?void 0:u.options)==null?void 0:p.timeout)=="number"&&h>(u.options.timeout??0)&&(u.options.timeout=h),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const m=this.buildHeaders({options:e,headers:a,contentLength:l,retryCount:t});return{req:{method:r,...o&&{body:o},headers:m,...u&&{agent:u},signal:e.signal??null},url:c,timeout:f}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const a=this.defaultHeaders(e);return Ki(i,a),Ki(i,t),Vi(e.body)&&dn!=="node"&&delete i["content-type"],Gi(a,"x-stainless-retry-count")===void 0&&Gi(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return Ae.generate(e,t,r,s)}request(e,t=null){return new Sr(this.makeRequest(e,t))}async makeRequest(e,t){var u,h;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),Ut("request",a,r,i.headers),(u=r.signal)!=null&&u.aborted)throw new _t;const l=new AbortController,c=await this.fetchWithTimeout(a,i,o,l).catch(bs);if(c instanceof Error){if((h=r.signal)!=null&&h.aborted)throw new _t;if(t)return this.retryRequest(r,t);throw c.name==="AbortError"?new ml:new wr({cause:c})}const f=vl(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const w=`retrying, ${t} attempts remaining`;return Ut(`response (error; ${w})`,c.status,a,f),this.retryRequest(r,t,f)}const m=await c.text().catch(w=>bs(w).message),d=lf(m),p=d?void 0:m;throw Ut(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,f,p),this.makeStatusError(c.status,d,p,f)}return{response:c,options:r,controller:l}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new nf(this,r,e)}buildURL(e,t){const r=uf(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return ar(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new ne(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r);return this.fetch.call(void 0,e,{signal:s.signal,...a}).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await ff(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Tt}`}}class tf{constructor(e,t,r,s){Dn.set(this,void 0),Qu(this,Dn,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new ne("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await Zu(this,Dn,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Dn=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class nf extends Sr{constructor(e,t,r){super(t,async s=>new r(e,s.response,await Al(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const vl=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),rf={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},yt=n=>typeof n=="object"&&n!==null&&!ar(n)&&Object.keys(n).every(e=>Pl(rf,e)),sf=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Tt,"X-Stainless-OS":Xi(Deno.build.os),"X-Stainless-Arch":Ji(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Tt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Tt,"X-Stainless-OS":Xi(process.platform),"X-Stainless-Arch":Ji(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=af();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Tt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Tt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function af(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const Ji=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Xi=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let zi;const of=()=>zi??(zi=sf()),lf=n=>{try{return JSON.parse(n)}catch{return}},cf=/^[a-z][a-z0-9+.-]*:/i,uf=n=>cf.test(n),ff=n=>new Promise(e=>setTimeout(e,n)),Vr=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ne(`${n} must be an integer`);if(e<0)throw new ne(`${n} must be a positive integer`);return e},bs=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(String(n))},Jr=n=>{var e,t,r,s,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,n))==null?void 0:i.trim()};function ar(n){if(!n)return!0;for(const e in n)return!1;return!0}function Pl(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ki(n,e){for(const t in e){if(!Pl(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function Ut(n,...e){var t;typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"&&console.log(`Anthropic:DEBUG:${n}`,...e)}const df=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),hf=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",mf=n=>typeof(n==null?void 0:n.get)=="function",Gi=(n,e)=>{var r;const t=e.toLowerCase();if(mf(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=n.get(i);if(a)return a}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};class Er extends tf{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.first_id=r.first_id||null,this.last_id=r.last_id||null}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var t;if((t=this.options.query)!=null&&t.before_id){const r=this.first_id;return r?{params:{before_id:r}}:null}const e=this.last_id;return e?{params:{after_id:e}}:null}}class ft{constructor(e){this._client=e}}let oi=class extends ft{retrieve(e,t){return this._client.get(`/v1/models/${e}?beta=true`,t)}list(e={},t){return yt(e)?this.list({},e):this._client.getAPIList("/v1/models?beta=true",li,{query:e,...t})}};class li extends Er{}oi.BetaModelInfosPage=li;class Ar{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new ct;for await(const t of this.iterator)for(const r of e.decode(t))yield JSON.parse(r);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),new ne("Attempted to iterate over a response with no body");return new Ar(ai(e.body),t)}}let ci=class extends ft{create(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages/batches?beta=true",{body:s,...t,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}retrieve(e,t={},r){if(yt(t))return this.retrieve(e,{},t);const{betas:s}=t;return this._client.get(`/v1/messages/batches/${e}?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}list(e={},t){if(yt(e))return this.list({},e);const{betas:r,...s}=e;return this._client.getAPIList("/v1/messages/batches?beta=true",ui,{query:s,...t,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}cancel(e,t={},r){if(yt(t))return this.cancel(e,{},t);const{betas:s}=t;return this._client.post(`/v1/messages/batches/${e}/cancel?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}async results(e,t={},r){if(yt(t))return this.results(e,{},t);const s=await this.retrieve(e);if(!s.results_url)throw new ne(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);const{betas:i}=t;return this._client.get(s.results_url,{...r,headers:{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers},__binaryResponse:!0})._thenUnwrap((a,o)=>Ar.fromResponse(o.response,o.controller))}};class ui extends Er{}ci.BetaMessageBatchesPage=ui;let kr=class extends ft{constructor(){super(...arguments),this.batches=new ci(this._client)}create(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages?beta=true",{body:s,timeout:this._client._options.timeout??6e5,...t,headers:{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0,...t==null?void 0:t.headers},stream:e.stream??!1})}countTokens(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:s,...t,headers:{"anthropic-beta":[...r??[],"token-counting-2024-11-01"].toString(),...t==null?void 0:t.headers}})}};kr.Batches=ci;kr.BetaMessageBatchesPage=ui;class Pn extends ft{constructor(){super(...arguments),this.models=new oi(this._client),this.messages=new kr(this._client)}}Pn.Models=oi;Pn.BetaModelInfosPage=li;Pn.Messages=kr;class Cl extends ft{create(e,t){return this._client.post("/v1/complete",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}}class fi extends ft{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/v1/messages/batches/${e}`,t)}list(e={},t){return yt(e)?this.list({},e):this._client.getAPIList("/v1/messages/batches",di,{query:e,...t})}cancel(e,t){return this._client.post(`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const r=await this.retrieve(e);if(!r.results_url)throw new ne(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);return this._client.get(r.results_url,{...t,__binaryResponse:!0})._thenUnwrap((s,i)=>Ar.fromResponse(i.response,i.controller))}}class di extends Er{}fi.MessageBatchesPage=di;const pf=n=>{let e=0,t=[];for(;e<n.length;){let r=n[e];if(r==="\\"){e++;continue}if(r==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(r==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(r==="["){t.push({type:"paren",value:"["}),e++;continue}if(r==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(r===":"){t.push({type:"separator",value:":"}),e++;continue}if(r===","){t.push({type:"delimiter",value:","}),e++;continue}if(r==='"'){let o="",l=!1;for(r=n[++e];r!=='"';){if(e===n.length){l=!0;break}if(r==="\\"){if(e++,e===n.length){l=!0;break}o+=r+n[e],r=n[++e]}else o+=r,r=n[++e]}r=n[++e],l||t.push({type:"string",value:o});continue}if(r&&/\s/.test(r)){e++;continue}let i=/[0-9]/;if(r&&i.test(r)||r==="-"||r==="."){let o="";for(r==="-"&&(o+=r,r=n[++e]);r&&i.test(r)||r===".";)o+=r,r=n[++e];t.push({type:"number",value:o});continue}let a=/[a-z]/i;if(r&&a.test(r)){let o="";for(;r&&a.test(r)&&e!==n.length;)o+=r,r=n[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},It=n=>{if(n.length===0)return n;let e=n[n.length-1];switch(e.type){case"separator":return n=n.slice(0,n.length-1),It(n);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return n=n.slice(0,n.length-1),It(n);case"string":let r=n[n.length-2];if((r==null?void 0:r.type)==="delimiter")return n=n.slice(0,n.length-1),It(n);if((r==null?void 0:r.type)==="brace"&&r.value==="{")return n=n.slice(0,n.length-1),It(n);break;case"delimiter":return n=n.slice(0,n.length-1),It(n)}return n},gf=n=>{let e=[];return n.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?n.push({type:"brace",value:"}"}):t==="]"&&n.push({type:"paren",value:"]"})}),n},_f=n=>{let e="";return n.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},yf=n=>JSON.parse(_f(gf(It(pf(n)))));var Oe=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},V=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},He,ot,Bn,Ln,Gt,Yt,$n,Qt,nt,Zt,Un,jn,Rt,Xr,Yi,zr,Kr,Gr,Yr,Qi;const Zi="__json_buf";class or{constructor(){He.add(this),this.messages=[],this.receivedMessages=[],ot.set(this,void 0),this.controller=new AbortController,Bn.set(this,void 0),Ln.set(this,()=>{}),Gt.set(this,()=>{}),Yt.set(this,void 0),$n.set(this,()=>{}),Qt.set(this,()=>{}),nt.set(this,{}),Zt.set(this,!1),Un.set(this,!1),jn.set(this,!1),Rt.set(this,!1),zr.set(this,e=>{if(Oe(this,Un,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new _t),e instanceof _t)return Oe(this,jn,!0,"f"),this._emit("abort",e);if(e instanceof ne)return this._emit("error",e);if(e instanceof Error){const t=new ne(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ne(String(e)))}),Oe(this,Bn,new Promise((e,t)=>{Oe(this,Ln,e,"f"),Oe(this,Gt,t,"f")}),"f"),Oe(this,Yt,new Promise((e,t)=>{Oe(this,$n,e,"f"),Oe(this,Qt,t,"f")}),"f"),V(this,Bn,"f").catch(()=>{}),V(this,Yt,"f").catch(()=>{})}static fromReadableStream(e){const t=new or;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){const s=new or;for(const i of t.messages)s._addMessageParam(i);return s._run(()=>s._createMessage(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},V(this,zr,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){var a;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),V(this,He,"m",Kr).call(this);const i=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)V(this,He,"m",Gr).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new _t;V(this,He,"m",Yr).call(this)}_connected(){this.ended||(V(this,Ln,"f").call(this),this._emit("connect"))}get ended(){return V(this,Zt,"f")}get errored(){return V(this,Un,"f")}get aborted(){return V(this,jn,"f")}abort(){this.controller.abort()}on(e,t){return(V(this,nt,"f")[e]||(V(this,nt,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=V(this,nt,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(V(this,nt,"f")[e]||(V(this,nt,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Oe(this,Rt,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Oe(this,Rt,!0,"f"),await V(this,Yt,"f")}get currentMessage(){return V(this,ot,"f")}async finalMessage(){return await this.done(),V(this,He,"m",Xr).call(this)}async finalText(){return await this.done(),V(this,He,"m",Yi).call(this)}_emit(e,...t){if(V(this,Zt,"f"))return;e==="end"&&(Oe(this,Zt,!0,"f"),V(this,$n,"f").call(this));const r=V(this,nt,"f")[e];if(r&&(V(this,nt,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!V(this,Rt,"f")&&!(r!=null&&r.length)&&Promise.reject(s),V(this,Gt,"f").call(this,s),V(this,Qt,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!V(this,Rt,"f")&&!(r!=null&&r.length)&&Promise.reject(s),V(this,Gt,"f").call(this,s),V(this,Qt,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",V(this,He,"m",Xr).call(this))}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),V(this,He,"m",Kr).call(this),this._connected();const s=lt.fromReadableStream(e,this.controller);for await(const a of s)V(this,He,"m",Gr).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new _t;V(this,He,"m",Yr).call(this)}[(ot=new WeakMap,Bn=new WeakMap,Ln=new WeakMap,Gt=new WeakMap,Yt=new WeakMap,$n=new WeakMap,Qt=new WeakMap,nt=new WeakMap,Zt=new WeakMap,Un=new WeakMap,jn=new WeakMap,Rt=new WeakMap,zr=new WeakMap,He=new WeakSet,Xr=function(){if(this.receivedMessages.length===0)throw new ne("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Yi=function(){if(this.receivedMessages.length===0)throw new ne("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new ne("stream ended without producing a content block with type=text");return t.join(" ")},Kr=function(){this.ended||Oe(this,ot,void 0,"f")},Gr=function(t){if(this.ended)return;const r=V(this,He,"m",Qi).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{const s=r.content.at(-1);t.delta.type==="text_delta"&&s.type==="text"?this._emit("text",t.delta.text,s.text||""):t.delta.type==="input_json_delta"&&s.type==="tool_use"&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{Oe(this,ot,r,"f");break}}},Yr=function(){if(this.ended)throw new ne("stream has ended, this shouldn't happen");const t=V(this,ot,"f");if(!t)throw new ne("request ended without sending any chunks");return Oe(this,ot,void 0,"f"),t},Qi=function(t){let r=V(this,ot,"f");if(t.type==="message_start"){if(r)throw new ne(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new ne(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{const s=r.content.at(t.index);if((s==null?void 0:s.type)==="text"&&t.delta.type==="text_delta")s.text+=t.delta.text;else if((s==null?void 0:s.type)==="tool_use"&&t.delta.type==="input_json_delta"){let i=s[Zi]||"";i+=t.delta.partial_json,Object.defineProperty(s,Zi,{value:i,enumerable:!1,writable:!0}),i&&(s.input=yf(i))}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("streamEvent",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new lt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class vr extends ft{constructor(){super(...arguments),this.batches=new fi(this._client)}create(e,t){return e.model in ea&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${ea[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}stream(e,t){return or.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}const ea={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024"};vr.Batches=fi;vr.MessageBatchesPage=di;class hi extends ft{retrieve(e,t){return this._client.get(`/v1/models/${e}`,t)}list(e={},t){return yt(e)?this.list({},e):this._client.getAPIList("/v1/models",mi,{query:e,...t})}}class mi extends Er{}hi.ModelInfosPage=mi;var Rl;class te extends ef{constructor({baseURL:e=Jr("ANTHROPIC_BASE_URL"),apiKey:t=Jr("ANTHROPIC_API_KEY")??null,authToken:r=Jr("ANTHROPIC_AUTH_TOKEN")??null,...s}={}){const i={apiKey:t,authToken:r,...s,baseURL:e||"https://api.anthropic.com"};if(!i.dangerouslyAllowBrowser&&hf())throw new ne(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new Cl(this),this.messages=new vr(this),this.models=new hi(this),this.beta=new Pn(this),this._options=i,this.apiKey=t,this.authToken=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(e,t){if(!(this.apiKey&&e["x-api-key"])&&t["x-api-key"]!==null&&!(this.authToken&&e.authorization)&&t.authorization!==null)throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){const t=this.apiKeyAuth(e),r=this.bearerAuth(e);return t!=null&&!ar(t)?t:r!=null&&!ar(r)?r:{}}apiKeyAuth(e){return this.apiKey==null?{}:{"X-Api-Key":this.apiKey}}bearerAuth(e){return this.authToken==null?{}:{Authorization:`Bearer ${this.authToken}`}}}Rl=te;te.Anthropic=Rl;te.HUMAN_PROMPT=`

Human:`;te.AI_PROMPT=`

Assistant:`;te.DEFAULT_TIMEOUT=6e5;te.AnthropicError=ne;te.APIError=Ae;te.APIConnectionError=wr;te.APIConnectionTimeoutError=ml;te.APIUserAbortError=_t;te.NotFoundError=yl;te.ConflictError=wl;te.RateLimitError=Sl;te.BadRequestError=pl;te.AuthenticationError=gl;te.InternalServerError=El;te.PermissionDeniedError=_l;te.UnprocessableEntityError=bl;te.toFile=Xu;te.fileFromPath=hl;te.Completions=Cl;te.Messages=vr;te.Models=hi;te.ModelInfosPage=mi;te.Beta=Pn;const Ss="siyuan-ai-plugin-setting",xl="siyuan-ai-plugin-chat-history",Es="siyuan-ai-plugin-prompts",ta=atob("aHR0cHM6Ly9vbmVhcGkuZ2Vla3NwaGVyZS5vbmxpbmU=");class pi{constructor(e,t){Re(this,"plugin");Re(this,"name");Re(this,"file");this.name=t,this.plugin=e}}class wf extends pi{constructor(t,r){super(t,r);Re(this,"data",[]);this.name=r??xl,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this._defaultSettings()}async load(){let t=await this.plugin.loadData(this.file);return console.debug("Load Chat Data:",t),t&&(this.data=t),this.plugin.data[this.name]=t,t}async save(t){return t=t??this.dump(),await this.plugin.saveData(this.file,t),this.plugin.data[this.name]=t,t}add(t){this.data=[t,...this.data],this.save()}update(t){this.data=this.data.map(r=>r.id===t.id?t:r),this.save()}delete(t){this.data=this.data.filter(r=>r.id!==t),this.save()}get(t){return this.data.find(r=>r.id===t)}set(t){this.data.push(t),this.save()}dump(){return this.data}_defaultSettings(){this.data=[{id:1,title:"翻译",time:"2025/1/22 17:06:59",messages:[{role:"system",content:"你是一个乐于助人的助手。你可以通过回答我的问题来帮助我。如果信息不足，你也可以问我问题。"},{role:"user",content:"你好，我是一名翻译员，请翻译以下内容：目前，我国大部正在经历一场大回暖，晴暖当道。但很快天气格局将发生明显转折，预计23日至27日，今年首场寒潮过程将影响我国，带来剧烈降温和大风雨雪天气。"},{role:"assistant",content:`你好！以下是你要翻译的内容的英文版本：

Currently, most parts of our country are experiencing a significant warm-up, with sunny and warm weather prevailing. However, the weather pattern is about to undergo a noticeable shift. From the 23rd to the 27th, the first cold wave of the year is expected to affect our country, bringing sharp temperature drops, strong winds, and snowstorms.

希望这对你有帮助！如果有其他问题，随时问我。`}]},{id:2,title:"打招呼",time:"2025/1/22 17:05:59",messages:[{role:"system",content:"你是一个乐于助人的助手。你可以通过回答我的问题来帮助我。如果信息不足，你也可以问我问题。"},{role:"user",content:"你好"},{role:"assistant",content:"你好，很高兴为你服务。"}]}],this.load(),this.save()}}class bf extends pi{constructor(t,r){super(t,r);Re(this,"prompts",[]);this.name=r??Es,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this._defaultSettings()}async load(){let t=await this.plugin.loadData(this.file);return console.debug("Load Prompt Data:",t),t&&(this.prompts=t),this.plugin.data[this.name]=t,t}async save(t){return t=t??this.dump(),await this.plugin.saveData(this.file,t),this.plugin.data[this.name]=t,t}addPrompt(t){this.prompts=[...this.prompts,t],this.save()}updatePrompt(t){this.prompts=this.prompts.map(r=>r.id===t.id?t:r),this.save()}deletePrompt(t){this.prompts=this.prompts.filter(r=>r.id!==t),this.save()}get(t){return this.prompts.find(r=>r.id===t)}set(t){this.prompts.push(t),this.save()}dump(){return this.prompts}_defaultSettings(){this.prompts=[{id:0,title:"翻译、拼写纠正、改进",content:"请对以上内容进行翻译。要求：我希望你用更优美优雅的高级英语单词和句子替换我简化的 A0 级单词和句子。保持相同的意思，但使它们更文艺。你只需要翻译该内容，不必对内容中提出的问题和要求做解释，不要回答文本中的问题而是翻译它。"},{id:1,title:"提取标题",content:"请为上面这篇文章生成简洁且完整概括的标题。"},{id:2,title:"提取摘要",content:"请为上面这篇文章生成简明扼要的摘要。"},{id:3,title:"提取标签",content:"请为上面这篇文章生成标签，单个标签不超过6个字符，多个标签用英文逗号分隔，最多返回5个标签。"},{id:4,title:"论文摘要生成",content:`请你充当一名论文编辑专家，为上面这篇文章，在论文评审的角度去生成论文摘要部分，使其更加流畅，优美。下面是具体要求：
能让读者快速获得文章的要点或精髓，让文章引人入胜；能让读者了解全文中的重要信息、分析和论点；帮助读者记住论文的要点
字数限制在300字以下
用简洁、明了的语言描述论文的方法和结果，以便评审更容易理解论文`},{id:5,title:"文本总结助手",content:`你是一个擅长总结长文本的助手，请对上面的文本进行总结，并生成摘要。
标题：xxx
作者：xxx
标签：阅读文章内容后给文章打上标签，标签通常是领域、学科或专有名词
一句话总结这篇文文章:xxx
总结文章内容并写成摘要:xxx
越详细地列举文章的大纲，越详细越好，要完整体现文章要点；`},{id:6,title:"标题党",content:"请问上面的文本生成花哨的标题"}],this.load(),this.save()}}class Sf extends pi{constructor(t,r){super(t,r);Re(this,"settings",new Map);this.name=r??Ss,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this._defaultSettings()}async load(){let t=await this.plugin.loadData(this.file);if(console.debug("Load Setting Config:",t),t)for(let[r,s]of this.settings)s.value=(t==null?void 0:t[r])??s.value;return this.plugin.data[this.name]=t,t}async save(t){return t=t??this.dump(),await this.plugin.saveData(this.file,t),console.debug("Save Setting Config:",t),t}get(t){return this.settings.get(t)}getValue(t){var r;return(r=this.settings.get(t))==null?void 0:r.value}getSettingItems(t){let r=[];for(let[s,i]of this.settings)t&&i.group!==t||r.push(i);return r}set(t,r){this.settings.set(t,r)}setValue(t,r){let s=this.settings.get(t);s.value=r}dump(){let t={};for(let[r,s]of this.settings)t[r]=s.value;return t}_defaultSettings(){const t={group:"🌈 设置",title:"密钥",description:'<a href="https://item.taobao.com/item.htm?ft=t&id=877591591207&spm=a21dvs.23580594.0.0.621e2c1bjqRPCl&skuId=5719376381355">密钥购买链接</a>, 售后QQ群: 710607849',type:"textinput",key:"apiKey",value:"",placeholder:"Enter your Key"};this.settings.set(t.key,t);const r={group:"custom",title:"是否获取页面文本",description:"当未选中文本使用指令模式时，是否获取当前页面的全部文本作为大模型的输入。默认为 否。",type:"checkbox",key:"isPageContent",value:!1};this.settings.set(r.key,r);const s={group:"custom",title:"温度",description:"温度值越小，模型生成的内容越准确。温度值越高，模型生成内容越多样。默认为 1.0。",type:"slider",key:"temperature",slider:{min:0,max:2,step:.1},value:1};this.settings.set(s.key,s);const i={group:"custom",title:"最大长度",description:"输出文本的最大长度,默认为 4k。",type:"number",key:"maxOutputLength",value:4e3};this.settings.set(i.key,i);const a={group:"custom",title:"请求超时时间",description:"发起请求的超时时间，超过该时间，取消请求，单位：秒。默认为 90 秒。",type:"number",key:"responseTimeout",value:90};this.settings.set(a.key,a);const o={group:"model",title:"模型",description:"选择模型",type:"select",key:"modelSelections",value:"deepseek-chat",options:{"deepseek-chat":"DeepSeek Chat","deepseek-reasoner":"DeepSeek Reasoner","qwen-turbo-latest":"Qwen Turbo","qwen-plus-latest":"Qwen Plus","qwen-max-latest":"Qwen Max","gpt-4o":"GPT 4o","gpt-4o-mini":"GPT 4o mini","gpt-4-turbo":"GPT 4 Turbo","claude-3-5-haiku-20241022":"Claude 3.5 Haiku","claude-3-5-sonnet-latest":"Claude 3.5 Sonnet","claude-3-opus-latest":"Claude 3 Opus"}};this.settings.set(o.key,o),this.load()}}function lr(n,{delay:e=0,duration:t=400,easing:r=ja}={}){const s=+getComputedStyle(n).opacity;return{delay:e,duration:t,easing:r,css:i=>`opacity: ${i*s}`}}function na(n){let e;return{c(){e=P("div"),e.innerHTML='<span style="color: var(--b3-theme-primary);">生成中...</span>',M(e,"width","100%"),M(e,"text-align","center"),M(e,"border-top","1px solid var(--b3-border-color)")},m(t,r){K(t,e,r)},d(t){t&&z(e)}}}function Ef(n){let e,t,r,s,i,a,o=n[2]&&na();return{c(){e=P("div"),t=P("div"),r=_e(n[1]),s=I(),o&&o.c(),M(t,"max-height","250px"),M(t,"overflow-y","auto"),M(t,"margin-top","10px"),M(t,"white-space","pre-wrap"),M(t,"line-height","1.3"),M(t,"scrollbar-width","thin"),M(e,"width","94%"),M(e,"padding","3%"),M(e,"align-self","center"),M(e,"background","var(--b3-card-background)")},m(l,c){K(l,e,c),y(e,t),y(t,r),n[3](t),y(e,s),o&&o.m(e,null),a=!0},p(l,[c]){(!a||c&2)&&qe(r,l[1]),l[2]?o||(o=na(),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i(l){a||(l&&At(()=>{a&&(i||(i=tr(e,lr,{duration:200},!0)),i.run(1))}),a=!0)},o(l){l&&(i||(i=tr(e,lr,{duration:200},!1)),i.run(0)),a=!1},d(l){l&&z(e),n[3](null),o&&o.d(),l&&i&&i.end()}}}function Af(n,e,t){let{outputContent:r}=e,{isGenerating:s}=e,{outputContainer:i}=e;function a(o){ye[o?"unshift":"push"](()=>{i=o,t(0,i)})}return n.$$set=o=>{"outputContent"in o&&t(1,r=o.outputContent),"isGenerating"in o&&t(2,s=o.isGenerating),"outputContainer"in o&&t(0,i=o.outputContainer)},[i,r,s,a]}class kf extends Pe{constructor(e){super(),ve(this,e,Af,Ef,ke,{outputContent:1,isGenerating:2,outputContainer:0})}}function ra(n,e,t){const r=n.slice();return r[0]=e[t][0],r[18]=e[t][1],r}function vf(n){let e,t,r,s,i,a,o;return{c(){e=P("div"),t=P("input"),k(t,"id","fontSize"),k(t,"min",r=n[5].min),k(t,"max",s=n[5].max),k(t,"step",i=n[5].step),k(t,"type","range"),k(t,"style",n[8]),ie(t,"b3-slider",!0),ie(t,"fn__size200",n[7]),k(e,"class","b3-tooltips b3-tooltips__n"),k(e,"aria-label",n[0])},m(l,c){K(l,e,c),y(e,t),Fe(t,n[0]),a||(o=[X(t,"change",n[16]),X(t,"input",n[16]),X(t,"change",n[10])],a=!0)},p(l,c){c&32&&r!==(r=l[5].min)&&k(t,"min",r),c&32&&s!==(s=l[5].max)&&k(t,"max",s),c&32&&i!==(i=l[5].step)&&k(t,"step",i),c&256&&k(t,"style",l[8]),c&17&&Fe(t,l[0]),c&128&&ie(t,"fn__size200",l[7]),c&17&&k(e,"aria-label",l[0])},d(l){l&&z(e),a=!1,we(o)}}}function Pf(n){let e,t,r,s=Te(Object.entries(n[4])),i=[];for(let a=0;a<s.length;a+=1)i[a]=sa(ra(n,s,a));return{c(){e=P("select");for(let a=0;a<i.length;a+=1)i[a].c();k(e,"id","iconPosition"),k(e,"style",n[8]),n[0]===void 0&&At(()=>n[15].call(e)),ie(e,"b3-select",!0),ie(e,"fn__flex-center",!0),ie(e,"fn__size200",n[7])},m(a,o){K(a,e,o);for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(e,null);Ai(e,n[0],!0),t||(r=[X(e,"change",n[15]),X(e,"change",n[10])],t=!0)},p(a,o){if(o&16){s=Te(Object.entries(a[4]));let l;for(l=0;l<s.length;l+=1){const c=ra(a,s,l);i[l]?i[l].p(c,o):(i[l]=sa(c),i[l].c(),i[l].m(e,null))}for(;l<i.length;l+=1)i[l].d(1);i.length=s.length}o&256&&k(e,"style",a[8]),o&17&&Ai(e,a[0]),o&128&&ie(e,"fn__size200",a[7])},d(a){a&&z(e),mn(i,a),t=!1,we(r)}}}function Cf(n){let e,t=n[6].label+"",r,s,i;return{c(){e=P("button"),r=_e(t),k(e,"id",n[2]),k(e,"style",n[8]),ie(e,"b3-button",!0),ie(e,"b3-button--outline",!0),ie(e,"fn__flex-center",!0),ie(e,"fn__size200",n[7])},m(a,o){K(a,e,o),y(e,r),s||(i=X(e,"click",n[9]),s=!0)},p(a,o){o&64&&t!==(t=a[6].label+"")&&qe(r,t),o&4&&k(e,"id",a[2]),o&256&&k(e,"style",a[8]),o&128&&ie(e,"fn__size200",a[7])},d(a){a&&z(e),s=!1,i()}}}function Rf(n){let e,t,r;return{c(){e=P("input"),k(e,"id",n[2]),k(e,"type","number"),k(e,"style",n[8]),ie(e,"b3-text-field",!0),ie(e,"fn__flex-center",!0),ie(e,"fn__size200",n[7])},m(s,i){K(s,e,i),Fe(e,n[0]),t||(r=[X(e,"input",n[14]),X(e,"change",n[10])],t=!0)},p(s,i){i&4&&k(e,"id",s[2]),i&256&&k(e,"style",s[8]),i&17&&ns(e.value)!==s[0]&&Fe(e,s[0]),i&128&&ie(e,"fn__size200",s[7])},d(s){s&&z(e),t=!1,we(r)}}}function xf(n){let e,t,r,s;return{c(){e=P("textarea"),k(e,"class","b3-text-field fn__block"),k(e,"style",t=`resize: vertical; height: 10em; white-space: nowrap; ${n[8]}`)},m(i,a){K(i,e,a),Fe(e,n[0]),r||(s=[X(e,"input",n[13]),X(e,"change",n[10])],r=!0)},p(i,a){a&256&&t!==(t=`resize: vertical; height: 10em; white-space: nowrap; ${i[8]}`)&&k(e,"style",t),a&17&&Fe(e,i[0])},d(i){i&&z(e),r=!1,we(s)}}}function Of(n){let e,t,r;return{c(){e=P("input"),k(e,"id",n[2]),k(e,"placeholder",n[3]),k(e,"style",n[8]),ie(e,"b3-text-field",!0),ie(e,"fn__flex-center",!0),ie(e,"fn__size200",n[7])},m(s,i){K(s,e,i),Fe(e,n[0]),t||(r=[X(e,"input",n[12]),X(e,"change",n[10])],t=!0)},p(s,i){i&4&&k(e,"id",s[2]),i&8&&k(e,"placeholder",s[3]),i&256&&k(e,"style",s[8]),i&17&&e.value!==s[0]&&Fe(e,s[0]),i&128&&ie(e,"fn__size200",s[7])},d(s){s&&z(e),t=!1,we(r)}}}function Mf(n){let e,t,r;return{c(){e=P("input"),k(e,"class","b3-switch fn__flex-center"),k(e,"id",n[2]),k(e,"type","checkbox"),k(e,"style",n[8])},m(s,i){K(s,e,i),e.checked=n[0],t||(r=[X(e,"change",n[11]),X(e,"change",n[10])],t=!0)},p(s,i){i&4&&k(e,"id",s[2]),i&256&&k(e,"style",s[8]),i&17&&(e.checked=s[0])},d(s){s&&z(e),t=!1,we(r)}}}function sa(n){let e,t=n[18]+"",r,s;return{c(){e=P("option"),r=_e(t),e.__value=s=n[0],Fe(e,e.__value)},m(i,a){K(i,e,a),y(e,r)},p(i,a){a&16&&t!==(t=i[18]+"")&&qe(r,t),a&16&&s!==(s=i[0])&&(e.__value=s,Fe(e,e.__value))},d(i){i&&z(e)}}}function Tf(n){let e;function t(i,a){if(i[1]==="checkbox")return Mf;if(i[1]==="textinput")return Of;if(i[1]==="textarea")return xf;if(i[1]==="number")return Rf;if(i[1]==="button")return Cf;if(i[1]==="select")return Pf;if(i[1]=="slider")return vf}let r=t(n),s=r&&r(n);return{c(){s&&s.c(),e=Fs()},m(i,a){s&&s.m(i,a),K(i,e,a)},p(i,[a]){r===(r=t(i))&&s?s.p(i,a):(s&&s.d(1),s=r&&r(i),s&&(s.c(),s.m(e.parentNode,e)))},i:me,o:me,d(i){i&&z(e),s&&s.d(i)}}}function If(n,e,t){let{type:r}=e,{key:s}=e,{value:i}=e,{placeholder:a=""}=e,{options:o={}}=e,{slider:l={min:0,max:100,step:1}}=e,{button:c={label:i,callback:()=>{}}}=e,{fnSize:f=!0}=e,{style:u=""}=e;const h=mr();function m(){c==null||c.callback(),h("click",{key:s})}function d(){h("changed",{key:s,value:i})}function p(){i=this.checked,t(0,i),t(4,o)}function g(){i=this.value,t(0,i),t(4,o)}function C(){i=this.value,t(0,i),t(4,o)}function w(){i=ns(this.value),t(0,i),t(4,o)}function _(){i=Sc(this),t(0,i),t(4,o)}function b(){i=ns(this.value),t(0,i),t(4,o)}return n.$$set=S=>{"type"in S&&t(1,r=S.type),"key"in S&&t(2,s=S.key),"value"in S&&t(0,i=S.value),"placeholder"in S&&t(3,a=S.placeholder),"options"in S&&t(4,o=S.options),"slider"in S&&t(5,l=S.slider),"button"in S&&t(6,c=S.button),"fnSize"in S&&t(7,f=S.fnSize),"style"in S&&t(8,u=S.style)},[i,r,s,a,o,l,c,f,u,m,d,p,g,C,w,_,b]}class cr extends Pe{constructor(e){super(),ve(this,e,If,Tf,ke,{type:1,key:2,value:0,placeholder:3,options:4,slider:5,button:6,fnSize:7,style:8})}}function Ff(n){let e,t,r,s,i,a,o,l,c,f,u,h,m;function d(g){n[13](g)}let p={type:"select",key:"modelSelections",fnSize:!1,options:n[4].get("modelSelections").options,style:"margin-right: 5px; font-size: 12px; padding: 2px 4px; border-radius: 4px; border: 1px solid #ddd; height: 2em; background: transparent; align-self: center;"};return n[2]!==void 0&&(p.value=n[2]),s=new cr({props:p}),ye.push(()=>Ue(s,"value",d)),s.$on("changed",n[14]),{c(){e=P("div"),t=P("textarea"),r=I(),ue(s.$$.fragment),a=I(),o=P("button"),o.textContent="超参数",l=I(),c=P("button"),c.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" class="svelte-1x8hi4t"></path></svg>',k(t,"placeholder","输入 AI 指令... Shift + Enter 换行，/触发命令"),k(t,"class",".b3-text-field fn__block fn__flex-center"),M(t,"width","calc(100% - 120px)"),M(t,"height","2em"),M(t,"line-height","1.5em"),M(t,"white-space","pre-wrap"),M(t,"background","transparent"),M(t,"border","0"),M(t,"outline","none"),M(t,"margin-left","0.5em"),M(t,"resize","none"),M(t,"overflow-y","auto"),M(t,"padding","0"),k(o,"type","button"),k(o,"class","ai-instruction-params-button svelte-1x8hi4t"),M(o,"font-size","12px"),M(o,"color","#666"),M(o,"text-decoration","none"),M(o,"background","none"),M(o,"border","none"),M(o,"padding","0"),M(o,"cursor","pointer"),M(o,"margin-right","5px"),M(o,"white-space","nowrap"),M(o,"height","2em"),M(o,"line-height","2em"),M(o,"align-self","center"),M(o,"color","var(--b3-theme-on-surface)"),k(c,"type","button"),k(c,"class","ai-instruction-submit-button svelte-1x8hi4t"),M(c,"height","2em"),M(c,"display","flex"),M(c,"align-items","center"),M(c,"opacity","0.6"),M(c,"cursor","pointer"),M(c,"background","none"),M(c,"border","none"),M(c,"padding","0"),M(c,"align-self","center"),M(e,"width","100%"),M(e,"height","100%"),M(e,"display","flex"),M(e,"position","relative"),M(e,"align-items","center"),M(e,"margin","10px 0")},m(g,C){K(g,e,C),y(e,t),n[8](t),Fe(t,n[0]),y(e,r),le(s,e,null),y(e,a),y(e,o),y(e,l),y(e,c),u=!0,h||(m=[X(t,"input",n[9]),X(t,"keydown",n[10]),X(t,"focus",n[11]),X(t,"blur",n[12]),X(o,"click",n[15]),X(c,"click",function(){hn(n[5])&&n[5].apply(this,arguments)}),X(c,"keydown",function(){hn(n[6])&&n[6].apply(this,arguments)})],h=!0)},p(g,[C]){n=g,C&1&&Fe(t,n[0]);const w={};C&16&&(w.options=n[4].get("modelSelections").options),!i&&C&4&&(i=!0,w.value=n[2],$e(()=>i=!1)),s.$set(w)},i(g){u||(q(s.$$.fragment,g),g&&At(()=>{u&&(f||(f=tr(e,lr,{duration:200},!0)),f.run(1))}),u=!0)},o(g){W(s.$$.fragment,g),g&&(f||(f=tr(e,lr,{duration:200},!1)),f.run(0)),u=!1},d(g){g&&z(e),n[8](null),ce(s),g&&f&&f.end(),h=!1,we(m)}}}function Nf(n,e,t){let{inputValue:r}=e,{inputElement:s}=e,{selectedModel:i}=e,{settingStorage:a}=e,{showParams:o}=e,{handleSubmit:l}=e,{handleKeydown:c}=e,f=!1;function u(_){ye[_?"unshift":"push"](()=>{s=_,t(1,s)})}function h(){r=this.value,t(0,r)}const m=_=>{_.key==="Enter"&&!_.shiftKey&&(_.preventDefault(),l()),c(_)},d=()=>t(7,f=!0),p=()=>t(7,f=!1);function g(_){i=_,t(2,i)}const C=({detail:_})=>{a.setValue(_.key,_.value),a.save()},w=()=>{t(3,o=!o),o||a.save()};return n.$$set=_=>{"inputValue"in _&&t(0,r=_.inputValue),"inputElement"in _&&t(1,s=_.inputElement),"selectedModel"in _&&t(2,i=_.selectedModel),"settingStorage"in _&&t(4,a=_.settingStorage),"showParams"in _&&t(3,o=_.showParams),"handleSubmit"in _&&t(5,l=_.handleSubmit),"handleKeydown"in _&&t(6,c=_.handleKeydown)},[r,s,i,o,a,l,c,f,u,h,m,d,p,g,C,w]}class Df extends Pe{constructor(e){super(),ve(this,e,Nf,Ff,ke,{inputValue:0,inputElement:1,selectedModel:2,settingStorage:4,showParams:3,handleSubmit:5,handleKeydown:6})}}function Bf(n){let e,t,r,s,i,a,o=ur(n[1],n[3])+"",l,c,f,u;const h=n[5].default,m=xs(h,n,n[4],null);return{c(){e=P("div"),t=P("div"),r=P("span"),s=_e(n[0]),i=I(),a=P("div"),l=I(),c=P("span"),f=I(),m&&m.c(),k(r,"class","title svelte-ikiu6h"),k(a,"class","b3-label__text"),k(t,"class","fn__flex-1"),k(c,"class","fn__space"),k(e,"class","item-wrap fn__flex b3-label config__item svelte-ikiu6h")},m(d,p){K(d,e,p),y(e,t),y(t,r),y(r,s),y(t,i),y(t,a),a.innerHTML=o,y(e,l),y(e,c),y(e,f),m&&m.m(e,null),u=!0},p(d,p){(!u||p&1)&&qe(s,d[0]),(!u||p&10)&&o!==(o=ur(d[1],d[3])+"")&&(a.innerHTML=o),m&&m.p&&(!u||p&16)&&Ms(m,h,d,d[4],u?Os(h,d[4],p,null):Ts(d[4]),null)},i(d){u||(q(m,d),u=!0)},o(d){W(m,d),u=!1},d(d){d&&z(e),m&&m.d(d)}}}function Lf(n){let e,t,r,s,i,a,o=ur(n[1],n[3])+"",l,c,f,u,h;const m=n[5].default,d=xs(m,n,n[4],null);return{c(){e=P("div"),t=P("div"),r=P("span"),s=_e(n[0]),i=I(),a=P("div"),l=I(),c=P("div"),f=I(),u=P("div"),d&&d.c(),k(r,"class","title svelte-ikiu6h"),k(a,"class","b3-label__text"),k(c,"class","fn__hr"),M(u,"display","flex"),M(u,"flex-direction","column"),M(u,"gap","5px"),M(u,"position","relative"),k(t,"class","fn__block"),k(e,"class","item-wrap b3-label svelte-ikiu6h"),k(e,"data-key","CustomCSS")},m(p,g){K(p,e,g),y(e,t),y(t,r),y(r,s),y(t,i),y(t,a),a.innerHTML=o,y(t,l),y(t,c),y(t,f),y(t,u),d&&d.m(u,null),h=!0},p(p,g){(!h||g&1)&&qe(s,p[0]),(!h||g&10)&&o!==(o=ur(p[1],p[3])+"")&&(a.innerHTML=o),d&&d.p&&(!h||g&16)&&Ms(d,m,p,p[4],h?Os(m,p[4],g,null):Ts(p[4]),null)},i(p){h||(q(d,p),h=!0)},o(p){W(d,p),h=!1},d(p){p&&z(e),d&&d.d(p)}}}function $f(n){let e,t,r,s;const i=[Lf,Bf],a=[];function o(l,c){return l[2]==="row"?0:1}return e=o(n),t=a[e]=i[e](n),{c(){t.c(),r=Fs()},m(l,c){a[e].m(l,c),K(l,r,c),s=!0},p(l,[c]){let f=e;e=o(l),e===f?a[e].p(l,c):(bt(),W(a[f],1,1,()=>{a[f]=null}),St(),t=a[e],t?t.p(l,c):(t=a[e]=i[e](l),t.c()),q(t,1),t.m(r.parentNode,r))},i(l){s||(q(t),s=!0)},o(l){W(t),s=!1},d(l){l&&z(r),a[e].d(l)}}}function ur(n,e=!1){return e&&n.length>20?n.slice(0,20)+"...":n}function Uf(n,e,t){let{$$slots:r={},$$scope:s}=e,{title:i}=e,{description:a}=e,{direction:o="column"}=e,{isSimple:l=!1}=e;return n.$$set=c=>{"title"in c&&t(0,i=c.title),"description"in c&&t(1,a=c.description),"direction"in c&&t(2,o=c.direction),"isSimple"in c&&t(3,l=c.isSimple),"$$scope"in c&&t(4,s=c.$$scope)},[i,a,o,l,s,r]}class jf extends Pe{constructor(e){super(),ve(this,e,Uf,$f,ke,{title:0,description:1,direction:2,isSimple:3})}}const Ol={Wrap:jf,Input:cr};function Ml(n,e){return function(){return n.apply(e,arguments)}}const{toString:qf}=Object.prototype,{getPrototypeOf:gi}=Object,Pr=(n=>e=>{const t=qf.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Ke=n=>(n=n.toLowerCase(),e=>Pr(e)===n),Cr=n=>e=>typeof e===n,{isArray:Vt}=Array,wn=Cr("undefined");function Hf(n){return n!==null&&!wn(n)&&n.constructor!==null&&!wn(n.constructor)&&je(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Tl=Ke("ArrayBuffer");function Wf(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&Tl(n.buffer),e}const Vf=Cr("string"),je=Cr("function"),Il=Cr("number"),Rr=n=>n!==null&&typeof n=="object",Jf=n=>n===!0||n===!1,Kn=n=>{if(Pr(n)!=="object")return!1;const e=gi(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Xf=Ke("Date"),zf=Ke("File"),Kf=Ke("Blob"),Gf=Ke("FileList"),Yf=n=>Rr(n)&&je(n.pipe),Qf=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||je(n.append)&&((e=Pr(n))==="formdata"||e==="object"&&je(n.toString)&&n.toString()==="[object FormData]"))},Zf=Ke("URLSearchParams"),[ed,td,nd,rd]=["ReadableStream","Request","Response","Headers"].map(Ke),sd=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Cn(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,s;if(typeof n!="object"&&(n=[n]),Vt(n))for(r=0,s=n.length;r<s;r++)e.call(null,n[r],r,n);else{const i=t?Object.getOwnPropertyNames(n):Object.keys(n),a=i.length;let o;for(r=0;r<a;r++)o=i[r],e.call(null,n[o],o,n)}}function Fl(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,s;for(;r-- >0;)if(s=t[r],e===s.toLowerCase())return s;return null}const wt=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Nl=n=>!wn(n)&&n!==wt;function As(){const{caseless:n}=Nl(this)&&this||{},e={},t=(r,s)=>{const i=n&&Fl(e,s)||s;Kn(e[i])&&Kn(r)?e[i]=As(e[i],r):Kn(r)?e[i]=As({},r):Vt(r)?e[i]=r.slice():e[i]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&Cn(arguments[r],t);return e}const id=(n,e,t,{allOwnKeys:r}={})=>(Cn(e,(s,i)=>{t&&je(s)?n[i]=Ml(s,t):n[i]=s},{allOwnKeys:r}),n),ad=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),od=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},ld=(n,e,t,r)=>{let s,i,a;const o={};if(e=e||{},n==null)return e;do{for(s=Object.getOwnPropertyNames(n),i=s.length;i-- >0;)a=s[i],(!r||r(a,n,e))&&!o[a]&&(e[a]=n[a],o[a]=!0);n=t!==!1&&gi(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},cd=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},ud=n=>{if(!n)return null;if(Vt(n))return n;let e=n.length;if(!Il(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},fd=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&gi(Uint8Array)),dd=(n,e)=>{const r=(n&&n[Symbol.iterator]).call(n);let s;for(;(s=r.next())&&!s.done;){const i=s.value;e.call(n,i[0],i[1])}},hd=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},md=Ke("HTMLFormElement"),pd=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,s){return r.toUpperCase()+s}),ia=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),gd=Ke("RegExp"),Dl=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};Cn(t,(s,i)=>{let a;(a=e(s,i,n))!==!1&&(r[i]=a||s)}),Object.defineProperties(n,r)},_d=n=>{Dl(n,(e,t)=>{if(je(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(je(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},yd=(n,e)=>{const t={},r=s=>{s.forEach(i=>{t[i]=!0})};return Vt(n)?r(n):r(String(n).split(e)),t},wd=()=>{},bd=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e,Qr="abcdefghijklmnopqrstuvwxyz",aa="0123456789",Bl={DIGIT:aa,ALPHA:Qr,ALPHA_DIGIT:Qr+Qr.toUpperCase()+aa},Sd=(n=16,e=Bl.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function Ed(n){return!!(n&&je(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const Ad=n=>{const e=new Array(10),t=(r,s)=>{if(Rr(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const i=Vt(r)?[]:{};return Cn(r,(a,o)=>{const l=t(a,s+1);!wn(l)&&(i[o]=l)}),e[s]=void 0,i}}return r};return t(n,0)},kd=Ke("AsyncFunction"),vd=n=>n&&(Rr(n)||je(n))&&je(n.then)&&je(n.catch),Ll=((n,e)=>n?setImmediate:e?((t,r)=>(wt.addEventListener("message",({source:s,data:i})=>{s===wt&&i===t&&r.length&&r.shift()()},!1),s=>{r.push(s),wt.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",je(wt.postMessage)),Pd=typeof queueMicrotask<"u"?queueMicrotask.bind(wt):typeof process<"u"&&process.nextTick||Ll,A={isArray:Vt,isArrayBuffer:Tl,isBuffer:Hf,isFormData:Qf,isArrayBufferView:Wf,isString:Vf,isNumber:Il,isBoolean:Jf,isObject:Rr,isPlainObject:Kn,isReadableStream:ed,isRequest:td,isResponse:nd,isHeaders:rd,isUndefined:wn,isDate:Xf,isFile:zf,isBlob:Kf,isRegExp:gd,isFunction:je,isStream:Yf,isURLSearchParams:Zf,isTypedArray:fd,isFileList:Gf,forEach:Cn,merge:As,extend:id,trim:sd,stripBOM:ad,inherits:od,toFlatObject:ld,kindOf:Pr,kindOfTest:Ke,endsWith:cd,toArray:ud,forEachEntry:dd,matchAll:hd,isHTMLForm:md,hasOwnProperty:ia,hasOwnProp:ia,reduceDescriptors:Dl,freezeMethods:_d,toObjectSet:yd,toCamelCase:pd,noop:wd,toFiniteNumber:bd,findKey:Fl,global:wt,isContextDefined:Nl,ALPHABET:Bl,generateString:Sd,isSpecCompliantForm:Ed,toJSONObject:Ad,isAsyncFn:kd,isThenable:vd,setImmediate:Ll,asap:Pd};function H(n,e,t,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}A.inherits(H,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:A.toJSONObject(this.config),code:this.code,status:this.status}}});const $l=H.prototype,Ul={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Ul[n]={value:n}});Object.defineProperties(H,Ul);Object.defineProperty($l,"isAxiosError",{value:!0});H.from=(n,e,t,r,s,i)=>{const a=Object.create($l);return A.toFlatObject(n,a,function(l){return l!==Error.prototype},o=>o!=="isAxiosError"),H.call(a,n.message,e,t,r,s),a.cause=n,a.name=n.name,i&&Object.assign(a,i),a};const Cd=null;function ks(n){return A.isPlainObject(n)||A.isArray(n)}function jl(n){return A.endsWith(n,"[]")?n.slice(0,-2):n}function oa(n,e,t){return n?n.concat(e).map(function(s,i){return s=jl(s),!t&&i?"["+s+"]":s}).join(t?".":""):e}function Rd(n){return A.isArray(n)&&!n.some(ks)}const xd=A.toFlatObject(A,{},null,function(e){return/^is[A-Z]/.test(e)});function xr(n,e,t){if(!A.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=A.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(p,g){return!A.isUndefined(g[p])});const r=t.metaTokens,s=t.visitor||f,i=t.dots,a=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&A.isSpecCompliantForm(e);if(!A.isFunction(s))throw new TypeError("visitor must be a function");function c(d){if(d===null)return"";if(A.isDate(d))return d.toISOString();if(!l&&A.isBlob(d))throw new H("Blob is not supported. Use a Buffer instead.");return A.isArrayBuffer(d)||A.isTypedArray(d)?l&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function f(d,p,g){let C=d;if(d&&!g&&typeof d=="object"){if(A.endsWith(p,"{}"))p=r?p:p.slice(0,-2),d=JSON.stringify(d);else if(A.isArray(d)&&Rd(d)||(A.isFileList(d)||A.endsWith(p,"[]"))&&(C=A.toArray(d)))return p=jl(p),C.forEach(function(_,b){!(A.isUndefined(_)||_===null)&&e.append(a===!0?oa([p],b,i):a===null?p:p+"[]",c(_))}),!1}return ks(d)?!0:(e.append(oa(g,p,i),c(d)),!1)}const u=[],h=Object.assign(xd,{defaultVisitor:f,convertValue:c,isVisitable:ks});function m(d,p){if(!A.isUndefined(d)){if(u.indexOf(d)!==-1)throw Error("Circular reference detected in "+p.join("."));u.push(d),A.forEach(d,function(C,w){(!(A.isUndefined(C)||C===null)&&s.call(e,C,A.isString(w)?w.trim():w,p,h))===!0&&m(C,p?p.concat(w):[w])}),u.pop()}}if(!A.isObject(n))throw new TypeError("data must be an object");return m(n),e}function la(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function _i(n,e){this._pairs=[],n&&xr(n,this,e)}const ql=_i.prototype;ql.append=function(e,t){this._pairs.push([e,t])};ql.toString=function(e){const t=e?function(r){return e.call(this,r,la)}:la;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};function Od(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Hl(n,e,t){if(!e)return n;const r=t&&t.encode||Od;A.isFunction(t)&&(t={serialize:t});const s=t&&t.serialize;let i;if(s?i=s(e,t):i=A.isURLSearchParams(e)?e.toString():new _i(e,t).toString(r),i){const a=n.indexOf("#");a!==-1&&(n=n.slice(0,a)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n}class ca{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){A.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Wl={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Md=typeof URLSearchParams<"u"?URLSearchParams:_i,Td=typeof FormData<"u"?FormData:null,Id=typeof Blob<"u"?Blob:null,Fd={isBrowser:!0,classes:{URLSearchParams:Md,FormData:Td,Blob:Id},protocols:["http","https","file","blob","url","data"]},yi=typeof window<"u"&&typeof document<"u",vs=typeof navigator=="object"&&navigator||void 0,Nd=yi&&(!vs||["ReactNative","NativeScript","NS"].indexOf(vs.product)<0),Dd=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Bd=yi&&window.location.href||"http://localhost",Ld=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:yi,hasStandardBrowserEnv:Nd,hasStandardBrowserWebWorkerEnv:Dd,navigator:vs,origin:Bd},Symbol.toStringTag,{value:"Module"})),Ee={...Ld,...Fd};function $d(n,e){return xr(n,new Ee.classes.URLSearchParams,Object.assign({visitor:function(t,r,s,i){return Ee.isNode&&A.isBuffer(t)?(this.append(r,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function Ud(n){return A.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function jd(n){const e={},t=Object.keys(n);let r;const s=t.length;let i;for(r=0;r<s;r++)i=t[r],e[i]=n[i];return e}function Vl(n){function e(t,r,s,i){let a=t[i++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),l=i>=t.length;return a=!a&&A.isArray(s)?s.length:a,l?(A.hasOwnProp(s,a)?s[a]=[s[a],r]:s[a]=r,!o):((!s[a]||!A.isObject(s[a]))&&(s[a]=[]),e(t,r,s[a],i)&&A.isArray(s[a])&&(s[a]=jd(s[a])),!o)}if(A.isFormData(n)&&A.isFunction(n.entries)){const t={};return A.forEachEntry(n,(r,s)=>{e(Ud(r),s,t,0)}),t}return null}function qd(n,e,t){if(A.isString(n))try{return(e||JSON.parse)(n),A.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(0,JSON.stringify)(n)}const Rn={transitional:Wl,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",s=r.indexOf("application/json")>-1,i=A.isObject(e);if(i&&A.isHTMLForm(e)&&(e=new FormData(e)),A.isFormData(e))return s?JSON.stringify(Vl(e)):e;if(A.isArrayBuffer(e)||A.isBuffer(e)||A.isStream(e)||A.isFile(e)||A.isBlob(e)||A.isReadableStream(e))return e;if(A.isArrayBufferView(e))return e.buffer;if(A.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return $d(e,this.formSerializer).toString();if((o=A.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return xr(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return i||s?(t.setContentType("application/json",!1),qd(e)):e}],transformResponse:[function(e){const t=this.transitional||Rn.transitional,r=t&&t.forcedJSONParsing,s=this.responseType==="json";if(A.isResponse(e)||A.isReadableStream(e))return e;if(e&&A.isString(e)&&(r&&!this.responseType||s)){const a=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?H.from(o,H.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ee.classes.FormData,Blob:Ee.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};A.forEach(["delete","get","head","post","put","patch"],n=>{Rn.headers[n]={}});const Hd=A.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Wd=n=>{const e={};let t,r,s;return n&&n.split(`
`).forEach(function(a){s=a.indexOf(":"),t=a.substring(0,s).trim().toLowerCase(),r=a.substring(s+1).trim(),!(!t||e[t]&&Hd[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},ua=Symbol("internals");function en(n){return n&&String(n).trim().toLowerCase()}function Gn(n){return n===!1||n==null?n:A.isArray(n)?n.map(Gn):String(n)}function Vd(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const Jd=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Zr(n,e,t,r,s){if(A.isFunction(r))return r.call(this,e,t);if(s&&(e=t),!!A.isString(e)){if(A.isString(r))return e.indexOf(r)!==-1;if(A.isRegExp(r))return r.test(e)}}function Xd(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function zd(n,e){const t=A.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(s,i,a){return this[r].call(this,e,s,i,a)},configurable:!0})})}class Ie{constructor(e){e&&this.set(e)}set(e,t,r){const s=this;function i(o,l,c){const f=en(l);if(!f)throw new Error("header name must be a non-empty string");const u=A.findKey(s,f);(!u||s[u]===void 0||c===!0||c===void 0&&s[u]!==!1)&&(s[u||l]=Gn(o))}const a=(o,l)=>A.forEach(o,(c,f)=>i(c,f,l));if(A.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(A.isString(e)&&(e=e.trim())&&!Jd(e))a(Wd(e),t);else if(A.isHeaders(e))for(const[o,l]of e.entries())i(l,o,r);else e!=null&&i(t,e,r);return this}get(e,t){if(e=en(e),e){const r=A.findKey(this,e);if(r){const s=this[r];if(!t)return s;if(t===!0)return Vd(s);if(A.isFunction(t))return t.call(this,s,r);if(A.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=en(e),e){const r=A.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||Zr(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let s=!1;function i(a){if(a=en(a),a){const o=A.findKey(r,a);o&&(!t||Zr(r,r[o],o,t))&&(delete r[o],s=!0)}}return A.isArray(e)?e.forEach(i):i(e),s}clear(e){const t=Object.keys(this);let r=t.length,s=!1;for(;r--;){const i=t[r];(!e||Zr(this,this[i],i,e,!0))&&(delete this[i],s=!0)}return s}normalize(e){const t=this,r={};return A.forEach(this,(s,i)=>{const a=A.findKey(r,i);if(a){t[a]=Gn(s),delete t[i];return}const o=e?Xd(i):String(i).trim();o!==i&&delete t[i],t[o]=Gn(s),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return A.forEach(this,(r,s)=>{r!=null&&r!==!1&&(t[s]=e&&A.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[ua]=this[ua]={accessors:{}}).accessors,s=this.prototype;function i(a){const o=en(a);r[o]||(zd(s,a),r[o]=!0)}return A.isArray(e)?e.forEach(i):i(e),this}}Ie.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);A.reduceDescriptors(Ie.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});A.freezeMethods(Ie);function es(n,e){const t=this||Rn,r=e||t,s=Ie.from(r.headers);let i=r.data;return A.forEach(n,function(o){i=o.call(t,i,s.normalize(),e?e.status:void 0)}),s.normalize(),i}function Jl(n){return!!(n&&n.__CANCEL__)}function Jt(n,e,t){H.call(this,n??"canceled",H.ERR_CANCELED,e,t),this.name="CanceledError"}A.inherits(Jt,H,{__CANCEL__:!0});function Xl(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new H("Request failed with status code "+t.status,[H.ERR_BAD_REQUEST,H.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Kd(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Gd(n,e){n=n||10;const t=new Array(n),r=new Array(n);let s=0,i=0,a;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),f=r[i];a||(a=c),t[s]=l,r[s]=c;let u=i,h=0;for(;u!==s;)h+=t[u++],u=u%n;if(s=(s+1)%n,s===i&&(i=(i+1)%n),c-a<e)return;const m=f&&c-f;return m?Math.round(h*1e3/m):void 0}}function Yd(n,e){let t=0,r=1e3/e,s,i;const a=(c,f=Date.now())=>{t=f,s=null,i&&(clearTimeout(i),i=null),n.apply(null,c)};return[(...c)=>{const f=Date.now(),u=f-t;u>=r?a(c,f):(s=c,i||(i=setTimeout(()=>{i=null,a(s)},r-u)))},()=>s&&a(s)]}const fr=(n,e,t=3)=>{let r=0;const s=Gd(50,250);return Yd(i=>{const a=i.loaded,o=i.lengthComputable?i.total:void 0,l=a-r,c=s(l),f=a<=o;r=a;const u={loaded:a,total:o,progress:o?a/o:void 0,bytes:l,rate:c||void 0,estimated:c&&o&&f?(o-a)/c:void 0,event:i,lengthComputable:o!=null,[e?"download":"upload"]:!0};n(u)},t)},fa=(n,e)=>{const t=n!=null;return[r=>e[0]({lengthComputable:t,total:n,loaded:r}),e[1]]},da=n=>(...e)=>A.asap(()=>n(...e)),Qd=Ee.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,Ee.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(Ee.origin),Ee.navigator&&/(msie|trident)/i.test(Ee.navigator.userAgent)):()=>!0,Zd=Ee.hasStandardBrowserEnv?{write(n,e,t,r,s,i){const a=[n+"="+encodeURIComponent(e)];A.isNumber(t)&&a.push("expires="+new Date(t).toGMTString()),A.isString(r)&&a.push("path="+r),A.isString(s)&&a.push("domain="+s),i===!0&&a.push("secure"),document.cookie=a.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function eh(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function th(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function zl(n,e){return n&&!eh(e)?th(n,e):e}const ha=n=>n instanceof Ie?{...n}:n;function kt(n,e){e=e||{};const t={};function r(c,f,u,h){return A.isPlainObject(c)&&A.isPlainObject(f)?A.merge.call({caseless:h},c,f):A.isPlainObject(f)?A.merge({},f):A.isArray(f)?f.slice():f}function s(c,f,u,h){if(A.isUndefined(f)){if(!A.isUndefined(c))return r(void 0,c,u,h)}else return r(c,f,u,h)}function i(c,f){if(!A.isUndefined(f))return r(void 0,f)}function a(c,f){if(A.isUndefined(f)){if(!A.isUndefined(c))return r(void 0,c)}else return r(void 0,f)}function o(c,f,u){if(u in e)return r(c,f);if(u in n)return r(void 0,c)}const l={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(c,f,u)=>s(ha(c),ha(f),u,!0)};return A.forEach(Object.keys(Object.assign({},n,e)),function(f){const u=l[f]||s,h=u(n[f],e[f],f);A.isUndefined(h)&&u!==o||(t[f]=h)}),t}const Kl=n=>{const e=kt({},n);let{data:t,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:i,headers:a,auth:o}=e;e.headers=a=Ie.from(a),e.url=Hl(zl(e.baseURL,e.url),n.params,n.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let l;if(A.isFormData(t)){if(Ee.hasStandardBrowserEnv||Ee.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((l=a.getContentType())!==!1){const[c,...f]=l?l.split(";").map(u=>u.trim()).filter(Boolean):[];a.setContentType([c||"multipart/form-data",...f].join("; "))}}if(Ee.hasStandardBrowserEnv&&(r&&A.isFunction(r)&&(r=r(e)),r||r!==!1&&Qd(e.url))){const c=s&&i&&Zd.read(i);c&&a.set(s,c)}return e},nh=typeof XMLHttpRequest<"u",rh=nh&&function(n){return new Promise(function(t,r){const s=Kl(n);let i=s.data;const a=Ie.from(s.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:c}=s,f,u,h,m,d;function p(){m&&m(),d&&d(),s.cancelToken&&s.cancelToken.unsubscribe(f),s.signal&&s.signal.removeEventListener("abort",f)}let g=new XMLHttpRequest;g.open(s.method.toUpperCase(),s.url,!0),g.timeout=s.timeout;function C(){if(!g)return;const _=Ie.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),S={data:!o||o==="text"||o==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:_,config:n,request:g};Xl(function(x){t(x),p()},function(x){r(x),p()},S),g=null}"onloadend"in g?g.onloadend=C:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(C)},g.onabort=function(){g&&(r(new H("Request aborted",H.ECONNABORTED,n,g)),g=null)},g.onerror=function(){r(new H("Network Error",H.ERR_NETWORK,n,g)),g=null},g.ontimeout=function(){let b=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const S=s.transitional||Wl;s.timeoutErrorMessage&&(b=s.timeoutErrorMessage),r(new H(b,S.clarifyTimeoutError?H.ETIMEDOUT:H.ECONNABORTED,n,g)),g=null},i===void 0&&a.setContentType(null),"setRequestHeader"in g&&A.forEach(a.toJSON(),function(b,S){g.setRequestHeader(S,b)}),A.isUndefined(s.withCredentials)||(g.withCredentials=!!s.withCredentials),o&&o!=="json"&&(g.responseType=s.responseType),c&&([h,d]=fr(c,!0),g.addEventListener("progress",h)),l&&g.upload&&([u,m]=fr(l),g.upload.addEventListener("progress",u),g.upload.addEventListener("loadend",m)),(s.cancelToken||s.signal)&&(f=_=>{g&&(r(!_||_.type?new Jt(null,n,g):_),g.abort(),g=null)},s.cancelToken&&s.cancelToken.subscribe(f),s.signal&&(s.signal.aborted?f():s.signal.addEventListener("abort",f)));const w=Kd(s.url);if(w&&Ee.protocols.indexOf(w)===-1){r(new H("Unsupported protocol "+w+":",H.ERR_BAD_REQUEST,n));return}g.send(i||null)})},sh=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let r=new AbortController,s;const i=function(c){if(!s){s=!0,o();const f=c instanceof Error?c:this.reason;r.abort(f instanceof H?f:new Jt(f instanceof Error?f.message:f))}};let a=e&&setTimeout(()=>{a=null,i(new H(`timeout ${e} of ms exceeded`,H.ETIMEDOUT))},e);const o=()=>{n&&(a&&clearTimeout(a),a=null,n.forEach(c=>{c.unsubscribe?c.unsubscribe(i):c.removeEventListener("abort",i)}),n=null)};n.forEach(c=>c.addEventListener("abort",i));const{signal:l}=r;return l.unsubscribe=()=>A.asap(o),l}},ih=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let r=0,s;for(;r<t;)s=r+e,yield n.slice(r,s),r=s},ah=async function*(n,e){for await(const t of oh(n))yield*ih(t,e)},oh=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},ma=(n,e,t,r)=>{const s=ah(n,e);let i=0,a,o=l=>{a||(a=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:c,value:f}=await s.next();if(c){o(),l.close();return}let u=f.byteLength;if(t){let h=i+=u;t(h)}l.enqueue(new Uint8Array(f))}catch(c){throw o(c),c}},cancel(l){return o(l),s.return()}},{highWaterMark:2})},Or=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Gl=Or&&typeof ReadableStream=="function",lh=Or&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),Yl=(n,...e)=>{try{return!!n(...e)}catch{return!1}},ch=Gl&&Yl(()=>{let n=!1;const e=new Request(Ee.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),pa=64*1024,Ps=Gl&&Yl(()=>A.isReadableStream(new Response("").body)),dr={stream:Ps&&(n=>n.body)};Or&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!dr[e]&&(dr[e]=A.isFunction(n[e])?t=>t[e]():(t,r)=>{throw new H(`Response type '${e}' is not supported`,H.ERR_NOT_SUPPORT,r)})})})(new Response);const uh=async n=>{if(n==null)return 0;if(A.isBlob(n))return n.size;if(A.isSpecCompliantForm(n))return(await new Request(Ee.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(A.isArrayBufferView(n)||A.isArrayBuffer(n))return n.byteLength;if(A.isURLSearchParams(n)&&(n=n+""),A.isString(n))return(await lh(n)).byteLength},fh=async(n,e)=>{const t=A.toFiniteNumber(n.getContentLength());return t??uh(e)},dh=Or&&(async n=>{let{url:e,method:t,data:r,signal:s,cancelToken:i,timeout:a,onDownloadProgress:o,onUploadProgress:l,responseType:c,headers:f,withCredentials:u="same-origin",fetchOptions:h}=Kl(n);c=c?(c+"").toLowerCase():"text";let m=sh([s,i&&i.toAbortSignal()],a),d;const p=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(l&&ch&&t!=="get"&&t!=="head"&&(g=await fh(f,r))!==0){let S=new Request(e,{method:"POST",body:r,duplex:"half"}),O;if(A.isFormData(r)&&(O=S.headers.get("content-type"))&&f.setContentType(O),S.body){const[x,R]=fa(g,fr(da(l)));r=ma(S.body,pa,x,R)}}A.isString(u)||(u=u?"include":"omit");const C="credentials"in Request.prototype;d=new Request(e,{...h,signal:m,method:t.toUpperCase(),headers:f.normalize().toJSON(),body:r,duplex:"half",credentials:C?u:void 0});let w=await fetch(d);const _=Ps&&(c==="stream"||c==="response");if(Ps&&(o||_&&p)){const S={};["status","statusText","headers"].forEach(D=>{S[D]=w[D]});const O=A.toFiniteNumber(w.headers.get("content-length")),[x,R]=o&&fa(O,fr(da(o),!0))||[];w=new Response(ma(w.body,pa,x,()=>{R&&R(),p&&p()}),S)}c=c||"text";let b=await dr[A.findKey(dr,c)||"text"](w,n);return!_&&p&&p(),await new Promise((S,O)=>{Xl(S,O,{data:b,headers:Ie.from(w.headers),status:w.status,statusText:w.statusText,config:n,request:d})})}catch(C){throw p&&p(),C&&C.name==="TypeError"&&/fetch/i.test(C.message)?Object.assign(new H("Network Error",H.ERR_NETWORK,n,d),{cause:C.cause||C}):H.from(C,C&&C.code,n,d)}}),Cs={http:Cd,xhr:rh,fetch:dh};A.forEach(Cs,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const ga=n=>`- ${n}`,hh=n=>A.isFunction(n)||n===null||n===!1,Ql={getAdapter:n=>{n=A.isArray(n)?n:[n];const{length:e}=n;let t,r;const s={};for(let i=0;i<e;i++){t=n[i];let a;if(r=t,!hh(t)&&(r=Cs[(a=String(t)).toLowerCase()],r===void 0))throw new H(`Unknown adapter '${a}'`);if(r)break;s[a||"#"+i]=r}if(!r){const i=Object.entries(s).map(([o,l])=>`adapter ${o} `+(l===!1?"is not supported by the environment":"is not available in the build"));let a=e?i.length>1?`since :
`+i.map(ga).join(`
`):" "+ga(i[0]):"as no adapter specified";throw new H("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return r},adapters:Cs};function ts(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Jt(null,n)}function _a(n){return ts(n),n.headers=Ie.from(n.headers),n.data=es.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Ql.getAdapter(n.adapter||Rn.adapter)(n).then(function(r){return ts(n),r.data=es.call(n,n.transformResponse,r),r.headers=Ie.from(r.headers),r},function(r){return Jl(r)||(ts(n),r&&r.response&&(r.response.data=es.call(n,n.transformResponse,r.response),r.response.headers=Ie.from(r.response.headers))),Promise.reject(r)})}const Zl="1.7.9",Mr={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Mr[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const ya={};Mr.transitional=function(e,t,r){function s(i,a){return"[Axios v"+Zl+"] Transitional option '"+i+"'"+a+(r?". "+r:"")}return(i,a,o)=>{if(e===!1)throw new H(s(a," has been removed"+(t?" in "+t:"")),H.ERR_DEPRECATED);return t&&!ya[a]&&(ya[a]=!0,console.warn(s(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,a,o):!0}};Mr.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function mh(n,e,t){if(typeof n!="object")throw new H("options must be an object",H.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let s=r.length;for(;s-- >0;){const i=r[s],a=e[i];if(a){const o=n[i],l=o===void 0||a(o,i,n);if(l!==!0)throw new H("option "+i+" must be "+l,H.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new H("Unknown option "+i,H.ERR_BAD_OPTION)}}const Yn={assertOptions:mh,validators:Mr},Qe=Yn.validators;class Et{constructor(e){this.defaults=e,this.interceptors={request:new ca,response:new ca}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=kt(this.defaults,t);const{transitional:r,paramsSerializer:s,headers:i}=t;r!==void 0&&Yn.assertOptions(r,{silentJSONParsing:Qe.transitional(Qe.boolean),forcedJSONParsing:Qe.transitional(Qe.boolean),clarifyTimeoutError:Qe.transitional(Qe.boolean)},!1),s!=null&&(A.isFunction(s)?t.paramsSerializer={serialize:s}:Yn.assertOptions(s,{encode:Qe.function,serialize:Qe.function},!0)),Yn.assertOptions(t,{baseUrl:Qe.spelling("baseURL"),withXsrfToken:Qe.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&A.merge(i.common,i[t.method]);i&&A.forEach(["delete","get","head","post","put","patch","common"],d=>{delete i[d]}),t.headers=Ie.concat(a,i);const o=[];let l=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(t)===!1||(l=l&&p.synchronous,o.unshift(p.fulfilled,p.rejected))});const c=[];this.interceptors.response.forEach(function(p){c.push(p.fulfilled,p.rejected)});let f,u=0,h;if(!l){const d=[_a.bind(this),void 0];for(d.unshift.apply(d,o),d.push.apply(d,c),h=d.length,f=Promise.resolve(t);u<h;)f=f.then(d[u++],d[u++]);return f}h=o.length;let m=t;for(u=0;u<h;){const d=o[u++],p=o[u++];try{m=d(m)}catch(g){p.call(this,g);break}}try{f=_a.call(this,m)}catch(d){return Promise.reject(d)}for(u=0,h=c.length;u<h;)f=f.then(c[u++],c[u++]);return f}getUri(e){e=kt(this.defaults,e);const t=zl(e.baseURL,e.url);return Hl(t,e.params,e.paramsSerializer)}}A.forEach(["delete","get","head","options"],function(e){Et.prototype[e]=function(t,r){return this.request(kt(r||{},{method:e,url:t,data:(r||{}).data}))}});A.forEach(["post","put","patch"],function(e){function t(r){return function(i,a,o){return this.request(kt(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}Et.prototype[e]=t(),Et.prototype[e+"Form"]=t(!0)});class wi{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(s=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](s);r._listeners=null}),this.promise.then=s=>{let i;const a=new Promise(o=>{r.subscribe(o),i=o}).then(s);return a.cancel=function(){r.unsubscribe(i)},a},e(function(i,a,o){r.reason||(r.reason=new Jt(i,a,o),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new wi(function(s){e=s}),cancel:e}}}function ph(n){return function(t){return n.apply(null,t)}}function gh(n){return A.isObject(n)&&n.isAxiosError===!0}const Rs={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Rs).forEach(([n,e])=>{Rs[e]=n});function ec(n){const e=new Et(n),t=Ml(Et.prototype.request,e);return A.extend(t,Et.prototype,e,{allOwnKeys:!0}),A.extend(t,e,null,{allOwnKeys:!0}),t.create=function(s){return ec(kt(n,s))},t}const fe=ec(Rn);fe.Axios=Et;fe.CanceledError=Jt;fe.CancelToken=wi;fe.isCancel=Jl;fe.VERSION=Zl;fe.toFormData=xr;fe.AxiosError=H;fe.Cancel=fe.CanceledError;fe.all=function(e){return Promise.all(e)};fe.spread=ph;fe.isAxiosError=gh;fe.mergeConfig=kt;fe.AxiosHeaders=Ie;fe.formToJSON=n=>Vl(A.isHTMLForm(n)?new FormData(n):n);fe.getAdapter=Ql.getAdapter;fe.HttpStatusCode=Rs;fe.default=fe;async function wa(n){if(!n||n.length==0)return[0,0];const e={method:"POST",url:atob("aHR0cHM6Ly9hcGkuZ2Vla3NwaGVyZS5vbmxpbmUvYWRtaW4tYXBpL2FpZ2MvYmFsYW5jZS90b2tlbg=="),headers:{"content-type":"application/json"},data:{apikey:n.replace("sk-","")}};let t=await fe.request(e);return!t||t.status!=200?[0,0]:t.data.data}function _h(n){let e,t,r,s,i,a,o,l,c,f,u=new Date(n[2]).toLocaleString()+"",h,m,d,p,g,C,w;return{c(){e=P("label"),t=P("div"),r=P("span"),r.textContent="余额查询",s=I(),i=P("div"),a=_e("账 户 余 额 : "),o=_e(n[1]),l=_e(` ¥
            `),c=P("br"),f=_e(` 
            有 效 期 : `),h=_e(u),m=I(),d=P("span"),p=I(),g=P("button"),g.textContent="刷新",k(r,"class","title"),k(i,"class","b3-label__text"),k(t,"class","fn__flex-1"),k(d,"class","fn__space"),k(g,"class","b3-button b3-button--outline fn__flex-center fn__size200"),k(e,"class","item-wrap fn__flex b3-label config__item")},m(_,b){K(_,e,b),y(e,t),y(t,r),y(t,s),y(t,i),y(i,a),y(i,o),y(i,l),y(i,c),y(i,f),y(i,h),y(e,m),y(e,d),y(e,p),y(e,g),C||(w=X(g,"click",n[3]),C=!0)},p(_,[b]){b&2&&qe(o,_[1]),b&4&&u!==(u=new Date(_[2]).toLocaleString()+"")&&qe(h,u)},i:me,o:me,d(_){_&&z(e),C=!1,w()}}}function yh(n,e,t){let{apiKey:r}=e,s=0,i=0;za(()=>{wa(r).then(o=>{t(1,s=Math.round(o.money*10)/10),t(2,i=o.expiredTime*1e3)})});const a=async()=>{wa(r).then(o=>{t(2,i=o.expiredTime*1e3),t(1,s=Math.round(o.money*10)/10)})};return n.$$set=o=>{"apiKey"in o&&t(0,r=o.apiKey)},[r,s,i,a]}let wh=class extends Pe{constructor(e){super(),ve(this,e,yh,_h,ke,{apiKey:0})}};function ba(n,e,t){const r=n.slice();return r[11]=e[t],r[12]=e,r[13]=t,r}function bh(n){var a,o,l,c;let e,t,r;function s(f){n[8](f,n[11])}let i={type:n[11].type,key:n[11].key,placeholder:(a=n[11])==null?void 0:a.placeholder,options:(o=n[11])==null?void 0:o.options,slider:(l=n[11])==null?void 0:l.slider,button:(c=n[11])==null?void 0:c.button};return n[11].value!==void 0&&(i.value=n[11].value),e=new Ol.Input({props:i}),ye.push(()=>Ue(e,"value",s)),e.$on("click",n[4]),e.$on("changed",n[5]),{c(){ue(e.$$.fragment)},m(f,u){le(e,f,u),r=!0},p(f,u){var m,d,p,g;n=f;const h={};u&4&&(h.type=n[11].type),u&4&&(h.key=n[11].key),u&4&&(h.placeholder=(m=n[11])==null?void 0:m.placeholder),u&4&&(h.options=(d=n[11])==null?void 0:d.options),u&4&&(h.slider=(p=n[11])==null?void 0:p.slider),u&4&&(h.button=(g=n[11])==null?void 0:g.button),!t&&u&4&&(t=!0,h.value=n[11].value,$e(()=>t=!1)),e.$set(h)},i(f){r||(q(e.$$.fragment,f),r=!0)},o(f){W(e.$$.fragment,f),r=!1},d(f){ce(e,f)}}}function Sa(n,e){var i;let t,r,s;return r=new Ol.Wrap({props:{title:e[11].title,description:e[11].description,direction:(i=e[11])==null?void 0:i.direction,$$slots:{default:[bh]},$$scope:{ctx:e}}}),{key:n,first:null,c(){t=Fs(),ue(r.$$.fragment),this.first=t},m(a,o){K(a,t,o),le(r,a,o),s=!0},p(a,o){var c;e=a;const l={};o&4&&(l.title=e[11].title),o&4&&(l.description=e[11].description),o&4&&(l.direction=(c=e[11])==null?void 0:c.direction),o&516&&(l.$$scope={dirty:o,ctx:e}),r.$set(l)},i(a){s||(q(r.$$.fragment,a),s=!0)},o(a){W(r.$$.fragment,a),s=!1},d(a){a&&z(t),ce(r,a)}}}function Ea(n){let e,t;return e=new wh({props:{apiKey:n[1].getValue("apiKey")}}),{c(){ue(e.$$.fragment)},m(r,s){le(e,r,s),t=!0},p(r,s){const i={};s&2&&(i.apiKey=r[1].getValue("apiKey")),e.$set(i)},i(r){t||(q(e.$$.fragment,r),t=!0)},o(r){W(e.$$.fragment,r),t=!1},d(r){ce(e,r)}}}function Sh(n){let e,t,r=[],s=new Map,i,a,o;const l=n[7].default,c=xs(l,n,n[9],null);let f=Te(n[2]);const u=m=>m[11].key;for(let m=0;m<f.length;m+=1){let d=ba(n,f,m),p=u(d);s.set(p,r[m]=Sa(p,d))}let h=n[0]==="🌈 设置"&&Ea(n);return{c(){e=P("div"),c&&c.c(),t=I();for(let m=0;m<r.length;m+=1)r[m].c();i=I(),h&&h.c(),k(e,"class",a="config__tab-container "+n[3]),k(e,"data-name",n[0])},m(m,d){K(m,e,d),c&&c.m(e,null),y(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(e,null);y(e,i),h&&h.m(e,null),o=!0},p(m,[d]){c&&c.p&&(!o||d&512)&&Ms(c,l,m,m[9],o?Os(l,m[9],d,null):Ts(m[9]),null),d&52&&(f=Te(m[2]),bt(),r=Ga(r,d,u,1,m,f,s,e,Nc,Sa,i,ba),St()),m[0]==="🌈 设置"?h?(h.p(m,d),d&1&&q(h,1)):(h=Ea(m),h.c(),q(h,1),h.m(e,null)):h&&(bt(),W(h,1,1,()=>{h=null}),St()),(!o||d&8&&a!==(a="config__tab-container "+m[3]))&&k(e,"class",a),(!o||d&1)&&k(e,"data-name",m[0])},i(m){if(!o){q(c,m);for(let d=0;d<f.length;d+=1)q(r[d]);q(h),o=!0}},o(m){W(c,m);for(let d=0;d<r.length;d+=1)W(r[d]);W(h),o=!1},d(m){m&&z(e),c&&c.d(m);for(let d=0;d<r.length;d+=1)r[d].d();h&&h.d()}}}function Eh(n,e,t){let r,{$$slots:s={},$$scope:i}=e,{group:a}=e,{settingStorage:o}=e,{display:l=!0}=e,c=o.getSettingItems(a);const f=mr();function u({detail:d}){f("click",{key:d.key})}function h({detail:d}){f("changed",{group:a,...d})}function m(d,p){n.$$.not_equal(p.value,d)&&(p.value=d,t(2,c))}return n.$$set=d=>{"group"in d&&t(0,a=d.group),"settingStorage"in d&&t(1,o=d.settingStorage),"display"in d&&t(6,l=d.display),"$$scope"in d&&t(9,i=d.$$scope)},n.$$.update=()=>{n.$$.dirty&64&&t(3,r=l?"":"fn__none")},[a,o,c,r,u,h,l,s,m,i]}class tc extends Pe{constructor(e){super(),ve(this,e,Eh,Sh,ke,{group:0,settingStorage:1,display:6})}}function Ah(n){let e,t,r;return t=new tc({props:{group:"custom",settingStorage:n[0],display:!0}}),t.$on("changed",n[1]),{c(){e=P("div"),ue(t.$$.fragment),M(e,"margin-top","10px"),M(e,"padding","10px"),M(e,"background","none"),M(e,"border-radius","4px"),M(e,"border","1px solid var(--b3-border-color)")},m(s,i){K(s,e,i),le(t,e,null),r=!0},p(s,[i]){const a={};i&1&&(a.settingStorage=s[0]),t.$set(a)},i(s){r||(q(t.$$.fragment,s),r=!0)},o(s){W(t.$$.fragment,s),r=!1},d(s){s&&z(e),ce(t)}}}function kh(n,e,t){let{settingStorage:r}=e;const s=({detail:i})=>{r.setValue(i.key,i.value),r.save()};return n.$$set=i=>{"settingStorage"in i&&t(0,r=i.settingStorage)},[r,s]}class vh extends Pe{constructor(e){super(),ve(this,e,kh,Ah,ke,{settingStorage:0})}}function Ph(){var t;let n=((t=window.getSelection())==null?void 0:t.toString())||"";return n||(document.querySelectorAll(".protyle-wysiwyg--select").forEach(r=>{const s=r.textContent;n+=`
`+s}),n)}function Ch(){let n="",e="";return n=document.getElementsByClassName("protyle-title__input")[0].textContent,document.querySelectorAll("[data-node-index]").forEach(r=>{e+=r.textContent+`
`}),{title:n,content:e}}async function Rh(n){const e=document.querySelectorAll(".protyle-wysiwyg--select");if(e.length===0){console.warn("没有选中的内容");return}let r=e[e.length-1].getAttribute("data-node-id");if(!r){console.warn("无法获取节点ID");return}const s=await ac("markdown","",r);for(const i of e)await lc(i.getAttribute("data-node-id"));await oc("markdown",n,s[0].doOperations[0].id)}async function xh(n,e,t,r,s){let i="";const a=await n.messages.stream({model:e,max_tokens:t,messages:r});for await(const o of a)if(o.type==="content_block_delta"){const l="text"in o.delta?o.delta.text:o.delta.toString();i+=l,s(i)}return i}async function Oh(n,e,t,r,s,i){var l,c,f;let a="";const o=await n.chat.completions.create({model:e,max_tokens:t,temperature:r,stream:!0,messages:s});for await(const u of o)if((f=(c=(l=u.choices)==null?void 0:l[0])==null?void 0:c.delta)!=null&&f.content){const h=u.choices[0].delta.content;a+=h,i(a)}return a}async function Mh(n,e=!1,t=!1){if(window.focus(),await navigator.clipboard.writeText(n),e&&t){Rh(n);return}$a("生成内容已自动复制到剪贴板")}async function nc(n,e,t,r,s,i,a){var l,c;let o="";try{const f=(l=r.get("maxOutputLength"))==null?void 0:l.value;switch(!0){case t.includes("claude"):o=await xh(e,t,f,s,a);break;default:const u=(c=r.get("temperature"))==null?void 0:c.value;o=await Oh(n,t,f,u,s,a);break}return o}catch(f){console.error("生成回答时出错:",f);const u=`
生成回答时出错: `+f.message;return o+=u,a(o),o}finally{await Mh(o,i,r.getValue("isReplaceSelected"))}}function Th(n){let e,t,r,s,i,a=[{type:"button"},n[4],{class:r=["b3-button",n[3],n[2]].join(" ")},{style:n[1]}],o={};for(let l=0;l<a.length;l+=1)o=Qn(o,a[l]);return{c(){e=P("button"),t=_e(n[0]),Ei(e,o)},m(l,c){K(l,e,c),y(e,t),e.autofocus&&e.focus(),s||(i=X(e,"click",n[8]),s=!0)},p(l,[c]){c&1&&bc(t,l[0],o.contenteditable),Ei(e,o=Dc(a,[{type:"button"},c&16&&l[4],c&12&&r!==(r=["b3-button",l[3],l[2]].join(" "))&&{class:r},c&2&&{style:l[1]}]))},i:me,o:me,d(l){l&&z(e),s=!1,i()}}}function Ih(n,e,t){let r,s,i,{text:a=!1}=e,{outline:o=!1}=e,{backgroundColor:l=void 0}=e,{label:c=""}=e;function f(u){Cc.call(this,n,u)}return n.$$set=u=>{t(4,e=Qn(Qn({},e),Si(u))),"text"in u&&t(5,a=u.text),"outline"in u&&t(6,o=u.outline),"backgroundColor"in u&&t(7,l=u.backgroundColor),"label"in u&&t(0,c=u.label)},n.$$.update=()=>{n.$$.dirty&64&&t(3,r=o?"b3-button--outline":""),n.$$.dirty&32&&t(2,s=a?"b3-button--text":""),n.$$.dirty&128&&t(1,i=l?`background-color: ${l}`:"")},e=Si(e),[c,i,s,r,e,a,o,l,f]}class hr extends Pe{constructor(e){super(),ve(this,e,Ih,Th,ke,{text:5,outline:6,backgroundColor:7,label:0})}}function Fh(n){let e,t,r,s=n[1].title?"编辑提示词":"新增提示词",i,a,o,l,c,f,u,h,m,d,p,g,C,w,_;function b(R){n[3](R)}let S={type:"textinput",placeholder:"标题",key:"title",style:"width: 100%; margin-bottom: 10px;"};n[1].title!==void 0&&(S.value=n[1].title),o=new cr({props:S}),ye.push(()=>Ue(o,"value",b));function O(R){n[4](R)}let x={type:"textarea",placeholder:"内容",key:"content",style:"width: 100%; white-space: pre-wrap; word-wrap: break-word;"};return n[1].content!==void 0&&(x.value=n[1].content),f=new cr({props:x}),ye.push(()=>Ue(f,"value",O)),d=new hr({props:{label:"取消",text:!0,outline:!0}}),d.$on("click",n[5]),w=new hr({props:{label:"确认",text:!1,outline:!1}}),w.$on("click",n[6]),{c(){e=P("div"),t=P("div"),r=P("h3"),i=_e(s),a=I(),ue(o.$$.fragment),c=I(),ue(f.$$.fragment),h=I(),m=P("div"),ue(d.$$.fragment),p=I(),g=P("div"),C=I(),ue(w.$$.fragment),k(r,"class","b3-label"),k(g,"class","fn__space"),k(m,"class","b3-dialog__action"),k(t,"class","edit-content svelte-1ftxwb0"),k(e,"class","edit-panel svelte-1ftxwb0")},m(R,D){K(R,e,D),y(e,t),y(t,r),y(r,i),y(t,a),le(o,t,null),y(t,c),le(f,t,null),y(t,h),y(t,m),le(d,m,null),y(m,p),y(m,g),y(m,C),le(w,m,null),_=!0},p(R,[D]){(!_||D&2)&&s!==(s=R[1].title?"编辑提示词":"新增提示词")&&qe(i,s);const E={};!l&&D&2&&(l=!0,E.value=R[1].title,$e(()=>l=!1)),o.$set(E);const v={};!u&&D&2&&(u=!0,v.value=R[1].content,$e(()=>u=!1)),f.$set(v)},i(R){_||(q(o.$$.fragment,R),q(f.$$.fragment,R),q(d.$$.fragment,R),q(w.$$.fragment,R),_=!0)},o(R){W(o.$$.fragment,R),W(f.$$.fragment,R),W(d.$$.fragment,R),W(w.$$.fragment,R),_=!1},d(R){R&&z(e),ce(o),ce(f),ce(d),ce(w)}}}function Nh(n,e,t){let{showEditPanel:r=!1}=e,{currentPrompt:s}=e;const i=mr();function a(f){n.$$.not_equal(s.title,f)&&(s.title=f,t(1,s))}function o(f){n.$$.not_equal(s.content,f)&&(s.content=f,t(1,s))}const l=()=>t(0,r=!1),c=()=>i("save");return n.$$set=f=>{"showEditPanel"in f&&t(0,r=f.showEditPanel),"currentPrompt"in f&&t(1,s=f.currentPrompt)},[r,s,i,a,o,l,c]}class Dh extends Pe{constructor(e){super(),ve(this,e,Nh,Fh,ke,{showEditPanel:0,currentPrompt:1})}}function Aa(n,e,t){const r=n.slice();return r[5]=e[t],r}function ka(n,e){let t,r,s,i=e[5].title+"",a,o,l,c,f,u,h,m,d,p,g;function C(){return e[2](e[5])}function w(){return e[3](e[5])}function _(){return e[4](e[5])}return{key:n,first:null,c(){t=P("div"),r=P("div"),s=P("span"),a=_e(i),o=I(),l=P("div"),c=P("button"),c.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconTrashcan"></use></svg>',f=I(),u=P("button"),u.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconEdit"></use></svg>',h=I(),m=P("button"),m.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconPlay"></use></svg>',d=I(),k(s,"class","title"),k(r,"class","fn__flex-1"),k(c,"class","b3-list-item"),k(c,"title","删除"),k(u,"class","b3-list-item"),k(u,"title","编辑"),k(m,"class","b3-list-item"),k(m,"title","使用"),k(l,"class","fn__flex"),k(t,"class","item-wrap fn__flex b3-label config__item prompt-item svelte-1706rdx"),M(t,"height","1.5em"),this.first=t},m(b,S){K(b,t,S),y(t,r),y(r,s),y(s,a),y(t,o),y(t,l),y(l,c),y(l,f),y(l,u),y(l,h),y(l,m),y(t,d),p||(g=[X(c,"click",C),X(u,"click",w),X(m,"click",_)],p=!0)},p(b,S){e=b,S&1&&i!==(i=e[5].title+"")&&qe(a,i)},d(b){b&&z(t),p=!1,we(g)}}}function Bh(n){let e,t=[],r=new Map,s=Te(n[0]);const i=a=>a[5].id;for(let a=0;a<s.length;a+=1){let o=Aa(n,s,a),l=i(o);r.set(l,t[a]=ka(l,o))}return{c(){e=P("div");for(let a=0;a<t.length;a+=1)t[a].c();k(e,"class","b3-tab-bar b3-list b3-list--background")},m(a,o){K(a,e,o);for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(e,null)},p(a,[o]){o&3&&(s=Te(a[0]),t=Ga(t,o,i,1,a,s,r,e,Fc,ka,null,Aa))},i:me,o:me,d(a){a&&z(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function Lh(n,e,t){const r=mr();let{prompts:s}=e;const i=l=>r("delete",l.id),a=l=>r("edit",l),o=l=>r("use",l);return n.$$set=l=>{"prompts"in l&&t(0,s=l.prompts)},[s,r,i,a,o]}class $h extends Pe{constructor(e){super(),ve(this,e,Lh,Bh,ke,{prompts:0})}}function va(n){let e,t,r,s;function i(l){n[14](l)}function a(l){n[15](l)}let o={};return n[0]!==void 0&&(o.showEditPanel=n[0]),n[1]!==void 0&&(o.currentPrompt=n[1]),e=new Dh({props:o}),ye.push(()=>Ue(e,"showEditPanel",i)),ye.push(()=>Ue(e,"currentPrompt",a)),e.$on("save",n[6]),{c(){ue(e.$$.fragment)},m(l,c){le(e,l,c),s=!0},p(l,c){const f={};!t&&c&1&&(t=!0,f.showEditPanel=l[0],$e(()=>t=!1)),!r&&c&2&&(r=!0,f.currentPrompt=l[1],$e(()=>r=!1)),e.$set(f)},i(l){s||(q(e.$$.fragment,l),s=!0)},o(l){W(e.$$.fragment,l),s=!1},d(l){ce(e,l)}}}function Uh(n){let e,t,r,s,i,a,o,l;s=new $h({props:{prompts:n[2]}}),s.$on("edit",n[11]),s.$on("delete",n[12]),s.$on("use",n[13]);let c=n[0]&&va(n);return{c(){e=P("div"),t=P("button"),t.textContent="+ 新建 Prompt",r=I(),ue(s.$$.fragment),i=I(),c&&c.c(),k(t,"class","add-prompt-btn"),M(t,"width","90%"),M(t,"margin","8px auto"),M(t,"display","block"),M(t,"padding","4px 8px"),M(t,"border-radius","4px"),M(t,"border","none"),M(t,"cursor","pointer"),M(t,"background","var(--b3-theme-surface)"),M(t,"color","var(--b3-theme-on-surface)"),M(e,"background","none"),M(e,"border-radius","4px"),M(e,"max-height","300px"),M(e,"overflow-y","auto")},m(f,u){K(f,e,u),y(e,t),y(e,r),le(s,e,null),y(e,i),c&&c.m(e,null),a=!0,o||(l=X(t,"click",n[10]),o=!0)},p(f,[u]){const h={};u&4&&(h.prompts=f[2]),s.$set(h),f[0]?c?(c.p(f,u),u&1&&q(c,1)):(c=va(f),c.c(),q(c,1),c.m(e,null)):c&&(bt(),W(c,1,1,()=>{c=null}),St())},i(f){a||(q(s.$$.fragment,f),q(c),a=!0)},o(f){W(s.$$.fragment,f),W(c),a=!1},d(f){f&&z(e),ce(s),c&&c.d(),o=!1,l()}}}function jh(n,e,t){let r,{promptStorage:s}=e,{searchText:i}=e,a=!1,o={id:Date.now(),title:"",content:""},l=s.prompts;function c(_){s.deletePrompt(_),t(9,l=s.prompts)}function f(_){_?t(1,o={..._}):t(1,o={id:Date.now(),title:"",content:""}),t(0,a=!0)}function u(_){t(7,i=_.content)}function h(){l.findIndex(b=>b.id===o.id)===-1?s.addPrompt(o):s.updatePrompt(o),s.save(l),t(0,a=!1),t(9,l=s.prompts)}const m=()=>f(),d=_=>f(_.detail),p=_=>c(_.detail),g=_=>u(_.detail);function C(_){a=_,t(0,a)}function w(_){o=_,t(1,o)}return n.$$set=_=>{"promptStorage"in _&&t(8,s=_.promptStorage),"searchText"in _&&t(7,i=_.searchText)},n.$$.update=()=>{n.$$.dirty&640&&t(2,r=l.filter(_=>_.title.toLowerCase().includes(i.slice(1).toLowerCase())||_.content.toLowerCase().includes(i.slice(1).toLowerCase())))},[a,o,r,c,f,u,h,i,s,l,m,d,p,g,C,w]}class qh extends Pe{constructor(e){super(),ve(this,e,jh,Uh,ke,{promptStorage:8,searchText:7})}}function Pa(n){let e,t,r;function s(a){n[17](a)}let i={outputContent:n[7],isGenerating:n[8]};return n[9]!==void 0&&(i.outputContainer=n[9]),e=new kf({props:i}),ye.push(()=>Ue(e,"outputContainer",s)),{c(){ue(e.$$.fragment)},m(a,o){le(e,a,o),r=!0},p(a,o){const l={};o&128&&(l.outputContent=a[7]),o&256&&(l.isGenerating=a[8]),!t&&o&512&&(t=!0,l.outputContainer=a[9],$e(()=>t=!1)),e.$set(l)},i(a){r||(q(e.$$.fragment,a),r=!0)},o(a){W(e.$$.fragment,a),r=!1},d(a){ce(e,a)}}}function Ca(n){let e,t;return e=new vh({props:{settingStorage:n[1]}}),{c(){ue(e.$$.fragment)},m(r,s){le(e,r,s),t=!0},p(r,s){const i={};s&2&&(i.settingStorage=r[1]),e.$set(i)},i(r){t||(q(e.$$.fragment,r),t=!0)},o(r){W(e.$$.fragment,r),t=!1},d(r){ce(e,r)}}}function Ra(n){let e,t,r,s;function i(l){n[22](l)}function a(l){n[23](l)}let o={};return n[2]!==void 0&&(o.searchText=n[2]),n[0]!==void 0&&(o.promptStorage=n[0]),e=new qh({props:o}),ye.push(()=>Ue(e,"searchText",i)),ye.push(()=>Ue(e,"promptStorage",a)),{c(){ue(e.$$.fragment)},m(l,c){le(e,l,c),s=!0},p(l,c){const f={};!t&&c&4&&(t=!0,f.searchText=l[2],$e(()=>t=!1)),!r&&c&1&&(r=!0,f.promptStorage=l[0],$e(()=>r=!1)),e.$set(f)},i(l){s||(q(e.$$.fragment,l),s=!0)},o(l){W(e.$$.fragment,l),s=!1},d(l){ce(e,l)}}}function Hh(n){let e,t,r,s,i,a,o,l,c,f,u,h=n[6]&&Pa(n);function m(b){n[18](b)}function d(b){n[19](b)}function p(b){n[20](b)}function g(b){n[21](b)}let C={settingStorage:n[1],handleSubmit:n[11],handleKeydown:n[12]};n[2]!==void 0&&(C.inputValue=n[2]),n[4]!==void 0&&(C.inputElement=n[4]),n[5]!==void 0&&(C.selectedModel=n[5]),n[3]!==void 0&&(C.showParams=n[3]),r=new Df({props:C}),ye.push(()=>Ue(r,"inputValue",m)),ye.push(()=>Ue(r,"inputElement",d)),ye.push(()=>Ue(r,"selectedModel",p)),ye.push(()=>Ue(r,"showParams",g));let w=n[3]&&Ca(n),_=n[10]&&Ra(n);return{c(){e=P("div"),h&&h.c(),t=I(),ue(r.$$.fragment),l=I(),c=P("div"),w&&w.c(),f=I(),_&&_.c(),M(c,"width","100%"),M(e,"width","100%")},m(b,S){K(b,e,S),h&&h.m(e,null),y(e,t),le(r,e,null),y(e,l),y(e,c),w&&w.m(c,null),y(c,f),_&&_.m(c,null),u=!0},p(b,[S]){b[6]?h?(h.p(b,S),S&64&&q(h,1)):(h=Pa(b),h.c(),q(h,1),h.m(e,t)):h&&(bt(),W(h,1,1,()=>{h=null}),St());const O={};S&2&&(O.settingStorage=b[1]),!s&&S&4&&(s=!0,O.inputValue=b[2],$e(()=>s=!1)),!i&&S&16&&(i=!0,O.inputElement=b[4],$e(()=>i=!1)),!a&&S&32&&(a=!0,O.selectedModel=b[5],$e(()=>a=!1)),!o&&S&8&&(o=!0,O.showParams=b[3],$e(()=>o=!1)),r.$set(O),b[3]?w?(w.p(b,S),S&8&&q(w,1)):(w=Ca(b),w.c(),q(w,1),w.m(c,f)):w&&(bt(),W(w,1,1,()=>{w=null}),St()),b[10]?_?(_.p(b,S),S&1024&&q(_,1)):(_=Ra(b),_.c(),q(_,1),_.m(c,null)):_&&(bt(),W(_,1,1,()=>{_=null}),St())},i(b){u||(q(h),q(r.$$.fragment,b),q(w),q(_),u=!0)},o(b){W(h),W(r.$$.fragment,b),W(w),W(_),u=!1},d(b){b&&z(e),h&&h.d(),ce(r),w&&w.d(),_&&_.d()}}}function Wh(n,e,t){let r,{openai:s}=e,{claude:i}=e,{settingStorage:a}=e,{promptStorage:o}=e,{selectedText:l}=e,{pageContent:c}=e,f="",u,h=!1,m=a.getValue("modelSelections"),d=!1,p="",g=!1,C;async function w(){t(6,d=!0),t(8,g=!0),t(7,p="");let v=f.startsWith("/")?f.slice(1):f,se=[];const Ce=l.trim().length>0;Ce?se.push({role:"user",content:`${l}

${v}`}):a.getValue("isPageContent")?se.push({role:"user",content:`${c.title}

${c.content}

${v}`}):se.push({role:"user",content:`${v}`});try{await nc(s,i,m,a,se,Ce,B=>{t(7,p=B),C&&t(9,C.scrollTop=C.scrollHeight,C)})}finally{t(8,g=!1)}}function _(v){v.key==="Enter"?w():v.key==="Escape"&&console.debug("ai指令取消")}za(()=>{u.focus()});function b(v){C=v,t(9,C)}function S(v){f=v,t(2,f)}function O(v){u=v,t(4,u)}function x(v){m=v,t(5,m)}function R(v){h=v,t(3,h)}function D(v){f=v,t(2,f)}function E(v){o=v,t(0,o)}return n.$$set=v=>{"openai"in v&&t(13,s=v.openai),"claude"in v&&t(14,i=v.claude),"settingStorage"in v&&t(1,a=v.settingStorage),"promptStorage"in v&&t(0,o=v.promptStorage),"selectedText"in v&&t(15,l=v.selectedText),"pageContent"in v&&t(16,c=v.pageContent)},n.$$.update=()=>{n.$$.dirty&12&&t(10,r=f.trim().startsWith("/")&&!h)},[o,a,f,h,u,m,d,p,g,C,r,w,_,s,i,l,c,b,S,O,x,R,D,E]}class Vh extends Pe{constructor(e){super(),ve(this,e,Wh,Hh,ke,{openai:13,claude:14,settingStorage:1,promptStorage:0,selectedText:15,pageContent:16})}}var Jh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xh(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var rc={exports:{}};(function(n,e){(function(t,r){n.exports=r()})(Jh,function(){var t=1e3,r=6e4,s=36e5,i="millisecond",a="second",o="minute",l="hour",c="day",f="week",u="month",h="quarter",m="year",d="date",p="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,C=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,w={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(B){var F=["th","st","nd","rd"],T=B%100;return"["+B+(F[(T-20)%10]||F[T]||F[0])+"]"}},_=function(B,F,T){var L=String(B);return!L||L.length>=F?B:""+Array(F+1-L.length).join(T)+B},b={s:_,z:function(B){var F=-B.utcOffset(),T=Math.abs(F),L=Math.floor(T/60),N=T%60;return(F<=0?"+":"-")+_(L,2,"0")+":"+_(N,2,"0")},m:function B(F,T){if(F.date()<T.date())return-B(T,F);var L=12*(T.year()-F.year())+(T.month()-F.month()),N=F.clone().add(L,u),U=T-N<0,j=F.clone().add(L+(U?-1:1),u);return+(-(L+(T-N)/(U?N-j:j-N))||0)},a:function(B){return B<0?Math.ceil(B)||0:Math.floor(B)},p:function(B){return{M:u,y:m,w:f,d:c,D:d,h:l,m:o,s:a,ms:i,Q:h}[B]||String(B||"").toLowerCase().replace(/s$/,"")},u:function(B){return B===void 0}},S="en",O={};O[S]=w;var x="$isDayjsObject",R=function(B){return B instanceof se||!(!B||!B[x])},D=function B(F,T,L){var N;if(!F)return S;if(typeof F=="string"){var U=F.toLowerCase();O[U]&&(N=U),T&&(O[U]=T,N=U);var j=F.split("-");if(!N&&j.length>1)return B(j[0])}else{var Y=F.name;O[Y]=F,N=Y}return!L&&N&&(S=N),N||!L&&S},E=function(B,F){if(R(B))return B.clone();var T=typeof F=="object"?F:{};return T.date=B,T.args=arguments,new se(T)},v=b;v.l=D,v.i=R,v.w=function(B,F){return E(B,{locale:F.$L,utc:F.$u,x:F.$x,$offset:F.$offset})};var se=function(){function B(T){this.$L=D(T.locale,null,!0),this.parse(T),this.$x=this.$x||T.x||{},this[x]=!0}var F=B.prototype;return F.parse=function(T){this.$d=function(L){var N=L.date,U=L.utc;if(N===null)return new Date(NaN);if(v.u(N))return new Date;if(N instanceof Date)return new Date(N);if(typeof N=="string"&&!/Z$/i.test(N)){var j=N.match(g);if(j){var Y=j[2]-1||0,Z=(j[7]||"0").substring(0,3);return U?new Date(Date.UTC(j[1],Y,j[3]||1,j[4]||0,j[5]||0,j[6]||0,Z)):new Date(j[1],Y,j[3]||1,j[4]||0,j[5]||0,j[6]||0,Z)}}return new Date(N)}(T),this.init()},F.init=function(){var T=this.$d;this.$y=T.getFullYear(),this.$M=T.getMonth(),this.$D=T.getDate(),this.$W=T.getDay(),this.$H=T.getHours(),this.$m=T.getMinutes(),this.$s=T.getSeconds(),this.$ms=T.getMilliseconds()},F.$utils=function(){return v},F.isValid=function(){return this.$d.toString()!==p},F.isSame=function(T,L){var N=E(T);return this.startOf(L)<=N&&N<=this.endOf(L)},F.isAfter=function(T,L){return E(T)<this.startOf(L)},F.isBefore=function(T,L){return this.endOf(L)<E(T)},F.$g=function(T,L,N){return v.u(T)?this[L]:this.set(N,T)},F.unix=function(){return Math.floor(this.valueOf()/1e3)},F.valueOf=function(){return this.$d.getTime()},F.startOf=function(T,L){var N=this,U=!!v.u(L)||L,j=v.p(T),Y=function(ht,xe){var it=v.w(N.$u?Date.UTC(N.$y,xe,ht):new Date(N.$y,xe,ht),N);return U?it:it.endOf(c)},Z=function(ht,xe){return v.w(N.toDate()[ht].apply(N.toDate("s"),(U?[0,0,0,0]:[23,59,59,999]).slice(xe)),N)},ae=this.$W,oe=this.$M,pe=this.$D,Ge="set"+(this.$u?"UTC":"");switch(j){case m:return U?Y(1,0):Y(31,11);case u:return U?Y(1,oe):Y(0,oe+1);case f:var dt=this.$locale().weekStart||0,Xt=(ae<dt?ae+7:ae)-dt;return Y(U?pe-Xt:pe+(6-Xt),oe);case c:case d:return Z(Ge+"Hours",0);case l:return Z(Ge+"Minutes",1);case o:return Z(Ge+"Seconds",2);case a:return Z(Ge+"Milliseconds",3);default:return this.clone()}},F.endOf=function(T){return this.startOf(T,!1)},F.$set=function(T,L){var N,U=v.p(T),j="set"+(this.$u?"UTC":""),Y=(N={},N[c]=j+"Date",N[d]=j+"Date",N[u]=j+"Month",N[m]=j+"FullYear",N[l]=j+"Hours",N[o]=j+"Minutes",N[a]=j+"Seconds",N[i]=j+"Milliseconds",N)[U],Z=U===c?this.$D+(L-this.$W):L;if(U===u||U===m){var ae=this.clone().set(d,1);ae.$d[Y](Z),ae.init(),this.$d=ae.set(d,Math.min(this.$D,ae.daysInMonth())).$d}else Y&&this.$d[Y](Z);return this.init(),this},F.set=function(T,L){return this.clone().$set(T,L)},F.get=function(T){return this[v.p(T)]()},F.add=function(T,L){var N,U=this;T=Number(T);var j=v.p(L),Y=function(oe){var pe=E(U);return v.w(pe.date(pe.date()+Math.round(oe*T)),U)};if(j===u)return this.set(u,this.$M+T);if(j===m)return this.set(m,this.$y+T);if(j===c)return Y(1);if(j===f)return Y(7);var Z=(N={},N[o]=r,N[l]=s,N[a]=t,N)[j]||1,ae=this.$d.getTime()+T*Z;return v.w(ae,this)},F.subtract=function(T,L){return this.add(-1*T,L)},F.format=function(T){var L=this,N=this.$locale();if(!this.isValid())return N.invalidDate||p;var U=T||"YYYY-MM-DDTHH:mm:ssZ",j=v.z(this),Y=this.$H,Z=this.$m,ae=this.$M,oe=N.weekdays,pe=N.months,Ge=N.meridiem,dt=function(xe,it,zt,xn){return xe&&(xe[it]||xe(L,U))||zt[it].slice(0,xn)},Xt=function(xe){return v.s(Y%12||12,xe,"0")},ht=Ge||function(xe,it,zt){var xn=xe<12?"AM":"PM";return zt?xn.toLowerCase():xn};return U.replace(C,function(xe,it){return it||function(zt){switch(zt){case"YY":return String(L.$y).slice(-2);case"YYYY":return v.s(L.$y,4,"0");case"M":return ae+1;case"MM":return v.s(ae+1,2,"0");case"MMM":return dt(N.monthsShort,ae,pe,3);case"MMMM":return dt(pe,ae);case"D":return L.$D;case"DD":return v.s(L.$D,2,"0");case"d":return String(L.$W);case"dd":return dt(N.weekdaysMin,L.$W,oe,2);case"ddd":return dt(N.weekdaysShort,L.$W,oe,3);case"dddd":return oe[L.$W];case"H":return String(Y);case"HH":return v.s(Y,2,"0");case"h":return Xt(1);case"hh":return Xt(2);case"a":return ht(Y,Z,!0);case"A":return ht(Y,Z,!1);case"m":return String(Z);case"mm":return v.s(Z,2,"0");case"s":return String(L.$s);case"ss":return v.s(L.$s,2,"0");case"SSS":return v.s(L.$ms,3,"0");case"Z":return j}return null}(xe)||j.replace(":","")})},F.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},F.diff=function(T,L,N){var U,j=this,Y=v.p(L),Z=E(T),ae=(Z.utcOffset()-this.utcOffset())*r,oe=this-Z,pe=function(){return v.m(j,Z)};switch(Y){case m:U=pe()/12;break;case u:U=pe();break;case h:U=pe()/3;break;case f:U=(oe-ae)/6048e5;break;case c:U=(oe-ae)/864e5;break;case l:U=oe/s;break;case o:U=oe/r;break;case a:U=oe/t;break;default:U=oe}return N?U:v.a(U)},F.daysInMonth=function(){return this.endOf(u).$D},F.$locale=function(){return O[this.$L]},F.locale=function(T,L){if(!T)return this.$L;var N=this.clone(),U=D(T,L,!0);return U&&(N.$L=U),N},F.clone=function(){return v.w(this.$d,this)},F.toDate=function(){return new Date(this.valueOf())},F.toJSON=function(){return this.isValid()?this.toISOString():null},F.toISOString=function(){return this.$d.toISOString()},F.toString=function(){return this.$d.toUTCString()},B}(),Ce=se.prototype;return E.prototype=Ce,[["$ms",i],["$s",a],["$m",o],["$H",l],["$W",c],["$M",u],["$y",m],["$D",d]].forEach(function(B){Ce[B[1]]=function(F){return this.$g(F,B[0],B[1])}}),E.extend=function(B,F){return B.$i||(B(F,se,E),B.$i=!0),E},E.locale=D,E.isDayjs=R,E.unix=function(B){return E(1e3*B)},E.en=O[S],E.Ls=O,E.p={},E})})(rc);var zh=rc.exports;const xa=Xh(zh);function Oa(n,e,t){const r=n.slice();return r[23]=e[t],r}function Ma(n,e,t){const r=n.slice();return r[26]=e[t],r}function Ta(n,e,t){const r=n.slice();return r[29]=e[t],r}function Ia(n){let e,t,r,s=n[29].title+"",i,a,o,l=n[29].time+"",c,f,u,h,m,d;function p(){return n[14](n[29])}function g(){return n[15](n[29])}return{c(){e=P("div"),t=P("button"),r=P("span"),i=_e(s),a=I(),o=P("div"),c=_e(l),f=I(),u=P("button"),u.innerHTML='<svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none"><path d="M18 6L6 18M6 6l12 12"></path></svg>',h=I(),k(r,"class","svelte-6o9xp3"),k(o,"class","time svelte-6o9xp3"),k(t,"class","history-content svelte-6o9xp3"),k(u,"class","delete-btn svelte-6o9xp3"),k(u,"title","删除对话"),k(e,"class","history-item svelte-6o9xp3")},m(C,w){K(C,e,w),y(e,t),y(t,r),y(r,i),y(t,a),y(t,o),y(o,c),y(e,f),y(e,u),y(e,h),m||(d=[X(t,"click",p),X(u,"click",gc(g))],m=!0)},p(C,w){n=C,w[0]&1&&s!==(s=n[29].title+"")&&qe(i,s),w[0]&1&&l!==(l=n[29].time+"")&&qe(c,l)},d(C){C&&z(e),m=!1,we(d)}}}function Fa(n){let e,t=n[26].content+"",r,s,i;return{c(){e=P("div"),r=_e(t),s=I(),k(e,"class",i="message "+(n[26].role==="user"?"user":"ai")+" svelte-6o9xp3")},m(a,o){K(a,e,o),y(e,r),y(e,s)},p(a,o){o[0]&32&&t!==(t=a[26].content+"")&&qe(r,t),o[0]&32&&i!==(i="message "+(a[26].role==="user"?"user":"ai")+" svelte-6o9xp3")&&k(e,"class",i)},d(a){a&&z(e)}}}function Na(n){let e,t=Te(n[9]),r=[];for(let s=0;s<t.length;s+=1)r[s]=Da(Oa(n,t,s));return{c(){e=P("div");for(let s=0;s<r.length;s+=1)r[s].c();k(e,"class","prompt-panel svelte-6o9xp3"),M(e,"left",n[4].x+"px"),M(e,"top",n[4].y+"px")},m(s,i){K(s,e,i);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(s,i){if(i[0]&522){t=Te(s[9]);let a;for(a=0;a<t.length;a+=1){const o=Oa(s,t,a);r[a]?r[a].p(o,i):(r[a]=Da(o),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}i[0]&16&&M(e,"left",s[4].x+"px"),i[0]&16&&M(e,"top",s[4].y+"px")},d(s){s&&z(e),mn(r,s)}}}function Da(n){let e,t,r,s,i;function a(){return n[20](n[23])}return{c(){e=P("div"),t=P("div"),t.textContent=`${n[23].name}`,r=I(),k(t,"class","prompt-name svelte-6o9xp3"),k(e,"class","prompt-item svelte-6o9xp3")},m(o,l){K(o,e,l),y(e,t),y(e,r),s||(i=X(e,"click",a),s=!0)},p(o,l){n=o},d(o){o&&z(e),s=!1,i()}}}function Kh(n){let e,t,r,s,i,a,o,l,c,f,u,h,m,d,p,g,C,w,_=Te(n[0]),b=[];for(let R=0;R<_.length;R+=1)b[R]=Ia(Ta(n,_,R));let S=Te(n[5].messages),O=[];for(let R=0;R<S.length;R+=1)O[R]=Fa(Ma(n,S,R));let x=n[3]&&Na(n);return{c(){e=P("div"),t=P("div"),r=P("div"),r.innerHTML='<h3 class="svelte-6o9xp3">思源AI</h3>',s=I(),i=P("div"),a=P("button"),a.textContent="+ 新建聊天",o=I();for(let R=0;R<b.length;R+=1)b[R].c();l=I(),c=P("div"),f=P("div");for(let R=0;R<O.length;R+=1)O[R].c();u=I(),h=P("div"),h.innerHTML='<button class="svelte-6o9xp3">设置</button> <button class="svelte-6o9xp3">用户</button> <button class="svelte-6o9xp3">主题</button> <button class="svelte-6o9xp3">搜索</button> <button class="svelte-6o9xp3">表情</button> <button class="svelte-6o9xp3">文件</button> <button class="svelte-6o9xp3">图片</button> <button class="svelte-6o9xp3">应用</button> <button class="svelte-6o9xp3">卡片</button>',m=I(),d=P("div"),p=P("textarea"),g=I(),x&&x.c(),k(r,"class","history-header svelte-6o9xp3"),k(a,"class","add-history-btn svelte-6o9xp3"),k(a,"style",""),k(i,"class","history-list svelte-6o9xp3"),k(t,"class","history-panel svelte-6o9xp3"),k(f,"class","messages-container svelte-6o9xp3"),k(h,"class","toolbar svelte-6o9xp3"),k(p,"placeholder","Enter 发送，Shift + Enter 换行"),k(p,"class","svelte-6o9xp3"),k(d,"class","input-container svelte-6o9xp3"),k(c,"class","chat-panel svelte-6o9xp3"),k(e,"class","chat-container svelte-6o9xp3")},m(R,D){K(R,e,D),y(e,t),y(t,r),y(t,s),y(t,i),y(i,a),y(i,o);for(let E=0;E<b.length;E+=1)b[E]&&b[E].m(i,null);y(e,l),y(e,c),y(c,f);for(let E=0;E<O.length;E+=1)O[E]&&O[E].m(f,null);n[16](f),y(c,u),y(c,h),y(c,m),y(c,d),y(d,p),Fe(p,n[1]),y(d,g),x&&x.m(d,null),C||(w=[X(a,"click",n[7]),X(p,"input",n[17]),X(p,"keydown",n[18]),X(p,"input",n[19])],C=!0)},p(R,D){if(D[0]&289){_=Te(R[0]);let E;for(E=0;E<_.length;E+=1){const v=Ta(R,_,E);b[E]?b[E].p(v,D):(b[E]=Ia(v),b[E].c(),b[E].m(i,null))}for(;E<b.length;E+=1)b[E].d(1);b.length=_.length}if(D[0]&32){S=Te(R[5].messages);let E;for(E=0;E<S.length;E+=1){const v=Ma(R,S,E);O[E]?O[E].p(v,D):(O[E]=Fa(v),O[E].c(),O[E].m(f,null))}for(;E<O.length;E+=1)O[E].d(1);O.length=S.length}D[0]&2&&Fe(p,R[1]),R[3]?x?x.p(R,D):(x=Na(R),x.c(),x.m(d,null)):x&&(x.d(1),x=null)},i:me,o:me,d(R){R&&z(e),mn(b,R),mn(O,R),n[16](null),x&&x.d(),C=!1,we(w)}}}function Gh(n,e,t){let r,{openai:s}=e,{claude:i}=e,{settingStorage:a}=e,{chatHistoryStorage:o}=e,l=o.dump();console.debug(a,s,i);let c="",f;Pc(()=>{f&&t(2,f.scrollTop=f.scrollHeight,f)});let u="",h=!1;async function m(){if(c.trim()){t(5,r.messages=[...r.messages,{role:"user",content:c}],r),o.update(r),t(1,c="");try{h=!0,u="",t(5,r.messages=[...r.messages,{role:"assistant",content:""}],r),await nc(s,i,a.getValue("modelSelections"),a,r.messages,!1,E=>{t(5,r.messages[r.messages.length-1].content=E,r)})}catch(E){console.error("AI 响应出错:",E)}finally{h=!1,o.update(r)}}}function d(){const E={id:Date.now(),title:"新的对话",time:xa().format("YYYY/M/D HH:mm:ss"),messages:[{role:"system",content:"You are a helpful assistant. You can help me by answering my questions. You can also ask me questions."}]};o.add(E),t(0,l=o.dump()),t(5,r=E)}function p(E){if(o.delete(E),o.data.length===0){const v={id:Date.now(),title:"新的对话",time:xa().format("YYYY/M/D HH:mm:ss"),messages:[{role:"system",content:"You are a helpful assistant. You can help me by answering my questions. You can also ask me questions."}]};o.add(v)}t(0,l=o.dump()),t(5,r=l[0])}let g=!1,C={x:0,y:0},w=[{id:1,name:"翻译",desc:"将文本翻译成指定语言"},{id:2,name:"总结",desc:"总结文本要点"},{id:3,name:"代码",desc:"生成或解释代码"},{id:1,name:"翻译",desc:"将文本翻译成指定语言"},{id:2,name:"总结",desc:"总结文本要点"},{id:3,name:"代码",desc:"生成或解释代码"}];const _=E=>t(5,r=E),b=E=>p(E.id);function S(E){ye[E?"unshift":"push"](()=>{f=E,t(2,f)})}function O(){c=this.value,t(1,c)}const x=E=>{E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),m())},R=E=>{const v=E.target instanceof HTMLTextAreaElement?E.target:null;if(v)if(v.value.endsWith("/")){const se=v.selectionStart,Ce=v.value.substring(0,se),B=document.createElement("span");B.style.font=getComputedStyle(v).font,B.style.whiteSpace="pre-wrap",B.textContent=Ce,document.body.appendChild(B);const F=Ce.split(`
`),T=F.length-1,L=F[T],N=v.getBoundingClientRect(),U=parseInt(getComputedStyle(v).lineHeight),j=parseInt(getComputedStyle(v).paddingLeft),Y=v.scrollTop;t(4,C={x:N.left+j+L.length*8,y:N.top+T*U-Y+U}),document.body.removeChild(B),t(3,g=!0)}else t(3,g=!1)},D=E=>{t(1,c=c.replace(/\/$/,E.name+" ")),t(3,g=!1)};return n.$$set=E=>{"openai"in E&&t(10,s=E.openai),"claude"in E&&t(11,i=E.claude),"settingStorage"in E&&t(12,a=E.settingStorage),"chatHistoryStorage"in E&&t(13,o=E.chatHistoryStorage)},n.$$.update=()=>{n.$$.dirty[0]&1&&t(5,r=l[0])},[l,c,f,g,C,r,m,d,p,w,s,i,a,o,_,b,S,O,x,R,D]}class Yh extends Pe{constructor(e){super(),ve(this,e,Gh,Kh,ke,{openai:10,claude:11,settingStorage:12,chatHistoryStorage:13},null,[-1,-1])}}function Qh(n,e,t,r){const s=new pt.Dialog({title:"",content:'<div id="ai-instruction""></div>',width:"40%",hideCloseIcon:!0}),i=Ph(),a=Ch();n.getValue("apiKey").trim().length<=0&&Ua("请先设置API Key"),new Vh({target:s.element.querySelector("#ai-instruction"),props:{openai:e,claude:t,settingStorage:n,promptStorage:r,selectedText:i,pageContent:a}})}function Zh(n,e,t,r){const s=new pt.Dialog({title:"",content:'<div id="ai-chat" style="height: 100%; margin:0px; padding:0px;"></div>',width:"60%",height:"80%",hideCloseIcon:!0});new Yh({target:s.element.querySelector("#ai-chat"),props:{openai:e,claude:t,settingStorage:n,chatHistoryStorage:r}})}function em(n){let e,t,r,s,i,a,o,l,c,f,u,h,m,d,p,g,C,w,_,b,S,O,x;return{c(){e=P("div"),t=P("h2"),t.textContent="token",r=I(),s=P("p"),s.textContent=`token
        是模型用来表示自然语言文本的基本单位，可以直观的理解为“字”或“词”；通常 1
        个中文词语、1 个英文单词、1 个数字或 1 个符号计为 1 个 token。`,i=I(),a=P("h2"),a.textContent="Temperature 设置",o=I(),l=P("p"),l.innerHTML=`​<span data-type="code">temperature</span>​ 参数默认为
        1.0。建议您根据如下表格，按使用场景设置
        <span data-type="code">temperature</span>​。`,c=I(),f=P("table"),f.innerHTML="<thead><tr><th>场景</th> <th>温度</th></tr></thead> <tbody><tr><td>代码生成/数学解题</td> <td>0.0</td></tr> <tr><td>数据抽取/分析</td> <td>1.0</td></tr> <tr><td>通用对话</td> <td>1.3</td></tr> <tr><td>翻译</td> <td>1.3</td></tr> <tr><td>创意类写作/诗歌创作</td> <td>1.5</td></tr></tbody>",u=I(),h=P("h2"),h.textContent="model",m=I(),d=P("p"),d.textContent="扣减费用 = token 消耗量 × 模型单价，对应的费用将直接余额中进行扣减。",p=I(),g=P("table"),g.innerHTML='<thead><tr><th>模型</th> <th>上下文长度</th> <th>最大输出长度</th> <th>输入价格<br/></th> <th>输出价格</th></tr></thead> <tbody><tr><td><span data-type="strong">deepseek-chat</span></td> <td>64K</td> <td>8K</td> <td>1元/百万tokens</td> <td>2元/百万tokens</td></tr> <tr><td>qwen-max</td> <td>32,768</td> <td>8,192</td> <td>20元/百万tokens</td> <td>60元/百万tokens</td></tr> <tr><td>qwen-plus</td> <td>129,024</td> <td>8,192</td> <td>0.8元/百万tokens</td> <td>2元/百万tokens</td></tr> <tr><td>qwen-turbo</td> <td>1,000,000</td> <td>8,192</td> <td>0.3元/百万tokens</td> <td>0.6元/百万tokens</td></tr> <tr><td>qwen-long</td> <td>10,000,000</td> <td>6,000</td> <td>0.25元/百万tokens</td> <td>1元/百万tokens</td></tr> <tr><td><span data-type="s">gpt-3.5-turbo</span></td> <td></td> <td></td> <td><span data-type="s">6元/百万tokens</span></td> <td><span data-type="s">18元/百万tokens</span></td></tr> <tr><td>gpt-4o-mini</td> <td></td> <td></td> <td>1.8元/百万tokens</td> <td>7.2元/百万tokens</td></tr> <tr><td>gpt-4o</td> <td></td> <td></td> <td>30元/百万tokens</td> <td>120元/百万tokens</td></tr> <tr><td><span data-type="strong text" style="color: var(--b3-font-color8);">gpt-4-turbo</span></td> <td></td> <td></td> <td>120元/百万tokens</td> <td>360元/百万tokens</td></tr> <tr><td>claude-3-5-haiku</td> <td></td> <td></td> <td>12元/百万tokens</td> <td>60元/百万tokens</td></tr> <tr><td>claude-3-5-sonnet</td> <td></td> <td></td> <td>36元/百万tokens</td> <td>180元/百万tokens</td></tr> <tr><td><span data-type="strong text" style="color: var(--b3-font-color8);">claude-3-opus</span></td> <td></td> <td></td> <td>180元/百万tokens</td> <td>900元/百万tokens</td></tr> <tr><td>gemini-1.5-flash</td> <td></td> <td></td> <td>0.896元/百万tokens</td> <td>3.6元/百万tokens</td></tr> <tr><td>gemini-1.5-pro</td> <td></td> <td></td> <td>15元/百万tokens</td> <td>60元/百万tokens</td></tr></tbody>',C=I(),w=P("h3"),w.textContent="排行榜",_=I(),b=P("p"),b.innerHTML='<a href="https://www.datalearner.com/ai-models/leaderboard/datalearner-llm-leaderboard">大模型综合能力排行榜</a>',S=I(),O=P("p"),O.innerHTML='<a href="https://www.datalearner.com/ai-models/leaderboard/datalearner-llm-coding-leaderboard#google_vignette">大模型编程能力排行榜</a>',k(e,"class",x="b3-typography "+n[0]),M(e,"margin","10px auto"),M(e,"max-height","80vh"),M(e,"overflow-y","auto"),M(e,"width","95%"),M(e,"max-width","1200px")},m(R,D){K(R,e,D),y(e,t),y(e,r),y(e,s),y(e,i),y(e,a),y(e,o),y(e,l),y(e,c),y(e,f),y(e,u),y(e,h),y(e,m),y(e,d),y(e,p),y(e,g),y(e,C),y(e,w),y(e,_),y(e,b),y(e,S),y(e,O)},p(R,[D]){D&1&&x!==(x="b3-typography "+R[0])&&k(e,"class",x)},i:me,o:me,d(R){R&&z(e)}}}function tm(n,e,t){let r,{display:s=!0}=e;return n.$$set=i=>{"display"in i&&t(1,s=i.display)},n.$$.update=()=>{n.$$.dirty&2&&t(0,r=s?"":"fn__none")},[r,s]}let nm=class extends Pe{constructor(e){super(),ve(this,e,tm,em,ke,{display:1})}};function rm(n){let e,t,r,s,i,a,o,l,c,f,u,h,m,d,p,g,C,w,_,b,S,O,x,R,D,E,v,se,Ce,B,F,T,L,N,U,j,Y,Z,ae,oe;return{c(){e=P("div"),t=P("h1"),t.textContent="功能介绍",r=I(),s=P("h2"),s.textContent="指令模式",i=I(),a=P("p"),a.textContent="快捷键：option + command + k",o=I(),l=P("div"),l.innerHTML='<img src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/yyy.jpg" alt=""/>',c=I(),f=P("h3"),f.textContent="设置超参数",u=I(),h=P("div"),h.innerHTML='<img src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/xx.jpg" alt=""/>',m=I(),d=P("h3"),d.textContent="选择模型",p=I(),g=P("div"),g.innerHTML='<img src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/WechatIMG252.jpg" alt=""/>',C=I(),w=P("h3"),w.textContent="无中生有",_=I(),b=P("p"),b.textContent="当前文档中没有写入任何内容，直接通过指令让大模型帮助生成内容。",S=I(),O=P("div"),O.innerHTML=`<video controls="" src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/%E6%97%A0%E4%B8%AD%E7%94%9F%E6%9C%89.mp4" data-src=""><track kind="captions" label="中文字幕" src="" default=""/>
            不支持视频播放。</video>`,x=I(),R=P("h3"),R.textContent="修改润色",D=I(),E=P("div"),E.innerHTML=`<video controls="" src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3.mp4" data-src=""><track kind="captions" label="中文字幕" src="" default=""/>
            不支持视频播放。</video>`,v=I(),se=P("h3"),se.textContent="扩写",Ce=I(),B=P("div"),B.innerHTML=`<video controls="" src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/%E6%89%A9%E5%86%99.mp4" data-src=""><track kind="captions" label="中文字幕" src="" default=""/>
            不支持视频播放。</video>`,F=I(),T=P("h2"),T.textContent="聊天模式",L=I(),N=P("p"),N.textContent="开发中...",U=I(),j=P("h2"),j.textContent="来提意见",Y=I(),Z=P("img"),k(a,"id","20250116161508-2ifhw0n"),k(l,"class","iframe"),k(h,"class","iframe"),k(g,"class","iframe"),k(O,"class","iframe"),k(E,"class","iframe"),k(B,"class","iframe"),cc(Z.src,ae="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/WechatIMG6765.jpg")||k(Z,"src",ae),k(Z,"alt",""),M(Z,"width","50%"),M(Z,"height","auto"),k(e,"class",oe="b3-typography "+n[0]),M(e,"max-width","800px"),M(e,"margin","0 auto")},m(pe,Ge){K(pe,e,Ge),y(e,t),y(e,r),y(e,s),y(e,i),y(e,a),y(e,o),y(e,l),y(e,c),y(e,f),y(e,u),y(e,h),y(e,m),y(e,d),y(e,p),y(e,g),y(e,C),y(e,w),y(e,_),y(e,b),y(e,S),y(e,O),y(e,x),y(e,R),y(e,D),y(e,E),y(e,v),y(e,se),y(e,Ce),y(e,B),y(e,F),y(e,T),y(e,L),y(e,N),y(e,U),y(e,j),y(e,Y),y(e,Z)},p(pe,[Ge]){Ge&1&&oe!==(oe="b3-typography "+pe[0])&&k(e,"class",oe)},i:me,o:me,d(pe){pe&&z(e)}}}function sm(n,e,t){let r,{display:s=!0}=e;return n.$$set=i=>{"display"in i&&t(1,s=i.display)},n.$$.update=()=>{n.$$.dirty&2&&t(0,r=s?"":"fn__none")},[r,s]}let im=class extends Pe{constructor(e){super(),ve(this,e,sm,rm,ke,{display:1})}};function Ba(n,e,t){const r=n.slice();return r[8]=e[t],r}function La(n){let e,t,r,s,i;function a(){return n[4](n[8])}return{c(){e=P("li"),t=P("span"),t.textContent=`${n[8]}`,r=I(),k(t,"class","b3-list-item__text"),k(e,"data-name","editor"),k(e,"class","b3-list-item"),ie(e,"b3-list-item--focus",n[8]===n[2])},m(o,l){K(o,e,l),y(e,t),y(e,r),s||(i=[X(e,"click",a),X(e,"keydown",om)],s=!0)},p(o,l){n=o,l&12&&ie(e,"b3-list-item--focus",n[8]===n[2])},d(o){o&&z(e),s=!1,we(i)}}}function am(n){let e,t,r,s,i,a,o,l,c,f,u,h,m,d,p,g,C,w,_=Te(n[3]),b=[];for(let S=0;S<_.length;S+=1)b[S]=La(Ba(n,_,S));return i=new tc({props:{group:n[3][0],settingStorage:n[0],display:n[2]===n[3][0]}}),i.$on("changed",n[5]),o=new nm({props:{display:n[2]===n[3][2]}}),c=new im({props:{display:n[2]===n[3][3]}}),h=new hr({props:{label:"取消",text:!0,outline:!0}}),h.$on("click",n[6]),g=new hr({props:{label:"确认",text:!1,outline:!1}}),g.$on("click",n[7]),{c(){e=P("div"),t=P("ul");for(let S=0;S<b.length;S+=1)b[S].c();r=I(),s=P("div"),ue(i.$$.fragment),a=I(),ue(o.$$.fragment),l=I(),ue(c.$$.fragment),f=I(),u=P("div"),ue(h.$$.fragment),m=I(),d=P("div"),p=I(),ue(g.$$.fragment),k(t,"class","b3-tab-bar b3-list b3-list--background"),k(d,"class","fn__space"),k(u,"class",C="b3-dialog__action "+(n[2]==n[3][0]?"":"fn__none")),k(s,"class","config__tab-wrap"),k(e,"class","fn__flex-1 fn__flex config__panel")},m(S,O){K(S,e,O),y(e,t);for(let x=0;x<b.length;x+=1)b[x]&&b[x].m(t,null);y(e,r),y(e,s),le(i,s,null),y(s,a),le(o,s,null),y(s,l),le(c,s,null),y(s,f),y(s,u),le(h,u,null),y(u,m),y(u,d),y(u,p),le(g,u,null),w=!0},p(S,[O]){if(O&12){_=Te(S[3]);let E;for(E=0;E<_.length;E+=1){const v=Ba(S,_,E);b[E]?b[E].p(v,O):(b[E]=La(v),b[E].c(),b[E].m(t,null))}for(;E<b.length;E+=1)b[E].d(1);b.length=_.length}const x={};O&1&&(x.settingStorage=S[0]),O&4&&(x.display=S[2]===S[3][0]),i.$set(x);const R={};O&4&&(R.display=S[2]===S[3][2]),o.$set(R);const D={};O&4&&(D.display=S[2]===S[3][3]),c.$set(D),(!w||O&4&&C!==(C="b3-dialog__action "+(S[2]==S[3][0]?"":"fn__none")))&&k(u,"class",C)},i(S){w||(q(i.$$.fragment,S),q(o.$$.fragment,S),q(c.$$.fragment,S),q(h.$$.fragment,S),q(g.$$.fragment,S),w=!0)},o(S){W(i.$$.fragment,S),W(o.$$.fragment,S),W(c.$$.fragment,S),W(h.$$.fragment,S),W(g.$$.fragment,S),w=!1},d(S){S&&z(e),mn(b,S),ce(i),ce(o),ce(c),ce(h),ce(g)}}}const om=()=>{};function lm(n,e,t){let r=["🌈 设置","💬 公告","✨ 功能"],s=r[0],{settingStorage:i}=e,{dialog:a}=e;const o=u=>{t(2,s=u)},l=({detail:u})=>{i.setValue(u.key,u.value)},c=()=>{i.load(),a.destroy()},f=()=>{i.save(),a.destroy()};return n.$$set=u=>{"settingStorage"in u&&t(0,i=u.settingStorage),"dialog"in u&&t(1,a=u.dialog)},[i,a,s,r,o,l,c,f]}class cm extends Pe{constructor(e){super(),ve(this,e,lm,am,ke,{settingStorage:0,dialog:1})}}const um=`<symbol id="iconFace" viewBox="0 0 32 32">
<path d="M13.667 17.333c0 0.92-0.747 1.667-1.667 1.667s-1.667-0.747-1.667-1.667 0.747-1.667 1.667-1.667 1.667 0.747 1.667 1.667zM20 15.667c-0.92 0-1.667 0.747-1.667 1.667s0.747 1.667 1.667 1.667 1.667-0.747 1.667-1.667-0.747-1.667-1.667-1.667zM29.333 16c0 7.36-5.973 13.333-13.333 13.333s-13.333-5.973-13.333-13.333 5.973-13.333 13.333-13.333 13.333 5.973 13.333 13.333zM14.213 5.493c1.867 3.093 5.253 5.173 9.12 5.173 0.613 0 1.213-0.067 1.787-0.16-1.867-3.093-5.253-5.173-9.12-5.173-0.613 0-1.213 0.067-1.787 0.16zM5.893 12.627c2.28-1.293 4.040-3.4 4.88-5.92-2.28 1.293-4.040 3.4-4.88 5.92zM26.667 16c0-1.040-0.16-2.040-0.44-2.987-0.933 0.2-1.893 0.32-2.893 0.32-4.173 0-7.893-1.92-10.347-4.92-1.4 3.413-4.187 6.093-7.653 7.4 0.013 0.053 0 0.12 0 0.187 0 5.88 4.787 10.667 10.667 10.667s10.667-4.787 10.667-10.667z"></path>
</symbol>`,fm=`<symbol id="iconSaving" viewBox="0 0 32 32">
<path d="M20 13.333c0-0.733 0.6-1.333 1.333-1.333s1.333 0.6 1.333 1.333c0 0.733-0.6 1.333-1.333 1.333s-1.333-0.6-1.333-1.333zM10.667 12h6.667v-2.667h-6.667v2.667zM29.333 10v9.293l-3.76 1.253-2.24 7.453h-7.333v-2.667h-2.667v2.667h-7.333c0 0-3.333-11.28-3.333-15.333s3.28-7.333 7.333-7.333h6.667c1.213-1.613 3.147-2.667 5.333-2.667 1.107 0 2 0.893 2 2 0 0.28-0.053 0.533-0.16 0.773-0.187 0.453-0.347 0.973-0.427 1.533l3.027 3.027h2.893zM26.667 12.667h-1.333l-4.667-4.667c0-0.867 0.12-1.72 0.347-2.547-1.293 0.333-2.347 1.293-2.787 2.547h-8.227c-2.573 0-4.667 2.093-4.667 4.667 0 2.507 1.627 8.867 2.68 12.667h2.653v-2.667h8v2.667h2.68l2.067-6.867 3.253-1.093v-4.707z"></path>
</symbol>`;class dm extends pt.Plugin{constructor(t){super(t);Re(this,"_isMobile");Re(this,"_settingStorage");Re(this,"_promptStorage");Re(this,"_chatHistoryStorage");Re(this,"_openai");Re(this,"_claude");this._settingStorage=new Sf(this,Ss),this._promptStorage=new bf(this,Es),this._chatHistoryStorage=new wf(this,xl),this._isMobile=pt.getFrontend()==="mobile"||pt.getFrontend()==="browser-mobile"}async onload(){console.log("onload...."),this._settingStorage.load().then(()=>{const t=this._settingStorage.getValue("apiKey");this._openai=new G({baseURL:`${ta}/v1`,apiKey:t,dangerouslyAllowBrowser:!0}),this._claude=new te({baseURL:`${ta}/claude`,apiKey:t,dangerouslyAllowBrowser:!0})}),this._promptStorage.load(),this._chatHistoryStorage.load(),this.addIcons(um),this.addIcons(fm),this.addCommand({langKey:"Instruction",hotkey:"⌥⌘K",callback:()=>Qh(this._settingStorage,this._openai,this._claude,this._promptStorage)}),this.addCommand({langKey:"Chat",hotkey:"⌥⌘L",callback:()=>Zh(this._settingStorage,this._openai,this._claude,this._chatHistoryStorage)}),console.log("onload....end")}onLayoutReady(){}uninstall(){this.removeData(Ss),this.removeData(Es),Ua("数据已清除，思源AI插件卸载成功！")}openSetting(){if(!this._settingStorage)return;if(this._isMobile){$a("请在桌面端使用");return}let t=new pt.Dialog({title:"思源AI设置",width:"70%",height:"60%",content:'<div class="b3-dialog__content" id="AISettingPanel" ></div>'});new cm({target:t.element.querySelector("#AISettingPanel"),props:{settingStorage:this._settingStorage,dialog:t}})}}module.exports=dm;
