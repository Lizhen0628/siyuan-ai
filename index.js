"use strict";var dT=Object.defineProperty;var hT=(t,e,n)=>e in t?dT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var we=(t,e,n)=>hT(t,typeof e!="symbol"?e+"":e,n);const en=require("siyuan");var fT=Object.defineProperty,mT=(t,e,n)=>e in t?fT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ln=(t,e,n)=>mT(t,typeof e!="symbol"?e+"":e,n);function xb(t,e){return function(){return t.apply(e,arguments)}}const{toString:pT}=Object.prototype,{getPrototypeOf:Zh}=Object,wc=(t=>e=>{const n=pT.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),zn=t=>(t=t.toLowerCase(),e=>wc(e)===t),Tc=t=>e=>typeof e===t,{isArray:ba}=Array,Ti=Tc("undefined");function gT(t){return t!==null&&!Ti(t)&&t.constructor!==null&&!Ti(t.constructor)&&mn(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Lb=zn("ArrayBuffer");function bT(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Lb(t.buffer),e}const _T=Tc("string"),mn=Tc("function"),Db=Tc("number"),Sc=t=>t!==null&&typeof t=="object",yT=t=>t===!0||t===!1,mu=t=>{if(wc(t)!=="object")return!1;const e=Zh(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},ET=zn("Date"),wT=zn("File"),TT=zn("Blob"),ST=zn("FileList"),AT=t=>Sc(t)&&mn(t.pipe),CT=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||mn(t.append)&&((e=wc(t))==="formdata"||e==="object"&&mn(t.toString)&&t.toString()==="[object FormData]"))},vT=zn("URLSearchParams"),[OT,IT,kT,NT]=["ReadableStream","Request","Response","Headers"].map(zn),RT=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Qi(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let r,s;if(typeof t!="object"&&(t=[t]),ba(t))for(r=0,s=t.length;r<s;r++)e.call(null,t[r],r,t);else{const a=n?Object.getOwnPropertyNames(t):Object.keys(t),i=a.length;let o;for(r=0;r<i;r++)o=a[r],e.call(null,t[o],o,t)}}function Mb(t,e){e=e.toLowerCase();const n=Object.keys(t);let r=n.length,s;for(;r-- >0;)if(s=n[r],e===s.toLowerCase())return s;return null}const as=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Bb=t=>!Ti(t)&&t!==as;function Rd(){const{caseless:t}=Bb(this)&&this||{},e={},n=(r,s)=>{const a=t&&Mb(e,s)||s;mu(e[a])&&mu(r)?e[a]=Rd(e[a],r):mu(r)?e[a]=Rd({},r):ba(r)?e[a]=r.slice():e[a]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&Qi(arguments[r],n);return e}const PT=(t,e,n,{allOwnKeys:r}={})=>(Qi(e,(s,a)=>{n&&mn(s)?t[a]=xb(s,n):t[a]=s},{allOwnKeys:r}),t),xT=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),LT=(t,e,n,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},DT=(t,e,n,r)=>{let s,a,i;const o={};if(e=e||{},t==null)return e;do{for(s=Object.getOwnPropertyNames(t),a=s.length;a-- >0;)i=s[a],(!r||r(i,t,e))&&!o[i]&&(e[i]=t[i],o[i]=!0);t=n!==!1&&Zh(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},MT=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const r=t.indexOf(e,n);return r!==-1&&r===n},BT=t=>{if(!t)return null;if(ba(t))return t;let e=t.length;if(!Db(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},FT=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&Zh(Uint8Array)),UT=(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=n.next())&&!r.done;){const s=r.value;e.call(t,s[0],s[1])}},jT=(t,e)=>{let n;const r=[];for(;(n=t.exec(e))!==null;)r.push(n);return r},HT=zn("HTMLFormElement"),$T=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,r){return n.toUpperCase()+r}),Mm=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),qT=zn("RegExp"),Fb=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),r={};Qi(n,(s,a)=>{let i;(i=e(s,a,t))!==!1&&(r[a]=i||s)}),Object.defineProperties(t,r)},VT=t=>{Fb(t,(e,n)=>{if(mn(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];if(mn(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},zT=(t,e)=>{const n={},r=s=>{s.forEach(a=>{n[a]=!0})};return ba(t)?r(t):r(String(t).split(e)),n},WT=()=>{},GT=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,gl="abcdefghijklmnopqrstuvwxyz",Bm="0123456789",Ub={DIGIT:Bm,ALPHA:gl,ALPHA_DIGIT:gl+gl.toUpperCase()+Bm},KT=(t=16,e=Ub.ALPHA_DIGIT)=>{let n="";const{length:r}=e;for(;t--;)n+=e[Math.random()*r|0];return n};function YT(t){return!!(t&&mn(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const ZT=t=>{const e=new Array(10),n=(r,s)=>{if(Sc(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const a=ba(r)?[]:{};return Qi(r,(i,o)=>{const u=n(i,s+1);!Ti(u)&&(a[o]=u)}),e[s]=void 0,a}}return r};return n(t,0)},JT=zn("AsyncFunction"),XT=t=>t&&(Sc(t)||mn(t))&&mn(t.then)&&mn(t.catch),jb=((t,e)=>t?setImmediate:e?((n,r)=>(as.addEventListener("message",({source:s,data:a})=>{s===as&&a===n&&r.length&&r.shift()()},!1),s=>{r.push(s),as.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",mn(as.postMessage)),QT=typeof queueMicrotask<"u"?queueMicrotask.bind(as):typeof process<"u"&&process.nextTick||jb,H={isArray:ba,isArrayBuffer:Lb,isBuffer:gT,isFormData:CT,isArrayBufferView:bT,isString:_T,isNumber:Db,isBoolean:yT,isObject:Sc,isPlainObject:mu,isReadableStream:OT,isRequest:IT,isResponse:kT,isHeaders:NT,isUndefined:Ti,isDate:ET,isFile:wT,isBlob:TT,isRegExp:qT,isFunction:mn,isStream:AT,isURLSearchParams:vT,isTypedArray:FT,isFileList:ST,forEach:Qi,merge:Rd,extend:PT,trim:RT,stripBOM:xT,inherits:LT,toFlatObject:DT,kindOf:wc,kindOfTest:zn,endsWith:MT,toArray:BT,forEachEntry:UT,matchAll:jT,isHTMLForm:HT,hasOwnProperty:Mm,hasOwnProp:Mm,reduceDescriptors:Fb,freezeMethods:VT,toObjectSet:zT,toCamelCase:$T,noop:WT,toFiniteNumber:GT,findKey:Mb,global:as,isContextDefined:Bb,ALPHABET:Ub,generateString:KT,isSpecCompliantForm:YT,toJSONObject:ZT,isAsyncFn:JT,isThenable:XT,setImmediate:jb,asap:QT};function Se(t,e,n,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}H.inherits(Se,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:H.toJSONObject(this.config),code:this.code,status:this.status}}});const Hb=Se.prototype,$b={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{$b[t]={value:t}});Object.defineProperties(Se,$b);Object.defineProperty(Hb,"isAxiosError",{value:!0});Se.from=(t,e,n,r,s,a)=>{const i=Object.create(Hb);return H.toFlatObject(t,i,function(o){return o!==Error.prototype},o=>o!=="isAxiosError"),Se.call(i,t.message,e,n,r,s),i.cause=t,i.name=t.name,a&&Object.assign(i,a),i};const eS=null;function Pd(t){return H.isPlainObject(t)||H.isArray(t)}function qb(t){return H.endsWith(t,"[]")?t.slice(0,-2):t}function Fm(t,e,n){return t?t.concat(e).map(function(r,s){return r=qb(r),!n&&s?"["+r+"]":r}).join(n?".":""):e}function tS(t){return H.isArray(t)&&!t.some(Pd)}const nS=H.toFlatObject(H,{},null,function(t){return/^is[A-Z]/.test(t)});function Ac(t,e,n){if(!H.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=H.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(p,f){return!H.isUndefined(f[p])});const r=n.metaTokens,s=n.visitor||c,a=n.dots,i=n.indexes,o=(n.Blob||typeof Blob<"u"&&Blob)&&H.isSpecCompliantForm(e);if(!H.isFunction(s))throw new TypeError("visitor must be a function");function u(p){if(p===null)return"";if(H.isDate(p))return p.toISOString();if(!o&&H.isBlob(p))throw new Se("Blob is not supported. Use a Buffer instead.");return H.isArrayBuffer(p)||H.isTypedArray(p)?o&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function c(p,f,g){let b=p;if(p&&!g&&typeof p=="object"){if(H.endsWith(f,"{}"))f=r?f:f.slice(0,-2),p=JSON.stringify(p);else if(H.isArray(p)&&tS(p)||(H.isFileList(p)||H.endsWith(f,"[]"))&&(b=H.toArray(p)))return f=qb(f),b.forEach(function(_,y){!(H.isUndefined(_)||_===null)&&e.append(i===!0?Fm([f],y,a):i===null?f:f+"[]",u(_))}),!1}return Pd(p)?!0:(e.append(Fm(g,f,a),u(p)),!1)}const l=[],d=Object.assign(nS,{defaultVisitor:c,convertValue:u,isVisitable:Pd});function m(p,f){if(!H.isUndefined(p)){if(l.indexOf(p)!==-1)throw Error("Circular reference detected in "+f.join("."));l.push(p),H.forEach(p,function(g,b){(!(H.isUndefined(g)||g===null)&&s.call(e,g,H.isString(b)?b.trim():b,f,d))===!0&&m(g,f?f.concat(b):[b])}),l.pop()}}if(!H.isObject(t))throw new TypeError("data must be an object");return m(t),e}function Um(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function Jh(t,e){this._pairs=[],t&&Ac(t,this,e)}const Vb=Jh.prototype;Vb.append=function(t,e){this._pairs.push([t,e])};Vb.toString=function(t){const e=t?function(n){return t.call(this,n,Um)}:Um;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};function rS(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function zb(t,e,n){if(!e)return t;const r=n&&n.encode||rS,s=n&&n.serialize;let a;if(s?a=s(e,n):a=H.isURLSearchParams(e)?e.toString():new Jh(e,n).toString(r),a){const i=t.indexOf("#");i!==-1&&(t=t.slice(0,i)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class jm{constructor(){this.handlers=[]}use(e,n,r){return this.handlers.push({fulfilled:e,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){H.forEach(this.handlers,function(n){n!==null&&e(n)})}}const Wb={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},sS=typeof URLSearchParams<"u"?URLSearchParams:Jh,aS=typeof FormData<"u"?FormData:null,iS=typeof Blob<"u"?Blob:null,oS={isBrowser:!0,classes:{URLSearchParams:sS,FormData:aS,Blob:iS},protocols:["http","https","file","blob","url","data"]},Xh=typeof window<"u"&&typeof document<"u",xd=typeof navigator=="object"&&navigator||void 0,uS=Xh&&(!xd||["ReactNative","NativeScript","NS"].indexOf(xd.product)<0),cS=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",lS=Xh&&window.location.href||"http://localhost",dS=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Xh,hasStandardBrowserEnv:uS,hasStandardBrowserWebWorkerEnv:cS,navigator:xd,origin:lS},Symbol.toStringTag,{value:"Module"})),tn={...dS,...oS};function hS(t,e){return Ac(t,new tn.classes.URLSearchParams,Object.assign({visitor:function(n,r,s,a){return tn.isNode&&H.isBuffer(n)?(this.append(r,n.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function fS(t){return H.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function mS(t){const e={},n=Object.keys(t);let r;const s=n.length;let a;for(r=0;r<s;r++)a=n[r],e[a]=t[a];return e}function Gb(t){function e(n,r,s,a){let i=n[a++];if(i==="__proto__")return!0;const o=Number.isFinite(+i),u=a>=n.length;return i=!i&&H.isArray(s)?s.length:i,u?(H.hasOwnProp(s,i)?s[i]=[s[i],r]:s[i]=r,!o):((!s[i]||!H.isObject(s[i]))&&(s[i]=[]),e(n,r,s[i],a)&&H.isArray(s[i])&&(s[i]=mS(s[i])),!o)}if(H.isFormData(t)&&H.isFunction(t.entries)){const n={};return H.forEachEntry(t,(r,s)=>{e(fS(r),s,n,0)}),n}return null}function pS(t,e,n){if(H.isString(t))try{return(e||JSON.parse)(t),H.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(0,JSON.stringify)(t)}const eo={transitional:Wb,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",r=n.indexOf("application/json")>-1,s=H.isObject(t);if(s&&H.isHTMLForm(t)&&(t=new FormData(t)),H.isFormData(t))return r?JSON.stringify(Gb(t)):t;if(H.isArrayBuffer(t)||H.isBuffer(t)||H.isStream(t)||H.isFile(t)||H.isBlob(t)||H.isReadableStream(t))return t;if(H.isArrayBufferView(t))return t.buffer;if(H.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return hS(t,this.formSerializer).toString();if((a=H.isFileList(t))||n.indexOf("multipart/form-data")>-1){const i=this.env&&this.env.FormData;return Ac(a?{"files[]":t}:t,i&&new i,this.formSerializer)}}return s||r?(e.setContentType("application/json",!1),pS(t)):t}],transformResponse:[function(t){const e=this.transitional||eo.transitional,n=e&&e.forcedJSONParsing,r=this.responseType==="json";if(H.isResponse(t)||H.isReadableStream(t))return t;if(t&&H.isString(t)&&(n&&!this.responseType||r)){const s=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(t)}catch(a){if(s)throw a.name==="SyntaxError"?Se.from(a,Se.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:tn.classes.FormData,Blob:tn.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};H.forEach(["delete","get","head","post","put","patch"],t=>{eo.headers[t]={}});const gS=H.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),bS=t=>{const e={};let n,r,s;return t&&t.split(`
`).forEach(function(a){s=a.indexOf(":"),n=a.substring(0,s).trim().toLowerCase(),r=a.substring(s+1).trim(),!(!n||e[n]&&gS[n])&&(n==="set-cookie"?e[n]?e[n].push(r):e[n]=[r]:e[n]=e[n]?e[n]+", "+r:r)}),e},Hm=Symbol("internals");function La(t){return t&&String(t).trim().toLowerCase()}function pu(t){return t===!1||t==null?t:H.isArray(t)?t.map(pu):String(t)}function _S(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(t);)e[r[1]]=r[2];return e}const yS=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function bl(t,e,n,r,s){if(H.isFunction(r))return r.call(this,e,n);if(s&&(e=n),!!H.isString(e)){if(H.isString(r))return e.indexOf(r)!==-1;if(H.isRegExp(r))return r.test(e)}}function ES(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,r)=>n.toUpperCase()+r)}function wS(t,e){const n=H.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+n,{value:function(s,a,i){return this[r].call(this,e,s,a,i)},configurable:!0})})}let nn=class{constructor(t){t&&this.set(t)}set(t,e,n){const r=this;function s(i,o,u){const c=La(o);if(!c)throw new Error("header name must be a non-empty string");const l=H.findKey(r,c);(!l||r[l]===void 0||u===!0||u===void 0&&r[l]!==!1)&&(r[l||o]=pu(i))}const a=(i,o)=>H.forEach(i,(u,c)=>s(u,c,o));if(H.isPlainObject(t)||t instanceof this.constructor)a(t,e);else if(H.isString(t)&&(t=t.trim())&&!yS(t))a(bS(t),e);else if(H.isHeaders(t))for(const[i,o]of t.entries())s(o,i,n);else t!=null&&s(e,t,n);return this}get(t,e){if(t=La(t),t){const n=H.findKey(this,t);if(n){const r=this[n];if(!e)return r;if(e===!0)return _S(r);if(H.isFunction(e))return e.call(this,r,n);if(H.isRegExp(e))return e.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=La(t),t){const n=H.findKey(this,t);return!!(n&&this[n]!==void 0&&(!e||bl(this,this[n],n,e)))}return!1}delete(t,e){const n=this;let r=!1;function s(a){if(a=La(a),a){const i=H.findKey(n,a);i&&(!e||bl(n,n[i],i,e))&&(delete n[i],r=!0)}}return H.isArray(t)?t.forEach(s):s(t),r}clear(t){const e=Object.keys(this);let n=e.length,r=!1;for(;n--;){const s=e[n];(!t||bl(this,this[s],s,t,!0))&&(delete this[s],r=!0)}return r}normalize(t){const e=this,n={};return H.forEach(this,(r,s)=>{const a=H.findKey(n,s);if(a){e[a]=pu(r),delete e[s];return}const i=t?ES(s):String(s).trim();i!==s&&delete e[s],e[i]=pu(r),n[i]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return H.forEach(this,(n,r)=>{n!=null&&n!==!1&&(e[r]=t&&H.isArray(n)?n.join(", "):n)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const n=new this(t);return e.forEach(r=>n.set(r)),n}static accessor(t){const e=(this[Hm]=this[Hm]={accessors:{}}).accessors,n=this.prototype;function r(s){const a=La(s);e[a]||(wS(n,s),e[a]=!0)}return H.isArray(t)?t.forEach(r):r(t),this}};nn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);H.reduceDescriptors(nn.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[n]=r}}});H.freezeMethods(nn);function _l(t,e){const n=this||eo,r=e||n,s=nn.from(r.headers);let a=r.data;return H.forEach(t,function(i){a=i.call(n,a,s.normalize(),e?e.status:void 0)}),s.normalize(),a}function Kb(t){return!!(t&&t.__CANCEL__)}function _a(t,e,n){Se.call(this,t??"canceled",Se.ERR_CANCELED,e,n),this.name="CanceledError"}H.inherits(_a,Se,{__CANCEL__:!0});function Yb(t,e,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?t(n):e(new Se("Request failed with status code "+n.status,[Se.ERR_BAD_REQUEST,Se.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function TS(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function SS(t,e){t=t||10;const n=new Array(t),r=new Array(t);let s=0,a=0,i;return e=e!==void 0?e:1e3,function(o){const u=Date.now(),c=r[a];i||(i=u),n[s]=o,r[s]=u;let l=a,d=0;for(;l!==s;)d+=n[l++],l=l%t;if(s=(s+1)%t,s===a&&(a=(a+1)%t),u-i<e)return;const m=c&&u-c;return m?Math.round(d*1e3/m):void 0}}function AS(t,e){let n=0,r=1e3/e,s,a;const i=(o,u=Date.now())=>{n=u,s=null,a&&(clearTimeout(a),a=null),t.apply(null,o)};return[(...o)=>{const u=Date.now(),c=u-n;c>=r?i(o,u):(s=o,a||(a=setTimeout(()=>{a=null,i(s)},r-c)))},()=>s&&i(s)]}const Nu=(t,e,n=3)=>{let r=0;const s=SS(50,250);return AS(a=>{const i=a.loaded,o=a.lengthComputable?a.total:void 0,u=i-r,c=s(u),l=i<=o;r=i;const d={loaded:i,total:o,progress:o?i/o:void 0,bytes:u,rate:c||void 0,estimated:c&&o&&l?(o-i)/c:void 0,event:a,lengthComputable:o!=null,[e?"download":"upload"]:!0};t(d)},n)},$m=(t,e)=>{const n=t!=null;return[r=>e[0]({lengthComputable:n,total:t,loaded:r}),e[1]]},qm=t=>(...e)=>H.asap(()=>t(...e)),CS=tn.hasStandardBrowserEnv?function(){const t=tn.navigator&&/(msie|trident)/i.test(tn.navigator.userAgent),e=document.createElement("a");let n;function r(s){let a=s;return t&&(e.setAttribute("href",a),a=e.href),e.setAttribute("href",a),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return n=r(window.location.href),function(s){const a=H.isString(s)?r(s):s;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}(),vS=tn.hasStandardBrowserEnv?{write(t,e,n,r,s,a){const i=[t+"="+encodeURIComponent(e)];H.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),H.isString(r)&&i.push("path="+r),H.isString(s)&&i.push("domain="+s),a===!0&&i.push("secure"),document.cookie=i.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function OS(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function IS(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Zb(t,e){return t&&!OS(e)?IS(t,e):e}const Vm=t=>t instanceof nn?{...t}:t;function bs(t,e){e=e||{};const n={};function r(c,l,d){return H.isPlainObject(c)&&H.isPlainObject(l)?H.merge.call({caseless:d},c,l):H.isPlainObject(l)?H.merge({},l):H.isArray(l)?l.slice():l}function s(c,l,d){if(H.isUndefined(l)){if(!H.isUndefined(c))return r(void 0,c,d)}else return r(c,l,d)}function a(c,l){if(!H.isUndefined(l))return r(void 0,l)}function i(c,l){if(H.isUndefined(l)){if(!H.isUndefined(c))return r(void 0,c)}else return r(void 0,l)}function o(c,l,d){if(d in e)return r(c,l);if(d in t)return r(void 0,c)}const u={url:a,method:a,data:a,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:o,headers:(c,l)=>s(Vm(c),Vm(l),!0)};return H.forEach(Object.keys(Object.assign({},t,e)),function(c){const l=u[c]||s,d=l(t[c],e[c],c);H.isUndefined(d)&&l!==o||(n[c]=d)}),n}const Jb=t=>{const e=bs({},t);let{data:n,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:a,headers:i,auth:o}=e;e.headers=i=nn.from(i),e.url=zb(Zb(e.baseURL,e.url),t.params,t.paramsSerializer),o&&i.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let u;if(H.isFormData(n)){if(tn.hasStandardBrowserEnv||tn.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((u=i.getContentType())!==!1){const[c,...l]=u?u.split(";").map(d=>d.trim()).filter(Boolean):[];i.setContentType([c||"multipart/form-data",...l].join("; "))}}if(tn.hasStandardBrowserEnv&&(r&&H.isFunction(r)&&(r=r(e)),r||r!==!1&&CS(e.url))){const c=s&&a&&vS.read(a);c&&i.set(s,c)}return e},kS=typeof XMLHttpRequest<"u",NS=kS&&function(t){return new Promise(function(e,n){const r=Jb(t);let s=r.data;const a=nn.from(r.headers).normalize();let{responseType:i,onUploadProgress:o,onDownloadProgress:u}=r,c,l,d,m,p;function f(){m&&m(),p&&p(),r.cancelToken&&r.cancelToken.unsubscribe(c),r.signal&&r.signal.removeEventListener("abort",c)}let g=new XMLHttpRequest;g.open(r.method.toUpperCase(),r.url,!0),g.timeout=r.timeout;function b(){if(!g)return;const y=nn.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),E={data:!i||i==="text"||i==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:y,config:t,request:g};Yb(function(I){e(I),f()},function(I){n(I),f()},E),g=null}"onloadend"in g?g.onloadend=b:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(b)},g.onabort=function(){g&&(n(new Se("Request aborted",Se.ECONNABORTED,t,g)),g=null)},g.onerror=function(){n(new Se("Network Error",Se.ERR_NETWORK,t,g)),g=null},g.ontimeout=function(){let y=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const E=r.transitional||Wb;r.timeoutErrorMessage&&(y=r.timeoutErrorMessage),n(new Se(y,E.clarifyTimeoutError?Se.ETIMEDOUT:Se.ECONNABORTED,t,g)),g=null},s===void 0&&a.setContentType(null),"setRequestHeader"in g&&H.forEach(a.toJSON(),function(y,E){g.setRequestHeader(E,y)}),H.isUndefined(r.withCredentials)||(g.withCredentials=!!r.withCredentials),i&&i!=="json"&&(g.responseType=r.responseType),u&&([d,p]=Nu(u,!0),g.addEventListener("progress",d)),o&&g.upload&&([l,m]=Nu(o),g.upload.addEventListener("progress",l),g.upload.addEventListener("loadend",m)),(r.cancelToken||r.signal)&&(c=y=>{g&&(n(!y||y.type?new _a(null,t,g):y),g.abort(),g=null)},r.cancelToken&&r.cancelToken.subscribe(c),r.signal&&(r.signal.aborted?c():r.signal.addEventListener("abort",c)));const _=TS(r.url);if(_&&tn.protocols.indexOf(_)===-1){n(new Se("Unsupported protocol "+_+":",Se.ERR_BAD_REQUEST,t));return}g.send(s||null)})},RS=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let r=new AbortController,s;const a=function(c){if(!s){s=!0,o();const l=c instanceof Error?c:this.reason;r.abort(l instanceof Se?l:new _a(l instanceof Error?l.message:l))}};let i=e&&setTimeout(()=>{i=null,a(new Se(`timeout ${e} of ms exceeded`,Se.ETIMEDOUT))},e);const o=()=>{t&&(i&&clearTimeout(i),i=null,t.forEach(c=>{c.unsubscribe?c.unsubscribe(a):c.removeEventListener("abort",a)}),t=null)};t.forEach(c=>c.addEventListener("abort",a));const{signal:u}=r;return u.unsubscribe=()=>H.asap(o),u}},PS=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let r=0,s;for(;r<n;)s=r+e,yield t.slice(r,s),r=s},xS=async function*(t,e){for await(const n of LS(t))yield*PS(n,e)},LS=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:r}=await e.read();if(n)break;yield r}}finally{await e.cancel()}},zm=(t,e,n,r)=>{const s=xS(t,e);let a=0,i,o=u=>{i||(i=!0,r&&r(u))};return new ReadableStream({async pull(u){try{const{done:c,value:l}=await s.next();if(c){o(),u.close();return}let d=l.byteLength;if(n){let m=a+=d;n(m)}u.enqueue(new Uint8Array(l))}catch(c){throw o(c),c}},cancel(u){return o(u),s.return()}},{highWaterMark:2})},Cc=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Xb=Cc&&typeof ReadableStream=="function",DS=Cc&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),Qb=(t,...e)=>{try{return!!t(...e)}catch{return!1}},MS=Xb&&Qb(()=>{let t=!1;const e=new Request(tn.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),Wm=64*1024,Ld=Xb&&Qb(()=>H.isReadableStream(new Response("").body)),Ru={stream:Ld&&(t=>t.body)};Cc&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Ru[e]&&(Ru[e]=H.isFunction(t[e])?n=>n[e]():(n,r)=>{throw new Se(`Response type '${e}' is not supported`,Se.ERR_NOT_SUPPORT,r)})})})(new Response);const BS=async t=>{if(t==null)return 0;if(H.isBlob(t))return t.size;if(H.isSpecCompliantForm(t))return(await new Request(tn.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(H.isArrayBufferView(t)||H.isArrayBuffer(t))return t.byteLength;if(H.isURLSearchParams(t)&&(t=t+""),H.isString(t))return(await DS(t)).byteLength},FS=async(t,e)=>H.toFiniteNumber(t.getContentLength())??BS(e),US=Cc&&(async t=>{let{url:e,method:n,data:r,signal:s,cancelToken:a,timeout:i,onDownloadProgress:o,onUploadProgress:u,responseType:c,headers:l,withCredentials:d="same-origin",fetchOptions:m}=Jb(t);c=c?(c+"").toLowerCase():"text";let p=RS([s,a&&a.toAbortSignal()],i),f;const g=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let b;try{if(u&&MS&&n!=="get"&&n!=="head"&&(b=await FS(l,r))!==0){let w=new Request(e,{method:"POST",body:r,duplex:"half"}),O;if(H.isFormData(r)&&(O=w.headers.get("content-type"))&&l.setContentType(O),w.body){const[S,x]=$m(b,Nu(qm(u)));r=zm(w.body,Wm,S,x)}}H.isString(d)||(d=d?"include":"omit");const _="credentials"in Request.prototype;f=new Request(e,{...m,signal:p,method:n.toUpperCase(),headers:l.normalize().toJSON(),body:r,duplex:"half",credentials:_?d:void 0});let y=await fetch(f);const E=Ld&&(c==="stream"||c==="response");if(Ld&&(o||E&&g)){const w={};["status","statusText","headers"].forEach(D=>{w[D]=y[D]});const O=H.toFiniteNumber(y.headers.get("content-length")),[S,x]=o&&$m(O,Nu(qm(o),!0))||[];y=new Response(zm(y.body,Wm,S,()=>{x&&x(),g&&g()}),w)}c=c||"text";let I=await Ru[H.findKey(Ru,c)||"text"](y,t);return!E&&g&&g(),await new Promise((w,O)=>{Yb(w,O,{data:I,headers:nn.from(y.headers),status:y.status,statusText:y.statusText,config:t,request:f})})}catch(_){throw g&&g(),_&&_.name==="TypeError"&&/fetch/i.test(_.message)?Object.assign(new Se("Network Error",Se.ERR_NETWORK,t,f),{cause:_.cause||_}):Se.from(_,_&&_.code,t,f)}}),Dd={http:eS,xhr:NS,fetch:US};H.forEach(Dd,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const Gm=t=>`- ${t}`,jS=t=>H.isFunction(t)||t===null||t===!1,e_={getAdapter:t=>{t=H.isArray(t)?t:[t];const{length:e}=t;let n,r;const s={};for(let a=0;a<e;a++){n=t[a];let i;if(r=n,!jS(n)&&(r=Dd[(i=String(n)).toLowerCase()],r===void 0))throw new Se(`Unknown adapter '${i}'`);if(r)break;s[i||"#"+a]=r}if(!r){const a=Object.entries(s).map(([o,u])=>`adapter ${o} `+(u===!1?"is not supported by the environment":"is not available in the build"));let i=e?a.length>1?`since :
`+a.map(Gm).join(`
`):" "+Gm(a[0]):"as no adapter specified";throw new Se("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return r},adapters:Dd};function yl(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new _a(null,t)}function Km(t){return yl(t),t.headers=nn.from(t.headers),t.data=_l.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),e_.getAdapter(t.adapter||eo.adapter)(t).then(function(e){return yl(t),e.data=_l.call(t,t.transformResponse,e),e.headers=nn.from(e.headers),e},function(e){return Kb(e)||(yl(t),e&&e.response&&(e.response.data=_l.call(t,t.transformResponse,e.response),e.response.headers=nn.from(e.response.headers))),Promise.reject(e)})}const t_="1.7.7",Qh={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Qh[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const Ym={};Qh.transitional=function(t,e,n){function r(s,a){return"[Axios v"+t_+"] Transitional option '"+s+"'"+a+(n?". "+n:"")}return(s,a,i)=>{if(t===!1)throw new Se(r(a," has been removed"+(e?" in "+e:"")),Se.ERR_DEPRECATED);return e&&!Ym[a]&&(Ym[a]=!0,console.warn(r(a," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(s,a,i):!0}};function HS(t,e,n){if(typeof t!="object")throw new Se("options must be an object",Se.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let s=r.length;for(;s-- >0;){const a=r[s],i=e[a];if(i){const o=t[a],u=o===void 0||i(o,a,t);if(u!==!0)throw new Se("option "+a+" must be "+u,Se.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Se("Unknown option "+a,Se.ERR_BAD_OPTION)}}const Md={assertOptions:HS,validators:Qh},Pr=Md.validators;let ds=class{constructor(t){this.defaults=t,this.interceptors={request:new jm,response:new jm}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const s=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=bs(this.defaults,e);const{transitional:n,paramsSerializer:r,headers:s}=e;n!==void 0&&Md.assertOptions(n,{silentJSONParsing:Pr.transitional(Pr.boolean),forcedJSONParsing:Pr.transitional(Pr.boolean),clarifyTimeoutError:Pr.transitional(Pr.boolean)},!1),r!=null&&(H.isFunction(r)?e.paramsSerializer={serialize:r}:Md.assertOptions(r,{encode:Pr.function,serialize:Pr.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let a=s&&H.merge(s.common,s[e.method]);s&&H.forEach(["delete","get","head","post","put","patch","common"],p=>{delete s[p]}),e.headers=nn.concat(a,s);const i=[];let o=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(e)===!1||(o=o&&p.synchronous,i.unshift(p.fulfilled,p.rejected))});const u=[];this.interceptors.response.forEach(function(p){u.push(p.fulfilled,p.rejected)});let c,l=0,d;if(!o){const p=[Km.bind(this),void 0];for(p.unshift.apply(p,i),p.push.apply(p,u),d=p.length,c=Promise.resolve(e);l<d;)c=c.then(p[l++],p[l++]);return c}d=i.length;let m=e;for(l=0;l<d;){const p=i[l++],f=i[l++];try{m=p(m)}catch(g){f.call(this,g);break}}try{c=Km.call(this,m)}catch(p){return Promise.reject(p)}for(l=0,d=u.length;l<d;)c=c.then(u[l++],u[l++]);return c}getUri(t){t=bs(this.defaults,t);const e=Zb(t.baseURL,t.url);return zb(e,t.params,t.paramsSerializer)}};H.forEach(["delete","get","head","options"],function(t){ds.prototype[t]=function(e,n){return this.request(bs(n||{},{method:t,url:e,data:(n||{}).data}))}});H.forEach(["post","put","patch"],function(t){function e(n){return function(r,s,a){return this.request(bs(a||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:s}))}}ds.prototype[t]=e(),ds.prototype[t+"Form"]=e(!0)});let $S=class n_{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(s){n=s});const r=this;this.promise.then(s=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](s);r._listeners=null}),this.promise.then=s=>{let a;const i=new Promise(o=>{r.subscribe(o),a=o}).then(s);return i.cancel=function(){r.unsubscribe(a)},i},e(function(s,a,i){r.reason||(r.reason=new _a(s,a,i),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=r=>{e.abort(r)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new n_(function(n){e=n}),cancel:e}}};function qS(t){return function(e){return t.apply(null,e)}}function VS(t){return H.isObject(t)&&t.isAxiosError===!0}const Bd={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Bd).forEach(([t,e])=>{Bd[e]=t});function r_(t){const e=new ds(t),n=xb(ds.prototype.request,e);return H.extend(n,ds.prototype,e,{allOwnKeys:!0}),H.extend(n,e,null,{allOwnKeys:!0}),n.create=function(r){return r_(bs(t,r))},n}const lt=r_(eo);lt.Axios=ds;lt.CanceledError=_a;lt.CancelToken=$S;lt.isCancel=Kb;lt.VERSION=t_;lt.toFormData=Ac;lt.AxiosError=Se;lt.Cancel=lt.CanceledError;lt.all=function(t){return Promise.all(t)};lt.spread=qS;lt.isAxiosError=VS;lt.mergeConfig=bs;lt.AxiosHeaders=nn;lt.formToJSON=t=>Gb(H.isHTMLForm(t)?new FormData(t):t);lt.getAdapter=e_.getAdapter;lt.HttpStatusCode=Bd;lt.default=lt;const{Axios:uU,AxiosError:cU,CanceledError:lU,isCancel:dU,CancelToken:hU,VERSION:fU,all:mU,Cancel:pU,isAxiosError:gU,spread:bU,toFormData:_U,AxiosHeaders:zS,HttpStatusCode:Io,formToJSON:yU,getAdapter:EU,mergeConfig:wU}=lt;var qs=null;typeof WebSocket<"u"?qs=WebSocket:typeof MozWebSocket<"u"?qs=MozWebSocket:typeof global<"u"?qs=global.WebSocket||global.MozWebSocket:typeof window<"u"?qs=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(qs=self.WebSocket||self.MozWebSocket);const WS=qs,vc=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder;typeof TextEncoder=="function"&&new TextEncoder;const GS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ya=Array.prototype.slice.call(GS),ko=(t=>{let e={};return t.forEach((n,r)=>e[n]=r),e})(Ya),KS=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,gu=String.fromCharCode.bind(String),Zm=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),YS=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),s_=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),ZS=t=>{let e,n,r,s,a="";const i=t.length%3;for(let o=0;o<t.length;){if((n=t.charCodeAt(o++))>255||(r=t.charCodeAt(o++))>255||(s=t.charCodeAt(o++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|s,a+=Ya[e>>18&63]+Ya[e>>12&63]+Ya[e>>6&63]+Ya[e&63]}return i?a.slice(0,i-3)+"===".substring(i):a},JS=typeof btoa=="function"?t=>btoa(t):vc?t=>Buffer.from(t,"binary").toString("base64"):ZS,Jm=vc?t=>Buffer.from(t).toString("base64"):t=>{let e=[];for(let n=0,r=t.length;n<r;n+=4096)e.push(gu.apply(null,t.subarray(n,n+4096)));return JS(e.join(""))},XS=(t,e=!1)=>e?YS(Jm(t)):Jm(t),QS=t=>{if(t=t.replace(/\s+/g,""),!KS.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",r,s;for(let a=0;a<t.length;)e=ko[t.charAt(a++)]<<18|ko[t.charAt(a++)]<<12|(r=ko[t.charAt(a++)])<<6|(s=ko[t.charAt(a++)]),n+=r===64?gu(e>>16&255):s===64?gu(e>>16&255,e>>8&255):gu(e>>16&255,e>>8&255,e&255);return n},eA=typeof atob=="function"?t=>atob(s_(t)):vc?t=>Buffer.from(t,"base64").toString("binary"):QS,tA=vc?t=>Zm(Buffer.from(t,"base64")):t=>Zm(eA(t).split("").map(e=>e.charCodeAt(0))),nA=t=>tA(rA(t)),rA=t=>s_(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),sA=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,aA=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,iA=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function oA(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){uA(t);return}return e}function uA(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function cA(t,e={}){if(typeof t!="string")return t;const n=t.trim();if(t[0]==='"'&&t.endsWith('"')&&!t.includes("\\"))return n.slice(1,-1);if(n.length<=9){const r=n.toLowerCase();if(r==="true")return!0;if(r==="false")return!1;if(r==="undefined")return;if(r==="null")return null;if(r==="nan")return Number.NaN;if(r==="infinity")return Number.POSITIVE_INFINITY;if(r==="-infinity")return Number.NEGATIVE_INFINITY}if(!iA.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(sA.test(t)||aA.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,oA)}return JSON.parse(t)}catch(r){if(e.strict)throw r;return t}}const lA=/#/g,dA=/&/g,hA=/\//g,fA=/=/g,ef=/\+/g,mA=/%5e/gi,pA=/%60/gi,gA=/%7c/gi,bA=/%20/gi;function _A(t){return encodeURI(""+t).replace(gA,"|")}function Fd(t){return _A(typeof t=="string"?t:JSON.stringify(t)).replace(ef,"%2B").replace(bA,"+").replace(lA,"%23").replace(dA,"%26").replace(pA,"`").replace(mA,"^").replace(hA,"%2F")}function El(t){return Fd(t).replace(fA,"%3D")}function a_(t=""){try{return decodeURIComponent(""+t)}catch{return""+t}}function yA(t){return a_(t.replace(ef," "))}function EA(t){return a_(t.replace(ef," "))}function wA(t=""){const e={};t[0]==="?"&&(t=t.slice(1));for(const n of t.split("&")){const r=n.match(/([^=]+)=?(.*)/)||[];if(r.length<2)continue;const s=yA(r[1]);if(s==="__proto__"||s==="constructor")continue;const a=EA(r[2]||"");e[s]===void 0?e[s]=a:Array.isArray(e[s])?e[s].push(a):e[s]=[e[s],a]}return e}function TA(t,e){return(typeof e=="number"||typeof e=="boolean")&&(e=String(e)),e?Array.isArray(e)?e.map(n=>`${El(t)}=${Fd(n)}`).join("&"):`${El(t)}=${Fd(e)}`:El(t)}function SA(t){return Object.keys(t).filter(e=>t[e]!==void 0).map(e=>TA(e,t[e])).filter(Boolean).join("&")}const AA=/^[\s\w\0+.-]{2,}:([/\\]{1,2})/,CA=/^[\s\w\0+.-]{2,}:([/\\]{2})?/,vA=/^([/\\]\s*){2,}[^/\\]/,OA=/^\.?\//;function i_(t,e={}){return typeof e=="boolean"&&(e={acceptRelative:e}),e.strict?AA.test(t):CA.test(t)||(e.acceptRelative?vA.test(t):!1)}function IA(t="",e){return t.endsWith("/")}function kA(t="",e){return(IA(t)?t.slice(0,-1):t)||"/"}function NA(t="",e){return t.endsWith("/")?t:t+"/"}function RA(t,e){if(xA(e)||i_(t))return t;const n=kA(e);return t.startsWith(n)?t:DA(n,t)}function PA(t,e){const n=MA(t),r={...wA(n.search),...e};return n.search=SA(r),BA(n)}function xA(t){return!t||t==="/"}function LA(t){return t&&t!=="/"}function DA(t,...e){let n=t||"";for(const r of e.filter(s=>LA(s)))if(n){const s=r.replace(OA,"");n=NA(n)+s}else n=r;return n}const o_=Symbol.for("ufo:protocolRelative");function MA(t="",e){const n=t.match(/^[\s\0]*(blob:|data:|javascript:|vbscript:)(.*)/i);if(n){const[,d,m=""]=n;return{protocol:d.toLowerCase(),pathname:m,href:d+m,auth:"",host:"",search:"",hash:""}}if(!i_(t,{acceptRelative:!0}))return Xm(t);const[,r="",s,a=""]=t.replace(/\\/g,"/").match(/^[\s\0]*([\w+.-]{2,}:)?\/\/([^/@]+@)?(.*)/)||[];let[,i="",o=""]=a.match(/([^#/?]*)(.*)?/)||[];r==="file:"&&(o=o.replace(/\/(?=[A-Za-z]:)/,""));const{pathname:u,search:c,hash:l}=Xm(o);return{protocol:r.toLowerCase(),auth:s?s.slice(0,Math.max(0,s.length-1)):"",host:i,pathname:u,search:c,hash:l,[o_]:!r}}function Xm(t=""){const[e="",n="",r=""]=(t.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:e,search:n,hash:r}}function BA(t){const e=t.pathname||"",n=t.search?(t.search.startsWith("?")?"":"?")+t.search:"",r=t.hash||"",s=t.auth?t.auth+"@":"",a=t.host||"";return(t.protocol||t[o_]?(t.protocol||"")+"//":"")+s+a+e+n+r}class FA extends Error{constructor(e,n){super(e,n),this.name="FetchError",n!=null&&n.cause&&!this.cause&&(this.cause=n.cause)}}function UA(t){var e,n,r,s,a;const i=((e=t.error)==null?void 0:e.message)||((n=t.error)==null?void 0:n.toString())||"",o=((r=t.request)==null?void 0:r.method)||((s=t.options)==null?void 0:s.method)||"GET",u=((a=t.request)==null?void 0:a.url)||String(t.request)||"/",c=`[${o}] ${JSON.stringify(u)}`,l=t.response?`${t.response.status} ${t.response.statusText}`:"<no response>",d=`${c}: ${l}${i?` ${i}`:""}`,m=new FA(d,t.error?{cause:t.error}:void 0);for(const p of["request","options","response"])Object.defineProperty(m,p,{get(){return t[p]}});for(const[p,f]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(m,p,{get(){return t.response&&t.response[f]}});return m}const jA=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function Qm(t="GET"){return jA.has(t.toUpperCase())}function HA(t){if(t===void 0)return!1;const e=typeof t;return e==="string"||e==="number"||e==="boolean"||e===null?!0:e!=="object"?!1:Array.isArray(t)?!0:t.buffer?!1:t.constructor&&t.constructor.name==="Object"||typeof t.toJSON=="function"}const $A=new Set(["image/svg","application/xml","application/xhtml","application/html"]),qA=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function VA(t=""){if(!t)return"json";const e=t.split(";").shift()||"";return qA.test(e)?"json":$A.has(e)||e.startsWith("text/")?"text":"blob"}function zA(t,e,n,r){const s=WA((e==null?void 0:e.headers)??(t==null?void 0:t.headers),n==null?void 0:n.headers,r);let a;return(n!=null&&n.query||n!=null&&n.params||e!=null&&e.params||e!=null&&e.query)&&(a={...n==null?void 0:n.params,...n==null?void 0:n.query,...e==null?void 0:e.params,...e==null?void 0:e.query}),{...n,...e,query:a,params:a,headers:s}}function WA(t,e,n){if(!e)return new n(t);const r=new n(e);if(t)for(const[s,a]of Symbol.iterator in t||Array.isArray(t)?t:new n(t))r.set(s,a);return r}async function No(t,e){if(e)if(Array.isArray(e))for(const n of e)await n(t);else await e(t)}const GA=new Set([408,409,425,429,500,502,503,504]),KA=new Set([101,204,205,304]);function u_(t={}){const{fetch:e=globalThis.fetch,Headers:n=globalThis.Headers,AbortController:r=globalThis.AbortController}=t;async function s(o){const u=o.error&&o.error.name==="AbortError"&&!o.options.timeout||!1;if(o.options.retry!==!1&&!u){let l;typeof o.options.retry=="number"?l=o.options.retry:l=Qm(o.options.method)?0:1;const d=o.response&&o.response.status||500;if(l>0&&(Array.isArray(o.options.retryStatusCodes)?o.options.retryStatusCodes.includes(d):GA.has(d))){const m=typeof o.options.retryDelay=="function"?o.options.retryDelay(o):o.options.retryDelay||0;return m>0&&await new Promise(p=>setTimeout(p,m)),a(o.request,{...o.options,retry:l-1})}}const c=UA(o);throw Error.captureStackTrace&&Error.captureStackTrace(c,a),c}const a=async function(o,u={}){const c={request:o,options:zA(o,u,t.defaults,n),response:void 0,error:void 0};c.options.method&&(c.options.method=c.options.method.toUpperCase()),c.options.onRequest&&await No(c,c.options.onRequest),typeof c.request=="string"&&(c.options.baseURL&&(c.request=RA(c.request,c.options.baseURL)),c.options.query&&(c.request=PA(c.request,c.options.query),delete c.options.query),"query"in c.options&&delete c.options.query,"params"in c.options&&delete c.options.params),c.options.body&&Qm(c.options.method)&&(HA(c.options.body)?(c.options.body=typeof c.options.body=="string"?c.options.body:JSON.stringify(c.options.body),c.options.headers=new n(c.options.headers||{}),c.options.headers.has("content-type")||c.options.headers.set("content-type","application/json"),c.options.headers.has("accept")||c.options.headers.set("accept","application/json")):("pipeTo"in c.options.body&&typeof c.options.body.pipeTo=="function"||typeof c.options.body.pipe=="function")&&("duplex"in c.options||(c.options.duplex="half")));let l;if(!c.options.signal&&c.options.timeout){const d=new r;l=setTimeout(()=>{const m=new Error("[TimeoutError]: The operation was aborted due to timeout");m.name="TimeoutError",m.code=23,d.abort(m)},c.options.timeout),c.options.signal=d.signal}try{c.response=await e(c.request,c.options)}catch(d){return c.error=d,c.options.onRequestError&&await No(c,c.options.onRequestError),await s(c)}finally{l&&clearTimeout(l)}if((c.response.body||c.response._bodyInit)&&!KA.has(c.response.status)&&c.options.method!=="HEAD"){const d=(c.options.parseResponse?"json":c.options.responseType)||VA(c.response.headers.get("content-type")||"");switch(d){case"json":{const m=await c.response.text(),p=c.options.parseResponse||cA;c.response._data=p(m);break}case"stream":{c.response._data=c.response.body||c.response._bodyInit;break}default:c.response._data=await c.response[d]()}}return c.options.onResponse&&await No(c,c.options.onResponse),!c.options.ignoreResponseError&&c.response.status>=400&&c.response.status<600?(c.options.onResponseError&&await No(c,c.options.onResponseError),await s(c)):c.response},i=async function(o,u){return(await a(o,u))._data};return i.raw=a,i.native=(...o)=>e(...o),i.create=(o={},u={})=>u_({...t,...u,defaults:{...t.defaults,...u.defaults,...o}}),i}const Pu=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),YA=Pu.fetch?(...t)=>Pu.fetch(...t):()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!")),ZA=Pu.Headers,JA=Pu.AbortController,ep=u_({fetch:YA,Headers:ZA,AbortController:JA}),wl={SCHEMA_DIR_RELATIVE_PATH:"./../schemas/",SCHEMA_FILENAME_PAYLOAD:"payload.schema.json",SCHEMA_FILENAME_RESPONSE:"response.schema.json",SIYUAN_DEFAULT_BASE_URL:"http://localhost:6806/",REQUEST_TIMEOUT:6e4};class XA extends Error{constructor(e){super(e.statusText),ln(this,"status"),this.response=e,this.status=e.status}}class tp extends Error{constructor(e,n){super(e.msg),ln(this,"code"),ln(this,"msg"),ln(this,"data"),this.body=e,this.response=n,this.code=e.code,this.msg=e.msg,this.data=e.data}}var np,rp,sp,ap,ip;const Ud=class P{constructor(e={},n="xhr"){ln(this,"_type","xhr"),ln(this,"_baseURL",((rp=(np=globalThis.top)==null?void 0:np.document)==null?void 0:rp.baseURI)??((ap=(sp=globalThis.parent)==null?void 0:sp.document)==null?void 0:ap.baseURI)??((ip=globalThis.location)==null?void 0:ip.origin)??wl.SIYUAN_DEFAULT_BASE_URL),ln(this,"_token",null),ln(this,"_ofetch_options",{baseURL:this._baseURL,headers:this._headers}),ln(this,"_axios_options",{baseURL:this._baseURL,timeout:wl.REQUEST_TIMEOUT,headers:this._headers}),ln(this,"_fetch",ep.create(this._ofetch_options)),ln(this,"_axios",lt.create(this._axios_options)),this._setClientType(n),this._updateOptions(e,n)}static headers2record(e){const n={};return e.forEach((r,s)=>{n[s]=r}),n}static headers2records(e){const n=[];return e.forEach((r,s)=>{n.push({[s]:r})}),n}static headers2entries(e){const n=[];return Object.entries(e).forEach(([r,s])=>{s.forEach(a=>n.push([r,a]))}),n}static entries2record(e){const n={};for(const[r,s]of e)n[r]=s;return n}get _authorization(){return`Token ${this._token}`}get _headers(){return this._token!==null?{Authorization:this._authorization}:{}}_setClientType(e){this._type=e}_updateOptions(e,n=this._type){switch(this._baseURL=e.baseURL??this._baseURL,e.token){case void 0:break;case null:default:this._token=e.token,delete e.token;break}switch(n){case"fetch":{const r=e;switch(!0){case Array.isArray(r.headers):{r.headers.find(([s])=>s.toLowerCase()==="Authorization".toLowerCase())||r.headers.push(["Authorization",this._authorization]);break}case r.headers instanceof Headers:{r.headers.has("Authorization")||r.headers.set("Authorization",this._authorization);break}case typeof r.headers=="object":{"Authorization"in r.headers||(r.headers.Authorization=this._authorization);break}default:{r.headers=this._headers;break}}this._ofetch_options=r,this._fetch=ep.create(this._ofetch_options);break}case"xhr":default:{const r=e;if(r.headers)switch(!0){case r.headers instanceof zS:{r.headers.has("Authorization")||r.headers.set("Authorization",this._authorization);break}case typeof r.headers=="object":{switch(!0){case("common"in r.headers||"get"in r.headers||"post"in r.headers):{"common"in r.headers&&("Authorization"in r.headers.get||(r.headers.get.Authorization=this._authorization)),"get"in r.headers&&("Authorization"in r.headers.get||(r.headers.get.Authorization=this._authorization)),"post"in r.headers&&("Authorization"in r.headers.post||(r.headers.post.Authorization=this._authorization));break}default:{"Authorization"in r.headers||(r.headers.Authorization=this._authorization);break}}break}default:{r.headers=this._headers;break}}else r.headers=this._headers;this._axios_options=r,this._axios=lt.create(this._axios_options);break}}}async $fetch(e,n){const r=new Request(e,n),s=await this.forwardProxy({url:r.url,method:r.method,headers:P.headers2records(r.headers),payload:XS(new Uint8Array(await r.arrayBuffer())),timeout:wl.REQUEST_TIMEOUT,contentType:"application/json",payloadEncoding:"base64",responseEncoding:"base64"});return new Response(nA(s.data.body),{status:s.data.status,statusText:s.msg,headers:new Headers(P.headers2entries(s.data.headers))})}broadcast(e,n,r){var s;const a=(r==null?void 0:r.baseURL)??this._baseURL,i=(r==null?void 0:r.token)??this._token,o=new URLSearchParams(e);i&&o.set("token",i);const u=new URL(a,(s=globalThis.location)==null?void 0:s.href);return u.protocol=u.protocol.replace(/^http/,"ws"),u.pathname=u.pathname.endsWith("/")?`${u.pathname}${P.ws.broadcast.pathname.substring(1)}`:`${u.pathname}${P.ws.broadcast.pathname}`,u.search=o.toString(),new WS(u,n)}async upload(e,n){const r=new FormData;return e.id!=null&&r.append("id",e.id),e.assetsDirPath!=null&&r.append("assetsDirPath",e.assetsDirPath),e.skipIfDuplicated!=null&&r.append("skipIfDuplicated",String(e.skipIfDuplicated)),e.files.forEach(s=>r.append("file[]",s)),await this._request(P.api.asset.upload.pathname,P.api.asset.upload.method,r,n)}async getBlockAttrs(e,n){return await this._request(P.api.attr.getBlockAttrs.pathname,P.api.attr.getBlockAttrs.method,e,n)}async getBookmarkLabels(e){return await this._request(P.api.attr.getBookmarkLabels.pathname,P.api.attr.getBookmarkLabels.method,void 0,e)}async setBlockAttrs(e,n){return await this._request(P.api.attr.setBlockAttrs.pathname,P.api.attr.setBlockAttrs.method,e,n)}async appendBlock(e,n){return await this._request(P.api.block.appendBlock.pathname,P.api.block.appendBlock.method,e,n)}async deleteBlock(e,n){return await this._request(P.api.block.deleteBlock.pathname,P.api.block.deleteBlock.method,e,n)}async foldBlock(e,n){return await this._request(P.api.block.foldBlock.pathname,P.api.block.foldBlock.method,e,n)}async getBlockBreadcrumb(e,n){return await this._request(P.api.block.getBlockBreadcrumb.pathname,P.api.block.getBlockBreadcrumb.method,e,n)}async getBlockDOM(e,n){return await this._request(P.api.block.getBlockDOM.pathname,P.api.block.getBlockDOM.method,e,n)}async getBlockInfo(e,n){return await this._request(P.api.block.getBlockInfo.pathname,P.api.block.getBlockInfo.method,e,n)}async getBlockKramdown(e,n){return await this._request(P.api.block.getBlockKramdown.pathname,P.api.block.getBlockKramdown.method,e,n)}async getChildBlocks(e,n){return await this._request(P.api.block.getChildBlocks.pathname,P.api.block.getChildBlocks.method,e,n)}async getDocInfo(e,n){return await this._request(P.api.block.getDocInfo.pathname,P.api.block.getDocInfo.method,e,n)}async insertBlock(e,n){return await this._request(P.api.block.insertBlock.pathname,P.api.block.insertBlock.method,e,n)}async moveBlock(e,n){return await this._request(P.api.block.moveBlock.pathname,P.api.block.moveBlock.method,e,n)}async prependBlock(e,n){return await this._request(P.api.block.prependBlock.pathname,P.api.block.prependBlock.method,e,n)}async transferBlockRef(e,n){return await this._request(P.api.block.transferBlockRef.pathname,P.api.block.transferBlockRef.method,e,n)}async unfoldBlock(e,n){return await this._request(P.api.block.unfoldBlock.pathname,P.api.block.unfoldBlock.method,e,n)}async updateBlock(e,n){return await this._request(P.api.block.updateBlock.pathname,P.api.block.updateBlock.method,e,n)}async getChannelInfo(e,n){return await this._request(P.api.broadcast.getChannelInfo.pathname,P.api.broadcast.getChannelInfo.method,e,n)}async getChannels(e){return await this._request(P.api.broadcast.getChannels.pathname,P.api.broadcast.getChannels.method,void 0,e)}async postMessage(e,n){return await this._request(P.api.broadcast.postMessage.pathname,P.api.broadcast.postMessage.method,e,n)}async pandoc(e,n){return await this._request(P.api.convert.pandoc.pathname,P.api.convert.pandoc.method,e,n)}async exportHTML(e,n){return await this._request(P.api.export.exportHTML.pathname,P.api.export.exportHTML.method,e,n)}async exportMdContent(e,n){return await this._request(P.api.export.exportMdContent.pathname,P.api.export.exportMdContent.method,e,n)}async exportResources(e,n){return await this._request(P.api.export.exportResources.pathname,P.api.export.exportResources.method,e,n)}async getFile(e,n="text",r){return await this._request(P.api.file.getFile.pathname,P.api.file.getFile.method,e,r,!1,n)}async putFile(e,n){e.file!==void 0&&!(e.file instanceof File)&&(e.file=new File([e.file],e.path.split("/").pop()));const r=new FormData;for(const[s,a]of Object.entries(e))a instanceof Blob?r.append(s,a):r.append(s,String(a));return await this._request(P.api.file.putFile.pathname,P.api.file.putFile.method,r,n)}async readDir(e,n){return await this._request(P.api.file.readDir.pathname,P.api.file.readDir.method,e,n)}async removeFile(e,n){return await this._request(P.api.file.removeFile.pathname,P.api.file.removeFile.method,e,n)}async renameFile(e,n){return await this._request(P.api.file.renameFile.pathname,P.api.file.renameFile.method,e,n)}async createDailyNote(e,n){return await this._request(P.api.filetree.createDailyNote.pathname,P.api.filetree.createDailyNote.method,e,n)}async createDocWithMd(e,n){return await this._request(P.api.filetree.createDocWithMd.pathname,P.api.filetree.createDocWithMd.method,e,n)}async getDoc(e,n){return await this._request(P.api.filetree.getDoc.pathname,P.api.filetree.getDoc.method,e,n)}async getHPathByID(e,n){return await this._request(P.api.filetree.getHPathByID.pathname,P.api.filetree.getHPathByID.method,e,n)}async getHPathByPath(e,n){return await this._request(P.api.filetree.getHPathByPath.pathname,P.api.filetree.getHPathByPath.method,e,n)}async getIDsByHPath(e,n){return await this._request(P.api.filetree.getIDsByHPath.pathname,P.api.filetree.getIDsByHPath.method,e,n)}async listDocsByPath(e,n){return await this._request(P.api.filetree.listDocsByPath.pathname,P.api.filetree.listDocsByPath.method,e,n)}async moveDocs(e,n){return await this._request(P.api.filetree.moveDocs.pathname,P.api.filetree.moveDocs.method,e,n)}async removeDoc(e,n){return await this._request(P.api.filetree.removeDoc.pathname,P.api.filetree.removeDoc.method,e,n)}async renameDoc(e,n){return await this._request(P.api.filetree.renameDoc.pathname,P.api.filetree.renameDoc.method,e,n)}async searchDocs(e,n){return await this._request(P.api.filetree.searchDocs.pathname,P.api.filetree.searchDocs.method,e,n)}async getDocHistoryContent(e,n){return await this._request(P.api.history.getDocHistoryContent.pathname,P.api.history.getDocHistoryContent.method,e,n)}async getHistoryItems(e,n){return await this._request(P.api.history.getHistoryItems.pathname,P.api.history.getHistoryItems.method,e,n)}async getShorthand(e,n){return await this._request(P.api.inbox.getShorthand.pathname,P.api.inbox.getShorthand.method,e,n)}async echo(e,n){if(e)switch(n??(n={type:this._type}),n==null?void 0:n.type){case"fetch":{const r={};e.headers&&(r.headers=e.headers),e.query&&(r.query=P.entries2record(e.query.entries())),n.options?Object.assign(r,n.options):n.options=r;break}case"xhr":{const r={};e.headers&&(r.headers=Array.isArray(e.headers)?P.entries2record(e.headers):e.headers instanceof Headers?P.headers2record(e.headers):e.headers),e.query&&(r.params=e.query),n.options?Object.assign(r,n.options):n.options=r;break}}return await this._request(P.api.network.echo.pathname,(e==null?void 0:e.method)??P.api.network.echo.method,e==null?void 0:e.body,n)}async forwardProxy(e,n){return await this._request(P.api.network.forwardProxy.pathname,P.api.network.forwardProxy.method,e,n)}async closeNotebook(e,n){return await this._request(P.api.notebook.closeNotebook.pathname,P.api.notebook.closeNotebook.method,e,n)}async createNotebook(e,n){return await this._request(P.api.notebook.createNotebook.pathname,P.api.notebook.createNotebook.method,e,n)}async getNotebookConf(e,n){return await this._request(P.api.notebook.getNotebookConf.pathname,P.api.notebook.getNotebookConf.method,e,n)}async lsNotebooks(e){return await this._request(P.api.notebook.lsNotebooks.pathname,P.api.notebook.lsNotebooks.method,void 0,e)}async openNotebook(e,n){return await this._request(P.api.notebook.openNotebook.pathname,P.api.notebook.openNotebook.method,e,n)}async removeNotebook(e,n){return await this._request(P.api.notebook.removeNotebook.pathname,P.api.notebook.removeNotebook.method,e,n)}async renameNotebook(e,n){return await this._request(P.api.notebook.renameNotebook.pathname,P.api.notebook.renameNotebook.method,e,n)}async setNotebookConf(e,n){return await this._request(P.api.notebook.setNotebookConf.pathname,P.api.notebook.setNotebookConf.method,e,n)}async pushErrMsg(e,n){return await this._request(P.api.notification.pushErrMsg.pathname,P.api.notification.pushErrMsg.method,e,n)}async pushMsg(e,n){return await this._request(P.api.notification.pushMsg.pathname,P.api.notification.pushMsg.method,e,n)}async getDocOutline(e,n){return await this._request(P.api.outline.getDocOutline.pathname,P.api.outline.getDocOutline.method,e,n)}async sql(e,n){return await this._request(P.api.query.sql.pathname,P.api.query.sql.method,e,n)}async openRepoSnapshotDoc(e,n){return await this._request(P.api.repo.openRepoSnapshotDoc.pathname,P.api.repo.openRepoSnapshotDoc.method,e,n)}async fullTextSearchBlock(e,n){return await this._request(P.api.search.fullTextSearchBlock.pathname,P.api.search.fullTextSearchBlock.method,e,n)}async getSnippet(e,n){return await this._request(P.api.snippet.getSnippet.pathname,P.api.snippet.getSnippet.method,e,n)}async setSnippet(e,n){return await this._request(P.api.snippet.setSnippet.pathname,P.api.snippet.setSnippet.method,e,n)}async flushTransaction(e){return await this._request(P.api.sqlite.flushTransaction.pathname,P.api.sqlite.flushTransaction.method,e)}async getLocalStorage(e){return await this._request(P.api.storage.getLocalStorage.pathname,P.api.storage.getLocalStorage.method,void 0,e)}async getRecentDocs(e){return await this._request(P.api.storage.getRecentDocs.pathname,P.api.storage.getRecentDocs.method,void 0,e)}async setLocalStorage(e,n){return await this._request(P.api.storage.setLocalStorage.pathname,P.api.storage.setLocalStorage.method,e,n)}async setLocalStorageVal(e,n){return await this._request(P.api.storage.setLocalStorageVal.pathname,P.api.storage.setLocalStorageVal.method,e,n)}async bootProgress(e){return await this._request(P.api.system.bootProgress.pathname,P.api.system.bootProgress.method,void 0,e)}async currentTime(e){return await this._request(P.api.system.currentTime.pathname,P.api.system.currentTime.method,void 0,e)}async exit(e,n){return await this._request(P.api.system.exit.pathname,P.api.system.exit.method,e,n)}async getConf(e){return await this._request(P.api.system.getConf.pathname,P.api.system.getConf.method,void 0,e)}async logoutAuth(e){return await this._request(P.api.system.logoutAuth.pathname,P.api.system.logoutAuth.method,void 0,e)}async version(e){return await this._request(P.api.system.version.pathname,P.api.system.version.method,void 0,e)}async render(e,n){return await this._request(P.api.template.render.pathname,P.api.template.render.method,e,n)}async renderSprig(e,n){return await this._request(P.api.template.renderSprig.pathname,P.api.template.renderSprig.method,e,n)}async _request(e,n,r,s,a=!0,i="json"){switch((s==null?void 0:s.type)??this._type){case"fetch":{const o=s==null?void 0:s.options;i=(()=>{switch(i){case"arraybuffer":return"arrayBuffer";case"document":return"text";default:return i}})();const u=await this._fetch(e,{method:n,body:r,responseType:i,onResponse:c=>{switch(c.response.status){case Io.Ok:switch(i){case"blob":c.response._data.contentType=c.response.headers.get("content-type");break}break;case Io.Accepted:e===P.api.file.getFile.pathname&&this._parseFetchResponse(c.response._data);break}},...o});return a&&i==="json"&&typeof u=="object"?this._parseFetchResponse(u):u}case"xhr":default:{const o=s==null?void 0:s.options;i=(()=>{switch(i){case"arrayBuffer":return"arraybuffer";default:return i}})();const u=await this._axios.request({url:e,method:n,data:r,responseType:i,...o});switch(u.status){case Io.Ok:if(a&&i==="json"&&typeof u.data=="object")return this._parseAxiosResponse(u);switch(i){case"blob":"content-type"in u.headers&&(u.data.contentType=u.headers["content-type"]);break}return u.data;case Io.Accepted:return e===P.api.file.getFile.pathname?this._parseAxiosResponse(u):u.data;default:throw new XA(u)}}}}_parseFetchResponse(e){if(e.code===0)return e;throw new tp(e)}_parseAxiosResponse(e){if(e.data.code===0)return e.data;throw new tp(e.data,e)}};ln(Ud,"ws",{broadcast:{pathname:"/ws/broadcast"}}),ln(Ud,"api",{asset:{upload:{pathname:"/api/asset/upload",method:"POST"}},attr:{getBlockAttrs:{pathname:"/api/attr/getBlockAttrs",method:"POST"},getBookmarkLabels:{pathname:"/api/attr/getBookmarkLabels",method:"POST"},setBlockAttrs:{pathname:"/api/attr/setBlockAttrs",method:"POST"}},block:{appendBlock:{pathname:"/api/block/appendBlock",method:"POST"},deleteBlock:{pathname:"/api/block/deleteBlock",method:"POST"},foldBlock:{pathname:"/api/block/foldBlock",method:"POST"},getBlockBreadcrumb:{pathname:"/api/block/getBlockBreadcrumb",method:"POST"},getBlockDOM:{pathname:"/api/block/getBlockDOM",method:"POST"},getBlockInfo:{pathname:"/api/block/getBlockInfo",method:"POST"},getBlockKramdown:{pathname:"/api/block/getBlockKramdown",method:"POST"},getChildBlocks:{pathname:"/api/block/getChildBlocks",method:"POST"},getDocInfo:{pathname:"/api/block/getDocInfo",method:"POST"},insertBlock:{pathname:"/api/block/insertBlock",method:"POST"},moveBlock:{pathname:"/api/block/moveBlock",method:"POST"},prependBlock:{pathname:"/api/block/prependBlock",method:"POST"},transferBlockRef:{pathname:"/api/block/transferBlockRef",method:"POST"},unfoldBlock:{pathname:"/api/block/unfoldBlock",method:"POST"},updateBlock:{pathname:"/api/block/updateBlock",method:"POST"}},broadcast:{getChannelInfo:{pathname:"/api/broadcast/getChannelInfo",method:"POST"},getChannels:{pathname:"/api/broadcast/getChannels",method:"POST"},postMessage:{pathname:"/api/broadcast/postMessage",method:"POST"}},convert:{pandoc:{pathname:"/api/convert/pandoc",method:"POST"}},export:{exportHTML:{pathname:"/api/export/exportHTML",method:"POST"},exportMdContent:{pathname:"/api/export/exportMdContent",method:"POST"},exportResources:{pathname:"/api/export/exportResources",method:"POST"}},file:{getFile:{pathname:"/api/file/getFile",method:"POST"},putFile:{pathname:"/api/file/putFile",method:"POST"},readDir:{pathname:"/api/file/readDir",method:"POST"},removeFile:{pathname:"/api/file/removeFile",method:"POST"},renameFile:{pathname:"/api/file/renameFile",method:"POST"}},filetree:{createDailyNote:{pathname:"/api/filetree/createDailyNote",method:"POST"},createDocWithMd:{pathname:"/api/filetree/createDocWithMd",method:"POST"},getDoc:{pathname:"/api/filetree/getDoc",method:"POST"},getHPathByID:{pathname:"/api/filetree/getHPathByID",method:"POST"},getHPathByPath:{pathname:"/api/filetree/getHPathByPath",method:"POST"},getIDsByHPath:{pathname:"/api/filetree/getIDsByHPath",method:"POST"},listDocsByPath:{pathname:"/api/filetree/listDocsByPath",method:"POST"},moveDocs:{pathname:"/api/filetree/moveDocs",method:"POST"},removeDoc:{pathname:"/api/filetree/removeDoc",method:"POST"},renameDoc:{pathname:"/api/filetree/renameDoc",method:"POST"},searchDocs:{pathname:"/api/filetree/searchDocs",method:"POST"}},history:{getDocHistoryContent:{pathname:"/api/history/getDocHistoryContent",method:"POST"},getHistoryItems:{pathname:"/api/history/getHistoryItems",method:"POST"}},inbox:{getShorthand:{pathname:"/api/inbox/getShorthand",method:"POST"}},network:{echo:{pathname:"/api/network/echo",method:"POST"},forwardProxy:{pathname:"/api/network/forwardProxy",method:"POST"}},notebook:{closeNotebook:{pathname:"/api/notebook/closeNotebook",method:"POST"},createNotebook:{pathname:"/api/notebook/createNotebook",method:"POST"},getNotebookConf:{pathname:"/api/notebook/getNotebookConf",method:"POST"},lsNotebooks:{pathname:"/api/notebook/lsNotebooks",method:"POST"},openNotebook:{pathname:"/api/notebook/openNotebook",method:"POST"},removeNotebook:{pathname:"/api/notebook/removeNotebook",method:"POST"},renameNotebook:{pathname:"/api/notebook/renameNotebook",method:"POST"},setNotebookConf:{pathname:"/api/notebook/setNotebookConf",method:"POST"}},notification:{pushErrMsg:{pathname:"/api/notification/pushErrMsg",method:"POST"},pushMsg:{pathname:"/api/notification/pushMsg",method:"POST"}},outline:{getDocOutline:{pathname:"/api/outline/getDocOutline",method:"POST"}},query:{sql:{pathname:"/api/query/sql",method:"POST"}},repo:{openRepoSnapshotDoc:{pathname:"/api/repo/openRepoSnapshotDoc",method:"POST"}},search:{fullTextSearchBlock:{pathname:"/api/search/fullTextSearchBlock",method:"POST"}},snippet:{getSnippet:{pathname:"/api/snippet/getSnippet",method:"POST"},setSnippet:{pathname:"/api/snippet/setSnippet",method:"POST"}},sqlite:{flushTransaction:{pathname:"/api/sqlite/flushTransaction",method:"POST"}},storage:{getLocalStorage:{pathname:"/api/storage/getLocalStorage",method:"POST"},getRecentDocs:{pathname:"/api/storage/getRecentDocs",method:"POST"},setLocalStorage:{pathname:"/api/storage/setLocalStorage",method:"POST"},setLocalStorageVal:{pathname:"/api/storage/setLocalStorageVal",method:"POST"}},system:{bootProgress:{pathname:"/api/system/bootProgress",method:"POST"},currentTime:{pathname:"/api/system/currentTime",method:"POST"},exit:{pathname:"/api/system/exit",method:"POST"},getConf:{pathname:"/api/system/getConf",method:"POST"},logoutAuth:{pathname:"/api/system/logoutAuth",method:"POST"},version:{pathname:"/api/system/version",method:"POST"}},template:{render:{pathname:"/api/template/render",method:"POST"},renderSprig:{pathname:"/api/template/renderSprig",method:"POST"}}});let QA=Ud;function Qn(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}function op(t,e){for(var n="",r=0,s=-1,a=0,i,o=0;o<=t.length;++o){if(o<t.length)i=t.charCodeAt(o);else{if(i===47)break;i=47}if(i===47){if(!(s===o-1||a===1))if(s!==o-1&&a===2){if(n.length<2||r!==2||n.charCodeAt(n.length-1)!==46||n.charCodeAt(n.length-2)!==46){if(n.length>2){var u=n.lastIndexOf("/");if(u!==n.length-1){u===-1?(n="",r=0):(n=n.slice(0,u),r=n.length-1-n.lastIndexOf("/")),s=o,a=0;continue}}else if(n.length===2||n.length===1){n="",r=0,s=o,a=0;continue}}e&&(n.length>0?n+="/..":n="..",r=2)}else n.length>0?n+="/"+t.slice(s+1,o):n=t.slice(s+1,o),r=o-s-1;s=o,a=0}else i===46&&a!==-1?++a:a=-1}return n}function e2(t,e){var n=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return n?n===e.root?n+r:n+t+r:r}var oi={resolve:function(){for(var t="",e=!1,n,r=arguments.length-1;r>=-1&&!e;r--){var s;r>=0?s=arguments[r]:(n===void 0&&(n=process.cwd()),s=n),Qn(s),s.length!==0&&(t=s+"/"+t,e=s.charCodeAt(0)===47)}return t=op(t,!e),e?t.length>0?"/"+t:"/":t.length>0?t:"."},normalize:function(t){if(Qn(t),t.length===0)return".";var e=t.charCodeAt(0)===47,n=t.charCodeAt(t.length-1)===47;return t=op(t,!e),t.length===0&&!e&&(t="."),t.length>0&&n&&(t+="/"),e?"/"+t:t},isAbsolute:function(t){return Qn(t),t.length>0&&t.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var t,e=0;e<arguments.length;++e){var n=arguments[e];Qn(n),n.length>0&&(t===void 0?t=n:t+="/"+n)}return t===void 0?".":oi.normalize(t)},relative:function(t,e){if(Qn(t),Qn(e),t===e||(t=oi.resolve(t),e=oi.resolve(e),t===e))return"";for(var n=1;n<t.length&&t.charCodeAt(n)===47;++n);for(var r=t.length,s=r-n,a=1;a<e.length&&e.charCodeAt(a)===47;++a);for(var i=e.length,o=i-a,u=s<o?s:o,c=-1,l=0;l<=u;++l){if(l===u){if(o>u){if(e.charCodeAt(a+l)===47)return e.slice(a+l+1);if(l===0)return e.slice(a+l)}else s>u&&(t.charCodeAt(n+l)===47?c=l:l===0&&(c=0));break}var d=t.charCodeAt(n+l),m=e.charCodeAt(a+l);if(d!==m)break;d===47&&(c=l)}var p="";for(l=n+c+1;l<=r;++l)(l===r||t.charCodeAt(l)===47)&&(p.length===0?p+="..":p+="/..");return p.length>0?p+e.slice(a+c):(a+=c,e.charCodeAt(a)===47&&++a,e.slice(a))},_makeLong:function(t){return t},dirname:function(t){if(Qn(t),t.length===0)return".";for(var e=t.charCodeAt(0),n=e===47,r=-1,s=!0,a=t.length-1;a>=1;--a)if(e=t.charCodeAt(a),e===47){if(!s){r=a;break}}else s=!1;return r===-1?n?"/":".":n&&r===1?"//":t.slice(0,r)},basename:function(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');Qn(t);var n=0,r=-1,s=!0,a;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";var i=e.length-1,o=-1;for(a=t.length-1;a>=0;--a){var u=t.charCodeAt(a);if(u===47){if(!s){n=a+1;break}}else o===-1&&(s=!1,o=a+1),i>=0&&(u===e.charCodeAt(i)?--i===-1&&(r=a):(i=-1,r=o))}return n===r?r=o:r===-1&&(r=t.length),t.slice(n,r)}else{for(a=t.length-1;a>=0;--a)if(t.charCodeAt(a)===47){if(!s){n=a+1;break}}else r===-1&&(s=!1,r=a+1);return r===-1?"":t.slice(n,r)}},extname:function(t){Qn(t);for(var e=-1,n=0,r=-1,s=!0,a=0,i=t.length-1;i>=0;--i){var o=t.charCodeAt(i);if(o===47){if(!s){n=i+1;break}continue}r===-1&&(s=!1,r=i+1),o===46?e===-1?e=i:a!==1&&(a=1):e!==-1&&(a=-1)}return e===-1||r===-1||a===0||a===1&&e===r-1&&e===n+1?"":t.slice(e,r)},format:function(t){if(t===null||typeof t!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof t);return e2("/",t)},parse:function(t){Qn(t);var e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;var n=t.charCodeAt(0),r=n===47,s;r?(e.root="/",s=1):s=0;for(var a=-1,i=0,o=-1,u=!0,c=t.length-1,l=0;c>=s;--c){if(n=t.charCodeAt(c),n===47){if(!u){i=c+1;break}continue}o===-1&&(u=!1,o=c+1),n===46?a===-1?a=c:l!==1&&(l=1):a!==-1&&(l=-1)}return a===-1||o===-1||l===0||l===1&&a===o-1&&a===i+1?o!==-1&&(i===0&&r?e.base=e.name=t.slice(1,o):e.base=e.name=t.slice(i,o)):(i===0&&r?(e.name=t.slice(1,a),e.base=t.slice(1,o)):(e.name=t.slice(i,a),e.base=t.slice(i,o)),e.ext=t.slice(a,o)),i>0?e.dir=t.slice(0,i-1):r&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};oi.posix=oi;async function ks(t,e){let n=await en.fetchSyncPost(t,e);return n.code===0?n.data:null}async function c_(t){return ks("/api/block/getChildBlocks",{id:t})}async function t2(t){return ks("/api/block/getBlockIndex",{id:t})}async function ea(t,e=7e3){return ks("/api/notification/pushMsg",{msg:t,timeout:e})}async function to(t,e=7e3){return ks("/api/notification/pushErrMsg",{msg:t,timeout:e})}async function n2(){return ks("/api/notebook/lsNotebooks","")}function l_(){var n;let t=((n=window.getSelection())==null?void 0:n.toString())||"";return t||(document.querySelectorAll(".protyle-wysiwyg--select").forEach(r=>{const s=r.textContent;t+=`
`+s}),t)}function d_(){var r;let t="",e="";return t=(r=document.getElementsByClassName("protyle-title__input")[0])==null?void 0:r.textContent,document.querySelectorAll("[data-node-index]").forEach(s=>{e+=s.textContent+`
`}),{title:t,content:e}}function et(){}function xu(t,e){for(const n in e)t[n]=e[n];return t}function h_(t){return t()}function up(){return Object.create(null)}function ct(t){t.forEach(h_)}function f_(t){return typeof t=="function"}function tt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function r2(t){return Object.keys(t).length===0}function tf(t,e,n,r){if(t){const s=m_(t,e,n,r);return t[0](s)}}function m_(t,e,n,r){return t[1]&&r?xu(n.ctx.slice(),t[1](r(e))):n.ctx}function nf(t,e,n,r){if(t[2]&&r){const s=t[2](r(n));if(e.dirty===void 0)return s;if(typeof s=="object"){const a=[],i=Math.max(e.dirty.length,s.length);for(let o=0;o<i;o+=1)a[o]=e.dirty[o]|s[o];return a}return e.dirty|s}return e.dirty}function rf(t,e,n,r,s,a){if(s){const i=m_(e,n,r,a);t.p(i,s)}}function sf(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function cp(t){const e={};for(const n in t)n[0]!=="$"&&(e[n]=t[n]);return e}const s2=["",!0,1,"true","contenteditable"];function k(t,e){t.appendChild(e)}function he(t,e,n){t.insertBefore(e,n||null)}function de(t){t.parentNode&&t.parentNode.removeChild(t)}function Ns(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function F(t){return document.createElement(t)}function dn(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Ye(t){return document.createTextNode(t)}function te(){return Ye(" ")}function Oc(){return Ye("")}function ie(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function p_(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function C(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}const a2=["width","height"];function lp(t,e){const n=Object.getOwnPropertyDescriptors(t.__proto__);for(const r in e)e[r]==null?t.removeAttribute(r):r==="style"?t.style.cssText=e[r]:r==="__value"?t.value=t[r]=e[r]:n[r]&&n[r].set&&a2.indexOf(r)===-1?t[r]=e[r]:C(t,r,e[r])}function jd(t){return t===""?null:+t}function i2(t){return Array.from(t.childNodes)}function dt(t,e){e=""+e,t.data!==e&&(t.data=e)}function o2(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function u2(t,e,n){~s2.indexOf(n)?o2(t,e):dt(t,e)}function vt(t,e){t.value=e??""}function Ht(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,"")}function dp(t,e,n){for(let r=0;r<t.options.length;r+=1){const s=t.options[r];if(s.__value===e){s.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function c2(t){const e=t.querySelector(":checked");return e&&e.__value}function ke(t,e,n){t.classList.toggle(e,!!n)}function l2(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}let Si;function ui(t){Si=t}function af(){if(!Si)throw new Error("Function called outside component initialization");return Si}function no(t){af().$$.on_mount.push(t)}function d2(t){af().$$.after_update.push(t)}function Wn(){const t=af();return(e,n,{cancelable:r=!1}={})=>{const s=t.$$.callbacks[e];if(s){const a=l2(e,n,{cancelable:r});return s.slice().forEach(i=>{i.call(t,a)}),!a.defaultPrevented}return!0}}function h2(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const Vs=[],fe=[];let ta=[];const Hd=[],f2=Promise.resolve();let $d=!1;function m2(){$d||($d=!0,f2.then(g_))}function Lu(t){ta.push(t)}function ye(t){Hd.push(t)}const Tl=new Set;let Ls=0;function g_(){if(Ls!==0)return;const t=Si;do{try{for(;Ls<Vs.length;){const e=Vs[Ls];Ls++,ui(e),p2(e.$$)}}catch(e){throw Vs.length=0,Ls=0,e}for(ui(null),Vs.length=0,Ls=0;fe.length;)fe.pop()();for(let e=0;e<ta.length;e+=1){const n=ta[e];Tl.has(n)||(Tl.add(n),n())}ta.length=0}while(Vs.length);for(;Hd.length;)Hd.pop()();$d=!1,Tl.clear(),ui(t)}function p2(t){if(t.fragment!==null){t.update(),ct(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Lu)}}function g2(t){const e=[],n=[];ta.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),ta=e}const bu=new Set;let is;function hr(){is={r:0,c:[],p:is}}function fr(){is.r||ct(is.c),is=is.p}function ae(t,e){t&&t.i&&(bu.delete(t),t.i(e))}function le(t,e,n,r){if(t&&t.o){if(bu.has(t))return;bu.add(t),is.c.push(()=>{bu.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function Ot(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function b2(t,e){t.d(1),e.delete(t.key)}function _2(t,e){le(t,1,1,()=>{e.delete(t.key)})}function b_(t,e,n,r,s,a,i,o,u,c,l,d){let m=t.length,p=a.length,f=m;const g={};for(;f--;)g[t[f].key]=f;const b=[],_=new Map,y=new Map,E=[];for(f=p;f--;){const S=d(s,a,f),x=n(S);let D=i.get(x);D?E.push(()=>D.p(S,e)):(D=c(x,S),D.c()),_.set(x,b[f]=D),x in g&&y.set(x,Math.abs(f-g[x]))}const I=new Set,w=new Set;function O(S){ae(S,1),S.m(o,l),i.set(S.key,S),l=S.first,p--}for(;m&&p;){const S=b[p-1],x=t[m-1],D=S.key,B=x.key;S===x?(l=S.first,m--,p--):_.has(B)?!i.has(D)||I.has(D)?O(S):w.has(B)?m--:y.get(D)>y.get(B)?(w.add(D),O(S)):(I.add(B),m--):(u(x,i),m--)}for(;m--;){const S=t[m];_.has(S.key)||u(S,i)}for(;p;)O(b[p-1]);return ct(E),b}function y2(t,e){const n={},r={},s={$$scope:1};let a=t.length;for(;a--;){const i=t[a],o=e[a];if(o){for(const u in i)u in o||(r[u]=1);for(const u in o)s[u]||(n[u]=o[u],s[u]=1);t[a]=o}else for(const u in i)s[u]=1}for(const i in r)i in n||(n[i]=void 0);return n}function Ee(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function Ve(t){t&&t.c()}function Be(t,e,n){const{fragment:r,after_update:s}=t.$$;r&&r.m(e,n),Lu(()=>{const a=t.$$.on_mount.map(h_).filter(f_);t.$$.on_destroy?t.$$.on_destroy.push(...a):ct(a),t.$$.on_mount=[]}),s.forEach(Lu)}function Fe(t,e){const n=t.$$;n.fragment!==null&&(g2(n.after_update),ct(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function E2(t,e){t.$$.dirty[0]===-1&&(Vs.push(t),m2(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function nt(t,e,n,r,s,a,i=null,o=[-1]){const u=Si;ui(t);const c=t.$$={fragment:null,ctx:[],props:a,update:et,not_equal:s,bound:up(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:up(),dirty:o,skip_bound:!1,root:e.target||u.$$.root};i&&i(c.root);let l=!1;if(c.ctx=n?n(t,e.props||{},(d,m,...p)=>{const f=p.length?p[0]:m;return c.ctx&&s(c.ctx[d],c.ctx[d]=f)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](f),l&&E2(t,d)),m}):[],c.update(),l=!0,ct(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const d=i2(e.target);c.fragment&&c.fragment.l(d),d.forEach(de)}else c.fragment&&c.fragment.c();e.intro&&ae(t.$$.fragment),Be(t,e.target,e.anchor),g_()}ui(u)}class rt{constructor(){we(this,"$$");we(this,"$$set")}$destroy(){Fe(this,1),this.$destroy=et}$on(e,n){if(!f_(n))return et;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const s=r.indexOf(n);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!r2(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const w2="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(w2);var T2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ro(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var __={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(T2,function(){var n=1e3,r=6e4,s=36e5,a="millisecond",i="second",o="minute",u="hour",c="day",l="week",d="month",m="quarter",p="year",f="date",g="Invalid Date",b=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,_=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(L){var N=["th","st","nd","rd"],U=L%100;return"["+L+(N[(U-20)%10]||N[U]||N[0])+"]"}},E=function(L,N,U){var V=String(L);return!V||V.length>=N?L:""+Array(N+1-V.length).join(U)+L},I={s:E,z:function(L){var N=-L.utcOffset(),U=Math.abs(N),V=Math.floor(U/60),M=U%60;return(N<=0?"+":"-")+E(V,2,"0")+":"+E(M,2,"0")},m:function L(N,U){if(N.date()<U.date())return-L(U,N);var V=12*(U.year()-N.year())+(U.month()-N.month()),M=N.clone().add(V,d),z=U-M<0,X=N.clone().add(V+(z?-1:1),d);return+(-(V+(U-M)/(z?M-X:X-M))||0)},a:function(L){return L<0?Math.ceil(L)||0:Math.floor(L)},p:function(L){return{M:d,y:p,w:l,d:c,D:f,h:u,m:o,s:i,ms:a,Q:m}[L]||String(L||"").toLowerCase().replace(/s$/,"")},u:function(L){return L===void 0}},w="en",O={};O[w]=y;var S="$isDayjsObject",x=function(L){return L instanceof K||!(!L||!L[S])},D=function L(N,U,V){var M;if(!N)return w;if(typeof N=="string"){var z=N.toLowerCase();O[z]&&(M=z),U&&(O[z]=U,M=z);var X=N.split("-");if(!M&&X.length>1)return L(X[0])}else{var W=N.name;O[W]=N,M=W}return!V&&M&&(w=M),M||!V&&w},B=function(L,N){if(x(L))return L.clone();var U=typeof N=="object"?N:{};return U.date=L,U.args=arguments,new K(U)},Q=I;Q.l=D,Q.i=x,Q.w=function(L,N){return B(L,{locale:N.$L,utc:N.$u,x:N.$x,$offset:N.$offset})};var K=function(){function L(U){this.$L=D(U.locale,null,!0),this.parse(U),this.$x=this.$x||U.x||{},this[S]=!0}var N=L.prototype;return N.parse=function(U){this.$d=function(V){var M=V.date,z=V.utc;if(M===null)return new Date(NaN);if(Q.u(M))return new Date;if(M instanceof Date)return new Date(M);if(typeof M=="string"&&!/Z$/i.test(M)){var X=M.match(b);if(X){var W=X[2]-1||0,se=(X[7]||"0").substring(0,3);return z?new Date(Date.UTC(X[1],W,X[3]||1,X[4]||0,X[5]||0,X[6]||0,se)):new Date(X[1],W,X[3]||1,X[4]||0,X[5]||0,X[6]||0,se)}}return new Date(M)}(U),this.init()},N.init=function(){var U=this.$d;this.$y=U.getFullYear(),this.$M=U.getMonth(),this.$D=U.getDate(),this.$W=U.getDay(),this.$H=U.getHours(),this.$m=U.getMinutes(),this.$s=U.getSeconds(),this.$ms=U.getMilliseconds()},N.$utils=function(){return Q},N.isValid=function(){return this.$d.toString()!==g},N.isSame=function(U,V){var M=B(U);return this.startOf(V)<=M&&M<=this.endOf(V)},N.isAfter=function(U,V){return B(U)<this.startOf(V)},N.isBefore=function(U,V){return this.endOf(V)<B(U)},N.$g=function(U,V,M){return Q.u(U)?this[V]:this.set(M,U)},N.unix=function(){return Math.floor(this.valueOf()/1e3)},N.valueOf=function(){return this.$d.getTime()},N.startOf=function(U,V){var M=this,z=!!Q.u(V)||V,X=Q.p(U),W=function(In,Et){var Xn=Q.w(M.$u?Date.UTC(M.$y,Et,In):new Date(M.$y,Et,In),M);return z?Xn:Xn.endOf(c)},se=function(In,Et){return Q.w(M.toDate()[In].apply(M.toDate("s"),(z?[0,0,0,0]:[23,59,59,999]).slice(Et)),M)},_e=this.$W,Pe=this.$M,Oe=this.$D,yt="set"+(this.$u?"UTC":"");switch(X){case p:return z?W(1,0):W(31,11);case d:return z?W(1,Pe):W(0,Pe+1);case l:var It=this.$locale().weekStart||0,Rr=(_e<It?_e+7:_e)-It;return W(z?Oe-Rr:Oe+(6-Rr),Pe);case c:case f:return se(yt+"Hours",0);case u:return se(yt+"Minutes",1);case o:return se(yt+"Seconds",2);case i:return se(yt+"Milliseconds",3);default:return this.clone()}},N.endOf=function(U){return this.startOf(U,!1)},N.$set=function(U,V){var M,z=Q.p(U),X="set"+(this.$u?"UTC":""),W=(M={},M[c]=X+"Date",M[f]=X+"Date",M[d]=X+"Month",M[p]=X+"FullYear",M[u]=X+"Hours",M[o]=X+"Minutes",M[i]=X+"Seconds",M[a]=X+"Milliseconds",M)[z],se=z===c?this.$D+(V-this.$W):V;if(z===d||z===p){var _e=this.clone().set(f,1);_e.$d[W](se),_e.init(),this.$d=_e.set(f,Math.min(this.$D,_e.daysInMonth())).$d}else W&&this.$d[W](se);return this.init(),this},N.set=function(U,V){return this.clone().$set(U,V)},N.get=function(U){return this[Q.p(U)]()},N.add=function(U,V){var M,z=this;U=Number(U);var X=Q.p(V),W=function(Pe){var Oe=B(z);return Q.w(Oe.date(Oe.date()+Math.round(Pe*U)),z)};if(X===d)return this.set(d,this.$M+U);if(X===p)return this.set(p,this.$y+U);if(X===c)return W(1);if(X===l)return W(7);var se=(M={},M[o]=r,M[u]=s,M[i]=n,M)[X]||1,_e=this.$d.getTime()+U*se;return Q.w(_e,this)},N.subtract=function(U,V){return this.add(-1*U,V)},N.format=function(U){var V=this,M=this.$locale();if(!this.isValid())return M.invalidDate||g;var z=U||"YYYY-MM-DDTHH:mm:ssZ",X=Q.z(this),W=this.$H,se=this.$m,_e=this.$M,Pe=M.weekdays,Oe=M.months,yt=M.meridiem,It=function(Et,Xn,xa,Oo){return Et&&(Et[Xn]||Et(V,z))||xa[Xn].slice(0,Oo)},Rr=function(Et){return Q.s(W%12||12,Et,"0")},In=yt||function(Et,Xn,xa){var Oo=Et<12?"AM":"PM";return xa?Oo.toLowerCase():Oo};return z.replace(_,function(Et,Xn){return Xn||function(xa){switch(xa){case"YY":return String(V.$y).slice(-2);case"YYYY":return Q.s(V.$y,4,"0");case"M":return _e+1;case"MM":return Q.s(_e+1,2,"0");case"MMM":return It(M.monthsShort,_e,Oe,3);case"MMMM":return It(Oe,_e);case"D":return V.$D;case"DD":return Q.s(V.$D,2,"0");case"d":return String(V.$W);case"dd":return It(M.weekdaysMin,V.$W,Pe,2);case"ddd":return It(M.weekdaysShort,V.$W,Pe,3);case"dddd":return Pe[V.$W];case"H":return String(W);case"HH":return Q.s(W,2,"0");case"h":return Rr(1);case"hh":return Rr(2);case"a":return In(W,se,!0);case"A":return In(W,se,!1);case"m":return String(se);case"mm":return Q.s(se,2,"0");case"s":return String(V.$s);case"ss":return Q.s(V.$s,2,"0");case"SSS":return Q.s(V.$ms,3,"0");case"Z":return X}return null}(Et)||X.replace(":","")})},N.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},N.diff=function(U,V,M){var z,X=this,W=Q.p(V),se=B(U),_e=(se.utcOffset()-this.utcOffset())*r,Pe=this-se,Oe=function(){return Q.m(X,se)};switch(W){case p:z=Oe()/12;break;case d:z=Oe();break;case m:z=Oe()/3;break;case l:z=(Pe-_e)/6048e5;break;case c:z=(Pe-_e)/864e5;break;case u:z=Pe/s;break;case o:z=Pe/r;break;case i:z=Pe/n;break;default:z=Pe}return M?z:Q.a(z)},N.daysInMonth=function(){return this.endOf(d).$D},N.$locale=function(){return O[this.$L]},N.locale=function(U,V){if(!U)return this.$L;var M=this.clone(),z=D(U,V,!0);return z&&(M.$L=z),M},N.clone=function(){return Q.w(this.$d,this)},N.toDate=function(){return new Date(this.valueOf())},N.toJSON=function(){return this.isValid()?this.toISOString():null},N.toISOString=function(){return this.$d.toISOString()},N.toString=function(){return this.$d.toUTCString()},L}(),ee=K.prototype;return B.prototype=ee,[["$ms",a],["$s",i],["$m",o],["$H",u],["$W",c],["$M",d],["$y",p],["$D",f]].forEach(function(L){ee[L[1]]=function(N){return this.$g(N,L[0],L[1])}}),B.extend=function(L,N){return L.$i||(L(N,K,B),L.$i=!0),B},B.locale=D,B.isDayjs=x,B.unix=function(L){return B(1e3*L)},B.en=O[w],B.Ls=O,B.p={},B})})(__);var S2=__.exports;const y_=ro(S2),qd="siyuan-ai-plugin-setting",Vd="siyuan-ai-plugin-chat-history",A2="siyuan-ai-plugin-image-history",zd="siyuan-ai-plugin-prompts",E_="siyuan-ai-plugin-blockid",Wd="siyuan-ai-plugin-document-vector",Ro=atob("aHR0cDovL25iMS5mcnAueWh0dWouY246MTYwNzg"),C2=atob("aHR0cDovL25iMS5mcnAueWh0dWouY246MTYwNzg"),v2=atob("aHR0cDovL25iMS5mcnAueWh0dWouY246MTM1NDE"),O2=atob("YzFiOWMwMzFkYWFhMzFmMDE2MzUxNzJmNWI1M2NkYTE"),I2=atob("aHR0cHM6Ly9zZWFyY2guZ2Vla3NwaGVyZS5vbmxpbmUv"),hp=atob("aHR0cDovL25iMS5mcnAueWh0dWouY246MTMwNTkvY2Fs"),fp=atob("aHR0cDovL25iMS5mcnAueWh0dWouY246MTMwNTkvY2Fs");atob("aHR0cDovL25iMS5mcnAueWh0dWouY246MTA5ODE");atob("cm9vdDo3emFJR3RUTHUyIXc5IWlTXmE2OQ");const k2=atob("aHR0cDovL25iMS5mcnAueWh0dWouY246MTMwNTk"),Sl=["qwen-vl-plus-latest","doubao-vision-pro-32k","qwen-vl-max-latest"],of=atob("aHR0cHM6Ly9vcGVuLmJpZ21vZGVsLmNuL2FwaS9wYWFzL3Y0L2ZpbGVz"),uf=atob("QmVhcmVyIGRhZGFkYjc2YjdmZTRkODc4ZTU0MmNkYTMxZDllOGMxLkNCSXlIckM3cFRsT1V2RTY");async function N2(t){let e={path:t},n="/api/file/getFile";return new Promise((r,s)=>{en.fetchPost(n,e,a=>{r(a)})})}async function R2(t,e,n){let r=new FormData;return r.append("path",t),r.append("isDir",e.toString()),r.append("modTime",Math.floor(Date.now()/1e3).toString()),r.append("file",n),ks("/api/file/putFile",r)}async function P2(t,e){return ks("/api/filetree/listDocTree",{notebook:t,path:e})}let os=class{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent!==void 0?e.pageContent.toString():"",this.metadata=e.metadata??{},this.id=e.id}};var Me;(function(t){t.assertEqual=s=>s;function e(s){}t.assertIs=e;function n(s){throw new Error}t.assertNever=n,t.arrayToEnum=s=>{const a={};for(const i of s)a[i]=i;return a},t.getValidEnumValues=s=>{const a=t.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(const o of a)i[o]=s[o];return t.objectValues(i)},t.objectValues=s=>t.objectKeys(s).map(function(a){return s[a]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},t.find=(s,a)=>{for(const i of s)if(a(i))return i},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}t.joinValues=r,t.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(Me||(Me={}));var Gd;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(Gd||(Gd={}));const re=Me.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Cr=t=>{switch(typeof t){case"undefined":return re.undefined;case"string":return re.string;case"number":return isNaN(t)?re.nan:re.number;case"boolean":return re.boolean;case"function":return re.function;case"bigint":return re.bigint;case"symbol":return re.symbol;case"object":return Array.isArray(t)?re.array:t===null?re.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?re.promise:typeof Map<"u"&&t instanceof Map?re.map:typeof Set<"u"&&t instanceof Set?re.set:typeof Date<"u"&&t instanceof Date?re.date:re.object;default:return re.unknown}},J=Me.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),x2=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class pn extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(a){return a.message},r={_errors:[]},s=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(n(i));else{let o=r,u=0;for(;u<i.path.length;){const c=i.path[u];u===i.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(n(i))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return s(this),r}static assert(e){if(!(e instanceof pn))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Me.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},r=[];for(const s of this.issues)s.path.length>0?(n[s.path[0]]=n[s.path[0]]||[],n[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}pn.create=t=>new pn(t);const ua=(t,e)=>{let n;switch(t.code){case J.invalid_type:t.received===re.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case J.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,Me.jsonStringifyReplacer)}`;break;case J.unrecognized_keys:n=`Unrecognized key(s) in object: ${Me.joinValues(t.keys,", ")}`;break;case J.invalid_union:n="Invalid input";break;case J.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Me.joinValues(t.options)}`;break;case J.invalid_enum_value:n=`Invalid enum value. Expected ${Me.joinValues(t.options)}, received '${t.received}'`;break;case J.invalid_arguments:n="Invalid function arguments";break;case J.invalid_return_type:n="Invalid function return type";break;case J.invalid_date:n="Invalid date";break;case J.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:Me.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case J.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case J.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case J.custom:n="Invalid input";break;case J.invalid_intersection_types:n="Intersection results could not be merged";break;case J.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case J.not_finite:n="Number must be finite";break;default:n=e.defaultError,Me.assertNever(t)}return{message:n}};let w_=ua;function L2(t){w_=t}function Du(){return w_}const Mu=t=>{const{data:e,path:n,errorMaps:r,issueData:s}=t,a=[...n,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="";const u=r.filter(c=>!!c).slice().reverse();for(const c of u)o=c(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}},D2=[];function ne(t,e){const n=Du(),r=Mu({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===ua?void 0:ua].filter(s=>!!s)});t.common.issues.push(r)}class Bt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const r=[];for(const s of n){if(s.status==="aborted")return ge;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){const r=[];for(const s of n){const a=await s.key,i=await s.value;r.push({key:a,value:i})}return Bt.mergeObjectSync(e,r)}static mergeObjectSync(e,n){const r={};for(const s of n){const{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return ge;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(r[a.value]=i.value)}return{status:e.value,value:r}}}const ge=Object.freeze({status:"aborted"}),Zs=t=>({status:"dirty",value:t}),$t=t=>({status:"valid",value:t}),Kd=t=>t.status==="aborted",Yd=t=>t.status==="dirty",_s=t=>t.status==="valid",Ai=t=>typeof Promise<"u"&&t instanceof Promise;function Bu(t,e,n,r){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(t)}function T_(t,e,n,r,s){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n}var oe;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(oe||(oe={}));var Za,Ja;class pr{constructor(e,n,r,s){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const mp=(t,e)=>{if(_s(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new pn(t.common.issues);return this._error=n,this._error}}};function Ce(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:r,description:s}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{var u,c;const{message:l}=t;return i.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:(u=l??r)!==null&&u!==void 0?u:o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:(c=l??n)!==null&&c!==void 0?c:o.defaultError}},description:s}}class Ne{get description(){return this._def.description}_getType(e){return Cr(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:Cr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Bt,ctx:{common:e.parent.common,data:e.data,parsedType:Cr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(Ai(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){var r;const s={common:{issues:[],async:(r=n==null?void 0:n.async)!==null&&r!==void 0?r:!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Cr(e)},a=this._parseSync({data:e,path:s.path,parent:s});return mp(s,a)}"~validate"(e){var n,r;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Cr(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:s});return _s(a)?{value:a.value}:{issues:s.common.issues}}catch(a){!((r=(n=a==null?void 0:a.message)===null||n===void 0?void 0:n.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(a=>_s(a)?{value:a.value}:{issues:s.common.issues})}async parseAsync(e,n){const r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Cr(e)},s=this._parse({data:e,path:r.path,parent:r}),a=await(Ai(s)?s:Promise.resolve(s));return mp(r,a)}refine(e,n){const r=s=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(s):n;return this._refinement((s,a)=>{const i=e(s),o=()=>a.addIssue({code:J.custom,...r(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(u=>u?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,n){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof n=="function"?n(r,s):n),!1))}_refinement(e){return new qn({schema:this,typeName:q.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return jn.create(this,this._def)}nullable(){return Gr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Un.create(this)}promise(){return la.create(this,this._def)}or(e){return Ii.create([this,e],this._def)}and(e){return ki.create(this,e,this._def)}transform(e){return new qn({...Ce(this._def),schema:this,typeName:q.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new Li({...Ce(this._def),innerType:this,defaultValue:n,typeName:q.ZodDefault})}brand(){return new cf({typeName:q.ZodBranded,type:this,...Ce(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new Di({...Ce(this._def),innerType:this,catchValue:n,typeName:q.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return so.create(this,e)}readonly(){return Mi.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const M2=/^c[^\s-]{8,}$/i,B2=/^[0-9a-z]+$/,F2=/^[0-9A-HJKMNP-TV-Z]{26}$/i,U2=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,j2=/^[a-z0-9_-]{21}$/i,H2=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,$2=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,q2=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,V2="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Al;const z2=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,W2=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,G2=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,K2=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Y2=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Z2=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,S_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",J2=new RegExp(`^${S_}$`);function A_(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function X2(t){return new RegExp(`^${A_(t)}$`)}function C_(t){let e=`${S_}T${A_(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function Q2(t,e){return!!((e==="v4"||!e)&&z2.test(t)||(e==="v6"||!e)&&G2.test(t))}function eC(t,e){if(!H2.test(t))return!1;try{const[n]=t.split("."),r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function tC(t,e){return!!((e==="v4"||!e)&&W2.test(t)||(e==="v6"||!e)&&K2.test(t))}class Mn extends Ne{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==re.string){const a=this._getOrReturnCtx(e);return ne(a,{code:J.invalid_type,expected:re.string,received:a.parsedType}),ge}const r=new Bt;let s;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),ne(s,{code:J.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),ne(s,{code:J.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?ne(s,{code:J.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&ne(s,{code:J.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")q2.test(e.data)||(s=this._getOrReturnCtx(e,s),ne(s,{validation:"email",code:J.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Al||(Al=new RegExp(V2,"u")),Al.test(e.data)||(s=this._getOrReturnCtx(e,s),ne(s,{validation:"emoji",code:J.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")U2.test(e.data)||(s=this._getOrReturnCtx(e,s),ne(s,{validation:"uuid",code:J.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")j2.test(e.data)||(s=this._getOrReturnCtx(e,s),ne(s,{validation:"nanoid",code:J.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")M2.test(e.data)||(s=this._getOrReturnCtx(e,s),ne(s,{validation:"cuid",code:J.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")B2.test(e.data)||(s=this._getOrReturnCtx(e,s),ne(s,{validation:"cuid2",code:J.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")F2.test(e.data)||(s=this._getOrReturnCtx(e,s),ne(s,{validation:"ulid",code:J.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),ne(s,{validation:"url",code:J.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),ne(s,{validation:"regex",code:J.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),ne(s,{code:J.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),ne(s,{code:J.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),ne(s,{code:J.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?C_(a).test(e.data)||(s=this._getOrReturnCtx(e,s),ne(s,{code:J.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?J2.test(e.data)||(s=this._getOrReturnCtx(e,s),ne(s,{code:J.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?X2(a).test(e.data)||(s=this._getOrReturnCtx(e,s),ne(s,{code:J.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?$2.test(e.data)||(s=this._getOrReturnCtx(e,s),ne(s,{validation:"duration",code:J.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?Q2(e.data,a.version)||(s=this._getOrReturnCtx(e,s),ne(s,{validation:"ip",code:J.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?eC(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),ne(s,{validation:"jwt",code:J.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?tC(e.data,a.version)||(s=this._getOrReturnCtx(e,s),ne(s,{validation:"cidr",code:J.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?Y2.test(e.data)||(s=this._getOrReturnCtx(e,s),ne(s,{validation:"base64",code:J.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?Z2.test(e.data)||(s=this._getOrReturnCtx(e,s),ne(s,{validation:"base64url",code:J.invalid_string,message:a.message}),r.dirty()):Me.assertNever(a);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(s=>e.test(s),{validation:n,code:J.invalid_string,...oe.errToObj(r)})}_addCheck(e){return new Mn({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...oe.errToObj(e)})}url(e){return this._addCheck({kind:"url",...oe.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...oe.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...oe.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...oe.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...oe.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...oe.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...oe.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...oe.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...oe.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...oe.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...oe.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...oe.errToObj(e)})}datetime(e){var n,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(n=e==null?void 0:e.offset)!==null&&n!==void 0?n:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...oe.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...oe.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...oe.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...oe.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...oe.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...oe.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...oe.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...oe.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...oe.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...oe.errToObj(n)})}nonempty(e){return this.min(1,oe.errToObj(e))}trim(){return new Mn({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Mn({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Mn({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Mn.create=t=>{var e;return new Mn({checks:[],typeName:q.ZodString,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...Ce(t)})};function nC(t,e){const n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=n>r?n:r,a=parseInt(t.toFixed(s).replace(".","")),i=parseInt(e.toFixed(s).replace(".",""));return a%i/Math.pow(10,s)}class Vr extends Ne{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==re.number){const a=this._getOrReturnCtx(e);return ne(a,{code:J.invalid_type,expected:re.number,received:a.parsedType}),ge}let r;const s=new Bt;for(const a of this._def.checks)a.kind==="int"?Me.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),ne(r,{code:J.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),ne(r,{code:J.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),ne(r,{code:J.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?nC(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),ne(r,{code:J.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),ne(r,{code:J.not_finite,message:a.message}),s.dirty()):Me.assertNever(a);return{status:s.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,oe.toString(n))}gt(e,n){return this.setLimit("min",e,!1,oe.toString(n))}lte(e,n){return this.setLimit("max",e,!0,oe.toString(n))}lt(e,n){return this.setLimit("max",e,!1,oe.toString(n))}setLimit(e,n,r,s){return new Vr({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:oe.toString(s)}]})}_addCheck(e){return new Vr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:oe.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:oe.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:oe.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:oe.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:oe.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:oe.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Me.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}}Vr.create=t=>new Vr({checks:[],typeName:q.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...Ce(t)});class zr extends Ne{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==re.bigint)return this._getInvalidInput(e);let r;const s=new Bt;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),ne(r,{code:J.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),ne(r,{code:J.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),ne(r,{code:J.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):Me.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return ne(n,{code:J.invalid_type,expected:re.bigint,received:n.parsedType}),ge}gte(e,n){return this.setLimit("min",e,!0,oe.toString(n))}gt(e,n){return this.setLimit("min",e,!1,oe.toString(n))}lte(e,n){return this.setLimit("max",e,!0,oe.toString(n))}lt(e,n){return this.setLimit("max",e,!1,oe.toString(n))}setLimit(e,n,r,s){return new zr({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:oe.toString(s)}]})}_addCheck(e){return new zr({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:oe.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:oe.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}zr.create=t=>{var e;return new zr({checks:[],typeName:q.ZodBigInt,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...Ce(t)})};class Ci extends Ne{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==re.boolean){const r=this._getOrReturnCtx(e);return ne(r,{code:J.invalid_type,expected:re.boolean,received:r.parsedType}),ge}return $t(e.data)}}Ci.create=t=>new Ci({typeName:q.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...Ce(t)});class ys extends Ne{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==re.date){const a=this._getOrReturnCtx(e);return ne(a,{code:J.invalid_type,expected:re.date,received:a.parsedType}),ge}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return ne(a,{code:J.invalid_date}),ge}const r=new Bt;let s;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),ne(s,{code:J.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),ne(s,{code:J.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):Me.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ys({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:oe.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:oe.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}ys.create=t=>new ys({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:q.ZodDate,...Ce(t)});class Fu extends Ne{_parse(e){if(this._getType(e)!==re.symbol){const r=this._getOrReturnCtx(e);return ne(r,{code:J.invalid_type,expected:re.symbol,received:r.parsedType}),ge}return $t(e.data)}}Fu.create=t=>new Fu({typeName:q.ZodSymbol,...Ce(t)});class vi extends Ne{_parse(e){if(this._getType(e)!==re.undefined){const r=this._getOrReturnCtx(e);return ne(r,{code:J.invalid_type,expected:re.undefined,received:r.parsedType}),ge}return $t(e.data)}}vi.create=t=>new vi({typeName:q.ZodUndefined,...Ce(t)});class Oi extends Ne{_parse(e){if(this._getType(e)!==re.null){const r=this._getOrReturnCtx(e);return ne(r,{code:J.invalid_type,expected:re.null,received:r.parsedType}),ge}return $t(e.data)}}Oi.create=t=>new Oi({typeName:q.ZodNull,...Ce(t)});class ca extends Ne{constructor(){super(...arguments),this._any=!0}_parse(e){return $t(e.data)}}ca.create=t=>new ca({typeName:q.ZodAny,...Ce(t)});class hs extends Ne{constructor(){super(...arguments),this._unknown=!0}_parse(e){return $t(e.data)}}hs.create=t=>new hs({typeName:q.ZodUnknown,...Ce(t)});class Nr extends Ne{_parse(e){const n=this._getOrReturnCtx(e);return ne(n,{code:J.invalid_type,expected:re.never,received:n.parsedType}),ge}}Nr.create=t=>new Nr({typeName:q.ZodNever,...Ce(t)});class Uu extends Ne{_parse(e){if(this._getType(e)!==re.undefined){const r=this._getOrReturnCtx(e);return ne(r,{code:J.invalid_type,expected:re.void,received:r.parsedType}),ge}return $t(e.data)}}Uu.create=t=>new Uu({typeName:q.ZodVoid,...Ce(t)});class Un extends Ne{_parse(e){const{ctx:n,status:r}=this._processInputParams(e),s=this._def;if(n.parsedType!==re.array)return ne(n,{code:J.invalid_type,expected:re.array,received:n.parsedType}),ge;if(s.exactLength!==null){const i=n.data.length>s.exactLength.value,o=n.data.length<s.exactLength.value;(i||o)&&(ne(n,{code:i?J.too_big:J.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&n.data.length<s.minLength.value&&(ne(n,{code:J.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&n.data.length>s.maxLength.value&&(ne(n,{code:J.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((i,o)=>s.type._parseAsync(new pr(n,i,n.path,o)))).then(i=>Bt.mergeArray(r,i));const a=[...n.data].map((i,o)=>s.type._parseSync(new pr(n,i,n.path,o)));return Bt.mergeArray(r,a)}get element(){return this._def.type}min(e,n){return new Un({...this._def,minLength:{value:e,message:oe.toString(n)}})}max(e,n){return new Un({...this._def,maxLength:{value:e,message:oe.toString(n)}})}length(e,n){return new Un({...this._def,exactLength:{value:e,message:oe.toString(n)}})}nonempty(e){return this.min(1,e)}}Un.create=(t,e)=>new Un({type:t,minLength:null,maxLength:null,exactLength:null,typeName:q.ZodArray,...Ce(e)});function zs(t){if(t instanceof ot){const e={};for(const n in t.shape){const r=t.shape[n];e[n]=jn.create(zs(r))}return new ot({...t._def,shape:()=>e})}else return t instanceof Un?new Un({...t._def,type:zs(t.element)}):t instanceof jn?jn.create(zs(t.unwrap())):t instanceof Gr?Gr.create(zs(t.unwrap())):t instanceof gr?gr.create(t.items.map(e=>zs(e))):t}class ot extends Ne{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=Me.objectKeys(e);return this._cached={shape:e,keys:n}}_parse(e){if(this._getType(e)!==re.object){const c=this._getOrReturnCtx(e);return ne(c,{code:J.invalid_type,expected:re.object,received:c.parsedType}),ge}const{status:r,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof Nr&&this._def.unknownKeys==="strip"))for(const c in s.data)i.includes(c)||o.push(c);const u=[];for(const c of i){const l=a[c],d=s.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new pr(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof Nr){const c=this._def.unknownKeys;if(c==="passthrough")for(const l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(c==="strict")o.length>0&&(ne(s,{code:J.unrecognized_keys,keys:o}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const l of o){const d=s.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new pr(s,d,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const c=[];for(const l of u){const d=await l.key,m=await l.value;c.push({key:d,value:m,alwaysSet:l.alwaysSet})}return c}).then(c=>Bt.mergeObjectSync(r,c)):Bt.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return oe.errToObj,new ot({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{var s,a,i,o;const u=(i=(a=(s=this._def).errorMap)===null||a===void 0?void 0:a.call(s,n,r).message)!==null&&i!==void 0?i:r.defaultError;return n.code==="unrecognized_keys"?{message:(o=oe.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new ot({...this._def,unknownKeys:"strip"})}passthrough(){return new ot({...this._def,unknownKeys:"passthrough"})}extend(e){return new ot({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ot({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:q.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new ot({...this._def,catchall:e})}pick(e){const n={};return Me.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(n[r]=this.shape[r])}),new ot({...this._def,shape:()=>n})}omit(e){const n={};return Me.objectKeys(this.shape).forEach(r=>{e[r]||(n[r]=this.shape[r])}),new ot({...this._def,shape:()=>n})}deepPartial(){return zs(this)}partial(e){const n={};return Me.objectKeys(this.shape).forEach(r=>{const s=this.shape[r];e&&!e[r]?n[r]=s:n[r]=s.optional()}),new ot({...this._def,shape:()=>n})}required(e){const n={};return Me.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])n[r]=this.shape[r];else{let a=this.shape[r];for(;a instanceof jn;)a=a._def.innerType;n[r]=a}}),new ot({...this._def,shape:()=>n})}keyof(){return v_(Me.objectKeys(this.shape))}}ot.create=(t,e)=>new ot({shape:()=>t,unknownKeys:"strip",catchall:Nr.create(),typeName:q.ZodObject,...Ce(e)});ot.strictCreate=(t,e)=>new ot({shape:()=>t,unknownKeys:"strict",catchall:Nr.create(),typeName:q.ZodObject,...Ce(e)});ot.lazycreate=(t,e)=>new ot({shape:t,unknownKeys:"strip",catchall:Nr.create(),typeName:q.ZodObject,...Ce(e)});class Ii extends Ne{_parse(e){const{ctx:n}=this._processInputParams(e),r=this._def.options;function s(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return n.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new pn(o.ctx.common.issues));return ne(n,{code:J.invalid_union,unionErrors:i}),ge}if(n.common.async)return Promise.all(r.map(async a=>{const i={...n,common:{...n.common,issues:[]},parent:null};return{result:await a._parseAsync({data:n.data,path:n.path,parent:i}),ctx:i}})).then(s);{let a;const i=[];for(const u of r){const c={...n,common:{...n.common,issues:[]},parent:null},l=u._parseSync({data:n.data,path:n.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!a&&(a={result:l,ctx:c}),c.common.issues.length&&i.push(c.common.issues)}if(a)return n.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(u=>new pn(u));return ne(n,{code:J.invalid_union,unionErrors:o}),ge}}get options(){return this._def.options}}Ii.create=(t,e)=>new Ii({options:t,typeName:q.ZodUnion,...Ce(e)});const wr=t=>t instanceof Ri?wr(t.schema):t instanceof qn?wr(t.innerType()):t instanceof Pi?[t.value]:t instanceof Wr?t.options:t instanceof xi?Me.objectValues(t.enum):t instanceof Li?wr(t._def.innerType):t instanceof vi?[void 0]:t instanceof Oi?[null]:t instanceof jn?[void 0,...wr(t.unwrap())]:t instanceof Gr?[null,...wr(t.unwrap())]:t instanceof cf||t instanceof Mi?wr(t.unwrap()):t instanceof Di?wr(t._def.innerType):[];class Ic extends Ne{_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==re.object)return ne(n,{code:J.invalid_type,expected:re.object,received:n.parsedType}),ge;const r=this.discriminator,s=n.data[r],a=this.optionsMap.get(s);return a?n.common.async?a._parseAsync({data:n.data,path:n.path,parent:n}):a._parseSync({data:n.data,path:n.path,parent:n}):(ne(n,{code:J.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),ge)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,r){const s=new Map;for(const a of n){const i=wr(a.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of i){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,a)}}return new Ic({typeName:q.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:s,...Ce(r)})}}function Zd(t,e){const n=Cr(t),r=Cr(e);if(t===e)return{valid:!0,data:t};if(n===re.object&&r===re.object){const s=Me.objectKeys(e),a=Me.objectKeys(t).filter(o=>s.indexOf(o)!==-1),i={...t,...e};for(const o of a){const u=Zd(t[o],e[o]);if(!u.valid)return{valid:!1};i[o]=u.data}return{valid:!0,data:i}}else if(n===re.array&&r===re.array){if(t.length!==e.length)return{valid:!1};const s=[];for(let a=0;a<t.length;a++){const i=t[a],o=e[a],u=Zd(i,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return n===re.date&&r===re.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class ki extends Ne{_parse(e){const{status:n,ctx:r}=this._processInputParams(e),s=(a,i)=>{if(Kd(a)||Kd(i))return ge;const o=Zd(a.value,i.value);return o.valid?((Yd(a)||Yd(i))&&n.dirty(),{status:n.value,value:o.data}):(ne(r,{code:J.invalid_intersection_types}),ge)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}ki.create=(t,e,n)=>new ki({left:t,right:e,typeName:q.ZodIntersection,...Ce(n)});class gr extends Ne{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==re.array)return ne(r,{code:J.invalid_type,expected:re.array,received:r.parsedType}),ge;if(r.data.length<this._def.items.length)return ne(r,{code:J.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ge;!this._def.rest&&r.data.length>this._def.items.length&&(ne(r,{code:J.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const a=[...r.data].map((i,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new pr(r,i,r.path,o)):null}).filter(i=>!!i);return r.common.async?Promise.all(a).then(i=>Bt.mergeArray(n,i)):Bt.mergeArray(n,a)}get items(){return this._def.items}rest(e){return new gr({...this._def,rest:e})}}gr.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new gr({items:t,typeName:q.ZodTuple,rest:null,...Ce(e)})};class Ni extends Ne{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==re.object)return ne(r,{code:J.invalid_type,expected:re.object,received:r.parsedType}),ge;const s=[],a=this._def.keyType,i=this._def.valueType;for(const o in r.data)s.push({key:a._parse(new pr(r,o,r.path,o)),value:i._parse(new pr(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Bt.mergeObjectAsync(n,s):Bt.mergeObjectSync(n,s)}get element(){return this._def.valueType}static create(e,n,r){return n instanceof Ne?new Ni({keyType:e,valueType:n,typeName:q.ZodRecord,...Ce(r)}):new Ni({keyType:Mn.create(),valueType:e,typeName:q.ZodRecord,...Ce(n)})}}class ju extends Ne{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==re.map)return ne(r,{code:J.invalid_type,expected:re.map,received:r.parsedType}),ge;const s=this._def.keyType,a=this._def.valueType,i=[...r.data.entries()].map(([o,u],c)=>({key:s._parse(new pr(r,o,r.path,[c,"key"])),value:a._parse(new pr(r,u,r.path,[c,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of i){const c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return ge;(c.status==="dirty"||l.status==="dirty")&&n.dirty(),o.set(c.value,l.value)}return{status:n.value,value:o}})}else{const o=new Map;for(const u of i){const c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return ge;(c.status==="dirty"||l.status==="dirty")&&n.dirty(),o.set(c.value,l.value)}return{status:n.value,value:o}}}}ju.create=(t,e,n)=>new ju({valueType:e,keyType:t,typeName:q.ZodMap,...Ce(n)});class Es extends Ne{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==re.set)return ne(r,{code:J.invalid_type,expected:re.set,received:r.parsedType}),ge;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(ne(r,{code:J.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),n.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(ne(r,{code:J.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),n.dirty());const a=this._def.valueType;function i(u){const c=new Set;for(const l of u){if(l.status==="aborted")return ge;l.status==="dirty"&&n.dirty(),c.add(l.value)}return{status:n.value,value:c}}const o=[...r.data.values()].map((u,c)=>a._parse(new pr(r,u,r.path,c)));return r.common.async?Promise.all(o).then(u=>i(u)):i(o)}min(e,n){return new Es({...this._def,minSize:{value:e,message:oe.toString(n)}})}max(e,n){return new Es({...this._def,maxSize:{value:e,message:oe.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}Es.create=(t,e)=>new Es({valueType:t,minSize:null,maxSize:null,typeName:q.ZodSet,...Ce(e)});class na extends Ne{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==re.function)return ne(n,{code:J.invalid_type,expected:re.function,received:n.parsedType}),ge;function r(o,u){return Mu({data:o,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Du(),ua].filter(c=>!!c),issueData:{code:J.invalid_arguments,argumentsError:u}})}function s(o,u){return Mu({data:o,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Du(),ua].filter(c=>!!c),issueData:{code:J.invalid_return_type,returnTypeError:u}})}const a={errorMap:n.common.contextualErrorMap},i=n.data;if(this._def.returns instanceof la){const o=this;return $t(async function(...u){const c=new pn([]),l=await o._def.args.parseAsync(u,a).catch(p=>{throw c.addIssue(r(u,p)),c}),d=await Reflect.apply(i,this,l);return await o._def.returns._def.type.parseAsync(d,a).catch(p=>{throw c.addIssue(s(d,p)),c})})}else{const o=this;return $t(function(...u){const c=o._def.args.safeParse(u,a);if(!c.success)throw new pn([r(u,c.error)]);const l=Reflect.apply(i,this,c.data),d=o._def.returns.safeParse(l,a);if(!d.success)throw new pn([s(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new na({...this._def,args:gr.create(e).rest(hs.create())})}returns(e){return new na({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,r){return new na({args:e||gr.create([]).rest(hs.create()),returns:n||hs.create(),typeName:q.ZodFunction,...Ce(r)})}}class Ri extends Ne{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}Ri.create=(t,e)=>new Ri({getter:t,typeName:q.ZodLazy,...Ce(e)});class Pi extends Ne{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return ne(n,{received:n.data,code:J.invalid_literal,expected:this._def.value}),ge}return{status:"valid",value:e.data}}get value(){return this._def.value}}Pi.create=(t,e)=>new Pi({value:t,typeName:q.ZodLiteral,...Ce(e)});function v_(t,e){return new Wr({values:t,typeName:q.ZodEnum,...Ce(e)})}class Wr extends Ne{constructor(){super(...arguments),Za.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),r=this._def.values;return ne(n,{expected:Me.joinValues(r),received:n.parsedType,code:J.invalid_type}),ge}if(Bu(this,Za)||T_(this,Za,new Set(this._def.values)),!Bu(this,Za).has(e.data)){const n=this._getOrReturnCtx(e),r=this._def.values;return ne(n,{received:n.data,code:J.invalid_enum_value,options:r}),ge}return $t(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return Wr.create(e,{...this._def,...n})}exclude(e,n=this._def){return Wr.create(this.options.filter(r=>!e.includes(r)),{...this._def,...n})}}Za=new WeakMap;Wr.create=v_;class xi extends Ne{constructor(){super(...arguments),Ja.set(this,void 0)}_parse(e){const n=Me.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==re.string&&r.parsedType!==re.number){const s=Me.objectValues(n);return ne(r,{expected:Me.joinValues(s),received:r.parsedType,code:J.invalid_type}),ge}if(Bu(this,Ja)||T_(this,Ja,new Set(Me.getValidEnumValues(this._def.values))),!Bu(this,Ja).has(e.data)){const s=Me.objectValues(n);return ne(r,{received:r.data,code:J.invalid_enum_value,options:s}),ge}return $t(e.data)}get enum(){return this._def.values}}Ja=new WeakMap;xi.create=(t,e)=>new xi({values:t,typeName:q.ZodNativeEnum,...Ce(e)});class la extends Ne{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==re.promise&&n.common.async===!1)return ne(n,{code:J.invalid_type,expected:re.promise,received:n.parsedType}),ge;const r=n.parsedType===re.promise?n.data:Promise.resolve(n.data);return $t(r.then(s=>this._def.type.parseAsync(s,{path:n.path,errorMap:n.common.contextualErrorMap})))}}la.create=(t,e)=>new la({type:t,typeName:q.ZodPromise,...Ce(e)});class qn extends Ne{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===q.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:r}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{ne(r,i),i.fatal?n.abort():n.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){const i=s.transform(r.data,a);if(r.common.async)return Promise.resolve(i).then(async o=>{if(n.value==="aborted")return ge;const u=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return u.status==="aborted"?ge:u.status==="dirty"||n.value==="dirty"?Zs(u.value):u});{if(n.value==="aborted")return ge;const o=this._def.schema._parseSync({data:i,path:r.path,parent:r});return o.status==="aborted"?ge:o.status==="dirty"||n.value==="dirty"?Zs(o.value):o}}if(s.type==="refinement"){const i=o=>{const u=s.refinement(o,a);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?ge:(o.status==="dirty"&&n.dirty(),i(o.value),{status:n.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?ge:(o.status==="dirty"&&n.dirty(),i(o.value).then(()=>({status:n.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!_s(i))return i;const o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>_s(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:n.value,value:o})):i);Me.assertNever(s)}}qn.create=(t,e,n)=>new qn({schema:t,typeName:q.ZodEffects,effect:e,...Ce(n)});qn.createWithPreprocess=(t,e,n)=>new qn({schema:e,effect:{type:"preprocess",transform:t},typeName:q.ZodEffects,...Ce(n)});class jn extends Ne{_parse(e){return this._getType(e)===re.undefined?$t(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}jn.create=(t,e)=>new jn({innerType:t,typeName:q.ZodOptional,...Ce(e)});class Gr extends Ne{_parse(e){return this._getType(e)===re.null?$t(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Gr.create=(t,e)=>new Gr({innerType:t,typeName:q.ZodNullable,...Ce(e)});class Li extends Ne{_parse(e){const{ctx:n}=this._processInputParams(e);let r=n.data;return n.parsedType===re.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}Li.create=(t,e)=>new Li({innerType:t,typeName:q.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Ce(e)});class Di extends Ne{_parse(e){const{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Ai(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new pn(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new pn(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Di.create=(t,e)=>new Di({innerType:t,typeName:q.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Ce(e)});class Hu extends Ne{_parse(e){if(this._getType(e)!==re.nan){const r=this._getOrReturnCtx(e);return ne(r,{code:J.invalid_type,expected:re.nan,received:r.parsedType}),ge}return{status:"valid",value:e.data}}}Hu.create=t=>new Hu({typeName:q.ZodNaN,...Ce(t)});const rC=Symbol("zod_brand");class cf extends Ne{_parse(e){const{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class so extends Ne{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?ge:a.status==="dirty"?(n.dirty(),Zs(a.value)):this._def.out._parseAsync({data:a.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?ge:s.status==="dirty"?(n.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,n){return new so({in:e,out:n,typeName:q.ZodPipeline})}}class Mi extends Ne{_parse(e){const n=this._def.innerType._parse(e),r=s=>(_s(s)&&(s.value=Object.freeze(s.value)),s);return Ai(n)?n.then(s=>r(s)):r(n)}unwrap(){return this._def.innerType}}Mi.create=(t,e)=>new Mi({innerType:t,typeName:q.ZodReadonly,...Ce(e)});function O_(t,e={},n){return t?ca.create().superRefine((r,s)=>{var a,i;if(!t(r)){const o=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,u=(i=(a=o.fatal)!==null&&a!==void 0?a:n)!==null&&i!==void 0?i:!0,c=typeof o=="string"?{message:o}:o;s.addIssue({code:"custom",...c,fatal:u})}}):ca.create()}const sC={object:ot.lazycreate};var q;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(q||(q={}));const aC=(t,e={message:`Input not instance of ${t.name}`})=>O_(n=>n instanceof t,e),I_=Mn.create,k_=Vr.create,iC=Hu.create,oC=zr.create,N_=Ci.create,uC=ys.create,cC=Fu.create,lC=vi.create,dC=Oi.create,hC=ca.create,fC=hs.create,mC=Nr.create,pC=Uu.create,gC=Un.create,bC=ot.create,_C=ot.strictCreate,yC=Ii.create,EC=Ic.create,wC=ki.create,TC=gr.create,SC=Ni.create,AC=ju.create,CC=Es.create,vC=na.create,OC=Ri.create,IC=Pi.create,kC=Wr.create,NC=xi.create,RC=la.create,pp=qn.create,PC=jn.create,xC=Gr.create,LC=qn.createWithPreprocess,DC=so.create,MC=()=>I_().optional(),BC=()=>k_().optional(),FC=()=>N_().optional(),UC={string:t=>Mn.create({...t,coerce:!0}),number:t=>Vr.create({...t,coerce:!0}),boolean:t=>Ci.create({...t,coerce:!0}),bigint:t=>zr.create({...t,coerce:!0}),date:t=>ys.create({...t,coerce:!0})},jC=ge;var Or=Object.freeze({__proto__:null,defaultErrorMap:ua,setErrorMap:L2,getErrorMap:Du,makeIssue:Mu,EMPTY_PATH:D2,addIssueToContext:ne,ParseStatus:Bt,INVALID:ge,DIRTY:Zs,OK:$t,isAborted:Kd,isDirty:Yd,isValid:_s,isAsync:Ai,get util(){return Me},get objectUtil(){return Gd},ZodParsedType:re,getParsedType:Cr,ZodType:Ne,datetimeRegex:C_,ZodString:Mn,ZodNumber:Vr,ZodBigInt:zr,ZodBoolean:Ci,ZodDate:ys,ZodSymbol:Fu,ZodUndefined:vi,ZodNull:Oi,ZodAny:ca,ZodUnknown:hs,ZodNever:Nr,ZodVoid:Uu,ZodArray:Un,ZodObject:ot,ZodUnion:Ii,ZodDiscriminatedUnion:Ic,ZodIntersection:ki,ZodTuple:gr,ZodRecord:Ni,ZodMap:ju,ZodSet:Es,ZodFunction:na,ZodLazy:Ri,ZodLiteral:Pi,ZodEnum:Wr,ZodNativeEnum:xi,ZodPromise:la,ZodEffects:qn,ZodTransformer:qn,ZodOptional:jn,ZodNullable:Gr,ZodDefault:Li,ZodCatch:Di,ZodNaN:Hu,BRAND:rC,ZodBranded:cf,ZodPipeline:so,ZodReadonly:Mi,custom:O_,Schema:Ne,ZodSchema:Ne,late:sC,get ZodFirstPartyTypeKind(){return q},coerce:UC,any:hC,array:gC,bigint:oC,boolean:N_,date:uC,discriminatedUnion:EC,effect:pp,enum:kC,function:vC,instanceof:aC,intersection:wC,lazy:OC,literal:IC,map:AC,nan:iC,nativeEnum:NC,never:mC,null:dC,nullable:xC,number:k_,object:bC,oboolean:FC,onumber:BC,optional:PC,ostring:MC,pipeline:DC,preprocess:LC,promise:RC,record:SC,set:CC,strictObject:_C,string:I_,symbol:cC,transformer:pp,tuple:TC,undefined:lC,union:yC,unknown:fC,void:pC,NEVER:jC,ZodIssueCode:J,quotelessJson:x2,ZodError:pn}),kc={exports:{}},R_={};function On(t,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var HC=On;On.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};On.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};On.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=new Date().getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},n),this._options.unref&&this._timer.unref(),!0};On.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};On.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)};On.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)};On.prototype.start=On.prototype.try;On.prototype.errors=function(){return this._errors};On.prototype.attempts=function(){return this._attempts};On.prototype.mainError=function(){if(this._errors.length===0)return null;for(var t={},e=null,n=0,r=0;r<this._errors.length;r++){var s=this._errors[r],a=s.message,i=(t[a]||0)+1;t[a]=i,i>=n&&(e=s,n=i)}return e};(function(t){var e=HC;t.operation=function(n){var r=t.timeouts(n);return new e(r,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})},t.timeouts=function(n){if(n instanceof Array)return[].concat(n);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in n)r[s]=n[s];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],i=0;i<r.retries;i++)a.push(this.createTimeout(i,r));return n&&n.forever&&!a.length&&a.push(this.createTimeout(i,r)),a.sort(function(o,u){return o-u}),a},t.createTimeout=function(n,r){var s=r.randomize?Math.random()+1:1,a=Math.round(s*Math.max(r.minTimeout,1)*Math.pow(r.factor,n));return a=Math.min(a,r.maxTimeout),a},t.wrap=function(n,r,s){if(r instanceof Array&&(s=r,r=null),!s){s=[];for(var a in n)typeof n[a]=="function"&&s.push(a)}for(var i=0;i<s.length;i++){var o=s[i],u=n[o];n[o]=(function(l){var d=t.operation(r),m=Array.prototype.slice.call(arguments,1),p=m.pop();m.push(function(f){d.retry(f)||(f&&(arguments[0]=d.mainError()),p.apply(this,arguments))}),d.attempt(function(){l.apply(n,m)})}).bind(n,u),n[o].options=r}}})(R_);var $C=R_;const qC=$C,VC=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class P_ extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const zC=(t,e,n)=>{const r=n.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=r,t},WC=t=>VC.includes(t),x_=(t,e)=>new Promise((n,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const s=qC.operation(e);s.attempt(async a=>{try{n(await t(a))}catch(i){if(!(i instanceof Error)){r(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof P_)s.stop(),r(i.originalError);else if(i instanceof TypeError&&!WC(i.message))s.stop(),r(i);else{zC(i,a,e);try{await e.onFailedAttempt(i)}catch(o){r(o);return}s.retry(i)||r(s.mainError())}}})});kc.exports=x_;kc.exports.default=x_;kc.exports.AbortError=P_;var GC=kc.exports;const $u=ro(GC),KC=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function ci(t){return typeof t=="string"&&KC.test(t)}var Nt=[];for(var Cl=0;Cl<256;++Cl)Nt.push((Cl+256).toString(16).slice(1));function YC(t,e=0){return(Nt[t[e+0]]+Nt[t[e+1]]+Nt[t[e+2]]+Nt[t[e+3]]+"-"+Nt[t[e+4]]+Nt[t[e+5]]+"-"+Nt[t[e+6]]+Nt[t[e+7]]+"-"+Nt[t[e+8]]+Nt[t[e+9]]+"-"+Nt[t[e+10]]+Nt[t[e+11]]+Nt[t[e+12]]+Nt[t[e+13]]+Nt[t[e+14]]+Nt[t[e+15]]).toLowerCase()}var Po,ZC=new Uint8Array(16);function JC(){if(!Po&&(Po=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Po))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Po(ZC)}var XC=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const gp={randomUUID:XC};function Jt(t,e,n){if(gp.randomUUID&&!t)return gp.randomUUID();t=t||{};var r=t.random||(t.rng||JC)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,YC(r)}var L_={},D_={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function s(u,c,l){this.fn=u,this.context=c,this.once=l||!1}function a(u,c,l,d,m){if(typeof l!="function")throw new TypeError("The listener must be a function");var p=new s(l,d||u,m),f=n?n+c:c;return u._events[f]?u._events[f].fn?u._events[f]=[u._events[f],p]:u._events[f].push(p):(u._events[f]=p,u._eventsCount++),u}function i(u,c){--u._eventsCount===0?u._events=new r:delete u._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],l,d;if(this._eventsCount===0)return c;for(d in l=this._events)e.call(l,d)&&c.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},o.prototype.listeners=function(c){var l=n?n+c:c,d=this._events[l];if(!d)return[];if(d.fn)return[d.fn];for(var m=0,p=d.length,f=new Array(p);m<p;m++)f[m]=d[m].fn;return f},o.prototype.listenerCount=function(c){var l=n?n+c:c,d=this._events[l];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,l,d,m,p,f){var g=n?n+c:c;if(!this._events[g])return!1;var b=this._events[g],_=arguments.length,y,E;if(b.fn){switch(b.once&&this.removeListener(c,b.fn,void 0,!0),_){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,l),!0;case 3:return b.fn.call(b.context,l,d),!0;case 4:return b.fn.call(b.context,l,d,m),!0;case 5:return b.fn.call(b.context,l,d,m,p),!0;case 6:return b.fn.call(b.context,l,d,m,p,f),!0}for(E=1,y=new Array(_-1);E<_;E++)y[E-1]=arguments[E];b.fn.apply(b.context,y)}else{var I=b.length,w;for(E=0;E<I;E++)switch(b[E].once&&this.removeListener(c,b[E].fn,void 0,!0),_){case 1:b[E].fn.call(b[E].context);break;case 2:b[E].fn.call(b[E].context,l);break;case 3:b[E].fn.call(b[E].context,l,d);break;case 4:b[E].fn.call(b[E].context,l,d,m);break;default:if(!y)for(w=1,y=new Array(_-1);w<_;w++)y[w-1]=arguments[w];b[E].fn.apply(b[E].context,y)}}return!0},o.prototype.on=function(c,l,d){return a(this,c,l,d,!1)},o.prototype.once=function(c,l,d){return a(this,c,l,d,!0)},o.prototype.removeListener=function(c,l,d,m){var p=n?n+c:c;if(!this._events[p])return this;if(!l)return i(this,p),this;var f=this._events[p];if(f.fn)f.fn===l&&(!m||f.once)&&(!d||f.context===d)&&i(this,p);else{for(var g=0,b=[],_=f.length;g<_;g++)(f[g].fn!==l||m&&!f[g].once||d&&f[g].context!==d)&&b.push(f[g]);b.length?this._events[p]=b.length===1?b[0]:b:i(this,p)}return this},o.prototype.removeAllListeners=function(c){var l;return c?(l=n?n+c:c,this._events[l]&&i(this,l)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,t.exports=o})(D_);var QC=D_.exports,Nc={exports:{}},ev=(t,e)=>(e=e||(()=>{}),t.then(n=>new Promise(r=>{r(e())}).then(()=>n),n=>new Promise(r=>{r(e())}).then(()=>{throw n})));const tv=ev;class M_ extends Error{constructor(e){super(e),this.name="TimeoutError"}}const B_=(t,e,n)=>new Promise((r,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(t);return}const a=setTimeout(()=>{if(typeof n=="function"){try{r(n())}catch(u){s(u)}return}const i=typeof n=="string"?n:`Promise timed out after ${e} milliseconds`,o=n instanceof Error?n:new M_(i);typeof t.cancel=="function"&&t.cancel(),s(o)},e);tv(t.then(r,s),()=>{clearTimeout(a)})});Nc.exports=B_;Nc.exports.default=B_;Nc.exports.TimeoutError=M_;var nv=Nc.exports,lf={},df={};Object.defineProperty(df,"__esModule",{value:!0});function rv(t,e,n){let r=0,s=t.length;for(;s>0;){const a=s/2|0;let i=r+a;n(t[i],e)<=0?(r=++i,s-=a+1):s=a}return r}df.default=rv;Object.defineProperty(lf,"__esModule",{value:!0});const sv=df;class av{constructor(){this._queue=[]}enqueue(e,n){n=Object.assign({priority:0},n);const r={priority:n.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=n.priority){this._queue.push(r);return}const s=sv.default(this._queue,r,(a,i)=>i.priority-a.priority);this._queue.splice(s,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(n=>n.priority===e.priority).map(n=>n.run)}get size(){return this._queue.length}}lf.default=av;Object.defineProperty(L_,"__esModule",{value:!0});const iv=QC,F_=nv,ov=lf,xo=()=>{},uv=new F_.TimeoutError;class cv extends iv{constructor(e){var n,r,s,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=xo,this._resolveIdle=xo,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:ov.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(n=e.intervalCap)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(a=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=xo,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=xo,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const n=this._intervalEnd-e;if(n<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},n)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const n=this._queue.dequeue();return n?(this.emit("active"),n(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,n={}){return new Promise((r,s)=>{const a=async()=>{this._pendingCount++,this._intervalCount++;try{const i=this._timeout===void 0&&n.timeout===void 0?e():F_.default(Promise.resolve(e()),n.timeout===void 0?this._timeout:n.timeout,()=>{(n.throwOnTimeout===void 0?this._throwOnTimeout:n.throwOnTimeout)&&s(uv)});r(await i)}catch(i){s(i)}this._next()};this._queue.enqueue(a,n),this._tryToStartAnother(),this.emit("add")})}async addAll(e,n){return Promise.all(e.map(async r=>this.add(r,n)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const n=this._resolveEmpty;this._resolveEmpty=()=>{n(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const n=this._resolveIdle;this._resolveIdle=()=>{n(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var Ir=L_.default=cv;const lv=(...t)=>fetch(...t),dv=Symbol.for("ls:fetch_implementation"),ue=()=>globalThis[dv]??lv,hv=[400,401,403,404,405,406,407,408],fv=[409];let bp=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Ir?this.queue=new Ir.default({concurrency:this.maxConcurrency}):this.queue=new Ir({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...n){const r=this.onFailedResponseHook;return this.queue.add(()=>$u(()=>e(...n).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;const a=s==null?void 0:s.response,i=a==null?void 0:a.status;if(i){if(hv.includes(+i))throw s;if(fv.includes(+i))return;r&&await r(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,n,...r){return e.signal?Promise.race([this.call(n,...r),new Promise((s,a)=>{var i;(i=e.signal)==null||i.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(n,...r)}fetch(...e){return this.call(()=>ue()(...e).then(n=>n.ok?n:Promise.reject(n)))}};function _p(t){return typeof(t==null?void 0:t._getType)=="function"}function yp(t){const e={type:t._getType(),data:{content:t.content}};return t!=null&&t.additional_kwargs&&Object.keys(t.additional_kwargs).length>0&&(e.data.additional_kwargs={...t.additional_kwargs}),e}function ve(t,e){if(!ci(t)){const n=e!==void 0?`Invalid UUID for ${e}: ${t}`:`Invalid UUID: ${t}`;throw new Error(n)}return t}const Ep={};function U_(t){Ep[t]||(console.warn(t),Ep[t]=!0)}var Jd={exports:{}};const mv="2.0.0",j_=256,pv=Number.MAX_SAFE_INTEGER||9007199254740991,gv=16,bv=j_-6,_v=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var Rc={MAX_LENGTH:j_,MAX_SAFE_COMPONENT_LENGTH:gv,MAX_SAFE_BUILD_LENGTH:bv,MAX_SAFE_INTEGER:pv,RELEASE_TYPES:_v,SEMVER_SPEC_VERSION:mv,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const yv=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};var Pc=yv;(function(t,e){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:s}=Rc,a=Pc;e=t.exports={};const i=e.re=[],o=e.safeRe=[],u=e.src=[],c=e.t={};let l=0;const d="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",s],[d,r]],p=g=>{for(const[b,_]of m)g=g.split(`${b}*`).join(`${b}{0,${_}}`).split(`${b}+`).join(`${b}{1,${_}}`);return g},f=(g,b,_)=>{const y=p(b),E=l++;a(g,E,b),c[g]=E,u[E]=b,i[E]=new RegExp(b,_?"g":void 0),o[E]=new RegExp(y,_?"g":void 0)};f("NUMERICIDENTIFIER","0|[1-9]\\d*"),f("NUMERICIDENTIFIERLOOSE","\\d+"),f("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${d}*`),f("MAINVERSION",`(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})`),f("MAINVERSIONLOOSE",`(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASEIDENTIFIER",`(?:${u[c.NUMERICIDENTIFIER]}|${u[c.NONNUMERICIDENTIFIER]})`),f("PRERELEASEIDENTIFIERLOOSE",`(?:${u[c.NUMERICIDENTIFIERLOOSE]}|${u[c.NONNUMERICIDENTIFIER]})`),f("PRERELEASE",`(?:-(${u[c.PRERELEASEIDENTIFIER]}(?:\\.${u[c.PRERELEASEIDENTIFIER]})*))`),f("PRERELEASELOOSE",`(?:-?(${u[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[c.PRERELEASEIDENTIFIERLOOSE]})*))`),f("BUILDIDENTIFIER",`${d}+`),f("BUILD",`(?:\\+(${u[c.BUILDIDENTIFIER]}(?:\\.${u[c.BUILDIDENTIFIER]})*))`),f("FULLPLAIN",`v?${u[c.MAINVERSION]}${u[c.PRERELEASE]}?${u[c.BUILD]}?`),f("FULL",`^${u[c.FULLPLAIN]}$`),f("LOOSEPLAIN",`[v=\\s]*${u[c.MAINVERSIONLOOSE]}${u[c.PRERELEASELOOSE]}?${u[c.BUILD]}?`),f("LOOSE",`^${u[c.LOOSEPLAIN]}$`),f("GTLT","((?:<|>)?=?)"),f("XRANGEIDENTIFIERLOOSE",`${u[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),f("XRANGEIDENTIFIER",`${u[c.NUMERICIDENTIFIER]}|x|X|\\*`),f("XRANGEPLAIN",`[v=\\s]*(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:${u[c.PRERELEASE]})?${u[c.BUILD]}?)?)?`),f("XRANGEPLAINLOOSE",`[v=\\s]*(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:${u[c.PRERELEASELOOSE]})?${u[c.BUILD]}?)?)?`),f("XRANGE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAIN]}$`),f("XRANGELOOSE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAINLOOSE]}$`),f("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),f("COERCE",`${u[c.COERCEPLAIN]}(?:$|[^\\d])`),f("COERCEFULL",u[c.COERCEPLAIN]+`(?:${u[c.PRERELEASE]})?(?:${u[c.BUILD]})?(?:$|[^\\d])`),f("COERCERTL",u[c.COERCE],!0),f("COERCERTLFULL",u[c.COERCEFULL],!0),f("LONETILDE","(?:~>?)"),f("TILDETRIM",`(\\s*)${u[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",f("TILDE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAIN]}$`),f("TILDELOOSE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAINLOOSE]}$`),f("LONECARET","(?:\\^)"),f("CARETTRIM",`(\\s*)${u[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",f("CARET",`^${u[c.LONECARET]}${u[c.XRANGEPLAIN]}$`),f("CARETLOOSE",`^${u[c.LONECARET]}${u[c.XRANGEPLAINLOOSE]}$`),f("COMPARATORLOOSE",`^${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]})$|^$`),f("COMPARATOR",`^${u[c.GTLT]}\\s*(${u[c.FULLPLAIN]})$|^$`),f("COMPARATORTRIM",`(\\s*)${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]}|${u[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",f("HYPHENRANGE",`^\\s*(${u[c.XRANGEPLAIN]})\\s+-\\s+(${u[c.XRANGEPLAIN]})\\s*$`),f("HYPHENRANGELOOSE",`^\\s*(${u[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[c.XRANGEPLAINLOOSE]})\\s*$`),f("STAR","(<|>)?=?\\s*\\*"),f("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),f("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Jd,Jd.exports);var ao=Jd.exports;const Ev=Object.freeze({loose:!0}),wv=Object.freeze({}),Tv=t=>t?typeof t!="object"?Ev:t:wv;var hf=Tv;const wp=/^[0-9]+$/,H_=(t,e)=>{const n=wp.test(t),r=wp.test(e);return n&&r&&(t=+t,e=+e),t===e?0:n&&!r?-1:r&&!n?1:t<e?-1:1},Sv=(t,e)=>H_(e,t);var $_={compareIdentifiers:H_,rcompareIdentifiers:Sv};const Lo=Pc,{MAX_LENGTH:Tp,MAX_SAFE_INTEGER:Do}=Rc,{safeRe:Mo,t:Bo}=ao,Av=hf,{compareIdentifiers:Ds}=$_;let Cv=class nr{constructor(e,n){if(n=Av(n),e instanceof nr){if(e.loose===!!n.loose&&e.includePrerelease===!!n.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Tp)throw new TypeError(`version is longer than ${Tp} characters`);Lo("SemVer",e,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const r=e.trim().match(n.loose?Mo[Bo.LOOSE]:Mo[Bo.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Do||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Do||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Do||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){const a=+s;if(a>=0&&a<Do)return a}return s}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Lo("SemVer.compare",this.version,this.options,e),!(e instanceof nr)){if(typeof e=="string"&&e===this.version)return 0;e=new nr(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof nr||(e=new nr(e,this.options)),Ds(this.major,e.major)||Ds(this.minor,e.minor)||Ds(this.patch,e.patch)}comparePre(e){if(e instanceof nr||(e=new nr(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let n=0;do{const r=this.prerelease[n],s=e.prerelease[n];if(Lo("prerelease compare",n,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return Ds(r,s)}while(++n)}compareBuild(e){e instanceof nr||(e=new nr(e,this.options));let n=0;do{const r=this.build[n],s=e.build[n];if(Lo("build compare",n,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return Ds(r,s)}while(++n)}inc(e,n,r){if(e.startsWith("pre")){if(!n&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(n){const s=`-${n}`.match(this.options.loose?Mo[Bo.PRERELEASELOOSE]:Mo[Bo.PRERELEASE]);if(!s||s[1]!==n)throw new Error(`invalid identifier: ${n}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n,r),this.inc("pre",n,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n,r),this.inc("pre",n,r);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const s=Number(r)?1:0;if(this.prerelease.length===0)this.prerelease=[s];else{let a=this.prerelease.length;for(;--a>=0;)typeof this.prerelease[a]=="number"&&(this.prerelease[a]++,a=-2);if(a===-1){if(n===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(n){let a=[n,s];r===!1&&(a=[n]),Ds(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var Vt=Cv;const Sp=Vt,vv=(t,e,n=!1)=>{if(t instanceof Sp)return t;try{return new Sp(t,e)}catch(r){if(!n)return null;throw r}};var ya=vv;const Ov=ya,Iv=(t,e)=>{const n=Ov(t,e);return n?n.version:null};var kv=Iv;const Nv=ya,Rv=(t,e)=>{const n=Nv(t.trim().replace(/^[=v]+/,""),e);return n?n.version:null};var Pv=Rv;const Ap=Vt,xv=(t,e,n,r,s)=>{typeof n=="string"&&(s=r,r=n,n=void 0);try{return new Ap(t instanceof Ap?t.version:t,n).inc(e,r,s).version}catch{return null}};var Lv=xv;const Cp=ya,Dv=(t,e)=>{const n=Cp(t,null,!0),r=Cp(e,null,!0),s=n.compare(r);if(s===0)return null;const a=s>0,i=a?n:r,o=a?r:n,u=!!i.prerelease.length;if(!!o.prerelease.length&&!u){if(!o.patch&&!o.minor)return"major";if(o.compareMain(i)===0)return o.minor&&!o.patch?"minor":"patch"}const l=u?"pre":"";return n.major!==r.major?l+"major":n.minor!==r.minor?l+"minor":n.patch!==r.patch?l+"patch":"prerelease"};var Mv=Dv;const Bv=Vt,Fv=(t,e)=>new Bv(t,e).major;var Uv=Fv;const jv=Vt,Hv=(t,e)=>new jv(t,e).minor;var $v=Hv;const qv=Vt,Vv=(t,e)=>new qv(t,e).patch;var zv=Vv;const Wv=ya,Gv=(t,e)=>{const n=Wv(t,e);return n&&n.prerelease.length?n.prerelease:null};var Kv=Gv;const vp=Vt,Yv=(t,e,n)=>new vp(t,n).compare(new vp(e,n));var Gn=Yv;const Zv=Gn,Jv=(t,e,n)=>Zv(e,t,n);var Xv=Jv;const Qv=Gn,eO=(t,e)=>Qv(t,e,!0);var tO=eO;const Op=Vt,nO=(t,e,n)=>{const r=new Op(t,n),s=new Op(e,n);return r.compare(s)||r.compareBuild(s)};var ff=nO;const rO=ff,sO=(t,e)=>t.sort((n,r)=>rO(n,r,e));var aO=sO;const iO=ff,oO=(t,e)=>t.sort((n,r)=>iO(r,n,e));var uO=oO;const cO=Gn,lO=(t,e,n)=>cO(t,e,n)>0;var xc=lO;const dO=Gn,hO=(t,e,n)=>dO(t,e,n)<0;var mf=hO;const fO=Gn,mO=(t,e,n)=>fO(t,e,n)===0;var q_=mO;const pO=Gn,gO=(t,e,n)=>pO(t,e,n)!==0;var V_=gO;const bO=Gn,_O=(t,e,n)=>bO(t,e,n)>=0;var pf=_O;const yO=Gn,EO=(t,e,n)=>yO(t,e,n)<=0;var gf=EO;const wO=q_,TO=V_,SO=xc,AO=pf,CO=mf,vO=gf,OO=(t,e,n,r)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t===n;case"!==":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t!==n;case"":case"=":case"==":return wO(t,n,r);case"!=":return TO(t,n,r);case">":return SO(t,n,r);case">=":return AO(t,n,r);case"<":return CO(t,n,r);case"<=":return vO(t,n,r);default:throw new TypeError(`Invalid operator: ${e}`)}};var z_=OO;const IO=Vt,kO=ya,{safeRe:Fo,t:Uo}=ao,NO=(t,e)=>{if(t instanceof IO)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let n=null;if(!e.rtl)n=t.match(e.includePrerelease?Fo[Uo.COERCEFULL]:Fo[Uo.COERCE]);else{const u=e.includePrerelease?Fo[Uo.COERCERTLFULL]:Fo[Uo.COERCERTL];let c;for(;(c=u.exec(t))&&(!n||n.index+n[0].length!==t.length);)(!n||c.index+c[0].length!==n.index+n[0].length)&&(n=c),u.lastIndex=c.index+c[1].length+c[2].length;u.lastIndex=-1}if(n===null)return null;const r=n[2],s=n[3]||"0",a=n[4]||"0",i=e.includePrerelease&&n[5]?`-${n[5]}`:"",o=e.includePrerelease&&n[6]?`+${n[6]}`:"";return kO(`${r}.${s}.${a}${i}${o}`,e)};var RO=NO;class PO{constructor(){this.max=1e3,this.map=new Map}get(e){const n=this.map.get(e);if(n!==void 0)return this.map.delete(e),this.map.set(e,n),n}delete(e){return this.map.delete(e)}set(e,n){if(!this.delete(e)&&n!==void 0){if(this.map.size>=this.max){const s=this.map.keys().next().value;this.delete(s)}this.map.set(e,n)}return this}}var xO=PO,vl,Ip;function Kn(){if(Ip)return vl;Ip=1;const t=/\s+/g;class e{constructor(N,U){if(U=s(U),N instanceof e)return N.loose===!!U.loose&&N.includePrerelease===!!U.includePrerelease?N:new e(N.raw,U);if(N instanceof a)return this.raw=N.value,this.set=[[N]],this.formatted=void 0,this;if(this.options=U,this.loose=!!U.loose,this.includePrerelease=!!U.includePrerelease,this.raw=N.trim().replace(t," "),this.set=this.raw.split("||").map(V=>this.parseRange(V.trim())).filter(V=>V.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const V=this.set[0];if(this.set=this.set.filter(M=>!g(M[0])),this.set.length===0)this.set=[V];else if(this.set.length>1){for(const M of this.set)if(M.length===1&&b(M[0])){this.set=[M];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let N=0;N<this.set.length;N++){N>0&&(this.formatted+="||");const U=this.set[N];for(let V=0;V<U.length;V++)V>0&&(this.formatted+=" "),this.formatted+=U[V].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(N){const V=((this.options.includePrerelease&&p)|(this.options.loose&&f))+":"+N,M=r.get(V);if(M)return M;const z=this.options.loose,X=z?u[c.HYPHENRANGELOOSE]:u[c.HYPHENRANGE];N=N.replace(X,K(this.options.includePrerelease)),i("hyphen replace",N),N=N.replace(u[c.COMPARATORTRIM],l),i("comparator trim",N),N=N.replace(u[c.TILDETRIM],d),i("tilde trim",N),N=N.replace(u[c.CARETTRIM],m),i("caret trim",N);let W=N.split(" ").map(Oe=>y(Oe,this.options)).join(" ").split(/\s+/).map(Oe=>Q(Oe,this.options));z&&(W=W.filter(Oe=>(i("loose invalid filter",Oe,this.options),!!Oe.match(u[c.COMPARATORLOOSE])))),i("range list",W);const se=new Map,_e=W.map(Oe=>new a(Oe,this.options));for(const Oe of _e){if(g(Oe))return[Oe];se.set(Oe.value,Oe)}se.size>1&&se.has("")&&se.delete("");const Pe=[...se.values()];return r.set(V,Pe),Pe}intersects(N,U){if(!(N instanceof e))throw new TypeError("a Range is required");return this.set.some(V=>_(V,U)&&N.set.some(M=>_(M,U)&&V.every(z=>M.every(X=>z.intersects(X,U)))))}test(N){if(!N)return!1;if(typeof N=="string")try{N=new o(N,this.options)}catch{return!1}for(let U=0;U<this.set.length;U++)if(ee(this.set[U],N,this.options))return!0;return!1}}vl=e;const n=xO,r=new n,s=hf,a=Lc(),i=Pc,o=Vt,{safeRe:u,t:c,comparatorTrimReplace:l,tildeTrimReplace:d,caretTrimReplace:m}=ao,{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:f}=Rc,g=L=>L.value==="<0.0.0-0",b=L=>L.value==="",_=(L,N)=>{let U=!0;const V=L.slice();let M=V.pop();for(;U&&V.length;)U=V.every(z=>M.intersects(z,N)),M=V.pop();return U},y=(L,N)=>(i("comp",L,N),L=O(L,N),i("caret",L),L=I(L,N),i("tildes",L),L=x(L,N),i("xrange",L),L=B(L,N),i("stars",L),L),E=L=>!L||L.toLowerCase()==="x"||L==="*",I=(L,N)=>L.trim().split(/\s+/).map(U=>w(U,N)).join(" "),w=(L,N)=>{const U=N.loose?u[c.TILDELOOSE]:u[c.TILDE];return L.replace(U,(V,M,z,X,W)=>{i("tilde",L,V,M,z,X,W);let se;return E(M)?se="":E(z)?se=`>=${M}.0.0 <${+M+1}.0.0-0`:E(X)?se=`>=${M}.${z}.0 <${M}.${+z+1}.0-0`:W?(i("replaceTilde pr",W),se=`>=${M}.${z}.${X}-${W} <${M}.${+z+1}.0-0`):se=`>=${M}.${z}.${X} <${M}.${+z+1}.0-0`,i("tilde return",se),se})},O=(L,N)=>L.trim().split(/\s+/).map(U=>S(U,N)).join(" "),S=(L,N)=>{i("caret",L,N);const U=N.loose?u[c.CARETLOOSE]:u[c.CARET],V=N.includePrerelease?"-0":"";return L.replace(U,(M,z,X,W,se)=>{i("caret",L,M,z,X,W,se);let _e;return E(z)?_e="":E(X)?_e=`>=${z}.0.0${V} <${+z+1}.0.0-0`:E(W)?z==="0"?_e=`>=${z}.${X}.0${V} <${z}.${+X+1}.0-0`:_e=`>=${z}.${X}.0${V} <${+z+1}.0.0-0`:se?(i("replaceCaret pr",se),z==="0"?X==="0"?_e=`>=${z}.${X}.${W}-${se} <${z}.${X}.${+W+1}-0`:_e=`>=${z}.${X}.${W}-${se} <${z}.${+X+1}.0-0`:_e=`>=${z}.${X}.${W}-${se} <${+z+1}.0.0-0`):(i("no pr"),z==="0"?X==="0"?_e=`>=${z}.${X}.${W}${V} <${z}.${X}.${+W+1}-0`:_e=`>=${z}.${X}.${W}${V} <${z}.${+X+1}.0-0`:_e=`>=${z}.${X}.${W} <${+z+1}.0.0-0`),i("caret return",_e),_e})},x=(L,N)=>(i("replaceXRanges",L,N),L.split(/\s+/).map(U=>D(U,N)).join(" ")),D=(L,N)=>{L=L.trim();const U=N.loose?u[c.XRANGELOOSE]:u[c.XRANGE];return L.replace(U,(V,M,z,X,W,se)=>{i("xRange",L,V,M,z,X,W,se);const _e=E(z),Pe=_e||E(X),Oe=Pe||E(W),yt=Oe;return M==="="&&yt&&(M=""),se=N.includePrerelease?"-0":"",_e?M===">"||M==="<"?V="<0.0.0-0":V="*":M&&yt?(Pe&&(X=0),W=0,M===">"?(M=">=",Pe?(z=+z+1,X=0,W=0):(X=+X+1,W=0)):M==="<="&&(M="<",Pe?z=+z+1:X=+X+1),M==="<"&&(se="-0"),V=`${M+z}.${X}.${W}${se}`):Pe?V=`>=${z}.0.0${se} <${+z+1}.0.0-0`:Oe&&(V=`>=${z}.${X}.0${se} <${z}.${+X+1}.0-0`),i("xRange return",V),V})},B=(L,N)=>(i("replaceStars",L,N),L.trim().replace(u[c.STAR],"")),Q=(L,N)=>(i("replaceGTE0",L,N),L.trim().replace(u[N.includePrerelease?c.GTE0PRE:c.GTE0],"")),K=L=>(N,U,V,M,z,X,W,se,_e,Pe,Oe,yt)=>(E(V)?U="":E(M)?U=`>=${V}.0.0${L?"-0":""}`:E(z)?U=`>=${V}.${M}.0${L?"-0":""}`:X?U=`>=${U}`:U=`>=${U}${L?"-0":""}`,E(_e)?se="":E(Pe)?se=`<${+_e+1}.0.0-0`:E(Oe)?se=`<${_e}.${+Pe+1}.0-0`:yt?se=`<=${_e}.${Pe}.${Oe}-${yt}`:L?se=`<${_e}.${Pe}.${+Oe+1}-0`:se=`<=${se}`,`${U} ${se}`.trim()),ee=(L,N,U)=>{for(let V=0;V<L.length;V++)if(!L[V].test(N))return!1;if(N.prerelease.length&&!U.includePrerelease){for(let V=0;V<L.length;V++)if(i(L[V].semver),L[V].semver!==a.ANY&&L[V].semver.prerelease.length>0){const M=L[V].semver;if(M.major===N.major&&M.minor===N.minor&&M.patch===N.patch)return!0}return!1}return!0};return vl}var Ol,kp;function Lc(){if(kp)return Ol;kp=1;const t=Symbol("SemVer ANY");class e{static get ANY(){return t}constructor(l,d){if(d=n(d),l instanceof e){if(l.loose===!!d.loose)return l;l=l.value}l=l.trim().split(/\s+/).join(" "),i("comparator",l,d),this.options=d,this.loose=!!d.loose,this.parse(l),this.semver===t?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(l){const d=this.options.loose?r[s.COMPARATORLOOSE]:r[s.COMPARATOR],m=l.match(d);if(!m)throw new TypeError(`Invalid comparator: ${l}`);this.operator=m[1]!==void 0?m[1]:"",this.operator==="="&&(this.operator=""),m[2]?this.semver=new o(m[2],this.options.loose):this.semver=t}toString(){return this.value}test(l){if(i("Comparator.test",l,this.options.loose),this.semver===t||l===t)return!0;if(typeof l=="string")try{l=new o(l,this.options)}catch{return!1}return a(l,this.operator,this.semver,this.options)}intersects(l,d){if(!(l instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(l.value,d).test(this.value):l.operator===""?l.value===""?!0:new u(this.value,d).test(l.semver):(d=n(d),d.includePrerelease&&(this.value==="<0.0.0-0"||l.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||l.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&l.operator.startsWith(">")||this.operator.startsWith("<")&&l.operator.startsWith("<")||this.semver.version===l.semver.version&&this.operator.includes("=")&&l.operator.includes("=")||a(this.semver,"<",l.semver,d)&&this.operator.startsWith(">")&&l.operator.startsWith("<")||a(this.semver,">",l.semver,d)&&this.operator.startsWith("<")&&l.operator.startsWith(">")))}}Ol=e;const n=hf,{safeRe:r,t:s}=ao,a=z_,i=Pc,o=Vt,u=Kn();return Ol}const LO=Kn(),DO=(t,e,n)=>{try{e=new LO(e,n)}catch{return!1}return e.test(t)};var Dc=DO;const MO=Kn(),BO=(t,e)=>new MO(t,e).set.map(n=>n.map(r=>r.value).join(" ").trim().split(" "));var FO=BO;const UO=Vt,jO=Kn(),HO=(t,e,n)=>{let r=null,s=null,a=null;try{a=new jO(e,n)}catch{return null}return t.forEach(i=>{a.test(i)&&(!r||s.compare(i)===-1)&&(r=i,s=new UO(r,n))}),r};var $O=HO;const qO=Vt,VO=Kn(),zO=(t,e,n)=>{let r=null,s=null,a=null;try{a=new VO(e,n)}catch{return null}return t.forEach(i=>{a.test(i)&&(!r||s.compare(i)===1)&&(r=i,s=new qO(r,n))}),r};var WO=zO;const Il=Vt,GO=Kn(),Np=xc,KO=(t,e)=>{t=new GO(t,e);let n=new Il("0.0.0");if(t.test(n)||(n=new Il("0.0.0-0"),t.test(n)))return n;n=null;for(let r=0;r<t.set.length;++r){const s=t.set[r];let a=null;s.forEach(i=>{const o=new Il(i.semver.version);switch(i.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!a||Np(o,a))&&(a=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${i.operator}`)}}),a&&(!n||Np(n,a))&&(n=a)}return n&&t.test(n)?n:null};var YO=KO;const ZO=Kn(),JO=(t,e)=>{try{return new ZO(t,e).range||"*"}catch{return null}};var XO=JO;const QO=Vt,W_=Lc(),{ANY:eI}=W_,tI=Kn(),nI=Dc,Rp=xc,Pp=mf,rI=gf,sI=pf,aI=(t,e,n,r)=>{t=new QO(t,r),e=new tI(e,r);let s,a,i,o,u;switch(n){case">":s=Rp,a=rI,i=Pp,o=">",u=">=";break;case"<":s=Pp,a=sI,i=Rp,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(nI(t,e,r))return!1;for(let c=0;c<e.set.length;++c){const l=e.set[c];let d=null,m=null;if(l.forEach(p=>{p.semver===eI&&(p=new W_(">=0.0.0")),d=d||p,m=m||p,s(p.semver,d.semver,r)?d=p:i(p.semver,m.semver,r)&&(m=p)}),d.operator===o||d.operator===u||(!m.operator||m.operator===o)&&a(t,m.semver))return!1;if(m.operator===u&&i(t,m.semver))return!1}return!0};var bf=aI;const iI=bf,oI=(t,e,n)=>iI(t,e,">",n);var uI=oI;const cI=bf,lI=(t,e,n)=>cI(t,e,"<",n);var dI=lI;const xp=Kn(),hI=(t,e,n)=>(t=new xp(t,n),e=new xp(e,n),t.intersects(e,n));var fI=hI;const mI=Dc,pI=Gn;var gI=(t,e,n)=>{const r=[];let s=null,a=null;const i=t.sort((l,d)=>pI(l,d,n));for(const l of i)mI(l,e,n)?(a=l,s||(s=l)):(a&&r.push([s,a]),a=null,s=null);s&&r.push([s,null]);const o=[];for(const[l,d]of r)l===d?o.push(l):!d&&l===i[0]?o.push("*"):d?l===i[0]?o.push(`<=${d}`):o.push(`${l} - ${d}`):o.push(`>=${l}`);const u=o.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e};const Lp=Kn(),_f=Lc(),{ANY:kl}=_f,Da=Dc,yf=Gn,bI=(t,e,n={})=>{if(t===e)return!0;t=new Lp(t,n),e=new Lp(e,n);let r=!1;e:for(const s of t.set){for(const a of e.set){const i=yI(s,a,n);if(r=r||i!==null,i)continue e}if(r)return!1}return!0},_I=[new _f(">=0.0.0-0")],Dp=[new _f(">=0.0.0")],yI=(t,e,n)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===kl){if(e.length===1&&e[0].semver===kl)return!0;n.includePrerelease?t=_I:t=Dp}if(e.length===1&&e[0].semver===kl){if(n.includePrerelease)return!0;e=Dp}const r=new Set;let s,a;for(const p of t)p.operator===">"||p.operator===">="?s=Mp(s,p,n):p.operator==="<"||p.operator==="<="?a=Bp(a,p,n):r.add(p.semver);if(r.size>1)return null;let i;if(s&&a){if(i=yf(s.semver,a.semver,n),i>0)return null;if(i===0&&(s.operator!==">="||a.operator!=="<="))return null}for(const p of r){if(s&&!Da(p,String(s),n)||a&&!Da(p,String(a),n))return null;for(const f of e)if(!Da(p,String(f),n))return!1;return!0}let o,u,c,l,d=a&&!n.includePrerelease&&a.semver.prerelease.length?a.semver:!1,m=s&&!n.includePrerelease&&s.semver.prerelease.length?s.semver:!1;d&&d.prerelease.length===1&&a.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(const p of e){if(l=l||p.operator===">"||p.operator===">=",c=c||p.operator==="<"||p.operator==="<=",s){if(m&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===m.major&&p.semver.minor===m.minor&&p.semver.patch===m.patch&&(m=!1),p.operator===">"||p.operator===">="){if(o=Mp(s,p,n),o===p&&o!==s)return!1}else if(s.operator===">="&&!Da(s.semver,String(p),n))return!1}if(a){if(d&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===d.major&&p.semver.minor===d.minor&&p.semver.patch===d.patch&&(d=!1),p.operator==="<"||p.operator==="<="){if(u=Bp(a,p,n),u===p&&u!==a)return!1}else if(a.operator==="<="&&!Da(a.semver,String(p),n))return!1}if(!p.operator&&(a||s)&&i!==0)return!1}return!(s&&c&&!a&&i!==0||a&&l&&!s&&i!==0||m||d)},Mp=(t,e,n)=>{if(!t)return e;const r=yf(t.semver,e.semver,n);return r>0?t:r<0||e.operator===">"&&t.operator===">="?e:t},Bp=(t,e,n)=>{if(!t)return e;const r=yf(t.semver,e.semver,n);return r<0?t:r>0||e.operator==="<"&&t.operator==="<="?e:t};var EI=bI;const Nl=ao,Fp=Rc,wI=Vt,Up=$_,TI=ya,SI=kv,AI=Pv,CI=Lv,vI=Mv,OI=Uv,II=$v,kI=zv,NI=Kv,RI=Gn,PI=Xv,xI=tO,LI=ff,DI=aO,MI=uO,BI=xc,FI=mf,UI=q_,jI=V_,HI=pf,$I=gf,qI=z_,VI=RO,zI=Lc(),WI=Kn(),GI=Dc,KI=FO,YI=$O,ZI=WO,JI=YO,XI=XO,QI=bf,ek=uI,tk=dI,nk=fI,rk=gI,sk=EI;Nl.re,Nl.src,Nl.t,Fp.SEMVER_SPEC_VERSION,Fp.RELEASE_TYPES,Up.compareIdentifiers,Up.rcompareIdentifiers;function xr(t){if(!t||t.split("/").length>2||t.startsWith("/")||t.endsWith("/")||t.split(":").length>2)throw new Error(`Invalid identifier format: ${t}`);const[e,n]=t.split(":"),r=n||"latest";if(e.includes("/")){const[s,a]=e.split("/",2);if(!s||!a)throw new Error(`Invalid identifier format: ${t}`);return[s,a,r]}else{if(!e)throw new Error(`Invalid identifier format: ${t}`);return["-",e,r]}}class ak extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function Te(t,e,n){let r;if(t.ok){n&&(r=await t.text());return}r=await t.text();const s=`Failed to ${e}. Received status [${t.status}]: ${t.statusText}. Server response: ${r}`;throw t.status===409?new ak(s):new Error(s)}var jp="[...]",ik={result:"[Circular]"},qu=[],Js=[];function ok(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function on(t,e,n,r){var i;try{return JSON.stringify(t,e,n)}catch(o){if(!((i=o.message)!=null&&i.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),"[Unserializable]";console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof r>"u"&&(r=ok()),Xd(t,"",0,[],void 0,0,r);var s;try{Js.length===0?s=JSON.stringify(t,e,n):s=JSON.stringify(t,uk(e),n)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;qu.length!==0;){var a=qu.pop();a.length===4?Object.defineProperty(a[0],a[1],a[3]):a[0][a[1]]=a[2]}}return s}}function Rl(t,e,n,r){var s=Object.getOwnPropertyDescriptor(r,n);s.get!==void 0?s.configurable?(Object.defineProperty(r,n,{value:t}),qu.push([r,n,e,s])):Js.push([e,n,t]):(r[n]=t,qu.push([r,n,e]))}function Xd(t,e,n,r,s,a,i){a+=1;var o;if(typeof t=="object"&&t!==null){for(o=0;o<r.length;o++)if(r[o]===t){Rl(ik,t,e,s);return}if(typeof i.depthLimit<"u"&&a>i.depthLimit){Rl(jp,t,e,s);return}if(typeof i.edgesLimit<"u"&&n+1>i.edgesLimit){Rl(jp,t,e,s);return}if(r.push(t),Array.isArray(t))for(o=0;o<t.length;o++)Xd(t[o],o,o,r,t,a,i);else{var u=Object.keys(t);for(o=0;o<u.length;o++){var c=u[o];Xd(t[c],c,o,r,t,a,i)}}r.pop()}}function uk(t){return t=typeof t<"u"?t:function(e,n){return n},function(e,n){if(Js.length>0)for(var r=0;r<Js.length;r++){var s=Js[r];if(s[1]===e&&s[0]===n){n=s[2],Js.splice(r,1);break}}return t.call(this,e,n)}}function Hp(t){const e=Y_(),n=wk(),r=t.extra??{},s=r.metadata;return t.extra={...r,runtime:{...e,...r==null?void 0:r.runtime},metadata:{...n,...n.revision_id||t.revision_id?{revision_id:t.revision_id??n.revision_id}:{},...s}},t}const ck=()=>{const t=Hr("TRACING_SAMPLING_RATE");if(t===void 0)return;const e=parseFloat(t);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},lk=t=>{const n=t.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return n==="localhost"||n==="127.0.0.1"||n==="::1"};async function dk(t){const e=[];for await(const n of t)e.push(n);return e}function Pl(t){if(t!==void 0)return t.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const hk=async t=>{if((t==null?void 0:t.status)===429){const e=parseInt(t.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(n=>setTimeout(n,e)),!0}return!1};class fk{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let n;const r=new Promise(a=>{n=a}),s=on(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:n,itemPromise:r,size:s}),this.sizeBytes+=s,r}pop(e){var s;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const n=[];let r=0;for(;r+(((s=this.peek())==null?void 0:s.size)??0)<e&&this.items.length>0;){const a=this.items.shift();a&&(n.push(a),r+=a.size,this.sizeBytes-=a.size)}if(n.length===0&&this.items.length>0){const a=this.items.shift();n.push(a),r+=a.size,this.sizeBytes-=a.size}return[n.map(a=>({action:a.action,item:a.payload})),()=>n.forEach(a=>a.itemPromiseResolve())]}}const mk=20971520,pk=2500;class Bi{constructor(e={}){var r;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new fk}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:fs("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1});const n=Bi.getDefaultClientConfig();if(this.tracingSampleRate=ck(),this.apiUrl=Pl(e.apiUrl??n.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Pl(e.apiKey??n.apiKey),this.webUrl=Pl(e.webUrl??n.webUrl),(r=this.webUrl)!=null&&r.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new bp(e.callerOptions??{}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.batchIngestCaller=new bp({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:hk}),this.hideInputs=e.hideInputs??e.anonymizer??n.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??n.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=Hr("API_KEY"),n=Hr("ENDPOINT")??"https://api.smith.langchain.com",r=Hr("HIDE_INPUTS")==="true",s=Hr("HIDE_OUTPUTS")==="true";return{apiUrl:n,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:lk(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${G_}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const n={...e};return n.inputs!==void 0&&(n.inputs=this.processInputs(n.inputs)),n.outputs!==void 0&&(n.outputs=this.processOutputs(n.outputs)),n}async _getResponse(e,n){const r=(n==null?void 0:n.toString())??"",s=`${this.apiUrl}${e}?${r}`,a=await this.caller.call(ue(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(a,`Failed to fetch ${e}`),a}async _get(e,n){return(await this._getResponse(e,n)).json()}async*_getPaginated(e,n=new URLSearchParams,r){let s=Number(n.get("offset"))||0;const a=Number(n.get("limit"))||100;for(;;){n.set("offset",String(s)),n.set("limit",String(a));const i=`${this.apiUrl}${e}?${n}`,o=await this.caller.call(ue(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(o,`Failed to fetch ${e}`);const u=r?r(await o.json()):await o.json();if(u.length===0||(yield u,u.length<a))break;s+=u.length}}async*_getCursorPaginatedList(e,n=null,r="POST",s="runs"){const a=n?{...n}:{};for(;;){const o=await(await this.caller.call(ue(),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)})).json();if(!o||!o[s])break;yield o[s];const u=o.cursors;if(!u||!u.next)break;a.cursor=u.next}}_filterForSampling(e,n=!1){if(this.tracingSampleRate===void 0)return e;if(n){const r=[];for(const s of e)this.filteredPostUuids.has(s.id)?this.filteredPostUuids.delete(s.id):r.push(s);return r}else{const r=[];for(const s of e)s.id!==s.trace_id&&!this.filteredPostUuids.has(s.trace_id)||Math.random()<this.tracingSampleRate?r.push(s):this.filteredPostUuids.add(s.id);return r}}async _getBatchSizeLimitBytes(){var n;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((n=e.batch_ingest_config)==null?void 0:n.size_limit_bytes)??mk}async _getMultiPartSupport(){var n;return((n=(await this._ensureServerInfo()).instance_flags)==null?void 0:n.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const n=[];for(;this.autoBatchQueue.items.length>0;){const[r,s]=this.autoBatchQueue.pop(e);if(!r.length){s();break}const a=this._processBatch(r,s).catch(console.error);n.push(a)}return Promise.all(n)}async _processBatch(e,n){var r;if(!e.length){n();return}try{const s={runCreates:e.filter(i=>i.action==="create").map(i=>i.item),runUpdates:e.filter(i=>i.action==="update").map(i=>i.item)},a=await this._ensureServerInfo();(r=a==null?void 0:a.batch_ingest_config)!=null&&r.use_multipart_endpoint?await this.multipartIngestRuns(s):await this.batchIngestRuns(s)}finally{n()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=Hp(e.item));const n=this.autoBatchQueue.push(e);if(this.manualFlushMode)return n;const r=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>r&&this.drainAutoBatchQueue(r),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(r)},this.autoBatchAggregationDelayMs)),n}async _getServerInfo(){const e=await ue()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(pk),...this.fetchOptions});return await Te(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const n={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const s=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}const a=Hp(s),i=await this.caller.call(ue(),`${this.apiUrl}/runs`,{method:"POST",headers:n,body:on(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(i,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:n}){if(e===void 0&&n===void 0)return;let r=(e==null?void 0:e.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[],s=(n==null?void 0:n.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[];if(r.length>0&&s.length>0){const o=r.reduce((c,l)=>(l.id&&(c[l.id]=l),c),{}),u=[];for(const c of s)c.id!==void 0&&o[c.id]?o[c.id]={...o[c.id],...c}:u.push(c);r=Object.values(o),s=u}const a={post:this._filterForSampling(r),patch:this._filterForSampling(s,!0)};if(!a.post.length&&!a.patch.length)return;const i={post:[],patch:[]};for(const o of["post","patch"]){const u=o,c=a[u].reverse();let l=c.pop();for(;l!==void 0;)i[u].push(l),l=c.pop()}(i.post.length>0||i.patch.length>0)&&await this._postBatchIngestRuns(on(i))}async _postBatchIngestRuns(e){const n={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(ue(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:n,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:n}){if(e===void 0&&n===void 0)return;const r={};let s=[];for(const l of e??[]){const d=this.prepareRunCreateOrUpdateInputs(l);d.id!==void 0&&d.attachments!==void 0&&(r[d.id]=d.attachments),delete d.attachments,s.push(d)}let a=[];for(const l of n??[])a.push(this.prepareRunCreateOrUpdateInputs(l));if(s.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&a.length>0){const l=s.reduce((m,p)=>(p.id&&(m[p.id]=p),m),{}),d=[];for(const m of a)m.id!==void 0&&l[m.id]?l[m.id]={...l[m.id],...m}:d.push(m);s=Object.values(l),a=d}if(s.length===0&&a.length===0)return;const u=[],c=[];for(const[l,d]of[["post",s],["patch",a]])for(const m of d){const{inputs:p,outputs:f,events:g,attachments:b,..._}=m,y={inputs:p,outputs:f,events:g},E=on(_);c.push({name:`${l}.${_.id}`,payload:new Blob([E],{type:`application/json; length=${E.length}`})});for(const[I,w]of Object.entries(y)){if(w===void 0)continue;const O=on(w);c.push({name:`${l}.${_.id}.${I}`,payload:new Blob([O],{type:`application/json; length=${O.length}`})})}if(_.id!==void 0){const I=r[_.id];if(I){delete r[_.id];for(const[w,O]of Object.entries(I)){let S,x;if(Array.isArray(O)?[S,x]=O:(S=O.mimeType,x=O.data),w.includes(".")){console.warn(`Skipping attachment '${w}' for run ${_.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}c.push({name:`attachment.${_.id}.${w}`,payload:new Blob([x],{type:`${S}; length=${x.byteLength}`})})}}}u.push(`trace=${_.trace_id},id=${_.id}`)}await this._sendMultipartRequest(c,u.join("; "))}async _sendMultipartRequest(e,n){try{const r="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),s=[];for(const u of e)s.push(new Blob([`--${r}\r
`])),s.push(new Blob([`Content-Disposition: form-data; name="${u.name}"\r
`,`Content-Type: ${u.payload.type}\r
\r
`])),s.push(u.payload),s.push(new Blob([`\r
`]));s.push(new Blob([`--${r}--\r
`]));const i=await new Blob(s).arrayBuffer(),o=await this.batchIngestCaller.call(ue(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${r}`},body:i,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(o,"ingest multipart runs",!0)}catch(r){console.warn(`${r.message.trim()}

Context: ${n}`)}}async updateRun(e,n){ve(e),n.inputs&&(n.inputs=this.processInputs(n.inputs)),n.outputs&&(n.outputs=this.processOutputs(n.outputs));const r={...n,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(n.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:r}).catch(console.error);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}const s={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(ue(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:on(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(a,"update run",!0)}async readRun(e,{loadChildRuns:n}={loadChildRuns:!1}){ve(e);let r=await this._get(`/runs/${e}`);return n&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:n,projectOpts:r}){if(n!==void 0){let s;n.session_id?s=n.session_id:r!=null&&r.projectName?s=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?s=r==null?void 0:r.projectId:s=(await this.readProject({projectName:Hr("PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s}/r/${n.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const n=await dk(this.listRuns({id:e.child_run_ids})),r={},s={};n.sort((a,i)=>((a==null?void 0:a.dotted_order)??"").localeCompare((i==null?void 0:i.dotted_order)??""));for(const a of n){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);a.parent_run_id in r||(r[a.parent_run_id]=[]),r[a.parent_run_id].push(a),s[a.id]=a}e.child_runs=r[e.id]||[];for(const a in r)a!==e.id&&(s[a].child_runs=r[a]);return e}async*listRuns(e){const{projectId:n,projectName:r,parentRunId:s,traceId:a,referenceExampleId:i,startTime:o,executionOrder:u,isRoot:c,runType:l,error:d,id:m,query:p,filter:f,traceFilter:g,treeFilter:b,limit:_,select:y}=e;let E=[];if(n&&(E=Array.isArray(n)?n:[n]),r){const S=Array.isArray(r)?r:[r],x=await Promise.all(S.map(D=>this.readProject({projectName:D}).then(B=>B.id)));E.push(...x)}const I=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],w={session:E.length?E:null,run_type:l,reference_example:i,query:p,filter:f,trace_filter:g,tree_filter:b,execution_order:u,parent_run:s,start_time:o?o.toISOString():null,error:d,id:m,limit:_,trace:a,select:y||I,is_root:c};let O=0;for await(const S of this._getCursorPaginatedList("/runs/query",w))if(_){if(O>=_)break;if(S.length+O>_){yield*S.slice(0,_-O);break}O+=S.length,yield*S}else yield*S}async getRunStats({id:e,trace:n,parentRun:r,runType:s,projectNames:a,projectIds:i,referenceExampleIds:o,startTime:u,endTime:c,error:l,query:d,filter:m,traceFilter:p,treeFilter:f,isRoot:g,dataSourceType:b}){let _=i||[];a&&(_=[...i||[],...await Promise.all(a.map(O=>this.readProject({projectName:O}).then(S=>S.id)))]);const E=Object.fromEntries(Object.entries({id:e,trace:n,parent_run:r,run_type:s,session:_,reference_example:o,start_time:u,end_time:c,error:l,query:d,filter:m,trace_filter:p,tree_filter:f,is_root:g,data_source_type:b}).filter(([O,S])=>S!==void 0));return await(await this.caller.call(ue(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(E),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:n}={}){const r={run_id:e,share_token:n||Jt()};ve(e);const a=await(await this.caller.call(ue(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){ve(e);const n=await this.caller.call(ue(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(n,"unshare run",!0)}async readRunSharedLink(e){ve(e);const r=await(await this.caller.call(ue(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:n}={}){const r=new URLSearchParams({share_token:e});if(n!==void 0)for(const i of n)r.append("id",i);return ve(e),await(await this.caller.call(ue(),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,n){if(!e&&!n)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:n})).id),ve(e);const s=await(await this.caller.call(ue(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,n){if(!e&&!n)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:n})).id);const r={dataset_id:e};ve(e);const a=await(await this.caller.call(ue(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){ve(e);const n=await this.caller.call(ue(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(n,"unshare dataset",!0)}async readSharedDataset(e){return ve(e),await(await this.caller.call(ue(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,n){const r={};n!=null&&n.exampleIds&&(r.id=n.exampleIds);const s=new URLSearchParams;Object.entries(r).forEach(([o,u])=>{Array.isArray(u)?u.forEach(c=>s.append(o,c)):s.append(o,u)});const a=await this.caller.call(ue(),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await a.json();if(!a.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${i.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return i.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:n=null,metadata:r=null,upsert:s=!1,projectExtra:a=null,referenceDatasetId:i=null}){const o=s?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,c=a||{};r&&(c.metadata=r);const l={name:e,extra:c,description:n};i!==null&&(l.reference_dataset_id=i);const d=await this.caller.call(ue(),u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(d,"create project"),await d.json()}async updateProject(e,{name:n=null,description:r=null,metadata:s=null,projectExtra:a=null,endTime:i=null}){const o=`${this.apiUrl}/sessions/${e}`;let u=a;s&&(u={...u||{},metadata:s});const c={name:n,extra:u,description:r,end_time:i?new Date(i).toISOString():null},l=await this.caller.call(ue(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(l,"update project"),await l.json()}async hasProject({projectId:e,projectName:n}){let r="/sessions";const s=new URLSearchParams;if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ve(e),r+=`/${e}`;else if(n!==void 0)s.append("name",n);else throw new Error("Must provide projectName or projectId");const a=await this.caller.call(ue(),`${this.apiUrl}${r}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const i=await a.json();return a.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:n,includeStats:r}){let s="/sessions";const a=new URLSearchParams;if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ve(e),s+=`/${e}`;else if(n!==void 0)a.append("name",n);else throw new Error("Must provide projectName or projectId");r!==void 0&&a.append("include_stats",r.toString());const i=await this._get(s,a);let o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${n}] not found`);o=i[0]}else o=i;return o}async getProjectUrl({projectId:e,projectName:n}){if(e===void 0&&n===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:n}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:n}){if(e===void 0&&n===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:n}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const n of this._getPaginated("/sessions",e))return this._tenantId=n[0].tenant_id,n[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:n,nameContains:r,referenceDatasetId:s,referenceDatasetName:a,referenceFree:i,metadata:o}={}){const u=new URLSearchParams;if(e!==void 0)for(const c of e)u.append("id",c);if(n!==void 0&&u.append("name",n),r!==void 0&&u.append("name_contains",r),s!==void 0)u.append("reference_dataset",s);else if(a!==void 0){const c=await this.readDataset({datasetName:a});u.append("reference_dataset",c.id)}i!==void 0&&u.append("reference_free",i.toString()),o!==void 0&&u.append("metadata",JSON.stringify(o));for await(const c of this._getPaginated("/sessions",u))yield*c}async deleteProject({projectId:e,projectName:n}){let r;if(e===void 0&&n===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:n})).id:r=e,ve(r);const s=await this.caller.call(ue(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(s,`delete session ${r} (${n})`,!0)}async uploadCsv({csvFile:e,fileName:n,inputKeys:r,outputKeys:s,description:a,dataType:i,name:o}){const u=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,n),r.forEach(m=>{c.append("input_keys",m)}),s.forEach(m=>{c.append("output_keys",m)}),a&&c.append("description",a),i&&c.append("data_type",i),o&&c.append("name",o);const l=await this.caller.call(ue(),u,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(l,"upload CSV"),await l.json()}async createDataset(e,{description:n,dataType:r,inputsSchema:s,outputsSchema:a,metadata:i}={}){const o={name:e,description:n,extra:i?{metadata:i}:void 0};r&&(o.data_type=r),s&&(o.inputs_schema_definition=s),a&&(o.outputs_schema_definition=a);const u=await this.caller.call(ue(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(u,"create dataset"),await u.json()}async readDataset({datasetId:e,datasetName:n}){let r="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)ve(e),r+=`/${e}`;else if(n!==void 0)s.append("name",n);else throw new Error("Must provide datasetName or datasetId");const a=await this._get(r,s);let i;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${n}] not found`);i=a[0]}else i=a;return i}async hasDataset({datasetId:e,datasetName:n}){try{return await this.readDataset({datasetId:e,datasetName:n}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:n,fromVersion:r,toVersion:s}){let a=e;if(a===void 0&&n===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:n})).id);const i=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:n}){const r="/datasets";if(e===void 0)if(n!==void 0)e=(await this.readDataset({datasetName:n})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:n=0,datasetIds:r,datasetName:s,datasetNameContains:a,metadata:i}={}){const o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:n.toString()});if(r!==void 0)for(const c of r)u.append("id",c);s!==void 0&&u.append("name",s),a!==void 0&&u.append("name_contains",a),i!==void 0&&u.append("metadata",JSON.stringify(i));for await(const c of this._getPaginated(o,u))yield*c}async updateDataset(e){const{datasetId:n,datasetName:r,...s}=e;if(!n&&!r)throw new Error("Must provide either datasetName or datasetId");const a=n??(await this.readDataset({datasetName:r})).id;ve(a);const i=await this.caller.call(ue(),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(i,"update dataset"),await i.json()}async updateDatasetTag(e){const{datasetId:n,datasetName:r,asOf:s,tag:a}=e;if(!n&&!r)throw new Error("Must provide either datasetName or datasetId");const i=n??(await this.readDataset({datasetName:r})).id;ve(i);const o=await this.caller.call(ue(),`${this.apiUrl}/datasets/${i}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:n}){let r="/datasets",s=e;if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(n!==void 0&&(s=(await this.readDataset({datasetName:n})).id),s!==void 0)ve(s),r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const a=await this.caller.call(ue(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(a,`delete ${r}`),await a.json()}async indexDataset({datasetId:e,datasetName:n,tag:r}){let s=e;if(!s&&!n)throw new Error("Must provide either datasetName or datasetId");if(s&&n)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:n})).id),ve(s);const a={tag:r},i=await this.caller.call(ue(),`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(i,"index dataset"),await i.json()}async similarExamples(e,n,r,{filter:s}={}){const a={limit:r,inputs:e};s!==void 0&&(a.filter=s),ve(n);const i=await this.caller.call(ue(),`${this.apiUrl}/datasets/${n}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,n,{datasetId:r,datasetName:s,createdAt:a,exampleId:i,metadata:o,split:u,sourceRunId:c}){let l=r;if(l===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(l!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");l===void 0&&(l=(await this.readDataset({datasetName:s})).id);const d=a||new Date,m={dataset_id:l,inputs:e,outputs:n,created_at:d==null?void 0:d.toISOString(),id:i,metadata:o,split:u,source_run_id:c},p=await this.caller.call(ue(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(p,"create example"),await p.json()}async createExamples(e){const{inputs:n,outputs:r,metadata:s,sourceRunIds:a,exampleIds:i,datasetId:o,datasetName:u}=e;let c=o;if(c===void 0&&u===void 0)throw new Error("Must provide either datasetName or datasetId");if(c!==void 0&&u!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");c===void 0&&(c=(await this.readDataset({datasetName:u})).id);const l=n.map((p,f)=>({dataset_id:c,inputs:p,outputs:r?r[f]:void 0,metadata:s?s[f]:void 0,split:e.splits?e.splits[f]:void 0,id:i?i[f]:void 0,source_run_id:a?a[f]:void 0})),d=await this.caller.call(ue(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(d,"create examples"),await d.json()}async createLLMExample(e,n,r){return this.createExample({input:e},{output:n},r)}async createChatExample(e,n,r){const s=e.map(i=>_p(i)?yp(i):i),a=_p(n)?yp(n):n;return this.createExample({input:s},{output:a},r)}async readExample(e){ve(e);const n=`/examples/${e}`,r=await this._get(n),{attachment_urls:s,...a}=r,i=a;return s&&(i.attachments=Object.entries(s).reduce((o,[u,c])=>(o[u.slice(11)]={presigned_url:c.presigned_url,mime_type:c.mime_type},o),{})),i}async*listExamples({datasetId:e,datasetName:n,exampleIds:r,asOf:s,splits:a,inlineS3Urls:i,metadata:o,limit:u,offset:c,filter:l,includeAttachments:d}={}){let m;if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)m=e;else if(n!==void 0)m=(await this.readDataset({datasetName:n})).id;else throw new Error("Must provide a datasetName or datasetId");const p=new URLSearchParams({dataset:m}),f=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;f&&p.append("as_of",f);const g=i??!0;if(p.append("inline_s3_urls",g.toString()),r!==void 0)for(const _ of r)p.append("id",_);if(a!==void 0)for(const _ of a)p.append("splits",_);if(o!==void 0){const _=JSON.stringify(o);p.append("metadata",_)}u!==void 0&&p.append("limit",u.toString()),c!==void 0&&p.append("offset",c.toString()),l!==void 0&&p.append("filter",l),d===!0&&["attachment_urls","outputs","metadata"].forEach(_=>p.append("select",_));let b=0;for await(const _ of this._getPaginated("/examples",p)){for(const y of _){const{attachment_urls:E,...I}=y,w=I;E&&(w.attachments=Object.entries(E).reduce((O,[S,x])=>(O[S.slice(11)]={presigned_url:x.presigned_url,mime_type:x.mime_type||void 0},O),{})),yield w,b++}if(u!==void 0&&b>=u)break}}async deleteExample(e){ve(e);const n=`/examples/${e}`,r=await this.caller.call(ue(),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(r,`delete ${n}`),await r.json()}async updateExample(e,n){ve(e);const r=await this.caller.call(ue(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(r,"update example"),await r.json()}async updateExamples(e){const n=await this.caller.call(ue(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(n,"update examples"),await n.json()}async readDatasetVersion({datasetId:e,datasetName:n,asOf:r,tag:s}){let a;if(e?a=e:a=(await this.readDataset({datasetName:n})).id,ve(a),r&&s||!r&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const i=new URLSearchParams;r!==void 0&&i.append("as_of",typeof r=="string"?r:r.toISOString()),s!==void 0&&i.append("tag",s);const o=await this.caller.call(ue(),`${this.apiUrl}/datasets/${a}/version?${i.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:n,asOf:r}){let s;if(e===void 0&&n===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:n})).id:s=e,ve(s);const a=new URLSearchParams,i=r?typeof r=="string"?r:r==null?void 0:r.toISOString():void 0;return i&&a.append("as_of",i),await this._get(`/datasets/${s}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:n,splitName:r,exampleIds:s,remove:a=!1}){let i;if(e===void 0&&n===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:n})).id:i=e,ve(i);const o={split_name:r,examples:s.map(c=>(ve(c),c)),remove:a},u=await this.caller.call(ue(),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(u,"update dataset splits",!0)}async evaluateRun(e,n,{sourceInfo:r,loadChildRuns:s,referenceExample:a}={loadChildRuns:!1}){U_("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(a=await this.readExample(i.reference_example_id));const o=await n.evaluateRun(i,a),[u,c]=await this._logEvaluationFeedback(o,i,r);return c[0]}async createFeedback(e,n,{score:r,value:s,correction:a,comment:i,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:c,feedbackId:l,feedbackConfig:d,projectId:m,comparativeExperimentId:p}){var y;if(!e&&!m)throw new Error("One of runId or projectId must be provided");if(e&&m)throw new Error("Only one of runId or projectId can be provided");const f={type:u??"api",metadata:o??{}};c!==void 0&&(f==null?void 0:f.metadata)!==void 0&&!f.metadata.__run&&(f.metadata.__run={run_id:c}),(f==null?void 0:f.metadata)!==void 0&&((y=f.metadata.__run)==null?void 0:y.run_id)!==void 0&&ve(f.metadata.__run.run_id);const g={id:l??Jt(),run_id:e,key:n,score:r,value:s,correction:a,comment:i,feedback_source:f,comparative_experiment_id:p,feedbackConfig:d,session_id:m},b=`${this.apiUrl}/feedback`,_=await this.caller.call(ue(),b,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(g),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(_,"create feedback",!0),g}async updateFeedback(e,{score:n,value:r,correction:s,comment:a}){const i={};n!=null&&(i.score=n),r!=null&&(i.value=r),s!=null&&(i.correction=s),a!=null&&(i.comment=a),ve(e);const o=await this.caller.call(ue(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(o,"update feedback",!0)}async readFeedback(e){ve(e);const n=`/feedback/${e}`;return await this._get(n)}async deleteFeedback(e){ve(e);const n=`/feedback/${e}`,r=await this.caller.call(ue(),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(r,`delete ${n}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:n,feedbackSourceTypes:r}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),n)for(const a of n)s.append("key",a);if(r)for(const a of r)s.append("source",a);for await(const a of this._getPaginated("/feedback",s))yield*a}async createPresignedFeedbackToken(e,n,{expiration:r,feedbackConfig:s}={}){const a={run_id:e,feedback_key:n,feedback_config:s};return r?typeof r=="string"?a.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(a.expires_in=r):a.expires_in={hours:3},await(await this.caller.call(ue(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:n,referenceDatasetId:r,createdAt:s,description:a,metadata:i,id:o}){var l;if(n.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:n[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const u={id:o,name:e,experiment_ids:n,reference_dataset_id:r,description:a,created_at:(l=s??new Date)==null?void 0:l.toISOString(),extra:{}};return i&&(u.extra.metadata=i),await(await this.caller.call(ue(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){ve(e);const n=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",n))yield*r}_selectEvalResults(e){let n;return"results"in e?n=e.results:n=[e],n}async _logEvaluationFeedback(e,n,r){const s=this._selectEvalResults(e),a=[];for(const i of s){let o=r||{};i.evaluatorInfo&&(o={...i.evaluatorInfo,...o});let u=null;i.targetRunId?u=i.targetRunId:n&&(u=n.id),a.push(await this.createFeedback(u,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[s,a]}async logEvaluationFeedback(e,n,r){const[s]=await this._logEvaluationFeedback(e,n,r);return s}async*listAnnotationQueues(e={}){const{queueIds:n,name:r,nameContains:s,limit:a}=e,i=new URLSearchParams;n&&n.forEach((u,c)=>{ve(u,`queueIds[${c}]`),i.append("ids",u)}),r&&i.append("name",r),s&&i.append("name_contains",s),i.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(const u of this._getPaginated("/annotation-queues",i))if(yield*u,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){const{name:n,description:r,queueId:s}=e,a={name:n,description:r,id:s||Jt()},i=await this.caller.call(ue(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(a).filter(([u,c])=>c!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(i,"create annotation queue"),await i.json()}async readAnnotationQueue(e){const n=await this.listAnnotationQueues({queueIds:[e]}).next();if(n.done)throw new Error(`Annotation queue with ID ${e} not found`);return n.value}async updateAnnotationQueue(e,n){const{name:r,description:s}=n,a=await this.caller.call(ue(),`${this.apiUrl}/annotation-queues/${ve(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:s}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(a,"update annotation queue")}async deleteAnnotationQueue(e){const n=await this.caller.call(ue(),`${this.apiUrl}/annotation-queues/${ve(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(n,"delete annotation queue")}async addRunsToAnnotationQueue(e,n){const r=await this.caller.call(ue(),`${this.apiUrl}/annotation-queues/${ve(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n.map((s,a)=>ve(s,`runIds[${a}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,n){const r=`/annotation-queues/${ve(e,"queueId")}/run`,s=await this.caller.call(ue(),`${this.apiUrl}${r}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(s,"get run from annotation queue"),await s.json()}async deleteRunFromAnnotationQueue(e,n){const r=await this.caller.call(ue(),`${this.apiUrl}/annotation-queues/${ve(e,"queueId")}/runs/${ve(n,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(r,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const n=await this.caller.call(ue(),`${this.apiUrl}/annotation-queues/${ve(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(n,"get size from annotation queue"),await n.json()}async _currentTenantIsOwner(e){const n=await this._getSettings();return e=="-"||n.tenant_handle===e}async _ownerConflictError(e,n){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${n}`)}async _getLatestCommitHash(e){const n=await this.caller.call(ue(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await n.json();if(!n.ok){const s=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),a=new Error(`Error ${n.status}: ${n.statusText}
${s}`);throw a.statusCode=n.status,a}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,n){const[r,s,a]=xr(e),i=await this.caller.call(ue(),`${this.apiUrl}/likes/${r}/${s}`,{method:"POST",body:JSON.stringify({like:n}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(i,`${n?"like":"unlike"} prompt`),await i.json()}async _getPromptUrl(e){const[n,r,s]=xr(e);if(await this._currentTenantIsOwner(n)){const a=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${r}/${s.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${a.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${n}/${r}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${n}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const n of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*n}async*listPrompts(e){const n=new URLSearchParams;n.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),n.append("sort_direction","desc"),n.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&n.append("is_public",e.isPublic.toString()),e!=null&&e.query&&n.append("query",e.query);for await(const r of this._getPaginated("/repos",n,s=>s.repos))yield*r}async getPrompt(e){const[n,r,s]=xr(e),a=await this.caller.call(ue(),`${this.apiUrl}/repos/${n}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(a.status===404)return null;await Te(a,"get prompt");const i=await a.json();return i.repo?i.repo:null}async createPrompt(e,n){const r=await this._getSettings();if(n!=null&&n.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,a,i]=xr(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:a,...(n==null?void 0:n.description)&&{description:n.description},...(n==null?void 0:n.readme)&&{readme:n.readme},...(n==null?void 0:n.tags)&&{tags:n.tags},is_public:!!(n!=null&&n.isPublic)},u=await this.caller.call(ue(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(u,"create prompt");const{repo:c}=await u.json();return c}async createCommit(e,n,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,a,i]=xr(e),o=(r==null?void 0:r.parentCommitHash)==="latest"||!(r!=null&&r.parentCommitHash)?await this._getLatestCommitHash(`${s}/${a}`):r==null?void 0:r.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(n)),parent_commit:o},c=await this.caller.call(ue(),`${this.apiUrl}/commits/${s}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(c,"create commit");const l=await c.json();return this._getPromptUrl(`${s}/${a}${l.commit_hash?`:${l.commit_hash}`:""}`)}async updateExamplesMultipart(e,n=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const r=new FormData;for(const i of n){const o=i.id,u={...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split}},c=on(u),l=new Blob([c],{type:"application/json"});if(r.append(o,l),i.inputs){const d=on(i.inputs),m=new Blob([d],{type:"application/json"});r.append(`${o}.inputs`,m)}if(i.outputs){const d=on(i.outputs),m=new Blob([d],{type:"application/json"});r.append(`${o}.outputs`,m)}if(i.attachments)for(const[d,m]of Object.entries(i.attachments)){let p,f;Array.isArray(m)?[p,f]=m:(p=m.mimeType,f=m.data);const g=new Blob([f],{type:`${p}; length=${f.byteLength}`});r.append(`${o}.attachment.${d}`,g)}if(i.attachments_operations){const d=on(i.attachments_operations),m=new Blob([d],{type:"application/json"});r.append(`${o}.attachments_operations`,m)}}return await(await this.caller.call(ue(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"PATCH",headers:this.headers,body:r})).json()}async uploadExamplesMultipart(e,n=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const r=new FormData;for(const i of n){const o=(i.id??Jt()).toString(),u={created_at:i.created_at,...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split}},c=on(u),l=new Blob([c],{type:"application/json"});r.append(o,l);const d=on(i.inputs),m=new Blob([d],{type:"application/json"});if(r.append(`${o}.inputs`,m),i.outputs){const p=on(i.outputs),f=new Blob([p],{type:"application/json"});r.append(`${o}.outputs`,f)}if(i.attachments)for(const[p,f]of Object.entries(i.attachments)){let g,b;Array.isArray(f)?[g,b]=f:(g=f.mimeType,b=f.data);const _=new Blob([b],{type:`${g}; length=${b.byteLength}`});r.append(`${o}.attachment.${p}`,_)}}return await(await this.caller.call(ue(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:r})).json()}async updatePrompt(e,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,s]=xr(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const a={};if((n==null?void 0:n.description)!==void 0&&(a.description=n.description),(n==null?void 0:n.readme)!==void 0&&(a.readme=n.readme),(n==null?void 0:n.tags)!==void 0&&(a.tags=n.tags),(n==null?void 0:n.isPublic)!==void 0&&(a.is_public=n.isPublic),(n==null?void 0:n.isArchived)!==void 0&&(a.is_archived=n.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");const i=await this.caller.call(ue(),`${this.apiUrl}/repos/${r}/${s}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Te(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,r,s]=xr(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("delete a prompt",n);return await(await this.caller.call(ue(),`${this.apiUrl}/repos/${n}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,n){const[r,s,a]=xr(e),i=await this.caller.call(ue(),`${this.apiUrl}/commits/${r}/${s}/${a}${n!=null&&n.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Te(i,"pull prompt commit");const o=await i.json();return{owner:r,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,n){const r=await this.pullPromptCommit(e,{includeModel:n==null?void 0:n.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,n){return await this.promptExists(e)?n&&Object.keys(n).some(s=>s!=="object")&&await this.updatePrompt(e,{description:n==null?void 0:n.description,readme:n==null?void 0:n.readme,tags:n==null?void 0:n.tags,isPublic:n==null?void 0:n.isPublic}):await this.createPrompt(e,{description:n==null?void 0:n.description,readme:n==null?void 0:n.readme,tags:n==null?void 0:n.tags,isPublic:n==null?void 0:n.isPublic}),n!=null&&n.object?await this.createCommit(e,n==null?void 0:n.object,{parentCommitHash:n==null?void 0:n.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,n={}){const{sourceApiUrl:r=this.apiUrl,datasetName:s}=n,[a,i]=this.parseTokenOrUrl(e,r),o=new Bi({apiUrl:a,apiKey:"placeholder"}),u=await o.readSharedDataset(i),c=s||u.name;try{if(await this.hasDataset({datasetId:c})){console.log(`Dataset ${c} already exists in your tenant. Skipping.`);return}}catch{}const l=await o.listSharedExamples(i),d=await this.createDataset(c,{description:u.description,dataType:u.data_type||"kv",inputsSchema:u.inputs_schema_definition??void 0,outputsSchema:u.outputs_schema_definition??void 0});try{await this.createExamples({inputs:l.map(m=>m.inputs),outputs:l.flatMap(m=>m.outputs?[m.outputs]:[]),datasetId:d.id})}catch(m){throw console.error(`An error occurred while creating dataset ${c}. You should delete it manually.`),m}}parseTokenOrUrl(e,n,r=2,s="dataset"){try{return ve(e),[n,e]}catch{}try{const i=new URL(e).pathname.split("/").filter(o=>o!=="");if(i.length>=r){const o=i[i.length-r];return[n,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}const G_="0.3.3";let br;const gk=()=>typeof window<"u"&&typeof window.document<"u",bk=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",_k=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),K_=()=>typeof Deno<"u",yk=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!K_(),Ek=()=>br||(gk()?br="browser":yk()?br="node":bk()?br="webworker":_k()?br="jsdom":K_()?br="deno":br="other",br);let xl;function Y_(){if(xl===void 0){const t=Ek(),e=Sk();xl={library:"langsmith",runtime:t,sdk:"langsmith-js",sdk_version:G_,...e}}return xl}function wk(){const t=Tk()||{},e={},n=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[r,s]of Object.entries(t))(r.startsWith("LANGCHAIN_")||r.startsWith("LANGSMITH_"))&&typeof s=="string"&&!n.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[r]=s);return e}function Tk(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((t,[e,n])=>(t[e]=String(n),t),{}):void 0}catch{return}}function fs(t){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[t]:void 0}catch{return}}function Hr(t){return fs(`LANGSMITH_${t}`)||fs(`LANGCHAIN_${t}`)}let Ll;function Sk(){if(Ll!==void 0)return Ll;const t=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const n of t){const r=fs(n);r!==void 0&&(e[n]=r)}return Ll=e,e}const Ak=t=>!!["TRACING_V2","TRACING"].find(n=>Hr(n)==="true"),Dl=Symbol.for("lc:context_variables");function Ck(t){return t.replace(/[-:.]/g,"")}function vk(t,e,n=1){const r=n.toFixed(0).slice(0,3).padStart(3,"0");return Ck(`${new Date(t).toISOString().slice(0,-1)}${r}Z`)+e}class Vu{constructor(e,n){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=n}static fromHeader(e){const n=e.split(",");let r={},s=[];for(const a of n){const[i,o]=a.split("="),u=decodeURIComponent(o);i==="langsmith-metadata"?r=JSON.parse(u):i==="langsmith-tags"&&(s=u.split(","))}return new Vu(r,s)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class cn{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Z_(e)){Object.assign(this,{...e});return}const n=cn.getDefaultConfig(),{metadata:r,...s}=e,a=s.client??cn.getSharedClient(),i={...r,...(o=s==null?void 0:s.extra)==null?void 0:o.metadata};if(s.extra={...s.extra,metadata:i},Object.assign(this,{...n,...s,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const u=vk(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+u:this.dotted_order=u}}static getDefaultConfig(){return{id:Jt(),run_type:"chain",project_name:Hr("PROJECT")??fs("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:fs("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:fs("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return cn.sharedClient||(cn.sharedClient=new Bi),cn.sharedClient}createChild(e){var u,c,l,d,m,p;const n=this.child_execution_order+1,r=new cn({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:n,child_execution_order:n});Dl in this&&(r[Dl]=this[Dl]);const s=Symbol.for("lc:child_config"),a=((u=e.extra)==null?void 0:u[s])??this.extra[s];if(Ik(a)){const f={...a},g=Ok(f.callbacks)?(l=(c=f.callbacks).copy)==null?void 0:l.call(c):void 0;g&&(Object.assign(g,{_parentRunId:r.id}),(p=(m=(d=g.handlers)==null?void 0:d.find(J_))==null?void 0:m.updateFromRunTree)==null||p.call(m,r),f.callbacks=g),r.extra[s]=f}const i=new Set;let o=this;for(;o!=null&&!i.has(o.id);)i.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,n),o=o.parent_run;return this.child_runs.push(r),r}async end(e,n,r=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??n,this.end_time=this.end_time??r,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,n,r=!0){var u;const s=e.extra??{};if(s.runtime||(s.runtime={}),n)for(const[c,l]of Object.entries(n))s.runtime[c]||(s.runtime[c]=l);let a,i;return r?(i=(u=e.parent_run)==null?void 0:u.id,a=[]):(a=e.child_runs.map(c=>this._convertToCreate(c,n,r)),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments}}async postRun(e=!0){try{const n=Y_(),r=await this._convertToCreate(this,n,!0);if(await this.client.createRun(r),!e){U_("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const s of this.child_runs)await s.postRun(!1)}}catch(n){console.error(`Error in postRun for run ${this.id}:`,n)}}async patchRun(){var e;try{const n={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments};await this.client.updateRun(this.id,n)}catch(n){console.error(`Error in patchRun for run ${this.id}`,n)}}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,n){var c,l,d,m;const r=e==null?void 0:e.callbacks;let s,a,i,o=Ak();if(r){const p=((c=r==null?void 0:r.getParentRunId)==null?void 0:c.call(r))??"",f=(l=r==null?void 0:r.handlers)==null?void 0:l.find(g=>(g==null?void 0:g.name)=="langchain_tracer");s=(d=f==null?void 0:f.getRun)==null?void 0:d.call(f,p),a=f==null?void 0:f.projectName,i=f==null?void 0:f.client,o=o||!!f}return s?new cn({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:i,tracingEnabled:o,project_name:a,tags:[...new Set(((s==null?void 0:s.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(m=s==null?void 0:s.extra)==null?void 0:m.metadata,...e==null?void 0:e.metadata}}}).createChild(n):new cn({...n,client:i,tracingEnabled:o,project_name:a})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,n){var c;const r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=r["langsmith-trace"];if(!s||typeof s!="string")return;const a=s.trim(),i=a.split(".").map(l=>{const[d,m]=l.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:m}}),o=i[0].uuid,u={...n,name:(n==null?void 0:n.name)??"parent",run_type:(n==null?void 0:n.run_type)??"chain",start_time:(n==null?void 0:n.start_time)??Date.now(),id:(c=i.at(-1))==null?void 0:c.uuid,trace_id:o,dotted_order:a};if(r.baggage&&typeof r.baggage=="string"){const l=Vu.fromHeader(r.baggage);u.metadata=l.metadata,u.tags=l.tags}return new cn(u)}toHeaders(e){var r;const n={"langsmith-trace":this.dotted_order,baggage:new Vu((r=this.extra)==null?void 0:r.metadata,this.tags).toHeader()};if(e)for(const[s,a]of Object.entries(n))e.set(s,a);return n}}Object.defineProperty(cn,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function Z_(t){return t!==void 0&&typeof t.createChild=="function"&&typeof t.postRun=="function"}function J_(t){return typeof t=="object"&&t!=null&&typeof t.name=="string"&&t.name==="langchain_tracer"}function $p(t){return Array.isArray(t)&&t.some(e=>J_(e))}function Ok(t){return typeof t=="object"&&t!=null&&Array.isArray(t.handlers)}function Ik(t){var e;return t!==void 0&&typeof t.callbacks=="object"&&($p((e=t.callbacks)==null?void 0:e.handlers)||$p(t.callbacks))}let kk=class{getStore(){}run(e,n){return n()}};const Ml=Symbol.for("ls:tracing_async_local_storage"),Nk=new kk;let Rk=class{getInstance(){return globalThis[Ml]??Nk}initializeGlobalInstance(e){globalThis[Ml]===void 0&&(globalThis[Ml]=e)}};const Pk=new Rk,xk=()=>{const t=Pk.getInstance().getStore();if(!Z_(t))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function and that tracing is enabled."].join(`
`));return t};function Ef(t){return typeof t=="function"&&"langsmith:traceable"in t}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const Lk=Object.prototype.hasOwnProperty;function Qd(t,e){return Lk.call(t,e)}function eh(t){if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=""+r;return n}if(Object.keys)return Object.keys(t);let e=[];for(let n in t)Qd(t,n)&&e.push(n);return e}function ur(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function th(t){let e=0;const n=t.length;let r;for(;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Ms(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Dk(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function nh(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(nh(t[n]))return!0}else if(typeof t=="object"){const n=eh(t),r=n.length;for(var e=0;e<r;e++)if(nh(t[n[e]]))return!0}}return!1}function qp(t,e){const n=[t];for(const r in e){const s=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof s<"u"&&n.push(`${r}: ${s}`)}return n.join(`
`)}class Mk extends Error{constructor(e,n,r,s,a){super(qp(e,{name:n,index:r,operation:s,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=qp(e,{name:n,index:r,operation:s,tree:a})}}const ft=Mk,Xs={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){let r=rh(n,this.path);r&&(r=ur(r));const s=li(n,{op:"remove",path:this.from}).removed;return li(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:r}},copy:function(t,e,n){const r=rh(n,this.from);return li(n,{op:"add",path:this.path,value:ur(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:Wu(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}};var Bk={add:function(t,e,n){return th(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:Xs.move,copy:Xs.copy,test:Xs.test,_get:Xs._get};function rh(t,e){if(e=="")return t;var n={op:"_get",path:e};return li(t,n),n.value}function li(t,e,n=!1,r=!0,s=!0,a=0){if(n&&(typeof n=="function"?n(e,0,t,e.path):sh(e,0)),e.path===""){let i={newDocument:t};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=t,i;if(e.op==="move"||e.op==="copy")return i.newDocument=rh(t,e.from),e.op==="move"&&(i.removed=t),i;if(e.op==="test"){if(i.test=Wu(t,e.value),i.test===!1)throw new ft("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return i.newDocument=t,i}else{if(e.op==="remove")return i.removed=t,i.newDocument=null,i;if(e.op==="_get")return e.value=t,i;if(n)throw new ft("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,t);return i}}else{r||(t=ur(t));const o=(e.path||"").split("/");let u=t,c=1,l=o.length,d,m,p;for(typeof n=="function"?p=n:p=sh;;){if(m=o[c],m&&m.indexOf("~")!=-1&&(m=Dk(m)),s&&(m=="__proto__"||m=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(u[m]===void 0?d=o.slice(0,c).join("/"):c==l-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),c++,Array.isArray(u)){if(m==="-")m=u.length;else{if(n&&!th(m))throw new ft("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,t);th(m)&&(m=~~m)}if(c>=l){if(n&&e.op==="add"&&m>u.length)throw new ft("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,t);const f=Bk[e.op].call(e,u,m,t);if(f.test===!1)throw new ft("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return f}}else if(c>=l){const f=Xs[e.op].call(e,u,m,t);if(f.test===!1)throw new ft("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return f}if(u=u[m],n&&c<l&&(!u||typeof u!="object"))throw new ft("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,t)}}}function zu(t,e,n,r=!0,s=!0){if(n&&!Array.isArray(e))throw new ft("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=ur(t));const a=new Array(e.length);for(let i=0,o=e.length;i<o;i++)a[i]=li(t,e[i],n,!0,s,i),t=a[i].newDocument;return a.newDocument=t,a}function sh(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new ft("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(Xs[t.op]){if(typeof t.path!="string")throw new ft("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new ft('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new ft("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new ft("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&nh(t.value))throw new ft("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var s=t.path.split("/").length,a=r.split("/").length;if(s!==a+1&&s!==a)throw new ft("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new ft("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var i={op:"_get",path:t.from,value:void 0},o=Fk([i],n);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new ft("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new ft("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function Fk(t,e,n){try{if(!Array.isArray(t))throw new ft("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)zu(ur(e),ur(t),n||!0);else{n=n||sh;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(s){if(s instanceof ft)return s;throw s}}function Wu(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),s,a,i;if(n&&r){if(a=t.length,a!=e.length)return!1;for(s=a;s--!==0;)if(!Wu(t[s],e[s]))return!1;return!0}if(n!=r)return!1;var o=Object.keys(t);if(a=o.length,a!==Object.keys(e).length)return!1;for(s=a;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=a;s--!==0;)if(i=o[s],!Wu(t[i],e[i]))return!1;return!0}return t!==t&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function X_(t,e,n,r,s){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var a=eh(e),i=eh(t),o=!1,u=i.length-1;u>=0;u--){var c=i[u],l=t[c];if(Qd(e,c)&&!(e[c]===void 0&&l!==void 0&&Array.isArray(e)===!1)){var d=e[c];typeof l=="object"&&l!=null&&typeof d=="object"&&d!=null&&Array.isArray(l)===Array.isArray(d)?X_(l,d,n,r+"/"+Ms(c),s):l!==d&&(s&&n.push({op:"test",path:r+"/"+Ms(c),value:ur(l)}),n.push({op:"replace",path:r+"/"+Ms(c),value:ur(d)}))}else Array.isArray(t)===Array.isArray(e)?(s&&n.push({op:"test",path:r+"/"+Ms(c),value:ur(l)}),n.push({op:"remove",path:r+"/"+Ms(c)}),o=!0):(s&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!o&&a.length==i.length))for(var u=0;u<a.length;u++){var c=a[u];!Qd(t,c)&&e[c]!==void 0&&n.push({op:"add",path:r+"/"+Ms(c),value:ur(e[c])})}}}function Uk(t,e,n=!1){var r=[];return X_(t,e,r,"",n),r}var jk=function(t,e){if(typeof t!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,t.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const Hk=ro(jk);var Q_={exports:{}};const $k=/[\p{Lu}]/u,qk=/[\p{Ll}]/u,Vp=/^[\p{Lu}](?![\p{Lu}])/gu,ey=/([\p{Alpha}\p{N}_]|$)/u,ty=/[_.\- ]+/,Vk=new RegExp("^"+ty.source),zp=new RegExp(ty.source+ey.source,"gu"),Wp=new RegExp("\\d+"+ey.source,"gu"),zk=(t,e,n)=>{let r=!1,s=!1,a=!1;for(let i=0;i<t.length;i++){const o=t[i];r&&$k.test(o)?(t=t.slice(0,i)+"-"+t.slice(i),r=!1,a=s,s=!0,i++):s&&a&&qk.test(o)?(t=t.slice(0,i-1)+"-"+t.slice(i-1),a=s,s=!1,r=!0):(r=e(o)===o&&n(o)!==o,a=s,s=n(o)===o&&e(o)!==o)}return t},Wk=(t,e)=>(Vp.lastIndex=0,t.replace(Vp,n=>e(n))),Gk=(t,e)=>(zp.lastIndex=0,Wp.lastIndex=0,t.replace(zp,(n,r)=>e(r)).replace(Wp,n=>e(n))),ny=(t,e)=>{if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(a=>a.trim()).filter(a=>a.length).join("-"):t=t.trim(),t.length===0)return"";const n=e.locale===!1?a=>a.toLowerCase():a=>a.toLocaleLowerCase(e.locale),r=e.locale===!1?a=>a.toUpperCase():a=>a.toLocaleUpperCase(e.locale);return t.length===1?e.pascalCase?r(t):n(t):(t!==n(t)&&(t=zk(t,n,r)),t=t.replace(Vk,""),e.preserveConsecutiveUppercase?t=Wk(t,n):t=n(t),e.pascalCase&&(t=r(t.charAt(0))+t.slice(1)),Gk(t,r))};Q_.exports=ny;Q_.exports.default=ny;function Kk(t,e){return(e==null?void 0:e[t])||Hk(t)}function Yk(t,e,n){const r={};for(const s in t)Object.hasOwn(t,s)&&(r[e(s,n)]=t[s]);return r}function Gp(t){return Array.isArray(t)?[...t]:{...t}}function Zk(t,e){const n=Gp(t);for(const[r,s]of Object.entries(e)){const[a,...i]=r.split(".").reverse();let o=n;for(const u of i.reverse()){if(o[u]===void 0)break;o[u]=Gp(o[u]),o=o[u]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[s]})}return n}function ry(t){const e=Object.getPrototypeOf(t);return typeof t.lc_name=="function"&&(typeof e.lc_name!="function"||t.lc_name()!==e.lc_name())?t.lc_name():t.name}class Kr{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,ry(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...n){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof Kr||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},n={},r=Object.keys(this.lc_kwargs).reduce((s,a)=>(s[a]=a in this?this[a]:this.lc_kwargs[a],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(n,Reflect.get(s,"lc_secrets",this)),Object.assign(r,Reflect.get(s,"lc_attributes",this));return Object.keys(n).forEach(s=>{let a=this,i=r;const[o,...u]=s.split(".").reverse();for(const c of u.reverse()){if(!(c in a)||a[c]===void 0)return;(!(c in i)||i[c]===void 0)&&(typeof a[c]=="object"&&a[c]!=null?i[c]={}:Array.isArray(a[c])&&(i[c]=[])),a=a[c],i=i[c]}o in a&&a[o]!==void 0&&(i[o]=i[o]||a[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:Yk(Object.keys(n).length?Zk(r,n):r,Kk,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}const Jk=()=>typeof window<"u"&&typeof window.document<"u",Xk=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Qk=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),wf=()=>typeof Deno<"u",eN=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!wf(),tN=()=>{let t;return Jk()?t="browser":eN()?t="node":Xk()?t="webworker":Qk()?t="jsdom":wf()?t="deno":t="other",t};let Bl;async function nN(){return Bl===void 0&&(Bl={library:"langchain-js",runtime:tN()}),Bl}function gn(t){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[t]:wf()?Deno==null?void 0:Deno.env.get(t):void 0}catch{return}}class rN{}function sN(t){return"lc_prefer_streaming"in t&&t.lc_prefer_streaming}class io extends rN{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,ry(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:gn("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Kr.prototype.toJSON.call(this)}toJSONNotImplemented(){return Kr.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class n extends io{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Jt()}),Object.assign(this,e)}}return new n}}const aN=t=>{const e=t;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};function Fl(t,e){return t&&!Array.isArray(t)&&typeof t=="object"?t:{[e]:t}}function iN(t){return t.replace(/[-:.]/g,"")}function oN(t,e,n){const r=n.toFixed(0).slice(0,3).padStart(3,"0");return iN(`${new Date(t).toISOString().slice(0,-1)}${r}Z`)+e}function Ma(t){return typeof t._addRunToRunMap=="function"}class oo extends io{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,n){e.child_runs.push(n)}_addRunToRunMap(e){const n=oN(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){const s=this.runMap.get(r.parent_run_id);s&&(this._addChildRun(s,r),s.child_execution_order=Math.max(s.child_execution_order,r.child_execution_order),r.trace_id=s.trace_id,s.dotted_order!==void 0&&(r.dotted_order=[s.dotted_order,n].join(".")))}else r.trace_id=r.id,r.dotted_order=n;return this.runMap.set(r.id,r),r}async _endTrace(e){var r;const n=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);n?n.child_execution_order=Math.max(n.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((r=this.onRunUpdate)==null?void 0:r.call(this,e))}_getExecutionOrder(e){const n=e!==void 0&&this.runMap.get(e);return n?n.child_execution_order+1:1}_createRunForLLMStart(e,n,r,s,a,i,o,u){const c=this._getExecutionOrder(s),l=Date.now(),d=o?{...a,metadata:o}:a,m={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{prompts:n},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(m)}async handleLLMStart(e,n,r,s,a,i,o,u){var l,d;const c=this.runMap.get(r)??this._createRunForLLMStart(e,n,r,s,a,i,o,u);return await((l=this.onRunCreate)==null?void 0:l.call(this,c)),await((d=this.onLLMStart)==null?void 0:d.call(this,c)),c}_createRunForChatModelStart(e,n,r,s,a,i,o,u){const c=this._getExecutionOrder(s),l=Date.now(),d=o?{...a,metadata:o}:a,m={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{messages:n},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(m)}async handleChatModelStart(e,n,r,s,a,i,o,u){var l,d;const c=this.runMap.get(r)??this._createRunForChatModelStart(e,n,r,s,a,i,o,u);return await((l=this.onRunCreate)==null?void 0:l.call(this,c)),await((d=this.onLLMStart)==null?void 0:d.call(this,c)),c}async handleLLMEnd(e,n,r,s,a){var o;const i=this.runMap.get(n);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.outputs=e,i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...a},await((o=this.onLLMEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleLLMError(e,n,r,s,a){var o;const i=this.runMap.get(n);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...a},await((o=this.onLLMError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForChainStart(e,n,r,s,a,i,o,u){const c=this._getExecutionOrder(s),l=Date.now(),d={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:n,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(d)}async handleChainStart(e,n,r,s,a,i,o,u){var l,d;const c=this.runMap.get(r)??this._createRunForChainStart(e,n,r,s,a,i,o,u);return await((l=this.onRunCreate)==null?void 0:l.call(this,c)),await((d=this.onChainStart)==null?void 0:d.call(this,c)),c}async handleChainEnd(e,n,r,s,a){var o;const i=this.runMap.get(n);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=Fl(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=Fl(a.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleChainError(e,n,r,s,a){var o;const i=this.runMap.get(n);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=Fl(a.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForToolStart(e,n,r,s,a,i,o){const u=this._getExecutionOrder(s),c=Date.now(),l={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:n},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(l)}async handleToolStart(e,n,r,s,a,i,o){var c,l;const u=this.runMap.get(r)??this._createRunForToolStart(e,n,r,s,a,i,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((l=this.onToolStart)==null?void 0:l.call(this,u)),u}async handleToolEnd(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleToolError(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,n){var a;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentAction)==null?void 0:a.call(this,r))}async handleAgentEnd(e,n){var s;const r=this.runMap.get(n);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,r)))}_createRunForRetrieverStart(e,n,r,s,a,i,o){const u=this._getExecutionOrder(s),c=Date.now(),l={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:n},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(l)}async handleRetrieverStart(e,n,r,s,a,i,o){var c,l;const u=this.runMap.get(r)??this._createRunForRetrieverStart(e,n,r,s,a,i,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((l=this.onRetrieverStart)==null?void 0:l.call(this,u)),u}async handleRetrieverEnd(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleText(e,n){var s;const r=this.runMap.get(n);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,r)))}async handleLLMNewToken(e,n,r,s,a,i){var u;const o=this.runMap.get(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:n,chunk:i==null?void 0:i.chunk}}),await((u=this.onLLMNewToken)==null?void 0:u.call(this,o,e,{chunk:i==null?void 0:i.chunk})),o}}var Tf={exports:{}};Tf.exports;(function(t){const n=(a=0)=>i=>`\x1B[${38+a};5;${i}m`,r=(a=0)=>(i,o,u)=>`\x1B[${38+a};2;${i};${o};${u}m`;function s(){const a=new Map,i={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};i.color.gray=i.color.blackBright,i.bgColor.bgGray=i.bgColor.bgBlackBright,i.color.grey=i.color.blackBright,i.bgColor.bgGrey=i.bgColor.bgBlackBright;for(const[o,u]of Object.entries(i)){for(const[c,l]of Object.entries(u))i[c]={open:`\x1B[${l[0]}m`,close:`\x1B[${l[1]}m`},u[c]=i[c],a.set(l[0],l[1]);Object.defineProperty(i,o,{value:u,enumerable:!1})}return Object.defineProperty(i,"codes",{value:a,enumerable:!1}),i.color.close="\x1B[39m",i.bgColor.close="\x1B[49m",i.color.ansi256=n(),i.color.ansi16m=r(),i.bgColor.ansi256=n(10),i.bgColor.ansi16m=r(10),Object.defineProperties(i,{rgbToAnsi256:{value:(o,u,c)=>o===u&&u===c?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(u/255*5)+Math.round(c/255*5),enumerable:!1},hexToRgb:{value:o=>{const u=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!u)return[0,0,0];let{colorString:c}=u.groups;c.length===3&&(c=c.split("").map(d=>d+d).join(""));const l=Number.parseInt(c,16);return[l>>16&255,l>>8&255,l&255]},enumerable:!1},hexToAnsi256:{value:o=>i.rgbToAnsi256(...i.hexToRgb(o)),enumerable:!1}}),i}Object.defineProperty(t,"exports",{enumerable:!0,get:s})})(Tf);var uN=Tf.exports;const sy=ro(uN);function Ut(t,e){return`${t.open}${e}${t.close}`}function Tn(t,e){try{return JSON.stringify(t,null,2)}catch{return e}}function Kp(t){return typeof t=="string"?t.trim():t==null?t:Tn(t,t.toString())}function Lr(t){if(!t.end_time)return"";const e=t.end_time-t.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:zt}=sy;class Yp extends oo{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const n=[];let r=e;for(;r.parent_run_id;){const s=this.runMap.get(r.parent_run_id);if(s)n.push(s),r=s;else break}return n}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((s,a,i)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return a===i.length-1?Ut(sy.bold,o):o}).join(" > ");return Ut(zt.grey,r)}onChainStart(e){const n=this.getBreadcrumbs(e);console.log(`${Ut(zt.green,"[chain/start]")} [${n}] Entering Chain run with input: ${Tn(e.inputs,"[inputs]")}`)}onChainEnd(e){const n=this.getBreadcrumbs(e);console.log(`${Ut(zt.cyan,"[chain/end]")} [${n}] [${Lr(e)}] Exiting Chain run with output: ${Tn(e.outputs,"[outputs]")}`)}onChainError(e){const n=this.getBreadcrumbs(e);console.log(`${Ut(zt.red,"[chain/error]")} [${n}] [${Lr(e)}] Chain run errored with error: ${Tn(e.error,"[error]")}`)}onLLMStart(e){const n=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${Ut(zt.green,"[llm/start]")} [${n}] Entering LLM run with input: ${Tn(r,"[inputs]")}`)}onLLMEnd(e){const n=this.getBreadcrumbs(e);console.log(`${Ut(zt.cyan,"[llm/end]")} [${n}] [${Lr(e)}] Exiting LLM run with output: ${Tn(e.outputs,"[response]")}`)}onLLMError(e){const n=this.getBreadcrumbs(e);console.log(`${Ut(zt.red,"[llm/error]")} [${n}] [${Lr(e)}] LLM run errored with error: ${Tn(e.error,"[error]")}`)}onToolStart(e){const n=this.getBreadcrumbs(e);console.log(`${Ut(zt.green,"[tool/start]")} [${n}] Entering Tool run with input: "${Kp(e.inputs.input)}"`)}onToolEnd(e){var r;const n=this.getBreadcrumbs(e);console.log(`${Ut(zt.cyan,"[tool/end]")} [${n}] [${Lr(e)}] Exiting Tool run with output: "${Kp((r=e.outputs)==null?void 0:r.output)}"`)}onToolError(e){const n=this.getBreadcrumbs(e);console.log(`${Ut(zt.red,"[tool/error]")} [${n}] [${Lr(e)}] Tool run errored with error: ${Tn(e.error,"[error]")}`)}onRetrieverStart(e){const n=this.getBreadcrumbs(e);console.log(`${Ut(zt.green,"[retriever/start]")} [${n}] Entering Retriever run with input: ${Tn(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const n=this.getBreadcrumbs(e);console.log(`${Ut(zt.cyan,"[retriever/end]")} [${n}] [${Lr(e)}] Exiting Retriever run with output: ${Tn(e.outputs,"[outputs]")}`)}onRetrieverError(e){const n=this.getBreadcrumbs(e);console.log(`${Ut(zt.red,"[retriever/error]")} [${n}] [${Lr(e)}] Retriever run errored with error: ${Tn(e.error,"[error]")}`)}onAgentAction(e){const n=e,r=this.getBreadcrumbs(e);console.log(`${Ut(zt.blue,"[agent/action]")} [${r}] Agent selected action: ${Tn(n.actions[n.actions.length-1],"[action]")}`)}}function ay(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,t}function Sf(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="tool_call")}class iy extends Error{constructor(e,n){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=n}}function Zp(t,e=Af){t=t.trim();const n=/```(json)?(.*)```/s.exec(t);return e(n?n[2]:t)}function Af(t){if(typeof t>"u")return null;try{return JSON.parse(t)}catch{}let e="";const n=[];let r=!1,s=!1;for(let a of t){if(r)a==='"'&&!s?r=!1:a===`
`&&!s?a="\\n":a==="\\"?s=!s:s=!1;else if(a==='"')r=!0,s=!1;else if(a==="{")n.push("}");else if(a==="[")n.push("]");else if(a==="}"||a==="]")if(n[n.length-1]===a)n.pop();else return null;e+=a}r&&(e+='"');for(let a=n.length-1;a>=0;a-=1)e+=n[a];try{return JSON.parse(e)}catch{return null}}function Ea(t,e){return typeof t=="string"?typeof e=="string"?t+e:[{type:"text",text:t},...e]:Array.isArray(e)?Mc(t,e)??[...t,...e]:[...t,{type:"text",text:e}]}function cN(t,e){return t==="error"||e==="error"?"error":"success"}function lN(t,e){function n(r,s){if(typeof r!="object"||r===null||r===void 0)return r;if(s>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(i=>n(i,s+1));const a={};for(const i of Object.keys(r))a[i]=n(r[i],s+1);return a}return JSON.stringify(n(t,0),null,2)}class wa extends Kr{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}getType(){return this._getType()}constructor(e,n){typeof e=="string"&&(e={content:e,additional_kwargs:n,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const n=lN(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${n}`}}function qt(t,e){const n={...t};for(const[r,s]of Object.entries(e))if(n[r]==null)n[r]=s;else{if(s==null)continue;if(typeof n[r]!=typeof s||Array.isArray(n[r])!==Array.isArray(s))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof n[r]=="string"){if(r==="type")continue;n[r]+=s}else if(typeof n[r]=="object"&&!Array.isArray(n[r]))n[r]=qt(n[r],s);else if(Array.isArray(n[r]))n[r]=Mc(n[r],s);else{if(n[r]===s)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return n}function Mc(t,e){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t||e;{const n=[...t];for(const r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){const s=n.findIndex(a=>a.index===r.index);s!==-1?n[s]=qt(n[s],r):n.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;n.push(r)}return n}}}function dN(t,e){if(!t&&!e)throw new Error("Cannot merge two undefined objects.");if(!t||!e)return t||e;if(typeof t!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof t}
Right ${typeof e}`);if(typeof t=="string"&&typeof e=="string")return t+e;if(Array.isArray(t)&&Array.isArray(e))return Mc(t,e);if(typeof t=="object"&&typeof e=="object")return qt(t,e);if(t===e)return t;throw new Error(`Can not merge objects of different types.
Left ${t}
Right ${e}`)}class Ta extends wa{}function hN(t){return typeof t.role=="string"}function Bc(t){return typeof(t==null?void 0:t._getType)=="function"}function fN(t){return Bc(t)&&typeof t.concat=="function"}function mN(t){return t!=null&&typeof t=="object"&&"lc_direct_tool_output"in t&&t.lc_direct_tool_output===!0}class ah extends wa{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,n,r){typeof e=="string"&&(e={content:e,name:r,tool_call_id:n}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class Cf extends Ta{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new Cf({content:Ea(this.content,e.content),additional_kwargs:qt(this.additional_kwargs,e.additional_kwargs),response_metadata:qt(this.response_metadata,e.response_metadata),artifact:dN(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:cN(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function pN(t){const e=[],n=[];for(const r of t)if(r.function){const s=r.function.name;try{const a=JSON.parse(r.function.arguments),i={name:s||"",args:a||{},id:r.id};e.push(i)}catch{n.push({name:s,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,n]}class ws extends wa{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,n){var s;let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:n??{}};else{r=e;const a=(s=r.additional_kwargs)==null?void 0:s.tool_calls,i=r.tool_calls;a!=null&&a.length>0&&(i===void 0||i.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(a!=null&&i===void 0){const[o,u]=pN(a);r.tool_calls=o??[],r.invalid_tool_calls=u??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function uo(t){return t._getType()==="ai"}function Jp(t){return t._getType()==="ai"}class Xt extends Ta{constructor(e){let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)n={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const r=[],s=[];for(const a of e.tool_call_chunks){let i={};try{if(i=Af(a.args||"{}"),i===null||typeof i!="object"||Array.isArray(i))throw new Error("Malformed tool call chunk args.");r.push({name:a.name??"",args:i,id:a.id,type:"tool_call"})}catch{s.push({name:a.name,args:a.args,id:a.id,error:"Malformed args.",type:"invalid_tool_call"})}}n={...e,tool_calls:r,invalid_tool_calls:s,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=n.tool_call_chunks??this.tool_call_chunks,this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=n.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var r,s,a,i,o,u,c,l,d,m,p,f,g,b,_,y,E,I,w,O,S,x,D,B,Q,K,ee,L,N,U,V,M,z,X,W,se,_e,Pe,Oe,yt;const n={content:Ea(this.content,e.content),additional_kwargs:qt(this.additional_kwargs,e.additional_kwargs),response_metadata:qt(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const It=Mc(this.tool_call_chunks,e.tool_call_chunks);It!==void 0&&It.length>0&&(n.tool_call_chunks=It)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const It={...(((s=(r=this.usage_metadata)==null?void 0:r.input_token_details)==null?void 0:s.audio)!==void 0||((i=(a=e.usage_metadata)==null?void 0:a.input_token_details)==null?void 0:i.audio)!==void 0)&&{audio:(((u=(o=this.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:u.audio)??0)+(((l=(c=e.usage_metadata)==null?void 0:c.input_token_details)==null?void 0:l.audio)??0)},...(((m=(d=this.usage_metadata)==null?void 0:d.input_token_details)==null?void 0:m.cache_read)!==void 0||((f=(p=e.usage_metadata)==null?void 0:p.input_token_details)==null?void 0:f.cache_read)!==void 0)&&{cache_read:(((b=(g=this.usage_metadata)==null?void 0:g.input_token_details)==null?void 0:b.cache_read)??0)+(((y=(_=e.usage_metadata)==null?void 0:_.input_token_details)==null?void 0:y.cache_read)??0)},...(((I=(E=this.usage_metadata)==null?void 0:E.input_token_details)==null?void 0:I.cache_creation)!==void 0||((O=(w=e.usage_metadata)==null?void 0:w.input_token_details)==null?void 0:O.cache_creation)!==void 0)&&{cache_creation:(((x=(S=this.usage_metadata)==null?void 0:S.input_token_details)==null?void 0:x.cache_creation)??0)+(((B=(D=e.usage_metadata)==null?void 0:D.input_token_details)==null?void 0:B.cache_creation)??0)}},Rr={...(((K=(Q=this.usage_metadata)==null?void 0:Q.output_token_details)==null?void 0:K.audio)!==void 0||((L=(ee=e.usage_metadata)==null?void 0:ee.output_token_details)==null?void 0:L.audio)!==void 0)&&{audio:(((U=(N=this.usage_metadata)==null?void 0:N.output_token_details)==null?void 0:U.audio)??0)+(((M=(V=e.usage_metadata)==null?void 0:V.output_token_details)==null?void 0:M.audio)??0)},...(((X=(z=this.usage_metadata)==null?void 0:z.output_token_details)==null?void 0:X.reasoning)!==void 0||((se=(W=e.usage_metadata)==null?void 0:W.output_token_details)==null?void 0:se.reasoning)!==void 0)&&{reasoning:(((Pe=(_e=this.usage_metadata)==null?void 0:_e.output_token_details)==null?void 0:Pe.reasoning)??0)+(((yt=(Oe=e.usage_metadata)==null?void 0:Oe.output_token_details)==null?void 0:yt.reasoning)??0)}},In=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Et=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Xn={input_tokens:In.input_tokens+Et.input_tokens,output_tokens:In.output_tokens+Et.output_tokens,total_tokens:In.total_tokens+Et.total_tokens,...Object.keys(It).length>0&&{input_token_details:It},...Object.keys(Rr).length>0&&{output_token_details:Rr}};n.usage_metadata=Xn}return new Xt(n)}}class co extends wa{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return co}constructor(e,n){typeof e=="string"&&(e={content:e,role:n}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class Fc extends Ta{static lc_name(){return"ChatMessageChunk"}constructor(e,n){typeof e=="string"&&(e={content:e,role:n}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Fc({content:Ea(this.content,e.content),additional_kwargs:qt(this.additional_kwargs,e.additional_kwargs),response_metadata:qt(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class Uc extends Ta{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new Uc({content:Ea(this.content,e.content),additional_kwargs:qt(this.additional_kwargs,e.additional_kwargs),response_metadata:qt(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class cr extends wa{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class jc extends Ta{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new jc({content:Ea(this.content,e.content),additional_kwargs:qt(this.additional_kwargs,e.additional_kwargs),response_metadata:qt(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class ih extends wa{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class Fi extends Ta{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new Fi({content:Ea(this.content,e.content),additional_kwargs:qt(this.additional_kwargs,e.additional_kwargs),response_metadata:qt(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function gN(t){return Sf(t)?t:typeof t.id=="string"&&t.type==="function"&&typeof t.function=="object"&&t.function!==null&&"arguments"in t.function&&typeof t.function.arguments=="string"&&"name"in t.function&&typeof t.function.name=="string"?{id:t.id,args:JSON.parse(t.function.arguments),name:t.function.name,type:"tool_call"}:t}function bN(t){return typeof t=="object"&&t!=null&&t.lc===1&&Array.isArray(t.id)&&t.kwargs!=null&&typeof t.kwargs=="object"}function Ul(t){let e,n;if(bN(t)){const r=t.id.at(-1);r==="HumanMessage"||r==="HumanMessageChunk"?e="user":r==="AIMessage"||r==="AIMessageChunk"?e="assistant":r==="SystemMessage"||r==="SystemMessageChunk"?e="system":e="unknown",n=t.kwargs}else{const{type:r,...s}=t;e=r,n=s}if(e==="human"||e==="user")return new cr(n);if(e==="ai"||e==="assistant"){const{tool_calls:r,...s}=n;if(!Array.isArray(r))return new ws(n);const a=r.map(gN);return new ws({...s,tool_calls:a})}else{if(e==="system")return new ih(n);if(e==="developer")return new ih({...n,additional_kwargs:{...n.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in n)return new ah({...n,content:n.content,tool_call_id:n.tool_call_id,name:n.name});throw ay(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(t,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function Xa(t){if(typeof t=="string")return new cr(t);if(Bc(t))return t;if(Array.isArray(t)){const[e,n]=t;return Ul({type:e,content:n})}else if(hN(t)){const{role:e,...n}=t;return Ul({...n,type:e})}else return Ul(t)}function oy(t,e="Human",n="AI"){const r=[];for(const s of t){let a;if(s._getType()==="human")a=e;else if(s._getType()==="ai")a=n;else if(s._getType()==="system")a="System";else if(s._getType()==="function")a="Function";else if(s._getType()==="tool")a="Tool";else if(s._getType()==="generic")a=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);const i=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);r.push(`${a}: ${i}${o}`)}return r.join(`
`)}function _N(t){var n;const e=t._getType();if(e==="human")return new jc({...t});if(e==="ai"){let r={...t};return"tool_calls"in r&&(r={...r,tool_call_chunks:(n=r.tool_calls)==null?void 0:n.map(s=>({...s,type:"tool_call_chunk",index:void 0,args:JSON.stringify(s.args)}))}),new Xt({...r})}else{if(e==="system")return new Fi({...t});if(e==="function")return new Uc({...t});if(co.isInstance(t))return new Fc({...t});throw new Error("Unknown message type.")}}let jl;const yN=()=>{if(jl===void 0){const t=gn("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};jl=new Bi(t)}return jl};class di extends oo{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:n,projectName:r,client:s}=e;this.projectName=r??gn("LANGCHAIN_PROJECT")??gn("LANGCHAIN_SESSION"),this.exampleId=n,this.client=s??yN();const a=di.getTraceableRunTree();a&&this.updateFromRunTree(a)}async _convertToCreate(e,n=void 0){return{...e,extra:{...e.extra,runtime:await nN()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:n}}async persistRun(e){}async onRunCreate(e){const n=await this._convertToCreate(e,this.exampleId);await this.client.createRun(n)}async onRunUpdate(e){const n={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id,extra:e.extra};await this.client.updateRun(e.id,n)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let n=e;const r=new Set;for(;n.parent_run&&!(r.has(n.id)||(r.add(n.id),!n.parent_run));)n=n.parent_run;r.clear();const s=[n];for(;s.length>0;){const a=s.shift();!a||r.has(a.id)||(r.add(a.id),this.runMap.set(a.id,a),a.child_runs&&s.push(...a.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const n={},r=[];for(const[s,a]of this.runMap){const i=new cn({...a,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});n[s]=i,r.push([s,a.dotted_order])}r.sort((s,a)=>!s[1]||!a[1]?0:s[1].localeCompare(a[1]));for(const[s]of r){const a=this.runMap.get(s),i=n[s];if(!(!a||!i)&&a.parent_run_id){const o=n[a.parent_run_id];o&&(o.child_runs.push(i),i.parent_run=o)}}return n[e]}static getTraceableRunTree(){try{return xk()}catch{return}}}const uy=Symbol.for("ls:tracing_async_local_storage"),_u=Symbol.for("lc:context_variables"),EN=t=>{globalThis[uy]=t},Ui=()=>globalThis[uy];let hi;function wN(){const t="default"in Ir?Ir.default:Ir;return new t({autoStart:!0,concurrency:1})}function TN(){return typeof hi>"u"&&(hi=wN()),hi}async function bt(t,e){if(e===!0){const n=Ui();n!==void 0?await n.run(void 0,async()=>t()):await t()}else hi=TN(),hi.add(async()=>{const n=Ui();n!==void 0?await n.run(void 0,async()=>t()):await t()})}const SN=t=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(n=>gn(n)==="true");function cy(t){var r;const e=Ui();if(e===void 0)return;const n=e.getStore();return(r=n==null?void 0:n[_u])==null?void 0:r[t]}const AN=Symbol("lc:configure_hooks"),CN=()=>cy(AN)||[];function ly(t){return t?Array.isArray(t)||"name"in t?{callbacks:t}:t:{}}class vN{setHandler(e){return this.setHandlers([e])}}class Hc{constructor(e,n,r,s,a,i,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(n=>bt(async()=>{var r;try{await((r=n.handleText)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleText: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}async handleCustomEvent(e,n,r,s,a){await Promise.all(this.handlers.map(i=>bt(async()=>{var o;try{await((o=i.handleCustomEvent)==null?void 0:o.call(i,e,n,this.runId,this.tags,this.metadata))}catch(u){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${u}`),i.raiseError)throw u}},i.awaitHandlers)))}}class ON extends Hc{getChild(e){const n=new Mt(this.runId);return n.setHandlers(this.inheritableHandlers),n.addTags(this.inheritableTags),n.addMetadata(this.inheritableMetadata),e&&n.addTags([e],!1),n}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(n=>bt(async()=>{var r;if(!n.ignoreRetriever)try{await((r=n.handleRetrieverEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleRetriever`),n.raiseError)throw s}},n.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(n=>bt(async()=>{var r;if(!n.ignoreRetriever)try{await((r=n.handleRetrieverError)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleRetrieverError: ${s}`),n.raiseError)throw e}},n.awaitHandlers)))}}class Xp extends Hc{async handleLLMNewToken(e,n,r,s,a,i){await Promise.all(this.handlers.map(o=>bt(async()=>{var u;if(!o.ignoreLLM)try{await((u=o.handleLLMNewToken)==null?void 0:u.call(o,e,n??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i))}catch(c){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${c}`),o.raiseError)throw c}},o.awaitHandlers)))}async handleLLMError(e,n,r,s,a){await Promise.all(this.handlers.map(i=>bt(async()=>{var o;if(!i.ignoreLLM)try{await((o=i.handleLLMError)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMError: ${u}`),i.raiseError)throw u}},i.awaitHandlers)))}async handleLLMEnd(e,n,r,s,a){await Promise.all(this.handlers.map(i=>bt(async()=>{var o;if(!i.ignoreLLM)try{await((o=i.handleLLMEnd)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMEnd: ${u}`),i.raiseError)throw u}},i.awaitHandlers)))}}class IN extends Hc{getChild(e){const n=new Mt(this.runId);return n.setHandlers(this.inheritableHandlers),n.addTags(this.inheritableTags),n.addMetadata(this.inheritableMetadata),e&&n.addTags([e],!1),n}async handleChainError(e,n,r,s,a){await Promise.all(this.handlers.map(i=>bt(async()=>{var o;if(!i.ignoreChain)try{await((o=i.handleChainError)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainError: ${u}`),i.raiseError)throw u}},i.awaitHandlers)))}async handleChainEnd(e,n,r,s,a){await Promise.all(this.handlers.map(i=>bt(async()=>{var o;if(!i.ignoreChain)try{await((o=i.handleChainEnd)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainEnd: ${u}`),i.raiseError)throw u}},i.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(n=>bt(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleAgentAction)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleAgentAction: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(n=>bt(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleAgentEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleAgentEnd: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}}class kN extends Hc{getChild(e){const n=new Mt(this.runId);return n.setHandlers(this.inheritableHandlers),n.addTags(this.inheritableTags),n.addMetadata(this.inheritableMetadata),e&&n.addTags([e],!1),n}async handleToolError(e){await Promise.all(this.handlers.map(n=>bt(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleToolError)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleToolError: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(n=>bt(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleToolEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleToolEnd: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}}class Mt extends vN{constructor(e,n){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(n==null?void 0:n.handlers)??this.handlers,this.inheritableHandlers=(n==null?void 0:n.inheritableHandlers)??this.inheritableHandlers,this.tags=(n==null?void 0:n.tags)??this.tags,this.inheritableTags=(n==null?void 0:n.inheritableTags)??this.inheritableTags,this.metadata=(n==null?void 0:n.metadata)??this.metadata,this.inheritableMetadata=(n==null?void 0:n.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,n,r=void 0,s=void 0,a=void 0,i=void 0,o=void 0,u=void 0){return Promise.all(n.map(async(c,l)=>{const d=l===0&&r?r:Jt();return await Promise.all(this.handlers.map(m=>{if(!m.ignoreLLM)return Ma(m)&&m._createRunForLLMStart(e,[c],d,this._parentRunId,a,this.tags,this.metadata,u),bt(async()=>{var p;try{await((p=m.handleLLMStart)==null?void 0:p.call(m,e,[c],d,this._parentRunId,a,this.tags,this.metadata,u))}catch(f){if((m.raiseError?console.error:console.warn)(`Error in handler ${m.constructor.name}, handleLLMStart: ${f}`),m.raiseError)throw f}},m.awaitHandlers)})),new Xp(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,n,r=void 0,s=void 0,a=void 0,i=void 0,o=void 0,u=void 0){return Promise.all(n.map(async(c,l)=>{const d=l===0&&r?r:Jt();return await Promise.all(this.handlers.map(m=>{if(!m.ignoreLLM)return Ma(m)&&m._createRunForChatModelStart(e,[c],d,this._parentRunId,a,this.tags,this.metadata,u),bt(async()=>{var p,f;try{if(m.handleChatModelStart)await((p=m.handleChatModelStart)==null?void 0:p.call(m,e,[c],d,this._parentRunId,a,this.tags,this.metadata,u));else if(m.handleLLMStart){const g=oy(c);await((f=m.handleLLMStart)==null?void 0:f.call(m,e,[g],d,this._parentRunId,a,this.tags,this.metadata,u))}}catch(g){if((m.raiseError?console.error:console.warn)(`Error in handler ${m.constructor.name}, handleLLMStart: ${g}`),m.raiseError)throw g}},m.awaitHandlers)})),new Xp(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,n,r=Jt(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreChain)return Ma(u)&&u._createRunForChainStart(e,n,r,this._parentRunId,this.tags,this.metadata,s,o),bt(async()=>{var c;try{await((c=u.handleChainStart)==null?void 0:c.call(u,e,n,r,this._parentRunId,this.tags,this.metadata,s,o))}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new IN(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,n,r=Jt(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return Ma(u)&&u._createRunForToolStart(e,n,r,this._parentRunId,this.tags,this.metadata,o),bt(async()=>{var c;try{await((c=u.handleToolStart)==null?void 0:c.call(u,e,n,r,this._parentRunId,this.tags,this.metadata,o))}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new kN(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,n,r=Jt(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return Ma(u)&&u._createRunForRetrieverStart(e,n,r,this._parentRunId,this.tags,this.metadata,o),bt(async()=>{var c;try{await((c=u.handleRetrieverStart)==null?void 0:c.call(u,e,n,r,this._parentRunId,this.tags,this.metadata,o))}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new ON(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,n,r,s,a){await Promise.all(this.handlers.map(i=>bt(async()=>{var o;if(!i.ignoreCustomEvent)try{await((o=i.handleCustomEvent)==null?void 0:o.call(i,e,n,r,this.tags,this.metadata))}catch(u){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${u}`),i.raiseError)throw u}},i.awaitHandlers)))}addHandler(e,n=!0){this.handlers.push(e),n&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(n=>n!==e),this.inheritableHandlers=this.inheritableHandlers.filter(n=>n!==e)}setHandlers(e,n=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,n)}addTags(e,n=!0){this.removeTags(e),this.tags.push(...e),n&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(n=>!e.includes(n)),this.inheritableTags=this.inheritableTags.filter(n=>!e.includes(n))}addMetadata(e,n=!0){this.metadata={...this.metadata,...e},n&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const n of Object.keys(e))delete this.metadata[n],delete this.inheritableMetadata[n]}copy(e=[],n=!0){const r=new Mt(this._parentRunId);for(const s of this.handlers){const a=this.inheritableHandlers.includes(s);r.addHandler(s,a)}for(const s of this.tags){const a=this.inheritableTags.includes(s);r.addTags([s],a)}for(const s of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(s);r.addMetadata({[s]:this.metadata[s]},a)}for(const s of e)r.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===s.name)||r.addHandler(s,n);return r}static fromHandlers(e){class n extends io{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Jt()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new n),r}static configure(e,n,r,s,a,i,o){return this._configureSync(e,n,r,s,a,i,o)}static _configureSync(e,n,r,s,a,i,o){var m,p;let u;(e||n)&&(Array.isArray(e)||!e?(u=new Mt,u.setHandlers((e==null?void 0:e.map(Gu))??[],!0)):u=e,u=u.copy(Array.isArray(n)?n.map(Gu):n==null?void 0:n.handlers,!1));const c=gn("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),l=((m=di.getTraceableRunTree())==null?void 0:m.tracingEnabled)||SN(),d=l||(gn("LANGCHAIN_TRACING")??!1);if(c||d){if(u||(u=new Mt),c&&!u.handlers.some(f=>f.name===Yp.prototype.name)){const f=new Yp;u.addHandler(f,!0)}if(d&&!u.handlers.some(f=>f.name==="langchain_tracer")&&l){const f=new di;u.addHandler(f,!0),u._parentRunId=((p=di.getTraceableRunTree())==null?void 0:p.id)??u._parentRunId}}for(const{contextVar:f,inheritable:g=!0,handlerClass:b,envVar:_}of CN()){const y=_&&gn(_)==="true"&&b;let E;const I=f!==void 0?cy(f):void 0;I&&aN(I)?E=I:y&&(E=new b({})),E!==void 0&&(u||(u=new Mt),u.handlers.some(w=>w.name===E.name)||u.addHandler(E,g))}return(r||s)&&u&&(u.addTags(r??[]),u.addTags(s??[],!1)),(a||i)&&u&&(u.addMetadata(a??{}),u.addMetadata(i??{},!1)),u}}function Gu(t){return"name"in t?t:io.fromMethods(t)}class NN{getStore(){}run(e,n){return n()}enterWith(e){}}const RN=new NN,Qp=Symbol.for("lc:child_config");class PN{getInstance(){return Ui()??RN}getRunnableConfig(){var n,r;return(r=(n=this.getInstance().getStore())==null?void 0:n.extra)==null?void 0:r[Qp]}runWithConfig(e,n,r){var l;const s=Mt._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),a=this.getInstance(),i=a.getStore(),o=s==null?void 0:s.getParentRunId(),u=(l=s==null?void 0:s.handlers)==null?void 0:l.find(d=>(d==null?void 0:d.name)==="langchain_tracer");let c;return u&&o?c=u.convertToRunTree(o):r||(c=new cn({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[Qp]:e}),i!==void 0&&i[_u]!==void 0&&(c[_u]=i[_u]),a.run(c,n)}initializeGlobalInstance(e){Ui()===void 0&&EN(e)}}const Yr=new PN,Hl=25;async function Hn(t){return Mt._configureSync(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata)}function eg(...t){const e={};for(const n of t.filter(r=>!!r))for(const r of Object.keys(n))if(r==="metadata")e[r]={...e[r],...n[r]};else if(r==="tags"){const s=e[r]??[];e[r]=[...new Set(s.concat(n[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...n[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=n.timeout:n.timeout!==void 0&&(e.timeout=Math.min(e.timeout,n.timeout));else if(r==="signal")e.signal===void 0?e.signal=n.signal:n.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,n.signal]):e.signal=n.signal);else if(r==="callbacks"){const s=e.callbacks,a=n.callbacks;if(Array.isArray(a))if(!s)e.callbacks=a;else if(Array.isArray(s))e.callbacks=s.concat(a);else{const i=s.copy();for(const o of a)i.addHandler(Gu(o),!0);e.callbacks=i}else if(a)if(!s)e.callbacks=a;else if(Array.isArray(s)){const i=a.copy();for(const o of s)i.addHandler(Gu(o),!0);e.callbacks=i}else e.callbacks=new Mt(a._parentRunId,{handlers:s.handlers.concat(a.handlers),inheritableHandlers:s.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(a.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(a.inheritableTags))),metadata:{...s.metadata,...a.metadata}})}else{const s=r;e[s]=n[s]??e[s]}return e}const xN=new Set(["string","number","boolean"]);function He(t){var r;const e=Yr.getRunnableConfig();let n={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:s,runName:a,...i}=e;n=Object.entries(i).reduce((o,[u,c])=>(c!==void 0&&(o[u]=c),o),n)}if(t&&(n=Object.entries(t).reduce((s,[a,i])=>(i!==void 0&&(s[a]=i),s),n)),n!=null&&n.configurable)for(const s of Object.keys(n.configurable))xN.has(typeof n.configurable[s])&&!((r=n.metadata)!=null&&r[s])&&(n.metadata||(n.metadata={}),n.metadata[s]=n.configurable[s]);if(n.timeout!==void 0){if(n.timeout<=0)throw new Error("Timeout must be a positive number");const s=AbortSignal.timeout(n.timeout);n.signal!==void 0?"any"in AbortSignal&&(n.signal=AbortSignal.any([n.signal,s])):n.signal=s,delete n.timeout}return n}function Lt(t={},{callbacks:e,maxConcurrency:n,recursionLimit:r,runName:s,configurable:a,runId:i}={}){const o=He(t);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),n!==void 0&&(o.maxConcurrency=n),s!==void 0&&(o.runName=s),a!==void 0&&(o.configurable={...o.configurable,...a}),i!==void 0&&delete o.runId,o}function da(t){return t?{configurable:t.configurable,recursionLimit:t.recursionLimit,callbacks:t.callbacks,tags:t.tags,metadata:t.metadata,maxConcurrency:t.maxConcurrency,timeout:t.timeout,signal:t.signal}:void 0}async function Zr(t,e){if(e===void 0)return t;let n;return Promise.race([t.catch(r=>{if(!(e!=null&&e.aborted))throw r}),new Promise((r,s)=>{n=()=>{s(new Error("Aborted"))},e.addEventListener("abort",n),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",n))}class _n extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const n=this.reader.cancel();this.reader.releaseLock(),await n}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const n=e.getReader();return new _n({start(r){return s();function s(){return n.read().then(({done:a,value:i})=>{if(a){r.close();return}return r.enqueue(i),s()})}},cancel(){n.releaseLock()}})}static fromAsyncGenerator(e){return new _n({async pull(n){const{value:r,done:s}=await e.next();s&&n.close(),n.enqueue(r)},async cancel(n){await e.return(n)}})}}function dy(t,e=2){const n=Array.from({length:e},()=>[]);return n.map(async function*(s){for(;;)if(s.length===0){const a=await t.next();for(const i of n)i.push(a)}else{if(s[0].done)return;yield s.shift().value}})}function $n(t,e){if(Array.isArray(t)&&Array.isArray(e))return t.concat(e);if(typeof t=="string"&&typeof e=="string")return t+e;if(typeof t=="number"&&typeof e=="number")return t+e;if("concat"in t&&typeof t.concat=="function")return t.concat(e);if(typeof t=="object"&&typeof e=="object"){const n={...t};for(const[r,s]of Object.entries(e))r in n&&!Array.isArray(n[r])?n[r]=$n(n[r],s):n[r]=s;return n}else throw new Error(`Cannot concat ${typeof t} and ${typeof e}`)}class Sa{constructor(e){var n;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((n=this.config)==null?void 0:n.signal),this.setup=new Promise((r,s)=>{Yr.runWithConfig(da(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(r,s):this.firstResult.then(a=>r(void 0),s)},!0)})}async next(...e){var n;return(n=this.signal)==null||n.throwIfAborted(),this.firstResultUsed?Yr.runWithConfig(da(this.config),this.signal?async()=>Zr(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function LN(t,e,n,r,...s){const a=new Sa({generator:e,startSetup:n,signal:r}),i=await a.setup;return{output:t(a,i,...s),setup:i}}class Ur{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const n=this.ops.concat(e.ops),r=zu({},n);return new ji({ops:n,state:r[r.length-1].newDocument})}}class ji extends Ur{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const n=this.ops.concat(e.ops),r=zu(this.state,e.ops);return new ji({ops:n,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const n=zu({},e.ops);return new ji({ops:e.ops,state:n[n.length-1].newDocument})}}const DN=t=>t.name==="log_stream_tracer";async function tg(t,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:n}=t;if(["retriever","llm","prompt"].includes(t.run_type))return n;if(!(Object.keys(n).length===1&&(n==null?void 0:n.input)===""))return n.input}async function ng(t,e){const{outputs:n}=t;return e==="original"||["retriever","llm","prompt"].includes(t.run_type)?n:n!==void 0&&Object.keys(n).length===1&&(n==null?void 0:n.output)!==void 0?n.output:n}function MN(t){return t!==void 0&&t.message!==void 0}class rg extends oo{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=_n.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const n=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||n.find(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&n.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),r}async*tapOutputIterable(e,n){for await(const r of n){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new Ur({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Ur({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const n=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=n===1?e.name:`${e.name}:${n}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await tg(e,this._schemaFormat)),await this.writer.write(new Ur({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const n=this.keyMapByRunId[e.id];if(n===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${n}/inputs`,value:await tg(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${n}/final_output`,value:await ng(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${n}/end_time`,value:new Date(e.end_time).toISOString()});const s=new Ur({ops:r});await this.writer.write(s)}finally{if(e.id===this.rootId){const n=new Ur({ops:[{op:"replace",path:"/final_output",value:await ng(e,this._schemaFormat)}]});await this.writer.write(n),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,n,r){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const a=e.inputs.messages!==void 0;let i;a?MN(r==null?void 0:r.chunk)?i=r==null?void 0:r.chunk:i=new Xt({id:`run-${e.id}`,content:n}):i=n;const o=new Ur({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:n},{op:"add",path:`/logs/${s}/streamed_output/-`,value:i}]});await this.writer.write(o)}}const sg="__run";class ha{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new ha({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class Ts extends ha{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new Ts({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function jo({name:t,serialized:e}){return t!==void 0?t:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const BN=t=>t.name==="event_stream_tracer";class FN extends oo{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=_n.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const n=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||n.find(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&n.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),r}async*tapOutputIterable(e,n){const r=await n.next();if(r.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield r.value;return}function a(o,u){return o==="llm"&&typeof u=="string"?new ha({text:u}):u}let i=this.tappedPromises.get(e);if(i===void 0){let o;i=new Promise(u=>{o=u}),this.tappedPromises.set(e,i);try{const u={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...u,data:{chunk:a(s.runType,r.value)}},s),yield r.value;for await(const c of n)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...u,data:{chunk:a(s.runType,c)}},s),yield c}finally{o()}}else{yield r.value;for await(const o of n)yield o}}async send(e,n){this._includeRun(n)&&await this.writer.write(e)}async sendEndEvent(e,n){const r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,n)}):await this.send(e,n)}async onLLMStart(e){var i,o;const n=jo(e),r=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:n,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,s);const a=`on_${r}_start`;await this.send({event:a,data:{input:e.inputs},name:n,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,n,r){const s=this.runInfoMap.get(e.id);let a,i;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")i="on_chat_model_stream",(r==null?void 0:r.chunk)===void 0?a=new Xt({content:n,id:`run-${e.id}`}):a=r.chunk.message;else if(s.runType==="llm")i="on_llm_stream",(r==null?void 0:r.chunk)===void 0?a=new ha({text:n}):a=r.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:i,data:{chunk:a},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){var i,o,u;const n=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(n===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(i=e.outputs)==null?void 0:i.generations;let a;if(n.runType==="chat_model"){for(const c of s??[]){if(a!==void 0)break;a=(o=c[0])==null?void 0:o.message}r="on_chat_model_end"}else if(n.runType==="llm")a={generations:s==null?void 0:s.map(c=>c.map(l=>({text:l.text,generationInfo:l.generationInfo}))),llmOutput:((u=e.outputs)==null?void 0:u.llmOutput)??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${n.runType}`);await this.sendEndEvent({event:r,data:{output:a,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async onChainStart(e){var i,o;const n=jo(e),r=e.run_type??"chain",s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:n,runType:e.run_type};let a={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(a={},s.inputs={}):e.inputs.input!==void 0?(a.input=e.inputs.input,s.inputs=e.inputs.input):(a.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${r}_start`,data:a,name:n,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),n===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,s=e.inputs??n.inputs??{},i={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(i.input=s.input,n.inputs=s.input),await this.sendEndEvent({event:r,data:i,run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata??{}},n)}async onToolStart(e){var s,a;const n=jo(e),r={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:n,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:n,run_id:e.id,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{}},r)}async onToolEnd(e){var s;const n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),n===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(n.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async onRetrieverStart(e){var a,i;const n=jo(e),s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:n,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:n,tags:e.tags??[],run_id:e.id,metadata:((i=e.extra)==null?void 0:i.metadata)??{}},s)}async onRetrieverEnd(e){var r;const n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),n===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((r=e.outputs)==null?void 0:r.documents)??e.outputs,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async handleCustomEvent(e,n,r){const s=this.runInfoMap.get(r);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:s.tags,metadata:s.metadata,data:n},s)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const UN=[400,401,402,403,404,405,406,407,409],jN=t=>{var n,r;if(t.message.startsWith("Cancel")||t.message.startsWith("AbortError")||t.name==="AbortError"||(t==null?void 0:t.code)==="ECONNABORTED")throw t;const e=((n=t==null?void 0:t.response)==null?void 0:n.status)??(t==null?void 0:t.status);if(e&&UN.includes(+e))throw t;if(((r=t==null?void 0:t.error)==null?void 0:r.code)==="insufficient_quota"){const s=new Error(t==null?void 0:t.message);throw s.name="InsufficientQuotaError",s}};class vf{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??jN;const n="default"in Ir?Ir.default:Ir;this.queue=new n({concurrency:this.maxConcurrency})}call(e,...n){return this.queue.add(()=>$u(()=>e(...n).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,n,...r){return e.signal?Promise.race([this.call(n,...r),new Promise((s,a)=>{var i;(i=e.signal)==null||i.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(n,...r)}fetch(...e){return this.call(()=>fetch(...e).then(n=>n.ok?n:Promise.reject(n)))}}class hy extends oo{constructor({config:e,onStart:n,onEnd:r,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=n,this.argOnEnd=r,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function Of(t){return t?t.lc_runnable:!1}class HN{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,n){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const s=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(n)),this.includeTags!==void 0&&(r=r||s.some(a=>{var i;return(i=this.includeTags)==null?void 0:i.includes(a)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(n)),this.excludeTags!==void 0&&(r=r&&s.every(a=>{var i;return!((i=this.excludeTags)!=null&&i.includes(a))})),r}}const $N=Symbol("Let zodToJsonSchema decide on which parser to use"),qN={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},VN=t=>({...qN,...t}),zN=t=>{const e=VN(t),n=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function fy(t,e,n,r){r!=null&&r.errorMessages&&n&&(t.errorMessage={...t.errorMessage,[e]:n})}function Ze(t,e,n,r,s){t[e]=n,fy(t,e,r,s)}function WN(){return{}}function GN(t,e){var r,s,a;const n={type:"array"};return(r=t.type)!=null&&r._def&&((a=(s=t.type)==null?void 0:s._def)==null?void 0:a.typeName)!==q.ZodAny&&(n.items=We(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&Ze(n,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&Ze(n,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(Ze(n,"minItems",t.exactLength.value,t.exactLength.message,e),Ze(n,"maxItems",t.exactLength.value,t.exactLength.message,e)),n}function KN(t,e){const n={type:"integer",format:"int64"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Ze(n,"minimum",r.value,r.message,e):Ze(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),Ze(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ze(n,"maximum",r.value,r.message,e):Ze(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),Ze(n,"maximum",r.value,r.message,e));break;case"multipleOf":Ze(n,"multipleOf",r.value,r.message,e);break}return n}function YN(){return{type:"boolean"}}function my(t,e){return We(t.type._def,e)}const ZN=(t,e)=>We(t.innerType._def,e);function py(t,e,n){const r=n??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,a)=>py(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return JN(t,e)}}const JN=(t,e)=>{const n={type:"integer",format:"unix-time"};if(e.target==="openApi3")return n;for(const r of t.checks)switch(r.kind){case"min":Ze(n,"minimum",r.value,r.message,e);break;case"max":Ze(n,"maximum",r.value,r.message,e);break}return n};function XN(t,e){return{...We(t.innerType._def,e),default:t.defaultValue()}}function QN(t,e){return e.effectStrategy==="input"?We(t.schema._def,e):{}}function eR(t){return{type:"string",enum:Array.from(t.values)}}const tR=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function nR(t,e){const n=[We(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),We(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return n.forEach(a=>{if(tR(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...u}=a;i=u}else r=void 0;s.push(i)}}),s.length?{allOf:s,...r}:void 0}function rR(t,e){const n=typeof t.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[t.value]}:{type:n==="bigint"?"integer":n,const:t.value}}let $l;const kn={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>($l===void 0&&($l=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),$l),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function gy(t,e){const n={type:"string"};if(t.checks)for(const r of t.checks)switch(r.kind){case"min":Ze(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,e);break;case"max":Ze(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Nn(n,"email",r.message,e);break;case"format:idn-email":Nn(n,"idn-email",r.message,e);break;case"pattern:zod":jt(n,kn.email,r.message,e);break}break;case"url":Nn(n,"uri",r.message,e);break;case"uuid":Nn(n,"uuid",r.message,e);break;case"regex":jt(n,r.regex,r.message,e);break;case"cuid":jt(n,kn.cuid,r.message,e);break;case"cuid2":jt(n,kn.cuid2,r.message,e);break;case"startsWith":jt(n,RegExp(`^${ql(r.value,e)}`),r.message,e);break;case"endsWith":jt(n,RegExp(`${ql(r.value,e)}$`),r.message,e);break;case"datetime":Nn(n,"date-time",r.message,e);break;case"date":Nn(n,"date",r.message,e);break;case"time":Nn(n,"time",r.message,e);break;case"duration":Nn(n,"duration",r.message,e);break;case"length":Ze(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,e),Ze(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,e);break;case"includes":{jt(n,RegExp(ql(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&Nn(n,"ipv4",r.message,e),r.version!=="v4"&&Nn(n,"ipv6",r.message,e);break}case"base64url":jt(n,kn.base64url,r.message,e);break;case"jwt":jt(n,kn.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&jt(n,kn.ipv4Cidr,r.message,e),r.version!=="v4"&&jt(n,kn.ipv6Cidr,r.message,e);break}case"emoji":jt(n,kn.emoji(),r.message,e);break;case"ulid":{jt(n,kn.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Nn(n,"binary",r.message,e);break}case"contentEncoding:base64":{Ze(n,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{jt(n,kn.base64,r.message,e);break}}break}case"nanoid":jt(n,kn.nanoid,r.message,e)}return n}function ql(t,e){return e.patternStrategy==="escape"?aR(t):t}const sR=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function aR(t){let e="";for(let n=0;n<t.length;n++)sR.has(t[n])||(e+="\\"),e+=t[n];return e}function Nn(t,e,n,r){var s;t.format||(s=t.anyOf)!=null&&s.some(a=>a.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&r.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Ze(t,"format",e,n,r)}function jt(t,e,n,r){var s;t.pattern||(s=t.allOf)!=null&&s.some(a=>a.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&r.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:ag(e,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Ze(t,"pattern",ag(e,r),n,r)}function ag(t,e){var u;if(!e.applyRegexFlags||!t.flags)return t.source;const n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=n.i?t.source.toLowerCase():t.source;let s="",a=!1,i=!1,o=!1;for(let c=0;c<r.length;c++){if(a){s+=r[c],a=!1;continue}if(n.i){if(i){if(r[c].match(/[a-z]/)){o?(s+=r[c],s+=`${r[c-2]}-${r[c]}`.toUpperCase(),o=!1):r[c+1]==="-"&&((u=r[c+2])!=null&&u.match(/[a-z]/))?(s+=r[c],o=!0):s+=`${r[c]}${r[c].toUpperCase()}`;continue}}else if(r[c].match(/[a-z]/)){s+=`[${r[c]}${r[c].toUpperCase()}]`;continue}}if(n.m){if(r[c]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[c]==="$"){s+=`($|(?=[\r
]))`;continue}}if(n.s&&r[c]==="."){s+=i?`${r[c]}\r
`:`[${r[c]}\r
]`;continue}s+=r[c],r[c]==="\\"?a=!0:i&&r[c]==="]"?i=!1:!i&&r[c]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s}function by(t,e){var r,s,a,i,o,u;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=t.keyType)==null?void 0:r._def.typeName)===q.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((c,l)=>({...c,[l]:We(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const n={type:"object",additionalProperties:We(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return n;if(((s=t.keyType)==null?void 0:s._def.typeName)===q.ZodString&&((a=t.keyType._def.checks)!=null&&a.length)){const{type:c,...l}=gy(t.keyType._def,e);return{...n,propertyNames:l}}else{if(((i=t.keyType)==null?void 0:i._def.typeName)===q.ZodEnum)return{...n,propertyNames:{enum:t.keyType._def.values}};if(((o=t.keyType)==null?void 0:o._def.typeName)===q.ZodBranded&&t.keyType._def.type._def.typeName===q.ZodString&&((u=t.keyType._def.type._def.checks)!=null&&u.length)){const{type:c,...l}=my(t.keyType._def,e);return{...n,propertyNames:l}}}return n}function iR(t,e){if(e.mapStrategy==="record")return by(t,e);const n=We(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=We(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function oR(t){const e=t.values,r=Object.keys(t.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(r.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function uR(){return{not:{}}}function cR(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Ku={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function lR(t,e){if(e.target==="openApi3")return ig(t,e);const n=t.options instanceof Map?Array.from(t.options.values()):t.options;if(n.every(r=>r._def.typeName in Ku&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((s,a)=>{const i=Ku[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===n.length){const s=r.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:n.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,s)=>[...r,...s._def.values.filter(a=>!r.includes(a))],[])};return ig(t,e)}const ig=(t,e)=>{const n=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>We(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function dR(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:Ku[t.innerType._def.typeName],nullable:!0}:{type:[Ku[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=We(t.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=We(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function hR(t,e){const n={type:"number"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"int":n.type="integer",fy(n,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Ze(n,"minimum",r.value,r.message,e):Ze(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),Ze(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ze(n,"maximum",r.value,r.message,e):Ze(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),Ze(n,"maximum",r.value,r.message,e));break;case"multipleOf":Ze(n,"multipleOf",r.value,r.message,e);break}return n}function fR(t,e){return e.removeAdditionalStrategy==="strict"?t.catchall._def.typeName==="ZodNever"?t.unknownKeys!=="strict":We(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:t.catchall._def.typeName==="ZodNever"?t.unknownKeys==="passthrough":We(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function mR(t,e){const n=e.target==="openAi",r={type:"object",...Object.entries(t.shape()).reduce((s,[a,i])=>{if(i===void 0||i._def===void 0)return s;let o=i.isOptional();o&&n&&(i instanceof jn&&(i=i._def.innerType),i.isNullable()||(i=i.nullable()),o=!1);const u=We(i._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});return u===void 0?s:{properties:{...s.properties,[a]:u},required:o?s.required:[...s.required,a]}},{properties:{},required:[]}),additionalProperties:fR(t,e)};return r.required.length||delete r.required,r}const pR=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return We(t.innerType._def,e);const n=We(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}},gR=(t,e)=>{if(e.pipeStrategy==="input")return We(t.in._def,e);if(e.pipeStrategy==="output")return We(t.out._def,e);const n=We(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=We(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(s=>s!==void 0)}};function bR(t,e){return We(t.type._def,e)}function _R(t,e){const r={type:"array",uniqueItems:!0,items:We(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&Ze(r,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&Ze(r,"maxItems",t.maxSize.value,t.maxSize.message,e),r}function yR(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((n,r)=>We(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:We(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((n,r)=>We(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function ER(){return{not:{}}}function wR(){return{}}const TR=(t,e)=>We(t.innerType._def,e);function We(t,e,n=!1){var i;const r=e.seen.get(t);if(e.override){const o=(i=e.override)==null?void 0:i.call(e,t,e,r,n);if(o!==$N)return o}if(r&&!n){const o=SR(r,e);if(o!==void 0)return o}const s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);const a=CR(t,t.typeName,e);return a&&vR(t,e,a),s.jsonSchema=a,a}const SR=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:AR(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((n,r)=>e.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},AR=(t,e)=>{let n=0;for(;n<t.length&&n<e.length&&t[n]===e[n];n++);return[(t.length-n).toString(),...e.slice(n)].join("/")},CR=(t,e,n)=>{switch(e){case q.ZodString:return gy(t,n);case q.ZodNumber:return hR(t,n);case q.ZodObject:return mR(t,n);case q.ZodBigInt:return KN(t,n);case q.ZodBoolean:return YN();case q.ZodDate:return py(t,n);case q.ZodUndefined:return ER();case q.ZodNull:return cR(n);case q.ZodArray:return GN(t,n);case q.ZodUnion:case q.ZodDiscriminatedUnion:return lR(t,n);case q.ZodIntersection:return nR(t,n);case q.ZodTuple:return yR(t,n);case q.ZodRecord:return by(t,n);case q.ZodLiteral:return rR(t,n);case q.ZodEnum:return eR(t);case q.ZodNativeEnum:return oR(t);case q.ZodNullable:return dR(t,n);case q.ZodOptional:return pR(t,n);case q.ZodMap:return iR(t,n);case q.ZodSet:return _R(t,n);case q.ZodLazy:return We(t.getter()._def,n);case q.ZodPromise:return bR(t,n);case q.ZodNaN:case q.ZodNever:return uR();case q.ZodEffects:return QN(t,n);case q.ZodAny:return WN();case q.ZodUnknown:return wR();case q.ZodDefault:return XN(t,n);case q.ZodBranded:return my(t,n);case q.ZodReadonly:return TR(t,n);case q.ZodCatch:return ZN(t,n);case q.ZodPipeline:return gR(t,n);case q.ZodFunction:case q.ZodVoid:case q.ZodSymbol:return;default:return(r=>{})()}},vR=(t,e,n)=>(t.description&&(n.description=t.description,e.markdownDescription&&(n.markdownDescription=t.description)),n),Ss=(t,e)=>{const n=zN(e),r=void 0,s=e==null?void 0:e.name,a=We(t._def,n,!1)??{},i=s===void 0?r?{...a,[n.definitionPath]:r}:a:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,s].join("/"),[n.definitionPath]:{...r,[s]:a}};return n.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(n.target==="jsonSchema2019-09"||n.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),n.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};function Vl(t){return t.replace(/[^a-zA-Z-_0-9]/g,"_")}const OR=["*","_","`"];function IR(t){let e="";for(const[n,r]of Object.entries(t))e+=`	classDef ${n} ${r};
`;return e}function kR(t,e,n){const{firstNode:r,lastNode:s,nodeColors:a,withStyles:i=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=n;let c=i?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(i){const p="default",f={[p]:"{0}({1})"};r!==void 0&&(f[r]="{0}([{1}]):::first"),s!==void 0&&(f[s]="{0}([{1}]):::last");for(const[g,b]of Object.entries(t)){const _=b.name.split(":").pop()??"";let E=OR.some(w=>_.startsWith(w)&&_.endsWith(w))?`<p>${_}</p>`:_;Object.keys(b.metadata??{}).length&&(E+=`<hr/><small><em>${Object.entries(b.metadata??{}).map(([w,O])=>`${w} = ${O}`).join(`
`)}</em></small>`);const I=(f[g]??f[p]).replace("{0}",Vl(g)).replace("{1}",E);c+=`	${I}
`}}const l={};for(const p of e){const f=p.source.split(":"),g=p.target.split(":"),b=f.filter((_,y)=>_===g[y]).join(":");l[b]||(l[b]=[]),l[b].push(p)}const d=new Set;function m(p,f){const g=p.length===1&&p[0].source===p[0].target;if(f&&!g){const b=f.split(":").pop();if(d.has(b))throw new Error(`Found duplicate subgraph '${b}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(b),c+=`	subgraph ${b}
`}for(const b of p){const{source:_,target:y,data:E,conditional:I}=b;let w="";if(E!==void 0){let O=E;const S=O.split(" ");S.length>u&&(O=Array.from({length:Math.ceil(S.length/u)},(x,D)=>S.slice(D*u,(D+1)*u).join(" ")).join("&nbsp;<br>&nbsp;")),w=I?` -. &nbsp;${O}&nbsp; .-> `:` -- &nbsp;${O}&nbsp; --> `}else w=I?" -.-> ":" --> ";c+=`	${Vl(_)}${w}${Vl(y)};
`}for(const b in l)b.startsWith(`${f}:`)&&b!==f&&m(l[b],b);f&&!g&&(c+=`	end
`)}m(l[""]??[],"");for(const p in l)!p.includes(":")&&p!==""&&m(l[p],p);return i&&(c+=IR(a??{})),c}async function NR(t,e){let{backgroundColor:n="white"}=e;const r=btoa(t);n!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(n)||(n=`!${n}`));const s=`https://mermaid.ink/img/${r}?bgColor=${n}`,a=await fetch(s);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}function RR(t,e){if(t!==void 0&&!ci(t))return t;if(Of(e))try{let n=e.getName();return n=n.startsWith("Runnable")?n.slice(8):n,n}catch{return e.getName()}else return e.name??"UnknownSchema"}function PR(t){return Of(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...Ss(t.data.schema),title:t.data.name}}}class $c{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((n,r)=>{e[n.id]=ci(n.id)?r:n.id}),{nodes:Object.values(this.nodes).map(n=>({id:e[n.id],...PR(n)})),edges:this.edges.map(n=>{const r={source:e[n.source],target:e[n.target]};return typeof n.data<"u"&&(r.data=n.data),typeof n.conditional<"u"&&(r.conditional=n.conditional),r})}}addNode(e,n,r){if(n!==void 0&&this.nodes[n]!==void 0)throw new Error(`Node with id ${n} already exists`);const s=n??Jt(),a={id:s,data:e,name:RR(n,e),metadata:r};return this.nodes[s]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(n=>n.source!==e.id&&n.target!==e.id)}addEdge(e,n,r,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[n.id]===void 0)throw new Error(`Target node ${n.id} not in graph`);const a={source:e.id,target:n.id,data:r,conditional:s};return this.edges.push(a),a}firstNode(){return og(this)}lastNode(){return ug(this)}extend(e,n=""){let r=n;Object.values(e.nodes).map(c=>c.id).every(ci)&&(r="");const a=c=>r?`${r}:${c}`:c;Object.entries(e.nodes).forEach(([c,l])=>{this.nodes[a(c)]={...l,id:a(c)}});const i=e.edges.map(c=>({...c,source:a(c.source),target:a(c.target)}));this.edges=[...this.edges,...i];const o=e.firstNode(),u=e.lastNode();return[o?{id:a(o.id),data:o.data}:void 0,u?{id:a(u.id),data:u.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&og(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&ug(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),n=new Map;Object.values(e).forEach(s=>{n.set(s,(n.get(s)||0)+1)});const r=s=>{const a=e[s];return ci(s)&&n.get(a)===1?a:s};return new $c({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,a])=>[r(s),{...a,id:r(s)}])),edges:this.edges.map(s=>({...s,source:r(s.source),target:r(s.target)}))})}drawMermaid(e){const{withStyles:n,curveStyle:r,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:a}=e??{},i=this.reid(),o=i.firstNode(),u=i.lastNode();return kR(i.nodes,i.edges,{firstNode:o==null?void 0:o.id,lastNode:u==null?void 0:u.id,withStyles:n,curveStyle:r,nodeColors:s,wrapLabelNWords:a})}async drawMermaidPng(e){const n=this.drawMermaid(e);return NR(n,{backgroundColor:e==null?void 0:e.backgroundColor})}}function og(t,e=[]){const n=new Set(t.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),r=[];for(const s of Object.values(t.nodes))!e.includes(s.id)&&!n.has(s.id)&&r.push(s);return r.length===1?r[0]:void 0}function ug(t,e=[]){const n=new Set(t.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),r=[];for(const s of Object.values(t.nodes))!e.includes(s.id)&&!n.has(s.id)&&r.push(s);return r.length===1?r[0]:void 0}function xR(t){const e=new TextEncoder,n=new ReadableStream({async start(r){for await(const s of t)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return _n.fromReadableStream(n)}function cg(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.iterator]=="function"&&typeof t.next=="function"}const LR=t=>t!=null&&typeof t=="object"&&"next"in t&&typeof t.next=="function";function oh(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.asyncIterator]=="function"}function*lg(t,e){for(;;){const{value:n,done:r}=Yr.runWithConfig(da(t),e.next.bind(e),!0);if(r)break;yield n}}async function*uh(t,e){const n=e[Symbol.asyncIterator]();for(;;){const{value:r,done:s}=await Yr.runWithConfig(da(t),n.next.bind(e),!0);if(s)break;yield r}}function At(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}class mt extends Kr{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const n=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${n}${e}`:n}bind(e){return new ms({bound:this,kwargs:e,config:{}})}map(){return new Yu({bound:this})}withRetry(e){return new DR({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new ms({bound:this,config:e,kwargs:{}})}withFallbacks(e){const n=Array.isArray(e)?e:e.fallbacks;return new BR({runnable:this,fallbacks:n})}_getOptionsList(e,n=0){if(Array.isArray(e)&&e.length!==n)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${n} inputs`);if(Array.isArray(e))return e.map(He);if(n>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:n},(s,a)=>He(a===0?e:r))}return Array.from({length:n},()=>He(e))}async batch(e,n,r){var u;const s=this._getOptionsList(n??{},e.length),a=((u=s[0])==null?void 0:u.maxConcurrency)??(r==null?void 0:r.maxConcurrency),i=new vf({maxConcurrency:a,onFailedAttempt:c=>{throw c}}),o=e.map((c,l)=>i.call(async()=>{try{return await this.invoke(c,s[l])}catch(d){if(r!=null&&r.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,n){yield this.invoke(e,n)}async stream(e,n){const r=He(n),s=new Sa({generator:this._streamIterator(e,r),config:r});return await s.setup,_n.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let n;e===void 0?n=He(e):n=He({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[n,r]}async _callWithConfig(e,n,r){const s=He(r),a=await Hn(s),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),At(n,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{const u=e.call(this,n,s,i);o=await Zr(u,r==null?void 0:r.signal)}catch(u){throw await(i==null?void 0:i.handleChainError(u)),u}return await(i==null?void 0:i.handleChainEnd(At(o,"output"))),o}async _batchWithConfig(e,n,r,s){var c;const a=this._getOptionsList(r??{},n.length),i=await Promise.all(a.map(Hn)),o=await Promise.all(i.map(async(l,d)=>{const m=await(l==null?void 0:l.handleChainStart(this.toJSON(),At(n[d],"input"),a[d].runId,a[d].runType,void 0,void 0,a[d].runName??this.getName()));return delete a[d].runId,m}));let u;try{const l=e.call(this,n,a,o,s);u=await Zr(l,(c=a==null?void 0:a[0])==null?void 0:c.signal)}catch(l){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(l))),l}return await Promise.all(o.map(l=>l==null?void 0:l.handleChainEnd(At(u,"output")))),u}async*_transformStreamWithConfig(e,n,r){let s,a=!0,i,o=!0;const u=He(r),c=await Hn(u);async function*l(){for await(const m of e){if(a)if(s===void 0)s=m;else try{s=$n(s,m)}catch{s=void 0,a=!1}yield m}}let d;try{const m=await LN(n.bind(this),l(),async()=>c==null?void 0:c.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName()),r==null?void 0:r.signal,u);delete u.runId,d=m.setup;const p=d==null?void 0:d.handlers.find(BN);let f=m.output;p!==void 0&&d!==void 0&&(f=p.tapOutputIterable(d.runId,f));const g=d==null?void 0:d.handlers.find(DN);g!==void 0&&d!==void 0&&(f=g.tapOutputIterable(d.runId,f));for await(const b of f)if(yield b,o)if(i===void 0)i=b;else try{i=$n(i,b)}catch{i=void 0,o=!1}}catch(m){throw await(d==null?void 0:d.handleChainError(m,void 0,void 0,void 0,{inputs:At(s,"input")})),m}await(d==null?void 0:d.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:At(s,"input")}))}getGraph(e){const n=new $c,r=n.addNode({name:`${this.getName()}Input`,schema:Or.any()}),s=n.addNode(this),a=n.addNode({name:`${this.getName()}Output`,schema:Or.any()});return n.addEdge(r,s),n.addEdge(s,a),n}pipe(e){return new lr({first:this,last:us(e)})}pick(e){return this.pipe(new FR(e))}assign(e){return this.pipe(new _y(new Aa({steps:e})))}async*transform(e,n){let r;for await(const s of e)r===void 0?r=s:r=$n(r,s);yield*this._streamIterator(r,He(n))}async*streamLog(e,n,r){const s=new rg({...r,autoClose:!1,_schemaFormat:"original"}),a=He(n);yield*this._streamLog(e,s,a)}async*_streamLog(e,n,r){const{callbacks:s}=r;if(s===void 0)r.callbacks=[n];else if(Array.isArray(s))r.callbacks=s.concat([n]);else{const u=s.copy();u.addHandler(n,!0),r.callbacks=u}const a=this.stream(e,r);async function i(){try{const u=await a;for await(const c of u){const l=new Ur({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await n.writer.write(l)}}finally{await n.writer.close()}}const o=i();try{for await(const u of n)yield u}finally{await o}}streamEvents(e,n,r){let s;if(n.version==="v1")s=this._streamEventsV1(e,n,r);else if(n.version==="v2")s=this._streamEventsV2(e,n,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return n.encoding==="text/event-stream"?xR(s):_n.fromAsyncGenerator(s)}async*_streamEventsV2(e,n,r){var p;const s=new FN({...r,autoClose:!1}),a=He(n),i=a.runId??Jt();a.runId=i;const o=a.callbacks;if(o===void 0)a.callbacks=[s];else if(Array.isArray(o))a.callbacks=o.concat(s);else{const f=o.copy();f.addHandler(s,!0),a.callbacks=f}const u=this;async function c(){try{const f=await u.stream(e,a),g=s.tapOutputIterable(i,f);for await(const b of g);}finally{await s.finish()}}const l=c();let d=!1,m;try{for await(const f of s){if(!d){f.data.input=e,d=!0,m=f.run_id,yield f;continue}f.run_id===m&&f.event.endsWith("_end")&&(p=f.data)!=null&&p.input&&delete f.data.input,yield f}}finally{await l}}async*_streamEventsV1(e,n,r){let s,a=!1;const i=He(n),o=i.tags??[],u=i.metadata??{},c=i.runName??this.getName(),l=new rg({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new HN({...r}),m=this._streamLog(e,l,i);for await(const f of m){if(s?s=s.concat(f):s=ji.fromRunLogPatch(f),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const y={...s.state},E={run_id:y.id,event:`on_${y.type}_start`,name:c,tags:o,metadata:u,data:{input:e}};d.includeEvent(E,y.type)&&(yield E)}const g=f.ops.filter(y=>y.path.startsWith("/logs/")).map(y=>y.path.split("/")[2]),b=[...new Set(g)];for(const y of b){let E,I={};const w=s.state.logs[y];if(w.end_time===void 0?w.streamed_output.length>0?E="stream":E="start":E="end",E==="start")w.inputs!==void 0&&(I.input=w.inputs);else if(E==="end")w.inputs!==void 0&&(I.input=w.inputs),I.output=w.final_output;else if(E==="stream"){const O=w.streamed_output.length;if(O!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${O} instead. Encountered in: "${w.name}"`);I={chunk:w.streamed_output[0]},w.streamed_output=[]}yield{event:`on_${w.type}_${E}`,name:w.name,run_id:w.id,tags:w.tags,metadata:w.metadata,data:I}}const{state:_}=s;if(_.streamed_output.length>0){const y=_.streamed_output.length;if(y!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${y} instead. Encountered in: "${_.name}"`);const E={chunk:_.streamed_output[0]};_.streamed_output=[];const I={event:`on_${_.type}_stream`,run_id:_.id,tags:o,metadata:u,name:c,data:E};d.includeEvent(I,_.type)&&(yield I)}}const p=s==null?void 0:s.state;if(p!==void 0){const f={event:`on_${p.type}_end`,name:c,run_id:p.id,tags:o,metadata:u,data:{output:p.final_output}};d.includeEvent(f,p.type)&&(yield f)}}static isRunnable(e){return Of(e)}withListeners({onStart:e,onEnd:n,onError:r}){return new ms({bound:this,config:{},configFactories:[s=>({callbacks:[new hy({config:s,onStart:e,onEnd:n,onError:r})]})]})}asTool(e){return UR(this,e)}}class ms extends mt{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const n=eg(this.config,...e);return eg(n,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(n))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,n){return this.bound.invoke(e,await this._mergeConfig(He(n),this.kwargs))}async batch(e,n,r){const s=Array.isArray(n)?await Promise.all(n.map(async a=>this._mergeConfig(He(a),this.kwargs))):await this._mergeConfig(He(n),this.kwargs);return this.bound.batch(e,s,r)}async*_streamIterator(e,n){yield*this.bound._streamIterator(e,await this._mergeConfig(He(n),this.kwargs))}async stream(e,n){return this.bound.stream(e,await this._mergeConfig(He(n),this.kwargs))}async*transform(e,n){yield*this.bound.transform(e,await this._mergeConfig(He(n),this.kwargs))}streamEvents(e,n,r){const s=this,a=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(He(n),s.kwargs),version:n.version},r)};return _n.fromAsyncGenerator(a())}static isRunnableBinding(e){return e.bound&&mt.isRunnable(e.bound)}withListeners({onStart:e,onEnd:n,onError:r}){return new ms({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new hy({config:s,onStart:e,onEnd:n,onError:r})]})]})}}class Yu extends mt{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new Yu({bound:this.bound.bind(e)})}async invoke(e,n){return this._callWithConfig(this._invoke.bind(this),e,n)}async _invoke(e,n,r){return this.bound.batch(e,Lt(n,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:n,onError:r}){return new Yu({bound:this.bound.withListeners({onStart:e,onEnd:n,onError:r})})}}class DR extends ms{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,n,r){const s=e>1?`retry:attempt:${e}`:void 0;return Lt(n,{callbacks:r==null?void 0:r.getChild(s)})}async _invoke(e,n,r){return $u(s=>super.invoke(e,this._patchConfigForRetry(s,n,r)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,n){return this._callWithConfig(this._invoke.bind(this),e,n)}async _batch(e,n,r,s){const a={};try{await $u(async i=>{const o=e.map((m,p)=>p).filter(m=>a[m.toString()]===void 0||a[m.toString()]instanceof Error),u=o.map(m=>e[m]),c=o.map(m=>this._patchConfigForRetry(i,n==null?void 0:n[m],r==null?void 0:r[m])),l=await super.batch(u,c,{...s,returnExceptions:!0});let d;for(let m=0;m<l.length;m+=1){const p=l[m],f=o[m];p instanceof Error&&d===void 0&&(d=p,d.input=u[m]),a[f.toString()]=p}if(d)throw d;return l},{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if((s==null?void 0:s.returnExceptions)!==!0)throw i}return Object.keys(a).sort((i,o)=>parseInt(i,10)-parseInt(o,10)).map(i=>a[parseInt(i,10)])}async batch(e,n,r){return this._batchWithConfig(this._batch.bind(this),e,n,r)}}class lr extends mt{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,n){var u;const r=He(n),s=await Hn(r),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),At(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let i=e,o;try{const c=[this.first,...this.middle];for(let l=0;l<c.length;l+=1){const m=c[l].invoke(i,Lt(r,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${l+1}`)}));i=await Zr(m,n==null?void 0:n.signal)}if((u=n==null?void 0:n.signal)!=null&&u.aborted)throw new Error("Aborted");o=await this.last.invoke(i,Lt(r,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(c){throw await(a==null?void 0:a.handleChainError(c)),c}return await(a==null?void 0:a.handleChainEnd(At(o,"output"))),o}async batch(e,n,r){var u;const s=this._getOptionsList(n??{},e.length),a=await Promise.all(s.map(Hn)),i=await Promise.all(a.map(async(c,l)=>{const d=await(c==null?void 0:c.handleChainStart(this.toJSON(),At(e[l],"input"),s[l].runId,void 0,void 0,void 0,s[l].runName));return delete s[l].runId,d}));let o=e;try{for(let c=0;c<this.steps.length;c+=1){const d=this.steps[c].batch(o,i.map((m,p)=>{const f=m==null?void 0:m.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`);return Lt(s[p],{callbacks:f})}),r);o=await Zr(d,(u=s[0])==null?void 0:u.signal)}}catch(c){throw await Promise.all(i.map(l=>l==null?void 0:l.handleChainError(c))),c}return await Promise.all(i.map(c=>c==null?void 0:c.handleChainEnd(At(o,"output")))),o}async*_streamIterator(e,n){var d;const r=await Hn(n),{runId:s,...a}=n??{},i=await(r==null?void 0:r.handleChainStart(this.toJSON(),At(e,"input"),s,void 0,void 0,void 0,a==null?void 0:a.runName)),o=[this.first,...this.middle,this.last];let u=!0,c;async function*l(){yield e}try{let m=o[0].transform(l(),Lt(a,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let p=1;p<o.length;p+=1)m=await o[p].transform(m,Lt(a,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${p+1}`)}));for await(const p of m)if((d=n==null?void 0:n.signal)==null||d.throwIfAborted(),yield p,u)if(c===void 0)c=p;else try{c=$n(c,p)}catch{c=void 0,u=!1}}catch(m){throw await(i==null?void 0:i.handleChainError(m)),m}await(i==null?void 0:i.handleChainEnd(At(c,"output")))}getGraph(e){const n=new $c;let r=null;return this.steps.forEach((s,a)=>{const i=s.getGraph(e);a!==0&&i.trimFirstNode(),a!==this.steps.length-1&&i.trimLastNode(),n.extend(i);const o=i.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);r&&n.addEdge(r,o),r=i.lastNode()}),n}pipe(e){return lr.isRunnableSequence(e)?new lr({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new lr({first:this.first,middle:[...this.middle,this.last],last:us(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&mt.isRunnable(e)}static from([e,...n],r){let s={};return typeof r=="string"?s.name=r:r!==void 0&&(s=r),new lr({...s,first:us(e),middle:n.slice(0,-1).map(us),last:us(n[n.length-1])})}}class Aa extends mt{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[n,r]of Object.entries(e.steps))this.steps[n]=us(r)}static from(e){return new Aa({steps:e})}async invoke(e,n){const r=He(n),s=await Hn(r),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const i={};try{const o=Object.entries(this.steps).map(async([u,c])=>{i[u]=await c.invoke(e,Lt(r,{callbacks:a==null?void 0:a.getChild(`map:key:${u}`)}))});await Zr(Promise.all(o),n==null?void 0:n.signal)}catch(o){throw await(a==null?void 0:a.handleChainError(o)),o}return await(a==null?void 0:a.handleChainEnd(i)),i}async*_transform(e,n,r){const s={...this.steps},a=dy(e,Object.keys(s).length),i=new Map(Object.entries(s).map(([o,u],c)=>{const l=u.transform(a[c],Lt(r,{callbacks:n==null?void 0:n.getChild(`map:key:${o}`)}));return[o,l.next().then(d=>({key:o,gen:l,result:d}))]}));for(;i.size;){const o=Promise.race(i.values()),{key:u,result:c,gen:l}=await Zr(o,r==null?void 0:r.signal);i.delete(u),c.done||(yield{[u]:c.value},i.set(u,l.next().then(d=>({key:u,gen:l,result:d}))))}}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=He(n),a=new Sa({generator:this.transform(r(),s),config:s});return await a.setup,_n.fromAsyncGenerator(a)}}class If extends mt{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!Ef(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,n){const[r]=this._getOptionsList(n??{},1),s=await Hn(r),a=this.func(Lt(r,{callbacks:s}),e);return Zr(a,r==null?void 0:r.signal)}async*_streamIterator(e,n){var a,i;const[r]=this._getOptionsList(n??{},1),s=await this.invoke(e,n);if(oh(s)){for await(const o of s)(a=r==null?void 0:r.signal)==null||a.throwIfAborted(),yield o;return}if(LR(s)){for(;;){(i=r==null?void 0:r.signal)==null||i.throwIfAborted();const o=s.next();if(o.done)break;yield o.value}return}yield s}static from(e){return new If({func:e})}}function MR(t){if(Ef(t))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class lo extends mt{static lc_name(){return"RunnableLambda"}constructor(e){if(Ef(e.func))return If.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),MR(e.func),this.func=e.func}static from(e){return new lo({func:e})}async _invoke(e,n,r){return new Promise((s,a)=>{const i=Lt(n,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??Hl)-1});Yr.runWithConfig(da(i),async()=>{var o,u;try{let c=await this.func(e,{...i});if(c&&mt.isRunnable(c)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");c=await c.invoke(e,{...i,recursionLimit:(i.recursionLimit??Hl)-1})}else if(oh(c)){let l;for await(const d of uh(i,c))if((o=n==null?void 0:n.signal)==null||o.throwIfAborted(),l===void 0)l=d;else try{l=$n(l,d)}catch{l=d}c=l}else if(cg(c)){let l;for(const d of lg(i,c))if((u=n==null?void 0:n.signal)==null||u.throwIfAborted(),l===void 0)l=d;else try{l=$n(l,d)}catch{l=d}c=l}s(c)}catch(c){a(c)}})})}async invoke(e,n){return this._callWithConfig(this._invoke.bind(this),e,n)}async*_transform(e,n,r){var o,u;let s;for await(const c of e)if(s===void 0)s=c;else try{s=$n(s,c)}catch{s=c}const a=Lt(r,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??Hl)-1}),i=await new Promise((c,l)=>{Yr.runWithConfig(da(a),async()=>{try{const d=await this.func(s,{...a,config:a});c(d)}catch(d){l(d)}})});if(i&&mt.isRunnable(i)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const c=await i.stream(s,a);for await(const l of c)yield l}else if(oh(i))for await(const c of uh(a,i))(o=r==null?void 0:r.signal)==null||o.throwIfAborted(),yield c;else if(cg(i))for(const c of lg(a,i))(u=r==null?void 0:r.signal)==null||u.throwIfAborted(),yield c;else yield i}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=He(n),a=new Sa({generator:this.transform(r(),s),config:s});return await a.setup,_n.fromAsyncGenerator(a)}}class BR extends mt{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,n){const r=He(n),s=await Hn(r),{runId:a,...i}=r,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),At(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName)),u=Lt(i,{callbacks:o==null?void 0:o.getChild()});return await Yr.runWithConfig(u,async()=>{var d;let l;for(const m of this.runnables()){(d=r==null?void 0:r.signal)==null||d.throwIfAborted();try{const p=await m.invoke(e,u);return await(o==null?void 0:o.handleChainEnd(At(p,"output"))),p}catch(p){l===void 0&&(l=p)}}throw l===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(l)),l)})}async*_streamIterator(e,n){var d;const r=He(n),s=await Hn(r),{runId:a,...i}=r,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),At(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName));let u,c;for(const m of this.runnables()){(d=r==null?void 0:r.signal)==null||d.throwIfAborted();const p=Lt(i,{callbacks:o==null?void 0:o.getChild()});try{const f=await m.stream(e,p);c=uh(p,f);break}catch(f){u===void 0&&(u=f)}}if(c===void 0){const m=u??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(m)),m}let l;try{for await(const m of c){yield m;try{l=l===void 0?l:$n(l,m)}catch{l=void 0}}}catch(m){throw await(o==null?void 0:o.handleChainError(m)),m}await(o==null?void 0:o.handleChainEnd(At(l,"output")))}async batch(e,n,r){var u;if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(n??{},e.length),a=await Promise.all(s.map(c=>Hn(c))),i=await Promise.all(a.map(async(c,l)=>{const d=await(c==null?void 0:c.handleChainStart(this.toJSON(),At(e[l],"input"),s[l].runId,void 0,void 0,void 0,s[l].runName));return delete s[l].runId,d}));let o;for(const c of this.runnables()){(u=s[0].signal)==null||u.throwIfAborted();try{const l=await c.batch(e,i.map((d,m)=>Lt(s[m],{callbacks:d==null?void 0:d.getChild()})),r);return await Promise.all(i.map((d,m)=>d==null?void 0:d.handleChainEnd(At(l[m],"output")))),l}catch(l){o===void 0&&(o=l)}}throw o?(await Promise.all(i.map(c=>c==null?void 0:c.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function us(t){if(typeof t=="function")return new lo({func:t});if(mt.isRunnable(t))return t;if(!Array.isArray(t)&&typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))e[n]=us(r);return new Aa({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class _y extends mt{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Aa&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,n){const r=await this.mapper.invoke(e,n);return{...e,...r}}async*_transform(e,n,r){const s=this.mapper.getStepsKeys(),[a,i]=dy(e),o=this.mapper.transform(i,Lt(r,{callbacks:n==null?void 0:n.getChild()})),u=o.next();for await(const c of a){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);const l=Object.fromEntries(Object.entries(c).filter(([d])=>!s.includes(d)));Object.keys(l).length>0&&(yield l)}yield(await u).value;for await(const c of o)yield c}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=He(n),a=new Sa({generator:this.transform(r(),s),config:s});return await a.setup,_n.fromAsyncGenerator(a)}}class FR extends mt{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const n=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return n.length===0?void 0:Object.fromEntries(n)}}async invoke(e,n){return this._callWithConfig(this._pick.bind(this),e,n)}async*_transform(e){for await(const n of e){const r=await this._pick(n);r!==void 0&&(yield r)}}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=He(n),a=new Sa({generator:this.transform(r(),s),config:s});return await a.setup,_n.fromAsyncGenerator(a)}}class dg extends ms{constructor(e){const n=lr.from([lo.from(async r=>{let s;if(Sf(r))try{s=await this.schema.parseAsync(r.args)}catch{throw new iy("Received tool input did not match expected schema",JSON.stringify(r.args))}else s=r;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:n,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function UR(t,e){var s;const n=e.name??t.getName(),r=e.description??((s=e.schema)==null?void 0:s.description);return e.schema.constructor===Or.ZodString?new dg({name:n,description:r,schema:Or.object({input:Or.string()}).transform(a=>a.input),bound:t}):new dg({name:n,description:r,schema:e.schema,bound:t})}class jR extends mt{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","documents","transformers"]})}invoke(e,n){return this.transformDocuments(e)}}var qc={};qc.byteLength=qR;qc.toByteArray=zR;qc.fromByteArray=KR;var ir=[],Sn=[],HR=typeof Uint8Array<"u"?Uint8Array:Array,zl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Bs=0,$R=zl.length;Bs<$R;++Bs)ir[Bs]=zl[Bs],Sn[zl.charCodeAt(Bs)]=Bs;Sn[45]=62;Sn[95]=63;function yy(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function qR(t){var e=yy(t),n=e[0],r=e[1];return(n+r)*3/4-r}function VR(t,e,n){return(e+n)*3/4-n}function zR(t){var e,n=yy(t),r=n[0],s=n[1],a=new HR(VR(t,r,s)),i=0,o=s>0?r-4:r,u;for(u=0;u<o;u+=4)e=Sn[t.charCodeAt(u)]<<18|Sn[t.charCodeAt(u+1)]<<12|Sn[t.charCodeAt(u+2)]<<6|Sn[t.charCodeAt(u+3)],a[i++]=e>>16&255,a[i++]=e>>8&255,a[i++]=e&255;return s===2&&(e=Sn[t.charCodeAt(u)]<<2|Sn[t.charCodeAt(u+1)]>>4,a[i++]=e&255),s===1&&(e=Sn[t.charCodeAt(u)]<<10|Sn[t.charCodeAt(u+1)]<<4|Sn[t.charCodeAt(u+2)]>>2,a[i++]=e>>8&255,a[i++]=e&255),a}function WR(t){return ir[t>>18&63]+ir[t>>12&63]+ir[t>>6&63]+ir[t&63]}function GR(t,e,n){for(var r,s=[],a=e;a<n;a+=3)r=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(t[a+2]&255),s.push(WR(r));return s.join("")}function KR(t){for(var e,n=t.length,r=n%3,s=[],a=16383,i=0,o=n-r;i<o;i+=a)s.push(GR(t,i,i+a>o?o:i+a));return r===1?(e=t[n-1],s.push(ir[e>>2]+ir[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],s.push(ir[e>>10]+ir[e>>4&63]+ir[e<<2&63]+"=")),s.join("")}var YR=Object.defineProperty,ZR=(t,e,n)=>e in t?YR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,JR=(t,e,n)=>(ZR(t,e+"",n),n);function XR(t,e){let n=Array.from({length:t.length},(r,s)=>({start:s,end:s+1}));for(;n.length>1;){let r=null;for(let s=0;s<n.length-1;s++){const a=t.slice(n[s].start,n[s+1].end),i=e.get(a.join(","));i!=null&&(r==null||i<r[0])&&(r=[i,s])}if(r!=null){const s=r[1];n[s]={start:n[s].start,end:n[s+1].end},n.splice(s+1,1)}else break}return n}function QR(t,e){return t.length===1?[e.get(t.join(","))]:XR(t,e).map(n=>e.get(t.slice(n.start,n.end).join(","))).filter(n=>n!=null)}function eP(t){return t.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var ch=class{constructor(t,e){we(this,"specialTokens");we(this,"inverseSpecialTokens");we(this,"patStr");we(this,"textEncoder",new TextEncoder);we(this,"textDecoder",new TextDecoder("utf-8"));we(this,"rankMap",new Map);we(this,"textMap",new Map);this.patStr=t.pat_str;const n=t.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{const[a,i,...o]=s.split(" "),u=Number.parseInt(i,10);return o.forEach((c,l)=>r[c]=u+l),r},{});for(const[r,s]of Object.entries(n)){const a=qc.toByteArray(r);this.rankMap.set(a.join(","),s),this.textMap.set(s,a)}this.specialTokens={...t.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,a])=>(r[a]=this.textEncoder.encode(s),r),{})}encode(t,e=[],n="all"){const r=new RegExp(this.patStr,"ug"),s=ch.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(n==="all"?Object.keys(this.specialTokens).filter(c=>!i.has(c)):n);if(o.size>0){const c=ch.specialTokenRegex([...o]),l=t.match(c);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let u=0;for(;;){let c=null,l=u;for(;s.lastIndex=l,c=s.exec(t),!(c==null||i.has(c[0]));)l=c.index+1;const d=(c==null?void 0:c.index)??t.length;for(const p of t.substring(u,d).matchAll(r)){const f=this.textEncoder.encode(p[0]),g=this.rankMap.get(f.join(","));if(g!=null){a.push(g);continue}a.push(...QR(f,this.rankMap))}if(c==null)break;let m=this.specialTokens[c[0]];a.push(m),u=c.index+c[0].length}return a}decode(t){const e=[];let n=0;for(let a=0;a<t.length;++a){const i=t[a],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),n+=o.length)}const r=new Uint8Array(n);let s=0;for(const a of e)r.set(a,s),s+=a.length;return this.textDecoder.decode(r)}},Ey=ch;JR(Ey,"specialTokenRegex",t=>new RegExp(t.map(e=>eP(e)).join("|"),"g"));function tP(t){switch(t){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1-2024-12-17":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}const Ho={},nP=new vf({});async function rP(t){return t in Ho||(Ho[t]=nP.fetch(`https://tiktoken.pages.dev/js/${t}.json`).then(e=>e.json()).then(e=>new Ey(e)).catch(e=>{throw delete Ho[t],e})),await Ho[t]}async function sP(t){return rP(tP(t))}class aP extends jR{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.lengthFunction=(e==null?void 0:e.lengthFunction)??(n=>n.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,n={}){return this.splitDocuments(e,n)}splitOnSeparator(e,n){let r;if(n)if(this.keepSeparator){const s=n.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");r=e.split(new RegExp(`(?=${s})`))}else r=e.split(n);else r=e.split("");return r.filter(s=>s!=="")}async createDocuments(e,n=[],r={}){const s=n.length>0?n:[...Array(e.length)].map(()=>({})),{chunkHeader:a="",chunkOverlapHeader:i="(cont'd) ",appendChunkOverlapHeader:o=!1}=r,u=new Array;for(let c=0;c<e.length;c+=1){const l=e[c];let d=1,m=null,p=-1;for(const f of await this.splitText(l)){let g=a;const b=l.indexOf(f,p+1);if(m===null){const I=this.numberOfNewLines(l,0,b);d+=I}else{const I=p+await this.lengthFunction(m);if(I<b){const w=this.numberOfNewLines(l,I,b);d+=w}else if(I>b){const w=this.numberOfNewLines(l,b,I);d-=w}o&&(g+=i)}const _=this.numberOfNewLines(f),y=s[c].loc&&typeof s[c].loc=="object"?{...s[c].loc}:{};y.lines={from:d,to:d+_};const E={...s[c],loc:y};g+=f,u.push(new os({pageContent:g,metadata:E})),d+=_,m=f,p=b}}return u}numberOfNewLines(e,n,r){return(e.slice(n,r).match(/\n/g)||[]).length}async splitDocuments(e,n={}){const r=e.filter(i=>i.pageContent!==void 0),s=r.map(i=>i.pageContent),a=r.map(i=>i.metadata);return this.createDocuments(s,a,n)}joinDocs(e,n){const r=e.join(n).trim();return r===""?null:r}async mergeSplits(e,n){const r=[],s=[];let a=0;for(const o of e){const u=await this.lengthFunction(o);if(a+u+s.length*n.length>this.chunkSize&&(a>this.chunkSize&&console.warn(`Created a chunk of size ${a}, +
which is longer than the specified ${this.chunkSize}`),s.length>0)){const c=this.joinDocs(s,n);for(c!==null&&r.push(c);a>this.chunkOverlap||a+u+s.length*n.length>this.chunkSize&&a>0;)a-=await this.lengthFunction(s[0]),s.shift()}s.push(o),a+=u}const i=this.joinDocs(s,n);return i!==null&&r.push(i),r}}class Zu extends aP{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(e==null?void 0:e.separators)??this.separators,this.keepSeparator=(e==null?void 0:e.keepSeparator)??!0}async _splitText(e,n){const r=[];let s=n[n.length-1],a;for(let c=0;c<n.length;c+=1){const l=n[c];if(l===""){s=l;break}if(e.includes(l)){s=l,a=n.slice(c+1);break}}const i=this.splitOnSeparator(e,s);let o=[];const u=this.keepSeparator?"":s;for(const c of i)if(await this.lengthFunction(c)<this.chunkSize)o.push(c);else{if(o.length){const l=await this.mergeSplits(o,u);r.push(...l),o=[]}if(!a)r.push(c);else{const l=await this._splitText(c,a);r.push(...l)}}if(o.length){const c=await this.mergeSplits(o,u);r.push(...c)}return r}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,n){return new Zu({...n,separators:Zu.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}}class ho{constructor(e,n){we(this,"data");we(this,"plugin");we(this,"name");we(this,"file");we(this,"i18n");this.name=n,this.plugin=e,this.i18n=e.i18n}async customSaveData(e,n){n=n||this.file;const r=`/ai/${n}`;let s;return typeof e=="object"?s=new File([new Blob([JSON.stringify(e)],{type:"application/json"})],r.split("/").pop()):s=new File([new Blob([e])],r.split("/").pop()),R2(r,!1,s)}async customLoadData(e){e=e||this.file;const n=`/ai/${e}`;return new Promise(r=>{en.fetchPost("/api/file/getFile",{path:n},s=>{s.code!==404&&(this.data=s),r(this.data)})})}async load(){let e=await this.plugin.loadData(this.file);return e?this.data=e:this.save(),this.data}async save(e){return e=e??this.data,this.plugin.saveData(this.file,e),e}}class iP extends ho{constructor(n,r,s,a,i,o){super(n,r);we(this,"apiKey");we(this,"documentVectorStorage");we(this,"data",new Map);we(this,"BATCH_SIZE",20);we(this,"MAX_CONTENT_LENGTH",510);we(this,"includeNotebooks");we(this,"excludeNotebooks");we(this,"recursiveCharacterTextSplitter");this.name=r??E_,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this.apiKey=s,this.documentVectorStorage=a,this.includeNotebooks=i,this.excludeNotebooks=o,this.recursiveCharacterTextSplitter=new Zu({chunkSize:this.MAX_CONTENT_LENGTH,chunkOverlap:50})}async load(){return console.debug("BlockStorage load"),this.data.size===0&&(this.data=await this.documentVectorStorage.embeddingBlocks()),await this.knowledgeProcess(),await this.documentVectorStorage.release(),this.data}get(n){return this.data[n]}has(n){return this.data.has(n)}add(n,r){this.data.set(n,r)}async getDocuments(){const n=[],r=a=>{if(!Array.isArray(a)){console.warn(this.i18n.invalidNodesArray);return}a.forEach(i=>{var o;n.push(i.id),((o=i.children)==null?void 0:o.length)>0&&r(i.children)})},s=await n2();if(!s)return n;for(const a of s.notebooks)if(!(this.excludeNotebooks&&this.excludeNotebooks.includes(a.name))&&(this.includeNotebooks===""||this.includeNotebooks.includes(a.name))){const i=await P2(a.id,"/");r(i.tree)}return n}async getBlocks(){const n=[],r=new Set(["widget","iframe","audio"]);try{const s=await this.getDocuments();return await Promise.allSettled(s.map(async a=>{try{const o=(await c_(a)).filter(u=>{var c;return!r.has(u.type)&&((c=u.content)==null?void 0:c.length)>2}).map(u=>({docId:a,blockId:u.id,content:u.content}));n.push(...o)}catch(i){console.error(`获取文档 ${a} 的块失败:`,i)}})),n}catch(s){return console.error("获取文档块失败:",s),[]}}async blocksToInsert(){console.debug("BlockStorage::blocksToInsert");const n=await this.getBlocks();return n?n==null?void 0:n.filter(r=>!this.has(r.blockId)):[]}async blocksToDelete(){console.debug("BlockStorage::blocksToDelete");const n=[];try{const r=await this.getBlocks(),s=new Set(r.map(a=>a.blockId));for(const[a,i]of this.data.entries())s.has(a)||(this.data.delete(a),n.push({blockId:a,docId:i}));return n}catch(r){return console.error("删除过期文档块ID失败:",r),n}}async processSingleBlock(n){const r=[];let s=n.content??"";return s.length>this.MAX_CONTENT_LENGTH&&(await this.recursiveCharacterTextSplitter.splitText(s)).forEach(i=>{r.push({blockId:n.blockId,docId:n.docId,content:i,isSummary:!1})}),r}async genBatchBlocks(n){const r=[];let s=[];for(const a of n)(await this.processSingleBlock(a)).forEach(o=>{s.push({pageContent:o.content,metadata:{blockId:o.blockId,docId:o.docId,isSummary:o.isSummary},id:o.blockId}),s.length===this.BATCH_SIZE&&(r.push(s),s=[])});return s.length>0&&r.push(s),r}async knowledgeProcess(){const n=await this.blocksToInsert(),r=await this.genBatchBlocks(n),s=r.length;let a=0,i=0;for(const u of r){a++;const c=Math.round(a/s*100);c>=i+5&&(ea(`${this.documentVectorStorage.i18n.knowledgeBaseProgress}: ${c}%`,2e3),i=c,await this.documentVectorStorage.save()),console.log(`处理第${a}批，共${s}批`),await this.documentVectorStorage.addDocuments(u)}await this.documentVectorStorage.save(),ea(this.documentVectorStorage.i18n.knowledgeReady,1e4);const o=await this.blocksToDelete();(o==null?void 0:o.length)>0&&this.documentVectorStorage.deleteDocuments(o)}}class wy extends ho{constructor(n,r){super(n,r);we(this,"data",[{id:1,title:this.i18n.translation,time:"2025/1/22 17:06:59",messages:[{id:1,role:"system",content:this.i18n.defaultSystemPrompt},{id:2,role:"user",content:this.i18n.defaultTranslationExample},{id:3,role:"assistant",content:this.i18n.defaultTranslationResponse}]},{id:2,title:this.i18n.greeting,time:"2025/1/22 17:05:59",messages:[{id:1,role:"system",content:this.i18n.defaultSystemPrompt},{id:2,role:"user",content:this.i18n.helloMessage},{id:3,role:"assistant",content:this.i18n.helloResponse}]}]);this.name=r??Vd,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`}add(n){return this.data.unshift(n),this.save()}update(n){const r=this.data.findIndex(s=>s.id===n.id);if(r!==-1)return this.data[r]=n,this.save()}updateMessage(n){return this.data=this.data.map(r=>({...r,messages:r.messages.map(s=>s.id===n.id?n:s)})),this.save()}delete(n){return this.data=this.data.filter(r=>r.id!==n),this.save()}deleteMessage(n){return this.data=this.data.map(r=>({...r,messages:r.messages.filter(s=>s.id!==n)})),this.save()}get(n){return this.data.find(r=>r.id===n)}set(n){return this.data.push(n),this.save()}dump(){return this.data}}class oP extends wy{constructor(){super(...arguments);we(this,"data",[{id:1,title:"图像生成",time:"2025/1/22 17:06:59",messages:[{id:1,role:"user",content:"an island near sea, with seagulls, moon shining over the sea, light house, boats int he background, fish flying over the sea",imageParam:{model:"Pro/black-forest-labs/FLUX.1-schnell",size:"1:1",seed:2345,steps:4,guidance:1,negativePrompt:""}},{id:2,role:"assistant",content:"![](https://easyimage.geeksphere.online/i/2025/02/18/gxsk8p.png)",imageParam:{model:"Pro/black-forest-labs/FLUX.1-schnell",size:"1:1",seed:2345,steps:4,guidance:1,negativePrompt:""}}]}])}}class uP extends ho{constructor(n,r){super(n,r);we(this,"data",[{id:0,title:this.i18n.translationPromptTitle,content:this.i18n.translationPromptContent},{id:1,title:this.i18n.extractTitlePromptTitle,content:this.i18n.extractTitlePromptContent}]);this.name=r??zd,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`}addPrompt(n){this.data=[...this.data,n],this.save()}updatePrompt(n){this.data=this.data.map(r=>r.id===n.id?n:r),this.save()}deletePrompt(n){this.data=this.data.filter(r=>r.id!==n),this.save()}get(n){return this.data.find(r=>r.id===n)}set(n){this.data.push(n),this.save()}}class cP extends ho{constructor(n,r){super(n,r);we(this,"data",new Map);this.name=r??qd,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this._defaultSettings()}async load(){let n=await this.plugin.loadData(this.file);if(n)for(let[r,s]of this.data){if(r==="isKnowledgeBaseInstruction"||r==="isKnowledgeBaseChat"){s.value=!1;continue}s.value=(n==null?void 0:n[r])??s.value}else this.save();return n}async save(n){return n=n??this.dump(),await this.plugin.saveData(this.file,n),n}get(n){return this.data.get(n)}getValue(n){var s;let r=(s=this.data.get(n))==null?void 0:s.value;return n==="apiKey"&&(r==null?void 0:r.length)===0&&to(this.i18n.pleaseConfigureApiKey,2e3),r}getSettingItems(n){let r=[];for(let[s,a]of this.data)n&&a.group!==n||r.push(a);return r}set(n,r){this.data.set(n,r)}setValue(n,r){let s=this.data.get(n);s.value=r}dump(){let n={};for(let[r,s]of this.data)n[r]=s.value;return n}_defaultSettings(){const n={group:"🌈 设置",title:this.i18n.apiKeyTitle,description:this.i18n.apiKeyDescription,type:"textinput",key:"apiKey",value:"",placeholder:this.i18n.apiKeyPlaceholder};this.data.set(n.key,n);const r={group:"🌈 设置",title:"是否开启知识库",description:"是否开启知识库，开启该选项，将会在后台构建知识库，用于后续的知识库问答。",type:"checkbox",key:"isKnowledge",value:!1};this.data.set(r.key,r);const s={group:"🌈 设置",title:"云端向量",description:"是否将笔记向量存储到云端[非思源笔记云端]，开启该选项，将降低对本地内存的消耗。对于电脑性能差或者笔记文本内容多的用户，建议开启该选项。",type:"checkbox",key:"isVectorOnline",value:!1};this.data.set(s.key,s);const a={group:"🌈 设置",title:"手机号",description:"开启该选项，将使用手机号作为向量存储的唯一标识。[若开启云端向量,此项必填]",type:"textinput",key:"phoneNumber",value:"",placeholder:"请输入手机号"};this.data.set(a.key,a);const i={group:"🌈 设置",title:this.i18n.excludeknowledgeBookTitle,description:this.i18n.excludeknowledgeBookDescription,type:"textinput",key:"excludeKnowledgeBook",value:"",placeholder:this.i18n.knowledgeBookPlaceholder};this.data.set(i.key,i);const o={group:"🌈 设置",title:this.i18n.includeknowledgeBookTitle,description:this.i18n.includeknowledgeBookDescription,type:"textinput",key:"includeKnowledgeBook",value:"",placeholder:this.i18n.knowledgeBookPlaceholder};this.data.set(o.key,o);const u={group:"instruction",title:"知识库召回块数量",description:"值越大，召回的块越多，输出结果越好，但是会消耗更多的token。默认值为5",key:"knowledgeBaseRecallNumInstruction",type:"number",value:5};this.data.set(u.key,u);const c={group:"chat",title:"知识库召回块数量",description:"值越大，召回的块越多，输出结果越好，但是会消耗更多的token。默认值为5",key:"knowledgeBaseRecallNumChat",type:"number",value:5},l={group:"instructionIcon",title:this.i18n.searchInstructionTitle,description:this.i18n.searchInstructionDesc,type:"checkbox",key:"isSearchInstruction",value:!1};this.data.set(l.key,l);const d={group:"instruction",title:this.i18n.pageContentTitle,description:this.i18n.pageContentDesc,type:"checkbox",key:"isPageContent",value:!1};this.data.set(d.key,d);const m={group:"instruction",title:this.i18n.temperatureTitle,description:this.i18n.temperatureDesc,type:"slider",key:"temperatureInstruction",slider:{min:0,max:1,step:.1},value:.5};this.data.set(m.key,m);const p={group:"instruction",title:this.i18n.maxTokensTitle,description:this.i18n.maxTokensDesc,type:"number",key:"maxOutputLengthInstruction",value:4e3};this.data.set(p.key,p);const f={group:"custom",title:this.i18n.searchChatTitle,description:this.i18n.searchChatDesc,key:"isSearchChat",type:"checkbox",value:!1};this.data.set(f.key,f),this.data.set(c.key,c);const g={group:"chat",title:this.i18n.maxTokensTitle,description:this.i18n.maxTokensDesc,type:"number",key:"maxOutputLengthChat",value:4e3};this.data.set(g.key,g);const b={group:"instruction",title:this.i18n.responseTimeoutTitle,description:this.i18n.responseTimeoutDesc,type:"number",key:"responseTimeoutInstruction",value:90};this.data.set(b.key,b);const _={group:"chat",title:this.i18n.responseTimeoutTitle,description:this.i18n.responseTimeoutDesc,type:"number",key:"responseTimeoutChat",value:90};this.data.set(_.key,_);const y={group:"chat",title:this.i18n.temperatureTitle,description:this.i18n.temperatureDesc,type:"slider",key:"temperatureChat",slider:{min:0,max:1,step:.1},value:.5};this.data.set(y.key,y);const E={group:"custom",title:this.i18n.knowledgeBaseTitle,description:this.i18n.knowledgeBaseDesc,type:"checkbox",key:"isKnowledgeBaseInstruction",value:!1};this.data.set(E.key,E);const I={group:"custom",title:this.i18n.knowledgeBaseTitle,description:this.i18n.knowledgeBaseDesc,type:"checkbox",key:"isKnowledgeBaseChat",value:!1};this.data.set(I.key,I);const w={group:"image",title:"模型",description:"文生图模型",type:"select",key:"modelImage",value:"stabilityai/stable-diffusion-3-5-large-turbo",options:{"stabilityai/stable-diffusion-3-5-large-turbo":"Stable Diffusion 3.5","black-forest-labs/FLUX.1-dev":"FLUX.1.dev","LoRA/black-forest-labs/FLUX.1-dev":"FLUX.1.dev.LoRA","Pro/black-forest-labs/FLUX.1-schnell":"FLUX.1.schnell"}};this.data.set(w.key,w);const O={group:"image",title:"图像比例",description:"生成图像的比例",type:"select",key:"sizeImage",value:"1024x1024",options:{"1024x1024":"1024x1024","512x1024":"512x1024","768x512":"768x512","768x1024":"768x1024","1024x576":"1024x576","576x1024":"576x1024"}};this.data.set(O.key,O),this.data.set(w.key,w);const S={group:"image",title:"随机种子",description:"随机种子固定的情况下，相同的提示词，生成的图像也会相同",type:"textinput",key:"seedImage",value:"2345",placeholder:"请输入随机种子"};this.data.set(S.key,S),this.data.set(w.key,w);const x={group:"image",title:"推理步数",description:"生成图像时的推理步数",type:"slider",key:"stepsImage",value:4,slider:{min:1,max:20,step:1}};this.data.set(x.key,x);const D={group:"image",title:"指令遵循强度",description:"生成图像时的指令遵循强度，值越大，生成的图像越符合指令",type:"slider",key:"guidanceImage",value:1,slider:{min:1,max:20,step:.1}};this.data.set(D.key,D);const B={group:"image",title:"负向提示词",description:"生成图像时的负向提示词",type:"textarea",key:"negativePromptImage",value:"",placeholder:"请输入负向提示词"};this.data.set(B.key,B);const Q={group:"model",title:this.i18n.modelTitle,description:this.i18n.modelDesc,type:"select",key:"modelSelections",value:"deepseek-chat",options:{"deepseek-chat":"DeepSeek V3","deepseek-reasoner":"DeepSeek R1","moonshot-v1-auto":"Moonshot Chat","glm-4-flash":"GLM 4 Flash","qwen-turbo-latest":"Qwen Turbo","qwen-plus-latest":"Qwen Plus","qwen-max-latest":"Qwen Max","doubao-1.5-lite-32k":"Doubao 1.5 Lite","doubao-1.5-pro-32k":"Doubao 1.5 Pro","gemini-2.0-flash-thinking-exp-01-21":"Gemini 2.0 Flash Thinking","gpt-4o-mini":"GPT 4o mini"}};this.data.set(Q.key,Q),this.load()}}function hg(t,e,n){const r=t.slice();return r[6]=e[n],r}function fg(t){let e,n,r,s=t[6].title+"",a,i,o,u=t[6].time+"",c,l,d,m,p,f;function g(){return t[4](t[6])}function b(){return t[5](t[6])}return{c(){e=F("div"),n=F("button"),r=F("span"),a=Ye(s),i=te(),o=F("div"),c=Ye(u),l=te(),d=F("button"),d.innerHTML='<svg viewBox="0 0 24 24" width="1rem" height="1rem" stroke="currentColor" stroke-width="2" fill="none" class="svelte-1f7dc1o"><path d="M18 6L6 18M6 6l12 12"></path></svg>',m=te(),C(r,"class","svelte-1f7dc1o"),C(o,"class","time svelte-1f7dc1o"),C(n,"class","item-content svelte-1f7dc1o"),C(d,"class","delete-btn svelte-1f7dc1o"),C(d,"title","删除对话"),C(e,"class","list-item svelte-1f7dc1o")},m(_,y){he(_,e,y),k(e,n),k(n,r),k(r,a),k(n,i),k(n,o),k(o,c),k(e,l),k(e,d),k(e,m),p||(f=[ie(n,"click",g),ie(d,"click",p_(b))],p=!0)},p(_,y){t=_,y&1&&s!==(s=t[6].title+"")&&dt(a,s),y&1&&u!==(u=t[6].time+"")&&dt(c,u)},d(_){_&&de(e),p=!1,ct(f)}}}function lP(t){let e,n,r,s,a,i,o,u=t[0].i18n.newChat+"",c,l,d,m,p=Ot(t[0].dump()),f=[];for(let g=0;g<p.length;g+=1)f[g]=fg(hg(t,p,g));return{c(){e=F("div"),n=F("div"),n.innerHTML='<h3 class="svelte-1f7dc1o">SiYuan AI</h3>',r=te(),s=F("div"),a=F("button"),i=F("span"),o=Ye("+ "),c=Ye(u),l=te();for(let g=0;g<f.length;g+=1)f[g].c();C(n,"class","history-header svelte-1f7dc1o"),C(i,"class","svelte-1f7dc1o"),C(a,"class","new-chat-btn svelte-1f7dc1o"),C(s,"class","list svelte-1f7dc1o"),C(e,"class","history svelte-1f7dc1o")},m(g,b){he(g,e,b),k(e,n),k(e,r),k(e,s),k(s,a),k(a,i),k(i,o),k(i,c),k(s,l);for(let _=0;_<f.length;_+=1)f[_]&&f[_].m(s,null);d||(m=ie(a,"click",t[2]),d=!0)},p(g,[b]){if(b&1&&u!==(u=g[0].i18n.newChat+"")&&dt(c,u),b&11){p=Ot(g[0].dump());let _;for(_=0;_<p.length;_+=1){const y=hg(g,p,_);f[_]?f[_].p(y,b):(f[_]=fg(y),f[_].c(),f[_].m(s,null))}for(;_<f.length;_+=1)f[_].d(1);f.length=p.length}},i:et,o:et,d(g){g&&de(e),Ns(f,g),d=!1,m()}}}function dP(t,e,n){let{chatHistoryStorage:r}=e;const s=Wn();function a(){const c={id:Date.now(),title:r.i18n.newChat,time:y_().format("YYYY/M/D HH:mm:ss"),messages:[{id:Date.now(),role:"system",content:"You are a helpful assistant. You can help me by answering my questions. You can also ask me questions."}]};r.add(c),n(0,r),s("selectChat",c)}function i(c){r.delete(c),n(0,r),r.data.length===0&&a(),s("selectChat",r.dump()[0])}const o=c=>s("selectChat",c),u=c=>i(c.id);return t.$$set=c=>{"chatHistoryStorage"in c&&n(0,r=c.chatHistoryStorage)},[r,s,a,i,o,u]}let hP=class extends rt{constructor(e){super(),nt(this,e,dP,lP,tt,{chatHistoryStorage:0})}};function mg(t,e,n){const r=t.slice();return r[12]=e[n],r}function fP(t){var b;let e,n,r,s=t[1].Md2HTML(t[12].content)+"",a,i,o,u,c,l,d,m,p=((b=t[12])==null?void 0:b.fileContent)&&pg(),f=t[12].role==="user"&&gg(t);function g(){return t[8](t[12])}return{c(){e=F("div"),p&&p.c(),n=te(),r=F("div"),a=te(),i=F("div"),f&&f.c(),o=te(),u=F("button"),u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1u3nldm"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',c=te(),C(r,"class","message-content svelte-1u3nldm"),C(u,"class","action-btn svelte-1u3nldm"),C(i,"class","message-actions svelte-1u3nldm"),C(e,"class",l="message "+(t[12].role==="user"?"user":"ai")+" svelte-1u3nldm")},m(_,y){he(_,e,y),p&&p.m(e,null),k(e,n),k(e,r),r.innerHTML=s,k(e,a),k(e,i),f&&f.m(i,null),k(i,o),k(i,u),k(e,c),d||(m=ie(u,"click",g),d=!0)},p(_,y){var E;t=_,(E=t[12])!=null&&E.fileContent?p||(p=pg(),p.c(),p.m(e,n)):p&&(p.d(1),p=null),y&3&&s!==(s=t[1].Md2HTML(t[12].content)+"")&&(r.innerHTML=s),t[12].role==="user"?f?f.p(t,y):(f=gg(t),f.c(),f.m(i,o)):f&&(f.d(1),f=null),y&1&&l!==(l="message "+(t[12].role==="user"?"user":"ai")+" svelte-1u3nldm")&&C(e,"class",l)},d(_){_&&de(e),p&&p.d(),f&&f.d(),d=!1,m()}}}function mP(t){let e,n,r=t[1].Md2HTML(`![User uploaded image](${t[12].image})

${t[12].content}`)+"",s,a,i,o,u,c,l,d,m=t[12].role==="user"&&bg(t);function p(){return t[6](t[12])}return{c(){e=F("div"),n=F("div"),s=te(),a=F("div"),m&&m.c(),i=te(),o=F("button"),o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1u3nldm"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',u=te(),C(n,"class","message-content svelte-1u3nldm"),C(o,"class","action-btn svelte-1u3nldm"),C(a,"class","message-actions svelte-1u3nldm"),C(e,"class",c="message "+(t[12].role==="user"?"user":"ai")+" svelte-1u3nldm")},m(f,g){he(f,e,g),k(e,n),n.innerHTML=r,k(e,s),k(e,a),m&&m.m(a,null),k(a,i),k(a,o),k(e,u),l||(d=ie(o,"click",p),l=!0)},p(f,g){t=f,g&3&&r!==(r=t[1].Md2HTML(`![User uploaded image](${t[12].image})

${t[12].content}`)+"")&&(n.innerHTML=r),t[12].role==="user"?m?m.p(t,g):(m=bg(t),m.c(),m.m(a,i)):m&&(m.d(1),m=null),g&1&&c!==(c="message "+(t[12].role==="user"?"user":"ai")+" svelte-1u3nldm")&&C(e,"class",c)},d(f){f&&de(e),m&&m.d(),l=!1,d()}}}function pg(t){let e;return{c(){e=F("span"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>',C(e,"class","file-icon svelte-1u3nldm")},m(n,r){he(n,e,r)},d(n){n&&de(e)}}}function gg(t){let e,n,r;function s(){return t[7](t[12])}return{c(){e=F("button"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1u3nldm"><path d="M23 4v6h-6M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>',C(e,"class","action-btn svelte-1u3nldm")},m(a,i){he(a,e,i),n||(r=ie(e,"click",s),n=!0)},p(a,i){t=a},d(a){a&&de(e),n=!1,r()}}}function bg(t){let e,n,r;function s(){return t[5](t[12])}return{c(){e=F("button"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1u3nldm"><path d="M23 4v6h-6M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>',C(e,"class","action-btn svelte-1u3nldm")},m(a,i){he(a,e,i),n||(r=ie(e,"click",s),n=!0)},p(a,i){t=a},d(a){a&&de(e),n=!1,r()}}}function _g(t){let e;function n(a,i){var o,u;return((u=(o=a[12])==null?void 0:o.image)==null?void 0:u.length)>0?mP:fP}let r=n(t),s=r(t);return{c(){s.c(),e=Oc()},m(a,i){s.m(a,i),he(a,e,i)},p(a,i){r===(r=n(a))&&s?s.p(a,i):(s.d(1),s=r(a),s&&(s.c(),s.m(e.parentNode,e)))},d(a){a&&de(e),s.d(a)}}}function pP(t){let e,n,r=Ot(t[0].messages),s=[];for(let a=0;a<r.length;a+=1)s[a]=_g(mg(t,r,a));return{c(){e=F("div"),n=F("div");for(let a=0;a<s.length;a+=1)s[a].c();C(n,"class","messages-wrapper svelte-1u3nldm"),C(e,"class","message-container svelte-1u3nldm")},m(a,i){he(a,e,i),k(e,n);for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(n,null);t[9](e)},p(a,[i]){if(i&27){r=Ot(a[0].messages);let o;for(o=0;o<r.length;o+=1){const u=mg(a,r,o);s[o]?s[o].p(u,i):(s[o]=_g(u),s[o].c(),s[o].m(n,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=r.length}},i:et,o:et,d(a){a&&de(e),Ns(s,a),t[9](null)}}}function gP(t,e,n){let{currentChat:r}=e,{lute:s}=e,a;const i=Wn();function o(){if(a){const g=a.scrollHeight,b=a.clientHeight,_=g-b;a.scrollTo({top:_,behavior:"smooth"})}}function u(g){i("edit",{message:g})}function c(g){i("delete",{message:g})}d2(()=>{var g;if(((g=r==null?void 0:r.messages)==null?void 0:g.length)>0){const b=r.messages[r.messages.length-1];(b==null?void 0:b.role)==="ai"&&setTimeout(o,50)}}),no(o);const l=g=>u(g),d=g=>c(g),m=g=>u(g),p=g=>c(g);function f(g){fe[g?"unshift":"push"](()=>{a=g,n(2,a)})}return t.$$set=g=>{"currentChat"in g&&n(0,r=g.currentChat),"lute"in g&&n(1,s=g.lute)},t.$$.update=()=>{if(t.$$.dirty&1&&r!=null&&r.messages){const g=r.messages[r.messages.length-1];(g==null?void 0:g.role)!=="user"&&g.content&&o()}},[r,s,a,u,c,l,d,m,p,f]}class bP extends rt{constructor(e){super(),nt(this,e,gP,pP,tt,{currentChat:0,lute:1})}}function yg(t,e,n){const r=t.slice();return r[0]=e[n][0],r[18]=e[n][1],r}function _P(t){let e,n,r,s,a,i,o;return{c(){e=F("div"),n=F("input"),C(n,"id","fontSize"),C(n,"min",r=t[5].min),C(n,"max",s=t[5].max),C(n,"step",a=t[5].step),C(n,"type","range"),C(n,"style",t[8]),ke(n,"b3-slider",!0),ke(n,"fn__size200",t[7]),C(e,"class","b3-tooltips b3-tooltips__n"),C(e,"aria-label",t[0])},m(u,c){he(u,e,c),k(e,n),vt(n,t[0]),i||(o=[ie(n,"change",t[16]),ie(n,"input",t[16]),ie(n,"change",t[10])],i=!0)},p(u,c){c&32&&r!==(r=u[5].min)&&C(n,"min",r),c&32&&s!==(s=u[5].max)&&C(n,"max",s),c&32&&a!==(a=u[5].step)&&C(n,"step",a),c&256&&C(n,"style",u[8]),c&17&&vt(n,u[0]),c&128&&ke(n,"fn__size200",u[7]),c&17&&C(e,"aria-label",u[0])},d(u){u&&de(e),i=!1,ct(o)}}}function yP(t){let e,n,r,s=Ot(Object.entries(t[4])),a=[];for(let i=0;i<s.length;i+=1)a[i]=Eg(yg(t,s,i));return{c(){e=F("select");for(let i=0;i<a.length;i+=1)a[i].c();C(e,"id","iconPosition"),C(e,"style",t[8]),t[0]===void 0&&Lu(()=>t[15].call(e)),ke(e,"b3-select",!0),ke(e,"fn__flex-center",!0),ke(e,"fn__size200",t[7])},m(i,o){he(i,e,o);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(e,null);dp(e,t[0],!0),n||(r=[ie(e,"change",t[15]),ie(e,"change",t[10])],n=!0)},p(i,o){if(o&16){s=Ot(Object.entries(i[4]));let u;for(u=0;u<s.length;u+=1){const c=yg(i,s,u);a[u]?a[u].p(c,o):(a[u]=Eg(c),a[u].c(),a[u].m(e,null))}for(;u<a.length;u+=1)a[u].d(1);a.length=s.length}o&256&&C(e,"style",i[8]),o&17&&dp(e,i[0]),o&128&&ke(e,"fn__size200",i[7])},d(i){i&&de(e),Ns(a,i),n=!1,ct(r)}}}function EP(t){let e,n=t[6].label+"",r,s,a;return{c(){e=F("button"),r=Ye(n),C(e,"id",t[2]),C(e,"style",t[8]),ke(e,"b3-button",!0),ke(e,"b3-button--outline",!0),ke(e,"fn__flex-center",!0),ke(e,"fn__size200",t[7])},m(i,o){he(i,e,o),k(e,r),s||(a=ie(e,"click",t[9]),s=!0)},p(i,o){o&64&&n!==(n=i[6].label+"")&&dt(r,n),o&4&&C(e,"id",i[2]),o&256&&C(e,"style",i[8]),o&128&&ke(e,"fn__size200",i[7])},d(i){i&&de(e),s=!1,a()}}}function wP(t){let e,n,r;return{c(){e=F("input"),C(e,"id",t[2]),C(e,"type","number"),C(e,"style",t[8]),ke(e,"b3-text-field",!0),ke(e,"fn__flex-center",!0),ke(e,"fn__size200",t[7])},m(s,a){he(s,e,a),vt(e,t[0]),n||(r=[ie(e,"input",t[14]),ie(e,"change",t[10])],n=!0)},p(s,a){a&4&&C(e,"id",s[2]),a&256&&C(e,"style",s[8]),a&17&&jd(e.value)!==s[0]&&vt(e,s[0]),a&128&&ke(e,"fn__size200",s[7])},d(s){s&&de(e),n=!1,ct(r)}}}function TP(t){let e,n,r,s;return{c(){e=F("textarea"),C(e,"class","b3-text-field fn__block"),C(e,"style",n=`resize: vertical; height: 10em; white-space: nowrap; ${t[8]}`)},m(a,i){he(a,e,i),vt(e,t[0]),r||(s=[ie(e,"input",t[13]),ie(e,"change",t[10])],r=!0)},p(a,i){i&256&&n!==(n=`resize: vertical; height: 10em; white-space: nowrap; ${a[8]}`)&&C(e,"style",n),i&17&&vt(e,a[0])},d(a){a&&de(e),r=!1,ct(s)}}}function SP(t){let e,n,r;return{c(){e=F("input"),C(e,"id",t[2]),C(e,"placeholder",t[3]),C(e,"style",t[8]),ke(e,"b3-text-field",!0),ke(e,"fn__flex-center",!0),ke(e,"fn__size200",t[7])},m(s,a){he(s,e,a),vt(e,t[0]),n||(r=[ie(e,"input",t[12]),ie(e,"change",t[10])],n=!0)},p(s,a){a&4&&C(e,"id",s[2]),a&8&&C(e,"placeholder",s[3]),a&256&&C(e,"style",s[8]),a&17&&e.value!==s[0]&&vt(e,s[0]),a&128&&ke(e,"fn__size200",s[7])},d(s){s&&de(e),n=!1,ct(r)}}}function AP(t){let e,n,r;return{c(){e=F("input"),C(e,"class","b3-switch fn__flex-center"),C(e,"id",t[2]),C(e,"type","checkbox"),C(e,"style",t[8])},m(s,a){he(s,e,a),e.checked=t[0],n||(r=[ie(e,"change",t[11]),ie(e,"change",t[10])],n=!0)},p(s,a){a&4&&C(e,"id",s[2]),a&256&&C(e,"style",s[8]),a&17&&(e.checked=s[0])},d(s){s&&de(e),n=!1,ct(r)}}}function Eg(t){let e,n=t[18]+"",r,s;return{c(){e=F("option"),r=Ye(n),e.__value=s=t[0],vt(e,e.__value)},m(a,i){he(a,e,i),k(e,r)},p(a,i){i&16&&n!==(n=a[18]+"")&&dt(r,n),i&16&&s!==(s=a[0])&&(e.__value=s,vt(e,e.__value))},d(a){a&&de(e)}}}function CP(t){let e;function n(a,i){if(a[1]==="checkbox")return AP;if(a[1]==="textinput")return SP;if(a[1]==="textarea")return TP;if(a[1]==="number")return wP;if(a[1]==="button")return EP;if(a[1]==="select")return yP;if(a[1]=="slider")return _P}let r=n(t),s=r&&r(t);return{c(){s&&s.c(),e=Oc()},m(a,i){s&&s.m(a,i),he(a,e,i)},p(a,[i]){r===(r=n(a))&&s?s.p(a,i):(s&&s.d(1),s=r&&r(a),s&&(s.c(),s.m(e.parentNode,e)))},i:et,o:et,d(a){a&&de(e),s&&s.d(a)}}}function vP(t,e,n){let{type:r}=e,{key:s}=e,{value:a}=e,{placeholder:i=""}=e,{options:o={}}=e,{slider:u={min:0,max:100,step:1}}=e,{button:c={label:a,callback:()=>{}}}=e,{fnSize:l=!0}=e,{style:d=""}=e;const m=Wn();function p(){c==null||c.callback(),m("click",{key:s})}function f(){m("changed",{key:s,value:a})}function g(){a=this.checked,n(0,a),n(4,o)}function b(){a=this.value,n(0,a),n(4,o)}function _(){a=this.value,n(0,a),n(4,o)}function y(){a=jd(this.value),n(0,a),n(4,o)}function E(){a=c2(this),n(0,a),n(4,o)}function I(){a=jd(this.value),n(0,a),n(4,o)}return t.$$set=w=>{"type"in w&&n(1,r=w.type),"key"in w&&n(2,s=w.key),"value"in w&&n(0,a=w.value),"placeholder"in w&&n(3,i=w.placeholder),"options"in w&&n(4,o=w.options),"slider"in w&&n(5,u=w.slider),"button"in w&&n(6,c=w.button),"fnSize"in w&&n(7,l=w.fnSize),"style"in w&&n(8,d=w.style)},[a,r,s,i,o,u,c,l,d,p,f,g,b,_,y,E,I]}let As=class extends rt{constructor(e){super(),nt(this,e,vP,CP,tt,{type:1,key:2,value:0,placeholder:3,options:4,slider:5,button:6,fnSize:7,style:8})}};function OP(t){let e,n,r,s,a,i,o=Ju(t[1],t[3])+"",u,c,l,d;const m=t[5].default,p=tf(m,t,t[4],null);return{c(){e=F("div"),n=F("div"),r=F("span"),s=Ye(t[0]),a=te(),i=F("div"),u=te(),c=F("span"),l=te(),p&&p.c(),C(r,"class","title svelte-ikiu6h"),C(i,"class","b3-label__text"),C(n,"class","fn__flex-1"),C(c,"class","fn__space"),C(e,"class","item-wrap fn__flex b3-label config__item svelte-ikiu6h")},m(f,g){he(f,e,g),k(e,n),k(n,r),k(r,s),k(n,a),k(n,i),i.innerHTML=o,k(e,u),k(e,c),k(e,l),p&&p.m(e,null),d=!0},p(f,g){(!d||g&1)&&dt(s,f[0]),(!d||g&10)&&o!==(o=Ju(f[1],f[3])+"")&&(i.innerHTML=o),p&&p.p&&(!d||g&16)&&rf(p,m,f,f[4],d?nf(m,f[4],g,null):sf(f[4]),null)},i(f){d||(ae(p,f),d=!0)},o(f){le(p,f),d=!1},d(f){f&&de(e),p&&p.d(f)}}}function IP(t){let e,n,r,s,a,i,o=Ju(t[1],t[3])+"",u,c,l,d,m;const p=t[5].default,f=tf(p,t,t[4],null);return{c(){e=F("div"),n=F("div"),r=F("span"),s=Ye(t[0]),a=te(),i=F("div"),u=te(),c=F("div"),l=te(),d=F("div"),f&&f.c(),C(r,"class","title svelte-ikiu6h"),C(i,"class","b3-label__text"),C(c,"class","fn__hr"),Ht(d,"display","flex"),Ht(d,"flex-direction","column"),Ht(d,"gap","5px"),Ht(d,"position","relative"),C(n,"class","fn__block"),C(e,"class","item-wrap b3-label svelte-ikiu6h"),C(e,"data-key","CustomCSS")},m(g,b){he(g,e,b),k(e,n),k(n,r),k(r,s),k(n,a),k(n,i),i.innerHTML=o,k(n,u),k(n,c),k(n,l),k(n,d),f&&f.m(d,null),m=!0},p(g,b){(!m||b&1)&&dt(s,g[0]),(!m||b&10)&&o!==(o=Ju(g[1],g[3])+"")&&(i.innerHTML=o),f&&f.p&&(!m||b&16)&&rf(f,p,g,g[4],m?nf(p,g[4],b,null):sf(g[4]),null)},i(g){m||(ae(f,g),m=!0)},o(g){le(f,g),m=!1},d(g){g&&de(e),f&&f.d(g)}}}function kP(t){let e,n,r,s;const a=[IP,OP],i=[];function o(u,c){return u[2]==="row"?0:1}return e=o(t),n=i[e]=a[e](t),{c(){n.c(),r=Oc()},m(u,c){i[e].m(u,c),he(u,r,c),s=!0},p(u,[c]){let l=e;e=o(u),e===l?i[e].p(u,c):(hr(),le(i[l],1,1,()=>{i[l]=null}),fr(),n=i[e],n?n.p(u,c):(n=i[e]=a[e](u),n.c()),ae(n,1),n.m(r.parentNode,r))},i(u){s||(ae(n),s=!0)},o(u){le(n),s=!1},d(u){u&&de(r),i[e].d(u)}}}function Ju(t,e=!1){return e&&t.length>20?t.slice(0,20)+"...":t}function NP(t,e,n){let{$$slots:r={},$$scope:s}=e,{title:a}=e,{description:i}=e,{direction:o="column"}=e,{isSimple:u=!1}=e;return t.$$set=c=>{"title"in c&&n(0,a=c.title),"description"in c&&n(1,i=c.description),"direction"in c&&n(2,o=c.direction),"isSimple"in c&&n(3,u=c.isSimple),"$$scope"in c&&n(4,s=c.$$scope)},[a,i,o,u,s,r]}class RP extends rt{constructor(e){super(),nt(this,e,NP,kP,tt,{title:0,description:1,direction:2,isSimple:3})}}const Ty={Wrap:RP,Input:As};function Sy(t,e){return function(){return t.apply(e,arguments)}}const{toString:PP}=Object.prototype,{getPrototypeOf:kf}=Object,Vc=(t=>e=>{const n=PP.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Yn=t=>(t=t.toLowerCase(),e=>Vc(e)===t),zc=t=>e=>typeof e===t,{isArray:Ca}=Array,Hi=zc("undefined");function xP(t){return t!==null&&!Hi(t)&&t.constructor!==null&&!Hi(t.constructor)&&bn(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Ay=Yn("ArrayBuffer");function LP(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Ay(t.buffer),e}const DP=zc("string"),bn=zc("function"),Cy=zc("number"),Wc=t=>t!==null&&typeof t=="object",MP=t=>t===!0||t===!1,yu=t=>{if(Vc(t)!=="object")return!1;const e=kf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},BP=Yn("Date"),FP=Yn("File"),UP=Yn("Blob"),jP=Yn("FileList"),HP=t=>Wc(t)&&bn(t.pipe),$P=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||bn(t.append)&&((e=Vc(t))==="formdata"||e==="object"&&bn(t.toString)&&t.toString()==="[object FormData]"))},qP=Yn("URLSearchParams"),[VP,zP,WP,GP]=["ReadableStream","Request","Response","Headers"].map(Yn),KP=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function fo(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let r,s;if(typeof t!="object"&&(t=[t]),Ca(t))for(r=0,s=t.length;r<s;r++)e.call(null,t[r],r,t);else{const a=n?Object.getOwnPropertyNames(t):Object.keys(t),i=a.length;let o;for(r=0;r<i;r++)o=a[r],e.call(null,t[o],o,t)}}function vy(t,e){e=e.toLowerCase();const n=Object.keys(t);let r=n.length,s;for(;r-- >0;)if(s=n[r],e===s.toLowerCase())return s;return null}const cs=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Oy=t=>!Hi(t)&&t!==cs;function lh(){const{caseless:t}=Oy(this)&&this||{},e={},n=(r,s)=>{const a=t&&vy(e,s)||s;yu(e[a])&&yu(r)?e[a]=lh(e[a],r):yu(r)?e[a]=lh({},r):Ca(r)?e[a]=r.slice():e[a]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&fo(arguments[r],n);return e}const YP=(t,e,n,{allOwnKeys:r}={})=>(fo(e,(s,a)=>{n&&bn(s)?t[a]=Sy(s,n):t[a]=s},{allOwnKeys:r}),t),ZP=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),JP=(t,e,n,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},XP=(t,e,n,r)=>{let s,a,i;const o={};if(e=e||{},t==null)return e;do{for(s=Object.getOwnPropertyNames(t),a=s.length;a-- >0;)i=s[a],(!r||r(i,t,e))&&!o[i]&&(e[i]=t[i],o[i]=!0);t=n!==!1&&kf(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},QP=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const r=t.indexOf(e,n);return r!==-1&&r===n},e3=t=>{if(!t)return null;if(Ca(t))return t;let e=t.length;if(!Cy(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},t3=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&kf(Uint8Array)),n3=(t,e)=>{const r=(t&&t[Symbol.iterator]).call(t);let s;for(;(s=r.next())&&!s.done;){const a=s.value;e.call(t,a[0],a[1])}},r3=(t,e)=>{let n;const r=[];for(;(n=t.exec(e))!==null;)r.push(n);return r},s3=Yn("HTMLFormElement"),a3=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,s){return r.toUpperCase()+s}),wg=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),i3=Yn("RegExp"),Iy=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),r={};fo(n,(s,a)=>{let i;(i=e(s,a,t))!==!1&&(r[a]=i||s)}),Object.defineProperties(t,r)},o3=t=>{Iy(t,(e,n)=>{if(bn(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];if(bn(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},u3=(t,e)=>{const n={},r=s=>{s.forEach(a=>{n[a]=!0})};return Ca(t)?r(t):r(String(t).split(e)),n},c3=()=>{},l3=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,Wl="abcdefghijklmnopqrstuvwxyz",Tg="0123456789",ky={DIGIT:Tg,ALPHA:Wl,ALPHA_DIGIT:Wl+Wl.toUpperCase()+Tg},d3=(t=16,e=ky.ALPHA_DIGIT)=>{let n="";const{length:r}=e;for(;t--;)n+=e[Math.random()*r|0];return n};function h3(t){return!!(t&&bn(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const f3=t=>{const e=new Array(10),n=(r,s)=>{if(Wc(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const a=Ca(r)?[]:{};return fo(r,(i,o)=>{const u=n(i,s+1);!Hi(u)&&(a[o]=u)}),e[s]=void 0,a}}return r};return n(t,0)},m3=Yn("AsyncFunction"),p3=t=>t&&(Wc(t)||bn(t))&&bn(t.then)&&bn(t.catch),Ny=((t,e)=>t?setImmediate:e?((n,r)=>(cs.addEventListener("message",({source:s,data:a})=>{s===cs&&a===n&&r.length&&r.shift()()},!1),s=>{r.push(s),cs.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",bn(cs.postMessage)),g3=typeof queueMicrotask<"u"?queueMicrotask.bind(cs):typeof process<"u"&&process.nextTick||Ny,$={isArray:Ca,isArrayBuffer:Ay,isBuffer:xP,isFormData:$P,isArrayBufferView:LP,isString:DP,isNumber:Cy,isBoolean:MP,isObject:Wc,isPlainObject:yu,isReadableStream:VP,isRequest:zP,isResponse:WP,isHeaders:GP,isUndefined:Hi,isDate:BP,isFile:FP,isBlob:UP,isRegExp:i3,isFunction:bn,isStream:HP,isURLSearchParams:qP,isTypedArray:t3,isFileList:jP,forEach:fo,merge:lh,extend:YP,trim:KP,stripBOM:ZP,inherits:JP,toFlatObject:XP,kindOf:Vc,kindOfTest:Yn,endsWith:QP,toArray:e3,forEachEntry:n3,matchAll:r3,isHTMLForm:s3,hasOwnProperty:wg,hasOwnProp:wg,reduceDescriptors:Iy,freezeMethods:o3,toObjectSet:u3,toCamelCase:a3,noop:c3,toFiniteNumber:l3,findKey:vy,global:cs,isContextDefined:Oy,ALPHABET:ky,generateString:d3,isSpecCompliantForm:h3,toJSONObject:f3,isAsyncFn:m3,isThenable:p3,setImmediate:Ny,asap:g3};function Ae(t,e,n,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}$.inherits(Ae,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:$.toJSONObject(this.config),code:this.code,status:this.status}}});const Ry=Ae.prototype,Py={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Py[t]={value:t}});Object.defineProperties(Ae,Py);Object.defineProperty(Ry,"isAxiosError",{value:!0});Ae.from=(t,e,n,r,s,a)=>{const i=Object.create(Ry);return $.toFlatObject(t,i,function(u){return u!==Error.prototype},o=>o!=="isAxiosError"),Ae.call(i,t.message,e,n,r,s),i.cause=t,i.name=t.name,a&&Object.assign(i,a),i};const b3=null;function dh(t){return $.isPlainObject(t)||$.isArray(t)}function xy(t){return $.endsWith(t,"[]")?t.slice(0,-2):t}function Sg(t,e,n){return t?t.concat(e).map(function(s,a){return s=xy(s),!n&&a?"["+s+"]":s}).join(n?".":""):e}function _3(t){return $.isArray(t)&&!t.some(dh)}const y3=$.toFlatObject($,{},null,function(e){return/^is[A-Z]/.test(e)});function Gc(t,e,n){if(!$.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=$.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,b){return!$.isUndefined(b[g])});const r=n.metaTokens,s=n.visitor||l,a=n.dots,i=n.indexes,u=(n.Blob||typeof Blob<"u"&&Blob)&&$.isSpecCompliantForm(e);if(!$.isFunction(s))throw new TypeError("visitor must be a function");function c(f){if(f===null)return"";if($.isDate(f))return f.toISOString();if(!u&&$.isBlob(f))throw new Ae("Blob is not supported. Use a Buffer instead.");return $.isArrayBuffer(f)||$.isTypedArray(f)?u&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function l(f,g,b){let _=f;if(f&&!b&&typeof f=="object"){if($.endsWith(g,"{}"))g=r?g:g.slice(0,-2),f=JSON.stringify(f);else if($.isArray(f)&&_3(f)||($.isFileList(f)||$.endsWith(g,"[]"))&&(_=$.toArray(f)))return g=xy(g),_.forEach(function(E,I){!($.isUndefined(E)||E===null)&&e.append(i===!0?Sg([g],I,a):i===null?g:g+"[]",c(E))}),!1}return dh(f)?!0:(e.append(Sg(b,g,a),c(f)),!1)}const d=[],m=Object.assign(y3,{defaultVisitor:l,convertValue:c,isVisitable:dh});function p(f,g){if(!$.isUndefined(f)){if(d.indexOf(f)!==-1)throw Error("Circular reference detected in "+g.join("."));d.push(f),$.forEach(f,function(_,y){(!($.isUndefined(_)||_===null)&&s.call(e,_,$.isString(y)?y.trim():y,g,m))===!0&&p(_,g?g.concat(y):[y])}),d.pop()}}if(!$.isObject(t))throw new TypeError("data must be an object");return p(t),e}function Ag(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function Nf(t,e){this._pairs=[],t&&Gc(t,this,e)}const Ly=Nf.prototype;Ly.append=function(e,n){this._pairs.push([e,n])};Ly.toString=function(e){const n=e?function(r){return e.call(this,r,Ag)}:Ag;return this._pairs.map(function(s){return n(s[0])+"="+n(s[1])},"").join("&")};function E3(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Dy(t,e,n){if(!e)return t;const r=n&&n.encode||E3;$.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let a;if(s?a=s(e,n):a=$.isURLSearchParams(e)?e.toString():new Nf(e,n).toString(r),a){const i=t.indexOf("#");i!==-1&&(t=t.slice(0,i)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class Cg{constructor(){this.handlers=[]}use(e,n,r){return this.handlers.push({fulfilled:e,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){$.forEach(this.handlers,function(r){r!==null&&e(r)})}}const My={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},w3=typeof URLSearchParams<"u"?URLSearchParams:Nf,T3=typeof FormData<"u"?FormData:null,S3=typeof Blob<"u"?Blob:null,A3={isBrowser:!0,classes:{URLSearchParams:w3,FormData:T3,Blob:S3},protocols:["http","https","file","blob","url","data"]},Rf=typeof window<"u"&&typeof document<"u",hh=typeof navigator=="object"&&navigator||void 0,C3=Rf&&(!hh||["ReactNative","NativeScript","NS"].indexOf(hh.product)<0),v3=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",O3=Rf&&window.location.href||"http://localhost",I3=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Rf,hasStandardBrowserEnv:C3,hasStandardBrowserWebWorkerEnv:v3,navigator:hh,origin:O3},Symbol.toStringTag,{value:"Module"})),Dt={...I3,...A3};function k3(t,e){return Gc(t,new Dt.classes.URLSearchParams,Object.assign({visitor:function(n,r,s,a){return Dt.isNode&&$.isBuffer(n)?(this.append(r,n.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function N3(t){return $.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function R3(t){const e={},n=Object.keys(t);let r;const s=n.length;let a;for(r=0;r<s;r++)a=n[r],e[a]=t[a];return e}function By(t){function e(n,r,s,a){let i=n[a++];if(i==="__proto__")return!0;const o=Number.isFinite(+i),u=a>=n.length;return i=!i&&$.isArray(s)?s.length:i,u?($.hasOwnProp(s,i)?s[i]=[s[i],r]:s[i]=r,!o):((!s[i]||!$.isObject(s[i]))&&(s[i]=[]),e(n,r,s[i],a)&&$.isArray(s[i])&&(s[i]=R3(s[i])),!o)}if($.isFormData(t)&&$.isFunction(t.entries)){const n={};return $.forEachEntry(t,(r,s)=>{e(N3(r),s,n,0)}),n}return null}function P3(t,e,n){if($.isString(t))try{return(e||JSON.parse)(t),$.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(0,JSON.stringify)(t)}const mo={transitional:My,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const r=n.getContentType()||"",s=r.indexOf("application/json")>-1,a=$.isObject(e);if(a&&$.isHTMLForm(e)&&(e=new FormData(e)),$.isFormData(e))return s?JSON.stringify(By(e)):e;if($.isArrayBuffer(e)||$.isBuffer(e)||$.isStream(e)||$.isFile(e)||$.isBlob(e)||$.isReadableStream(e))return e;if($.isArrayBufferView(e))return e.buffer;if($.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return k3(e,this.formSerializer).toString();if((o=$.isFileList(e))||r.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return Gc(o?{"files[]":e}:e,u&&new u,this.formSerializer)}}return a||s?(n.setContentType("application/json",!1),P3(e)):e}],transformResponse:[function(e){const n=this.transitional||mo.transitional,r=n&&n.forcedJSONParsing,s=this.responseType==="json";if($.isResponse(e)||$.isReadableStream(e))return e;if(e&&$.isString(e)&&(r&&!this.responseType||s)){const i=!(n&&n.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(o){if(i)throw o.name==="SyntaxError"?Ae.from(o,Ae.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Dt.classes.FormData,Blob:Dt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};$.forEach(["delete","get","head","post","put","patch"],t=>{mo.headers[t]={}});const x3=$.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),L3=t=>{const e={};let n,r,s;return t&&t.split(`
`).forEach(function(i){s=i.indexOf(":"),n=i.substring(0,s).trim().toLowerCase(),r=i.substring(s+1).trim(),!(!n||e[n]&&x3[n])&&(n==="set-cookie"?e[n]?e[n].push(r):e[n]=[r]:e[n]=e[n]?e[n]+", "+r:r)}),e},vg=Symbol("internals");function Ba(t){return t&&String(t).trim().toLowerCase()}function Eu(t){return t===!1||t==null?t:$.isArray(t)?t.map(Eu):String(t)}function D3(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(t);)e[r[1]]=r[2];return e}const M3=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Gl(t,e,n,r,s){if($.isFunction(r))return r.call(this,e,n);if(s&&(e=n),!!$.isString(e)){if($.isString(r))return e.indexOf(r)!==-1;if($.isRegExp(r))return r.test(e)}}function B3(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,r)=>n.toUpperCase()+r)}function F3(t,e){const n=$.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+n,{value:function(s,a,i){return this[r].call(this,e,s,a,i)},configurable:!0})})}class rn{constructor(e){e&&this.set(e)}set(e,n,r){const s=this;function a(o,u,c){const l=Ba(u);if(!l)throw new Error("header name must be a non-empty string");const d=$.findKey(s,l);(!d||s[d]===void 0||c===!0||c===void 0&&s[d]!==!1)&&(s[d||u]=Eu(o))}const i=(o,u)=>$.forEach(o,(c,l)=>a(c,l,u));if($.isPlainObject(e)||e instanceof this.constructor)i(e,n);else if($.isString(e)&&(e=e.trim())&&!M3(e))i(L3(e),n);else if($.isHeaders(e))for(const[o,u]of e.entries())a(u,o,r);else e!=null&&a(n,e,r);return this}get(e,n){if(e=Ba(e),e){const r=$.findKey(this,e);if(r){const s=this[r];if(!n)return s;if(n===!0)return D3(s);if($.isFunction(n))return n.call(this,s,r);if($.isRegExp(n))return n.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=Ba(e),e){const r=$.findKey(this,e);return!!(r&&this[r]!==void 0&&(!n||Gl(this,this[r],r,n)))}return!1}delete(e,n){const r=this;let s=!1;function a(i){if(i=Ba(i),i){const o=$.findKey(r,i);o&&(!n||Gl(r,r[o],o,n))&&(delete r[o],s=!0)}}return $.isArray(e)?e.forEach(a):a(e),s}clear(e){const n=Object.keys(this);let r=n.length,s=!1;for(;r--;){const a=n[r];(!e||Gl(this,this[a],a,e,!0))&&(delete this[a],s=!0)}return s}normalize(e){const n=this,r={};return $.forEach(this,(s,a)=>{const i=$.findKey(r,a);if(i){n[i]=Eu(s),delete n[a];return}const o=e?B3(a):String(a).trim();o!==a&&delete n[a],n[o]=Eu(s),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return $.forEach(this,(r,s)=>{r!=null&&r!==!1&&(n[s]=e&&$.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const r=new this(e);return n.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[vg]=this[vg]={accessors:{}}).accessors,s=this.prototype;function a(i){const o=Ba(i);r[o]||(F3(s,i),r[o]=!0)}return $.isArray(e)?e.forEach(a):a(e),this}}rn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);$.reduceDescriptors(rn.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[n]=r}}});$.freezeMethods(rn);function Kl(t,e){const n=this||mo,r=e||n,s=rn.from(r.headers);let a=r.data;return $.forEach(t,function(o){a=o.call(n,a,s.normalize(),e?e.status:void 0)}),s.normalize(),a}function Fy(t){return!!(t&&t.__CANCEL__)}function va(t,e,n){Ae.call(this,t??"canceled",Ae.ERR_CANCELED,e,n),this.name="CanceledError"}$.inherits(va,Ae,{__CANCEL__:!0});function Uy(t,e,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?t(n):e(new Ae("Request failed with status code "+n.status,[Ae.ERR_BAD_REQUEST,Ae.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function U3(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function j3(t,e){t=t||10;const n=new Array(t),r=new Array(t);let s=0,a=0,i;return e=e!==void 0?e:1e3,function(u){const c=Date.now(),l=r[a];i||(i=c),n[s]=u,r[s]=c;let d=a,m=0;for(;d!==s;)m+=n[d++],d=d%t;if(s=(s+1)%t,s===a&&(a=(a+1)%t),c-i<e)return;const p=l&&c-l;return p?Math.round(m*1e3/p):void 0}}function H3(t,e){let n=0,r=1e3/e,s,a;const i=(c,l=Date.now())=>{n=l,s=null,a&&(clearTimeout(a),a=null),t.apply(null,c)};return[(...c)=>{const l=Date.now(),d=l-n;d>=r?i(c,l):(s=c,a||(a=setTimeout(()=>{a=null,i(s)},r-d)))},()=>s&&i(s)]}const Xu=(t,e,n=3)=>{let r=0;const s=j3(50,250);return H3(a=>{const i=a.loaded,o=a.lengthComputable?a.total:void 0,u=i-r,c=s(u),l=i<=o;r=i;const d={loaded:i,total:o,progress:o?i/o:void 0,bytes:u,rate:c||void 0,estimated:c&&o&&l?(o-i)/c:void 0,event:a,lengthComputable:o!=null,[e?"download":"upload"]:!0};t(d)},n)},Og=(t,e)=>{const n=t!=null;return[r=>e[0]({lengthComputable:n,total:t,loaded:r}),e[1]]},Ig=t=>(...e)=>$.asap(()=>t(...e)),$3=Dt.hasStandardBrowserEnv?((t,e)=>n=>(n=new URL(n,Dt.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new URL(Dt.origin),Dt.navigator&&/(msie|trident)/i.test(Dt.navigator.userAgent)):()=>!0,q3=Dt.hasStandardBrowserEnv?{write(t,e,n,r,s,a){const i=[t+"="+encodeURIComponent(e)];$.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),$.isString(r)&&i.push("path="+r),$.isString(s)&&i.push("domain="+s),a===!0&&i.push("secure"),document.cookie=i.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function V3(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function z3(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function jy(t,e){return t&&!V3(e)?z3(t,e):e}const kg=t=>t instanceof rn?{...t}:t;function Cs(t,e){e=e||{};const n={};function r(c,l,d,m){return $.isPlainObject(c)&&$.isPlainObject(l)?$.merge.call({caseless:m},c,l):$.isPlainObject(l)?$.merge({},l):$.isArray(l)?l.slice():l}function s(c,l,d,m){if($.isUndefined(l)){if(!$.isUndefined(c))return r(void 0,c,d,m)}else return r(c,l,d,m)}function a(c,l){if(!$.isUndefined(l))return r(void 0,l)}function i(c,l){if($.isUndefined(l)){if(!$.isUndefined(c))return r(void 0,c)}else return r(void 0,l)}function o(c,l,d){if(d in e)return r(c,l);if(d in t)return r(void 0,c)}const u={url:a,method:a,data:a,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:o,headers:(c,l,d)=>s(kg(c),kg(l),d,!0)};return $.forEach(Object.keys(Object.assign({},t,e)),function(l){const d=u[l]||s,m=d(t[l],e[l],l);$.isUndefined(m)&&d!==o||(n[l]=m)}),n}const Hy=t=>{const e=Cs({},t);let{data:n,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:a,headers:i,auth:o}=e;e.headers=i=rn.from(i),e.url=Dy(jy(e.baseURL,e.url),t.params,t.paramsSerializer),o&&i.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let u;if($.isFormData(n)){if(Dt.hasStandardBrowserEnv||Dt.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((u=i.getContentType())!==!1){const[c,...l]=u?u.split(";").map(d=>d.trim()).filter(Boolean):[];i.setContentType([c||"multipart/form-data",...l].join("; "))}}if(Dt.hasStandardBrowserEnv&&(r&&$.isFunction(r)&&(r=r(e)),r||r!==!1&&$3(e.url))){const c=s&&a&&q3.read(a);c&&i.set(s,c)}return e},W3=typeof XMLHttpRequest<"u",G3=W3&&function(t){return new Promise(function(n,r){const s=Hy(t);let a=s.data;const i=rn.from(s.headers).normalize();let{responseType:o,onUploadProgress:u,onDownloadProgress:c}=s,l,d,m,p,f;function g(){p&&p(),f&&f(),s.cancelToken&&s.cancelToken.unsubscribe(l),s.signal&&s.signal.removeEventListener("abort",l)}let b=new XMLHttpRequest;b.open(s.method.toUpperCase(),s.url,!0),b.timeout=s.timeout;function _(){if(!b)return;const E=rn.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),w={data:!o||o==="text"||o==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:E,config:t,request:b};Uy(function(S){n(S),g()},function(S){r(S),g()},w),b=null}"onloadend"in b?b.onloadend=_:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(_)},b.onabort=function(){b&&(r(new Ae("Request aborted",Ae.ECONNABORTED,t,b)),b=null)},b.onerror=function(){r(new Ae("Network Error",Ae.ERR_NETWORK,t,b)),b=null},b.ontimeout=function(){let I=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const w=s.transitional||My;s.timeoutErrorMessage&&(I=s.timeoutErrorMessage),r(new Ae(I,w.clarifyTimeoutError?Ae.ETIMEDOUT:Ae.ECONNABORTED,t,b)),b=null},a===void 0&&i.setContentType(null),"setRequestHeader"in b&&$.forEach(i.toJSON(),function(I,w){b.setRequestHeader(w,I)}),$.isUndefined(s.withCredentials)||(b.withCredentials=!!s.withCredentials),o&&o!=="json"&&(b.responseType=s.responseType),c&&([m,f]=Xu(c,!0),b.addEventListener("progress",m)),u&&b.upload&&([d,p]=Xu(u),b.upload.addEventListener("progress",d),b.upload.addEventListener("loadend",p)),(s.cancelToken||s.signal)&&(l=E=>{b&&(r(!E||E.type?new va(null,t,b):E),b.abort(),b=null)},s.cancelToken&&s.cancelToken.subscribe(l),s.signal&&(s.signal.aborted?l():s.signal.addEventListener("abort",l)));const y=U3(s.url);if(y&&Dt.protocols.indexOf(y)===-1){r(new Ae("Unsupported protocol "+y+":",Ae.ERR_BAD_REQUEST,t));return}b.send(a||null)})},K3=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let r=new AbortController,s;const a=function(c){if(!s){s=!0,o();const l=c instanceof Error?c:this.reason;r.abort(l instanceof Ae?l:new va(l instanceof Error?l.message:l))}};let i=e&&setTimeout(()=>{i=null,a(new Ae(`timeout ${e} of ms exceeded`,Ae.ETIMEDOUT))},e);const o=()=>{t&&(i&&clearTimeout(i),i=null,t.forEach(c=>{c.unsubscribe?c.unsubscribe(a):c.removeEventListener("abort",a)}),t=null)};t.forEach(c=>c.addEventListener("abort",a));const{signal:u}=r;return u.unsubscribe=()=>$.asap(o),u}},Y3=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let r=0,s;for(;r<n;)s=r+e,yield t.slice(r,s),r=s},Z3=async function*(t,e){for await(const n of J3(t))yield*Y3(n,e)},J3=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:r}=await e.read();if(n)break;yield r}}finally{await e.cancel()}},Ng=(t,e,n,r)=>{const s=Z3(t,e);let a=0,i,o=u=>{i||(i=!0,r&&r(u))};return new ReadableStream({async pull(u){try{const{done:c,value:l}=await s.next();if(c){o(),u.close();return}let d=l.byteLength;if(n){let m=a+=d;n(m)}u.enqueue(new Uint8Array(l))}catch(c){throw o(c),c}},cancel(u){return o(u),s.return()}},{highWaterMark:2})},Kc=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",$y=Kc&&typeof ReadableStream=="function",X3=Kc&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),qy=(t,...e)=>{try{return!!t(...e)}catch{return!1}},Q3=$y&&qy(()=>{let t=!1;const e=new Request(Dt.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),Rg=64*1024,fh=$y&&qy(()=>$.isReadableStream(new Response("").body)),Qu={stream:fh&&(t=>t.body)};Kc&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Qu[e]&&(Qu[e]=$.isFunction(t[e])?n=>n[e]():(n,r)=>{throw new Ae(`Response type '${e}' is not supported`,Ae.ERR_NOT_SUPPORT,r)})})})(new Response);const ex=async t=>{if(t==null)return 0;if($.isBlob(t))return t.size;if($.isSpecCompliantForm(t))return(await new Request(Dt.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if($.isArrayBufferView(t)||$.isArrayBuffer(t))return t.byteLength;if($.isURLSearchParams(t)&&(t=t+""),$.isString(t))return(await X3(t)).byteLength},tx=async(t,e)=>{const n=$.toFiniteNumber(t.getContentLength());return n??ex(e)},nx=Kc&&(async t=>{let{url:e,method:n,data:r,signal:s,cancelToken:a,timeout:i,onDownloadProgress:o,onUploadProgress:u,responseType:c,headers:l,withCredentials:d="same-origin",fetchOptions:m}=Hy(t);c=c?(c+"").toLowerCase():"text";let p=K3([s,a&&a.toAbortSignal()],i),f;const g=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let b;try{if(u&&Q3&&n!=="get"&&n!=="head"&&(b=await tx(l,r))!==0){let w=new Request(e,{method:"POST",body:r,duplex:"half"}),O;if($.isFormData(r)&&(O=w.headers.get("content-type"))&&l.setContentType(O),w.body){const[S,x]=Og(b,Xu(Ig(u)));r=Ng(w.body,Rg,S,x)}}$.isString(d)||(d=d?"include":"omit");const _="credentials"in Request.prototype;f=new Request(e,{...m,signal:p,method:n.toUpperCase(),headers:l.normalize().toJSON(),body:r,duplex:"half",credentials:_?d:void 0});let y=await fetch(f);const E=fh&&(c==="stream"||c==="response");if(fh&&(o||E&&g)){const w={};["status","statusText","headers"].forEach(D=>{w[D]=y[D]});const O=$.toFiniteNumber(y.headers.get("content-length")),[S,x]=o&&Og(O,Xu(Ig(o),!0))||[];y=new Response(Ng(y.body,Rg,S,()=>{x&&x(),g&&g()}),w)}c=c||"text";let I=await Qu[$.findKey(Qu,c)||"text"](y,t);return!E&&g&&g(),await new Promise((w,O)=>{Uy(w,O,{data:I,headers:rn.from(y.headers),status:y.status,statusText:y.statusText,config:t,request:f})})}catch(_){throw g&&g(),_&&_.name==="TypeError"&&/fetch/i.test(_.message)?Object.assign(new Ae("Network Error",Ae.ERR_NETWORK,t,f),{cause:_.cause||_}):Ae.from(_,_&&_.code,t,f)}}),mh={http:b3,xhr:G3,fetch:nx};$.forEach(mh,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const Pg=t=>`- ${t}`,rx=t=>$.isFunction(t)||t===null||t===!1,Vy={getAdapter:t=>{t=$.isArray(t)?t:[t];const{length:e}=t;let n,r;const s={};for(let a=0;a<e;a++){n=t[a];let i;if(r=n,!rx(n)&&(r=mh[(i=String(n)).toLowerCase()],r===void 0))throw new Ae(`Unknown adapter '${i}'`);if(r)break;s[i||"#"+a]=r}if(!r){const a=Object.entries(s).map(([o,u])=>`adapter ${o} `+(u===!1?"is not supported by the environment":"is not available in the build"));let i=e?a.length>1?`since :
`+a.map(Pg).join(`
`):" "+Pg(a[0]):"as no adapter specified";throw new Ae("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return r},adapters:mh};function Yl(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new va(null,t)}function xg(t){return Yl(t),t.headers=rn.from(t.headers),t.data=Kl.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Vy.getAdapter(t.adapter||mo.adapter)(t).then(function(r){return Yl(t),r.data=Kl.call(t,t.transformResponse,r),r.headers=rn.from(r.headers),r},function(r){return Fy(r)||(Yl(t),r&&r.response&&(r.response.data=Kl.call(t,t.transformResponse,r.response),r.response.headers=rn.from(r.response.headers))),Promise.reject(r)})}const zy="1.7.9",Yc={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Yc[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const Lg={};Yc.transitional=function(e,n,r){function s(a,i){return"[Axios v"+zy+"] Transitional option '"+a+"'"+i+(r?". "+r:"")}return(a,i,o)=>{if(e===!1)throw new Ae(s(i," has been removed"+(n?" in "+n:"")),Ae.ERR_DEPRECATED);return n&&!Lg[i]&&(Lg[i]=!0,console.warn(s(i," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(a,i,o):!0}};Yc.spelling=function(e){return(n,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function sx(t,e,n){if(typeof t!="object")throw new Ae("options must be an object",Ae.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let s=r.length;for(;s-- >0;){const a=r[s],i=e[a];if(i){const o=t[a],u=o===void 0||i(o,a,t);if(u!==!0)throw new Ae("option "+a+" must be "+u,Ae.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Ae("Unknown option "+a,Ae.ERR_BAD_OPTION)}}const wu={assertOptions:sx,validators:Yc},er=wu.validators;class ps{constructor(e){this.defaults=e,this.interceptors={request:new Cg,response:new Cg}}async request(e,n){try{return await this._request(e,n)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const a=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}catch{}}throw r}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=Cs(this.defaults,n);const{transitional:r,paramsSerializer:s,headers:a}=n;r!==void 0&&wu.assertOptions(r,{silentJSONParsing:er.transitional(er.boolean),forcedJSONParsing:er.transitional(er.boolean),clarifyTimeoutError:er.transitional(er.boolean)},!1),s!=null&&($.isFunction(s)?n.paramsSerializer={serialize:s}:wu.assertOptions(s,{encode:er.function,serialize:er.function},!0)),wu.assertOptions(n,{baseUrl:er.spelling("baseURL"),withXsrfToken:er.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let i=a&&$.merge(a.common,a[n.method]);a&&$.forEach(["delete","get","head","post","put","patch","common"],f=>{delete a[f]}),n.headers=rn.concat(i,a);const o=[];let u=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(n)===!1||(u=u&&g.synchronous,o.unshift(g.fulfilled,g.rejected))});const c=[];this.interceptors.response.forEach(function(g){c.push(g.fulfilled,g.rejected)});let l,d=0,m;if(!u){const f=[xg.bind(this),void 0];for(f.unshift.apply(f,o),f.push.apply(f,c),m=f.length,l=Promise.resolve(n);d<m;)l=l.then(f[d++],f[d++]);return l}m=o.length;let p=n;for(d=0;d<m;){const f=o[d++],g=o[d++];try{p=f(p)}catch(b){g.call(this,b);break}}try{l=xg.call(this,p)}catch(f){return Promise.reject(f)}for(d=0,m=c.length;d<m;)l=l.then(c[d++],c[d++]);return l}getUri(e){e=Cs(this.defaults,e);const n=jy(e.baseURL,e.url);return Dy(n,e.params,e.paramsSerializer)}}$.forEach(["delete","get","head","options"],function(e){ps.prototype[e]=function(n,r){return this.request(Cs(r||{},{method:e,url:n,data:(r||{}).data}))}});$.forEach(["post","put","patch"],function(e){function n(r){return function(a,i,o){return this.request(Cs(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:i}))}}ps.prototype[e]=n(),ps.prototype[e+"Form"]=n(!0)});class Pf{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(a){n=a});const r=this;this.promise.then(s=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](s);r._listeners=null}),this.promise.then=s=>{let a;const i=new Promise(o=>{r.subscribe(o),a=o}).then(s);return i.cancel=function(){r.unsubscribe(a)},i},e(function(a,i,o){r.reason||(r.reason=new va(a,i,o),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=r=>{e.abort(r)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new Pf(function(s){e=s}),cancel:e}}}function ax(t){return function(n){return t.apply(null,n)}}function ix(t){return $.isObject(t)&&t.isAxiosError===!0}const ph={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ph).forEach(([t,e])=>{ph[e]=t});function Wy(t){const e=new ps(t),n=Sy(ps.prototype.request,e);return $.extend(n,ps.prototype,e,{allOwnKeys:!0}),$.extend(n,e,null,{allOwnKeys:!0}),n.create=function(s){return Wy(Cs(t,s))},n}const qe=Wy(mo);qe.Axios=ps;qe.CanceledError=va;qe.CancelToken=Pf;qe.isCancel=Fy;qe.VERSION=zy;qe.toFormData=Gc;qe.AxiosError=Ae;qe.Cancel=qe.CanceledError;qe.all=function(e){return Promise.all(e)};qe.spread=ax;qe.isAxiosError=ix;qe.mergeConfig=Cs;qe.AxiosHeaders=rn;qe.formToJSON=t=>By($.isHTMLForm(t)?new FormData(t):t);qe.getAdapter=Vy.getAdapter;qe.HttpStatusCode=ph;qe.default=qe;async function $i(t){if(!t||t.length==0)return[0,0];const e={method:"POST",url:atob("aHR0cDovL25iMS5mcnAueWh0dWouY246MTQ5MjgvYWRtaW4tYXBpL2FpZ2MvYmFsYW5jZS90b2tlbg"),headers:{"content-type":"application/json"},data:{apikey:t.replace("sk-","")}};let n=await qe.request(e);return!n||n.status!=200?[0,0]:n.data.data}function ox(t){let e,n,r,s=t[0].balanceQuery+"",a,i,o,u=t[0].accountBalance+"",c,l,d,m,p,f,g=t[0].validUntil+"",b,_,y=new Date(t[3]).toLocaleString()+"",E,I,w,O,S,x=t[0].refresh+"",D,B,Q;return{c(){e=F("label"),n=F("div"),r=F("span"),a=Ye(s),i=te(),o=F("div"),c=Ye(u),l=Ye(" : "),d=Ye(t[2]),m=Ye(` ¥
      `),p=F("br"),f=te(),b=Ye(g),_=Ye(" : "),E=Ye(y),I=te(),w=F("span"),O=te(),S=F("button"),D=Ye(x),C(r,"class","title"),C(o,"class","b3-label__text"),C(n,"class","fn__flex-1"),C(w,"class","fn__space"),C(S,"class","b3-button b3-button--outline fn__flex-center fn__size200"),C(e,"class","item-wrap fn__flex b3-label config__item")},m(K,ee){he(K,e,ee),k(e,n),k(n,r),k(r,a),k(n,i),k(n,o),k(o,c),k(o,l),k(o,d),k(o,m),k(o,p),k(o,f),k(o,b),k(o,_),k(o,E),k(e,I),k(e,w),k(e,O),k(e,S),k(S,D),B||(Q=ie(S,"click",t[4]),B=!0)},p(K,[ee]){ee&1&&s!==(s=K[0].balanceQuery+"")&&dt(a,s),ee&1&&u!==(u=K[0].accountBalance+"")&&dt(c,u),ee&4&&dt(d,K[2]),ee&1&&g!==(g=K[0].validUntil+"")&&dt(b,g),ee&8&&y!==(y=new Date(K[3]).toLocaleString()+"")&&dt(E,y),ee&1&&x!==(x=K[0].refresh+"")&&dt(D,x)},i:et,o:et,d(K){K&&de(e),B=!1,Q()}}}function ux(t,e,n){let{i18n:r}=e,{apiKey:s}=e,a=0,i=0;no(async()=>{await $i(s).then(u=>{n(2,a=Math.round(u.money*10)/10),n(3,i=u.expiredTime*1e3)})});const o=async()=>{$i(s).then(u=>{n(3,i=u.expiredTime*1e3),n(2,a=Math.round(u.money*10)/10)})};return t.$$set=u=>{"i18n"in u&&n(0,r=u.i18n),"apiKey"in u&&n(1,s=u.apiKey)},[r,s,a,i,o]}let cx=class extends rt{constructor(e){super(),nt(this,e,ux,ox,tt,{i18n:0,apiKey:1})}};function Dg(t,e,n){const r=t.slice();return r[13]=e[n],r[14]=e,r[15]=n,r}function Mg(t){let e=t[5].buyKeyOnTaobao+"",n,r,s;return{c(){n=Ye(e),r=te(),s=F("div"),s.innerHTML='<img src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/taobao.png" alt="淘宝" style="max-width: 200px; height: auto;"/>',C(s,"class","config__img-container")},m(a,i){he(a,n,i),he(a,r,i),he(a,s,i)},p:et,d(a){a&&(de(n),de(r),de(s))}}}function lx(t){var i,o,u,c;let e,n,r;function s(l){t[10](l,t[13])}let a={type:t[13].type,key:t[13].key,placeholder:(i=t[13])==null?void 0:i.placeholder,options:(o=t[13])==null?void 0:o.options,slider:(u=t[13])==null?void 0:u.slider,button:(c=t[13])==null?void 0:c.button};return t[13].value!==void 0&&(a.value=t[13].value),e=new Ty.Input({props:a}),fe.push(()=>Ee(e,"value",s)),e.$on("click",t[6]),e.$on("changed",t[7]),{c(){Ve(e.$$.fragment)},m(l,d){Be(e,l,d),r=!0},p(l,d){var p,f,g,b;t=l;const m={};d&4&&(m.type=t[13].type),d&4&&(m.key=t[13].key),d&4&&(m.placeholder=(p=t[13])==null?void 0:p.placeholder),d&4&&(m.options=(f=t[13])==null?void 0:f.options),d&4&&(m.slider=(g=t[13])==null?void 0:g.slider),d&4&&(m.button=(b=t[13])==null?void 0:b.button),!n&&d&4&&(n=!0,m.value=t[13].value,ye(()=>n=!1)),e.$set(m)},i(l){r||(ae(e.$$.fragment,l),r=!0)},o(l){le(e.$$.fragment,l),r=!1},d(l){Fe(e,l)}}}function Bg(t,e){var a;let n,r,s;return r=new Ty.Wrap({props:{title:e[13].title,description:e[13].description,direction:(a=e[13])==null?void 0:a.direction,$$slots:{default:[lx]},$$scope:{ctx:e}}}),{key:t,first:null,c(){n=Oc(),Ve(r.$$.fragment),this.first=n},m(i,o){he(i,n,o),Be(r,i,o),s=!0},p(i,o){var c;e=i;const u={};o&4&&(u.title=e[13].title),o&4&&(u.description=e[13].description),o&4&&(u.direction=(c=e[13])==null?void 0:c.direction),o&2052&&(u.$$scope={dirty:o,ctx:e}),r.$set(u)},i(i){s||(ae(r.$$.fragment,i),s=!0)},o(i){le(r.$$.fragment,i),s=!1},d(i){i&&de(n),Fe(r,i)}}}function Fg(t){let e,n;return e=new cx({props:{apiKey:t[1].getValue("apiKey"),i18n:t[5]}}),{c(){Ve(e.$$.fragment)},m(r,s){Be(e,r,s),n=!0},p(r,s){const a={};s&2&&(a.apiKey=r[1].getValue("apiKey")),e.$set(a)},i(r){n||(ae(e.$$.fragment,r),n=!0)},o(r){le(e.$$.fragment,r),n=!1},d(r){Fe(e,r)}}}function dx(t){let e,n,r,s=[],a=new Map,i,o,u;const c=t[9].default,l=tf(c,t,t[11],null);let d=t[3]&&Mg(t),m=Ot(t[2]);const p=g=>g[13].key;for(let g=0;g<m.length;g+=1){let b=Dg(t,m,g),_=p(b);a.set(_,s[g]=Bg(_,b))}let f=t[3]&&Fg(t);return{c(){e=F("div"),l&&l.c(),n=te(),d&&d.c(),r=te();for(let g=0;g<s.length;g+=1)s[g].c();i=te(),f&&f.c(),C(e,"class",o="config__tab-container "+t[4]),C(e,"data-name",t[0])},m(g,b){he(g,e,b),l&&l.m(e,null),k(e,n),d&&d.m(e,null),k(e,r);for(let _=0;_<s.length;_+=1)s[_]&&s[_].m(e,null);k(e,i),f&&f.m(e,null),u=!0},p(g,[b]){l&&l.p&&(!u||b&2048)&&rf(l,c,g,g[11],u?nf(c,g[11],b,null):sf(g[11]),null),g[3]?d?d.p(g,b):(d=Mg(g),d.c(),d.m(e,r)):d&&(d.d(1),d=null),b&196&&(m=Ot(g[2]),hr(),s=b_(s,b,p,1,g,m,a,e,_2,Bg,i,Dg),fr()),g[3]?f?(f.p(g,b),b&8&&ae(f,1)):(f=Fg(g),f.c(),ae(f,1),f.m(e,null)):f&&(hr(),le(f,1,1,()=>{f=null}),fr()),(!u||b&16&&o!==(o="config__tab-container "+g[4]))&&C(e,"class",o),(!u||b&1)&&C(e,"data-name",g[0])},i(g){if(!u){ae(l,g);for(let b=0;b<m.length;b+=1)ae(s[b]);ae(f),u=!0}},o(g){le(l,g);for(let b=0;b<s.length;b+=1)le(s[b]);le(f),u=!1},d(g){g&&de(e),l&&l.d(g),d&&d.d();for(let b=0;b<s.length;b+=1)s[b].d();f&&f.d()}}}function hx(t,e,n){let r,s,{$$slots:a={},$$scope:i}=e,{group:o}=e,{settingStorage:u}=e,{display:c=!0}=e,l=u.getSettingItems(o);const d=u.plugin.i18n,m=Wn();function p({detail:b}){m("click",{key:b.key})}function f({detail:b}){m("changed",{group:o,...b})}function g(b,_){t.$$.not_equal(_.value,b)&&(_.value=b,n(2,l))}return t.$$set=b=>{"group"in b&&n(0,o=b.group),"settingStorage"in b&&n(1,u=b.settingStorage),"display"in b&&n(8,c=b.display),"$$scope"in b&&n(11,i=b.$$scope)},t.$$.update=()=>{t.$$.dirty&256&&n(4,r=c?"":"fn__none"),t.$$.dirty&1&&n(3,s=o==="🌈 设置")},[o,u,l,s,r,d,p,f,c,a,g,i]}class Gy extends rt{constructor(e){super(),nt(this,e,hx,dx,tt,{group:0,settingStorage:1,display:8})}}function fx(t){let e,n,r;return n=new Gy({props:{group:t[1],settingStorage:t[0],display:!0}}),n.$on("changed",t[2]),{c(){e=F("div"),Ve(n.$$.fragment),Ht(e,"margin-top","10px"),Ht(e,"padding","10px"),Ht(e,"background","none"),Ht(e,"border-radius","4px"),Ht(e,"border","1px solid var(--b3-border-color)")},m(s,a){he(s,e,a),Be(n,e,null),r=!0},p(s,[a]){const i={};a&2&&(i.group=s[1]),a&1&&(i.settingStorage=s[0]),n.$set(i)},i(s){r||(ae(n.$$.fragment,s),r=!0)},o(s){le(n.$$.fragment,s),r=!1},d(s){s&&de(e),Fe(n)}}}function mx(t,e,n){let{settingStorage:r}=e,{group:s}=e;const a=({detail:i})=>{r.setValue(i.key,i.value),r.save()};return t.$$set=i=>{"settingStorage"in i&&n(0,r=i.settingStorage),"group"in i&&n(1,s=i.group)},[r,s,a]}class Ky extends rt{constructor(e){super(),nt(this,e,mx,fx,tt,{settingStorage:0,group:1})}}const ss=class ss{async embedDocuments(e){const n=await this.requestEmbedding({inputs:e});if(!n||!n.data)throw console.debug("Failed to get embedding"),new Error("Failed to get embedding");return n.data.data.map(r=>r.embedding)}async embedQuery(e){const n=await this.requestEmbedding({inputs:e});if(!n||!n.data)throw console.debug("Failed to get embedding"),new Error("Failed to get embedding");return n.data.data[0].embedding}async requestEmbedding(e){return await this.retryRequest(0,e)}async retryRequest(e,n){try{const r=typeof n.inputs=="string"?Math.random()<.97?fp:hp:Math.random()<.97?hp:fp;return await qe.post(r,n)}catch{if(e<ss.MAX_RETRIES)return console.debug(`嵌入请求失败，${ss.RETRY_DELAY/1e3}秒后进行第${e+1}次重试`),await new Promise(s=>setTimeout(s,ss.RETRY_DELAY)),this.retryRequest(e+1,n)}}};we(ss,"MAX_RETRIES",3),we(ss,"RETRY_DELAY",1e3);let gh=ss;class px extends mt{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e==null?void 0:e.callbacks,this.tags=(e==null?void 0:e.tags)??[],this.metadata=(e==null?void 0:e.metadata)??{},this.verbose=(e==null?void 0:e.verbose)??!1}_getRelevantDocuments(e,n){throw new Error("Not implemented!")}async invoke(e,n){return this.getRelevantDocuments(e,He(n))}async getRelevantDocuments(e,n){const r=He(ly(n)),s=await Mt.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),a=await(s==null?void 0:s.handleRetrieverStart(this.toJSON(),e,r.runId,void 0,void 0,void 0,r.runName));try{const i=await this._getRelevantDocuments(e,a);return await(a==null?void 0:a.handleRetrieverEnd(i)),i}catch(i){throw await(a==null?void 0:a.handleRetrieverError(i)),i}}}class Zl extends px{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,n){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},n==null?void 0:n.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,n==null?void 0:n.getChild("vectorstore"))}async addDocuments(e,n){return this.vectorStore.addDocuments(e,n)}}class gx extends Kr{constructor(e,n){super(n),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,n=4,r=void 0,s=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),n,r)).map(i=>i[0])}async similaritySearchWithScore(e,n=4,r=void 0,s=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),n,r)}static fromTexts(e,n,r,s){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,n,r){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,n,r,s,a,i){if(typeof e=="number")return new Zl({vectorStore:this,k:e,filter:n,tags:[...s??[],this._vectorstoreType()],metadata:a,verbose:i,callbacks:r});{const o={vectorStore:this,k:e==null?void 0:e.k,filter:e==null?void 0:e.filter,tags:[...(e==null?void 0:e.tags)??[],this._vectorstoreType()],metadata:e==null?void 0:e.metadata,verbose:e==null?void 0:e.verbose,callbacks:e==null?void 0:e.callbacks,searchType:e==null?void 0:e.searchType};return(e==null?void 0:e.searchType)==="mmr"?new Zl({...o,searchKwargs:e.searchKwargs}):new Zl({...o})}}}function bx(t,e){let n=0,r=0,s=0;for(let a=0;a<t.length;a++)n+=t[a]*e[a],r+=t[a]*t[a],s+=e[a]*e[a];return n/(Math.sqrt(r)*Math.sqrt(s))}function _x(t,e){let n=0,r=0,s=0;for(let a=0;a<t.length;a++)n+=t[a]*e[a],r+=t[a]*t[a],s+=e[a]*e[a];return n/(Math.sqrt(r)*Math.sqrt(s))}function yx(t,e,n){if(t.length===0||t[0].length===0||e.length===0||e[0].length===0)return[[]];if(t[0].length!==e[0].length)throw new Error(`Number of columns in X and Y must be the same. X has shape ${[t.length,t[0].length]} and Y has shape ${[e.length,e[0].length]}.`);return t.map(r=>e.map(s=>n(r,s)).map(s=>Number.isNaN(s)?0:s))}function Ug(t,e){return yx(t,e,_x)}function Ex(t,e,n=.5,r=4){if(Math.min(r,e.length)<=0)return[];const s=Array.isArray(t[0])?t:[t],a=Ug(s,e)[0],i=wx(a).maxIndex,o=[e[i]],u=[i];for(;u.length<Math.min(r,e.length);){let c=-1/0,l=-1;const d=Ug(e,o);a.forEach((m,p)=>{if(u.includes(p))return;const f=Math.max(...d[p]),g=n*m-(1-n)*f;g>c&&(c=g,l=p)}),o.push(e[l]),u.push(l)}return u}function wx(t){if(t.length===0)return{maxIndex:-1,maxValue:NaN};let e=t[0],n=0;for(let r=1;r<t.length;r+=1)t[r]>e&&(n=r,e=t[r]);return{maxIndex:n,maxValue:e}}class xf extends gx{_vectorstoreType(){return"memory"}constructor(e,{similarity:n,...r}={}){super(e,r),Object.defineProperty(this,"memoryVectors",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"similarity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.similarity=n??bx}async addDocuments(e){const n=e.map(({pageContent:r})=>r);return this.addVectors(await this.embeddings.embedDocuments(n),e)}async addVectors(e,n){const r=e.map((s,a)=>({content:n[a].pageContent,embedding:s,metadata:n[a].metadata,id:n[a].id}));this.memoryVectors=this.memoryVectors.concat(r)}async _queryVectors(e,n,r){const s=i=>{if(!r)return!0;const o=new os({metadata:i.metadata,pageContent:i.content,id:i.id});return r(o)};return this.memoryVectors.filter(s).map((i,o)=>({similarity:this.similarity(e,i.embedding),index:o,metadata:i.metadata,content:i.content,embedding:i.embedding,id:i.id})).sort((i,o)=>i.similarity>o.similarity?-1:0).slice(0,n)}async similaritySearchVectorWithScore(e,n,r){return(await this._queryVectors(e,n,r)).map(i=>[new os({metadata:i.metadata,pageContent:i.content,id:i.id}),i.similarity])}async maxMarginalRelevanceSearch(e,n){const r=await this.embeddings.embedQuery(e),s=await this._queryVectors(r,n.fetchK??20,n.filter),a=s.map(o=>o.embedding);return Ex(r,a,n.lambda,n.k).map(o=>new os({metadata:s[o].metadata,pageContent:s[o].content,id:s[o].id}))}static async fromTexts(e,n,r,s){const a=[];for(let i=0;i<e.length;i+=1){const o=Array.isArray(n)?n[i]:n,u=new os({pageContent:e[i],metadata:o});a.push(u)}return xf.fromDocuments(a,r,s)}static async fromDocuments(e,n,r){const s=new this(n,r);return await s.addDocuments(e),s}static async fromExistingIndex(e,n){return new this(e,n)}}class Yy extends ho{constructor(n,r,s,a){super(n,r);we(this,"apiKey");we(this,"phone");this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this.apiKey=s,this.phone=a}}class Tx extends Yy{constructor(n,r,s,a){super(n,r,s,a);we(this,"memoryVectorStore");we(this,"embeddingService");this.name=r??Wd,this.plugin.removeData(this.file),this.embeddingService=new gh,this.memoryVectorStore=new xf(this.embeddingService)}async customLoadData(n){console.debug("MemoryVectorStorage::customLoadData"),n=n||this.file;const r=`/ai/${n}`,s=await N2(r);return(s==null?void 0:s.code)==404?[]:s}async load(){console.debug("MemoryVectorStorage::load");const n=await $i(this.apiKey);if((n==null?void 0:n.money)>0&&(n==null?void 0:n.expiredTime)>Math.floor(Date.now()/1e3)){const r=await this.customLoadData(this.file);r&&(this.memoryVectorStore.memoryVectors=r)}}async save(){console.debug("MemoryVectorStorage::save"),await this.customSaveData(this.memoryVectorStore.memoryVectors)}async release(){console.debug("MemoryVectorStorage::release"),this.memoryVectorStore.memoryVectors=[]}async embeddingBlocks(){console.debug("MemoryVectorStorage::embeddingBlocks"),await this.load();let n=new Map;return this.memoryVectorStore.memoryVectors.map(r=>{n.set(r.metadata.blockId,r.metadata.docId)}),n}async getDocuments(){return console.debug("MemoryVectorStorage::getDocuments"),this.memoryVectorStore.memoryVectors.map(n=>new os({pageContent:n.content,metadata:n.metadata}))}async addDocuments(n){console.debug("MemoryVectorStorage::addDocuments");const r=n.map(a=>a.pageContent),s=await this.embeddingService.embedDocuments(r);return await this.memoryVectorStore.addVectors(s,n),!0}async deleteDocument(n){console.debug("MemoryVectorStorage::deleteDocument");const r=this.memoryVectorStore.memoryVectors.findIndex(s=>s.metadata.blockId===n.blockId);return r!==-1?(this.memoryVectorStore.memoryVectors.splice(r,1),await this.save(),!0):!1}async deleteDocuments(n){console.debug("MemoryVectorStorage::deleteDocuments");const r=new Set(n.map(s=>s.blockId));return this.memoryVectorStore.memoryVectors=this.memoryVectorStore.memoryVectors.filter(s=>!r.has(s.metadata.blockId)),await this.save(),!0}async addVectors(n,r){return console.debug("MemoryVectorStorage::addVectors"),this.memoryVectorStore.addVectors(n,r)}async similaritySearch(n,r=3){return console.debug("MemoryVectorStorage::similaritySearch"),this.memoryVectorStore.similaritySearch(n,r)}async similaritySearchWithScore(n,r=3){return console.debug("MemoryVectorStorage::similaritySearchWithScore"),this.memoryVectorStore.similaritySearchWithScore(n,r)}}class Sx extends Yy{constructor(n,r,s,a){super(n,r,s,a);we(this,"baseUrl",k2)}async embeddingBlocks(){console.debug("MilvusVectorStorage::embeddingBlocks");const n={phone:this.phone},r=await qe.post(`${this.baseUrl}/list`,n);let s=new Map;return r.data.map(a=>{s.set(a.block_id,a.document_id)}),s}async release(){}async save(n){}async load(){}transformDocumentToRequestData(n){return{phone:this.phone,block_id:n.metadata.blockId,document_id:n.metadata.docId,content:n.pageContent,is_summary:n.metadata.isSummary}}async makeRequest(n,r){try{return(await qe.post(`${this.baseUrl}${n}`,r)).status===200}catch(s){return console.error(`API请求失败: ${n}`,s),!1}}async getDocuments(){try{const n=await qe.post(`${this.baseUrl}/list`,{phone:this.phone});return n.status===200?n.data.map(r=>this.transformHitToDocument(r)):[]}catch(n){return console.error("获取文档列表失败:",n),[]}}async addDocuments(n){const r=n.map(this.transformDocumentToRequestData.bind(this));return this.makeRequest("/add",r)}async deleteDocument(n){console.debug("MilvusVectorStorage::deleteDocument");const r=[{phone:this.phone,block_id:n.blockId,document_id:n.docId}];return this.makeRequest("/delete",r)}async deleteDocuments(n){console.debug("MilvusVectorStorage::deleteDocuments",n);const r=n.map(s=>({phone:this.phone,block_id:s.blockId,document_id:s.docId}));return this.makeRequest("/delete",r)}async addVectors(n,r){}transformHitToDocument(n){return new os({pageContent:n.content,metadata:{blockId:n.block_id,docId:n.document_id,isSummary:n.is_summary}})}async similaritySearch(n,r){try{const s=await qe.post(`${this.baseUrl}/search`,{phone:this.phone,query:n,top_k:r});return s.status===200?s.data.map(a=>this.transformHitToDocument(a)):[]}catch(s){return console.error("相似度搜索失败:",s),[]}}async similaritySearchWithScore(n,r){try{const s=await qe.post(`${this.baseUrl}/search`,{phone:this.phone,query:n,top_k:r});return s.status===200?s.data.map(a=>[this.transformHitToDocument(a),a.distance]):[]}catch(s){return console.error("带分数的相似度搜索失败:",s),[]}}}async function Ax(t){let e=new FormData;e.append("file",t,t.name),e.append("purpose","file-extract");const n={Authorization:uf};return(await qe.post(of,e,{headers:n})).data.id}async function Cx(t){const e=of+`/${t}/content`,n={Authorization:uf};return(await qe.get(e,{headers:n})).data.content}async function vx(t){const e=of+`/${t}`,n={Authorization:uf};qe.delete(e,{headers:n})}async function jg(t){const e=await Ax(t);let n=await Cx(e);return vx(e),n}function Hg(t){let e,n=t[7]?"停止生成":"生成中...",r,s,a,i;return{c(){e=F("button"),r=Ye(n),C(e,"type","button"),C(e,"class","generation-text svelte-k9nhz1"),C(e,"aria-label",s=t[7]?"停止生成":"生成中...")},m(o,u){he(o,e,u),k(e,r),a||(i=[ie(e,"mouseenter",t[17]),ie(e,"mouseleave",t[18]),ie(e,"click",t[9]),ie(e,"keydown",t[19])],a=!0)},p(o,u){u&128&&n!==(n=o[7]?"停止生成":"生成中...")&&dt(r,n),u&128&&s!==(s=o[7]?"停止生成":"生成中...")&&C(e,"aria-label",s)},d(o){o&&de(e),a=!1,ct(i)}}}function Ox(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,f,g,b,_,y,E,I,w,O,S,x,D,B,Q,K,ee,L,N=t[6]&&Hg(t);function U(M){t[20](M)}let V={type:"select",key:"modelSelections",fnSize:!1,options:t[5].get("modelSelections").options,style:"margin-right: 6px; font-size: 12px; padding: 2px 4px; border-radius: 4px; border: none ;outline: none; height: 2em; background: transparent; align-self: center;margin-left: auto;"};return t[0]!==void 0&&(V.value=t[0]),B=new As({props:V}),fe.push(()=>Ee(B,"value",U)),B.$on("changed",t[21]),{c(){e=F("div"),n=F("button"),r=dn("svg"),s=dn("path"),a=dn("path"),i=te(),o=F("button"),u=dn("svg"),c=dn("path"),l=te(),d=F("button"),m=dn("svg"),p=dn("path"),f=te(),g=F("button"),b=F("input"),_=te(),y=F("label"),y.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" class="svelte-k9nhz1"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><path d="M13 2v7h7"></path></svg>',E=te(),I=F("button"),w=F("input"),O=te(),S=F("label"),S.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" class="svelte-k9nhz1"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><path d="m21 15-5-5L5 21"></path></svg>',x=te(),N&&N.c(),D=te(),Ve(B.$$.fragment),C(s,"d","M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"),C(a,"d","M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c.26.604.852.997 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1Z"),C(r,"viewBox","0 0 24 24"),C(r,"width","16"),C(r,"height","16"),C(r,"stroke","currentColor"),C(r,"stroke-width","2"),C(r,"fill","none"),C(r,"class","svelte-k9nhz1"),C(n,"title",t[8].settings),C(n,"class","svelte-k9nhz1"),C(c,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"),C(u,"viewBox","0 0 24 24"),C(u,"width","16"),C(u,"height","16"),C(u,"stroke","currentColor"),C(u,"stroke-width","2"),C(u,"fill","none"),C(u,"class","svelte-k9nhz1"),C(o,"title",t[8].onlineSearch),C(o,"class","svelte-k9nhz1"),ke(o,"active",t[1]),C(p,"d","M21 5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5zm-2 14H5V5h14v14zM7 15h10v2H7v-2zm0-4h10v2H7v-2zm0-4h10v2H7V7z"),C(m,"viewBox","0 0 24 24"),C(m,"width","16"),C(m,"height","16"),C(m,"stroke","currentColor"),C(m,"stroke-width","2"),C(m,"fill","none"),C(m,"class","svelte-k9nhz1"),C(d,"title",t[8].knowledgeBase),C(d,"class","svelte-k9nhz1"),ke(d,"active",t[2]),C(b,"type","file"),C(b,"accept",".pdf,.docx,.md,.txt"),Ht(b,"display","none"),C(b,"id","file-upload"),C(y,"for","file-upload"),Ht(y,"cursor","pointer"),C(g,"title",t[8].file),C(g,"class","svelte-k9nhz1"),ke(g,"active",t[4].length>0),C(w,"type","file"),C(w,"accept","image/*"),Ht(w,"display","none"),C(w,"id","image-upload"),C(S,"for","image-upload"),Ht(S,"cursor","pointer"),C(I,"title",t[8].image),C(I,"class","svelte-k9nhz1"),ke(I,"active",t[3].length>0),C(e,"class","tools-container svelte-k9nhz1")},m(M,z){he(M,e,z),k(e,n),k(n,r),k(r,s),k(r,a),k(e,i),k(e,o),k(o,u),k(u,c),k(e,l),k(e,d),k(d,m),k(m,p),k(e,f),k(e,g),k(g,b),k(g,_),k(g,y),k(e,E),k(e,I),k(I,w),k(I,O),k(I,S),k(e,x),N&&N.m(e,null),k(e,D),Be(B,e,null),K=!0,ee||(L=[ie(n,"click",t[13]),ie(o,"click",t[11]),ie(d,"click",t[12]),ie(b,"change",t[10]),ie(w,"change",t[14])],ee=!0)},p(M,[z]){(!K||z&2)&&ke(o,"active",M[1]),(!K||z&4)&&ke(d,"active",M[2]),(!K||z&16)&&ke(g,"active",M[4].length>0),(!K||z&8)&&ke(I,"active",M[3].length>0),M[6]?N?N.p(M,z):(N=Hg(M),N.c(),N.m(e,D)):N&&(N.d(1),N=null);const X={};z&32&&(X.options=M[5].get("modelSelections").options),!Q&&z&1&&(Q=!0,X.value=M[0],ye(()=>Q=!1)),B.$set(X)},i(M){K||(ae(B.$$.fragment,M),K=!0)},o(M){le(B.$$.fragment,M),K=!1},d(M){M&&de(e),N&&N.d(),Fe(B),ee=!1,ct(L)}}}function Ix(t,e,n){let{settingStorage:r}=e,{documentVectorStorage:s}=e,{selectedModel:a}=e,{isSearchEnabled:i}=e,{isKnowledgeEnabled:o}=e,{imageUrl:u=""}=e,{fileContent:c=""}=e,{isInterrupted:l=!1}=e,{isGenerating:d=!1}=e,m=r.i18n,p=!1;function f(){n(15,l=!0)}async function g(D){var B,Q;try{const K=D.target,ee=(B=K.files)==null?void 0:B[0];if(!ee)return;switch((Q=ee.name.split(".").pop())==null?void 0:Q.toLowerCase()){case"txt":case"csv":case"md":const N=new FileReader;N.onload=U=>{var V;(V=U.target)!=null&&V.result&&(n(4,c=U.target.result),console.debug(c))},N.readAsText(ee);break;case"pdf":n(4,c=await jg(ee));break;default:n(4,c=await jg(ee))}K.value=""}catch(K){console.error(m.fileProcessingFailed,K),n(4,c="")}}function b(){n(1,i=!i),r.setValue("isSearchChat",i),r.save()}async function _(){n(2,o=!o),r.setValue("isKnowledgeBaseChat",o),r.save(),o?await s.load():(await s.save(),await s.release())}function y(){const D=new en.Dialog({title:"",content:'<div id="chat-params-panel" style="height: 100%; margin:0px; padding:0px;"></div>',width:"40%",height:"40%",hideCloseIcon:!0});new Ky({target:D.element.querySelector("#chat-params-panel"),props:{settingStorage:r,group:"chat"}})}async function E(D){var K;const Q=(K=D.target.files)==null?void 0:K[0];if(Q)try{const ee=new FileReader;ee.onload=L=>{var N;(N=L.target)!=null&&N.result&&n(3,u=L.target.result)},console.debug(u),ee.readAsDataURL(Q)}catch(ee){console.error(m.imageProcessingFailed,ee)}}const I=()=>n(7,p=!0),w=()=>n(7,p=!1),O=D=>D.key==="Enter"&&f();function S(D){a=D,n(0,a)}const x=({detail:D})=>{r.setValue(D.key,D.value),r.save()};return t.$$set=D=>{"settingStorage"in D&&n(5,r=D.settingStorage),"documentVectorStorage"in D&&n(16,s=D.documentVectorStorage),"selectedModel"in D&&n(0,a=D.selectedModel),"isSearchEnabled"in D&&n(1,i=D.isSearchEnabled),"isKnowledgeEnabled"in D&&n(2,o=D.isKnowledgeEnabled),"imageUrl"in D&&n(3,u=D.imageUrl),"fileContent"in D&&n(4,c=D.fileContent),"isInterrupted"in D&&n(15,l=D.isInterrupted),"isGenerating"in D&&n(6,d=D.isGenerating)},[a,i,o,u,c,r,d,p,m,f,g,b,_,y,E,l,s,I,w,O,S,x]}class kx extends rt{constructor(e){super(),nt(this,e,Ix,Ox,tt,{settingStorage:5,documentVectorStorage:16,selectedModel:0,isSearchEnabled:1,isKnowledgeEnabled:2,imageUrl:3,fileContent:4,isInterrupted:15,isGenerating:6})}}function Nx(t){let e,n,r,s,a,i=[{type:"button"},t[4],{class:r=["b3-button",t[3],t[2]].join(" ")},{style:t[1]}],o={};for(let u=0;u<i.length;u+=1)o=xu(o,i[u]);return{c(){e=F("button"),n=Ye(t[0]),lp(e,o)},m(u,c){he(u,e,c),k(e,n),e.autofocus&&e.focus(),s||(a=ie(e,"click",t[8]),s=!0)},p(u,[c]){c&1&&u2(n,u[0],o.contenteditable),lp(e,o=y2(i,[{type:"button"},c&16&&u[4],c&12&&r!==(r=["b3-button",u[3],u[2]].join(" "))&&{class:r},c&2&&{style:u[1]}]))},i:et,o:et,d(u){u&&de(e),s=!1,a()}}}function Rx(t,e,n){let r,s,a,{text:i=!1}=e,{outline:o=!1}=e,{backgroundColor:u=void 0}=e,{label:c=""}=e;function l(d){h2.call(this,t,d)}return t.$$set=d=>{n(4,e=xu(xu({},e),cp(d))),"text"in d&&n(5,i=d.text),"outline"in d&&n(6,o=d.outline),"backgroundColor"in d&&n(7,u=d.backgroundColor),"label"in d&&n(0,c=d.label)},t.$$.update=()=>{t.$$.dirty&64&&n(3,r=o?"b3-button--outline":""),t.$$.dirty&32&&n(2,s=i?"b3-button--text":""),t.$$.dirty&128&&n(1,a=u?`background-color: ${u}`:"")},e=cp(e),[c,a,s,r,e,i,o,u,l]}class ec extends rt{constructor(e){super(),nt(this,e,Rx,Nx,tt,{text:5,outline:6,backgroundColor:7,label:0})}}function Px(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,f,g,b;function _(w){t[3](w)}let y={type:"textinput",placeholder:"标题",key:"title",style:"width: 100%; margin-bottom: 16px;"};t[1].title!==void 0&&(y.value=t[1].title),s=new As({props:y}),fe.push(()=>Ee(s,"value",_));function E(w){t[4](w)}let I={type:"textarea",placeholder:"内容",key:"content",style:"width: 100%; white-space: pre-wrap; word-wrap: break-word;"};return t[1].content!==void 0&&(I.value=t[1].content),o=new As({props:I}),fe.push(()=>Ee(o,"value",E)),d=new ec({props:{label:"取消",text:!0,outline:!0}}),d.$on("click",t[5]),g=new ec({props:{label:"确认",text:!1,outline:!1}}),g.$on("click",t[6]),{c(){e=F("div"),n=F("div"),r=F("div"),Ve(s.$$.fragment),i=te(),Ve(o.$$.fragment),c=te(),l=F("div"),Ve(d.$$.fragment),m=te(),p=F("div"),f=te(),Ve(g.$$.fragment),C(r,"class","edit-content__body svelte-c66fm5"),C(p,"class","fn__space"),C(l,"class","b3-dialog__action svelte-c66fm5"),C(n,"class","edit-content svelte-c66fm5"),C(e,"class","edit-panel svelte-c66fm5")},m(w,O){he(w,e,O),k(e,n),k(n,r),Be(s,r,null),k(r,i),Be(o,r,null),k(n,c),k(n,l),Be(d,l,null),k(l,m),k(l,p),k(l,f),Be(g,l,null),b=!0},p(w,[O]){const S={};!a&&O&2&&(a=!0,S.value=w[1].title,ye(()=>a=!1)),s.$set(S);const x={};!u&&O&2&&(u=!0,x.value=w[1].content,ye(()=>u=!1)),o.$set(x)},i(w){b||(ae(s.$$.fragment,w),ae(o.$$.fragment,w),ae(d.$$.fragment,w),ae(g.$$.fragment,w),b=!0)},o(w){le(s.$$.fragment,w),le(o.$$.fragment,w),le(d.$$.fragment,w),le(g.$$.fragment,w),b=!1},d(w){w&&de(e),Fe(s),Fe(o),Fe(d),Fe(g)}}}function xx(t,e,n){let{showEditPanel:r=!1}=e,{currentPrompt:s}=e;const a=Wn();function i(l){t.$$.not_equal(s.title,l)&&(s.title=l,n(1,s))}function o(l){t.$$.not_equal(s.content,l)&&(s.content=l,n(1,s))}const u=()=>n(0,r=!1),c=()=>a("save");return t.$$set=l=>{"showEditPanel"in l&&n(0,r=l.showEditPanel),"currentPrompt"in l&&n(1,s=l.currentPrompt)},[r,s,a,i,o,u,c]}class Zy extends rt{constructor(e){super(),nt(this,e,xx,Px,tt,{showEditPanel:0,currentPrompt:1})}}function $g(t,e,n){const r=t.slice();return r[6]=e[n],r}function qg(t,e){let n,r,s,a=e[6].title+"",i,o,u,c,l,d,m,p,f,g,b;function _(){return e[3](e[6])}function y(){return e[4](e[6])}function E(){return e[5](e[6])}return{key:t,first:null,c(){n=F("div"),r=F("div"),s=F("span"),i=Ye(a),o=te(),u=F("div"),c=F("button"),c.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconTrashcan"></use></svg>',l=te(),d=F("button"),d.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconEdit"></use></svg>',m=te(),p=F("button"),p.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconPlay"></use></svg>',f=te(),C(s,"class","title"),C(r,"class","fn__flex-1"),C(c,"class","b3-list-item"),C(c,"title","删除"),C(d,"class","b3-list-item"),C(d,"title","编辑"),C(p,"class","b3-list-item"),C(p,"title","使用"),C(u,"class","fn__flex"),C(n,"class","item-wrap fn__flex b3-label config__item prompt-item svelte-1706rdx"),Ht(n,"height","1.5em"),this.first=n},m(I,w){he(I,n,w),k(n,r),k(r,s),k(s,i),k(n,o),k(n,u),k(u,c),k(u,l),k(u,d),k(u,m),k(u,p),k(n,f),g||(b=[ie(c,"click",_),ie(d,"click",y),ie(p,"click",E)],g=!0)},p(I,w){e=I,w&1&&a!==(a=e[6].title+"")&&dt(i,a)},d(I){I&&de(n),g=!1,ct(b)}}}function Lx(t){let e,n=[],r=new Map,s=Ot(t[0]);const a=i=>i[6].id;for(let i=0;i<s.length;i+=1){let o=$g(t,s,i),u=a(o);r.set(u,n[i]=qg(u,o))}return{c(){e=F("div");for(let i=0;i<n.length;i+=1)n[i].c();C(e,"class","b3-tab-bar b3-list b3-list--background")},m(i,o){he(i,e,o);for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(e,null)},p(i,[o]){o&7&&(s=Ot(i[0]),n=b_(n,o,a,1,i,s,r,e,b2,qg,null,$g))},i:et,o:et,d(i){i&&de(e);for(let o=0;o<n.length;o+=1)n[o].d()}}}function Dx(t,e,n){let{prompts:r}=e,{inputAreaComponent:s}=e;const a=Wn(),i=c=>a("delete",c.id),o=c=>a("edit",c),u=c=>{a("use",c),s.focus()};return t.$$set=c=>{"prompts"in c&&n(0,r=c.prompts),"inputAreaComponent"in c&&n(1,s=c.inputAreaComponent)},[r,s,a,i,o,u]}class Jy extends rt{constructor(e){super(),nt(this,e,Dx,Lx,tt,{prompts:0,inputAreaComponent:1})}}function Vg(t){let e,n,r,s;function a(u){t[16](u)}function i(u){t[17](u)}let o={};return t[1]!==void 0&&(o.showEditPanel=t[1]),t[2]!==void 0&&(o.currentPrompt=t[2]),e=new Zy({props:o}),fe.push(()=>Ee(e,"showEditPanel",a)),fe.push(()=>Ee(e,"currentPrompt",i)),e.$on("save",t[7]),{c(){Ve(e.$$.fragment)},m(u,c){Be(e,u,c),s=!0},p(u,c){const l={};!n&&c&2&&(n=!0,l.showEditPanel=u[1],ye(()=>n=!1)),!r&&c&4&&(r=!0,l.currentPrompt=u[2],ye(()=>r=!1)),e.$set(l)},i(u){s||(ae(e.$$.fragment,u),s=!0)},o(u){le(e.$$.fragment,u),s=!1},d(u){Fe(e,u)}}}function Mx(t){let e,n,r,s,a,i,o,u;s=new Jy({props:{inputAreaComponent:t[0],prompts:t[3]}}),s.$on("edit",t[13]),s.$on("delete",t[14]),s.$on("use",t[15]);let c=t[1]&&Vg(t);return{c(){e=F("div"),n=F("button"),n.innerHTML='<span class="add-icon svelte-19yd9nj">+</span> <span class="btn-text svelte-19yd9nj">新建 Prompt</span>',r=te(),Ve(s.$$.fragment),a=te(),c&&c.c(),C(n,"class","add-prompt-btn svelte-19yd9nj"),C(e,"class","prompts-panel svelte-19yd9nj")},m(l,d){he(l,e,d),k(e,n),k(e,r),Be(s,e,null),k(e,a),c&&c.m(e,null),i=!0,o||(u=ie(n,"click",t[12]),o=!0)},p(l,[d]){const m={};d&1&&(m.inputAreaComponent=l[0]),d&8&&(m.prompts=l[3]),s.$set(m),l[1]?c?(c.p(l,d),d&2&&ae(c,1)):(c=Vg(l),c.c(),ae(c,1),c.m(e,null)):c&&(hr(),le(c,1,1,()=>{c=null}),fr())},i(l){i||(ae(s.$$.fragment,l),ae(c),i=!0)},o(l){le(s.$$.fragment,l),le(c),i=!1},d(l){l&&de(e),Fe(s),c&&c.d(),o=!1,u()}}}function Bx(t,e,n){let r,s,{promptStorage:a}=e,{searchText:i}=e,{inputAreaComponent:o}=e,{isCommand:u}=e,c=!1,l;const d=()=>({id:Date.now(),title:"",content:""}),m=Wn();function p(S){a.deletePrompt(S),n(11,r=a.data)}function f(S){n(2,l=S?{...S}:d()),n(1,c=!0)}function g(S){n(8,i=S.content)}function b(){r.some(x=>x.id===l.id)?a.updatePrompt(l):a.addPrompt(l),n(1,c=!1),n(11,r=a.data)}const _=()=>f(),y=S=>f(S.detail),E=S=>p(S.detail),I=S=>g(S.detail);function w(S){c=S,n(1,c)}function O(S){l=S,n(2,l)}return t.$$set=S=>{"promptStorage"in S&&n(9,a=S.promptStorage),"searchText"in S&&n(8,i=S.searchText),"inputAreaComponent"in S&&n(0,o=S.inputAreaComponent),"isCommand"in S&&n(10,u=S.isCommand)},t.$$.update=()=>{t.$$.dirty&512&&n(11,r=a.data),t.$$.dirty&2304&&n(3,s=i.length>1?r.filter(S=>{const x=i.slice(1).toLowerCase();return S.title.toLowerCase().includes(x)||S.content.toLowerCase().includes(x)}):r),t.$$.dirty&256&&m("searchTextChange",i)},[o,c,l,s,p,f,g,b,i,a,u,r,_,y,E,I,w,O]}class Lf extends rt{constructor(e){super(),nt(this,e,Bx,Mx,tt,{promptStorage:9,searchText:8,inputAreaComponent:0,isCommand:10})}}function Fx(t){let e,n,r,s;return{c(){e=F("div"),n=F("textarea"),C(n,"placeholder","/触发命令，Enter 发送，Shift + Enter 换行"),n.disabled=t[0],C(n,"class","svelte-7ohy60"),C(e,"class","input-container svelte-7ohy60")},m(a,i){he(a,e,i),k(e,n),t[6](n),vt(n,t[1]),r||(s=[ie(n,"input",t[7]),ie(n,"input",t[3]),ie(n,"keydown",t[4])],r=!0)},p(a,[i]){i&1&&(n.disabled=a[0]),i&2&&vt(n,a[1])},i:et,o:et,d(a){a&&de(e),t[6](null),r=!1,ct(s)}}}function Ux(t,e,n){let{promptStorage:r}=e,{isGenerating:s}=e,a="",i;const o=Wn();function u(p){const f=p.target;f.value==="/"&&f.selectionStart===1&&l()}function c(p){p.key==="Enter"&&!p.shiftKey&&!p.isComposing&&(p.preventDefault(),o("sendMessage",a),n(1,a=""))}function l(){const p=new en.Dialog({title:"",content:'<div id="chat-prompts-panel" style="height: 100%; margin:0px; padding:0px;"></div>',width:"40%",hideCloseIcon:!0});new Lf({target:p.element.querySelector("#chat-prompts-panel"),props:{inputAreaComponent:i,promptStorage:r,searchText:a,isCommand:!1}}).$on("searchTextChange",g=>{n(1,a=g.detail),n(2,i.style.height="auto",i),n(2,i.style.height=`${i.scrollHeight}px`,i)})}no(()=>{i.focus()});function d(p){fe[p?"unshift":"push"](()=>{i=p,n(2,i)})}function m(){a=this.value,n(1,a)}return t.$$set=p=>{"promptStorage"in p&&n(5,r=p.promptStorage),"isGenerating"in p&&n(0,s=p.isGenerating)},[s,a,i,u,c,r,d,m]}class jx extends rt{constructor(e){super(),nt(this,e,Ux,Fx,tt,{promptStorage:5,isGenerating:0})}}const Ws="0.32.1";let zg=!1,fi,Xy,bh,Qy,e1,t1;function Hx(t,e={auto:!1}){if(zg)throw new Error(`you must \`import '@anthropic-ai/sdk/shims/${t.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(fi)throw new Error(`can't \`import '@anthropic-ai/sdk/shims/${t.kind}'\` after \`import '@anthropic-ai/sdk/shims/${fi}'\``);zg=e.auto,fi=t.kind,Xy=t.fetch,bh=t.File,Qy=t.ReadableStream,e1=t.getDefaultAgent,t1=t.fileFromPath}let $x=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function qx({manuallyImported:t}={}){const e=t?"You may need to use polyfills":"Add one of these imports before your first `import … from '@anthropic-ai/sdk'`:\n- `import '@anthropic-ai/sdk/shims/node'` (if you're running on Node)\n- `import '@anthropic-ai/sdk/shims/web'` (otherwise)\n";let n,r,s,a;try{n=fetch,r=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:n,Request:r,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new $x(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:i=>!1}}fi||Hx(qx(),{auto:!0});class $e extends Error{}let yn=class _h extends $e{constructor(e,n,r,s){super(`${_h.makeMessage(e,n,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["request-id"],this.error=n}static makeMessage(e,n,r){const s=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,n,r,s){if(!e)return new Zc({message:r,cause:Eh(n)});const a=n;return e===400?new r1(e,a,r,s):e===401?new s1(e,a,r,s):e===403?new a1(e,a,r,s):e===404?new i1(e,a,r,s):e===409?new o1(e,a,r,s):e===422?new u1(e,a,r,s):e===429?new c1(e,a,r,s):e>=500?new l1(e,a,r,s):new _h(e,a,r,s)}},Bn=class extends yn{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},Zc=class extends yn{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,n&&(this.cause=n)}},n1=class extends Zc{constructor({message:e}={}){super({message:e??"Request timed out."})}},r1=class extends yn{constructor(){super(...arguments),this.status=400}},s1=class extends yn{constructor(){super(...arguments),this.status=401}},a1=class extends yn{constructor(){super(...arguments),this.status=403}},i1=class extends yn{constructor(){super(...arguments),this.status=404}},o1=class extends yn{constructor(){super(...arguments),this.status=409}},u1=class extends yn{constructor(){super(...arguments),this.status=422}},c1=class extends yn{constructor(){super(...arguments),this.status=429}},l1=class extends yn{},po=class yh{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let n=this.decodeText(e);if(this.trailingCR&&(n="\r"+n,this.trailingCR=!1),n.endsWith("\r")&&(this.trailingCR=!0,n=n.slice(0,-1)),!n)return[];const r=yh.NEWLINE_CHARS.has(n[n.length-1]||"");let s=n.split(yh.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new $e(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new $e(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new $e("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};po.NEWLINE_CHARS=new Set([`
`,"\r"]);po.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let qi=class Qa{constructor(e,n){this.iterator=e,this.controller=n}static fromSSEResponse(e,n){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const i of Vx(e,n)){if(i.event==="completion")try{yield JSON.parse(i.data)}catch(o){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),o}if(i.event==="message_start"||i.event==="message_delta"||i.event==="message_stop"||i.event==="content_block_start"||i.event==="content_block_delta"||i.event==="content_block_stop")try{yield JSON.parse(i.data)}catch(o){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),o}if(i.event!=="ping"&&i.event==="error")throw yn.generate(void 0,`SSE Error: ${i.data}`,i.data,m1(e.headers))}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||n.abort()}}return new Qa(s,n)}static fromReadableStream(e,n){let r=!1;async function*s(){const i=new po,o=Df(e);for await(const u of o)for(const c of i.decode(u))yield c;for(const u of i.flush())yield u}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||n.abort()}}return new Qa(a,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],r=this.iterator(),s=a=>({next:()=>{if(a.length===0){const i=r.next();e.push(i),n.push(i)}return a.shift()}});return[new Qa(()=>s(e),this.controller),new Qa(()=>s(n),this.controller)]}toReadableStream(){const e=this;let n;const r=new TextEncoder;return new Qy({async start(){n=e[Symbol.asyncIterator]()},async pull(s){try{const{value:a,done:i}=await n.next();if(i)return s.close();const o=r.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){var s;await((s=n.return)==null?void 0:s.call(n))}})}};async function*Vx(t,e){if(!t.body)throw e.abort(),new $e("Attempted to iterate over a response with no body");const n=new Gx,r=new po,s=Df(t.body);for await(const a of zx(s))for(const i of r.decode(a)){const o=n.decode(i);o&&(yield o)}for(const a of r.flush()){const i=n.decode(a);i&&(yield i)}}async function*zx(t){let e=new Uint8Array;for await(const n of t){if(n==null)continue;const r=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let a;for(;(a=Wx(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}function Wx(t){for(let r=0;r<t.length-2;r++){if(t[r]===10&&t[r+1]===10||t[r]===13&&t[r+1]===13)return r+2;if(t[r]===13&&t[r+1]===10&&r+3<t.length&&t[r+2]===13&&t[r+3]===10)return r+4}return-1}let Gx=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,s]=Kx(e,":");return s.startsWith(" ")&&(s=s.substring(1)),n==="event"?this.event=s:n==="data"&&this.data.push(s),null}};function Kx(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}function Df(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Yx=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",Zx=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&Jc(t),Jc=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function";async function Jx(t,e,n){var s;if(t=await t,Zx(t))return t;if(Yx(t)){const a=await t.blob();e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=Jc(a)?[await a.arrayBuffer()]:[a];return new bh(i,e,n)}const r=await Xx(t);if(e||(e=e6(t)??"unknown_file"),!(n!=null&&n.type)){const a=(s=r[0])==null?void 0:s.type;typeof a=="string"&&(n={...n,type:a})}return new bh(r,e,n)}async function Xx(t){var n;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(Jc(t))e.push(await t.arrayBuffer());else if(t6(t))for await(const r of t)e.push(r);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${(n=t==null?void 0:t.constructor)==null?void 0:n.name}; props: ${Qx(t)}`);return e}function Qx(t){return`[${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}function e6(t){var e;return Jl(t.name)||Jl(t.filename)||((e=Jl(t.path))==null?void 0:e.split(/[\\/]/).pop())}const Jl=t=>{if(typeof t=="string")return t;if(typeof Buffer<"u"&&t instanceof Buffer)return String(t)},t6=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",Wg=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody";var n6=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},r6=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},$o;async function d1(t){const{response:e}=t;if(t.options.stream)return ra("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):qi.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const n=e.headers.get("content-type");if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.includes("application/vnd.api+json"))){const a=await e.json();return ra("response",e.status,e.url,e.headers,a),a}const s=await e.text();return ra("response",e.status,e.url,e.headers,s),s}let h1=class f1 extends Promise{constructor(e,n=d1){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=n}_thenUnwrap(e){return new f1(this.responsePromise,async n=>e(await this.parseResponse(n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},s6=class{constructor({baseURL:e,maxRetries:n=2,timeout:r=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=Xl("maxRetries",n),this.timeout=Xl("timeout",r),this.httpAgent=s,this.fetch=a??Xy}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...l6(),...this.authHeaders(e)}}validateHeaders(e,n){}defaultIdempotencyKey(){return`stainless-node-retry-${p6()}`}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,r){return this.request(Promise.resolve(r).then(async s=>{const a=s&&Jc(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:n,...s,body:a}}))}getAPIList(e,n,r){return this.requestAPIList(n,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:n=0}={}){var g;const{method:r,path:s,query:a,headers:i={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:Wg(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,u=this.calculateContentLength(o),c=this.buildURL(s,a);"timeout"in e&&Xl("timeout",e.timeout);const l=e.timeout??this.timeout,d=e.httpAgent??this.httpAgent??e1(c),m=l+1e3;typeof((g=d==null?void 0:d.options)==null?void 0:g.timeout)=="number"&&m>(d.options.timeout??0)&&(d.options.timeout=m),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const p=this.buildHeaders({options:e,headers:i,contentLength:u,retryCount:n});return{req:{method:r,...o&&{body:o},headers:p,...d&&{agent:d},signal:e.signal??null},url:c,timeout:l}}buildHeaders({options:e,headers:n,contentLength:r,retryCount:s}){const a={};r&&(a["content-length"]=r);const i=this.defaultHeaders(e);return Zg(a,i),Zg(a,n),Wg(e.body)&&fi!=="node"&&delete a["content-type"],Jg(i,"x-stainless-retry-count")===void 0&&Jg(n,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(s)),this.validateHeaders(a,n),a}async prepareOptions(e){}async prepareRequest(e,{url:n,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(n=>[...n])):{...e}:{}}makeStatusError(e,n,r,s){return yn.generate(e,n,r,s)}request(e,n=null){return new h1(this.makeRequest(e,n))}async makeRequest(e,n){var d,m;const r=await e,s=r.maxRetries??this.maxRetries;n==null&&(n=s),await this.prepareOptions(r);const{req:a,url:i,timeout:o}=this.buildRequest(r,{retryCount:s-n});if(await this.prepareRequest(a,{url:i,options:r}),ra("request",i,r,a.headers),(d=r.signal)!=null&&d.aborted)throw new Bn;const u=new AbortController,c=await this.fetchWithTimeout(i,a,o,u).catch(Eh);if(c instanceof Error){if((m=r.signal)!=null&&m.aborted)throw new Bn;if(n)return this.retryRequest(r,n);throw c.name==="AbortError"?new n1:new Zc({cause:c})}const l=m1(c.headers);if(!c.ok){if(n&&this.shouldRetry(c)){const y=`retrying, ${n} attempts remaining`;return ra(`response (error; ${y})`,c.status,i,l),this.retryRequest(r,n,l)}const p=await c.text().catch(y=>Eh(y).message),f=d6(p),g=f?void 0:p;throw ra(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,c.status,i,l,g),this.makeStatusError(c.status,f,g,l)}return{response:c,options:r,controller:u}}requestAPIList(e,n){const r=this.makeRequest(n,null);return new i6(this,r,e)}buildURL(e,n){const r=f6(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return tc(s)||(n={...s,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(r.search=this.stringifyQuery(n)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new $e(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,n,r,s){const{signal:a,...i}=n||{};a&&a.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...i}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,r){let s;const a=r==null?void 0:r["retry-after-ms"];if(a){const o=parseFloat(a);Number.isNaN(o)||(s=o)}const i=r==null?void 0:r["retry-after"];if(i&&!s){const o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(n,o)}return await m6(s),this.makeRequest(e,n-1)}calculateDefaultRetryTimeoutMillis(e,n){const a=n-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ws}`}},a6=class{constructor(e,n,r,s){$o.set(this,void 0),n6(this,$o,e,"f"),this.options=s,this.response=n,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new $e("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...this.options};if("params"in e&&typeof n.query=="object")n.query={...n.query,...e.params};else if("url"in e){const r=[...Object.entries(n.query||{}),...e.url.searchParams.entries()];for(const[s,a]of r)e.url.searchParams.set(s,a);n.query=void 0,n.path=e.url.toString()}return await r6(this,$o,"f").requestAPIList(this.constructor,n)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[($o=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const n of e.getPaginatedItems())yield n}},i6=class extends h1{constructor(e,n,r){super(n,async s=>new r(e,s.response,await d1(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const n of e)yield n}};const m1=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,n){const r=n.toString();return e[r.toLowerCase()]||e[r]}}),o6={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},qo=t=>typeof t=="object"&&t!==null&&!tc(t)&&Object.keys(t).every(e=>p1(o6,e)),u6=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ws,"X-Stainless-OS":Kg(Deno.build.os),"X-Stainless-Arch":Gg(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ws,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ws,"X-Stainless-OS":Kg(process.platform),"X-Stainless-Arch":Gg(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=c6();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ws,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ws,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function c6(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const r=n.exec(navigator.userAgent);if(r){const s=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}const Gg=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",Kg=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let Yg;const l6=()=>Yg??(Yg=u6()),d6=t=>{try{return JSON.parse(t)}catch{return}},h6=new RegExp("^(?:[a-z]+:)?//","i"),f6=t=>h6.test(t),m6=t=>new Promise(e=>setTimeout(e,t)),Xl=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new $e(`${t} must be an integer`);if(e<0)throw new $e(`${t} must be a positive integer`);return e},Eh=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch{}return new Error(String(t))},Ql=t=>{var e,n,r,s,a;if(typeof process<"u")return((n=(e=process.env)==null?void 0:e[t])==null?void 0:n.trim())??void 0;if(typeof Deno<"u")return(a=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,t))==null?void 0:a.trim()};function tc(t){if(!t)return!0;for(const e in t)return!1;return!0}function p1(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Zg(t,e){for(const n in e){if(!p1(e,n))continue;const r=n.toLowerCase();if(!r)continue;const s=e[n];s===null?delete t[r]:s!==void 0&&(t[r]=s)}}function ra(t,...e){var n;typeof process<"u"&&((n=process==null?void 0:process.env)==null?void 0:n.DEBUG)==="true"&&console.log(`Anthropic:DEBUG:${t}`,...e)}const p6=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),g6=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",b6=t=>typeof(t==null?void 0:t.get)=="function",Jg=(t,e)=>{var r;const n=e.toLowerCase();if(b6(t)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,i,o)=>i+o.toUpperCase());for(const a of[e,n,e.toUpperCase(),s]){const i=t.get(a);if(i)return i}}for(const[s,a]of Object.entries(t))if(s.toLowerCase()===n)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a};let _6=class extends a6{constructor(e,n,r,s){super(e,n,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.first_id=r.first_id||null,this.last_id=r.last_id||null}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const n=Object.fromEntries(e.url.searchParams);return Object.keys(n).length?n:null}nextPageInfo(){var n;if((n=this.options.query)!=null&&n.before_id){const r=this.first_id;return r?{params:{before_id:r}}:null}const e=this.last_id;return e?{params:{after_id:e}}:null}},Rs=class{constructor(e){this._client=e}};class Mf{constructor(e,n){this.iterator=e,this.controller=n}async*decoder(){const e=new po;for await(const n of this.iterator)for(const r of e.decode(n))yield JSON.parse(r);for(const n of e.flush())yield JSON.parse(n)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,n){if(!e.body)throw n.abort(),new $e("Attempted to iterate over a response with no body");return new Mf(Df(e.body),n)}}let Bf=class extends Rs{create(e,n){const{betas:r,...s}=e;return this._client.post("/v1/messages/batches?beta=true",{body:s,...n,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...n==null?void 0:n.headers}})}retrieve(e,n={},r){if(qo(n))return this.retrieve(e,{},n);const{betas:s}=n;return this._client.get(`/v1/messages/batches/${e}?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}list(e={},n){if(qo(e))return this.list({},e);const{betas:r,...s}=e;return this._client.getAPIList("/v1/messages/batches?beta=true",Ff,{query:s,...n,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...n==null?void 0:n.headers}})}cancel(e,n={},r){if(qo(n))return this.cancel(e,{},n);const{betas:s}=n;return this._client.post(`/v1/messages/batches/${e}/cancel?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}async results(e,n={},r){if(qo(n))return this.results(e,{},n);const s=await this.retrieve(e);if(!s.results_url)throw new $e(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);const{betas:a}=n;return this._client.get(s.results_url,{...r,headers:{"anthropic-beta":[...a??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers},__binaryResponse:!0})._thenUnwrap((i,o)=>Mf.fromResponse(o.response,o.controller))}};class Ff extends _6{}Bf.BetaMessageBatchesPage=Ff;let Xc=class extends Rs{constructor(){super(...arguments),this.batches=new Bf(this._client)}create(e,n){const{betas:r,...s}=e;return this._client.post("/v1/messages?beta=true",{body:s,timeout:this._client._options.timeout??6e5,...n,headers:{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0,...n==null?void 0:n.headers},stream:e.stream??!1})}countTokens(e,n){const{betas:r,...s}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:s,...n,headers:{"anthropic-beta":[...r??[],"token-counting-2024-11-01"].toString(),...n==null?void 0:n.headers}})}};Xc.Batches=Bf;Xc.BetaMessageBatchesPage=Ff;const y6=t=>{let e=0,n=[];for(;e<t.length;){let r=t[e];if(r==="\\"){e++;continue}if(r==="{"){n.push({type:"brace",value:"{"}),e++;continue}if(r==="}"){n.push({type:"brace",value:"}"}),e++;continue}if(r==="["){n.push({type:"paren",value:"["}),e++;continue}if(r==="]"){n.push({type:"paren",value:"]"}),e++;continue}if(r===":"){n.push({type:"separator",value:":"}),e++;continue}if(r===","){n.push({type:"delimiter",value:","}),e++;continue}if(r==='"'){let o="",u=!1;for(r=t[++e];r!=='"';){if(e===t.length){u=!0;break}if(r==="\\"){if(e++,e===t.length){u=!0;break}o+=r+t[e],r=t[++e]}else o+=r,r=t[++e]}r=t[++e],u||n.push({type:"string",value:o});continue}if(r&&/\s/.test(r)){e++;continue}let a=/[0-9]/;if(r&&a.test(r)||r==="-"||r==="."){let o="";for(r==="-"&&(o+=r,r=t[++e]);r&&a.test(r)||r===".";)o+=r,r=t[++e];n.push({type:"number",value:o});continue}let i=/[a-z]/i;if(r&&i.test(r)){let o="";for(;r&&i.test(r)&&e!==t.length;)o+=r,r=t[++e];if(o=="true"||o=="false"||o==="null")n.push({type:"name",value:o});else{e++;continue}continue}e++}return n},Gs=t=>{if(t.length===0)return t;let e=t[t.length-1];switch(e.type){case"separator":return t=t.slice(0,t.length-1),Gs(t);case"number":let n=e.value[e.value.length-1];if(n==="."||n==="-")return t=t.slice(0,t.length-1),Gs(t);case"string":let r=t[t.length-2];if((r==null?void 0:r.type)==="delimiter")return t=t.slice(0,t.length-1),Gs(t);if((r==null?void 0:r.type)==="brace"&&r.value==="{")return t=t.slice(0,t.length-1),Gs(t);break;case"delimiter":return t=t.slice(0,t.length-1),Gs(t)}return t},E6=t=>{let e=[];return t.map(n=>{n.type==="brace"&&(n.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),n.type==="paren"&&(n.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(n=>{n==="}"?t.push({type:"brace",value:"}"}):n==="]"&&t.push({type:"paren",value:"]"})}),t},w6=t=>{let e="";return t.map(n=>{switch(n.type){case"string":e+='"'+n.value+'"';break;default:e+=n.value;break}}),e},g1=t=>JSON.parse(w6(E6(Gs(y6(t)))));var Wt=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},xe=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},En,Dr,Vo,zo,Fa,Ua,Wo,ja,_r,Ha,Go,Ko,Fs,ed,Xg,td,nd,rd,sd,Qg;const e0="__json_buf";class nc{constructor(){En.add(this),this.messages=[],this.receivedMessages=[],Dr.set(this,void 0),this.controller=new AbortController,Vo.set(this,void 0),zo.set(this,()=>{}),Fa.set(this,()=>{}),Ua.set(this,void 0),Wo.set(this,()=>{}),ja.set(this,()=>{}),_r.set(this,{}),Ha.set(this,!1),Go.set(this,!1),Ko.set(this,!1),Fs.set(this,!1),td.set(this,e=>{if(Wt(this,Go,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Bn),e instanceof Bn)return Wt(this,Ko,!0,"f"),this._emit("abort",e);if(e instanceof $e)return this._emit("error",e);if(e instanceof Error){const n=new $e(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new $e(String(e)))}),Wt(this,Vo,new Promise((e,n)=>{Wt(this,zo,e,"f"),Wt(this,Fa,n,"f")}),"f"),Wt(this,Ua,new Promise((e,n)=>{Wt(this,Wo,e,"f"),Wt(this,ja,n,"f")}),"f"),xe(this,Vo,"f").catch(()=>{}),xe(this,Ua,"f").catch(()=>{})}static fromReadableStream(e){const n=new nc;return n._run(()=>n._fromReadableStream(e)),n}static createMessage(e,n,r){const s=new nc;for(const a of n.messages)s._addPromptCachingBetaMessageParam(a);return s._run(()=>s._createPromptCachingBetaMessage(e,{...n,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},xe(this,td,"f"))}_addPromptCachingBetaMessageParam(e){this.messages.push(e)}_addPromptCachingBetaMessage(e,n=!0){this.receivedMessages.push(e),n&&this._emit("message",e)}async _createPromptCachingBetaMessage(e,n,r){var i;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),xe(this,En,"m",nd).call(this);const a=await e.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of a)xe(this,En,"m",rd).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new Bn;xe(this,En,"m",sd).call(this)}_connected(){this.ended||(xe(this,zo,"f").call(this),this._emit("connect"))}get ended(){return xe(this,Ha,"f")}get errored(){return xe(this,Go,"f")}get aborted(){return xe(this,Ko,"f")}abort(){this.controller.abort()}on(e,n){return(xe(this,_r,"f")[e]||(xe(this,_r,"f")[e]=[])).push({listener:n}),this}off(e,n){const r=xe(this,_r,"f")[e];if(!r)return this;const s=r.findIndex(a=>a.listener===n);return s>=0&&r.splice(s,1),this}once(e,n){return(xe(this,_r,"f")[e]||(xe(this,_r,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,r)=>{Wt(this,Fs,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,n)})}async done(){Wt(this,Fs,!0,"f"),await xe(this,Ua,"f")}get currentMessage(){return xe(this,Dr,"f")}async finalMessage(){return await this.done(),xe(this,En,"m",ed).call(this)}async finalText(){return await this.done(),xe(this,En,"m",Xg).call(this)}_emit(e,...n){if(xe(this,Ha,"f"))return;e==="end"&&(Wt(this,Ha,!0,"f"),xe(this,Wo,"f").call(this));const r=xe(this,_r,"f")[e];if(r&&(xe(this,_r,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...n))),e==="abort"){const s=n[0];!xe(this,Fs,"f")&&!(r!=null&&r.length)&&Promise.reject(s),xe(this,Fa,"f").call(this,s),xe(this,ja,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=n[0];!xe(this,Fs,"f")&&!(r!=null&&r.length)&&Promise.reject(s),xe(this,Fa,"f").call(this,s),xe(this,ja,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalPromptCachingBetaMessage",xe(this,En,"m",ed).call(this))}async _fromReadableStream(e,n){var a;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),xe(this,En,"m",nd).call(this),this._connected();const s=qi.fromReadableStream(e,this.controller);for await(const i of s)xe(this,En,"m",rd).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new Bn;xe(this,En,"m",sd).call(this)}[(Dr=new WeakMap,Vo=new WeakMap,zo=new WeakMap,Fa=new WeakMap,Ua=new WeakMap,Wo=new WeakMap,ja=new WeakMap,_r=new WeakMap,Ha=new WeakMap,Go=new WeakMap,Ko=new WeakMap,Fs=new WeakMap,td=new WeakMap,En=new WeakSet,ed=function(){if(this.receivedMessages.length===0)throw new $e("stream ended without producing a PromptCachingBetaMessage with role=assistant");return this.receivedMessages.at(-1)},Xg=function(){if(this.receivedMessages.length===0)throw new $e("stream ended without producing a PromptCachingBetaMessage with role=assistant");const n=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(n.length===0)throw new $e("stream ended without producing a content block with type=text");return n.join(" ")},nd=function(){this.ended||Wt(this,Dr,void 0,"f")},rd=function(n){if(this.ended)return;const r=xe(this,En,"m",Qg).call(this,n);switch(this._emit("streamEvent",n,r),n.type){case"content_block_delta":{const s=r.content.at(-1);n.delta.type==="text_delta"&&s.type==="text"?this._emit("text",n.delta.text,s.text||""):n.delta.type==="input_json_delta"&&s.type==="tool_use"&&s.input&&this._emit("inputJson",n.delta.partial_json,s.input);break}case"message_stop":{this._addPromptCachingBetaMessageParam(r),this._addPromptCachingBetaMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{Wt(this,Dr,r,"f");break}}},sd=function(){if(this.ended)throw new $e("stream has ended, this shouldn't happen");const n=xe(this,Dr,"f");if(!n)throw new $e("request ended without sending any chunks");return Wt(this,Dr,void 0,"f"),n},Qg=function(n){let r=xe(this,Dr,"f");if(n.type==="message_start"){if(r)throw new $e(`Unexpected event order, got ${n.type} before receiving "message_stop"`);return n.message}if(!r)throw new $e(`Unexpected event order, got ${n.type} before "message_start"`);switch(n.type){case"message_stop":return r;case"message_delta":return r.stop_reason=n.delta.stop_reason,r.stop_sequence=n.delta.stop_sequence,r.usage.output_tokens=n.usage.output_tokens,r;case"content_block_start":return r.content.push(n.content_block),r;case"content_block_delta":{const s=r.content.at(n.index);if((s==null?void 0:s.type)==="text"&&n.delta.type==="text_delta")s.text+=n.delta.text;else if((s==null?void 0:s.type)==="tool_use"&&n.delta.type==="input_json_delta"){let a=s[e0]||"";a+=n.delta.partial_json,Object.defineProperty(s,e0,{value:a,enumerable:!1,writable:!0}),a&&(s.input=g1(a))}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("streamEvent",s=>{const a=n.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>n.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new qi(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}let b1=class extends Rs{create(e,n){const{betas:r,...s}=e;return this._client.post("/v1/messages?beta=prompt_caching",{body:s,timeout:this._client._options.timeout??6e5,...n,headers:{"anthropic-beta":[...r??[],"prompt-caching-2024-07-31"].toString(),...n==null?void 0:n.headers},stream:e.stream??!1})}stream(e,n){return nc.createMessage(this,e,n)}};class Uf extends Rs{constructor(){super(...arguments),this.messages=new b1(this._client)}}Uf.Messages=b1;let Qc=class extends Rs{constructor(){super(...arguments),this.messages=new Xc(this._client),this.promptCaching=new Uf(this._client)}};Qc.Messages=Xc;Qc.PromptCaching=Uf;let _1=class extends Rs{create(e,n){return this._client.post("/v1/complete",{body:e,timeout:this._client._options.timeout??6e5,...n,stream:e.stream??!1})}};var Gt=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},Le=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},wn,Mr,Yo,Zo,$a,qa,Jo,Va,yr,za,Xo,Qo,Us,ad,t0,id,od,ud,cd,n0;const r0="__json_buf";class rc{constructor(){wn.add(this),this.messages=[],this.receivedMessages=[],Mr.set(this,void 0),this.controller=new AbortController,Yo.set(this,void 0),Zo.set(this,()=>{}),$a.set(this,()=>{}),qa.set(this,void 0),Jo.set(this,()=>{}),Va.set(this,()=>{}),yr.set(this,{}),za.set(this,!1),Xo.set(this,!1),Qo.set(this,!1),Us.set(this,!1),id.set(this,e=>{if(Gt(this,Xo,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Bn),e instanceof Bn)return Gt(this,Qo,!0,"f"),this._emit("abort",e);if(e instanceof $e)return this._emit("error",e);if(e instanceof Error){const n=new $e(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new $e(String(e)))}),Gt(this,Yo,new Promise((e,n)=>{Gt(this,Zo,e,"f"),Gt(this,$a,n,"f")}),"f"),Gt(this,qa,new Promise((e,n)=>{Gt(this,Jo,e,"f"),Gt(this,Va,n,"f")}),"f"),Le(this,Yo,"f").catch(()=>{}),Le(this,qa,"f").catch(()=>{})}static fromReadableStream(e){const n=new rc;return n._run(()=>n._fromReadableStream(e)),n}static createMessage(e,n,r){const s=new rc;for(const a of n.messages)s._addMessageParam(a);return s._run(()=>s._createMessage(e,{...n,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},Le(this,id,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,n=!0){this.receivedMessages.push(e),n&&this._emit("message",e)}async _createMessage(e,n,r){var i;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Le(this,wn,"m",od).call(this);const a=await e.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of a)Le(this,wn,"m",ud).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new Bn;Le(this,wn,"m",cd).call(this)}_connected(){this.ended||(Le(this,Zo,"f").call(this),this._emit("connect"))}get ended(){return Le(this,za,"f")}get errored(){return Le(this,Xo,"f")}get aborted(){return Le(this,Qo,"f")}abort(){this.controller.abort()}on(e,n){return(Le(this,yr,"f")[e]||(Le(this,yr,"f")[e]=[])).push({listener:n}),this}off(e,n){const r=Le(this,yr,"f")[e];if(!r)return this;const s=r.findIndex(a=>a.listener===n);return s>=0&&r.splice(s,1),this}once(e,n){return(Le(this,yr,"f")[e]||(Le(this,yr,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,r)=>{Gt(this,Us,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,n)})}async done(){Gt(this,Us,!0,"f"),await Le(this,qa,"f")}get currentMessage(){return Le(this,Mr,"f")}async finalMessage(){return await this.done(),Le(this,wn,"m",ad).call(this)}async finalText(){return await this.done(),Le(this,wn,"m",t0).call(this)}_emit(e,...n){if(Le(this,za,"f"))return;e==="end"&&(Gt(this,za,!0,"f"),Le(this,Jo,"f").call(this));const r=Le(this,yr,"f")[e];if(r&&(Le(this,yr,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...n))),e==="abort"){const s=n[0];!Le(this,Us,"f")&&!(r!=null&&r.length)&&Promise.reject(s),Le(this,$a,"f").call(this,s),Le(this,Va,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=n[0];!Le(this,Us,"f")&&!(r!=null&&r.length)&&Promise.reject(s),Le(this,$a,"f").call(this,s),Le(this,Va,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",Le(this,wn,"m",ad).call(this))}async _fromReadableStream(e,n){var a;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Le(this,wn,"m",od).call(this),this._connected();const s=qi.fromReadableStream(e,this.controller);for await(const i of s)Le(this,wn,"m",ud).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new Bn;Le(this,wn,"m",cd).call(this)}[(Mr=new WeakMap,Yo=new WeakMap,Zo=new WeakMap,$a=new WeakMap,qa=new WeakMap,Jo=new WeakMap,Va=new WeakMap,yr=new WeakMap,za=new WeakMap,Xo=new WeakMap,Qo=new WeakMap,Us=new WeakMap,id=new WeakMap,wn=new WeakSet,ad=function(){if(this.receivedMessages.length===0)throw new $e("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},t0=function(){if(this.receivedMessages.length===0)throw new $e("stream ended without producing a Message with role=assistant");const n=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(n.length===0)throw new $e("stream ended without producing a content block with type=text");return n.join(" ")},od=function(){this.ended||Gt(this,Mr,void 0,"f")},ud=function(n){if(this.ended)return;const r=Le(this,wn,"m",n0).call(this,n);switch(this._emit("streamEvent",n,r),n.type){case"content_block_delta":{const s=r.content.at(-1);n.delta.type==="text_delta"&&s.type==="text"?this._emit("text",n.delta.text,s.text||""):n.delta.type==="input_json_delta"&&s.type==="tool_use"&&s.input&&this._emit("inputJson",n.delta.partial_json,s.input);break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{Gt(this,Mr,r,"f");break}}},cd=function(){if(this.ended)throw new $e("stream has ended, this shouldn't happen");const n=Le(this,Mr,"f");if(!n)throw new $e("request ended without sending any chunks");return Gt(this,Mr,void 0,"f"),n},n0=function(n){let r=Le(this,Mr,"f");if(n.type==="message_start"){if(r)throw new $e(`Unexpected event order, got ${n.type} before receiving "message_stop"`);return n.message}if(!r)throw new $e(`Unexpected event order, got ${n.type} before "message_start"`);switch(n.type){case"message_stop":return r;case"message_delta":return r.stop_reason=n.delta.stop_reason,r.stop_sequence=n.delta.stop_sequence,r.usage.output_tokens=n.usage.output_tokens,r;case"content_block_start":return r.content.push(n.content_block),r;case"content_block_delta":{const s=r.content.at(n.index);if((s==null?void 0:s.type)==="text"&&n.delta.type==="text_delta")s.text+=n.delta.text;else if((s==null?void 0:s.type)==="tool_use"&&n.delta.type==="input_json_delta"){let a=s[r0]||"";a+=n.delta.partial_json,Object.defineProperty(s,r0,{value:a,enumerable:!1,writable:!0}),a&&(s.input=g1(a))}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("streamEvent",s=>{const a=n.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>n.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new qi(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}let y1=class extends Rs{create(e,n){return e.model in s0&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${s0[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages",{body:e,timeout:this._client._options.timeout??6e5,...n,stream:e.stream??!1})}stream(e,n){return rc.createMessage(this,e,n)}};const s0={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024"};var E1;class at extends s6{constructor({baseURL:e=Ql("ANTHROPIC_BASE_URL"),apiKey:n=Ql("ANTHROPIC_API_KEY")??null,authToken:r=Ql("ANTHROPIC_AUTH_TOKEN")??null,...s}={}){const a={apiKey:n,authToken:r,...s,baseURL:e||"https://api.anthropic.com"};if(!a.dangerouslyAllowBrowser&&g6())throw new $e(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });

TODO: link!
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new _1(this),this.messages=new y1(this),this.beta=new Qc(this),this._options=a,this.apiKey=n,this.authToken=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(e,n){if(!(this.apiKey&&e["x-api-key"])&&n["x-api-key"]!==null&&!(this.authToken&&e.authorization)&&n.authorization!==null)throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){const n=this.apiKeyAuth(e),r=this.bearerAuth(e);return n!=null&&!tc(n)?n:r!=null&&!tc(r)?r:{}}apiKeyAuth(e){return this.apiKey==null?{}:{"X-Api-Key":this.apiKey}}bearerAuth(e){return this.authToken==null?{}:{Authorization:`Bearer ${this.authToken}`}}}E1=at;at.Anthropic=E1;at.HUMAN_PROMPT=`

Human:`;at.AI_PROMPT=`

Assistant:`;at.DEFAULT_TIMEOUT=6e5;at.AnthropicError=$e;at.APIError=yn;at.APIConnectionError=Zc;at.APIConnectionTimeoutError=n1;at.APIUserAbortError=Bn;at.NotFoundError=i1;at.ConflictError=o1;at.RateLimitError=c1;at.BadRequestError=r1;at.AuthenticationError=s1;at.InternalServerError=l1;at.PermissionDeniedError=a1;at.UnprocessableEntityError=u1;at.toFile=Jx;at.fileFromPath=t1;at.Completions=_1;at.Messages=y1;at.Beta=Qc;/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var T6=typeof window=="object"?window:{},Ie="0123456789abcdef".split(""),S6=[-2147483648,8388608,32768,128],Rn=[24,16,8,0],wt=[];function Vn(t){t?(wt[0]=wt[16]=wt[1]=wt[2]=wt[3]=wt[4]=wt[5]=wt[6]=wt[7]=wt[8]=wt[9]=wt[10]=wt[11]=wt[12]=wt[13]=wt[14]=wt[15]=0,this.blocks=wt):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Vn.prototype.update=function(t){if(!this.finalized){var e=typeof t!="string";e&&t.constructor===T6.ArrayBuffer&&(t=new Uint8Array(t));for(var n,r=0,s,a=t.length||0,i=this.blocks;r<a;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),e)for(s=this.start;r<a&&s<64;++r)i[s>>2]|=t[r]<<Rn[s++&3];else for(s=this.start;r<a&&s<64;++r)n=t.charCodeAt(r),n<128?i[s>>2]|=n<<Rn[s++&3]:n<2048?(i[s>>2]|=(192|n>>6)<<Rn[s++&3],i[s>>2]|=(128|n&63)<<Rn[s++&3]):n<55296||n>=57344?(i[s>>2]|=(224|n>>12)<<Rn[s++&3],i[s>>2]|=(128|n>>6&63)<<Rn[s++&3],i[s>>2]|=(128|n&63)<<Rn[s++&3]):(n=65536+((n&1023)<<10|t.charCodeAt(++r)&1023),i[s>>2]|=(240|n>>18)<<Rn[s++&3],i[s>>2]|=(128|n>>12&63)<<Rn[s++&3],i[s>>2]|=(128|n>>6&63)<<Rn[s++&3],i[s>>2]|=(128|n&63)<<Rn[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=i[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Vn.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[16]=this.block,t[e>>2]|=S6[e&3],this.block=t[16],e>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}};Vn.prototype.hash=function(){var t=this.h0,e=this.h1,n=this.h2,r=this.h3,s=this.h4,a,i,o,u=this.blocks;for(i=16;i<80;++i)o=u[i-3]^u[i-8]^u[i-14]^u[i-16],u[i]=o<<1|o>>>31;for(i=0;i<20;i+=5)a=e&n|~e&r,o=t<<5|t>>>27,s=o+a+s+1518500249+u[i]<<0,e=e<<30|e>>>2,a=t&e|~t&n,o=s<<5|s>>>27,r=o+a+r+1518500249+u[i+1]<<0,t=t<<30|t>>>2,a=s&t|~s&e,o=r<<5|r>>>27,n=o+a+n+1518500249+u[i+2]<<0,s=s<<30|s>>>2,a=r&s|~r&t,o=n<<5|n>>>27,e=o+a+e+1518500249+u[i+3]<<0,r=r<<30|r>>>2,a=n&r|~n&s,o=e<<5|e>>>27,t=o+a+t+1518500249+u[i+4]<<0,n=n<<30|n>>>2;for(;i<40;i+=5)a=e^n^r,o=t<<5|t>>>27,s=o+a+s+1859775393+u[i]<<0,e=e<<30|e>>>2,a=t^e^n,o=s<<5|s>>>27,r=o+a+r+1859775393+u[i+1]<<0,t=t<<30|t>>>2,a=s^t^e,o=r<<5|r>>>27,n=o+a+n+1859775393+u[i+2]<<0,s=s<<30|s>>>2,a=r^s^t,o=n<<5|n>>>27,e=o+a+e+1859775393+u[i+3]<<0,r=r<<30|r>>>2,a=n^r^s,o=e<<5|e>>>27,t=o+a+t+1859775393+u[i+4]<<0,n=n<<30|n>>>2;for(;i<60;i+=5)a=e&n|e&r|n&r,o=t<<5|t>>>27,s=o+a+s-1894007588+u[i]<<0,e=e<<30|e>>>2,a=t&e|t&n|e&n,o=s<<5|s>>>27,r=o+a+r-1894007588+u[i+1]<<0,t=t<<30|t>>>2,a=s&t|s&e|t&e,o=r<<5|r>>>27,n=o+a+n-1894007588+u[i+2]<<0,s=s<<30|s>>>2,a=r&s|r&t|s&t,o=n<<5|n>>>27,e=o+a+e-1894007588+u[i+3]<<0,r=r<<30|r>>>2,a=n&r|n&s|r&s,o=e<<5|e>>>27,t=o+a+t-1894007588+u[i+4]<<0,n=n<<30|n>>>2;for(;i<80;i+=5)a=e^n^r,o=t<<5|t>>>27,s=o+a+s-899497514+u[i]<<0,e=e<<30|e>>>2,a=t^e^n,o=s<<5|s>>>27,r=o+a+r-899497514+u[i+1]<<0,t=t<<30|t>>>2,a=s^t^e,o=r<<5|r>>>27,n=o+a+n-899497514+u[i+2]<<0,s=s<<30|s>>>2,a=r^s^t,o=n<<5|n>>>27,e=o+a+e-899497514+u[i+3]<<0,r=r<<30|r>>>2,a=n^r^s,o=e<<5|e>>>27,t=o+a+t-899497514+u[i+4]<<0,n=n<<30|n>>>2;this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+n<<0,this.h3=this.h3+r<<0,this.h4=this.h4+s<<0};Vn.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,r=this.h3,s=this.h4;return Ie[t>>28&15]+Ie[t>>24&15]+Ie[t>>20&15]+Ie[t>>16&15]+Ie[t>>12&15]+Ie[t>>8&15]+Ie[t>>4&15]+Ie[t&15]+Ie[e>>28&15]+Ie[e>>24&15]+Ie[e>>20&15]+Ie[e>>16&15]+Ie[e>>12&15]+Ie[e>>8&15]+Ie[e>>4&15]+Ie[e&15]+Ie[n>>28&15]+Ie[n>>24&15]+Ie[n>>20&15]+Ie[n>>16&15]+Ie[n>>12&15]+Ie[n>>8&15]+Ie[n>>4&15]+Ie[n&15]+Ie[r>>28&15]+Ie[r>>24&15]+Ie[r>>20&15]+Ie[r>>16&15]+Ie[r>>12&15]+Ie[r>>8&15]+Ie[r>>4&15]+Ie[r&15]+Ie[s>>28&15]+Ie[s>>24&15]+Ie[s>>20&15]+Ie[s>>16&15]+Ie[s>>12&15]+Ie[s>>8&15]+Ie[s>>4&15]+Ie[s&15]};Vn.prototype.toString=Vn.prototype.hex;Vn.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,r=this.h3,s=this.h4;return[t>>24&255,t>>16&255,t>>8&255,t&255,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24&255,n>>16&255,n>>8&255,n&255,r>>24&255,r>>16&255,r>>8&255,r&255,s>>24&255,s>>16&255,s>>8&255,s&255]};Vn.prototype.array=Vn.prototype.digest;Vn.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(20),e=new DataView(t);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),t};const A6=t=>new Vn(!0).update(t).hex(),a0=(...t)=>A6(t.join("_"));class C6{}const v6=new Map;class jf extends C6{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,n){return Promise.resolve(this.cache.get(a0(e,n))??null)}async update(e,n,r){this.cache.set(a0(e,n),r)}static global(){return new jf(v6)}}class w1 extends Kr{}class O6 extends w1{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new cr(this.value)]}}class I6 extends w1{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return oy(this.messages)}toChatMessages(){return this.messages}}const k6=t=>t.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":t.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":t.startsWith("gpt-4-32k")?"gpt-4-32k":t.startsWith("gpt-4-")?"gpt-4":t.startsWith("gpt-4o")?"gpt-4o":t;function T1(t){return typeof t!="object"||!t?!1:!!("type"in t&&t.type==="function"&&"function"in t&&typeof t.function=="object"&&t.function&&"name"in t.function&&"parameters"in t.function)}const N6=()=>!1;class S1 extends mt{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??N6(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class R6 extends S1{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:n,...r}){const{cache:s,...a}=r;super({callbacks:e??n,...a}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof s=="object"?this.cache=s:s?this.cache=jf.global():this.cache=void 0,this.caller=new vf(r??{})}async getNumTokens(e){if(typeof e!="string")return 0;let n=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await sP("modelName"in this?k6(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{n=this._encoding.encode(e).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return n}static _convertInputToPromptValue(e){return typeof e=="string"?new O6(e):Array.isArray(e)?new I6(e.map(Xa)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...n}){const r={...this._identifyingParams(),...n,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([i,o])=>o!==void 0).map(([i,o])=>`${i}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class fa extends mt{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,n){const r=He(n);return this.func&&await this.func(e,r),this._callWithConfig(s=>Promise.resolve(s),e,r)}async*transform(e,n){const r=He(n);let s,a=!0;for await(const i of this._transformStreamWithConfig(e,o=>o,r))if(yield i,a)if(s===void 0)s=i;else try{s=$n(s,i)}catch{s=void 0,a=!1}this.func&&s!==void 0&&await this.func(s,r)}static assign(e){return new _y(new Aa({steps:e}))}}function Hf(t){return typeof(t==null?void 0:t.parse)=="function"}class vr extends R6{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[n,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=n.signal,[n,r]}async invoke(e,n){const r=vr._convertInputToPromptValue(e);return(await this.generatePrompt([r],n,n==null?void 0:n.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,n,r){throw new Error("Not implemented.")}async*_streamIterator(e,n){var r;if(this._streamResponseChunks===vr.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,n);else{const a=vr._convertInputToPromptValue(e).toChatMessages(),[i,o]=this._separateRunnableConfigFromCallOptionsCompat(n),u={...i.metadata,...this.getLsParams(o)},c=await Mt.configure(i.callbacks,this.callbacks,i.tags,this.tags,u,this.metadata,{verbose:this.verbose}),l={options:o,invocation_params:this==null?void 0:this.invocationParams(o),batch_size:1},d=await(c==null?void 0:c.handleChatModelStart(this.toJSON(),[a],i.runId,void 0,l,void 0,void 0,i.runName));let m,p;try{for await(const f of this._streamResponseChunks(a,o,d==null?void 0:d[0])){if(f.message.id==null){const g=(r=d==null?void 0:d.at(0))==null?void 0:r.runId;g!=null&&f.message._updateId(`run-${g}`)}f.message.response_metadata={...f.generationInfo,...f.message.response_metadata},yield f.message,m?m=m.concat(f):m=f,Jp(f.message)&&f.message.usage_metadata!==void 0&&(p={tokenUsage:{promptTokens:f.message.usage_metadata.input_tokens,completionTokens:f.message.usage_metadata.output_tokens,totalTokens:f.message.usage_metadata.total_tokens}})}}catch(f){throw await Promise.all((d??[]).map(g=>g==null?void 0:g.handleLLMError(f))),f}await Promise.all((d??[]).map(f=>f==null?void 0:f.handleLLMEnd({generations:[[m]],llmOutput:p})))}}getLsParams(e){const n=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:n}}async _generateUncached(e,n,r,s){var d,m;const a=e.map(p=>p.map(Xa));let i;if(s!==void 0&&s.length===a.length)i=s;else{const p={...r.metadata,...this.getLsParams(n)},f=await Mt.configure(r.callbacks,this.callbacks,r.tags,this.tags,p,this.metadata,{verbose:this.verbose}),g={options:n,invocation_params:this==null?void 0:this.invocationParams(n),batch_size:1};i=await(f==null?void 0:f.handleChatModelStart(this.toJSON(),a,r.runId,void 0,g,void 0,void 0,r.runName))}const o=[],u=[];if(!!(i!=null&&i[0].handlers.find(sN))&&!this.disableStreaming&&a.length===1&&this._streamResponseChunks!==vr.prototype._streamResponseChunks)try{const p=await this._streamResponseChunks(a[0],n,i==null?void 0:i[0]);let f,g;for await(const b of p){if(b.message.id==null){const _=(d=i==null?void 0:i.at(0))==null?void 0:d.runId;_!=null&&b.message._updateId(`run-${_}`)}f===void 0?f=b:f=$n(f,b),Jp(b.message)&&b.message.usage_metadata!==void 0&&(g={tokenUsage:{promptTokens:b.message.usage_metadata.input_tokens,completionTokens:b.message.usage_metadata.output_tokens,totalTokens:b.message.usage_metadata.total_tokens}})}if(f===void 0)throw new Error("Received empty response from chat model call.");o.push([f]),await(i==null?void 0:i[0].handleLLMEnd({generations:o,llmOutput:g}))}catch(p){throw await(i==null?void 0:i[0].handleLLMError(p)),p}else{const p=await Promise.allSettled(a.map((f,g)=>this._generate(f,{...n,promptIndex:g},i==null?void 0:i[g])));await Promise.all(p.map(async(f,g)=>{var b,_,y;if(f.status==="fulfilled"){const E=f.value;for(const I of E.generations){if(I.message.id==null){const w=(b=i==null?void 0:i.at(0))==null?void 0:b.runId;w!=null&&I.message._updateId(`run-${w}`)}I.message.response_metadata={...I.generationInfo,...I.message.response_metadata}}return E.generations.length===1&&(E.generations[0].message.response_metadata={...E.llmOutput,...E.generations[0].message.response_metadata}),o[g]=E.generations,u[g]=E.llmOutput,(_=i==null?void 0:i[g])==null?void 0:_.handleLLMEnd({generations:[E.generations],llmOutput:E.llmOutput})}else return await((y=i==null?void 0:i[g])==null?void 0:y.handleLLMError(f.reason)),Promise.reject(f.reason)}))}const l={generations:o,llmOutput:u.length?(m=this._combineLLMOutput)==null?void 0:m.call(this,...u):void 0};return Object.defineProperty(l,sg,{value:i?{runIds:i==null?void 0:i.map(p=>p.runId)}:void 0,configurable:!0}),l}async _generateCached({messages:e,cache:n,llmStringKey:r,parsedOptions:s,handledOptions:a}){const i=e.map(b=>b.map(Xa)),o={...a.metadata,...this.getLsParams(s)},u=await Mt.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1},l=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),i,a.runId,void 0,c,void 0,void 0,a.runName)),d=[],p=(await Promise.allSettled(i.map(async(b,_)=>{const y=vr._convertInputToPromptValue(b).toString(),E=await n.lookup(y,r);return E==null&&d.push(_),E}))).map((b,_)=>({result:b,runManager:l==null?void 0:l[_]})).filter(({result:b})=>b.status==="fulfilled"&&b.value!=null||b.status==="rejected"),f=[];await Promise.all(p.map(async({result:b,runManager:_},y)=>{if(b.status==="fulfilled"){const E=b.value;return f[y]=E.map(I=>("message"in I&&Bc(I.message)&&uo(I.message)&&(I.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),I.generationInfo={...I.generationInfo,tokenUsage:{}},I)),E.length&&await(_==null?void 0:_.handleLLMNewToken(E[0].text)),_==null?void 0:_.handleLLMEnd({generations:[E]},void 0,void 0,void 0,{cached:!0})}else return await(_==null?void 0:_.handleLLMError(b.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(b.reason)}));const g={generations:f,missingPromptIndices:d,startedRunManagers:l};return Object.defineProperty(g,sg,{value:l?{runIds:l==null?void 0:l.map(b=>b.runId)}:void 0,configurable:!0}),g}async generate(e,n,r){let s;Array.isArray(n)?s={stop:n}:s=n;const a=e.map(f=>f.map(Xa)),[i,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(i.callbacks=i.callbacks??r,!this.cache)return this._generateUncached(a,o,i);const{cache:u}=this,c=this._getSerializedCacheKeyParametersForCall(o),{generations:l,missingPromptIndices:d,startedRunManagers:m}=await this._generateCached({messages:a,cache:u,llmStringKey:c,parsedOptions:o,handledOptions:i});let p={};if(d.length>0){const f=await this._generateUncached(d.map(g=>a[g]),o,i,m!==void 0?d.map(g=>m==null?void 0:m[g]):void 0);await Promise.all(f.generations.map(async(g,b)=>{const _=d[b];l[_]=g;const y=vr._convertInputToPromptValue(a[_]).toString();return u.update(y,c,g)})),p=f.llmOutput??{}}return{generations:l,llmOutput:p}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,n,r){const s=e.map(a=>a.toChatMessages());return this.generate(s,n,r)}async call(e,n,r){return(await this.generate([e.map(Xa)],n,r)).generations[0][0].message}async callPrompt(e,n,r){const s=e.toChatMessages();return this.call(s,n,r)}async predictMessages(e,n,r){return this.call(e,n,r)}async predict(e,n,r){const s=new cr(e),a=await this.call([s],n,r);if(typeof a.content!="string")throw new Error("Cannot use predict when output is not a string.");return a.content}withStructuredOutput(e,n){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(n!=null&&n.strict)throw new Error('"strict" mode is not supported for this model by default.');const r=e,s=n==null?void 0:n.name,a=r.description??"A function available to call.",i=n==null?void 0:n.method,o=n==null?void 0:n.includeRaw;if(i==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let u=s??"extract",c;Hf(r)?c=[{type:"function",function:{name:u,description:a,parameters:Ss(r)}}]:("name"in r&&(u=r.name),c=[{type:"function",function:{name:u,description:a,parameters:r}}]);const l=this.bindTools(c),d=lo.from(g=>{if(!g.tool_calls||g.tool_calls.length===0)throw new Error("No tool calls found in the response.");const b=g.tool_calls.find(_=>_.name===u);if(!b)throw new Error(`No tool call found with name ${u}.`);return b.args});if(!o)return l.pipe(d).withConfig({runName:"StructuredOutput"});const m=fa.assign({parsed:(g,b)=>d.invoke(g.raw,b)}),p=fa.assign({parsed:()=>null}),f=m.withFallbacks({fallbacks:[p]});return lr.from([{raw:l},f]).withConfig({runName:"StructuredOutputRunnable"})}}function P6(t,e){const n=typeof e=="number"?void 0:e;return{name:t.name,description:t.description,parameters:Ss(t.schema),...(n==null?void 0:n.strict)!==void 0?{strict:n.strict}:{}}}function x6(t){return t!==void 0&&Array.isArray(t.lc_namespace)}function L6(t){return t!==void 0&&mt.isRunnable(t)&&"lc_name"in t.constructor&&typeof t.constructor.lc_name=="function"&&t.constructor.lc_name()==="RunnableToolLike"}function D6(t){return!!t&&typeof t=="object"&&"name"in t&&"schema"in t&&Hf(t.schema)}function A1(t){return D6(t)||L6(t)||x6(t)}class C1 extends mt{parseResultWithPrompt(e,n,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,n){return typeof e=="string"?this._callWithConfig(async(r,s)=>this.parseResult([{text:r}],s==null?void 0:s.callbacks),e,{...n,runType:"parser"}):this._callWithConfig(async(r,s)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],s==null?void 0:s.callbacks),e,{...n,runType:"parser"})}}class v1 extends C1{parseResult(e,n){return this.parse(e[0].text,n)}async parseWithPrompt(e,n,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class Vi extends Error{constructor(e,n,r,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=n,this.observation=r,this.sendToLLM=s,s&&(r===void 0||n===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");ay(this,"OUTPUT_PARSING_FAILURE")}}function wh(t,e){const n=typeof t;if(n!==typeof e)return!1;if(Array.isArray(t)){if(!Array.isArray(e))return!1;const r=t.length;if(r!==e.length)return!1;for(let s=0;s<r;s++)if(!wh(t[s],e[s]))return!1;return!0}if(n==="object"){if(!t||!e)return t===e;const r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(const i of r)if(!wh(t[i],e[i]))return!1;return!0}return t===e}class M6 extends v1{async*_transform(e){for await(const n of e)typeof n=="string"?yield this.parseResult([{text:n}]):yield this.parseResult([{message:n,text:this._baseMessageToString(n)}])}async*transform(e,n){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...n,runType:"parser"})}}class O1 extends M6{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let n,r;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let a;if(fN(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new Ts({message:s,text:s.content})}else if(Bc(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new Ts({message:_N(s),text:s.content})}else a=new ha({text:s});r===void 0?r=a:r=r.concat(a);const i=await this.parsePartialResult([r]);i!=null&&!wh(i,n)&&(this.diff?yield this._diff(n,i):yield i,n=i)}}getFormatInstructions(){return""}}class i0 extends v1{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const n=Or.object(Object.fromEntries(Object.entries(e).map(([r,s])=>[r,Or.string().describe(s)])));return new this(n)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(Ss(this.schema))}
\`\`\`
`}async parse(e){try{const r=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(s,a)=>`"${a.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(r))}catch(n){throw new Vi(`Failed to parse. Text: "${e}". Error: ${n}`,e)}}}class o0 extends O1{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,n){if(n)return e?Uk(e,n):[{op:"replace",path:"",value:n}]}async parsePartialResult(e){return Zp(e[0].text)}async parse(e){return Zp(e,JSON.parse)}getFormatInstructions(){return""}}class u0 extends C1{static lc_name(){return"AnthropicToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","anthropic","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){let n=e;if(typeof e=="string")try{n=JSON.parse(e)}catch(s){throw new Vi(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(s.message)}`,e)}else n=e;if(this.zodSchema===void 0)return n;const r=await this.zodSchema.safeParseAsync(n);if(r.success)return r.data;throw new Vi(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(r.error.errors)}`,JSON.stringify(n,null,2))}async parseResult(e){const n=e.flatMap(a=>{const{message:i}=a;return Array.isArray(i.content)?I1(i.content)[0]:[]});if(n[0]===void 0)throw new Error("No parseable tool calls provided to AnthropicToolsOutputParser.");const[r]=n;return await this._validateResult(r.args)}}function I1(t){const e=[];for(const n of t)n.type==="tool_use"&&e.push({name:n.name,args:n.input,id:n.id,type:"tool_call"});return e}function B6(t){if(t)return t==="any"?{type:"any"}:t==="auto"?{type:"auto"}:typeof t=="string"?{type:"tool",name:t}:t}function c0(t){const e=/^data:(image\/.+);base64,(.+)$/,n=t.match(e);if(n===null)throw new Error(["Anthropic only supports base64-encoded images currently.","Example: data:image/png;base64,/9j/4AAQSk..."].join(`

`));return{type:"base64",media_type:n[1]??"",data:n[2]??""}}function F6(t){const e=[];for(const n of t)if(n._getType()==="tool")if(typeof n.content=="string"){const r=e[e.length-1];(r==null?void 0:r._getType())==="human"&&Array.isArray(r.content)&&"type"in r.content[0]&&r.content[0].type==="tool_result"?r.content.push({type:"tool_result",content:n.content,tool_use_id:n.tool_call_id}):e.push(new cr({content:[{type:"tool_result",content:n.content,tool_use_id:n.tool_call_id}]}))}else e.push(new cr({content:[{type:"tool_result",content:Th(n.content),tool_use_id:n.tool_call_id}]}));else e.push(n);return e}function l0(t){if(t.id===void 0)throw new Error('Anthropic requires all tool calls to have an "id".');return{type:"tool_use",id:t.id,name:t.name,input:t.args}}function Th(t){const e=["tool_use","tool_result","input_json_delta"],n=["text","text_delta"];return typeof t=="string"?t:t.map(s=>{const a="cache_control"in s?s.cache_control:void 0;if(s.type==="image_url"){let i;return typeof s.image_url=="string"?i=c0(s.image_url):i=c0(s.image_url.url),{type:"image",source:i,...a?{cache_control:a}:{}}}else{if(s.type==="document")return{type:"document",source:s.source,...a?{cache_control:a}:{}};if(n.find(i=>i===s.type)&&"text"in s)return{type:"text",text:s.text,...a?{cache_control:a}:{}};if(e.find(i=>i===s.type)){const i={...s};if("index"in i&&delete i.index,i.type==="input_json_delta"&&(i.type="tool_use"),"input"in i)try{i.input=JSON.parse(i.input)}catch{}return{...i,...a?{cache_control:a}:{}}}else throw new Error("Unsupported message content format")}})}function d0(t){const e=F6(t);let n;e.length>0&&e[0]._getType()==="system"&&(n=t[0].content);const s=(n!==void 0?e.slice(1):e).map(a=>{var o;let i;if(a._getType()==="human")i="user";else if(a._getType()==="ai")i="assistant";else if(a._getType()==="tool")i="user";else throw a._getType()==="system"?new Error("System messages are only permitted as the first passed message."):new Error(`Message type "${a._getType()}" is not supported.`);if(uo(a)&&((o=a.tool_calls)!=null&&o.length)){if(typeof a.content=="string")return a.content===""?{role:i,content:a.tool_calls.map(l0)}:{role:i,content:[{type:"text",text:a.content},...a.tool_calls.map(l0)]};{const{content:u}=a;return!a.tool_calls.every(l=>u.find(d=>(d.type==="tool_use"||d.type==="input_json_delta")&&d.id===l.id))&&console.warn('The "tool_calls" field on a message is only respected if content is a string.'),{role:i,content:Th(a.content)}}}else return{role:i,content:Th(a.content)}});return{messages:U6(s),system:n}}function U6(t){if(!t||t.length<=1)return t;const e=[];let n=t[0];const r=a=>typeof a=="string"?[{type:"text",text:a}]:a,s=a=>a.role!=="user"||typeof a.content=="string"?!1:Array.isArray(a.content)&&a.content.every(i=>i.type==="tool_result");for(let a=1;a<t.length;a+=1){const i=t[a];s(n)&&s(i)?n={...n,content:[...r(n.content),...r(i.content)]}:(e.push(n),n=i)}return e.push(n),e}function j6(t,e){var n,r;if(t.type==="message_start"){const{content:s,usage:a,...i}=t.message,o={};for(const[m,p]of Object.entries(i))p!=null&&(o[m]=p);const{input_tokens:u,output_tokens:c,...l}=a??{},d={input_tokens:u,output_tokens:c,total_tokens:u+c,input_token_details:{cache_creation:l.cache_creation_input_tokens,cache_read:l.cache_read_input_tokens}};return{chunk:new Xt({content:e.coerceContentToString?"":[],additional_kwargs:o,usage_metadata:e.streamUsage?d:void 0,response_metadata:{usage:{...l}},id:t.message.id})}}else if(t.type==="message_delta"){const s={input_tokens:0,output_tokens:t.usage.output_tokens,total_tokens:t.usage.output_tokens,input_token_details:{cache_creation:t.usage.cache_creation_input_tokens,cache_read:t.usage.cache_read_input_tokens}};return{chunk:new Xt({content:e.coerceContentToString?"":[],additional_kwargs:{...t.delta},usage_metadata:e.streamUsage?s:void 0})}}else if(t.type==="content_block_start"&&t.content_block.type==="tool_use"){const s=t.content_block;return{chunk:new Xt({content:e.coerceContentToString?"":[{index:t.index,...t.content_block,input:""}],additional_kwargs:{},tool_call_chunks:[{id:s.id,index:t.index,name:s.name,args:""}]})}}else if(t.type==="content_block_delta"&&t.delta.type==="text_delta"){const s=(n=t.delta)==null?void 0:n.text;if(s!==void 0)return{chunk:new Xt({content:e.coerceContentToString?s:[{index:t.index,...t.delta}],additional_kwargs:{}})}}else{if(t.type==="content_block_delta"&&t.delta.type==="input_json_delta")return{chunk:new Xt({content:e.coerceContentToString?"":[{index:t.index,input:t.delta.partial_json,type:t.delta.type}],additional_kwargs:{},tool_call_chunks:[{index:t.index,args:t.delta.partial_json}]})};if(t.type==="content_block_start"&&t.content_block.type==="text"){const s=(r=t.content_block)==null?void 0:r.text;if(s!==void 0)return{chunk:new Xt({content:e.coerceContentToString?s:[{index:t.index,...t.content_block}],additional_kwargs:{}})}}}return null}function H6(t,e){const n=e.usage,r=n!=null?{input_tokens:n.input_tokens??0,output_tokens:n.output_tokens??0,total_tokens:(n.input_tokens??0)+(n.output_tokens??0),input_token_details:{cache_creation:n.cache_creation_input_tokens,cache_read:n.cache_read_input_tokens}}:void 0;if(t.length===1&&t[0].type==="text")return[{text:t[0].text,message:new ws({content:t[0].text,additional_kwargs:e,usage_metadata:r,response_metadata:e,id:e.id})}];{const s=I1(t);return[{text:"",message:new ws({content:t,additional_kwargs:e,tool_calls:s,usage_metadata:r,response_metadata:e,id:e.id})}]}}function eu(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,t}function h0(t){let e;return t.status===400&&t.message.includes("tool")?e=eu(t,"INVALID_TOOL_RESULTS"):t.status===401?e=eu(t,"MODEL_AUTHENTICATION"):t.status===404?e=eu(t,"MODEL_NOT_FOUND"):t.status===429?e=eu(t,"MODEL_RATE_LIMIT"):e=t,e}function $6(t){return!!(t.tools&&t.tools.length>0)}function q6(t){return"input_schema"in t}function V6(t){if(typeof t.content=="string")return t.content;if(Array.isArray(t.content)&&t.content.length>=1&&"input"in t.content[0])return typeof t.content[0].input=="string"?t.content[0].input:JSON.stringify(t.content[0].input);if(Array.isArray(t.content)&&t.content.length>=1&&"text"in t.content[0])return t.content[0].text}class z6 extends vr{static lc_name(){return"ChatAnthropic"}get lc_secrets(){return{anthropicApiKey:"ANTHROPIC_API_KEY",apiKey:"ANTHROPIC_API_KEY"}}get lc_aliases(){return{modelName:"model"}}constructor(e){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"anthropicApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"invocationKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"clientOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamingClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"createClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.anthropicApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.anthropicApiKey)??gn("ANTHROPIC_API_KEY"),!this.anthropicApiKey&&!(e!=null&&e.createClient))throw new Error("Anthropic API key not found");this.clientOptions=(e==null?void 0:e.clientOptions)??{},this.apiKey=this.anthropicApiKey,this.apiUrl=e==null?void 0:e.anthropicApiUrl,this.modelName=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.model=this.modelName,this.invocationKwargs=(e==null?void 0:e.invocationKwargs)??{},this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topK=(e==null?void 0:e.topK)??this.topK,this.topP=(e==null?void 0:e.topP)??this.topP,this.maxTokens=(e==null?void 0:e.maxTokensToSample)??(e==null?void 0:e.maxTokens)??this.maxTokens,this.stopSequences=(e==null?void 0:e.stopSequences)??this.stopSequences,this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.createClient=(e==null?void 0:e.createClient)??(n=>new at(n))}getLsParams(e){const n=this.invocationParams(e);return{ls_provider:"anthropic",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:n.temperature??void 0,ls_max_tokens:n.max_tokens??void 0,ls_stop:e.stop}}formatStructuredToolToAnthropic(e){if(!(!e||!e.length))return e.map(n=>{if(q6(n))return n;if(T1(n))return{name:n.function.name,description:n.function.description,input_schema:n.function.parameters};if(A1(n))return{name:n.name,description:n.description,input_schema:Ss(n.schema)};throw new Error(`Unknown tool type passed to ChatAnthropic: ${JSON.stringify(n,null,2)}`)})}bindTools(e,n){return this.bind({tools:this.formatStructuredToolToAnthropic(e),...n})}invocationParams(e){const n=B6(e==null?void 0:e.tool_choice);return{model:this.model,temperature:this.temperature,top_k:this.topK,top_p:this.topP,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:n,...this.invocationKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams()}}identifyingParams(){return{model_name:this.model,...this.invocationParams()}}async*_streamResponseChunks(e,n,r){var u;const s=this.invocationParams(n),a=d0(e),i=!$6({...s,...a,stream:!1}),o=await this.createStreamWithRetry({...s,...a,stream:!0},{headers:n.headers});for await(const c of o){if((u=n.signal)!=null&&u.aborted)throw o.controller.abort(),new Error("AbortError: User aborted the request.");const l=this.streamUsage??n.streamUsage,d=j6(c,{streamUsage:l,coerceContentToString:i});if(!d)continue;const{chunk:m}=d,p=V6(m),f=new Ts({message:new Xt({content:m.content,additional_kwargs:m.additional_kwargs,tool_call_chunks:m.tool_call_chunks,usage_metadata:l?m.usage_metadata:void 0,response_metadata:m.response_metadata,id:m.id}),text:p??""});yield f,await(r==null?void 0:r.handleLLMNewToken(p??"",void 0,void 0,void 0,void 0,{chunk:f}))}}async _generateNonStreaming(e,n,r){const s=await this.completionWithRetry({...n,stream:!1,...d0(e)},r),{content:a,...i}=s,o=H6(a,i),{role:u,type:c,...l}=i;return{generations:o,llmOutput:l}}async _generate(e,n,r){if(this.stopSequences&&n.stop)throw new Error('"stopSequence" parameter found in input and default params');const s=this.invocationParams(n);if(s.stream){let a;const i=this._streamResponseChunks(e,n,r);for await(const o of i)a===void 0?a=o:a=a.concat(o);if(a===void 0)throw new Error("No chunks returned from Anthropic API.");return{generations:[{text:a.text,message:a.message}]}}else return this._generateNonStreaming(e,s,{signal:n.signal,headers:n.headers})}async createStreamWithRetry(e,n){if(!this.streamingClient){const s=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.streamingClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...s,apiKey:this.apiKey,maxRetries:0})}const r=async()=>{try{return await this.streamingClient.messages.create({...e,...this.invocationKwargs,stream:!0},n)}catch(s){throw h0(s)}};return this.caller.call(r)}async completionWithRetry(e,n){if(!this.batchClient){const s=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.batchClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...s,apiKey:this.apiKey,maxRetries:0})}const r=async()=>{try{return await this.batchClient.messages.create({...e,...this.invocationKwargs},n)}catch(s){throw h0(s)}};return this.caller.callWithOptions({signal:n.signal??void 0},r)}_llmType(){return"anthropic"}withStructuredOutput(e,n){const r=e,s=n==null?void 0:n.name,a=n==null?void 0:n.method,i=n==null?void 0:n.includeRaw;if(a==="jsonMode")throw new Error('Anthropic only supports "functionCalling" as a method.');let o=s??"extract",u,c;if(Hf(r)){const f=Ss(r);c=[{name:o,description:f.description??"A function available to call.",input_schema:f}],u=new u0({returnSingle:!0,keyName:o,zodSchema:r})}else{let f;typeof r.name=="string"&&typeof r.description=="string"&&typeof r.input_schema=="object"&&r.input_schema!=null?(f=r,o=r.name):f={name:o,description:r.description??"",input_schema:r},c=[f],u=new u0({returnSingle:!0,keyName:o})}const l=this.bind({tools:c,tool_choice:{type:"tool",name:o}});if(!i)return l.pipe(u).withConfig({runName:"ChatAnthropicStructuredOutput"});const d=fa.assign({parsed:(f,g)=>u.invoke(f.raw,g)}),m=fa.assign({parsed:()=>null}),p=d.withFallbacks({fallbacks:[m]});return lr.from([{raw:l},p]).withConfig({runName:"StructuredOutputRunnable"})}}class W6 extends z6{}const Sh="RFC3986",Ah={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:t=>String(t)},G6="RFC1738",K6=Array.isArray,tr=(()=>{const t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})(),ld=1024,Y6=(t,e,n,r,s)=>{if(t.length===0)return t;let a=t;if(typeof t=="symbol"?a=Symbol.prototype.toString.call(t):typeof t!="string"&&(a=String(t)),n==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=ld){const u=a.length>=ld?a.slice(o,o+ld):a,c=[];for(let l=0;l<u.length;++l){let d=u.charCodeAt(l);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===G6&&(d===40||d===41)){c[c.length]=u.charAt(l);continue}if(d<128){c[c.length]=tr[d];continue}if(d<2048){c[c.length]=tr[192|d>>6]+tr[128|d&63];continue}if(d<55296||d>=57344){c[c.length]=tr[224|d>>12]+tr[128|d>>6&63]+tr[128|d&63];continue}l+=1,d=65536+((d&1023)<<10|u.charCodeAt(l)&1023),c[c.length]=tr[240|d>>18]+tr[128|d>>12&63]+tr[128|d>>6&63]+tr[128|d&63]}i+=c.join("")}return i};function Z6(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function f0(t,e){if(K6(t)){const n=[];for(let r=0;r<t.length;r+=1)n.push(e(t[r]));return n}return e(t)}const J6=Object.prototype.hasOwnProperty,k1={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},rr=Array.isArray,X6=Array.prototype.push,N1=function(t,e){X6.apply(t,rr(e)?e:[e])},Q6=Date.prototype.toISOString,gt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Y6,encodeValuesOnly:!1,format:Sh,formatter:Ah[Sh],indices:!1,serializeDate(t){return Q6.call(t)},skipNulls:!1,strictNullHandling:!1};function eL(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}const dd={};function R1(t,e,n,r,s,a,i,o,u,c,l,d,m,p,f,g,b,_){let y=t,E=_,I=0,w=!1;for(;(E=E.get(dd))!==void 0&&!w;){const B=E.get(t);if(I+=1,typeof B<"u"){if(B===I)throw new RangeError("Cyclic object value");w=!0}typeof E.get(dd)>"u"&&(I=0)}if(typeof c=="function"?y=c(e,y):y instanceof Date?y=m==null?void 0:m(y):n==="comma"&&rr(y)&&(y=f0(y,function(B){return B instanceof Date?m==null?void 0:m(B):B})),y===null){if(a)return u&&!g?u(e,gt.encoder,b,"key",p):e;y=""}if(eL(y)||Z6(y)){if(u){const B=g?e:u(e,gt.encoder,b,"key",p);return[(f==null?void 0:f(B))+"="+(f==null?void 0:f(u(y,gt.encoder,b,"value",p)))]}return[(f==null?void 0:f(e))+"="+(f==null?void 0:f(String(y)))]}const O=[];if(typeof y>"u")return O;let S;if(n==="comma"&&rr(y))g&&u&&(y=f0(y,u)),S=[{value:y.length>0?y.join(",")||null:void 0}];else if(rr(c))S=c;else{const B=Object.keys(y);S=l?B.sort(l):B}const x=o?String(e).replace(/\./g,"%2E"):String(e),D=r&&rr(y)&&y.length===1?x+"[]":x;if(s&&rr(y)&&y.length===0)return D+"[]";for(let B=0;B<S.length;++B){const Q=S[B],K=typeof Q=="object"&&typeof Q.value<"u"?Q.value:y[Q];if(i&&K===null)continue;const ee=d&&o?Q.replace(/\./g,"%2E"):Q,L=rr(y)?typeof n=="function"?n(D,ee):D:D+(d?"."+ee:"["+ee+"]");_.set(t,I);const N=new WeakMap;N.set(dd,_),N1(O,R1(K,L,n,r,s,a,i,o,n==="comma"&&g&&rr(y)?null:u,c,l,d,m,p,f,g,b,N))}return O}function tL(t=gt){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=t.charset||gt.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=Sh;if(typeof t.format<"u"){if(!J6.call(Ah,t.format))throw new TypeError("Unknown format option provided.");n=t.format}const r=Ah[n];let s=gt.filter;(typeof t.filter=="function"||rr(t.filter))&&(s=t.filter);let a;if(t.arrayFormat&&t.arrayFormat in k1?a=t.arrayFormat:"indices"in t?a=t.indices?"indices":"repeat":a=gt.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:gt.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:gt.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:gt.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:gt.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?gt.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:gt.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:gt.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:gt.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:gt.encodeValuesOnly,filter:s,format:n,formatter:r,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:gt.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:gt.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:gt.strictNullHandling}}function nL(t,e={}){let n=t;const r=tL(e);let s,a;typeof r.filter=="function"?(a=r.filter,n=a("",n)):rr(r.filter)&&(a=r.filter,s=a);const i=[];if(typeof n!="object"||n===null)return"";const o=k1[r.arrayFormat],u=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(n)),r.sort&&s.sort(r.sort);const c=new WeakMap;for(let m=0;m<s.length;++m){const p=s[m];r.skipNulls&&n[p]===null||N1(i,R1(n[p],p,o,u,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}const l=i.join(r.delimiter);let d=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),l.length>0?d+l:""}const Ks="4.83.0";let m0=!1,mi,P1,x1,Ch,L1,D1,M1,B1,F1;function rL(t,e={auto:!1}){if(m0)throw new Error(`you must \`import 'openai/shims/${t.kind}'\` before importing anything else from openai`);if(mi)throw new Error(`can't \`import 'openai/shims/${t.kind}'\` after \`import 'openai/shims/${mi}'\``);m0=e.auto,mi=t.kind,P1=t.fetch,x1=t.FormData,Ch=t.File,L1=t.ReadableStream,D1=t.getMultipartRequestOptions,M1=t.getDefaultAgent,B1=t.fileFromPath,F1=t.isFsReadStream}class sL{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function aL({manuallyImported:t}={}){const e=t?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,r,s,a;try{n=fetch,r=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:n,Request:r,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new sL(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}mi||rL(aL(),{auto:!0});class De extends Error{}class Pt extends De{constructor(e,n,r,s){super(`${Pt.makeMessage(e,n,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=n;const a=n;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,n,r){const s=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,n,r,s){if(!e||!s)return new el({message:r,cause:Oh(n)});const a=n==null?void 0:n.error;return e===400?new U1(e,a,r,s):e===401?new j1(e,a,r,s):e===403?new H1(e,a,r,s):e===404?new $1(e,a,r,s):e===409?new q1(e,a,r,s):e===422?new V1(e,a,r,s):e===429?new z1(e,a,r,s):e>=500?new W1(e,a,r,s):new Pt(e,a,r,s)}}class vn extends Pt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class el extends Pt{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class tl extends el{constructor({message:e}={}){super({message:e??"Request timed out."})}}class U1 extends Pt{}class j1 extends Pt{}class H1 extends Pt{}class $1 extends Pt{}class q1 extends Pt{}class V1 extends Pt{}class z1 extends Pt{}class W1 extends Pt{}class G1 extends De{constructor(){super("Could not parse response content as the length limit was reached")}}class K1 extends De{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class vs{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let n=this.decodeText(e);if(this.trailingCR&&(n="\r"+n,this.trailingCR=!1),n.endsWith("\r")&&(this.trailingCR=!0,n=n.slice(0,-1)),!n)return[];const r=vs.NEWLINE_CHARS.has(n[n.length-1]||"");let s=n.split(vs.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new De(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new De(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new De("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}vs.NEWLINE_CHARS=new Set([`
`,"\r"]);vs.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Y1(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class dr{constructor(e,n){this.iterator=e,this.controller=n}static fromSSEResponse(e,n){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const i of iL(e,n))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null){let o;try{o=JSON.parse(i.data)}catch(u){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),u}if(o&&o.error)throw new Pt(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(i.data)}catch(u){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),u}if(i.event=="error")throw new Pt(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||n.abort()}}return new dr(s,n)}static fromReadableStream(e,n){let r=!1;async function*s(){const i=new vs,o=Y1(e);for await(const u of o)for(const c of i.decode(u))yield c;for(const u of i.flush())yield u}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||n.abort()}}return new dr(a,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],r=this.iterator(),s=a=>({next:()=>{if(a.length===0){const i=r.next();e.push(i),n.push(i)}return a.shift()}});return[new dr(()=>s(e),this.controller),new dr(()=>s(n),this.controller)]}toReadableStream(){const e=this;let n;const r=new TextEncoder;return new L1({async start(){n=e[Symbol.asyncIterator]()},async pull(s){try{const{value:a,done:i}=await n.next();if(i)return s.close();const o=r.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){var s;await((s=n.return)==null?void 0:s.call(n))}})}}async function*iL(t,e){if(!t.body)throw e.abort(),new De("Attempted to iterate over a response with no body");const n=new cL,r=new vs,s=Y1(t.body);for await(const a of oL(s))for(const i of r.decode(a)){const o=n.decode(i);o&&(yield o)}for(const a of r.flush()){const i=n.decode(a);i&&(yield i)}}async function*oL(t){let e=new Uint8Array;for await(const n of t){if(n==null)continue;const r=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let a;for(;(a=uL(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}function uL(t){for(let r=0;r<t.length-2;r++){if(t[r]===10&&t[r+1]===10||t[r]===13&&t[r+1]===13)return r+2;if(t[r]===13&&t[r+1]===10&&r+3<t.length&&t[r+2]===13&&t[r+3]===10)return r+4}return-1}class cL{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,s]=lL(e,":");return s.startsWith(" ")&&(s=s.substring(1)),n==="event"?this.event=s:n==="data"&&this.data.push(s),null}}function lL(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}const Z1=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",J1=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&nl(t),nl=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",dL=t=>J1(t)||Z1(t)||F1(t);async function X1(t,e,n){var s;if(t=await t,J1(t))return t;if(Z1(t)){const a=await t.blob();e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=nl(a)?[await a.arrayBuffer()]:[a];return new Ch(i,e,n)}const r=await hL(t);if(e||(e=mL(t)??"unknown_file"),!(n!=null&&n.type)){const a=(s=r[0])==null?void 0:s.type;typeof a=="string"&&(n={...n,type:a})}return new Ch(r,e,n)}async function hL(t){var n;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(nl(t))e.push(await t.arrayBuffer());else if(pL(t))for await(const r of t)e.push(r);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${(n=t==null?void 0:t.constructor)==null?void 0:n.name}; props: ${fL(t)}`);return e}function fL(t){return`[${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}function mL(t){var e;return hd(t.name)||hd(t.filename)||((e=hd(t.path))==null?void 0:e.split(/[\\/]/).pop())}const hd=t=>{if(typeof t=="string")return t;if(typeof Buffer<"u"&&t instanceof Buffer)return String(t)},pL=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",p0=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody",ma=async t=>{const e=await gL(t.body);return D1(e,t)},gL=async t=>{const e=new x1;return await Promise.all(Object.entries(t||{}).map(([n,r])=>vh(e,n,r))),e},vh=async(t,e,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")t.append(e,String(n));else if(dL(n)){const r=await X1(n);t.append(e,r)}else if(Array.isArray(n))await Promise.all(n.map(r=>vh(t,e+"[]",r)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([r,s])=>vh(t,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}};var bL=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},_L=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},tu;async function Q1(t){const{response:e}=t;if(t.options.stream)return sa("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):dr.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const n=e.headers.get("content-type");if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.includes("application/vnd.api+json"))){const a=await e.json();return sa("response",e.status,e.url,e.headers,a),eE(a,e)}const s=await e.text();return sa("response",e.status,e.url,e.headers,s),s}function eE(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class rl extends Promise{constructor(e,n=Q1){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=n}_thenUnwrap(e){return new rl(this.responsePromise,async n=>eE(e(await this.parseResponse(n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class yL{constructor({baseURL:e,maxRetries:n=2,timeout:r=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=fd("maxRetries",n),this.timeout=fd("timeout",r),this.httpAgent=s,this.fetch=a??P1}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...CL(),...this.authHeaders(e)}}validateHeaders(e,n){}defaultIdempotencyKey(){return`stainless-node-retry-${kL()}`}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,r){return this.request(Promise.resolve(r).then(async s=>{const a=s&&nl(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:n,...s,body:a}}))}getAPIList(e,n,r){return this.requestAPIList(n,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:n=0}={}){var f;e={...e};const{method:r,path:s,query:a,headers:i={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:p0(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,u=this.calculateContentLength(o),c=this.buildURL(s,a);"timeout"in e&&fd("timeout",e.timeout),e.timeout=e.timeout??this.timeout;const l=e.httpAgent??this.httpAgent??M1(c),d=e.timeout+1e3;typeof((f=l==null?void 0:l.options)==null?void 0:f.timeout)=="number"&&d>(l.options.timeout??0)&&(l.options.timeout=d),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const m=this.buildHeaders({options:e,headers:i,contentLength:u,retryCount:n});return{req:{method:r,...o&&{body:o},headers:m,...l&&{agent:l},signal:e.signal??null},url:c,timeout:e.timeout}}buildHeaders({options:e,headers:n,contentLength:r,retryCount:s}){const a={};r&&(a["content-length"]=r);const i=this.defaultHeaders(e);return y0(a,i),y0(a,n),p0(e.body)&&mi!=="node"&&delete a["content-type"],ru(i,"x-stainless-retry-count")===void 0&&ru(n,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(s)),ru(i,"x-stainless-timeout")===void 0&&ru(n,"x-stainless-timeout")===void 0&&e.timeout&&(a["x-stainless-timeout"]=String(e.timeout)),this.validateHeaders(a,n),a}async prepareOptions(e){}async prepareRequest(e,{url:n,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(n=>[...n])):{...e}:{}}makeStatusError(e,n,r,s){return Pt.generate(e,n,r,s)}request(e,n=null){return new rl(this.makeRequest(e,n))}async makeRequest(e,n){var d,m;const r=await e,s=r.maxRetries??this.maxRetries;n==null&&(n=s),await this.prepareOptions(r);const{req:a,url:i,timeout:o}=this.buildRequest(r,{retryCount:s-n});if(await this.prepareRequest(a,{url:i,options:r}),sa("request",i,r,a.headers),(d=r.signal)!=null&&d.aborted)throw new vn;const u=new AbortController,c=await this.fetchWithTimeout(i,a,o,u).catch(Oh);if(c instanceof Error){if((m=r.signal)!=null&&m.aborted)throw new vn;if(n)return this.retryRequest(r,n);throw c.name==="AbortError"?new tl:new el({cause:c})}const l=wL(c.headers);if(!c.ok){if(n&&this.shouldRetry(c)){const y=`retrying, ${n} attempts remaining`;return sa(`response (error; ${y})`,c.status,i,l),this.retryRequest(r,n,l)}const p=await c.text().catch(y=>Oh(y).message),f=vL(p),g=f?void 0:p;throw sa(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,c.status,i,l,g),this.makeStatusError(c.status,f,g,l)}return{response:c,options:r,controller:u}}requestAPIList(e,n){const r=this.makeRequest(n,null);return new EL(this,r,e)}buildURL(e,n){const r=IL(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return nE(s)||(n={...s,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(r.search=this.stringifyQuery(n)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new De(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,n,r,s){const{signal:a,...i}=n||{};a&&a.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r),u={signal:s.signal,...i};return u.method&&(u.method=u.method.toUpperCase()),this.fetch.call(void 0,e,u).finally(()=>{clearTimeout(o)})}shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,r){let s;const a=r==null?void 0:r["retry-after-ms"];if(a){const o=parseFloat(a);Number.isNaN(o)||(s=o)}const i=r==null?void 0:r["retry-after"];if(i&&!s){const o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(n,o)}return await go(s),this.makeRequest(e,n-1)}calculateDefaultRetryTimeoutMillis(e,n){const a=n-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ks}`}}class tE{constructor(e,n,r,s){tu.set(this,void 0),bL(this,tu,e,"f"),this.options=s,this.response=n,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new De("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...this.options};if("params"in e&&typeof n.query=="object")n.query={...n.query,...e.params};else if("url"in e){const r=[...Object.entries(n.query||{}),...e.url.searchParams.entries()];for(const[s,a]of r)e.url.searchParams.set(s,a);n.query=void 0,n.path=e.url.toString()}return await _L(this,tu,"f").requestAPIList(this.constructor,n)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(tu=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const n of e.getPaginatedItems())yield n}}class EL extends rl{constructor(e,n,r){super(n,async s=>new r(e,s.response,await Q1(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const n of e)yield n}}const wL=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,n){const r=n.toString();return e[r.toLowerCase()]||e[r]}}),TL={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},sn=t=>typeof t=="object"&&t!==null&&!nE(t)&&Object.keys(t).every(e=>rE(TL,e)),SL=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ks,"X-Stainless-OS":b0(Deno.build.os),"X-Stainless-Arch":g0(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ks,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ks,"X-Stainless-OS":b0(process.platform),"X-Stainless-Arch":g0(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=AL();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ks,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ks,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function AL(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const r=n.exec(navigator.userAgent);if(r){const s=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}const g0=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",b0=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let _0;const CL=()=>_0??(_0=SL()),vL=t=>{try{return JSON.parse(t)}catch{return}},OL=/^[a-z][a-z0-9+.-]*:/i,IL=t=>OL.test(t),go=t=>new Promise(e=>setTimeout(e,t)),fd=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new De(`${t} must be an integer`);if(e<0)throw new De(`${t} must be a positive integer`);return e},Oh=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch{}return new Error(t)},nu=t=>{var e,n,r,s,a;if(typeof process<"u")return((n=(e=process.env)==null?void 0:e[t])==null?void 0:n.trim())??void 0;if(typeof Deno<"u")return(a=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,t))==null?void 0:a.trim()};function nE(t){if(!t)return!0;for(const e in t)return!1;return!0}function rE(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function y0(t,e){for(const n in e){if(!rE(e,n))continue;const r=n.toLowerCase();if(!r)continue;const s=e[n];s===null?delete t[r]:s!==void 0&&(t[r]=s)}}const E0=new Set(["authorization","api-key"]);function sa(t,...e){var n;if(typeof process<"u"&&((n=process==null?void 0:process.env)==null?void 0:n.DEBUG)==="true"){const r=e.map(s=>{if(!s)return s;if(s.headers){const i={...s,headers:{...s.headers}};for(const o in s.headers)E0.has(o.toLowerCase())&&(i.headers[o]="REDACTED");return i}let a=null;for(const i in s)E0.has(i.toLowerCase())&&(a??(a={...s}),a[i]="REDACTED");return a??s});console.log(`OpenAI:DEBUG:${t}`,...r)}}const kL=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),NL=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",RL=t=>typeof(t==null?void 0:t.get)=="function",ru=(t,e)=>{var r;const n=e.toLowerCase();if(RL(t)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,i,o)=>i+o.toUpperCase());for(const a of[e,n,e.toUpperCase(),s]){const i=t.get(a);if(i)return i}}for(const[s,a]of Object.entries(t))if(s.toLowerCase()===n)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a};function md(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}class PL extends tE{constructor(e,n,r,s){super(e,n,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Zn extends tE{constructor(e,n,r,s){super(e,n,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const n=Object.fromEntries(e.url.searchParams);return Object.keys(n).length?n:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const n=(r=e[e.length-1])==null?void 0:r.id;return n?{params:{after:n}}:null}}class Ke{constructor(e){this._client=e}}let sE=class extends Ke{create(e,n){return this._client.post("/chat/completions",{body:e,...n,stream:e.stream??!1})}},$f=class extends Ke{constructor(){super(...arguments),this.completions=new sE(this._client)}};$f.Completions=sE;class aE extends Ke{create(e,n){return this._client.post("/audio/speech",{body:e,...n,headers:{Accept:"application/octet-stream",...n==null?void 0:n.headers},__binaryResponse:!0})}}class iE extends Ke{create(e,n){return this._client.post("/audio/transcriptions",ma({body:e,...n,__metadata:{model:e.model}}))}}class oE extends Ke{create(e,n){return this._client.post("/audio/translations",ma({body:e,...n,__metadata:{model:e.model}}))}}class bo extends Ke{constructor(){super(...arguments),this.transcriptions=new iE(this._client),this.translations=new oE(this._client),this.speech=new aE(this._client)}}bo.Transcriptions=iE;bo.Translations=oE;bo.Speech=aE;class qf extends Ke{create(e,n){return this._client.post("/batches",{body:e,...n})}retrieve(e,n){return this._client.get(`/batches/${e}`,n)}list(e={},n){return sn(e)?this.list({},e):this._client.getAPIList("/batches",Vf,{query:e,...n})}cancel(e,n){return this._client.post(`/batches/${e}/cancel`,n)}}class Vf extends Zn{}qf.BatchesPage=Vf;class zf extends Ke{create(e,n){return this._client.post("/assistants",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,r){return this._client.post(`/assistants/${e}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},n){return sn(e)?this.list({},e):this._client.getAPIList("/assistants",Wf,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Wf extends Zn{}zf.AssistantsPage=Wf;function w0(t){return typeof t.parse=="function"}const aa=t=>(t==null?void 0:t.role)==="assistant",uE=t=>(t==null?void 0:t.role)==="function",cE=t=>(t==null?void 0:t.role)==="tool";var Ln=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},it=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},Ih,Tu,Su,ei,ti,Au,ni,Tr,ri,sc,ac,Ys,lE;class dE{constructor(){Ih.add(this),this.controller=new AbortController,Tu.set(this,void 0),Su.set(this,()=>{}),ei.set(this,()=>{}),ti.set(this,void 0),Au.set(this,()=>{}),ni.set(this,()=>{}),Tr.set(this,{}),ri.set(this,!1),sc.set(this,!1),ac.set(this,!1),Ys.set(this,!1),Ln(this,Tu,new Promise((e,n)=>{Ln(this,Su,e,"f"),Ln(this,ei,n,"f")}),"f"),Ln(this,ti,new Promise((e,n)=>{Ln(this,Au,e,"f"),Ln(this,ni,n,"f")}),"f"),it(this,Tu,"f").catch(()=>{}),it(this,ti,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},it(this,Ih,"m",lE).bind(this))},0)}_connected(){this.ended||(it(this,Su,"f").call(this),this._emit("connect"))}get ended(){return it(this,ri,"f")}get errored(){return it(this,sc,"f")}get aborted(){return it(this,ac,"f")}abort(){this.controller.abort()}on(e,n){return(it(this,Tr,"f")[e]||(it(this,Tr,"f")[e]=[])).push({listener:n}),this}off(e,n){const r=it(this,Tr,"f")[e];if(!r)return this;const s=r.findIndex(a=>a.listener===n);return s>=0&&r.splice(s,1),this}once(e,n){return(it(this,Tr,"f")[e]||(it(this,Tr,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,r)=>{Ln(this,Ys,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,n)})}async done(){Ln(this,Ys,!0,"f"),await it(this,ti,"f")}_emit(e,...n){if(it(this,ri,"f"))return;e==="end"&&(Ln(this,ri,!0,"f"),it(this,Au,"f").call(this));const r=it(this,Tr,"f")[e];if(r&&(it(this,Tr,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...n))),e==="abort"){const s=n[0];!it(this,Ys,"f")&&!(r!=null&&r.length)&&Promise.reject(s),it(this,ei,"f").call(this,s),it(this,ni,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=n[0];!it(this,Ys,"f")&&!(r!=null&&r.length)&&Promise.reject(s),it(this,ei,"f").call(this,s),it(this,ni,"f").call(this,s),this._emit("end")}}_emitFinal(){}}Tu=new WeakMap,Su=new WeakMap,ei=new WeakMap,ti=new WeakMap,Au=new WeakMap,ni=new WeakMap,Tr=new WeakMap,ri=new WeakMap,sc=new WeakMap,ac=new WeakMap,Ys=new WeakMap,Ih=new WeakSet,lE=function(e){if(Ln(this,sc,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new vn),e instanceof vn)return Ln(this,ac,!0,"f"),this._emit("abort",e);if(e instanceof De)return this._emit("error",e);if(e instanceof Error){const n=new De(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new De(String(e)))};function xL(t,e){const n={...t};return Object.defineProperties(n,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),n}function hE(t){return(t==null?void 0:t.$brand)==="auto-parseable-response-format"}function LL(t,{parser:e,callback:n}){const r={...t};return Object.defineProperties(r,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:n,enumerable:!1}}),r}function _o(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function DL(t,e){return!e||!fE(e)?{...t,choices:t.choices.map(n=>({...n,message:{...n.message,parsed:null,tool_calls:n.message.tool_calls??[]}}))}:Gf(t,e)}function Gf(t,e){const n=t.choices.map(r=>{var s;if(r.finish_reason==="length")throw new G1;if(r.finish_reason==="content_filter")throw new K1;return{...r,message:{...r.message,tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(a=>BL(e,a)))??[],parsed:r.message.content&&!r.message.refusal?ML(e,r.message.content):null}}});return{...t,choices:n}}function ML(t,e){var n,r;return((n=t.response_format)==null?void 0:n.type)!=="json_schema"?null:((r=t.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function BL(t,e){var r;const n=(r=t.tools)==null?void 0:r.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:_o(n)?n.$parseRaw(e.function.arguments):n!=null&&n.function.strict?JSON.parse(e.function.arguments):null}}}function FL(t,e){var r;if(!t)return!1;const n=(r=t.tools)==null?void 0:r.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return _o(n)||(n==null?void 0:n.function.strict)||!1}function fE(t){var e;return hE(t.response_format)?!0:((e=t.tools)==null?void 0:e.some(n=>_o(n)||n.type==="function"&&n.function.strict===!0))??!1}function UL(t){for(const e of t??[]){if(e.type!=="function")throw new De(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new De(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Yt=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},xt,kh,ic,Nh,Rh,Ph,mE,xh;const T0=10;class pE extends dE{constructor(){super(...arguments),xt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const n=(r=e.choices[0])==null?void 0:r.message;return n&&this._addMessage(n),e}_addMessage(e,n=!0){if("content"in e||(e.content=null),this.messages.push(e),n){if(this._emit("message",e),(uE(e)||cE(e))&&e.content)this._emit("functionCallResult",e.content);else if(aa(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(aa(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new De("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Yt(this,xt,"m",kh).call(this)}async finalMessage(){return await this.done(),Yt(this,xt,"m",ic).call(this)}async finalFunctionCall(){return await this.done(),Yt(this,xt,"m",Nh).call(this)}async finalFunctionCallResult(){return await this.done(),Yt(this,xt,"m",Rh).call(this)}async totalUsage(){return await this.done(),Yt(this,xt,"m",Ph).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const n=Yt(this,xt,"m",ic).call(this);n&&this._emit("finalMessage",n);const r=Yt(this,xt,"m",kh).call(this);r&&this._emit("finalContent",r);const s=Yt(this,xt,"m",Nh).call(this);s&&this._emit("finalFunctionCall",s);const a=Yt(this,xt,"m",Rh).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",Yt(this,xt,"m",Ph).call(this))}async _createChatCompletion(e,n,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Yt(this,xt,"m",mE).call(this,n);const a=await e.chat.completions.create({...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Gf(a,n))}async _runChatCompletion(e,n,r){for(const s of n.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,n,r)}async _runFunctions(e,n,r){var m;const s="function",{function_call:a="auto",stream:i,...o}=n,u=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:c=T0}=r||{},l={};for(const p of n.functions)l[p.name||p.function.name]=p;const d=n.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(const p of n.messages)this._addMessage(p,!1);for(let p=0;p<c;++p){const g=(m=(await this._createChatCompletion(e,{...o,function_call:a,functions:d,messages:[...this.messages]},r)).choices[0])==null?void 0:m.message;if(!g)throw new De("missing message in ChatCompletion response");if(!g.function_call)return;const{name:b,arguments:_}=g.function_call,y=l[b];if(y){if(u&&u!==b){const O=`Invalid function_call: ${JSON.stringify(b)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,name:b,content:O});continue}}else{const O=`Invalid function_call: ${JSON.stringify(b)}. Available options are: ${d.map(S=>JSON.stringify(S.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:b,content:O});continue}let E;try{E=w0(y)?await y.parse(_):_}catch(O){this._addMessage({role:s,name:b,content:O instanceof Error?O.message:String(O)});continue}const I=await y.function(E,this),w=Yt(this,xt,"m",xh).call(this,I);if(this._addMessage({role:s,name:b,content:w}),u)return}}async _runTools(e,n,r){var p,f,g;const s="tool",{tool_choice:a="auto",stream:i,...o}=n,u=typeof a!="string"&&((p=a==null?void 0:a.function)==null?void 0:p.name),{maxChatCompletions:c=T0}=r||{},l=n.tools.map(b=>{if(_o(b)){if(!b.$callback)throw new De("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:b.$callback,name:b.function.name,description:b.function.description||"",parameters:b.function.parameters,parse:b.$parseRaw,strict:!0}}}return b}),d={};for(const b of l)b.type==="function"&&(d[b.function.name||b.function.function.name]=b.function);const m="tools"in n?l.map(b=>b.type==="function"?{type:"function",function:{name:b.function.name||b.function.function.name,parameters:b.function.parameters,description:b.function.description,strict:b.function.strict}}:b):void 0;for(const b of n.messages)this._addMessage(b,!1);for(let b=0;b<c;++b){const y=(f=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:m,messages:[...this.messages]},r)).choices[0])==null?void 0:f.message;if(!y)throw new De("missing message in ChatCompletion response");if(!((g=y.tool_calls)!=null&&g.length))return;for(const E of y.tool_calls){if(E.type!=="function")continue;const I=E.id,{name:w,arguments:O}=E.function,S=d[w];if(S){if(u&&u!==w){const Q=`Invalid tool_call: ${JSON.stringify(w)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,tool_call_id:I,content:Q});continue}}else{const Q=`Invalid tool_call: ${JSON.stringify(w)}. Available options are: ${Object.keys(d).map(K=>JSON.stringify(K)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:I,content:Q});continue}let x;try{x=w0(S)?await S.parse(O):O}catch(Q){const K=Q instanceof Error?Q.message:String(Q);this._addMessage({role:s,tool_call_id:I,content:K});continue}const D=await S.function(x,this),B=Yt(this,xt,"m",xh).call(this,D);if(this._addMessage({role:s,tool_call_id:I,content:B}),u)return}}}}xt=new WeakSet,kh=function(){return Yt(this,xt,"m",ic).call(this).content??null},ic=function(){let e=this.messages.length;for(;e-- >0;){const n=this.messages[e];if(aa(n)){const{function_call:r,...s}=n,a={...s,content:n.content??null,refusal:n.refusal??null};return r&&(a.function_call=r),a}}throw new De("stream ended without producing a ChatCompletionMessage with role=assistant")},Nh=function(){var e,n;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(aa(s)&&(s!=null&&s.function_call))return s.function_call;if(aa(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(n=s.tool_calls.at(-1))==null?void 0:n.function}},Rh=function(){for(let e=this.messages.length-1;e>=0;e--){const n=this.messages[e];if(uE(n)&&n.content!=null||cE(n)&&n.content!=null&&typeof n.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(a=>a.type==="function"&&a.id===n.tool_call_id))}))return n.content}},Ph=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:n}of this._chatCompletions)n&&(e.completion_tokens+=n.completion_tokens,e.prompt_tokens+=n.prompt_tokens,e.total_tokens+=n.total_tokens);return e},mE=function(e){if(e.n!=null&&e.n>1)throw new De("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},xh=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class zi extends pE{static runFunctions(e,n,r){const s=new zi,a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,n,a)),s}static runTools(e,n,r){const s=new zi,a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,n,a)),s}_addMessage(e,n=!0){super._addMessage(e,n),aa(e)&&e.content&&this._emit("content",e.content)}}const gE=1,bE=2,_E=4,yE=8,EE=16,wE=32,TE=64,SE=128,AE=256,CE=SE|AE,vE=EE|wE|CE|TE,OE=gE|bE|vE,IE=_E|yE,jL=OE|IE,St={STR:gE,NUM:bE,ARR:_E,OBJ:yE,NULL:EE,BOOL:wE,NAN:TE,INFINITY:SE,MINUS_INFINITY:AE,INF:CE,SPECIAL:vE,ATOM:OE,COLLECTION:IE,ALL:jL};class HL extends Error{}class $L extends Error{}function qL(t,e=St.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return VL(t.trim(),e)}const VL=(t,e)=>{const n=t.length;let r=0;const s=m=>{throw new HL(`${m} at position ${r}`)},a=m=>{throw new $L(`${m} at position ${r}`)},i=()=>(d(),r>=n&&s("Unexpected end of input"),t[r]==='"'?o():t[r]==="{"?u():t[r]==="["?c():t.substring(r,r+4)==="null"||St.NULL&e&&n-r<4&&"null".startsWith(t.substring(r))?(r+=4,null):t.substring(r,r+4)==="true"||St.BOOL&e&&n-r<4&&"true".startsWith(t.substring(r))?(r+=4,!0):t.substring(r,r+5)==="false"||St.BOOL&e&&n-r<5&&"false".startsWith(t.substring(r))?(r+=5,!1):t.substring(r,r+8)==="Infinity"||St.INFINITY&e&&n-r<8&&"Infinity".startsWith(t.substring(r))?(r+=8,1/0):t.substring(r,r+9)==="-Infinity"||St.MINUS_INFINITY&e&&1<n-r&&n-r<9&&"-Infinity".startsWith(t.substring(r))?(r+=9,-1/0):t.substring(r,r+3)==="NaN"||St.NAN&e&&n-r<3&&"NaN".startsWith(t.substring(r))?(r+=3,NaN):l()),o=()=>{const m=r;let p=!1;for(r++;r<n&&(t[r]!=='"'||p&&t[r-1]==="\\");)p=t[r]==="\\"?!p:!1,r++;if(t.charAt(r)=='"')try{return JSON.parse(t.substring(m,++r-Number(p)))}catch(f){a(String(f))}else if(St.STR&e)try{return JSON.parse(t.substring(m,r-Number(p))+'"')}catch{return JSON.parse(t.substring(m,t.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},u=()=>{r++,d();const m={};try{for(;t[r]!=="}";){if(d(),r>=n&&St.OBJ&e)return m;const p=o();d(),r++;try{const f=i();Object.defineProperty(m,p,{value:f,writable:!0,enumerable:!0,configurable:!0})}catch(f){if(St.OBJ&e)return m;throw f}d(),t[r]===","&&r++}}catch{if(St.OBJ&e)return m;s("Expected '}' at end of object")}return r++,m},c=()=>{r++;const m=[];try{for(;t[r]!=="]";)m.push(i()),d(),t[r]===","&&r++}catch{if(St.ARR&e)return m;s("Expected ']' at end of array")}return r++,m},l=()=>{if(r===0){t==="-"&&St.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t)}catch(p){if(St.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}a(String(p))}}const m=r;for(t[r]==="-"&&r++;t[r]&&!",]}".includes(t[r]);)r++;r==n&&!(St.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(t.substring(m,r))}catch{t.substring(m,r)==="-"&&St.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t.substring(m,t.lastIndexOf("e")))}catch(f){a(String(f))}}},d=()=>{for(;r<n&&` 
\r	`.includes(t[r]);)r++};return i()},S0=t=>qL(t,St.ALL^St.NUM);var js=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},Xe=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},pt,Er,Hs,Br,pd,su,gd,bd,_d,au,yd,A0;class Wi extends pE{constructor(e){super(),pt.add(this),Er.set(this,void 0),Hs.set(this,void 0),Br.set(this,void 0),js(this,Er,e,"f"),js(this,Hs,[],"f")}get currentChatCompletionSnapshot(){return Xe(this,Br,"f")}static fromReadableStream(e){const n=new Wi(null);return n._run(()=>n._fromReadableStream(e)),n}static createChatCompletion(e,n,r){const s=new Wi(n);return s._run(()=>s._runChatCompletion(e,{...n,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,n,r){var i;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Xe(this,pt,"m",pd).call(this);const a=await e.chat.completions.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of a)Xe(this,pt,"m",gd).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new vn;return this._addChatCompletion(Xe(this,pt,"m",au).call(this))}async _fromReadableStream(e,n){var i;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Xe(this,pt,"m",pd).call(this),this._connected();const s=dr.fromReadableStream(e,this.controller);let a;for await(const o of s)a&&a!==o.id&&this._addChatCompletion(Xe(this,pt,"m",au).call(this)),Xe(this,pt,"m",gd).call(this,o),a=o.id;if((i=s.controller.signal)!=null&&i.aborted)throw new vn;return this._addChatCompletion(Xe(this,pt,"m",au).call(this))}[(Er=new WeakMap,Hs=new WeakMap,Br=new WeakMap,pt=new WeakSet,pd=function(){this.ended||js(this,Br,void 0,"f")},su=function(n){let r=Xe(this,Hs,"f")[n.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Xe(this,Hs,"f")[n.index]=r,r)},gd=function(n){var s,a,i,o,u,c,l,d,m,p,f,g,b,_,y;if(this.ended)return;const r=Xe(this,pt,"m",A0).call(this,n);this._emit("chunk",n,r);for(const E of n.choices){const I=r.choices[E.index];E.delta.content!=null&&((s=I.message)==null?void 0:s.role)==="assistant"&&((a=I.message)!=null&&a.content)&&(this._emit("content",E.delta.content,I.message.content),this._emit("content.delta",{delta:E.delta.content,snapshot:I.message.content,parsed:I.message.parsed})),E.delta.refusal!=null&&((i=I.message)==null?void 0:i.role)==="assistant"&&((o=I.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:E.delta.refusal,snapshot:I.message.refusal}),((u=E.logprobs)==null?void 0:u.content)!=null&&((c=I.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(l=E.logprobs)==null?void 0:l.content,snapshot:((d=I.logprobs)==null?void 0:d.content)??[]}),((m=E.logprobs)==null?void 0:m.refusal)!=null&&((p=I.message)==null?void 0:p.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(f=E.logprobs)==null?void 0:f.refusal,snapshot:((g=I.logprobs)==null?void 0:g.refusal)??[]});const w=Xe(this,pt,"m",su).call(this,I);I.finish_reason&&(Xe(this,pt,"m",_d).call(this,I),w.current_tool_call_index!=null&&Xe(this,pt,"m",bd).call(this,I,w.current_tool_call_index));for(const O of E.delta.tool_calls??[])w.current_tool_call_index!==O.index&&(Xe(this,pt,"m",_d).call(this,I),w.current_tool_call_index!=null&&Xe(this,pt,"m",bd).call(this,I,w.current_tool_call_index)),w.current_tool_call_index=O.index;for(const O of E.delta.tool_calls??[]){const S=(b=I.message.tool_calls)==null?void 0:b[O.index];S!=null&&S.type&&((S==null?void 0:S.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(_=S.function)==null?void 0:_.name,index:O.index,arguments:S.function.arguments,parsed_arguments:S.function.parsed_arguments,arguments_delta:((y=O.function)==null?void 0:y.arguments)??""}):(S==null||S.type,void 0))}}},bd=function(n,r){var i,o,u;if(Xe(this,pt,"m",su).call(this,n).done_tool_calls.has(r))return;const a=(i=n.message.tool_calls)==null?void 0:i[r];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const c=(u=(o=Xe(this,Er,"f"))==null?void 0:o.tools)==null?void 0:u.find(l=>l.type==="function"&&l.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:r,arguments:a.function.arguments,parsed_arguments:_o(c)?c.$parseRaw(a.function.arguments):c!=null&&c.function.strict?JSON.parse(a.function.arguments):null})}else a.type},_d=function(n){var s,a;const r=Xe(this,pt,"m",su).call(this,n);if(n.message.content&&!r.content_done){r.content_done=!0;const i=Xe(this,pt,"m",yd).call(this);this._emit("content.done",{content:n.message.content,parsed:i?i.$parseRaw(n.message.content):null})}n.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:n.message.refusal})),(s=n.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:n.logprobs.content})),(a=n.logprobs)!=null&&a.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:n.logprobs.refusal}))},au=function(){if(this.ended)throw new De("stream has ended, this shouldn't happen");const n=Xe(this,Br,"f");if(!n)throw new De("request ended without sending any chunks");return js(this,Br,void 0,"f"),js(this,Hs,[],"f"),zL(n,Xe(this,Er,"f"))},yd=function(){var r;const n=(r=Xe(this,Er,"f"))==null?void 0:r.response_format;return hE(n)?n:null},A0=function(n){var r,s,a,i;let o=Xe(this,Br,"f");const{choices:u,...c}=n;o?Object.assign(o,c):o=js(this,Br,{...c,choices:[]},"f");for(const{delta:l,finish_reason:d,index:m,logprobs:p=null,...f}of n.choices){let g=o.choices[m];if(g||(g=o.choices[m]={finish_reason:d,index:m,message:{},logprobs:p,...f}),p)if(!g.logprobs)g.logprobs=Object.assign({},p);else{const{content:O,refusal:S,...x}=p;Object.assign(g.logprobs,x),O&&((r=g.logprobs).content??(r.content=[]),g.logprobs.content.push(...O)),S&&((s=g.logprobs).refusal??(s.refusal=[]),g.logprobs.refusal.push(...S))}if(d&&(g.finish_reason=d,Xe(this,Er,"f")&&fE(Xe(this,Er,"f")))){if(d==="length")throw new G1;if(d==="content_filter")throw new K1}if(Object.assign(g,f),!l)continue;const{content:b,refusal:_,function_call:y,role:E,tool_calls:I,...w}=l;if(Object.assign(g.message,w),_&&(g.message.refusal=(g.message.refusal||"")+_),E&&(g.message.role=E),y&&(g.message.function_call?(y.name&&(g.message.function_call.name=y.name),y.arguments&&((a=g.message.function_call).arguments??(a.arguments=""),g.message.function_call.arguments+=y.arguments)):g.message.function_call=y),b&&(g.message.content=(g.message.content||"")+b,!g.message.refusal&&Xe(this,pt,"m",yd).call(this)&&(g.message.parsed=S0(g.message.content))),I){g.message.tool_calls||(g.message.tool_calls=[]);for(const{index:O,id:S,type:x,function:D,...B}of I){const Q=(i=g.message.tool_calls)[O]??(i[O]={});Object.assign(Q,B),S&&(Q.id=S),x&&(Q.type=x),D&&(Q.function??(Q.function={name:D.name??"",arguments:""})),D!=null&&D.name&&(Q.function.name=D.name),D!=null&&D.arguments&&(Q.function.arguments+=D.arguments,FL(Xe(this,Er,"f"),Q)&&(Q.function.parsed_arguments=S0(Q.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("chunk",s=>{const a=n.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>n.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new dr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function zL(t,e){const{id:n,choices:r,created:s,model:a,system_fingerprint:i,...o}=t,u={...o,id:n,choices:r.map(({message:c,finish_reason:l,index:d,logprobs:m,...p})=>{if(!l)throw new De(`missing finish_reason for choice ${d}`);const{content:f=null,function_call:g,tool_calls:b,..._}=c,y=c.role;if(!y)throw new De(`missing role for choice ${d}`);if(g){const{arguments:E,name:I}=g;if(E==null)throw new De(`missing function_call.arguments for choice ${d}`);if(!I)throw new De(`missing function_call.name for choice ${d}`);return{...p,message:{content:f,function_call:{arguments:E,name:I},role:y,refusal:c.refusal??null},finish_reason:l,index:d,logprobs:m}}return b?{...p,index:d,finish_reason:l,logprobs:m,message:{..._,role:y,content:f,refusal:c.refusal??null,tool_calls:b.map((E,I)=>{const{function:w,type:O,id:S,...x}=E,{arguments:D,name:B,...Q}=w||{};if(S==null)throw new De(`missing choices[${d}].tool_calls[${I}].id
${iu(t)}`);if(O==null)throw new De(`missing choices[${d}].tool_calls[${I}].type
${iu(t)}`);if(B==null)throw new De(`missing choices[${d}].tool_calls[${I}].function.name
${iu(t)}`);if(D==null)throw new De(`missing choices[${d}].tool_calls[${I}].function.arguments
${iu(t)}`);return{...x,id:S,type:O,function:{...Q,name:B,arguments:D}}})}}:{...p,message:{..._,content:f,role:y,refusal:c.refusal??null},finish_reason:l,index:d,logprobs:m}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return DL(u,e)}function iu(t){return JSON.stringify(t)}class ia extends Wi{static fromReadableStream(e){const n=new ia(null);return n._run(()=>n._fromReadableStream(e)),n}static runFunctions(e,n,r){const s=new ia(null),a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,n,a)),s}static runTools(e,n,r){const s=new ia(n),a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,n,a)),s}}let kE=class extends Ke{parse(e,n){return UL(e.tools),this._client.chat.completions.create(e,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>Gf(r,e))}runFunctions(e,n){return e.stream?ia.runFunctions(this._client,e,n):zi.runFunctions(this._client,e,n)}runTools(e,n){return e.stream?ia.runTools(this._client,e,n):zi.runTools(this._client,e,n)}stream(e,n){return Wi.createChatCompletion(this._client,e,n)}},NE=class extends Ke{constructor(){super(...arguments),this.completions=new kE(this._client)}};(function(t){t.Completions=kE})(NE);class RE extends Ke{create(e,n){return this._client.post("/realtime/sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Kf extends Ke{constructor(){super(...arguments),this.sessions=new RE(this._client)}}Kf.Sessions=RE;var ce=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},an=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},Rt,Lh,sr,Cu,Dn,ls,Qs,ns,oc,un,vu,Ou,pi,si,ai,C0,v0,O0,I0,k0,N0,R0;class Fn extends dE{constructor(){super(...arguments),Rt.add(this),Lh.set(this,[]),sr.set(this,{}),Cu.set(this,{}),Dn.set(this,void 0),ls.set(this,void 0),Qs.set(this,void 0),ns.set(this,void 0),oc.set(this,void 0),un.set(this,void 0),vu.set(this,void 0),Ou.set(this,void 0),pi.set(this,void 0)}[(Lh=new WeakMap,sr=new WeakMap,Cu=new WeakMap,Dn=new WeakMap,ls=new WeakMap,Qs=new WeakMap,ns=new WeakMap,oc=new WeakMap,un=new WeakMap,vu=new WeakMap,Ou=new WeakMap,pi=new WeakMap,Rt=new WeakSet,Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("event",s=>{const a=n.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>n.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const n=new Fn;return n._run(()=>n._fromReadableStream(e)),n}async _fromReadableStream(e,n){var a;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=dr.fromReadableStream(e,this.controller);for await(const i of s)ce(this,Rt,"m",si).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new vn;return this._addRun(ce(this,Rt,"m",ai).call(this))}toReadableStream(){return new dr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,n,r,s,a){const i=new Fn;return i._run(()=>i._runToolAssistantStream(e,n,r,s,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,n,r,s,a){var c;const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},u=await e.submitToolOutputs(n,r,o,{...a,signal:this.controller.signal});this._connected();for await(const l of u)ce(this,Rt,"m",si).call(this,l);if((c=u.controller.signal)!=null&&c.aborted)throw new vn;return this._addRun(ce(this,Rt,"m",ai).call(this))}static createThreadAssistantStream(e,n,r){const s=new Fn;return s._run(()=>s._threadAssistantStream(e,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,n,r,s){const a=new Fn;return a._run(()=>a._runAssistantStream(e,n,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return ce(this,vu,"f")}currentRun(){return ce(this,Ou,"f")}currentMessageSnapshot(){return ce(this,Dn,"f")}currentRunStepSnapshot(){return ce(this,pi,"f")}async finalRunSteps(){return await this.done(),Object.values(ce(this,sr,"f"))}async finalMessages(){return await this.done(),Object.values(ce(this,Cu,"f"))}async finalRun(){if(await this.done(),!ce(this,ls,"f"))throw Error("Final run was not received.");return ce(this,ls,"f")}async _createThreadAssistantStream(e,n,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...n,stream:!0},i=await e.createAndRun(a,{...r,signal:this.controller.signal});this._connected();for await(const u of i)ce(this,Rt,"m",si).call(this,u);if((o=i.controller.signal)!=null&&o.aborted)throw new vn;return this._addRun(ce(this,Rt,"m",ai).call(this))}async _createAssistantStream(e,n,r,s){var u;const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...r,stream:!0},o=await e.create(n,i,{...s,signal:this.controller.signal});this._connected();for await(const c of o)ce(this,Rt,"m",si).call(this,c);if((u=o.controller.signal)!=null&&u.aborted)throw new vn;return this._addRun(ce(this,Rt,"m",ai).call(this))}static accumulateDelta(e,n){for(const[r,s]of Object.entries(n)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let a=e[r];if(a==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if(md(a)&&md(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}for(const i of s){if(!md(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const u=a[o];u==null?a.push(i):a[o]=this.accumulateDelta(u,i)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${a}`);e[r]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,n,r){return await this._createThreadAssistantStream(n,e,r)}async _runAssistantStream(e,n,r,s){return await this._createAssistantStream(n,e,r,s)}async _runToolAssistantStream(e,n,r,s,a){return await this._createToolAssistantStream(r,e,n,s,a)}}si=function(e){if(!this.ended)switch(an(this,vu,e,"f"),ce(this,Rt,"m",O0).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":ce(this,Rt,"m",R0).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ce(this,Rt,"m",v0).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":ce(this,Rt,"m",C0).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},ai=function(){if(this.ended)throw new De("stream has ended, this shouldn't happen");if(!ce(this,ls,"f"))throw Error("Final run has not been received");return ce(this,ls,"f")},C0=function(e){const[n,r]=ce(this,Rt,"m",k0).call(this,e,ce(this,Dn,"f"));an(this,Dn,n,"f"),ce(this,Cu,"f")[n.id]=n;for(const s of r){const a=n.content[s.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,n),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=n.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=ce(this,Qs,"f")){if(ce(this,ns,"f"))switch(ce(this,ns,"f").type){case"text":this._emit("textDone",ce(this,ns,"f").text,ce(this,Dn,"f"));break;case"image_file":this._emit("imageFileDone",ce(this,ns,"f").image_file,ce(this,Dn,"f"));break}an(this,Qs,s.index,"f")}an(this,ns,n.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(ce(this,Qs,"f")!==void 0){const s=e.data.content[ce(this,Qs,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,ce(this,Dn,"f"));break;case"text":this._emit("textDone",s.text,ce(this,Dn,"f"));break}}ce(this,Dn,"f")&&this._emit("messageDone",e.data),an(this,Dn,void 0,"f")}},v0=function(e){const n=ce(this,Rt,"m",I0).call(this,e);switch(an(this,pi,n,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&n.step_details.type=="tool_calls")for(const a of r.step_details.tool_calls)a.index==ce(this,oc,"f")?this._emit("toolCallDelta",a,n.step_details.tool_calls[a.index]):(ce(this,un,"f")&&this._emit("toolCallDone",ce(this,un,"f")),an(this,oc,a.index,"f"),an(this,un,n.step_details.tool_calls[a.index],"f"),ce(this,un,"f")&&this._emit("toolCallCreated",ce(this,un,"f")));this._emit("runStepDelta",e.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":an(this,pi,void 0,"f"),e.data.step_details.type=="tool_calls"&&ce(this,un,"f")&&(this._emit("toolCallDone",ce(this,un,"f")),an(this,un,void 0,"f")),this._emit("runStepDone",e.data,n);break}},O0=function(e){ce(this,Lh,"f").push(e),this._emit("event",e)},I0=function(e){switch(e.event){case"thread.run.step.created":return ce(this,sr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let n=ce(this,sr,"f")[e.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=Fn.accumulateDelta(n,r.delta);ce(this,sr,"f")[e.data.id]=s}return ce(this,sr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":ce(this,sr,"f")[e.data.id]=e.data;break}if(ce(this,sr,"f")[e.data.id])return ce(this,sr,"f")[e.data.id];throw new Error("No snapshot available")},k0=function(e,n){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const a of s.delta.content)if(a.index in n.content){let i=n.content[a.index];n.content[a.index]=ce(this,Rt,"m",N0).call(this,a,i)}else n.content[a.index]=a,r.push(a);return[n,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},N0=function(e,n){return Fn.accumulateDelta(n,e)},R0=function(e){switch(an(this,Ou,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":an(this,ls,e.data,"f"),ce(this,un,"f")&&(this._emit("toolCallDone",ce(this,un,"f")),an(this,un,void 0,"f"));break}};class Yf extends Ke{create(e,n,r){return this._client.post(`/threads/${e}/messages`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,n,r){return this._client.get(`/threads/${e}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,n,r,s){return this._client.post(`/threads/${e}/messages/${n}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,n={},r){return sn(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/messages`,Zf,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,n,r){return this._client.delete(`/threads/${e}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class Zf extends Zn{}Yf.MessagesPage=Zf;class Jf extends Ke{retrieve(e,n,r,s={},a){return sn(s)?this.retrieve(e,n,r,{},s):this._client.get(`/threads/${e}/runs/${n}/steps/${r}`,{query:s,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,n,r={},s){return sn(r)?this.list(e,n,{},r):this._client.getAPIList(`/threads/${e}/runs/${n}/steps`,Xf,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Xf extends Zn{}Jf.RunStepsPage=Xf;class yo extends Ke{constructor(){super(...arguments),this.steps=new Jf(this._client)}create(e,n,r){const{include:s,...a}=n;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:a,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:n.stream??!1})}retrieve(e,n,r){return this._client.get(`/threads/${e}/runs/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,n,r,s){return this._client.post(`/threads/${e}/runs/${n}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,n={},r){return sn(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/runs`,Qf,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,n,r){return this._client.post(`/threads/${e}/runs/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,n,r){const s=await this.create(e,n,r);return await this.poll(e,s.id,r)}createAndStream(e,n,r){return Fn.createAssistantStream(e,this._client.beta.threads.runs,n,r)}async poll(e,n,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,n,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=i.headers.get("openai-poll-after-ms");if(u){const c=parseInt(u);isNaN(c)||(o=c)}}await go(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,n,r){return Fn.createAssistantStream(e,this._client.beta.threads.runs,n,r)}submitToolOutputs(e,n,r,s){return this._client.post(`/threads/${e}/runs/${n}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,n,r,s){const a=await this.submitToolOutputs(e,n,r,s);return await this.poll(e,a.id,s)}submitToolOutputsStream(e,n,r,s){return Fn.createToolAssistantStream(e,n,this._client.beta.threads.runs,r,s)}}class Qf extends Zn{}yo.RunsPage=Qf;yo.Steps=Jf;yo.RunStepsPage=Xf;class Oa extends Ke{constructor(){super(...arguments),this.runs=new yo(this._client),this.messages=new Yf(this._client)}create(e={},n){return sn(e)?this.create({},e):this._client.post("/threads",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,r){return this._client.post(`/threads/${e}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,n){return this._client.delete(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}createAndRun(e,n){return this._client.post("/threads/runs",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:e.stream??!1})}async createAndRunPoll(e,n){const r=await this.createAndRun(e,n);return await this.runs.poll(r.thread_id,r.id,n)}createAndRunStream(e,n){return Fn.createThreadAssistantStream(e,this._client.beta.threads,n)}}Oa.Runs=yo;Oa.RunsPage=Qf;Oa.Messages=Yf;Oa.MessagesPage=Zf;const WL=async t=>{const e=await Promise.allSettled(t),n=e.filter(s=>s.status==="rejected");if(n.length){for(const s of n)console.error(s.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};let em=class extends Ke{create(e,n,r){return this._client.post(`/vector_stores/${e}/files`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,n,r){return this._client.get(`/vector_stores/${e}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,n={},r){return sn(n)?this.list(e,{},n):this._client.getAPIList(`/vector_stores/${e}/files`,sl,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,n,r){return this._client.delete(`/vector_stores/${e}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,n,r){const s=await this.create(e,n,r);return await this.poll(e,s.id,r)}async poll(e,n,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const a=await this.retrieve(e,n,{...r,headers:s}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=a.response.headers.get("openai-poll-after-ms");if(u){const c=parseInt(u);isNaN(c)||(o=c)}}await go(o);break;case"failed":case"completed":return i}}}async upload(e,n,r){const s=await this._client.files.create({file:n,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,n,r){const s=await this.upload(e,n,r);return await this.poll(e,s.id,r)}};class sl extends Zn{}em.VectorStoreFilesPage=sl;class PE extends Ke{create(e,n,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,n,r){return this._client.get(`/vector_stores/${e}/file_batches/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,n,r){return this._client.post(`/vector_stores/${e}/file_batches/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,n,r){const s=await this.create(e,n);return await this.poll(e,s.id,r)}listFiles(e,n,r={},s){return sn(r)?this.listFiles(e,n,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${n}/files`,sl,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,n,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,n,{...r,headers:s}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=i.headers.get("openai-poll-after-ms");if(u){const c=parseInt(u);isNaN(c)||(o=c)}}await go(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:n,fileIds:r=[]},s){if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(s==null?void 0:s.maxConcurrency)??5,i=Math.min(a,n.length),o=this._client,u=n.values(),c=[...r];async function l(m){for(let p of m){const f=await o.files.create({file:p,purpose:"assistants"},s);c.push(f.id)}}const d=Array(i).fill(u).map(l);return await WL(d),await this.createAndPoll(e,{file_ids:c})}}class Ia extends Ke{constructor(){super(...arguments),this.files=new em(this._client),this.fileBatches=new PE(this._client)}create(e,n){return this._client.post("/vector_stores",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,r){return this._client.post(`/vector_stores/${e}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},n){return sn(e)?this.list({},e):this._client.getAPIList("/vector_stores",tm,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class tm extends Zn{}Ia.VectorStoresPage=tm;Ia.Files=em;Ia.VectorStoreFilesPage=sl;Ia.FileBatches=PE;class Jr extends Ke{constructor(){super(...arguments),this.realtime=new Kf(this._client),this.vectorStores=new Ia(this._client),this.chat=new NE(this._client),this.assistants=new zf(this._client),this.threads=new Oa(this._client)}}Jr.Realtime=Kf;Jr.VectorStores=Ia;Jr.VectorStoresPage=tm;Jr.Assistants=zf;Jr.AssistantsPage=Wf;Jr.Threads=Oa;class xE extends Ke{create(e,n){return this._client.post("/completions",{body:e,...n,stream:e.stream??!1})}}class LE extends Ke{create(e,n){return this._client.post("/embeddings",{body:e,...n})}}class nm extends Ke{create(e,n){return this._client.post("/files",ma({body:e,...n}))}retrieve(e,n){return this._client.get(`/files/${e}`,n)}list(e={},n){return sn(e)?this.list({},e):this._client.getAPIList("/files",rm,{query:e,...n})}del(e,n){return this._client.delete(`/files/${e}`,n)}content(e,n){return this._client.get(`/files/${e}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}retrieveContent(e,n){return this._client.get(`/files/${e}/content`,n)}async waitForProcessing(e,{pollInterval:n=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await go(n),i=await this.retrieve(e),Date.now()-a>r)throw new tl({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return i}}class rm extends Zn{}nm.FileObjectsPage=rm;class sm extends Ke{list(e,n={},r){return sn(n)?this.list(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,am,{query:n,...r})}}class am extends Zn{}sm.FineTuningJobCheckpointsPage=am;class ka extends Ke{constructor(){super(...arguments),this.checkpoints=new sm(this._client)}create(e,n){return this._client.post("/fine_tuning/jobs",{body:e,...n})}retrieve(e,n){return this._client.get(`/fine_tuning/jobs/${e}`,n)}list(e={},n){return sn(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",im,{query:e,...n})}cancel(e,n){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,n)}listEvents(e,n={},r){return sn(n)?this.listEvents(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,om,{query:n,...r})}}class im extends Zn{}class om extends Zn{}ka.FineTuningJobsPage=im;ka.FineTuningJobEventsPage=om;ka.Checkpoints=sm;ka.FineTuningJobCheckpointsPage=am;class Eo extends Ke{constructor(){super(...arguments),this.jobs=new ka(this._client)}}Eo.Jobs=ka;Eo.FineTuningJobsPage=im;Eo.FineTuningJobEventsPage=om;class DE extends Ke{createVariation(e,n){return this._client.post("/images/variations",ma({body:e,...n}))}edit(e,n){return this._client.post("/images/edits",ma({body:e,...n}))}generate(e,n){return this._client.post("/images/generations",{body:e,...n})}}class um extends Ke{retrieve(e,n){return this._client.get(`/models/${e}`,n)}list(e){return this._client.getAPIList("/models",cm,e)}del(e,n){return this._client.delete(`/models/${e}`,n)}}class cm extends PL{}um.ModelsPage=cm;class ME extends Ke{create(e,n){return this._client.post("/moderations",{body:e,...n})}}class BE extends Ke{create(e,n,r){return this._client.post(`/uploads/${e}/parts`,ma({body:n,...r}))}}class lm extends Ke{constructor(){super(...arguments),this.parts=new BE(this._client)}create(e,n){return this._client.post("/uploads",{body:e,...n})}cancel(e,n){return this._client.post(`/uploads/${e}/cancel`,n)}complete(e,n,r){return this._client.post(`/uploads/${e}/complete`,{body:n,...r})}}lm.Parts=BE;var FE;let Ue=class extends yL{constructor({baseURL:e=nu("OPENAI_BASE_URL"),apiKey:n=nu("OPENAI_API_KEY"),organization:r=nu("OPENAI_ORG_ID")??null,project:s=nu("OPENAI_PROJECT_ID")??null,...a}={}){if(n===void 0)throw new De("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:n,organization:r,project:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&NL())throw new De(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new xE(this),this.chat=new $f(this),this.embeddings=new LE(this),this.files=new nm(this),this.images=new DE(this),this.audio=new bo(this),this.moderations=new ME(this),this.models=new um(this),this.fineTuning=new Eo(this),this.beta=new Jr(this),this.batches=new qf(this),this.uploads=new lm(this),this._options=i,this.apiKey=n,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return nL(e,{arrayFormat:"brackets"})}};FE=Ue;Ue.OpenAI=FE;Ue.DEFAULT_TIMEOUT=6e5;Ue.OpenAIError=De;Ue.APIError=Pt;Ue.APIConnectionError=el;Ue.APIConnectionTimeoutError=tl;Ue.APIUserAbortError=vn;Ue.NotFoundError=$1;Ue.ConflictError=q1;Ue.RateLimitError=z1;Ue.BadRequestError=U1;Ue.AuthenticationError=j1;Ue.InternalServerError=W1;Ue.PermissionDeniedError=H1;Ue.UnprocessableEntityError=V1;Ue.toFile=X1;Ue.fileFromPath=B1;Ue.Completions=xE;Ue.Chat=$f;Ue.Embeddings=LE;Ue.Files=nm;Ue.FileObjectsPage=rm;Ue.Images=DE;Ue.Audio=bo;Ue.Moderations=ME;Ue.Models=um;Ue.ModelsPage=cm;Ue.FineTuning=Eo;Ue.Beta=Jr;Ue.Batches=qf;Ue.BatchesPage=Vf;Ue.Uploads=lm;function UE(t,e){if(t.function===void 0)return;let n;if(e!=null&&e.partial)try{n=Af(t.function.arguments??"{}")}catch{return}else try{n=JSON.parse(t.function.arguments)}catch(s){throw new Vi([`Function "${t.function.name}" arguments:`,"",t.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const r={name:t.function.name,args:n,type:"tool_call"};return e!=null&&e.returnId&&(r.id=t.id),r}function GL(t){if(t.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:t.id,type:"function",function:{name:t.name,arguments:JSON.stringify(t.args)}}}function KL(t,e){var n,r;return{name:(n=t.function)==null?void 0:n.name,args:(r=t.function)==null?void 0:r.arguments,id:t.id,error:e,type:"invalid_tool_call"}}class YL extends O1{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,n=!0){var i;const r=e[0].message;let s;if(uo(r)&&((i=r.tool_calls)!=null&&i.length)?s=r.tool_calls.map(o=>{const{id:u,...c}=o;return this.returnId?{id:u,...c}:c}):r.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(r.additional_kwargs.tool_calls)).map(u=>UE(u,{returnId:this.returnId,partial:n}))),!s)return[];const a=[];for(const o of s)if(o!==void 0){const u={type:o.name,args:o.args,id:o.id};a.push(u)}return a}}class P0 extends YL{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const n=await this.zodSchema.safeParseAsync(e);if(n.success)return n.data;throw new Vi(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(n.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const r=(await super.parsePartialResult(e)).filter(a=>a.type===this.keyName);let s=r;if(r.length)return this.returnId||(s=r.map(a=>a.args)),this.returnSingle?s[0]:s}async parseResult(e){const r=(await super.parsePartialResult(e,!1)).filter(i=>i.type===this.keyName);let s=r;return r.length?(this.returnId||(s=r.map(i=>i.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(i=>this._validateResult(i)))):void 0}}const ZL=Symbol("Let zodToJsonSchema decide on which parser to use"),x0={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},JL=t=>typeof t=="string"?{...x0,basePath:["#"],definitions:{},name:t}:{...x0,basePath:["#"],definitions:{},...t},Dh=t=>"_def"in t?t._def:t;function XL(t){if(!t)return!0;for(const e in t)return!1;return!0}const QL=t=>{const e=JL(t),n=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:n,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[Dh(s),{def:Dh(s),path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function jE(t,e,n,r){r!=null&&r.errorMessages&&n&&(t.errorMessage={...t.errorMessage,[e]:n})}function Je(t,e,n,r,s){t[e]=n,jE(t,e,r,s)}function e4(){return{}}function t4(t,e){var r,s;const n={type:"array"};return((s=(r=t.type)==null?void 0:r._def)==null?void 0:s.typeName)!==q.ZodAny&&(n.items=ze(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&Je(n,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&Je(n,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(Je(n,"minItems",t.exactLength.value,t.exactLength.message,e),Je(n,"maxItems",t.exactLength.value,t.exactLength.message,e)),n}function n4(t,e){const n={type:"integer",format:"int64"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Je(n,"minimum",r.value,r.message,e):Je(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),Je(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Je(n,"maximum",r.value,r.message,e):Je(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),Je(n,"maximum",r.value,r.message,e));break;case"multipleOf":Je(n,"multipleOf",r.value,r.message,e);break}return n}function r4(){return{type:"boolean"}}function s4(t,e){return ze(t.type._def,e)}const a4=(t,e)=>ze(t.innerType._def,e);function HE(t,e,n){const r=n??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,a)=>HE(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return i4(t,e)}}const i4=(t,e)=>{const n={type:"integer",format:"unix-time"};if(e.target==="openApi3")return n;for(const r of t.checks)switch(r.kind){case"min":Je(n,"minimum",r.value,r.message,e);break;case"max":Je(n,"maximum",r.value,r.message,e);break}return n};function o4(t,e){return{...ze(t.innerType._def,e),default:t.defaultValue()}}function u4(t,e,n){return e.effectStrategy==="input"?ze(t.schema._def,e,n):{}}function c4(t){return{type:"string",enum:[...t.values]}}const l4=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function d4(t,e){const n=[ze(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),ze(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return n.forEach(a=>{if(l4(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...u}=a;i=u}else r=void 0;s.push(i)}}),s.length?{allOf:s,...r}:void 0}function h4(t,e){const n=typeof t.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[t.value]}:{type:n==="bigint"?"integer":n,const:t.value}}let Ed;const es={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Ed===void 0&&(Ed=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ed),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function $E(t,e){const n={type:"string"};function r(s){return e.patternStrategy==="escape"?f4(s):s}if(t.checks)for(const s of t.checks)switch(s.kind){case"min":Je(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,s.value):s.value,s.message,e);break;case"max":Je(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Pn(n,"email",s.message,e);break;case"format:idn-email":Pn(n,"idn-email",s.message,e);break;case"pattern:zod":xn(n,es.email,s.message,e);break}break;case"url":Pn(n,"uri",s.message,e);break;case"uuid":Pn(n,"uuid",s.message,e);break;case"regex":xn(n,s.regex,s.message,e);break;case"cuid":xn(n,es.cuid,s.message,e);break;case"cuid2":xn(n,es.cuid2,s.message,e);break;case"startsWith":xn(n,RegExp(`^${r(s.value)}`),s.message,e);break;case"endsWith":xn(n,RegExp(`${r(s.value)}$`),s.message,e);break;case"datetime":Pn(n,"date-time",s.message,e);break;case"date":Pn(n,"date",s.message,e);break;case"time":Pn(n,"time",s.message,e);break;case"duration":Pn(n,"duration",s.message,e);break;case"length":Je(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,s.value):s.value,s.message,e),Je(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,s.value):s.value,s.message,e);break;case"includes":{xn(n,RegExp(r(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&Pn(n,"ipv4",s.message,e),s.version!=="v4"&&Pn(n,"ipv6",s.message,e);break}case"emoji":xn(n,es.emoji,s.message,e);break;case"ulid":{xn(n,es.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Pn(n,"binary",s.message,e);break}case"contentEncoding:base64":{Je(n,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{xn(n,es.base64,s.message,e);break}}break}case"nanoid":xn(n,es.nanoid,s.message,e)}return n}const f4=t=>Array.from(t).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Pn=(t,e,n,r)=>{var s;t.format||(s=t.anyOf)!=null&&s.some(a=>a.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&r.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Je(t,"format",e,n,r)},xn=(t,e,n,r)=>{var s;t.pattern||(s=t.allOf)!=null&&s.some(a=>a.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&r.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:L0(e,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Je(t,"pattern",L0(e,r),n,r)},L0=(t,e)=>{var c;const n=typeof t=="function"?t():t;if(!e.applyRegexFlags||!n.flags)return n.source;const r={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},s=r.i?n.source.toLowerCase():n.source;let a="",i=!1,o=!1,u=!1;for(let l=0;l<s.length;l++){if(i){a+=s[l],i=!1;continue}if(r.i){if(o){if(s[l].match(/[a-z]/)){u?(a+=s[l],a+=`${s[l-2]}-${s[l]}`.toUpperCase(),u=!1):s[l+1]==="-"&&((c=s[l+2])!=null&&c.match(/[a-z]/))?(a+=s[l],u=!0):a+=`${s[l]}${s[l].toUpperCase()}`;continue}}else if(s[l].match(/[a-z]/)){a+=`[${s[l]}${s[l].toUpperCase()}]`;continue}}if(r.m){if(s[l]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(s[l]==="$"){a+=`($|(?=[\r
]))`;continue}}if(r.s&&s[l]==="."){a+=o?`${s[l]}\r
`:`[${s[l]}\r
]`;continue}a+=s[l],s[l]==="\\"?i=!0:o&&s[l]==="]"?o=!1:!o&&s[l]==="["&&(o=!0)}try{const l=new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return a};function qE(t,e){var r,s,a,i;if(e.target==="openApi3"&&((r=t.keyType)==null?void 0:r._def.typeName)===q.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((o,u)=>({...o,[u]:ze(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",u]})??{}}),{}),additionalProperties:!1};const n={type:"object",additionalProperties:ze(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return n;if(((s=t.keyType)==null?void 0:s._def.typeName)===q.ZodString&&((a=t.keyType._def.checks)!=null&&a.length)){const o=Object.entries($E(t.keyType._def,e)).reduce((u,[c,l])=>c==="type"?u:{...u,[c]:l},{});return{...n,propertyNames:o}}else if(((i=t.keyType)==null?void 0:i._def.typeName)===q.ZodEnum)return{...n,propertyNames:{enum:t.keyType._def.values}};return n}function m4(t,e){if(e.mapStrategy==="record")return qE(t,e);const n=ze(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=ze(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function p4(t){const e=t.values,r=Object.keys(t.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(r.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function g4(){return{not:{}}}function b4(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const uc={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function _4(t,e){if(e.target==="openApi3")return D0(t,e);const n=t.options instanceof Map?Array.from(t.options.values()):t.options;if(n.every(r=>r._def.typeName in uc&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((s,a)=>{const i=uc[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===n.length){const s=r.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:n.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,s)=>[...r,...s._def.values.filter(a=>!r.includes(a))],[])};return D0(t,e)}const D0=(t,e)=>{const n=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>ze(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function y4(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:uc[t.innerType._def.typeName],nullable:!0}:{type:[uc[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=ze(t.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=ze(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function E4(t,e){const n={type:"number"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"int":n.type="integer",jE(n,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Je(n,"minimum",r.value,r.message,e):Je(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),Je(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Je(n,"maximum",r.value,r.message,e):Je(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),Je(n,"maximum",r.value,r.message,e));break;case"multipleOf":Je(n,"multipleOf",r.value,r.message,e);break}return n}function w4(t,e){return e.removeAdditionalStrategy==="strict"?t.catchall._def.typeName==="ZodNever"?t.unknownKeys!=="strict":ze(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:t.catchall._def.typeName==="ZodNever"?t.unknownKeys==="passthrough":ze(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function T4(t,e){const n={type:"object",...Object.entries(t.shape()).reduce((r,[s,a])=>{if(a===void 0||a._def===void 0)return r;const i=ze(a._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return i===void 0?r:{properties:{...r.properties,[s]:i},required:a.isOptional()&&!e.openaiStrictMode?r.required:[...r.required,s]}},{properties:{},required:[]}),additionalProperties:w4(t,e)};return n.required.length||delete n.required,n}const S4=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return ze(t.innerType._def,e);const n=ze(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}},A4=(t,e)=>{if(e.pipeStrategy==="input")return ze(t.in._def,e);if(e.pipeStrategy==="output")return ze(t.out._def,e);const n=ze(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=ze(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(s=>s!==void 0)}};function C4(t,e){return ze(t.type._def,e)}function v4(t,e){const r={type:"array",uniqueItems:!0,items:ze(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&Je(r,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&Je(r,"maxItems",t.maxSize.value,t.maxSize.message,e),r}function O4(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((n,r)=>ze(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:ze(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((n,r)=>ze(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function I4(){return{not:{}}}function k4(){return{}}const N4=(t,e)=>ze(t.innerType._def,e);function ze(t,e,n=!1){var i;const r=e.seen.get(t);if(e.override){const o=(i=e.override)==null?void 0:i.call(e,t,e,r,n);if(o!==ZL)return o}if(r&&!n){const o=R4(r,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);const a=x4(t,t.typeName,e,n);return a&&L4(t,e,a),s.jsonSchema=a,a}const R4=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"extract-to-root":const n=t.path.slice(e.basePath.length+1).join("_");return n!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[n]=t.def),{$ref:[...e.basePath,e.definitionPath,n].join("/")};case"relative":return{$ref:P4(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,s)=>e.currentPath[s]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},P4=(t,e)=>{let n=0;for(;n<t.length&&n<e.length&&t[n]===e[n];n++);return[(t.length-n).toString(),...e.slice(n)].join("/")},x4=(t,e,n,r)=>{switch(e){case q.ZodString:return $E(t,n);case q.ZodNumber:return E4(t,n);case q.ZodObject:return T4(t,n);case q.ZodBigInt:return n4(t,n);case q.ZodBoolean:return r4();case q.ZodDate:return HE(t,n);case q.ZodUndefined:return I4();case q.ZodNull:return b4(n);case q.ZodArray:return t4(t,n);case q.ZodUnion:case q.ZodDiscriminatedUnion:return _4(t,n);case q.ZodIntersection:return d4(t,n);case q.ZodTuple:return O4(t,n);case q.ZodRecord:return qE(t,n);case q.ZodLiteral:return h4(t,n);case q.ZodEnum:return c4(t);case q.ZodNativeEnum:return p4(t);case q.ZodNullable:return y4(t,n);case q.ZodOptional:return S4(t,n);case q.ZodMap:return m4(t,n);case q.ZodSet:return v4(t,n);case q.ZodLazy:return ze(t.getter()._def,n);case q.ZodPromise:return C4(t,n);case q.ZodNaN:case q.ZodNever:return g4();case q.ZodEffects:return u4(t,n,r);case q.ZodAny:return e4();case q.ZodUnknown:return k4();case q.ZodDefault:return o4(t,n);case q.ZodBranded:return s4(t,n);case q.ZodReadonly:return N4(t,n);case q.ZodCatch:return a4(t,n);case q.ZodPipeline:return A4(t,n);case q.ZodFunction:case q.ZodVoid:case q.ZodSymbol:return;default:return(s=>{})()}},L4=(t,e,n)=>(t.description&&(n.description=t.description,e.markdownDescription&&(n.markdownDescription=t.description)),n),D4=(t,e)=>{const n=QL(e),r=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=ze(t._def,r===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,r]},!1)??{},a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(s.title=a);const i=(()=>{if(XL(n.definitions))return;const u={},c=new Set;for(let l=0;l<500;l++){const d=Object.entries(n.definitions).filter(([m])=>!c.has(m));if(d.length===0)break;for(const[m,p]of d)u[m]=ze(Dh(p),{...n,currentPath:[...n.basePath,n.definitionPath,m]},!0)??{},c.add(m)}return u})(),o=r===void 0?i?{...s,[n.definitionPath]:i}:s:n.nameStrategy==="duplicate-ref"?{...s,...i||n.seenRefs.size?{[n.definitionPath]:{...i,...n.seenRefs.size?{[r]:s}:void 0}}:void 0}:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,r].join("/"),[n.definitionPath]:{...i,[r]:s}};return n.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":n.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function VE(t,e){return D4(t,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function M4(t,e,n){return xL({type:"json_schema",json_schema:{...n,name:e,strict:!0,schema:VE(t,{name:e})}},r=>t.parse(JSON.parse(r)))}function B4(t){return LL({type:"function",function:{name:t.name,parameters:VE(t.parameters,{name:t.name}),strict:!0,...t.description?{description:t.description}:void 0}},{callback:t.function,parser:e=>t.parameters.parse(JSON.parse(e))})}function F4(t){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:n,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:a,azureADTokenProvider:i,azureOpenAIEndpoint:o}=t;if((r||i)&&s&&e)return`${s}/${e}`;if((r||i)&&o&&e)return`${o}/openai/deployments/${e}`;if(r||i){if(!n)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${n}.openai.azure.com/openai/deployments/${e}`}return a}function ou(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,t}function M0(t){let e;return t.constructor.name===tl.name?(e=new Error(t.message),e.name="TimeoutError"):t.constructor.name===vn.name?(e=new Error(t.message),e.name="AbortError"):t.status===400&&t.message.includes("tool_calls")?e=ou(t,"INVALID_TOOL_RESULTS"):t.status===401?e=ou(t,"MODEL_AUTHENTICATION"):t.status===429?e=ou(t,"MODEL_RATE_LIMIT"):t.status===404?e=ou(t,"MODEL_NOT_FOUND"):e=t,e}function U4(t){if(t)return t==="any"||t==="required"?"required":t==="auto"?"auto":t==="none"?"none":typeof t=="string"?{type:"function",function:{name:t}}:t}function j4(t){return t.anyOf!==void 0&&Array.isArray(t.anyOf)}function H4(t){const e=["namespace functions {",""];for(const n of t)n.description&&e.push(`// ${n.description}`),Object.keys(n.parameters.properties??{}).length>0?(e.push(`type ${n.name} = (_: {`),e.push(zE(n.parameters,0)),e.push("}) => any;")):e.push(`type ${n.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function zE(t,e){var r;const n=[];for(const[s,a]of Object.entries(t.properties??{}))a.description&&e<2&&n.push(`// ${a.description}`),(r=t.required)!=null&&r.includes(s)?n.push(`${s}: ${cc(a,e)},`):n.push(`${s}?: ${cc(a,e)},`);return n.map(s=>" ".repeat(e)+s).join(`
`)}function cc(t,e){if(j4(t))return t.anyOf.map(n=>cc(n,e)).join(" | ");switch(t.type){case"string":return t.enum?t.enum.map(n=>`"${n}"`).join(" | "):"string";case"number":return t.enum?t.enum.map(n=>`${n}`).join(" | "):"number";case"integer":return t.enum?t.enum.map(n=>`${n}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",zE(t,e+2),"}"].join(`
`);case"array":return t.items?`${cc(t.items,e)}[]`:"any[]";default:return""}}function $4(t,e){let n;if(A1(t)){const r=B4({name:t.name,parameters:t.schema,description:t.description});r.function.parameters?n={type:r.type,function:{name:r.function.name,description:r.function.description,parameters:r.function.parameters,...(e==null?void 0:e.strict)!==void 0?{strict:e.strict}:{}}}:n={type:"function",function:P6(t,e)}}else n=t;return(e==null?void 0:e.strict)!==void 0&&(n.function.strict=e.strict),n}function q4(t){return t.role!=="system"&&t.role!=="developer"&&t.role!=="assistant"&&t.role!=="user"&&t.role!=="function"&&t.role!=="tool"&&console.warn(`Unknown message role: ${t.role}`),t.role}function WE(t){const e=t._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!co.isInstance(t))throw new Error("Invalid generic chat message");return q4(t)}default:throw new Error(`Unknown message type: ${e}`)}}function B0(t,e){return t.flatMap(n=>{var a;let r=WE(n);r==="system"&&(e!=null&&e.startsWith("o1"))&&(r="developer");const s={role:r,content:n.content};if(n.name!=null&&(s.name=n.name),n.additional_kwargs.function_call!=null&&(s.function_call=n.additional_kwargs.function_call,s.content=null),uo(n)&&((a=n.tool_calls)!=null&&a.length)?(s.tool_calls=n.tool_calls.map(GL),s.content=null):(n.additional_kwargs.tool_calls!=null&&(s.tool_calls=n.additional_kwargs.tool_calls),n.tool_call_id!=null&&(s.tool_call_id=n.tool_call_id)),n.additional_kwargs.audio&&typeof n.additional_kwargs.audio=="object"&&"id"in n.additional_kwargs.audio){const i={role:"assistant",audio:{id:n.additional_kwargs.audio.id}};return[s,i]}return s})}function F0(t,e){return T1(t)?(e==null?void 0:e.strict)!==void 0?{...t,function:{...t.function,strict:e.strict}}:t:$4(t,e)}class Mh extends vr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}constructor(e){var n,r;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((n=e==null?void 0:e.configuration)==null?void 0:n.apiKey)??gn("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??gn("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this==null?void 0:this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const n=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:n.temperature??void 0,ls_max_tokens:n.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,n){let r;return(n==null?void 0:n.strict)!==void 0?r=n.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>F0(s,{strict:r})),...n})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&uu(e.json_schema.schema)?M4(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,n){var o;let r;(e==null?void 0:e.strict)!==void 0?r=e.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling);let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||n!=null&&n.streaming)&&(s={stream_options:{include_usage:!0}});const a={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(u=>F0(u,{strict:r})):void 0,tool_choice:U4(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(a.prediction=e.prediction);const i=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return i!==void 0&&(a.reasoning_effort=i),a}_convertOpenAIChatCompletionMessageToBaseMessage(e,n){const r=e.tool_calls;switch(e.role){case"assistant":{const s=[],a=[];for(const u of r??[])try{s.push(UE(u,{returnId:!0}))}catch(c){a.push(KL(u,c.message))}const i={function_call:e.function_call,tool_calls:r};this.__includeRawResponse!==void 0&&(i.__raw_response=n);const o={model_name:n.model,...n.system_fingerprint?{usage:{...n.usage},system_fingerprint:n.system_fingerprint}:{}};return e.audio&&(i.audio=e.audio),new ws({content:e.content||"",tool_calls:s,invalid_tool_calls:a,additional_kwargs:i,response_metadata:o,id:n.id})}default:return new co(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,n,r){var u,c;const s=e.role??r,a=e.content??"";let i;e.function_call?i={function_call:e.function_call}:e.tool_calls?i={tool_calls:e.tool_calls}:i={},this.__includeRawResponse&&(i.__raw_response=n),e.audio&&(i.audio={...e.audio,index:n.choices[0].index});const o={usage:{...n.usage}};if(s==="user")return new jc({content:a,response_metadata:o});if(s==="assistant"){const l=[];if(Array.isArray(e.tool_calls))for(const d of e.tool_calls)l.push({name:(u=d.function)==null?void 0:u.name,args:(c=d.function)==null?void 0:c.arguments,id:d.id,index:d.index,type:"tool_call_chunk"});return new Xt({content:a,tool_call_chunks:l,additional_kwargs:i,id:n.id,response_metadata:o})}else return s==="system"?new Fi({content:a,response_metadata:o}):s==="developer"?new Fi({content:a,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new Uc({content:a,additional_kwargs:i,name:e.name,response_metadata:o}):s==="tool"?new Cf({content:a,additional_kwargs:i,tool_call_id:e.tool_call_id,response_metadata:o}):new Fc({content:a,role:s,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,n,r){var c,l,d,m,p,f,g,b,_,y;const s=B0(e,this.model),a={...this.invocationParams(n,{streaming:!0}),messages:s,stream:!0};let i;const o=await this.completionWithRetry(a,n);let u;for await(const E of o){const I=(c=E==null?void 0:E.choices)==null?void 0:c[0];if(E.usage&&(u=E.usage),!I)continue;const{delta:w}=I;if(!w)continue;const O=this._convertOpenAIDeltaToBaseMessageChunk(w,E,i);i=w.role??i;const S={prompt:n.promptIndex??0,completion:I.index??0};if(typeof O.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const x={...S};I.finish_reason!=null&&(x.finish_reason=I.finish_reason,x.system_fingerprint=E.system_fingerprint,x.model_name=E.model),this.logprobs&&(x.logprobs=I.logprobs);const D=new Ts({message:O,text:O.content,generationInfo:x});yield D,await(r==null?void 0:r.handleLLMNewToken(D.text??"",S,void 0,void 0,void 0,{chunk:D}))}if(u){const E={...((l=u.prompt_tokens_details)==null?void 0:l.audio_tokens)!==null&&{audio:(d=u.prompt_tokens_details)==null?void 0:d.audio_tokens},...((m=u.prompt_tokens_details)==null?void 0:m.cached_tokens)!==null&&{cache_read:(p=u.prompt_tokens_details)==null?void 0:p.cached_tokens}},I={...((f=u.completion_tokens_details)==null?void 0:f.audio_tokens)!==null&&{audio:(g=u.completion_tokens_details)==null?void 0:g.audio_tokens},...((b=u.completion_tokens_details)==null?void 0:b.reasoning_tokens)!==null&&{reasoning:(_=u.completion_tokens_details)==null?void 0:_.reasoning_tokens}};yield new Ts({message:new Xt({content:"",response_metadata:{usage:{...u}},usage_metadata:{input_tokens:u.prompt_tokens,output_tokens:u.completion_tokens,total_tokens:u.total_tokens,...Object.keys(E).length>0&&{input_token_details:E},...Object.keys(I).length>0&&{output_token_details:I}}}),text:""})}if((y=n.signal)!=null&&y.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,n,r){var o,u;const s={},a=this.invocationParams(n),i=B0(e,this.model);if(a.stream){const c=this._streamResponseChunks(e,n,r),l={};for await(const b of c){b.message.response_metadata={...b.generationInfo,...b.message.response_metadata};const _=((o=b.generationInfo)==null?void 0:o.completion)??0;l[_]===void 0?l[_]=b:l[_]=l[_].concat(b)}const d=Object.entries(l).sort(([b],[_])=>parseInt(b,10)-parseInt(_,10)).map(([b,_])=>_),{functions:m,function_call:p}=this.invocationParams(n),f=await this.getEstimatedTokenCountFromPrompt(e,m,p),g=await this.getNumTokensFromGenerations(d);return s.input_tokens=f,s.output_tokens=g,s.total_tokens=f+g,{generations:d,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let c;n.response_format&&n.response_format.type==="json_schema"?c=await this.betaParsedCompletionWithRetry({...a,stream:!1,messages:i},{signal:n==null?void 0:n.signal,...n==null?void 0:n.options}):c=await this.completionWithRetry({...a,stream:!1,messages:i},{signal:n==null?void 0:n.signal,...n==null?void 0:n.options});const{completion_tokens:l,prompt_tokens:d,total_tokens:m,prompt_tokens_details:p,completion_tokens_details:f}=(c==null?void 0:c.usage)??{};l&&(s.output_tokens=(s.output_tokens??0)+l),d&&(s.input_tokens=(s.input_tokens??0)+d),m&&(s.total_tokens=(s.total_tokens??0)+m),((p==null?void 0:p.audio_tokens)!==null||(p==null?void 0:p.cached_tokens)!==null)&&(s.input_token_details={...(p==null?void 0:p.audio_tokens)!==null&&{audio:p==null?void 0:p.audio_tokens},...(p==null?void 0:p.cached_tokens)!==null&&{cache_read:p==null?void 0:p.cached_tokens}}),((f==null?void 0:f.audio_tokens)!==null||(f==null?void 0:f.reasoning_tokens)!==null)&&(s.output_token_details={...(f==null?void 0:f.audio_tokens)!==null&&{audio:f==null?void 0:f.audio_tokens},...(f==null?void 0:f.reasoning_tokens)!==null&&{reasoning:f==null?void 0:f.reasoning_tokens}});const g=[];for(const b of(c==null?void 0:c.choices)??[]){const y={text:((u=b.message)==null?void 0:u.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(b.message??{role:"assistant"},c)};y.generationInfo={...b.finish_reason?{finish_reason:b.finish_reason}:{},...b.logprobs?{logprobs:b.logprobs}:{}},uo(y.message)&&(y.message.usage_metadata=s),y.message=new ws(Object.fromEntries(Object.entries(y.message).filter(([E])=>!E.startsWith("lc_")))),g.push(y)}return{generations:g,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,n,r){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(n&&r!=="auto"){const a=H4(n);s+=await this.getNumTokens(a),s+=9}return n&&e.find(a=>a._getType()==="system")&&(s-=4),r==="none"?s+=1:typeof r=="object"&&(s+=await this.getNumTokens(r.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>{var s;return(s=r.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)}))).reduce((r,s)=>r+s,0)}async getNumTokensFromMessages(e){let n=0,r=0,s=0;this.model==="gpt-3.5-turbo-0301"?(r=4,s=-1):(r=3,s=1);const a=await Promise.all(e.map(async i=>{var m,p,f,g,b,_;const o=await this.getNumTokens(i.content),u=await this.getNumTokens(WE(i)),c=i.name!==void 0?s+await this.getNumTokens(i.name):0;let l=o+r+u+c;const d=i;if(d._getType()==="function"&&(l-=2),(m=d.additional_kwargs)!=null&&m.function_call&&(l+=3),(p=d==null?void 0:d.additional_kwargs.function_call)!=null&&p.name&&(l+=await this.getNumTokens((f=d.additional_kwargs.function_call)==null?void 0:f.name)),(g=d.additional_kwargs.function_call)!=null&&g.arguments)try{l+=await this.getNumTokens(JSON.stringify(JSON.parse((b=d.additional_kwargs.function_call)==null?void 0:b.arguments)))}catch(y){console.error("Error parsing function arguments",y,JSON.stringify(d.additional_kwargs.function_call)),l+=await this.getNumTokens((_=d.additional_kwargs.function_call)==null?void 0:_.arguments)}return n+=l,l}));return n+=3,{totalCount:n,countPerMessage:a}}async completionWithRetry(e,n){const r=this._getClientOptions(n);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(s){throw M0(s)}})}async betaParsedCompletionWithRetry(e,n){const r=this._getClientOptions(n);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,r)}catch(s){throw M0(s)}})}_getClientOptions(e){if(!this.client){const r={baseURL:this.clientConfig.baseURL},s=F4(r),a={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};a.baseURL||delete a.baseURL,this.client=new Ue(a)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((n,r)=>(r&&r.tokenUsage&&(n.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,n.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,n.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),n),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,n){let r,s,a,i;V4(e)?(r=e.schema,s=e.name,a=e.method,i=e.includeRaw):(r=e,s=n==null?void 0:n.name,a=n==null?void 0:n.method,i=n==null?void 0:n.includeRaw);let o,u;if((n==null?void 0:n.strict)!==void 0&&a==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?a===void 0&&(a="jsonSchema"):a==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),a==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),uu(r)?u=i0.fromZodSchema(r):u=new o0;else if(a==="jsonSchema")o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:r.description,schema:r,strict:n==null?void 0:n.strict}}}),uu(r)?u=i0.fromZodSchema(r):u=new o0;else{let m=s??"extract";if(uu(r)){const p=Ss(r);o=this.bind({tools:[{type:"function",function:{name:m,description:p.description,parameters:p}}],tool_choice:{type:"function",function:{name:m}},...(n==null?void 0:n.strict)!==void 0?{strict:n.strict}:{}}),u=new P0({returnSingle:!0,keyName:m,zodSchema:r})}else{let p;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(p=r,m=r.name):(m=r.title??m,p={name:m,description:r.description??"",parameters:r}),o=this.bind({tools:[{type:"function",function:p}],tool_choice:{type:"function",function:{name:m}},...(n==null?void 0:n.strict)!==void 0?{strict:n.strict}:{}}),u=new P0({returnSingle:!0,keyName:m})}}if(!i)return o.pipe(u);const c=fa.assign({parsed:(m,p)=>u.invoke(m.raw,p)}),l=fa.assign({parsed:()=>null}),d=c.withFallbacks({fallbacks:[l]});return lr.from([{raw:o},d])}}function uu(t){return typeof(t==null?void 0:t.parse)=="function"}function V4(t){return t!==void 0&&typeof t.schema=="object"}class z4 extends S1{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=(e==null?void 0:e.verboseParsingErrors)??this.verboseParsingErrors,this.responseFormat=(e==null?void 0:e.responseFormat)??this.responseFormat}async invoke(e,n){let r,s,a=He(n);return Sf(e)?(r=e.id,s=e.args,a={...a,toolCall:e,configurable:{...a.configurable,tool_call_id:r}}):s=e,this.call(s,a)}async call(e,n,r){let s;try{s=await this.schema.parseAsync(e)}catch(p){let f="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(f=`${f}
Details: ${p.message}`),new iy(f,JSON.stringify(e))}const a=ly(n),i=Mt.configure(a.callbacks,this.callbacks,a.tags||r,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),o=await(i==null?void 0:i.handleToolStart(this.toJSON(),typeof s=="string"?s:JSON.stringify(s),a.runId,void 0,void 0,void 0,a.runName));delete a.runId;let u;try{u=await this._call(s,o,a)}catch(p){throw await(o==null?void 0:o.handleToolError(p)),p}let c,l;if(this.responseFormat==="content_and_artifact")if(Array.isArray(u)&&u.length===2)[c,l]=u;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(u)}`);else c=u;let d;a&&"configurable"in a&&(d=a.configurable.tool_call_id);const m=G4({content:c,artifact:l,toolCallId:d,name:this.name});return await(o==null?void 0:o.handleToolEnd(m)),m}}class W4 extends z4{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:Or.object({input:Or.string().optional()}).transform(n=>n.input)})}call(e,n){return super.call(typeof e=="string"||!e?{input:e}:e,n)}}function G4(t){const{content:e,artifact:n,toolCallId:r}=t;return r&&!mN(e)?typeof e=="string"||Array.isArray(e)&&e.every(s=>typeof s=="object")?new ah({content:e,artifact:n,tool_call_id:r,name:t.name}):new ah({content:K4(e),artifact:n,tool_call_id:r,name:t.name}):e}function K4(t){try{return JSON.stringify(t,null,2)}catch{return`${t}`}}class Y4 extends W4{static lc_name(){return"SearxngSearch"}get lc_secrets(){return{apiBase:"SEARXNG_API_BASE"}}constructor({apiBase:e,params:n,headers:r}){if(super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"searxng-search"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A meta search engine. Useful for when you need to answer questions about current events. Input should be a search query. Output is a JSON array of the query results"}),Object.defineProperty(this,"apiBase",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:{numResults:10,pageNumber:1,format:"json",imageProxy:!0,safesearch:0}}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.apiBase=gn("SEARXNG_API_BASE")||e,this.headers={"content-type":"application/json",...r},!this.apiBase)throw new Error('SEARXNG_API_BASE not set. You can set it as "SEARXNG_API_BASE" in your environment variables.');n&&(this.params={...this.params,...n})}buildUrl(e,n,r){const s=Object.entries(n).filter(([i,o])=>o!==void 0).map(([i,o])=>[i,o.toString()]),a=new URLSearchParams(s);return`${r}/${e}?${a}`}async _call(e){var i,o;const n={q:e,...this.params},r=this.buildUrl("search",n,this.apiBase),s=await fetch(r,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(5*1e3)});if(!s.ok)throw new Error(s.statusText);const a=await s.json();if(!a.results.length&&!a.answers.length&&!a.infoboxes.length&&!a.suggestions.length)return"No good results found.";if(a.results.length){const u=[];return a.results.forEach(c=>{u.push(JSON.stringify({title:c.title||"",link:c.url||"",snippet:c.content||""}))}),u.slice(0,(i=this.params)==null?void 0:i.numResults).toString()}else{if(a.answers.length)return a.answers[0];if(a.infoboxes.length)return(o=a.infoboxes[0])==null?void 0:o.content.replaceAll(/<[^>]+>/gi,"");if(a.suggestions.length){let u="Suggestions: ";return a.suggestions.forEach(c=>{u+=`${c}, `}),u}else return"No good results found."}}}var Ge;(function(t){t.Root="root",t.Text="text",t.Directive="directive",t.Comment="comment",t.Script="script",t.Style="style",t.Tag="tag",t.CDATA="cdata",t.Doctype="doctype"})(Ge||(Ge={}));function Z4(t){return t.type===Ge.Tag||t.type===Ge.Script||t.type===Ge.Style}const J4=Ge.Root,X4=Ge.Text,Q4=Ge.Directive,eD=Ge.Comment,tD=Ge.Script,nD=Ge.Style,rD=Ge.Tag,sD=Ge.CDATA,aD=Ge.Doctype;class GE{constructor(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}get parentNode(){return this.parent}set parentNode(e){this.parent=e}get previousSibling(){return this.prev}set previousSibling(e){this.prev=e}get nextSibling(){return this.next}set nextSibling(e){this.next=e}cloneNode(e=!1){return Ki(this,e)}}class dm extends GE{constructor(e){super(),this.data=e}get nodeValue(){return this.data}set nodeValue(e){this.data=e}}class Gi extends dm{constructor(){super(...arguments),this.type=Ge.Text}get nodeType(){return 3}}class hm extends dm{constructor(){super(...arguments),this.type=Ge.Comment}get nodeType(){return 8}}class fm extends dm{constructor(e,n){super(n),this.name=e,this.type=Ge.Directive}get nodeType(){return 1}}class mm extends GE{constructor(e){super(),this.children=e}get firstChild(){var e;return(e=this.children[0])!==null&&e!==void 0?e:null}get lastChild(){return this.children.length>0?this.children[this.children.length-1]:null}get childNodes(){return this.children}set childNodes(e){this.children=e}}class KE extends mm{constructor(){super(...arguments),this.type=Ge.CDATA}get nodeType(){return 4}}class Os extends mm{constructor(){super(...arguments),this.type=Ge.Root}get nodeType(){return 9}}class pm extends mm{constructor(e,n,r=[],s=e==="script"?Ge.Script:e==="style"?Ge.Style:Ge.Tag){super(r),this.name=e,this.attribs=n,this.type=s}get nodeType(){return 1}get tagName(){return this.name}set tagName(e){this.name=e}get attributes(){return Object.keys(this.attribs).map(e=>{var n,r;return{name:e,value:this.attribs[e],namespace:(n=this["x-attribsNamespace"])===null||n===void 0?void 0:n[e],prefix:(r=this["x-attribsPrefix"])===null||r===void 0?void 0:r[e]}})}}function be(t){return Z4(t)}function al(t){return t.type===Ge.CDATA}function mr(t){return t.type===Ge.Text}function il(t){return t.type===Ge.Comment}function Bh(t){return t.type===Ge.Directive}function Xr(t){return t.type===Ge.Root}function ht(t){return Object.prototype.hasOwnProperty.call(t,"children")}function Ki(t,e=!1){let n;if(mr(t))n=new Gi(t.data);else if(il(t))n=new hm(t.data);else if(be(t)){const r=e?wd(t.children):[],s=new pm(t.name,{...t.attribs},r);r.forEach(a=>a.parent=s),t.namespace!=null&&(s.namespace=t.namespace),t["x-attribsNamespace"]&&(s["x-attribsNamespace"]={...t["x-attribsNamespace"]}),t["x-attribsPrefix"]&&(s["x-attribsPrefix"]={...t["x-attribsPrefix"]}),n=s}else if(al(t)){const r=e?wd(t.children):[],s=new KE(r);r.forEach(a=>a.parent=s),n=s}else if(Xr(t)){const r=e?wd(t.children):[],s=new Os(r);r.forEach(a=>a.parent=s),t["x-mode"]&&(s["x-mode"]=t["x-mode"]),n=s}else if(Bh(t)){const r=new fm(t.name,t.data);t["x-name"]!=null&&(r["x-name"]=t["x-name"],r["x-publicId"]=t["x-publicId"],r["x-systemId"]=t["x-systemId"]),n=r}else throw new Error(`Not implemented yet: ${t.type}`);return n.startIndex=t.startIndex,n.endIndex=t.endIndex,t.sourceCodeLocation!=null&&(n.sourceCodeLocation=t.sourceCodeLocation),n}function wd(t){const e=t.map(n=>Ki(n,!0));for(let n=1;n<e.length;n++)e[n].prev=e[n-1],e[n-1].next=e[n];return e}const U0={withStartIndices:!1,withEndIndices:!1,xmlMode:!1};class iD{constructor(e,n,r){this.dom=[],this.root=new Os(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof n=="function"&&(r=n,n=U0),typeof e=="object"&&(n=e,e=void 0),this.callback=e??null,this.options=n??U0,this.elementCB=r??null}onparserinit(e){this.parser=e}onreset(){this.dom=[],this.root=new Os(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null}onend(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))}onerror(e){this.handleCallback(e)}onclosetag(){this.lastNode=null;const e=this.tagStack.pop();this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(e)}onopentag(e,n){const r=this.options.xmlMode?Ge.Tag:void 0,s=new pm(e,n,void 0,r);this.addNode(s),this.tagStack.push(s)}ontext(e){const{lastNode:n}=this;if(n&&n.type===Ge.Text)n.data+=e,this.options.withEndIndices&&(n.endIndex=this.parser.endIndex);else{const r=new Gi(e);this.addNode(r),this.lastNode=r}}oncomment(e){if(this.lastNode&&this.lastNode.type===Ge.Comment){this.lastNode.data+=e;return}const n=new hm(e);this.addNode(n),this.lastNode=n}oncommentend(){this.lastNode=null}oncdatastart(){const e=new Gi(""),n=new KE([e]);this.addNode(n),e.parent=n,this.lastNode=e}oncdataend(){this.lastNode=null}onprocessinginstruction(e,n){const r=new fm(e,n);this.addNode(r)}handleCallback(e){if(typeof this.callback=="function")this.callback(e,this.dom);else if(e)throw e}addNode(e){const n=this.tagStack[this.tagStack.length-1],r=n.children[n.children.length-1];this.options.withStartIndices&&(e.startIndex=this.parser.startIndex),this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),n.children.push(e),r&&(e.prev=r,r.next=e),e.parent=n,this.lastNode=null}}const gm=new Uint16Array('ᵁ<Õıʊҝջאٵ۞ޢߖࠏ੊ઑඡ๭༉༦჊ረዡᐕᒝᓃᓟᔥ\0\0\0\0\0\0ᕫᛍᦍᰒᷝ὾⁠↰⊍⏀⏻⑂⠤⤒ⴈ⹈⿎〖㊺㘹㞬㣾㨨㩱㫠㬮ࠀEMabcfglmnoprstu\\bfms¦³¹ÈÏlig耻Æ䃆P耻&䀦cute耻Á䃁reve;䄂Āiyx}rc耻Â䃂;䐐r;쀀𝔄rave耻À䃀pha;䎑acr;䄀d;橓Āgp¡on;䄄f;쀀𝔸plyFunction;恡ing耻Å䃅Ācs¾Ãr;쀀𝒜ign;扔ilde耻Ã䃃ml耻Ä䃄ЀaceforsuåûþėĜĢħĪĀcrêòkslash;或Ŷöø;櫧ed;挆y;䐑ƀcrtąċĔause;戵noullis;愬a;䎒r;쀀𝔅pf;쀀𝔹eve;䋘còēmpeq;扎܀HOacdefhilorsuōőŖƀƞƢƵƷƺǜȕɳɸɾcy;䐧PY耻©䂩ƀcpyŝŢźute;䄆Ā;iŧŨ拒talDifferentialD;慅leys;愭ȀaeioƉƎƔƘron;䄌dil耻Ç䃇rc;䄈nint;戰ot;䄊ĀdnƧƭilla;䂸terDot;䂷òſi;䎧rcleȀDMPTǇǋǑǖot;抙inus;抖lus;投imes;抗oĀcsǢǸkwiseContourIntegral;戲eCurlyĀDQȃȏoubleQuote;思uote;怙ȀlnpuȞȨɇɕonĀ;eȥȦ户;橴ƀgitȯȶȺruent;扡nt;戯ourIntegral;戮ĀfrɌɎ;愂oduct;成nterClockwiseContourIntegral;戳oss;樯cr;쀀𝒞pĀ;Cʄʅ拓ap;才րDJSZacefiosʠʬʰʴʸˋ˗ˡ˦̳ҍĀ;oŹʥtrahd;椑cy;䐂cy;䐅cy;䐏ƀgrsʿ˄ˇger;怡r;憡hv;櫤Āayː˕ron;䄎;䐔lĀ;t˝˞戇a;䎔r;쀀𝔇Āaf˫̧Ācm˰̢riticalȀADGT̖̜̀̆cute;䂴oŴ̋̍;䋙bleAcute;䋝rave;䁠ilde;䋜ond;拄ferentialD;慆Ѱ̽\0\0\0͔͂\0Ѕf;쀀𝔻ƀ;DE͈͉͍䂨ot;惜qual;扐blèCDLRUVͣͲ΂ϏϢϸontourIntegraìȹoɴ͹\0\0ͻ»͉nArrow;懓Āeo·ΤftƀARTΐΖΡrrow;懐ightArrow;懔eåˊngĀLRΫτeftĀARγιrrow;柸ightArrow;柺ightArrow;柹ightĀATϘϞrrow;懒ee;抨pɁϩ\0\0ϯrrow;懑ownArrow;懕erticalBar;戥ǹABLRTaВЪаўѿͼrrowƀ;BUНОТ憓ar;椓pArrow;懵reve;䌑eft˒к\0ц\0ѐightVector;楐eeVector;楞ectorĀ;Bљњ憽ar;楖ightǔѧ\0ѱeeVector;楟ectorĀ;BѺѻ懁ar;楗eeĀ;A҆҇护rrow;憧ĀctҒҗr;쀀𝒟rok;䄐ࠀNTacdfglmopqstuxҽӀӄӋӞӢӧӮӵԡԯԶՒ՝ՠեG;䅊H耻Ð䃐cute耻É䃉ƀaiyӒӗӜron;䄚rc耻Ê䃊;䐭ot;䄖r;쀀𝔈rave耻È䃈ement;戈ĀapӺӾcr;䄒tyɓԆ\0\0ԒmallSquare;旻erySmallSquare;斫ĀgpԦԪon;䄘f;쀀𝔼silon;䎕uĀaiԼՉlĀ;TՂՃ橵ilde;扂librium;懌Āci՗՚r;愰m;橳a;䎗ml耻Ë䃋Āipժկsts;戃onentialE;慇ʀcfiosօֈ֍ֲ׌y;䐤r;쀀𝔉lledɓ֗\0\0֣mallSquare;旼erySmallSquare;斪Ͱֺ\0ֿ\0\0ׄf;쀀𝔽All;戀riertrf;愱cò׋؀JTabcdfgorstר׬ׯ׺؀ؒؖ؛؝أ٬ٲcy;䐃耻>䀾mmaĀ;d׷׸䎓;䏜reve;䄞ƀeiy؇،ؐdil;䄢rc;䄜;䐓ot;䄠r;쀀𝔊;拙pf;쀀𝔾eater̀EFGLSTصلَٖٛ٦qualĀ;Lؾؿ扥ess;招ullEqual;执reater;檢ess;扷lantEqual;橾ilde;扳cr;쀀𝒢;扫ЀAacfiosuڅڋږڛڞڪھۊRDcy;䐪Āctڐڔek;䋇;䁞irc;䄤r;愌lbertSpace;愋ǰگ\0ڲf;愍izontalLine;攀Āctۃۅòکrok;䄦mpńېۘownHumðįqual;扏܀EJOacdfgmnostuۺ۾܃܇܎ܚܞܡܨ݄ݸދޏޕcy;䐕lig;䄲cy;䐁cute耻Í䃍Āiyܓܘrc耻Î䃎;䐘ot;䄰r;愑rave耻Ì䃌ƀ;apܠܯܿĀcgܴܷr;䄪inaryI;慈lieóϝǴ݉\0ݢĀ;eݍݎ戬Āgrݓݘral;戫section;拂isibleĀCTݬݲomma;恣imes;恢ƀgptݿރވon;䄮f;쀀𝕀a;䎙cr;愐ilde;䄨ǫޚ\0ޞcy;䐆l耻Ï䃏ʀcfosuެ޷޼߂ߐĀiyޱ޵rc;䄴;䐙r;쀀𝔍pf;쀀𝕁ǣ߇\0ߌr;쀀𝒥rcy;䐈kcy;䐄΀HJacfosߤߨ߽߬߱ࠂࠈcy;䐥cy;䐌ppa;䎚Āey߶߻dil;䄶;䐚r;쀀𝔎pf;쀀𝕂cr;쀀𝒦րJTaceflmostࠥࠩࠬࡐࡣ঳সে্਷ੇcy;䐉耻<䀼ʀcmnpr࠷࠼ࡁࡄࡍute;䄹bda;䎛g;柪lacetrf;愒r;憞ƀaeyࡗ࡜ࡡron;䄽dil;䄻;䐛Āfsࡨ॰tԀACDFRTUVarࡾࢩࢱࣦ࣠ࣼयज़ΐ४Ānrࢃ࢏gleBracket;柨rowƀ;BR࢙࢚࢞憐ar;懤ightArrow;懆eiling;挈oǵࢷ\0ࣃbleBracket;柦nǔࣈ\0࣒eeVector;楡ectorĀ;Bࣛࣜ懃ar;楙loor;挊ightĀAV࣯ࣵrrow;憔ector;楎Āerँगeƀ;AVउऊऐ抣rrow;憤ector;楚iangleƀ;BEतथऩ抲ar;槏qual;抴pƀDTVषूौownVector;楑eeVector;楠ectorĀ;Bॖॗ憿ar;楘ectorĀ;B॥०憼ar;楒ightáΜs̀EFGLSTॾঋকঝঢভqualGreater;拚ullEqual;扦reater;扶ess;檡lantEqual;橽ilde;扲r;쀀𝔏Ā;eঽা拘ftarrow;懚idot;䄿ƀnpw৔ਖਛgȀLRlr৞৷ਂਐeftĀAR০৬rrow;柵ightArrow;柷ightArrow;柶eftĀarγਊightáοightáϊf;쀀𝕃erĀLRਢਬeftArrow;憙ightArrow;憘ƀchtਾੀੂòࡌ;憰rok;䅁;扪Ѐacefiosuਗ਼੝੠੷੼અઋ઎p;椅y;䐜Ādl੥੯iumSpace;恟lintrf;愳r;쀀𝔐nusPlus;戓pf;쀀𝕄cò੶;䎜ҀJacefostuણધભીଔଙඑ඗ඞcy;䐊cute;䅃ƀaey઴હાron;䅇dil;䅅;䐝ƀgswે૰଎ativeƀMTV૓૟૨ediumSpace;怋hiĀcn૦૘ë૙eryThiî૙tedĀGL૸ଆreaterGreateòٳessLesóੈLine;䀊r;쀀𝔑ȀBnptଢନଷ଺reak;恠BreakingSpace;䂠f;愕ڀ;CDEGHLNPRSTV୕ୖ୪୼஡௫ఄ౞಄ದ೘ൡඅ櫬Āou୛୤ngruent;扢pCap;扭oubleVerticalBar;戦ƀlqxஃஊ஛ement;戉ualĀ;Tஒஓ扠ilde;쀀≂̸ists;戄reater΀;EFGLSTஶஷ஽௉௓௘௥扯qual;扱ullEqual;쀀≧̸reater;쀀≫̸ess;批lantEqual;쀀⩾̸ilde;扵umpń௲௽ownHump;쀀≎̸qual;쀀≏̸eĀfsఊధtTriangleƀ;BEచఛడ拪ar;쀀⧏̸qual;括s̀;EGLSTవశ఼ౄోౘ扮qual;扰reater;扸ess;쀀≪̸lantEqual;쀀⩽̸ilde;扴estedĀGL౨౹reaterGreater;쀀⪢̸essLess;쀀⪡̸recedesƀ;ESಒಓಛ技qual;쀀⪯̸lantEqual;拠ĀeiಫಹverseElement;戌ghtTriangleƀ;BEೋೌ೒拫ar;쀀⧐̸qual;拭ĀquೝഌuareSuĀbp೨೹setĀ;E೰ೳ쀀⊏̸qual;拢ersetĀ;Eഃആ쀀⊐̸qual;拣ƀbcpഓതൎsetĀ;Eഛഞ쀀⊂⃒qual;抈ceedsȀ;ESTലള഻െ抁qual;쀀⪰̸lantEqual;拡ilde;쀀≿̸ersetĀ;E൘൛쀀⊃⃒qual;抉ildeȀ;EFT൮൯൵ൿ扁qual;扄ullEqual;扇ilde;扉erticalBar;戤cr;쀀𝒩ilde耻Ñ䃑;䎝܀Eacdfgmoprstuvලෂ෉෕ෛ෠෧෼ขภยา฿ไlig;䅒cute耻Ó䃓Āiy෎ීrc耻Ô䃔;䐞blac;䅐r;쀀𝔒rave耻Ò䃒ƀaei෮ෲ෶cr;䅌ga;䎩cron;䎟pf;쀀𝕆enCurlyĀDQฎบoubleQuote;怜uote;怘;橔Āclวฬr;쀀𝒪ash耻Ø䃘iŬื฼de耻Õ䃕es;樷ml耻Ö䃖erĀBP๋๠Āar๐๓r;怾acĀek๚๜;揞et;掴arenthesis;揜Ҁacfhilors๿ງຊຏຒດຝະ໼rtialD;戂y;䐟r;쀀𝔓i;䎦;䎠usMinus;䂱Āipຢອncareplanåڝf;愙Ȁ;eio຺ູ໠໤檻cedesȀ;EST່້໏໚扺qual;檯lantEqual;扼ilde;找me;怳Ādp໩໮uct;戏ortionĀ;aȥ໹l;戝Āci༁༆r;쀀𝒫;䎨ȀUfos༑༖༛༟OT耻"䀢r;쀀𝔔pf;愚cr;쀀𝒬؀BEacefhiorsu༾གྷཇའཱིྦྷྪྭ႖ႩႴႾarr;椐G耻®䂮ƀcnrཎནབute;䅔g;柫rĀ;tཛྷཝ憠l;椖ƀaeyཧཬཱron;䅘dil;䅖;䐠Ā;vླྀཹ愜erseĀEUྂྙĀlq྇ྎement;戋uilibrium;懋pEquilibrium;楯r»ཹo;䎡ghtЀACDFTUVa࿁࿫࿳ဢဨၛႇϘĀnr࿆࿒gleBracket;柩rowƀ;BL࿜࿝࿡憒ar;懥eftArrow;懄eiling;按oǵ࿹\0စbleBracket;柧nǔည\0နeeVector;楝ectorĀ;Bဝသ懂ar;楕loor;挋Āerိ၃eƀ;AVဵံြ抢rrow;憦ector;楛iangleƀ;BEၐၑၕ抳ar;槐qual;抵pƀDTVၣၮၸownVector;楏eeVector;楜ectorĀ;Bႂႃ憾ar;楔ectorĀ;B႑႒懀ar;楓Āpuႛ႞f;愝ndImplies;楰ightarrow;懛ĀchႹႼr;愛;憱leDelayed;槴ڀHOacfhimoqstuფჱჷჽᄙᄞᅑᅖᅡᅧᆵᆻᆿĀCcჩხHcy;䐩y;䐨FTcy;䐬cute;䅚ʀ;aeiyᄈᄉᄎᄓᄗ檼ron;䅠dil;䅞rc;䅜;䐡r;쀀𝔖ortȀDLRUᄪᄴᄾᅉownArrow»ОeftArrow»࢚ightArrow»࿝pArrow;憑gma;䎣allCircle;战pf;쀀𝕊ɲᅭ\0\0ᅰt;戚areȀ;ISUᅻᅼᆉᆯ斡ntersection;抓uĀbpᆏᆞsetĀ;Eᆗᆘ抏qual;抑ersetĀ;Eᆨᆩ抐qual;抒nion;抔cr;쀀𝒮ar;拆ȀbcmpᇈᇛሉላĀ;sᇍᇎ拐etĀ;Eᇍᇕqual;抆ĀchᇠህeedsȀ;ESTᇭᇮᇴᇿ扻qual;檰lantEqual;扽ilde;承Tháྌ;我ƀ;esሒሓሣ拑rsetĀ;Eሜም抃qual;抇et»ሓրHRSacfhiorsሾቄ቉ቕ቞ቱቶኟዂወዑORN耻Þ䃞ADE;愢ĀHc቎ቒcy;䐋y;䐦Ābuቚቜ;䀉;䎤ƀaeyብቪቯron;䅤dil;䅢;䐢r;쀀𝔗Āeiቻ኉ǲኀ\0ኇefore;戴a;䎘Ācn኎ኘkSpace;쀀  Space;怉ldeȀ;EFTካኬኲኼ戼qual;扃ullEqual;扅ilde;扈pf;쀀𝕋ipleDot;惛Āctዖዛr;쀀𝒯rok;䅦ૡዷጎጚጦ\0ጬጱ\0\0\0\0\0ጸጽ፷ᎅ\0᏿ᐄᐊᐐĀcrዻጁute耻Ú䃚rĀ;oጇገ憟cir;楉rǣጓ\0጖y;䐎ve;䅬Āiyጞጣrc耻Û䃛;䐣blac;䅰r;쀀𝔘rave耻Ù䃙acr;䅪Ādiፁ፩erĀBPፈ፝Āarፍፐr;䁟acĀekፗፙ;揟et;掵arenthesis;揝onĀ;P፰፱拃lus;抎Āgp፻፿on;䅲f;쀀𝕌ЀADETadps᎕ᎮᎸᏄϨᏒᏗᏳrrowƀ;BDᅐᎠᎤar;椒ownArrow;懅ownArrow;憕quilibrium;楮eeĀ;AᏋᏌ报rrow;憥ownáϳerĀLRᏞᏨeftArrow;憖ightArrow;憗iĀ;lᏹᏺ䏒on;䎥ing;䅮cr;쀀𝒰ilde;䅨ml耻Ü䃜ҀDbcdefosvᐧᐬᐰᐳᐾᒅᒊᒐᒖash;披ar;櫫y;䐒ashĀ;lᐻᐼ抩;櫦Āerᑃᑅ;拁ƀbtyᑌᑐᑺar;怖Ā;iᑏᑕcalȀBLSTᑡᑥᑪᑴar;戣ine;䁼eparator;杘ilde;所ThinSpace;怊r;쀀𝔙pf;쀀𝕍cr;쀀𝒱dash;抪ʀcefosᒧᒬᒱᒶᒼirc;䅴dge;拀r;쀀𝔚pf;쀀𝕎cr;쀀𝒲Ȁfiosᓋᓐᓒᓘr;쀀𝔛;䎞pf;쀀𝕏cr;쀀𝒳ҀAIUacfosuᓱᓵᓹᓽᔄᔏᔔᔚᔠcy;䐯cy;䐇cy;䐮cute耻Ý䃝Āiyᔉᔍrc;䅶;䐫r;쀀𝔜pf;쀀𝕐cr;쀀𝒴ml;䅸ЀHacdefosᔵᔹᔿᕋᕏᕝᕠᕤcy;䐖cute;䅹Āayᕄᕉron;䅽;䐗ot;䅻ǲᕔ\0ᕛoWidtè૙a;䎖r;愨pf;愤cr;쀀𝒵௡ᖃᖊᖐ\0ᖰᖶᖿ\0\0\0\0ᗆᗛᗫᙟ᙭\0ᚕ᚛ᚲᚹ\0ᚾcute耻á䃡reve;䄃̀;Ediuyᖜᖝᖡᖣᖨᖭ戾;쀀∾̳;房rc耻â䃢te肻´̆;䐰lig耻æ䃦Ā;r²ᖺ;쀀𝔞rave耻à䃠ĀepᗊᗖĀfpᗏᗔsym;愵èᗓha;䎱ĀapᗟcĀclᗤᗧr;䄁g;樿ɤᗰ\0\0ᘊʀ;adsvᗺᗻᗿᘁᘇ戧nd;橕;橜lope;橘;橚΀;elmrszᘘᘙᘛᘞᘿᙏᙙ戠;榤e»ᘙsdĀ;aᘥᘦ戡ѡᘰᘲᘴᘶᘸᘺᘼᘾ;榨;榩;榪;榫;榬;榭;榮;榯tĀ;vᙅᙆ戟bĀ;dᙌᙍ抾;榝Āptᙔᙗh;戢»¹arr;捼Āgpᙣᙧon;䄅f;쀀𝕒΀;Eaeiop዁ᙻᙽᚂᚄᚇᚊ;橰cir;橯;扊d;手s;䀧roxĀ;e዁ᚒñᚃing耻å䃥ƀctyᚡᚦᚨr;쀀𝒶;䀪mpĀ;e዁ᚯñʈilde耻ã䃣ml耻ä䃤Āciᛂᛈoninôɲnt;樑ࠀNabcdefiklnoprsu᛭ᛱᜰ᜼ᝃᝈ᝸᝽០៦ᠹᡐᜍ᤽᥈ᥰot;櫭Ācrᛶ᜞kȀcepsᜀᜅᜍᜓong;扌psilon;䏶rime;怵imĀ;e᜚᜛戽q;拍Ŷᜢᜦee;抽edĀ;gᜬᜭ挅e»ᜭrkĀ;t፜᜷brk;掶Āoyᜁᝁ;䐱quo;怞ʀcmprtᝓ᝛ᝡᝤᝨausĀ;eĊĉptyv;榰séᜌnoõēƀahwᝯ᝱ᝳ;䎲;愶een;扬r;쀀𝔟g΀costuvwឍឝឳេ៕៛៞ƀaiuបពរðݠrc;旯p»፱ƀdptឤឨឭot;樀lus;樁imes;樂ɱឹ\0\0ើcup;樆ar;昅riangleĀdu៍្own;施p;斳plus;樄eåᑄåᒭarow;植ƀako៭ᠦᠵĀcn៲ᠣkƀlst៺֫᠂ozenge;槫riangleȀ;dlr᠒᠓᠘᠝斴own;斾eft;旂ight;斸k;搣Ʊᠫ\0ᠳƲᠯ\0ᠱ;斒;斑4;斓ck;斈ĀeoᠾᡍĀ;qᡃᡆ쀀=⃥uiv;쀀≡⃥t;挐Ȁptwxᡙᡞᡧᡬf;쀀𝕓Ā;tᏋᡣom»Ꮜtie;拈؀DHUVbdhmptuvᢅᢖᢪᢻᣗᣛᣬ᣿ᤅᤊᤐᤡȀLRlrᢎᢐᢒᢔ;敗;敔;敖;敓ʀ;DUduᢡᢢᢤᢦᢨ敐;敦;敩;敤;敧ȀLRlrᢳᢵᢷᢹ;敝;敚;敜;教΀;HLRhlrᣊᣋᣍᣏᣑᣓᣕ救;敬;散;敠;敫;敢;敟ox;槉ȀLRlrᣤᣦᣨᣪ;敕;敒;攐;攌ʀ;DUduڽ᣷᣹᣻᣽;敥;敨;攬;攴inus;抟lus;択imes;抠ȀLRlrᤙᤛᤝ᤟;敛;敘;攘;攔΀;HLRhlrᤰᤱᤳᤵᤷ᤻᤹攂;敪;敡;敞;攼;攤;攜Āevģ᥂bar耻¦䂦Ȁceioᥑᥖᥚᥠr;쀀𝒷mi;恏mĀ;e᜚᜜lƀ;bhᥨᥩᥫ䁜;槅sub;柈Ŭᥴ᥾lĀ;e᥹᥺怢t»᥺pƀ;Eeįᦅᦇ;檮Ā;qۜۛೡᦧ\0᧨ᨑᨕᨲ\0ᨷᩐ\0\0᪴\0\0᫁\0\0ᬡᬮ᭍᭒\0᯽\0ᰌƀcpr᦭ᦲ᧝ute;䄇̀;abcdsᦿᧀᧄ᧊᧕᧙戩nd;橄rcup;橉Āau᧏᧒p;橋p;橇ot;橀;쀀∩︀Āeo᧢᧥t;恁îړȀaeiu᧰᧻ᨁᨅǰ᧵\0᧸s;橍on;䄍dil耻ç䃧rc;䄉psĀ;sᨌᨍ橌m;橐ot;䄋ƀdmnᨛᨠᨦil肻¸ƭptyv;榲t脀¢;eᨭᨮ䂢räƲr;쀀𝔠ƀceiᨽᩀᩍy;䑇ckĀ;mᩇᩈ朓ark»ᩈ;䏇r΀;Ecefms᩟᩠ᩢᩫ᪤᪪᪮旋;槃ƀ;elᩩᩪᩭ䋆q;扗eɡᩴ\0\0᪈rrowĀlr᩼᪁eft;憺ight;憻ʀRSacd᪒᪔᪖᪚᪟»ཇ;擈st;抛irc;抚ash;抝nint;樐id;櫯cir;槂ubsĀ;u᪻᪼晣it»᪼ˬ᫇᫔᫺\0ᬊonĀ;eᫍᫎ䀺Ā;qÇÆɭ᫙\0\0᫢aĀ;t᫞᫟䀬;䁀ƀ;fl᫨᫩᫫戁îᅠeĀmx᫱᫶ent»᫩eóɍǧ᫾\0ᬇĀ;dኻᬂot;橭nôɆƀfryᬐᬔᬗ;쀀𝕔oäɔ脀©;sŕᬝr;愗Āaoᬥᬩrr;憵ss;朗Ācuᬲᬷr;쀀𝒸Ābpᬼ᭄Ā;eᭁᭂ櫏;櫑Ā;eᭉᭊ櫐;櫒dot;拯΀delprvw᭠᭬᭷ᮂᮬᯔ᯹arrĀlr᭨᭪;椸;椵ɰ᭲\0\0᭵r;拞c;拟arrĀ;p᭿ᮀ憶;椽̀;bcdosᮏᮐᮖᮡᮥᮨ截rcap;橈Āauᮛᮞp;橆p;橊ot;抍r;橅;쀀∪︀Ȁalrv᮵ᮿᯞᯣrrĀ;mᮼᮽ憷;椼yƀevwᯇᯔᯘqɰᯎ\0\0ᯒreã᭳uã᭵ee;拎edge;拏en耻¤䂤earrowĀlrᯮ᯳eft»ᮀight»ᮽeäᯝĀciᰁᰇoninôǷnt;戱lcty;挭ঀAHabcdefhijlorstuwz᰸᰻᰿ᱝᱩᱵᲊᲞᲬᲷ᳻᳿ᴍᵻᶑᶫᶻ᷆᷍rò΁ar;楥Ȁglrs᱈ᱍ᱒᱔ger;怠eth;愸òᄳhĀ;vᱚᱛ怐»ऊūᱡᱧarow;椏aã̕Āayᱮᱳron;䄏;䐴ƀ;ao̲ᱼᲄĀgrʿᲁr;懊tseq;橷ƀglmᲑᲔᲘ耻°䂰ta;䎴ptyv;榱ĀirᲣᲨsht;楿;쀀𝔡arĀlrᲳᲵ»ࣜ»သʀaegsv᳂͸᳖᳜᳠mƀ;oș᳊᳔ndĀ;ș᳑uit;晦amma;䏝in;拲ƀ;io᳧᳨᳸䃷de脀÷;o᳧ᳰntimes;拇nø᳷cy;䑒cɯᴆ\0\0ᴊrn;挞op;挍ʀlptuwᴘᴝᴢᵉᵕlar;䀤f;쀀𝕕ʀ;emps̋ᴭᴷᴽᵂqĀ;d͒ᴳot;扑inus;戸lus;戔quare;抡blebarwedgåúnƀadhᄮᵝᵧownarrowóᲃarpoonĀlrᵲᵶefôᲴighôᲶŢᵿᶅkaro÷གɯᶊ\0\0ᶎrn;挟op;挌ƀcotᶘᶣᶦĀryᶝᶡ;쀀𝒹;䑕l;槶rok;䄑Ādrᶰᶴot;拱iĀ;fᶺ᠖斿Āah᷀᷃ròЩaòྦangle;榦Āci᷒ᷕy;䑟grarr;柿ऀDacdefglmnopqrstuxḁḉḙḸոḼṉṡṾấắẽỡἪἷὄ὎὚ĀDoḆᴴoôᲉĀcsḎḔute耻é䃩ter;橮ȀaioyḢḧḱḶron;䄛rĀ;cḭḮ扖耻ê䃪lon;払;䑍ot;䄗ĀDrṁṅot;扒;쀀𝔢ƀ;rsṐṑṗ檚ave耻è䃨Ā;dṜṝ檖ot;檘Ȁ;ilsṪṫṲṴ檙nters;揧;愓Ā;dṹṺ檕ot;檗ƀapsẅẉẗcr;䄓tyƀ;svẒẓẕ戅et»ẓpĀ1;ẝẤĳạả;怄;怅怃ĀgsẪẬ;䅋p;怂ĀgpẴẸon;䄙f;쀀𝕖ƀalsỄỎỒrĀ;sỊị拕l;槣us;橱iƀ;lvỚớở䎵on»ớ;䏵ȀcsuvỪỳἋἣĀioữḱrc»Ḯɩỹ\0\0ỻíՈantĀglἂἆtr»ṝess»Ṻƀaeiἒ἖Ἒls;䀽st;扟vĀ;DȵἠD;橸parsl;槥ĀDaἯἳot;打rr;楱ƀcdiἾὁỸr;愯oô͒ĀahὉὋ;䎷耻ð䃰Āmrὓὗl耻ë䃫o;悬ƀcipὡὤὧl;䀡sôծĀeoὬὴctatioîՙnentialåչৡᾒ\0ᾞ\0ᾡᾧ\0\0ῆῌ\0ΐ\0ῦῪ \0 ⁚llingdotseñṄy;䑄male;晀ƀilrᾭᾳ῁lig;耀ﬃɩᾹ\0\0᾽g;耀ﬀig;耀ﬄ;쀀𝔣lig;耀ﬁlig;쀀fjƀaltῙ῜ῡt;晭ig;耀ﬂns;斱of;䆒ǰ΅\0ῳf;쀀𝕗ĀakֿῷĀ;vῼ´拔;櫙artint;樍Āao‌⁕Ācs‑⁒α‚‰‸⁅⁈\0⁐β•‥‧‪‬\0‮耻½䂽;慓耻¼䂼;慕;慙;慛Ƴ‴\0‶;慔;慖ʴ‾⁁\0\0⁃耻¾䂾;慗;慜5;慘ƶ⁌\0⁎;慚;慝8;慞l;恄wn;挢cr;쀀𝒻ࢀEabcdefgijlnorstv₂₉₟₥₰₴⃰⃵⃺⃿℃ℒℸ̗ℾ⅒↞Ā;lٍ₇;檌ƀcmpₐₕ₝ute;䇵maĀ;dₜ᳚䎳;檆reve;䄟Āiy₪₮rc;䄝;䐳ot;䄡Ȁ;lqsؾق₽⃉ƀ;qsؾٌ⃄lanô٥Ȁ;cdl٥⃒⃥⃕c;檩otĀ;o⃜⃝檀Ā;l⃢⃣檂;檄Ā;e⃪⃭쀀⋛︀s;檔r;쀀𝔤Ā;gٳ؛mel;愷cy;䑓Ȁ;Eajٚℌℎℐ;檒;檥;檤ȀEaesℛℝ℩ℴ;扩pĀ;p℣ℤ檊rox»ℤĀ;q℮ℯ檈Ā;q℮ℛim;拧pf;쀀𝕘Āci⅃ⅆr;愊mƀ;el٫ⅎ⅐;檎;檐茀>;cdlqr׮ⅠⅪⅮⅳⅹĀciⅥⅧ;檧r;橺ot;拗Par;榕uest;橼ʀadelsↄⅪ←ٖ↛ǰ↉\0↎proø₞r;楸qĀlqؿ↖lesó₈ií٫Āen↣↭rtneqq;쀀≩︀Å↪ԀAabcefkosy⇄⇇⇱⇵⇺∘∝∯≨≽ròΠȀilmr⇐⇔⇗⇛rsðᒄf»․ilôکĀdr⇠⇤cy;䑊ƀ;cwࣴ⇫⇯ir;楈;憭ar;意irc;䄥ƀalr∁∎∓rtsĀ;u∉∊晥it»∊lip;怦con;抹r;쀀𝔥sĀew∣∩arow;椥arow;椦ʀamopr∺∾≃≞≣rr;懿tht;戻kĀlr≉≓eftarrow;憩ightarrow;憪f;쀀𝕙bar;怕ƀclt≯≴≸r;쀀𝒽asè⇴rok;䄧Ābp⊂⊇ull;恃hen»ᱛૡ⊣\0⊪\0⊸⋅⋎\0⋕⋳\0\0⋸⌢⍧⍢⍿\0⎆⎪⎴cute耻í䃭ƀ;iyݱ⊰⊵rc耻î䃮;䐸Ācx⊼⊿y;䐵cl耻¡䂡ĀfrΟ⋉;쀀𝔦rave耻ì䃬Ȁ;inoܾ⋝⋩⋮Āin⋢⋦nt;樌t;戭fin;槜ta;愩lig;䄳ƀaop⋾⌚⌝ƀcgt⌅⌈⌗r;䄫ƀelpܟ⌏⌓inåގarôܠh;䄱f;抷ed;䆵ʀ;cfotӴ⌬⌱⌽⍁are;愅inĀ;t⌸⌹戞ie;槝doô⌙ʀ;celpݗ⍌⍐⍛⍡al;抺Āgr⍕⍙eróᕣã⍍arhk;樗rod;樼Ȁcgpt⍯⍲⍶⍻y;䑑on;䄯f;쀀𝕚a;䎹uest耻¿䂿Āci⎊⎏r;쀀𝒾nʀ;EdsvӴ⎛⎝⎡ӳ;拹ot;拵Ā;v⎦⎧拴;拳Ā;iݷ⎮lde;䄩ǫ⎸\0⎼cy;䑖l耻ï䃯̀cfmosu⏌⏗⏜⏡⏧⏵Āiy⏑⏕rc;䄵;䐹r;쀀𝔧ath;䈷pf;쀀𝕛ǣ⏬\0⏱r;쀀𝒿rcy;䑘kcy;䑔Ѐacfghjos␋␖␢␧␭␱␵␻ppaĀ;v␓␔䎺;䏰Āey␛␠dil;䄷;䐺r;쀀𝔨reen;䄸cy;䑅cy;䑜pf;쀀𝕜cr;쀀𝓀஀ABEHabcdefghjlmnoprstuv⑰⒁⒆⒍⒑┎┽╚▀♎♞♥♹♽⚚⚲⛘❝❨➋⟀⠁⠒ƀart⑷⑺⑼rò৆òΕail;椛arr;椎Ā;gঔ⒋;檋ar;楢ॣ⒥\0⒪\0⒱\0\0\0\0\0⒵Ⓔ\0ⓆⓈⓍ\0⓹ute;䄺mptyv;榴raîࡌbda;䎻gƀ;dlࢎⓁⓃ;榑åࢎ;檅uo耻«䂫rЀ;bfhlpst࢙ⓞⓦⓩ⓫⓮⓱⓵Ā;f࢝ⓣs;椟s;椝ë≒p;憫l;椹im;楳l;憢ƀ;ae⓿─┄檫il;椙Ā;s┉┊檭;쀀⪭︀ƀabr┕┙┝rr;椌rk;杲Āak┢┬cĀek┨┪;䁻;䁛Āes┱┳;榋lĀdu┹┻;榏;榍Ȁaeuy╆╋╖╘ron;䄾Ādi═╔il;䄼ìࢰâ┩;䐻Ȁcqrs╣╦╭╽a;椶uoĀ;rนᝆĀdu╲╷har;楧shar;楋h;憲ʀ;fgqs▋▌উ◳◿扤tʀahlrt▘▤▷◂◨rrowĀ;t࢙□aé⓶arpoonĀdu▯▴own»њp»०eftarrows;懇ightƀahs◍◖◞rrowĀ;sࣴࢧarpoonó྘quigarro÷⇰hreetimes;拋ƀ;qs▋ও◺lanôবʀ;cdgsব☊☍☝☨c;檨otĀ;o☔☕橿Ā;r☚☛檁;檃Ā;e☢☥쀀⋚︀s;檓ʀadegs☳☹☽♉♋pproøⓆot;拖qĀgq♃♅ôউgtò⒌ôছiíলƀilr♕࣡♚sht;楼;쀀𝔩Ā;Eজ♣;檑š♩♶rĀdu▲♮Ā;l॥♳;楪lk;斄cy;䑙ʀ;achtੈ⚈⚋⚑⚖rò◁orneòᴈard;楫ri;旺Āio⚟⚤dot;䅀ustĀ;a⚬⚭掰che»⚭ȀEaes⚻⚽⛉⛔;扨pĀ;p⛃⛄檉rox»⛄Ā;q⛎⛏檇Ā;q⛎⚻im;拦Ѐabnoptwz⛩⛴⛷✚✯❁❇❐Ānr⛮⛱g;柬r;懽rëࣁgƀlmr⛿✍✔eftĀar০✇ightá৲apsto;柼ightá৽parrowĀlr✥✩efô⓭ight;憬ƀafl✶✹✽r;榅;쀀𝕝us;樭imes;樴š❋❏st;戗áፎƀ;ef❗❘᠀旊nge»❘arĀ;l❤❥䀨t;榓ʀachmt❳❶❼➅➇ròࢨorneòᶌarĀ;d྘➃;業;怎ri;抿̀achiqt➘➝ੀ➢➮➻quo;怹r;쀀𝓁mƀ;egল➪➬;檍;檏Ābu┪➳oĀ;rฟ➹;怚rok;䅂萀<;cdhilqrࠫ⟒☹⟜⟠⟥⟪⟰Āci⟗⟙;檦r;橹reå◲mes;拉arr;楶uest;橻ĀPi⟵⟹ar;榖ƀ;ef⠀भ᠛旃rĀdu⠇⠍shar;楊har;楦Āen⠗⠡rtneqq;쀀≨︀Å⠞܀Dacdefhilnopsu⡀⡅⢂⢎⢓⢠⢥⢨⣚⣢⣤ઃ⣳⤂Dot;戺Ȁclpr⡎⡒⡣⡽r耻¯䂯Āet⡗⡙;時Ā;e⡞⡟朠se»⡟Ā;sျ⡨toȀ;dluျ⡳⡷⡻owîҌefôएðᏑker;斮Āoy⢇⢌mma;権;䐼ash;怔asuredangle»ᘦr;쀀𝔪o;愧ƀcdn⢯⢴⣉ro耻µ䂵Ȁ;acdᑤ⢽⣀⣄sôᚧir;櫰ot肻·Ƶusƀ;bd⣒ᤃ⣓戒Ā;uᴼ⣘;横ţ⣞⣡p;櫛ò−ðઁĀdp⣩⣮els;抧f;쀀𝕞Āct⣸⣽r;쀀𝓂pos»ᖝƀ;lm⤉⤊⤍䎼timap;抸ఀGLRVabcdefghijlmoprstuvw⥂⥓⥾⦉⦘⧚⧩⨕⨚⩘⩝⪃⪕⪤⪨⬄⬇⭄⭿⮮ⰴⱧⱼ⳩Āgt⥇⥋;쀀⋙̸Ā;v⥐௏쀀≫⃒ƀelt⥚⥲⥶ftĀar⥡⥧rrow;懍ightarrow;懎;쀀⋘̸Ā;v⥻ే쀀≪⃒ightarrow;懏ĀDd⦎⦓ash;抯ash;抮ʀbcnpt⦣⦧⦬⦱⧌la»˞ute;䅄g;쀀∠⃒ʀ;Eiop඄⦼⧀⧅⧈;쀀⩰̸d;쀀≋̸s;䅉roø඄urĀ;a⧓⧔普lĀ;s⧓ସǳ⧟\0⧣p肻 ଷmpĀ;e௹ఀʀaeouy⧴⧾⨃⨐⨓ǰ⧹\0⧻;橃on;䅈dil;䅆ngĀ;dൾ⨊ot;쀀⩭̸p;橂;䐽ash;怓΀;Aadqsxஒ⨩⨭⨻⩁⩅⩐rr;懗rĀhr⨳⨶k;椤Ā;oᏲᏰot;쀀≐̸uiöୣĀei⩊⩎ar;椨í஘istĀ;s஠டr;쀀𝔫ȀEest௅⩦⩹⩼ƀ;qs஼⩭௡ƀ;qs஼௅⩴lanô௢ií௪Ā;rஶ⪁»ஷƀAap⪊⪍⪑rò⥱rr;憮ar;櫲ƀ;svྍ⪜ྌĀ;d⪡⪢拼;拺cy;䑚΀AEadest⪷⪺⪾⫂⫅⫶⫹rò⥦;쀀≦̸rr;憚r;急Ȁ;fqs఻⫎⫣⫯tĀar⫔⫙rro÷⫁ightarro÷⪐ƀ;qs఻⪺⫪lanôౕĀ;sౕ⫴»శiíౝĀ;rవ⫾iĀ;eచథiäඐĀpt⬌⬑f;쀀𝕟膀¬;in⬙⬚⬶䂬nȀ;Edvஉ⬤⬨⬮;쀀⋹̸ot;쀀⋵̸ǡஉ⬳⬵;拷;拶iĀ;vಸ⬼ǡಸ⭁⭃;拾;拽ƀaor⭋⭣⭩rȀ;ast୻⭕⭚⭟lleì୻l;쀀⫽⃥;쀀∂̸lint;樔ƀ;ceಒ⭰⭳uåಥĀ;cಘ⭸Ā;eಒ⭽ñಘȀAait⮈⮋⮝⮧rò⦈rrƀ;cw⮔⮕⮙憛;쀀⤳̸;쀀↝̸ghtarrow»⮕riĀ;eೋೖ΀chimpqu⮽⯍⯙⬄୸⯤⯯Ȁ;cerല⯆ഷ⯉uå൅;쀀𝓃ortɭ⬅\0\0⯖ará⭖mĀ;e൮⯟Ā;q൴൳suĀbp⯫⯭å೸åഋƀbcp⯶ⰑⰙȀ;Ees⯿ⰀഢⰄ抄;쀀⫅̸etĀ;eഛⰋqĀ;qണⰀcĀ;eലⰗñസȀ;EesⰢⰣൟⰧ抅;쀀⫆̸etĀ;e൘ⰮqĀ;qൠⰣȀgilrⰽⰿⱅⱇìௗlde耻ñ䃱çృiangleĀlrⱒⱜeftĀ;eచⱚñదightĀ;eೋⱥñ೗Ā;mⱬⱭ䎽ƀ;esⱴⱵⱹ䀣ro;愖p;怇ҀDHadgilrsⲏⲔⲙⲞⲣⲰⲶⳓⳣash;抭arr;椄p;쀀≍⃒ash;抬ĀetⲨⲬ;쀀≥⃒;쀀>⃒nfin;槞ƀAetⲽⳁⳅrr;椂;쀀≤⃒Ā;rⳊⳍ쀀<⃒ie;쀀⊴⃒ĀAtⳘⳜrr;椃rie;쀀⊵⃒im;쀀∼⃒ƀAan⳰⳴ⴂrr;懖rĀhr⳺⳽k;椣Ā;oᏧᏥear;椧ቓ᪕\0\0\0\0\0\0\0\0\0\0\0\0\0ⴭ\0ⴸⵈⵠⵥ⵲ⶄᬇ\0\0ⶍⶫ\0ⷈⷎ\0ⷜ⸙⸫⸾⹃Ācsⴱ᪗ute耻ó䃳ĀiyⴼⵅrĀ;c᪞ⵂ耻ô䃴;䐾ʀabios᪠ⵒⵗǈⵚlac;䅑v;樸old;榼lig;䅓Ācr⵩⵭ir;榿;쀀𝔬ͯ⵹\0\0⵼\0ⶂn;䋛ave耻ò䃲;槁Ābmⶈ෴ar;榵Ȁacitⶕ⶘ⶥⶨrò᪀Āir⶝ⶠr;榾oss;榻nå๒;槀ƀaeiⶱⶵⶹcr;䅍ga;䏉ƀcdnⷀⷅǍron;䎿;榶pf;쀀𝕠ƀaelⷔ⷗ǒr;榷rp;榹΀;adiosvⷪⷫⷮ⸈⸍⸐⸖戨rò᪆Ȁ;efmⷷⷸ⸂⸅橝rĀ;oⷾⷿ愴f»ⷿ耻ª䂪耻º䂺gof;抶r;橖lope;橗;橛ƀclo⸟⸡⸧ò⸁ash耻ø䃸l;折iŬⸯ⸴de耻õ䃵esĀ;aǛ⸺s;樶ml耻ö䃶bar;挽ૡ⹞\0⹽\0⺀⺝\0⺢⺹\0\0⻋ຜ\0⼓\0\0⼫⾼\0⿈rȀ;astЃ⹧⹲຅脀¶;l⹭⹮䂶leìЃɩ⹸\0\0⹻m;櫳;櫽y;䐿rʀcimpt⺋⺏⺓ᡥ⺗nt;䀥od;䀮il;怰enk;怱r;쀀𝔭ƀimo⺨⺰⺴Ā;v⺭⺮䏆;䏕maô੶ne;明ƀ;tv⺿⻀⻈䏀chfork»´;䏖Āau⻏⻟nĀck⻕⻝kĀ;h⇴⻛;愎ö⇴sҀ;abcdemst⻳⻴ᤈ⻹⻽⼄⼆⼊⼎䀫cir;樣ir;樢Āouᵀ⼂;樥;橲n肻±ຝim;樦wo;樧ƀipu⼙⼠⼥ntint;樕f;쀀𝕡nd耻£䂣Ԁ;Eaceinosu່⼿⽁⽄⽇⾁⾉⾒⽾⾶;檳p;檷uå໙Ā;c໎⽌̀;acens່⽙⽟⽦⽨⽾pproø⽃urlyeñ໙ñ໎ƀaes⽯⽶⽺pprox;檹qq;檵im;拨iíໟmeĀ;s⾈ຮ怲ƀEas⽸⾐⽺ð⽵ƀdfp໬⾙⾯ƀals⾠⾥⾪lar;挮ine;挒urf;挓Ā;t໻⾴ï໻rel;抰Āci⿀⿅r;쀀𝓅;䏈ncsp;怈̀fiopsu⿚⋢⿟⿥⿫⿱r;쀀𝔮pf;쀀𝕢rime;恗cr;쀀𝓆ƀaeo⿸〉〓tĀei⿾々rnionóڰnt;樖stĀ;e【】䀿ñἙô༔઀ABHabcdefhilmnoprstux぀けさすムㄎㄫㅇㅢㅲㆎ㈆㈕㈤㈩㉘㉮㉲㊐㊰㊷ƀartぇおがròႳòϝail;検aròᱥar;楤΀cdenqrtとふへみわゔヌĀeuねぱ;쀀∽̱te;䅕iãᅮmptyv;榳gȀ;del࿑らるろ;榒;榥å࿑uo耻»䂻rր;abcfhlpstw࿜ガクシスゼゾダッデナp;極Ā;f࿠ゴs;椠;椳s;椞ë≝ð✮l;楅im;楴l;憣;憝Āaiパフil;椚oĀ;nホボ戶aló༞ƀabrョリヮrò៥rk;杳ĀakンヽcĀekヹ・;䁽;䁝Āes㄂㄄;榌lĀduㄊㄌ;榎;榐Ȁaeuyㄗㄜㄧㄩron;䅙Ādiㄡㄥil;䅗ì࿲âヺ;䑀Ȁclqsㄴㄷㄽㅄa;椷dhar;楩uoĀ;rȎȍh;憳ƀacgㅎㅟངlȀ;ipsླྀㅘㅛႜnåႻarôྩt;断ƀilrㅩဣㅮsht;楽;쀀𝔯ĀaoㅷㆆrĀduㅽㅿ»ѻĀ;l႑ㆄ;楬Ā;vㆋㆌ䏁;䏱ƀgns㆕ㇹㇼht̀ahlrstㆤㆰ㇂㇘㇤㇮rrowĀ;t࿜ㆭaéトarpoonĀduㆻㆿowîㅾp»႒eftĀah㇊㇐rrowó࿪arpoonóՑightarrows;應quigarro÷ニhreetimes;拌g;䋚ingdotseñἲƀahm㈍㈐㈓rò࿪aòՑ;怏oustĀ;a㈞㈟掱che»㈟mid;櫮Ȁabpt㈲㈽㉀㉒Ānr㈷㈺g;柭r;懾rëဃƀafl㉇㉊㉎r;榆;쀀𝕣us;樮imes;樵Āap㉝㉧rĀ;g㉣㉤䀩t;榔olint;樒arò㇣Ȁachq㉻㊀Ⴜ㊅quo;怺r;쀀𝓇Ābu・㊊oĀ;rȔȓƀhir㊗㊛㊠reåㇸmes;拊iȀ;efl㊪ၙᠡ㊫方tri;槎luhar;楨;愞ൡ㋕㋛㋟㌬㌸㍱\0㍺㎤\0\0㏬㏰\0㐨㑈㑚㒭㒱㓊㓱\0㘖\0\0㘳cute;䅛quï➺Ԁ;Eaceinpsyᇭ㋳㋵㋿㌂㌋㌏㌟㌦㌩;檴ǰ㋺\0㋼;檸on;䅡uåᇾĀ;dᇳ㌇il;䅟rc;䅝ƀEas㌖㌘㌛;檶p;檺im;择olint;樓iíሄ;䑁otƀ;be㌴ᵇ㌵担;橦΀Aacmstx㍆㍊㍗㍛㍞㍣㍭rr;懘rĀhr㍐㍒ë∨Ā;oਸ਼਴t耻§䂧i;䀻war;椩mĀin㍩ðnuóñt;朶rĀ;o㍶⁕쀀𝔰Ȁacoy㎂㎆㎑㎠rp;景Āhy㎋㎏cy;䑉;䑈rtɭ㎙\0\0㎜iäᑤaraì⹯耻­䂭Āgm㎨㎴maƀ;fv㎱㎲㎲䏃;䏂Ѐ;deglnprካ㏅㏉㏎㏖㏞㏡㏦ot;橪Ā;q኱ኰĀ;E㏓㏔檞;檠Ā;E㏛㏜檝;檟e;扆lus;樤arr;楲aròᄽȀaeit㏸㐈㐏㐗Āls㏽㐄lsetmé㍪hp;樳parsl;槤Ādlᑣ㐔e;挣Ā;e㐜㐝檪Ā;s㐢㐣檬;쀀⪬︀ƀflp㐮㐳㑂tcy;䑌Ā;b㐸㐹䀯Ā;a㐾㐿槄r;挿f;쀀𝕤aĀdr㑍ЂesĀ;u㑔㑕晠it»㑕ƀcsu㑠㑹㒟Āau㑥㑯pĀ;sᆈ㑫;쀀⊓︀pĀ;sᆴ㑵;쀀⊔︀uĀbp㑿㒏ƀ;esᆗᆜ㒆etĀ;eᆗ㒍ñᆝƀ;esᆨᆭ㒖etĀ;eᆨ㒝ñᆮƀ;afᅻ㒦ְrť㒫ֱ»ᅼaròᅈȀcemt㒹㒾㓂㓅r;쀀𝓈tmîñiì㐕aræᆾĀar㓎㓕rĀ;f㓔ឿ昆Āan㓚㓭ightĀep㓣㓪psiloîỠhé⺯s»⡒ʀbcmnp㓻㕞ሉ㖋㖎Ҁ;Edemnprs㔎㔏㔑㔕㔞㔣㔬㔱㔶抂;櫅ot;檽Ā;dᇚ㔚ot;櫃ult;櫁ĀEe㔨㔪;櫋;把lus;檿arr;楹ƀeiu㔽㕒㕕tƀ;en㔎㕅㕋qĀ;qᇚ㔏eqĀ;q㔫㔨m;櫇Ābp㕚㕜;櫕;櫓c̀;acensᇭ㕬㕲㕹㕻㌦pproø㋺urlyeñᇾñᇳƀaes㖂㖈㌛pproø㌚qñ㌗g;晪ڀ123;Edehlmnps㖩㖬㖯ሜ㖲㖴㗀㗉㗕㗚㗟㗨㗭耻¹䂹耻²䂲耻³䂳;櫆Āos㖹㖼t;檾ub;櫘Ā;dሢ㗅ot;櫄sĀou㗏㗒l;柉b;櫗arr;楻ult;櫂ĀEe㗤㗦;櫌;抋lus;櫀ƀeiu㗴㘉㘌tƀ;enሜ㗼㘂qĀ;qሢ㖲eqĀ;q㗧㗤m;櫈Ābp㘑㘓;櫔;櫖ƀAan㘜㘠㘭rr;懙rĀhr㘦㘨ë∮Ā;oਫ਩war;椪lig耻ß䃟௡㙑㙝㙠ዎ㙳㙹\0㙾㛂\0\0\0\0\0㛛㜃\0㜉㝬\0\0\0㞇ɲ㙖\0\0㙛get;挖;䏄rë๟ƀaey㙦㙫㙰ron;䅥dil;䅣;䑂lrec;挕r;쀀𝔱Ȁeiko㚆㚝㚵㚼ǲ㚋\0㚑eĀ4fኄኁaƀ;sv㚘㚙㚛䎸ym;䏑Ācn㚢㚲kĀas㚨㚮pproø዁im»ኬsðኞĀas㚺㚮ð዁rn耻þ䃾Ǭ̟㛆⋧es膀×;bd㛏㛐㛘䃗Ā;aᤏ㛕r;樱;樰ƀeps㛡㛣㜀á⩍Ȁ;bcf҆㛬㛰㛴ot;挶ir;櫱Ā;o㛹㛼쀀𝕥rk;櫚á㍢rime;怴ƀaip㜏㜒㝤dåቈ΀adempst㜡㝍㝀㝑㝗㝜㝟ngleʀ;dlqr㜰㜱㜶㝀㝂斵own»ᶻeftĀ;e⠀㜾ñम;扜ightĀ;e㊪㝋ñၚot;旬inus;樺lus;樹b;槍ime;樻ezium;揢ƀcht㝲㝽㞁Āry㝷㝻;쀀𝓉;䑆cy;䑛rok;䅧Āio㞋㞎xô᝷headĀlr㞗㞠eftarro÷ࡏightarrow»ཝऀAHabcdfghlmoprstuw㟐㟓㟗㟤㟰㟼㠎㠜㠣㠴㡑㡝㡫㢩㣌㣒㣪㣶ròϭar;楣Ācr㟜㟢ute耻ú䃺òᅐrǣ㟪\0㟭y;䑞ve;䅭Āiy㟵㟺rc耻û䃻;䑃ƀabh㠃㠆㠋ròᎭlac;䅱aòᏃĀir㠓㠘sht;楾;쀀𝔲rave耻ù䃹š㠧㠱rĀlr㠬㠮»ॗ»ႃlk;斀Āct㠹㡍ɯ㠿\0\0㡊rnĀ;e㡅㡆挜r»㡆op;挏ri;旸Āal㡖㡚cr;䅫肻¨͉Āgp㡢㡦on;䅳f;쀀𝕦̀adhlsuᅋ㡸㡽፲㢑㢠ownáᎳarpoonĀlr㢈㢌efô㠭ighô㠯iƀ;hl㢙㢚㢜䏅»ᏺon»㢚parrows;懈ƀcit㢰㣄㣈ɯ㢶\0\0㣁rnĀ;e㢼㢽挝r»㢽op;挎ng;䅯ri;旹cr;쀀𝓊ƀdir㣙㣝㣢ot;拰lde;䅩iĀ;f㜰㣨»᠓Āam㣯㣲rò㢨l耻ü䃼angle;榧ހABDacdeflnoprsz㤜㤟㤩㤭㦵㦸㦽㧟㧤㧨㧳㧹㧽㨁㨠ròϷarĀ;v㤦㤧櫨;櫩asèϡĀnr㤲㤷grt;榜΀eknprst㓣㥆㥋㥒㥝㥤㦖appá␕othinçẖƀhir㓫⻈㥙opô⾵Ā;hᎷ㥢ïㆍĀiu㥩㥭gmá㎳Ābp㥲㦄setneqĀ;q㥽㦀쀀⊊︀;쀀⫋︀setneqĀ;q㦏㦒쀀⊋︀;쀀⫌︀Āhr㦛㦟etá㚜iangleĀlr㦪㦯eft»थight»ၑy;䐲ash»ံƀelr㧄㧒㧗ƀ;beⷪ㧋㧏ar;抻q;扚lip;拮Ābt㧜ᑨaòᑩr;쀀𝔳tré㦮suĀbp㧯㧱»ജ»൙pf;쀀𝕧roð໻tré㦴Ācu㨆㨋r;쀀𝓋Ābp㨐㨘nĀEe㦀㨖»㥾nĀEe㦒㨞»㦐igzag;榚΀cefoprs㨶㨻㩖㩛㩔㩡㩪irc;䅵Ādi㩀㩑Ābg㩅㩉ar;機eĀ;qᗺ㩏;扙erp;愘r;쀀𝔴pf;쀀𝕨Ā;eᑹ㩦atèᑹcr;쀀𝓌ૣណ㪇\0㪋\0㪐㪛\0\0㪝㪨㪫㪯\0\0㫃㫎\0㫘ៜ៟tré៑r;쀀𝔵ĀAa㪔㪗ròσrò৶;䎾ĀAa㪡㪤ròθrò৫að✓is;拻ƀdptឤ㪵㪾Āfl㪺ឩ;쀀𝕩imåឲĀAa㫇㫊ròώròਁĀcq㫒ីr;쀀𝓍Āpt៖㫜ré។Ѐacefiosu㫰㫽㬈㬌㬑㬕㬛㬡cĀuy㫶㫻te耻ý䃽;䑏Āiy㬂㬆rc;䅷;䑋n耻¥䂥r;쀀𝔶cy;䑗pf;쀀𝕪cr;쀀𝓎Ācm㬦㬩y;䑎l耻ÿ䃿Ԁacdefhiosw㭂㭈㭔㭘㭤㭩㭭㭴㭺㮀cute;䅺Āay㭍㭒ron;䅾;䐷ot;䅼Āet㭝㭡træᕟa;䎶r;쀀𝔷cy;䐶grarr;懝pf;쀀𝕫cr;쀀𝓏Ājn㮅㮇;怍j;怌'.split("").map(t=>t.charCodeAt(0))),YE=new Uint16Array("Ȁaglq	\x1Bɭ\0\0p;䀦os;䀧t;䀾t;䀼uot;䀢".split("").map(t=>t.charCodeAt(0)));var Td;const oD=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),Fh=(Td=String.fromCodePoint)!==null&&Td!==void 0?Td:function(t){let e="";return t>65535&&(t-=65536,e+=String.fromCharCode(t>>>10&1023|55296),t=56320|t&1023),e+=String.fromCharCode(t),e};function uD(t){var e;return t>=55296&&t<=57343||t>1114111?65533:(e=oD.get(t))!==null&&e!==void 0?e:t}var Ct;(function(t){t[t.NUM=35]="NUM",t[t.SEMI=59]="SEMI",t[t.EQUALS=61]="EQUALS",t[t.ZERO=48]="ZERO",t[t.NINE=57]="NINE",t[t.LOWER_A=97]="LOWER_A",t[t.LOWER_F=102]="LOWER_F",t[t.LOWER_X=120]="LOWER_X",t[t.LOWER_Z=122]="LOWER_Z",t[t.UPPER_A=65]="UPPER_A",t[t.UPPER_F=70]="UPPER_F",t[t.UPPER_Z=90]="UPPER_Z"})(Ct||(Ct={}));const cD=32;var $r;(function(t){t[t.VALUE_LENGTH=49152]="VALUE_LENGTH",t[t.BRANCH_LENGTH=16256]="BRANCH_LENGTH",t[t.JUMP_TABLE=127]="JUMP_TABLE"})($r||($r={}));function Uh(t){return t>=Ct.ZERO&&t<=Ct.NINE}function lD(t){return t>=Ct.UPPER_A&&t<=Ct.UPPER_F||t>=Ct.LOWER_A&&t<=Ct.LOWER_F}function dD(t){return t>=Ct.UPPER_A&&t<=Ct.UPPER_Z||t>=Ct.LOWER_A&&t<=Ct.LOWER_Z||Uh(t)}function hD(t){return t===Ct.EQUALS||dD(t)}var Tt;(function(t){t[t.EntityStart=0]="EntityStart",t[t.NumericStart=1]="NumericStart",t[t.NumericDecimal=2]="NumericDecimal",t[t.NumericHex=3]="NumericHex",t[t.NamedEntity=4]="NamedEntity"})(Tt||(Tt={}));var Cn;(function(t){t[t.Legacy=0]="Legacy",t[t.Strict=1]="Strict",t[t.Attribute=2]="Attribute"})(Cn||(Cn={}));class bm{constructor(e,n,r){this.decodeTree=e,this.emitCodePoint=n,this.errors=r,this.state=Tt.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=Cn.Strict}startEntity(e){this.decodeMode=e,this.state=Tt.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(e,n){switch(this.state){case Tt.EntityStart:return e.charCodeAt(n)===Ct.NUM?(this.state=Tt.NumericStart,this.consumed+=1,this.stateNumericStart(e,n+1)):(this.state=Tt.NamedEntity,this.stateNamedEntity(e,n));case Tt.NumericStart:return this.stateNumericStart(e,n);case Tt.NumericDecimal:return this.stateNumericDecimal(e,n);case Tt.NumericHex:return this.stateNumericHex(e,n);case Tt.NamedEntity:return this.stateNamedEntity(e,n)}}stateNumericStart(e,n){return n>=e.length?-1:(e.charCodeAt(n)|cD)===Ct.LOWER_X?(this.state=Tt.NumericHex,this.consumed+=1,this.stateNumericHex(e,n+1)):(this.state=Tt.NumericDecimal,this.stateNumericDecimal(e,n))}addToNumericResult(e,n,r,s){if(n!==r){const a=r-n;this.result=this.result*Math.pow(s,a)+parseInt(e.substr(n,a),s),this.consumed+=a}}stateNumericHex(e,n){const r=n;for(;n<e.length;){const s=e.charCodeAt(n);if(Uh(s)||lD(s))n+=1;else return this.addToNumericResult(e,r,n,16),this.emitNumericEntity(s,3)}return this.addToNumericResult(e,r,n,16),-1}stateNumericDecimal(e,n){const r=n;for(;n<e.length;){const s=e.charCodeAt(n);if(Uh(s))n+=1;else return this.addToNumericResult(e,r,n,10),this.emitNumericEntity(s,2)}return this.addToNumericResult(e,r,n,10),-1}emitNumericEntity(e,n){var r;if(this.consumed<=n)return(r=this.errors)===null||r===void 0||r.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===Ct.SEMI)this.consumed+=1;else if(this.decodeMode===Cn.Strict)return 0;return this.emitCodePoint(uD(this.result),this.consumed),this.errors&&(e!==Ct.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(e,n){const{decodeTree:r}=this;let s=r[this.treeIndex],a=(s&$r.VALUE_LENGTH)>>14;for(;n<e.length;n++,this.excess++){const i=e.charCodeAt(n);if(this.treeIndex=fD(r,s,this.treeIndex+Math.max(1,a),i),this.treeIndex<0)return this.result===0||this.decodeMode===Cn.Attribute&&(a===0||hD(i))?0:this.emitNotTerminatedNamedEntity();if(s=r[this.treeIndex],a=(s&$r.VALUE_LENGTH)>>14,a!==0){if(i===Ct.SEMI)return this.emitNamedEntityData(this.treeIndex,a,this.consumed+this.excess);this.decodeMode!==Cn.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var e;const{result:n,decodeTree:r}=this,s=(r[n]&$r.VALUE_LENGTH)>>14;return this.emitNamedEntityData(n,s,this.consumed),(e=this.errors)===null||e===void 0||e.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(e,n,r){const{decodeTree:s}=this;return this.emitCodePoint(n===1?s[e]&~$r.VALUE_LENGTH:s[e+1],r),n===3&&this.emitCodePoint(s[e+2],r),r}end(){var e;switch(this.state){case Tt.NamedEntity:return this.result!==0&&(this.decodeMode!==Cn.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case Tt.NumericDecimal:return this.emitNumericEntity(0,2);case Tt.NumericHex:return this.emitNumericEntity(0,3);case Tt.NumericStart:return(e=this.errors)===null||e===void 0||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case Tt.EntityStart:return 0}}}function ZE(t){let e="";const n=new bm(t,r=>e+=Fh(r));return function(s,a){let i=0,o=0;for(;(o=s.indexOf("&",o))>=0;){e+=s.slice(i,o),n.startEntity(a);const c=n.write(s,o+1);if(c<0){i=o+n.end();break}i=o+c,o=c===0?i+1:i}const u=e+s.slice(i);return e="",u}}function fD(t,e,n,r){const s=(e&$r.BRANCH_LENGTH)>>7,a=e&$r.JUMP_TABLE;if(s===0)return a!==0&&r===a?n:-1;if(a){const u=r-a;return u<0||u>=s?-1:t[n+u]-1}let i=n,o=i+s-1;for(;i<=o;){const u=i+o>>>1,c=t[u];if(c<r)i=u+1;else if(c>r)o=u-1;else return t[u+s]}return-1}ZE(gm);ZE(YE);const j0=/["&'<>$\x80-\uFFFF]/g,mD=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]),pD=String.prototype.codePointAt!=null?(t,e)=>t.codePointAt(e):(t,e)=>(t.charCodeAt(e)&64512)===55296?(t.charCodeAt(e)-55296)*1024+t.charCodeAt(e+1)-56320+65536:t.charCodeAt(e);function JE(t){let e="",n=0,r;for(;(r=j0.exec(t))!==null;){const s=r.index,a=t.charCodeAt(s),i=mD.get(a);i!==void 0?(e+=t.substring(n,s)+i,n=s+1):(e+=`${t.substring(n,s)}&#x${pD(t,s).toString(16)};`,n=j0.lastIndex+=+((a&64512)===55296))}return e+t.substr(n)}function XE(t,e){return function(r){let s,a=0,i="";for(;s=t.exec(r);)a!==s.index&&(i+=r.substring(a,s.index)),i+=e.get(s[0].charCodeAt(0)),a=s.index+1;return i+r.substring(a)}}const QE=XE(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),ew=XE(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]])),gD=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(t=>[t.toLowerCase(),t])),bD=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(t=>[t.toLowerCase(),t])),_D=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function yD(t){return t.replace(/"/g,"&quot;")}function ED(t,e){var n;if(!t)return;const r=((n=e.encodeEntities)!==null&&n!==void 0?n:e.decodeEntities)===!1?yD:e.xmlMode||e.encodeEntities!=="utf8"?JE:QE;return Object.keys(t).map(s=>{var a,i;const o=(a=t[s])!==null&&a!==void 0?a:"";return e.xmlMode==="foreign"&&(s=(i=bD.get(s))!==null&&i!==void 0?i:s),!e.emptyAttrs&&!e.xmlMode&&o===""?s:`${s}="${r(o)}"`}).join(" ")}const H0=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function ol(t,e={}){const n="length"in t?t:[t];let r="";for(let s=0;s<n.length;s++)r+=wD(n[s],e);return r}function wD(t,e){switch(t.type){case J4:return ol(t.children,e);case aD:case Q4:return CD(t);case eD:return ID(t);case sD:return OD(t);case tD:case nD:case rD:return AD(t,e);case X4:return vD(t,e)}}const TD=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),SD=new Set(["svg","math"]);function AD(t,e){var n;e.xmlMode==="foreign"&&(t.name=(n=gD.get(t.name))!==null&&n!==void 0?n:t.name,t.parent&&TD.has(t.parent.name)&&(e={...e,xmlMode:!1})),!e.xmlMode&&SD.has(t.name)&&(e={...e,xmlMode:"foreign"});let r=`<${t.name}`;const s=ED(t.attribs,e);return s&&(r+=` ${s}`),t.children.length===0&&(e.xmlMode?e.selfClosingTags!==!1:e.selfClosingTags&&H0.has(t.name))?(e.xmlMode||(r+=" "),r+="/>"):(r+=">",t.children.length>0&&(r+=ol(t.children,e)),(e.xmlMode||!H0.has(t.name))&&(r+=`</${t.name}>`)),r}function CD(t){return`<${t.data}>`}function vD(t,e){var n;let r=t.data||"";return((n=e.encodeEntities)!==null&&n!==void 0?n:e.decodeEntities)!==!1&&!(!e.xmlMode&&t.parent&&_D.has(t.parent.name))&&(r=e.xmlMode||e.encodeEntities!=="utf8"?JE(r):ew(r)),r}function OD(t){return`<![CDATA[${t.children[0].data}]]>`}function ID(t){return`<!--${t.data}-->`}function tw(t,e){return ol(t,e)}function kD(t,e){return ht(t)?t.children.map(n=>tw(n,e)).join(""):""}function Iu(t){return Array.isArray(t)?t.map(Iu).join(""):be(t)?t.name==="br"?`
`:Iu(t.children):al(t)?Iu(t.children):mr(t)?t.data:""}function pa(t){return Array.isArray(t)?t.map(pa).join(""):ht(t)&&!il(t)?pa(t.children):mr(t)?t.data:""}function lc(t){return Array.isArray(t)?t.map(lc).join(""):ht(t)&&(t.type===Ge.Tag||al(t))?lc(t.children):mr(t)?t.data:""}function ul(t){return ht(t)?t.children:[]}function nw(t){return t.parent||null}function rw(t){const e=nw(t);if(e!=null)return ul(e);const n=[t];let{prev:r,next:s}=t;for(;r!=null;)n.unshift(r),{prev:r}=r;for(;s!=null;)n.push(s),{next:s}=s;return n}function ND(t,e){var n;return(n=t.attribs)===null||n===void 0?void 0:n[e]}function RD(t,e){return t.attribs!=null&&Object.prototype.hasOwnProperty.call(t.attribs,e)&&t.attribs[e]!=null}function PD(t){return t.name}function _m(t){let{next:e}=t;for(;e!==null&&!be(e);)({next:e}=e);return e}function ym(t){let{prev:e}=t;for(;e!==null&&!be(e);)({prev:e}=e);return e}function Ps(t){if(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.parent){const e=t.parent.children,n=e.lastIndexOf(t);n>=0&&e.splice(n,1)}t.next=null,t.prev=null,t.parent=null}function xD(t,e){const n=e.prev=t.prev;n&&(n.next=e);const r=e.next=t.next;r&&(r.prev=e);const s=e.parent=t.parent;if(s){const a=s.children;a[a.lastIndexOf(t)]=e,t.parent=null}}function LD(t,e){if(Ps(e),e.next=null,e.parent=t,t.children.push(e)>1){const n=t.children[t.children.length-2];n.next=e,e.prev=n}else e.prev=null}function DD(t,e){Ps(e);const{parent:n}=t,r=t.next;if(e.next=r,e.prev=t,t.next=e,e.parent=n,r){if(r.prev=e,n){const s=n.children;s.splice(s.lastIndexOf(r),0,e)}}else n&&n.children.push(e)}function MD(t,e){if(Ps(e),e.parent=t,e.prev=null,t.children.unshift(e)!==1){const n=t.children[1];n.prev=e,e.next=n}else e.next=null}function BD(t,e){Ps(e);const{parent:n}=t;if(n){const r=n.children;r.splice(r.indexOf(t),0,e)}t.prev&&(t.prev.next=e),e.parent=n,e.prev=t.prev,e.next=t,t.prev=e}function wo(t,e,n=!0,r=1/0){return Em(t,Array.isArray(e)?e:[e],n,r)}function Em(t,e,n,r){const s=[],a=[Array.isArray(e)?e:[e]],i=[0];for(;;){if(i[0]>=a[0].length){if(i.length===1)return s;a.shift(),i.shift();continue}const o=a[0][i[0]++];if(t(o)&&(s.push(o),--r<=0))return s;n&&ht(o)&&o.children.length>0&&(i.unshift(0),a.unshift(o.children))}}function FD(t,e){return e.find(t)}function wm(t,e,n=!0){const r=Array.isArray(e)?e:[e];for(let s=0;s<r.length;s++){const a=r[s];if(be(a)&&t(a))return a;if(n&&ht(a)&&a.children.length>0){const i=wm(t,a.children,!0);if(i)return i}}return null}function sw(t,e){return(Array.isArray(e)?e:[e]).some(n=>be(n)&&t(n)||ht(n)&&sw(t,n.children))}function UD(t,e){const n=[],r=[Array.isArray(e)?e:[e]],s=[0];for(;;){if(s[0]>=r[0].length){if(r.length===1)return n;r.shift(),s.shift();continue}const a=r[0][s[0]++];be(a)&&t(a)&&n.push(a),ht(a)&&a.children.length>0&&(s.unshift(0),r.unshift(a.children))}}const dc={tag_name(t){return typeof t=="function"?e=>be(e)&&t(e.name):t==="*"?be:e=>be(e)&&e.name===t},tag_type(t){return typeof t=="function"?e=>t(e.type):e=>e.type===t},tag_contains(t){return typeof t=="function"?e=>mr(e)&&t(e.data):e=>mr(e)&&e.data===t}};function Tm(t,e){return typeof e=="function"?n=>be(n)&&e(n.attribs[t]):n=>be(n)&&n.attribs[t]===e}function jD(t,e){return n=>t(n)||e(n)}function aw(t){const e=Object.keys(t).map(n=>{const r=t[n];return Object.prototype.hasOwnProperty.call(dc,n)?dc[n](r):Tm(n,r)});return e.length===0?null:e.reduce(jD)}function HD(t,e){const n=aw(t);return n?n(e):!0}function $D(t,e,n,r=1/0){const s=aw(t);return s?wo(s,e,n,r):[]}function qD(t,e,n=!0){return Array.isArray(e)||(e=[e]),wm(Tm("id",t),e,n)}function Na(t,e,n=!0,r=1/0){return wo(dc.tag_name(t),e,n,r)}function VD(t,e,n=!0,r=1/0){return wo(Tm("class",t),e,n,r)}function zD(t,e,n=!0,r=1/0){return wo(dc.tag_type(t),e,n,r)}function WD(t){let e=t.length;for(;--e>=0;){const n=t[e];if(e>0&&t.lastIndexOf(n,e-1)>=0){t.splice(e,1);continue}for(let r=n.parent;r;r=r.parent)if(t.includes(r)){t.splice(e,1);break}}return t}var An;(function(t){t[t.DISCONNECTED=1]="DISCONNECTED",t[t.PRECEDING=2]="PRECEDING",t[t.FOLLOWING=4]="FOLLOWING",t[t.CONTAINS=8]="CONTAINS",t[t.CONTAINED_BY=16]="CONTAINED_BY"})(An||(An={}));function iw(t,e){const n=[],r=[];if(t===e)return 0;let s=ht(t)?t:t.parent;for(;s;)n.unshift(s),s=s.parent;for(s=ht(e)?e:e.parent;s;)r.unshift(s),s=s.parent;const a=Math.min(n.length,r.length);let i=0;for(;i<a&&n[i]===r[i];)i++;if(i===0)return An.DISCONNECTED;const o=n[i-1],u=o.children,c=n[i],l=r[i];return u.indexOf(c)>u.indexOf(l)?o===e?An.FOLLOWING|An.CONTAINED_BY:An.FOLLOWING:o===t?An.PRECEDING|An.CONTAINS:An.PRECEDING}function Ra(t){return t=t.filter((e,n,r)=>!r.includes(e,n+1)),t.sort((e,n)=>{const r=iw(e,n);return r&An.PRECEDING?-1:r&An.FOLLOWING?1:0}),t}function GD(t){const e=hc(XD,t);return e?e.name==="feed"?KD(e):YD(e):null}function KD(t){var e;const n=t.children,r={type:"atom",items:Na("entry",n).map(i=>{var o;const{children:u}=i,c={media:ow(u)};Zt(c,"id","id",u),Zt(c,"title","title",u);const l=(o=hc("link",u))===null||o===void 0?void 0:o.attribs.href;l&&(c.link=l);const d=qr("summary",u)||qr("content",u);d&&(c.description=d);const m=qr("updated",u);return m&&(c.pubDate=new Date(m)),c})};Zt(r,"id","id",n),Zt(r,"title","title",n);const s=(e=hc("link",n))===null||e===void 0?void 0:e.attribs.href;s&&(r.link=s),Zt(r,"description","subtitle",n);const a=qr("updated",n);return a&&(r.updated=new Date(a)),Zt(r,"author","email",n,!0),r}function YD(t){var e,n;const r=(n=(e=hc("channel",t.children))===null||e===void 0?void 0:e.children)!==null&&n!==void 0?n:[],s={type:t.name.substr(0,3),id:"",items:Na("item",t.children).map(i=>{const{children:o}=i,u={media:ow(o)};Zt(u,"id","guid",o),Zt(u,"title","title",o),Zt(u,"link","link",o),Zt(u,"description","description",o);const c=qr("pubDate",o)||qr("dc:date",o);return c&&(u.pubDate=new Date(c)),u})};Zt(s,"title","title",r),Zt(s,"link","link",r),Zt(s,"description","description",r);const a=qr("lastBuildDate",r);return a&&(s.updated=new Date(a)),Zt(s,"author","managingEditor",r,!0),s}const ZD=["url","type","lang"],JD=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function ow(t){return Na("media:content",t).map(e=>{const{attribs:n}=e,r={medium:n.medium,isDefault:!!n.isDefault};for(const s of ZD)n[s]&&(r[s]=n[s]);for(const s of JD)n[s]&&(r[s]=parseInt(n[s],10));return n.expression&&(r.expression=n.expression),r})}function hc(t,e){return Na(t,e,!0,1)[0]}function qr(t,e,n=!1){return pa(Na(t,e,n,1)).trim()}function Zt(t,e,n,r,s=!1){const a=qr(n,r,s);a&&(t[e]=a)}function XD(t){return t==="rss"||t==="feed"||t==="rdf:RDF"}const cl=Object.freeze(Object.defineProperty({__proto__:null,get DocumentPosition(){return An},append:DD,appendChild:LD,compareDocumentPosition:iw,existsOne:sw,filter:wo,find:Em,findAll:UD,findOne:wm,findOneChild:FD,getAttributeValue:ND,getChildren:ul,getElementById:qD,getElements:$D,getElementsByClassName:VD,getElementsByTagName:Na,getElementsByTagType:zD,getFeed:GD,getInnerHTML:kD,getName:PD,getOuterHTML:tw,getParent:nw,getSiblings:rw,getText:Iu,hasAttrib:RD,hasChildren:ht,innerText:lc,isCDATA:al,isComment:il,isDocument:Xr,isTag:be,isText:mr,nextElementSibling:_m,prepend:BD,prependChild:MD,prevElementSibling:ym,removeElement:Ps,removeSubsets:WD,replaceElement:xD,testElement:HD,textContent:pa,uniqueSort:Ra},Symbol.toStringTag,{value:"Module"})),QD={_useHtmlParser2:!1};function jh(t,e){if(!t)return e??QD;const n={_useHtmlParser2:!!t.xmlMode,...e,...t};return t.xml?(n._useHtmlParser2=!0,n.xmlMode=!0,t.xml!==!0&&Object.assign(n,t.xml)):t.xmlMode&&(n._useHtmlParser2=!0),n}function uw(t,e,n){return t?t(e??t._root.children,null,void 0,n).toString():""}function eM(t,e){return typeof t=="object"&&t!=null&&!("length"in t)&&!("type"in t)}function tM(t,e){const n=eM(t)?(e=t,void 0):t,r={...this===null||this===void 0?void 0:this._options,...jh(e)};return uw(this,n,r)}function nM(t){const e={...this._options,xmlMode:!0};return uw(this,t,e)}function Yi(t){const e=t??(this?this.root():[]);let n="";for(let r=0;r<e.length;r++)n+=pa(e[r]);return n}function rM(t,e,n=typeof e=="boolean"?e:!1){if(!t||typeof t!="string")return null;typeof e=="boolean"&&(n=e);const r=this.load(t,this._options,!1);return n||r("script").remove(),[...r.root()[0].children]}function sM(){return this(this._root)}function cw(t,e){if(e===t)return!1;let n=e;for(;n&&n!==n.parent;)if(n=n.parent,n===t)return!0;return!1}function aM(t){return this.root().extract(t)}function iM(t,e){if(!$0(t)||!$0(e))return;let n=t.length;const r=+e.length;for(let s=0;s<r;s++)t[n++]=e[s];return t.length=n,t}function $0(t){if(Array.isArray(t))return!0;if(typeof t!="object"||t===null||!("length"in t)||typeof t.length!="number"||t.length<0)return!1;for(let e=0;e<t.length;e++)if(!(e in t))return!1;return!0}const oM=Object.freeze(Object.defineProperty({__proto__:null,contains:cw,extract:aM,html:tM,merge:iM,parseHTML:rM,root:sM,text:Yi,xml:nM},Symbol.toStringTag,{value:"Module"}));function kr(t){return t.cheerio!=null}function uM(t){return t.replace(/[._-](\w|$)/g,(e,n)=>n.toUpperCase())}function cM(t){return t.replace(/[A-Z]/g,"-$&").toLowerCase()}function ut(t,e){const n=t.length;for(let r=0;r<n;r++)e(t[r],r);return t}var rs;(function(t){t[t.LowerA=97]="LowerA",t[t.LowerZ=122]="LowerZ",t[t.UpperA=65]="UpperA",t[t.UpperZ=90]="UpperZ",t[t.Exclamation=33]="Exclamation"})(rs||(rs={}));function Hh(t){const e=t.indexOf("<");if(e<0||e>t.length-3)return!1;const n=t.charCodeAt(e+1);return(n>=rs.LowerA&&n<=rs.LowerZ||n>=rs.UpperA&&n<=rs.UpperZ||n===rs.Exclamation)&&t.includes(">",e+2)}const Zi=Object.prototype.hasOwnProperty,Ji=/\s+/,$h="data-",Sm=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,lM=/^{[^]*}$|^\[[^]*]$/;function fc(t,e,n){var r;if(!(!t||!be(t))){if((r=t.attribs)!==null&&r!==void 0||(t.attribs={}),!e)return t.attribs;if(Zi.call(t.attribs,e))return!n&&Sm.test(e)?e:t.attribs[e];if(t.name==="option"&&e==="value")return Yi(t.children);if(t.name==="input"&&(t.attribs.type==="radio"||t.attribs.type==="checkbox")&&e==="value")return"on"}}function oa(t,e,n){n===null?dw(t,e):t.attribs[e]=`${n}`}function dM(t,e){if(typeof t=="object"||e!==void 0){if(typeof e=="function"){if(typeof t!="string")throw new Error("Bad combination of arguments.");return ut(this,(n,r)=>{be(n)&&oa(n,t,e.call(n,r,n.attribs[t]))})}return ut(this,n=>{if(be(n))if(typeof t=="object")for(const r of Object.keys(t)){const s=t[r];oa(n,r,s)}else oa(n,t,e)})}return arguments.length>1?this:fc(this[0],t,this.options.xmlMode)}function q0(t,e,n){return e in t?t[e]:!n&&Sm.test(e)?fc(t,e,!1)!==void 0:fc(t,e,n)}function Sd(t,e,n,r){e in t?t[e]=n:oa(t,e,!r&&Sm.test(e)?n?"":null:`${n}`)}function hM(t,e){var n;if(typeof t=="string"&&e===void 0){const r=this[0];if(!r||!be(r))return;switch(t){case"style":{const s=this.css(),a=Object.keys(s);for(let i=0;i<a.length;i++)s[i]=a[i];return s.length=a.length,s}case"tagName":case"nodeName":return r.name.toUpperCase();case"href":case"src":{const s=(n=r.attribs)===null||n===void 0?void 0:n[t];return typeof URL<"u"&&(t==="href"&&(r.tagName==="a"||r.tagName==="link")||t==="src"&&(r.tagName==="img"||r.tagName==="iframe"||r.tagName==="audio"||r.tagName==="video"||r.tagName==="source"))&&s!==void 0&&this.options.baseURI?new URL(s,this.options.baseURI).href:s}case"innerText":return lc(r);case"textContent":return pa(r);case"outerHTML":return this.clone().wrap("<container />").parent().html();case"innerHTML":return this.html();default:return q0(r,t,this.options.xmlMode)}}if(typeof t=="object"||e!==void 0){if(typeof e=="function"){if(typeof t=="object")throw new TypeError("Bad combination of arguments.");return ut(this,(r,s)=>{be(r)&&Sd(r,t,e.call(r,s,q0(r,t,this.options.xmlMode)),this.options.xmlMode)})}return ut(this,r=>{if(be(r))if(typeof t=="object")for(const s of Object.keys(t)){const a=t[s];Sd(r,s,a,this.options.xmlMode)}else Sd(r,t,e,this.options.xmlMode)})}}function V0(t,e,n){var r;(r=t.data)!==null&&r!==void 0||(t.data={}),typeof e=="object"?Object.assign(t.data,e):typeof e=="string"&&n!==void 0&&(t.data[e]=n)}function fM(t){for(const e of Object.keys(t.attribs)){if(!e.startsWith($h))continue;const n=uM(e.slice($h.length));Zi.call(t.data,n)||(t.data[n]=lw(t.attribs[e]))}return t.data}function mM(t,e){const n=$h+cM(e),r=t.data;if(Zi.call(r,e))return r[e];if(Zi.call(t.attribs,n))return r[e]=lw(t.attribs[n])}function lw(t){if(t==="null")return null;if(t==="true")return!0;if(t==="false")return!1;const e=Number(t);if(t===String(e))return e;if(lM.test(t))try{return JSON.parse(t)}catch{}return t}function pM(t,e){var n;const r=this[0];if(!r||!be(r))return;const s=r;return(n=s.data)!==null&&n!==void 0||(s.data={}),t==null?fM(s):typeof t=="object"||e!==void 0?(ut(this,a=>{be(a)&&(typeof t=="object"?V0(a,t):V0(a,t,e))}),this):mM(s,t)}function gM(t){const e=arguments.length===0,n=this[0];if(!n||!be(n))return e?void 0:this;switch(n.name){case"textarea":return this.text(t);case"select":{const r=this.find("option:selected");if(!e){if(this.attr("multiple")==null&&typeof t=="object")return this;this.find("option").removeAttr("selected");const s=typeof t=="object"?t:[t];for(const a of s)this.find(`option[value="${a}"]`).attr("selected","");return this}return this.attr("multiple")?r.toArray().map(s=>Yi(s.children)):r.attr("value")}case"input":case"option":return e?this.attr("value"):this.attr("value",t)}}function dw(t,e){!t.attribs||!Zi.call(t.attribs,e)||delete t.attribs[e]}function mc(t){return t?t.trim().split(Ji):[]}function bM(t){const e=mc(t);for(const n of e)ut(this,r=>{be(r)&&dw(r,n)});return this}function _M(t){return this.toArray().some(e=>{const n=be(e)&&e.attribs.class;let r=-1;if(n&&t.length>0)for(;(r=n.indexOf(t,r+1))>-1;){const s=r+t.length;if((r===0||Ji.test(n[r-1]))&&(s===n.length||Ji.test(n[s])))return!0}return!1})}function hw(t){if(typeof t=="function")return ut(this,(r,s)=>{if(be(r)){const a=r.attribs.class||"";hw.call([r],t.call(r,s,a))}});if(!t||typeof t!="string")return this;const e=t.split(Ji),n=this.length;for(let r=0;r<n;r++){const s=this[r];if(!be(s))continue;const a=fc(s,"class",!1);if(a){let i=` ${a} `;for(const o of e){const u=`${o} `;i.includes(` ${u}`)||(i+=u)}oa(s,"class",i.trim())}else oa(s,"class",e.join(" ").trim())}return this}function fw(t){if(typeof t=="function")return ut(this,(s,a)=>{be(s)&&fw.call([s],t.call(s,a,s.attribs.class||""))});const e=mc(t),n=e.length,r=arguments.length===0;return ut(this,s=>{if(be(s))if(r)s.attribs.class="";else{const a=mc(s.attribs.class);let i=!1;for(let o=0;o<n;o++){const u=a.indexOf(e[o]);u>=0&&(a.splice(u,1),i=!0,o--)}i&&(s.attribs.class=a.join(" "))}})}function mw(t,e){if(typeof t=="function")return ut(this,(i,o)=>{be(i)&&mw.call([i],t.call(i,o,i.attribs.class||"",e),e)});if(!t||typeof t!="string")return this;const n=t.split(Ji),r=n.length,s=typeof e=="boolean"?e?1:-1:0,a=this.length;for(let i=0;i<a;i++){const o=this[i];if(!be(o))continue;const u=mc(o.attribs.class);for(let c=0;c<r;c++){const l=u.indexOf(n[c]);s>=0&&l<0?u.push(n[c]):s<=0&&l>=0&&u.splice(l,1)}o.attribs.class=u.join(" ")}return this}const yM=Object.freeze(Object.defineProperty({__proto__:null,addClass:hw,attr:dM,data:pM,hasClass:_M,prop:hM,removeAttr:bM,removeClass:fw,toggleClass:mw,val:gM},Symbol.toStringTag,{value:"Module"}));var me;(function(t){t.Attribute="attribute",t.Pseudo="pseudo",t.PseudoElement="pseudo-element",t.Tag="tag",t.Universal="universal",t.Adjacent="adjacent",t.Child="child",t.Descendant="descendant",t.Parent="parent",t.Sibling="sibling",t.ColumnCombinator="column-combinator"})(me||(me={}));var _t;(function(t){t.Any="any",t.Element="element",t.End="end",t.Equals="equals",t.Exists="exists",t.Hyphen="hyphen",t.Not="not",t.Start="start"})(_t||(_t={}));const z0=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,EM=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,wM=new Map([[126,_t.Element],[94,_t.Start],[36,_t.End],[42,_t.Any],[33,_t.Not],[124,_t.Hyphen]]),TM=new Set(["has","not","matches","is","where","host","host-context"]);function gi(t){switch(t.type){case me.Adjacent:case me.Child:case me.Descendant:case me.Parent:case me.Sibling:case me.ColumnCombinator:return!0;default:return!1}}const SM=new Set(["contains","icontains"]);function AM(t,e,n){const r=parseInt(e,16)-65536;return r!==r||n?e:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,r&1023|56320)}function Wa(t){return t.replace(EM,AM)}function Ad(t){return t===39||t===34}function W0(t){return t===32||t===9||t===10||t===12||t===13}function ll(t){const e=[],n=pw(e,`${t}`,0);if(n<t.length)throw new Error(`Unmatched selector: ${t.slice(n)}`);return e}function pw(t,e,n){let r=[];function s(m){const p=e.slice(n+m).match(z0);if(!p)throw new Error(`Expected name, found ${e.slice(n)}`);const[f]=p;return n+=m+f.length,Wa(f)}function a(m){for(n+=m;n<e.length&&W0(e.charCodeAt(n));)n++}function i(){n+=1;const m=n;let p=1;for(;p>0&&n<e.length;n++)e.charCodeAt(n)===40&&!o(n)?p++:e.charCodeAt(n)===41&&!o(n)&&p--;if(p)throw new Error("Parenthesis not matched");return Wa(e.slice(m,n-1))}function o(m){let p=0;for(;e.charCodeAt(--m)===92;)p++;return(p&1)===1}function u(){if(r.length>0&&gi(r[r.length-1]))throw new Error("Did not expect successive traversals.")}function c(m){if(r.length>0&&r[r.length-1].type===me.Descendant){r[r.length-1].type=m;return}u(),r.push({type:m})}function l(m,p){r.push({type:me.Attribute,name:m,action:p,value:s(1),namespace:null,ignoreCase:"quirks"})}function d(){if(r.length&&r[r.length-1].type===me.Descendant&&r.pop(),r.length===0)throw new Error("Empty sub-selector");t.push(r)}if(a(0),e.length===n)return n;e:for(;n<e.length;){const m=e.charCodeAt(n);switch(m){case 32:case 9:case 10:case 12:case 13:{(r.length===0||r[0].type!==me.Descendant)&&(u(),r.push({type:me.Descendant})),a(1);break}case 62:{c(me.Child),a(1);break}case 60:{c(me.Parent),a(1);break}case 126:{c(me.Sibling),a(1);break}case 43:{c(me.Adjacent),a(1);break}case 46:{l("class",_t.Element);break}case 35:{l("id",_t.Equals);break}case 91:{a(1);let p,f=null;e.charCodeAt(n)===124?p=s(1):e.startsWith("*|",n)?(f="*",p=s(2)):(p=s(0),e.charCodeAt(n)===124&&e.charCodeAt(n+1)!==61&&(f=p,p=s(1))),a(0);let g=_t.Exists;const b=wM.get(e.charCodeAt(n));if(b){if(g=b,e.charCodeAt(n+1)!==61)throw new Error("Expected `=`");a(2)}else e.charCodeAt(n)===61&&(g=_t.Equals,a(1));let _="",y=null;if(g!=="exists"){if(Ad(e.charCodeAt(n))){const w=e.charCodeAt(n);let O=n+1;for(;O<e.length&&(e.charCodeAt(O)!==w||o(O));)O+=1;if(e.charCodeAt(O)!==w)throw new Error("Attribute value didn't end");_=Wa(e.slice(n+1,O)),n=O+1}else{const w=n;for(;n<e.length&&(!W0(e.charCodeAt(n))&&e.charCodeAt(n)!==93||o(n));)n+=1;_=Wa(e.slice(w,n))}a(0);const I=e.charCodeAt(n)|32;I===115?(y=!1,a(1)):I===105&&(y=!0,a(1))}if(e.charCodeAt(n)!==93)throw new Error("Attribute selector didn't terminate");n+=1;const E={type:me.Attribute,name:p,action:g,value:_,namespace:f,ignoreCase:y};r.push(E);break}case 58:{if(e.charCodeAt(n+1)===58){r.push({type:me.PseudoElement,name:s(2).toLowerCase(),data:e.charCodeAt(n)===40?i():null});continue}const p=s(1).toLowerCase();let f=null;if(e.charCodeAt(n)===40)if(TM.has(p)){if(Ad(e.charCodeAt(n+1)))throw new Error(`Pseudo-selector ${p} cannot be quoted`);if(f=[],n=pw(f,e,n+1),e.charCodeAt(n)!==41)throw new Error(`Missing closing parenthesis in :${p} (${e})`);n+=1}else{if(f=i(),SM.has(p)){const g=f.charCodeAt(0);g===f.charCodeAt(f.length-1)&&Ad(g)&&(f=f.slice(1,-1))}f=Wa(f)}r.push({type:me.Pseudo,name:p,data:f});break}case 44:{d(),r=[],a(1);break}default:{if(e.startsWith("/*",n)){const g=e.indexOf("*/",n+2);if(g<0)throw new Error("Comment was not terminated");n=g+2,r.length===0&&a(0);break}let p=null,f;if(m===42)n+=1,f="*";else if(m===124){if(f="",e.charCodeAt(n+1)===124){c(me.ColumnCombinator),a(2);break}}else if(z0.test(e.slice(n)))f=s(0);else break e;e.charCodeAt(n)===124&&e.charCodeAt(n+1)!==124&&(p=f,e.charCodeAt(n+1)===42?(f="*",n+=2):f=s(1)),r.push(f==="*"?{type:me.Universal,namespace:p}:{type:me.Tag,name:f,namespace:p})}}}return d(),n}var pc={trueFunc:function(){return!0},falseFunc:function(){return!1}};const Re=ro(pc),gw=new Map([[me.Universal,50],[me.Tag,30],[me.Attribute,1],[me.Pseudo,0]]);function Am(t){return!gw.has(t.type)}const CM=new Map([[_t.Exists,10],[_t.Equals,8],[_t.Not,7],[_t.Start,6],[_t.End,6],[_t.Any,5]]);function vM(t){const e=t.map(bw);for(let n=1;n<t.length;n++){const r=e[n];if(!(r<0))for(let s=n-1;s>=0&&r<e[s];s--){const a=t[s+1];t[s+1]=t[s],t[s]=a,e[s+1]=e[s],e[s]=r}}}function bw(t){var e,n;let r=(e=gw.get(t.type))!==null&&e!==void 0?e:-1;return t.type===me.Attribute?(r=(n=CM.get(t.action))!==null&&n!==void 0?n:4,t.action===_t.Equals&&t.name==="id"&&(r=9),t.ignoreCase&&(r>>=1)):t.type===me.Pseudo&&(t.data?t.name==="has"||t.name==="contains"?r=0:Array.isArray(t.data)?(r=Math.min(...t.data.map(s=>Math.min(...s.map(bw)))),r<0&&(r=0)):r=2:r=3),r}const OM=/[-[\]{}()*+?.,\\^$|#\s]/g;function G0(t){return t.replace(OM,"\\$&")}const IM=new Set(["accept","accept-charset","align","alink","axis","bgcolor","charset","checked","clear","codetype","color","compact","declare","defer","dir","direction","disabled","enctype","face","frame","hreflang","http-equiv","lang","language","link","media","method","multiple","nohref","noresize","noshade","nowrap","readonly","rel","rev","rules","scope","scrolling","selected","shape","target","text","type","valign","valuetype","vlink"]);function ts(t,e){return typeof t.ignoreCase=="boolean"?t.ignoreCase:t.ignoreCase==="quirks"?!!e.quirksMode:!e.xmlMode&&IM.has(t.name)}const kM={equals(t,e,n){const{adapter:r}=n,{name:s}=e;let{value:a}=e;return ts(e,n)?(a=a.toLowerCase(),i=>{const o=r.getAttributeValue(i,s);return o!=null&&o.length===a.length&&o.toLowerCase()===a&&t(i)}):i=>r.getAttributeValue(i,s)===a&&t(i)},hyphen(t,e,n){const{adapter:r}=n,{name:s}=e;let{value:a}=e;const i=a.length;return ts(e,n)?(a=a.toLowerCase(),function(u){const c=r.getAttributeValue(u,s);return c!=null&&(c.length===i||c.charAt(i)==="-")&&c.substr(0,i).toLowerCase()===a&&t(u)}):function(u){const c=r.getAttributeValue(u,s);return c!=null&&(c.length===i||c.charAt(i)==="-")&&c.substr(0,i)===a&&t(u)}},element(t,e,n){const{adapter:r}=n,{name:s,value:a}=e;if(/\s/.test(a))return Re.falseFunc;const i=new RegExp(`(?:^|\\s)${G0(a)}(?:$|\\s)`,ts(e,n)?"i":"");return function(u){const c=r.getAttributeValue(u,s);return c!=null&&c.length>=a.length&&i.test(c)&&t(u)}},exists(t,{name:e},{adapter:n}){return r=>n.hasAttrib(r,e)&&t(r)},start(t,e,n){const{adapter:r}=n,{name:s}=e;let{value:a}=e;const i=a.length;return i===0?Re.falseFunc:ts(e,n)?(a=a.toLowerCase(),o=>{const u=r.getAttributeValue(o,s);return u!=null&&u.length>=i&&u.substr(0,i).toLowerCase()===a&&t(o)}):o=>{var u;return!!(!((u=r.getAttributeValue(o,s))===null||u===void 0)&&u.startsWith(a))&&t(o)}},end(t,e,n){const{adapter:r}=n,{name:s}=e;let{value:a}=e;const i=-a.length;return i===0?Re.falseFunc:ts(e,n)?(a=a.toLowerCase(),o=>{var u;return((u=r.getAttributeValue(o,s))===null||u===void 0?void 0:u.substr(i).toLowerCase())===a&&t(o)}):o=>{var u;return!!(!((u=r.getAttributeValue(o,s))===null||u===void 0)&&u.endsWith(a))&&t(o)}},any(t,e,n){const{adapter:r}=n,{name:s,value:a}=e;if(a==="")return Re.falseFunc;if(ts(e,n)){const i=new RegExp(G0(a),"i");return function(u){const c=r.getAttributeValue(u,s);return c!=null&&c.length>=a.length&&i.test(c)&&t(u)}}return i=>{var o;return!!(!((o=r.getAttributeValue(i,s))===null||o===void 0)&&o.includes(a))&&t(i)}},not(t,e,n){const{adapter:r}=n,{name:s}=e;let{value:a}=e;return a===""?i=>!!r.getAttributeValue(i,s)&&t(i):ts(e,n)?(a=a.toLowerCase(),i=>{const o=r.getAttributeValue(i,s);return(o==null||o.length!==a.length||o.toLowerCase()!==a)&&t(i)}):i=>r.getAttributeValue(i,s)!==a&&t(i)}},NM=new Set([9,10,12,13,32]),K0=48,RM=57;function PM(t){if(t=t.trim().toLowerCase(),t==="even")return[2,0];if(t==="odd")return[2,1];let e=0,n=0,r=a(),s=i();if(e<t.length&&t.charAt(e)==="n"&&(e++,n=r*(s??1),o(),e<t.length?(r=a(),o(),s=i()):r=s=0),s===null||e<t.length)throw new Error(`n-th rule couldn't be parsed ('${t}')`);return[n,r*s];function a(){return t.charAt(e)==="-"?(e++,-1):(t.charAt(e)==="+"&&e++,1)}function i(){const u=e;let c=0;for(;e<t.length&&t.charCodeAt(e)>=K0&&t.charCodeAt(e)<=RM;)c=c*10+(t.charCodeAt(e)-K0),e++;return e===u?null:c}function o(){for(;e<t.length&&NM.has(t.charCodeAt(e));)e++}}function xM(t){const e=t[0],n=t[1]-1;if(n<0&&e<=0)return Re.falseFunc;if(e===-1)return a=>a<=n;if(e===0)return a=>a===n;if(e===1)return n<0?Re.trueFunc:a=>a>=n;const r=Math.abs(e),s=(n%r+r)%r;return e>1?a=>a>=n&&a%r===s:a=>a<=n&&a%r===s}function cu(t){return xM(PM(t))}function lu(t,e){return n=>{const r=e.getParent(n);return r!=null&&e.isTag(r)&&t(n)}}const qh={contains(t,e,{adapter:n}){return function(s){return t(s)&&n.getText(s).includes(e)}},icontains(t,e,{adapter:n}){const r=e.toLowerCase();return function(a){return t(a)&&n.getText(a).toLowerCase().includes(r)}},"nth-child"(t,e,{adapter:n,equals:r}){const s=cu(e);return s===Re.falseFunc?Re.falseFunc:s===Re.trueFunc?lu(t,n):function(i){const o=n.getSiblings(i);let u=0;for(let c=0;c<o.length&&!r(i,o[c]);c++)n.isTag(o[c])&&u++;return s(u)&&t(i)}},"nth-last-child"(t,e,{adapter:n,equals:r}){const s=cu(e);return s===Re.falseFunc?Re.falseFunc:s===Re.trueFunc?lu(t,n):function(i){const o=n.getSiblings(i);let u=0;for(let c=o.length-1;c>=0&&!r(i,o[c]);c--)n.isTag(o[c])&&u++;return s(u)&&t(i)}},"nth-of-type"(t,e,{adapter:n,equals:r}){const s=cu(e);return s===Re.falseFunc?Re.falseFunc:s===Re.trueFunc?lu(t,n):function(i){const o=n.getSiblings(i);let u=0;for(let c=0;c<o.length;c++){const l=o[c];if(r(i,l))break;n.isTag(l)&&n.getName(l)===n.getName(i)&&u++}return s(u)&&t(i)}},"nth-last-of-type"(t,e,{adapter:n,equals:r}){const s=cu(e);return s===Re.falseFunc?Re.falseFunc:s===Re.trueFunc?lu(t,n):function(i){const o=n.getSiblings(i);let u=0;for(let c=o.length-1;c>=0;c--){const l=o[c];if(r(i,l))break;n.isTag(l)&&n.getName(l)===n.getName(i)&&u++}return s(u)&&t(i)}},root(t,e,{adapter:n}){return r=>{const s=n.getParent(r);return(s==null||!n.isTag(s))&&t(r)}},scope(t,e,n,r){const{equals:s}=n;return!r||r.length===0?qh.root(t,e,n):r.length===1?a=>s(r[0],a)&&t(a):a=>r.includes(a)&&t(a)},hover:Cd("isHovered"),visited:Cd("isVisited"),active:Cd("isActive")};function Cd(t){return function(n,r,{adapter:s}){const a=s[t];return typeof a!="function"?Re.falseFunc:function(o){return a(o)&&n(o)}}}const Y0={empty(t,{adapter:e}){return!e.getChildren(t).some(n=>e.isTag(n)||e.getText(n)!=="")},"first-child"(t,{adapter:e,equals:n}){if(e.prevElementSibling)return e.prevElementSibling(t)==null;const r=e.getSiblings(t).find(s=>e.isTag(s));return r!=null&&n(t,r)},"last-child"(t,{adapter:e,equals:n}){const r=e.getSiblings(t);for(let s=r.length-1;s>=0;s--){if(n(t,r[s]))return!0;if(e.isTag(r[s]))break}return!1},"first-of-type"(t,{adapter:e,equals:n}){const r=e.getSiblings(t),s=e.getName(t);for(let a=0;a<r.length;a++){const i=r[a];if(n(t,i))return!0;if(e.isTag(i)&&e.getName(i)===s)break}return!1},"last-of-type"(t,{adapter:e,equals:n}){const r=e.getSiblings(t),s=e.getName(t);for(let a=r.length-1;a>=0;a--){const i=r[a];if(n(t,i))return!0;if(e.isTag(i)&&e.getName(i)===s)break}return!1},"only-of-type"(t,{adapter:e,equals:n}){const r=e.getName(t);return e.getSiblings(t).every(s=>n(t,s)||!e.isTag(s)||e.getName(s)!==r)},"only-child"(t,{adapter:e,equals:n}){return e.getSiblings(t).every(r=>n(t,r)||!e.isTag(r))}};function Z0(t,e,n,r){if(n===null){if(t.length>r)throw new Error(`Pseudo-class :${e} requires an argument`)}else if(t.length===r)throw new Error(`Pseudo-class :${e} doesn't have any arguments`)}const LM={"any-link":":is(a, area, link)[href]",link:":any-link:not(:visited)",disabled:`:is(
        :is(button, input, select, textarea, optgroup, option)[disabled],
        optgroup[disabled] > option,
        fieldset[disabled]:not(fieldset[disabled] legend:first-of-type *)
    )`,enabled:":not(:disabled)",checked:":is(:is(input[type=radio], input[type=checkbox])[checked], option:selected)",required:":is(input, select, textarea)[required]",optional:":is(input, select, textarea):not([required])",selected:"option:is([selected], select:not([multiple]):not(:has(> option[selected])) > :first-of-type)",checkbox:"[type=checkbox]",file:"[type=file]",password:"[type=password]",radio:"[type=radio]",reset:"[type=reset]",image:"[type=image]",submit:"[type=submit]",parent:":not(:empty)",header:":is(h1, h2, h3, h4, h5, h6)",button:":is(button, input[type=button])",input:":is(input, textarea, select, button)",text:"input:is(:not([type!='']), [type=text])"},_w={};function DM(t,e){return t===Re.falseFunc?Re.falseFunc:n=>e.isTag(n)&&t(n)}function yw(t,e){const n=e.getSiblings(t);if(n.length<=1)return[];const r=n.indexOf(t);return r<0||r===n.length-1?[]:n.slice(r+1).filter(e.isTag)}function Vh(t){return{xmlMode:!!t.xmlMode,lowerCaseAttributeNames:!!t.lowerCaseAttributeNames,lowerCaseTags:!!t.lowerCaseTags,quirksMode:!!t.quirksMode,cacheResults:!!t.cacheResults,pseudos:t.pseudos,adapter:t.adapter,equals:t.equals}}const vd=(t,e,n,r,s)=>{const a=s(e,Vh(n),r);return a===Re.trueFunc?t:a===Re.falseFunc?Re.falseFunc:i=>a(i)&&t(i)},Od={is:vd,matches:vd,where:vd,not(t,e,n,r,s){const a=s(e,Vh(n),r);return a===Re.falseFunc?t:a===Re.trueFunc?Re.falseFunc:i=>!a(i)&&t(i)},has(t,e,n,r,s){const{adapter:a}=n,i=Vh(n);i.relativeSelector=!0;const o=e.some(l=>l.some(Am))?[_w]:void 0,u=s(e,i,o);if(u===Re.falseFunc)return Re.falseFunc;const c=DM(u,a);if(o&&u!==Re.trueFunc){const{shouldTestNextSiblings:l=!1}=u;return d=>{if(!t(d))return!1;o[0]=d;const m=a.getChildren(d),p=l?[...m,...yw(d,a)]:m;return a.existsOne(c,p)}}return l=>t(l)&&a.existsOne(c,a.getChildren(l))}};function MM(t,e,n,r,s){var a;const{name:i,data:o}=e;if(Array.isArray(o)){if(!(i in Od))throw new Error(`Unknown pseudo-class :${i}(${o})`);return Od[i](t,o,n,r,s)}const u=(a=n.pseudos)===null||a===void 0?void 0:a[i],c=typeof u=="string"?u:LM[i];if(typeof c=="string"){if(o!=null)throw new Error(`Pseudo ${i} doesn't have any arguments`);const l=ll(c);return Od.is(t,l,n,r,s)}if(typeof u=="function")return Z0(u,i,o,1),l=>u(l,o)&&t(l);if(i in qh)return qh[i](t,o,n,r);if(i in Y0){const l=Y0[i];return Z0(l,i,o,2),d=>l(d,n,o)&&t(d)}throw new Error(`Unknown pseudo-class :${i}`)}function Id(t,e){const n=e.getParent(t);return n&&e.isTag(n)?n:null}function BM(t,e,n,r,s){const{adapter:a,equals:i}=n;switch(e.type){case me.PseudoElement:throw new Error("Pseudo-elements are not supported by css-select");case me.ColumnCombinator:throw new Error("Column combinators are not yet supported by css-select");case me.Attribute:{if(e.namespace!=null)throw new Error("Namespaced attributes are not yet supported by css-select");return(!n.xmlMode||n.lowerCaseAttributeNames)&&(e.name=e.name.toLowerCase()),kM[e.action](t,e,n)}case me.Pseudo:return MM(t,e,n,r,s);case me.Tag:{if(e.namespace!=null)throw new Error("Namespaced tag names are not yet supported by css-select");let{name:o}=e;return(!n.xmlMode||n.lowerCaseTags)&&(o=o.toLowerCase()),function(c){return a.getName(c)===o&&t(c)}}case me.Descendant:{if(n.cacheResults===!1||typeof WeakSet>"u")return function(c){let l=c;for(;l=Id(l,a);)if(t(l))return!0;return!1};const o=new WeakSet;return function(c){let l=c;for(;l=Id(l,a);)if(!o.has(l)){if(a.isTag(l)&&t(l))return!0;o.add(l)}return!1}}case"_flexibleDescendant":return function(u){let c=u;do if(t(c))return!0;while(c=Id(c,a));return!1};case me.Parent:return function(u){return a.getChildren(u).some(c=>a.isTag(c)&&t(c))};case me.Child:return function(u){const c=a.getParent(u);return c!=null&&a.isTag(c)&&t(c)};case me.Sibling:return function(u){const c=a.getSiblings(u);for(let l=0;l<c.length;l++){const d=c[l];if(i(u,d))break;if(a.isTag(d)&&t(d))return!0}return!1};case me.Adjacent:return a.prevElementSibling?function(u){const c=a.prevElementSibling(u);return c!=null&&t(c)}:function(u){const c=a.getSiblings(u);let l;for(let d=0;d<c.length;d++){const m=c[d];if(i(u,m))break;a.isTag(m)&&(l=m)}return!!l&&t(l)};case me.Universal:{if(e.namespace!=null&&e.namespace!=="*")throw new Error("Namespaced universal selectors are not yet supported by css-select");return t}}}function Ew(t){return t.type===me.Pseudo&&(t.name==="scope"||Array.isArray(t.data)&&t.data.some(e=>e.some(Ew)))}const FM={type:me.Descendant},UM={type:"_flexibleDescendant"},jM={type:me.Pseudo,name:"scope",data:null};function HM(t,{adapter:e},n){const r=!!(n!=null&&n.every(s=>{const a=e.isTag(s)&&e.getParent(s);return s===_w||a&&e.isTag(a)}));for(const s of t){if(!(s.length>0&&Am(s[0])&&s[0].type!==me.Descendant))if(r&&!s.some(Ew))s.unshift(FM);else continue;s.unshift(jM)}}function ww(t,e,n){var r;t.forEach(vM),n=(r=e.context)!==null&&r!==void 0?r:n;const s=Array.isArray(n),a=n&&(Array.isArray(n)?n:[n]);if(e.relativeSelector!==!1)HM(t,e,a);else if(t.some(u=>u.length>0&&Am(u[0])))throw new Error("Relative selectors are not allowed when the `relativeSelector` option is disabled");let i=!1;const o=t.map(u=>{if(u.length>=2){const[c,l]=u;c.type!==me.Pseudo||c.name!=="scope"||(s&&l.type===me.Descendant?u[1]=UM:(l.type===me.Adjacent||l.type===me.Sibling)&&(i=!0))}return $M(u,e,a)}).reduce(qM,Re.falseFunc);return o.shouldTestNextSiblings=i,o}function $M(t,e,n){var r;return t.reduce((s,a)=>s===Re.falseFunc?Re.falseFunc:BM(s,a,e,n,ww),(r=e.rootFunc)!==null&&r!==void 0?r:Re.trueFunc)}function qM(t,e){return e===Re.falseFunc||t===Re.trueFunc?t:t===Re.falseFunc||e===Re.trueFunc?e:function(r){return t(r)||e(r)}}const Tw=(t,e)=>t===e,VM={adapter:cl,equals:Tw};function zM(t){var e,n,r,s;const a=t??VM;return(e=a.adapter)!==null&&e!==void 0||(a.adapter=cl),(n=a.equals)!==null&&n!==void 0||(a.equals=(s=(r=a.adapter)===null||r===void 0?void 0:r.equals)!==null&&s!==void 0?s:Tw),a}function WM(t){return function(n,r,s){const a=zM(r);return t(n,a,s)}}const Cm=WM(ww);function Sw(t,e,n=!1){return n&&(t=GM(t,e)),Array.isArray(t)?e.removeSubsets(t):e.getChildren(t)}function GM(t,e){const n=Array.isArray(t)?t.slice(0):[t],r=n.length;for(let s=0;s<r;s++){const a=yw(n[s],e);n.push(...a)}return n}const KM=new Set(["first","last","eq","gt","nth","lt","even","odd"]);function gc(t){return t.type!=="pseudo"?!1:KM.has(t.name)?!0:t.name==="not"&&Array.isArray(t.data)?t.data.some(e=>e.some(gc)):!1}function YM(t,e,n){const r=e!=null?parseInt(e,10):NaN;switch(t){case"first":return 1;case"nth":case"eq":return isFinite(r)?r>=0?r+1:1/0:0;case"lt":return isFinite(r)?r>=0?Math.min(r,n):1/0:0;case"gt":return isFinite(r)?1/0:0;case"odd":return 2*n;case"even":return 2*n-1;case"last":case"not":return 1/0}}function ZM(t){for(;t.parent;)t=t.parent;return t}function vm(t){const e=[],n=[];for(const r of t)r.some(gc)?e.push(r):n.push(r);return[n,e]}const JM={type:me.Universal,namespace:null},XM={type:me.Pseudo,name:"scope",data:null};function Aw(t,e,n={}){return Cw([t],e,n)}function Cw(t,e,n={}){if(typeof e=="function")return t.some(e);const[r,s]=vm(ll(e));return r.length>0&&t.some(Cm(r,n))||s.some(a=>Iw(a,t,n).length>0)}function QM(t,e,n,r){const s=typeof n=="string"?parseInt(n,10):NaN;switch(t){case"first":case"lt":return e;case"last":return e.length>0?[e[e.length-1]]:e;case"nth":case"eq":return isFinite(s)&&Math.abs(s)<e.length?[s<0?e[e.length+s]:e[s]]:[];case"gt":return isFinite(s)?e.slice(s+1):[];case"even":return e.filter((a,i)=>i%2===0);case"odd":return e.filter((a,i)=>i%2===1);case"not":{const a=new Set(Ow(n,e,r));return e.filter(i=>!a.has(i))}}}function vw(t,e,n={}){return Ow(ll(t),e,n)}function Ow(t,e,n){if(e.length===0)return[];const[r,s]=vm(t);let a;if(r.length){const i=Wh(e,r,n);if(s.length===0)return i;i.length&&(a=new Set(i))}for(let i=0;i<s.length&&(a==null?void 0:a.size)!==e.length;i++){const o=s[i];if((a?e.filter(l=>be(l)&&!a.has(l)):e).length===0)break;const c=Iw(o,e,n);if(c.length)if(a)c.forEach(l=>a.add(l));else{if(i===s.length-1)return c;a=new Set(c)}}return typeof a<"u"?a.size===e.length?e:e.filter(i=>a.has(i)):[]}function Iw(t,e,n){var r;if(t.some(gi)){const s=(r=n.root)!==null&&r!==void 0?r:ZM(e[0]),a={...n,context:e,relativeSelector:!1};return t.push(XM),bc(s,t,a,!0,e.length)}return bc(e,t,n,!1,e.length)}function e8(t,e,n={},r=1/0){if(typeof t=="function")return kw(e,t);const[s,a]=vm(ll(t)),i=a.map(o=>bc(e,o,n,!0,r));return s.length&&i.push(zh(e,s,n,r)),i.length===0?[]:i.length===1?i[0]:Ra(i.reduce((o,u)=>[...o,...u]))}function bc(t,e,n,r,s){const a=e.findIndex(gc),i=e.slice(0,a),o=e[a],u=e.length-1===a?s:1/0,c=YM(o.name,o.data,u);if(c===0)return[];const d=(i.length===0&&!Array.isArray(t)?ul(t).filter(be):i.length===0?(Array.isArray(t)?t:[t]).filter(be):r||i.some(gi)?zh(t,[i],n,c):Wh(t,[i],n)).slice(0,c);let m=QM(o.name,d,o.data,n);if(m.length===0||e.length===a+1)return m;const p=e.slice(a+1),f=p.some(gi);if(f){if(gi(p[0])){const{type:g}=p[0];(g===me.Sibling||g===me.Adjacent)&&(m=Sw(m,cl,!0)),p.unshift(JM)}n={...n,relativeSelector:!1,rootFunc:g=>m.includes(g)}}else n.rootFunc&&n.rootFunc!==pc.trueFunc&&(n={...n,rootFunc:pc.trueFunc});return p.some(gc)?bc(m,p,n,!1,s):f?zh(m,[p],n,s):Wh(m,[p],n)}function zh(t,e,n,r){const s=Cm(e,n,t);return kw(t,s,r)}function kw(t,e,n=1/0){const r=Sw(t,cl,e.shouldTestNextSiblings);return Em(s=>be(s)&&e(s),r,!0,n)}function Wh(t,e,n){const r=(Array.isArray(t)?t:[t]).filter(be);if(r.length===0)return r;const s=Cm(e,n);return s===pc.trueFunc?r:r.filter(s)}const t8=/^\s*[+~]/;function n8(t){if(!t)return this._make([]);if(typeof t!="string"){const e=kr(t)?t.toArray():[t],n=this.toArray();return this._make(e.filter(r=>n.some(s=>cw(s,r))))}return this._findBySelector(t,Number.POSITIVE_INFINITY)}function r8(t,e){var n;const r=this.toArray(),s=t8.test(t)?r:this.children().toArray(),a={context:r,root:(n=this._root)===null||n===void 0?void 0:n[0],xmlMode:this.options.xmlMode,lowerCaseTags:this.options.lowerCaseTags,lowerCaseAttributeNames:this.options.lowerCaseAttributeNames,pseudos:this.options.pseudos,quirksMode:this.options.quirksMode};return this._make(e8(t,s,a,e))}function Om(t){return function(e,...n){return function(r){var s;let a=t(e,this);return r&&(a=Nm(a,r,this.options.xmlMode,(s=this._root)===null||s===void 0?void 0:s[0])),this._make(this.length>1&&a.length>1?n.reduce((i,o)=>o(i),a):a)}}}const To=Om((t,e)=>{let n=[];for(let r=0;r<e.length;r++){const s=t(e[r]);s.length>0&&(n=n.concat(s))}return n}),Im=Om((t,e)=>{const n=[];for(let r=0;r<e.length;r++){const s=t(e[r]);s!==null&&n.push(s)}return n});function km(t,...e){let n=null;const r=Om((s,a)=>{const i=[];return ut(a,o=>{for(let u;(u=s(o))&&!(n!=null&&n(u,i.length));o=u)i.push(u)}),i})(t,...e);return function(s,a){n=typeof s=="string"?o=>Aw(o,s,this.options):s?So(s):null;const i=r.call(this,a);return n=null,i}}function Pa(t){return t.length>1?Array.from(new Set(t)):t}const s8=Im(({parent:t})=>t&&!Xr(t)?t:null,Pa),a8=To(t=>{const e=[];for(;t.parent&&!Xr(t.parent);)e.push(t.parent),t=t.parent;return e},Ra,t=>t.reverse()),i8=km(({parent:t})=>t&&!Xr(t)?t:null,Ra,t=>t.reverse());function o8(t){var e;const n=[];if(!t)return this._make(n);const r={xmlMode:this.options.xmlMode,root:(e=this._root)===null||e===void 0?void 0:e[0]},s=typeof t=="string"?a=>Aw(a,t,r):So(t);return ut(this,a=>{for(a&&!Xr(a)&&!be(a)&&(a=a.parent);a&&be(a);){if(s(a,0)){n.includes(a)||n.push(a);break}a=a.parent}}),this._make(n)}const u8=Im(t=>_m(t)),c8=To(t=>{const e=[];for(;t.next;)t=t.next,be(t)&&e.push(t);return e},Pa),l8=km(t=>_m(t),Pa),d8=Im(t=>ym(t)),h8=To(t=>{const e=[];for(;t.prev;)t=t.prev,be(t)&&e.push(t);return e},Pa),f8=km(t=>ym(t),Pa),m8=To(t=>rw(t).filter(e=>be(e)&&e!==t),Ra),p8=To(t=>ul(t).filter(be),Pa);function g8(){const t=this.toArray().reduce((e,n)=>ht(n)?e.concat(n.children):e,[]);return this._make(t)}function b8(t){let e=0;const n=this.length;for(;e<n&&t.call(this[e],e,this[e])!==!1;)++e;return this}function _8(t){let e=[];for(let n=0;n<this.length;n++){const r=this[n],s=t.call(r,n,r);s!=null&&(e=e.concat(s))}return this._make(e)}function So(t){return typeof t=="function"?(e,n)=>t.call(e,n,e):kr(t)?e=>Array.prototype.includes.call(t,e):function(e){return t===e}}function y8(t){var e;return this._make(Nm(this.toArray(),t,this.options.xmlMode,(e=this._root)===null||e===void 0?void 0:e[0]))}function Nm(t,e,n,r){return typeof e=="string"?vw(e,t,{xmlMode:n,root:r}):t.filter(So(e))}function E8(t){const e=this.toArray();return typeof t=="string"?Cw(e.filter(be),t,this.options):t?e.some(So(t)):!1}function w8(t){let e=this.toArray();if(typeof t=="string"){const n=new Set(vw(t,e,this.options));e=e.filter(r=>!n.has(r))}else{const n=So(t);e=e.filter((r,s)=>!n(r,s))}return this._make(e)}function T8(t){return this.filter(typeof t=="string"?`:has(${t})`:(e,n)=>this._make(n).find(t).length>0)}function S8(){return this.length>1?this._make(this[0]):this}function A8(){return this.length>0?this._make(this[this.length-1]):this}function C8(t){var e;return t=+t,t===0&&this.length<=1?this:(t<0&&(t=this.length+t),this._make((e=this[t])!==null&&e!==void 0?e:[]))}function v8(t){return t==null?this.toArray():this[t<0?this.length+t:t]}function O8(){return Array.prototype.slice.call(this)}function I8(t){let e,n;return t==null?(e=this.parent().children(),n=this[0]):typeof t=="string"?(e=this._make(t),n=this[0]):(e=this,n=kr(t)?t[0]:t),Array.prototype.indexOf.call(e,n)}function k8(t,e){return this._make(Array.prototype.slice.call(this,t,e))}function N8(){var t;return(t=this.prevObject)!==null&&t!==void 0?t:this._make([])}function R8(t,e){const n=this._make(t,e),r=Ra([...this.get(),...n.get()]);return this._make(r)}function P8(t){return this.prevObject?this.add(t?this.prevObject.filter(t):this.prevObject):this}const x8=Object.freeze(Object.defineProperty({__proto__:null,_findBySelector:r8,add:R8,addBack:P8,children:p8,closest:o8,contents:g8,each:b8,end:N8,eq:C8,filter:y8,filterArray:Nm,find:n8,first:S8,get:v8,has:T8,index:I8,is:E8,last:A8,map:_8,next:u8,nextAll:c8,nextUntil:l8,not:w8,parent:s8,parents:a8,parentsUntil:i8,prev:d8,prevAll:h8,prevUntil:f8,siblings:m8,slice:k8,toArray:O8},Symbol.toStringTag,{value:"Module"}));function L8(t){return function(n,r,s,a){if(typeof Buffer<"u"&&Buffer.isBuffer(n)&&(n=n.toString()),typeof n=="string")return t(n,r,s,a);const i=n;if(!Array.isArray(i)&&Xr(i))return i;const o=new Os([]);return Is(i,o),o}}function Is(t,e){const n=Array.isArray(t)?t:[t];e?e.children=n:e=null;for(let r=0;r<n.length;r++){const s=n[r];s.parent&&s.parent.children!==n&&Ps(s),e?(s.prev=n[r-1]||null,s.next=n[r+1]||null):s.prev=s.next=null,s.parent=e}return e}function D8(t,e){if(t==null)return[];if(typeof t=="string")return this._parse(t,this.options,!1,null).children.slice(0);if("length"in t){if(t.length===1)return this._makeDomArray(t[0],e);const n=[];for(let r=0;r<t.length;r++){const s=t[r];if(typeof s=="object"){if(s==null)continue;if(!("length"in s)){n.push(e?Ki(s,!0):s);continue}}n.push(...this._makeDomArray(s,e))}return n}return[e?Ki(t,!0):t]}function Nw(t){return function(...e){const n=this.length-1;return ut(this,(r,s)=>{if(!ht(r))return;const a=typeof e[0]=="function"?e[0].call(r,s,this._render(r.children)):e,i=this._makeDomArray(a,s<n);t(i,r.children,r)})}}function Qr(t,e,n,r,s){var a,i;const o=[e,n,...r],u=e===0?null:t[e-1],c=e+n>=t.length?null:t[e+n];for(let l=0;l<r.length;++l){const d=r[l],m=d.parent;if(m){const f=m.children.indexOf(d);f>-1&&(m.children.splice(f,1),s===m&&e>f&&o[0]--)}d.parent=s,d.prev&&(d.prev.next=(a=d.next)!==null&&a!==void 0?a:null),d.next&&(d.next.prev=(i=d.prev)!==null&&i!==void 0?i:null),d.prev=l===0?u:r[l-1],d.next=l===r.length-1?c:r[l+1]}return u&&(u.next=r[0]),c&&(c.prev=r[r.length-1]),t.splice(...o)}function M8(t){return(kr(t)?t:this._make(t)).append(this),this}function B8(t){return(kr(t)?t:this._make(t)).prepend(this),this}const F8=Nw((t,e,n)=>{Qr(e,e.length,0,t,n)}),U8=Nw((t,e,n)=>{Qr(e,0,0,t,n)});function Rw(t){return function(e){const n=this.length-1,r=this.parents().last();for(let s=0;s<this.length;s++){const a=this[s],i=typeof e=="function"?e.call(a,s,a):typeof e=="string"&&!Hh(e)?r.find(e).clone():e,[o]=this._makeDomArray(i,s<n);if(!o||!ht(o))continue;let u=o,c=0;for(;c<u.children.length;){const l=u.children[c];be(l)?(u=l,c=0):c++}t(a,u,[o])}return this}}const j8=Rw((t,e,n)=>{const{parent:r}=t;if(!r)return;const s=r.children,a=s.indexOf(t);Is([t],e),Qr(s,a,0,n,r)}),H8=Rw((t,e,n)=>{ht(t)&&(Is(t.children,e),Is(n,t))});function $8(t){return this.parent(t).not("body").each((e,n)=>{this._make(n).replaceWith(n.children)}),this}function q8(t){const e=this[0];if(e){const n=this._make(typeof t=="function"?t.call(e,0,e):t).insertBefore(e);let r;for(let a=0;a<n.length;a++)n[a].type==="tag"&&(r=n[a]);let s=0;for(;r&&s<r.children.length;){const a=r.children[s];a.type==="tag"?(r=a,s=0):s++}r&&this._make(r).append(this)}return this}function V8(...t){const e=this.length-1;return ut(this,(n,r)=>{if(!ht(n)||!n.parent)return;const s=n.parent.children,a=s.indexOf(n);if(a<0)return;const i=typeof t[0]=="function"?t[0].call(n,r,this._render(n.children)):t,o=this._makeDomArray(i,r<e);Qr(s,a+1,0,o,n.parent)})}function z8(t){typeof t=="string"&&(t=this._make(t)),this.remove();const e=[];for(const n of this._makeDomArray(t)){const r=this.clone().toArray(),{parent:s}=n;if(!s)continue;const a=s.children,i=a.indexOf(n);i<0||(Qr(a,i+1,0,r,s),e.push(...r))}return this._make(e)}function W8(...t){const e=this.length-1;return ut(this,(n,r)=>{if(!ht(n)||!n.parent)return;const s=n.parent.children,a=s.indexOf(n);if(a<0)return;const i=typeof t[0]=="function"?t[0].call(n,r,this._render(n.children)):t,o=this._makeDomArray(i,r<e);Qr(s,a,0,o,n.parent)})}function G8(t){const e=this._make(t);this.remove();const n=[];return ut(e,r=>{const s=this.clone().toArray(),{parent:a}=r;if(!a)return;const i=a.children,o=i.indexOf(r);o<0||(Qr(i,o,0,s,a),n.push(...s))}),this._make(n)}function K8(t){const e=t?this.filter(t):this;return ut(e,n=>{Ps(n),n.prev=n.next=n.parent=null}),this}function Y8(t){return ut(this,(e,n)=>{const{parent:r}=e;if(!r)return;const s=r.children,a=typeof t=="function"?t.call(e,n,e):t,i=this._makeDomArray(a);Is(i,null);const o=s.indexOf(e);Qr(s,o,1,i,r),i.includes(e)||(e.parent=e.prev=e.next=null)})}function Z8(){return ut(this,t=>{if(ht(t)){for(const e of t.children)e.next=e.prev=e.parent=null;t.children.length=0}})}function J8(t){if(t===void 0){const e=this[0];return!e||!ht(e)?null:this._render(e.children)}return ut(this,e=>{if(!ht(e))return;for(const r of e.children)r.next=r.prev=r.parent=null;const n=kr(t)?t.toArray():this._parse(`${t}`,this.options,!1,e).children;Is(n,e)})}function X8(){return this._render(this)}function Q8(t){return t===void 0?Yi(this):typeof t=="function"?ut(this,(e,n)=>this._make(e).text(t.call(e,n,Yi([e])))):ut(this,e=>{if(!ht(e))return;for(const r of e.children)r.next=r.prev=r.parent=null;const n=new Gi(`${t}`);Is(n,e)})}function e5(){const t=Array.prototype.map.call(this.get(),n=>Ki(n,!0)),e=new Os(t);for(const n of t)n.parent=e;return this._make(t)}const t5=Object.freeze(Object.defineProperty({__proto__:null,_makeDomArray:D8,after:V8,append:F8,appendTo:M8,before:W8,clone:e5,empty:Z8,html:J8,insertAfter:z8,insertBefore:G8,prepend:U8,prependTo:B8,remove:K8,replaceWith:Y8,text:Q8,toString:X8,unwrap:$8,wrap:j8,wrapAll:q8,wrapInner:H8},Symbol.toStringTag,{value:"Module"}));function n5(t,e){if(t!=null&&e!=null||typeof t=="object"&&!Array.isArray(t))return ut(this,(n,r)=>{be(n)&&Pw(n,t,e,r)});if(this.length!==0)return xw(this[0],t)}function Pw(t,e,n,r){if(typeof e=="string"){const s=xw(t),a=typeof n=="function"?n.call(t,r,s[e]):n;a===""?delete s[e]:a!=null&&(s[e]=a),t.attribs.style=r5(s)}else if(typeof e=="object"){const s=Object.keys(e);for(let a=0;a<s.length;a++){const i=s[a];Pw(t,i,e[i],a)}}}function xw(t,e){if(!t||!be(t))return;const n=s5(t.attribs.style);if(typeof e=="string")return n[e];if(Array.isArray(e)){const r={};for(const s of e)n[s]!=null&&(r[s]=n[s]);return r}return n}function r5(t){return Object.keys(t).reduce((e,n)=>`${e}${e?" ":""}${n}: ${t[n]};`,"")}function s5(t){if(t=(t||"").trim(),!t)return{};const e={};let n;for(const r of t.split(";")){const s=r.indexOf(":");if(s<1||s===r.length-1){const a=r.trimEnd();a.length>0&&n!==void 0&&(e[n]+=`;${a}`)}else n=r.slice(0,s).trim(),e[n]=r.slice(s+1).trim()}return e}const a5=Object.freeze(Object.defineProperty({__proto__:null,css:n5},Symbol.toStringTag,{value:"Module"})),J0="input,select,textarea,keygen",i5=/%20/g,X0=/\r?\n/g;function o5(){return this.serializeArray().map(n=>`${encodeURIComponent(n.name)}=${encodeURIComponent(n.value)}`).join("&").replace(i5,"+")}function u5(){return this.map((t,e)=>{const n=this._make(e);return be(e)&&e.name==="form"?n.find(J0).toArray():n.filter(J0).toArray()}).filter('[name!=""]:enabled:not(:submit, :button, :image, :reset, :file):matches([checked], :not(:checkbox, :radio))').map((t,e)=>{var n;const r=this._make(e),s=r.attr("name"),a=(n=r.val())!==null&&n!==void 0?n:"";return Array.isArray(a)?a.map(i=>({name:s,value:i.replace(X0,`\r
`)})):{name:s,value:a.replace(X0,`\r
`)}}).toArray()}const c5=Object.freeze(Object.defineProperty({__proto__:null,serialize:o5,serializeArray:u5},Symbol.toStringTag,{value:"Module"}));function l5(t){var e;return typeof t=="string"?{selector:t,value:"textContent"}:{selector:t.selector,value:(e=t.value)!==null&&e!==void 0?e:"textContent"}}function d5(t){const e={};for(const n in t){const r=t[n],s=Array.isArray(r),{selector:a,value:i}=l5(s?r[0]:r),o=typeof i=="function"?i:typeof i=="string"?u=>this._make(u).prop(i):u=>this._make(u).extract(i);if(s)e[n]=this._findBySelector(a,Number.POSITIVE_INFINITY).map((u,c)=>o(c,n,e)).get();else{const u=this._findBySelector(a,1);e[n]=u.length>0?o(u[0],n,e):void 0}}return e}const h5=Object.freeze(Object.defineProperty({__proto__:null,extract:d5},Symbol.toStringTag,{value:"Module"}));class Ao{constructor(e,n,r){if(this.length=0,this.options=r,this._root=n,e){for(let s=0;s<e.length;s++)this[s]=e[s];this.length=e.length}}}Ao.prototype.cheerio="[cheerio object]";Ao.prototype.splice=Array.prototype.splice;Ao.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator];Object.assign(Ao.prototype,yM,x8,t5,a5,c5,h5);function f5(t,e){return function n(r,s,a=!0){if(r==null)throw new Error("cheerio.load() expects a string");const i=jh(s),o=t(r,i,a,null);class u extends Ao{_make(d,m){const p=c(d,m);return p.prevObject=this,p}_parse(d,m,p,f){return t(d,m,p,f)}_render(d){return e(d,this.options)}}function c(l,d,m=o,p){if(l&&kr(l))return l;const f=jh(p,i),g=typeof m=="string"?[t(m,f,!1,null)]:"length"in m?m:[m],b=kr(g)?g:new u(g,null,f);if(b._root=b,!l)return new u(void 0,b,f);const _=typeof l=="string"&&Hh(l)?t(l,f,!1,null).children:m5(l)?[l]:Array.isArray(l)?l:void 0,y=new u(_,b,f);if(_)return y;if(typeof l!="string")throw new TypeError("Unexpected type of selector");let E=l;const I=d?typeof d=="string"?Hh(d)?new u([t(d,f,!1,null)],b,f):(E=`${d} ${E}`,b):kr(d)?d:new u(Array.isArray(d)?d:[d],b,f):b;return I?I.find(E):y}return Object.assign(c,oM,{load:n,_root:o,_options:i,fn:u.prototype,prototype:u.prototype}),c}}function m5(t){return!!t.name||t.type==="root"||t.type==="text"||t.type==="comment"}const p5=new Set([65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111]),st="�";var T;(function(t){t[t.EOF=-1]="EOF",t[t.NULL=0]="NULL",t[t.TABULATION=9]="TABULATION",t[t.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",t[t.LINE_FEED=10]="LINE_FEED",t[t.FORM_FEED=12]="FORM_FEED",t[t.SPACE=32]="SPACE",t[t.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",t[t.QUOTATION_MARK=34]="QUOTATION_MARK",t[t.AMPERSAND=38]="AMPERSAND",t[t.APOSTROPHE=39]="APOSTROPHE",t[t.HYPHEN_MINUS=45]="HYPHEN_MINUS",t[t.SOLIDUS=47]="SOLIDUS",t[t.DIGIT_0=48]="DIGIT_0",t[t.DIGIT_9=57]="DIGIT_9",t[t.SEMICOLON=59]="SEMICOLON",t[t.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",t[t.EQUALS_SIGN=61]="EQUALS_SIGN",t[t.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",t[t.QUESTION_MARK=63]="QUESTION_MARK",t[t.LATIN_CAPITAL_A=65]="LATIN_CAPITAL_A",t[t.LATIN_CAPITAL_Z=90]="LATIN_CAPITAL_Z",t[t.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",t[t.GRAVE_ACCENT=96]="GRAVE_ACCENT",t[t.LATIN_SMALL_A=97]="LATIN_SMALL_A",t[t.LATIN_SMALL_Z=122]="LATIN_SMALL_Z"})(T||(T={}));const Kt={DASH_DASH:"--",CDATA_START:"[CDATA[",DOCTYPE:"doctype",SCRIPT:"script",PUBLIC:"public",SYSTEM:"system"};function Lw(t){return t>=55296&&t<=57343}function g5(t){return t>=56320&&t<=57343}function b5(t,e){return(t-55296)*1024+9216+e}function Dw(t){return t!==32&&t!==10&&t!==13&&t!==9&&t!==12&&t>=1&&t<=31||t>=127&&t<=159}function Mw(t){return t>=64976&&t<=65007||p5.has(t)}var j;(function(t){t.controlCharacterInInputStream="control-character-in-input-stream",t.noncharacterInInputStream="noncharacter-in-input-stream",t.surrogateInInputStream="surrogate-in-input-stream",t.nonVoidHtmlElementStartTagWithTrailingSolidus="non-void-html-element-start-tag-with-trailing-solidus",t.endTagWithAttributes="end-tag-with-attributes",t.endTagWithTrailingSolidus="end-tag-with-trailing-solidus",t.unexpectedSolidusInTag="unexpected-solidus-in-tag",t.unexpectedNullCharacter="unexpected-null-character",t.unexpectedQuestionMarkInsteadOfTagName="unexpected-question-mark-instead-of-tag-name",t.invalidFirstCharacterOfTagName="invalid-first-character-of-tag-name",t.unexpectedEqualsSignBeforeAttributeName="unexpected-equals-sign-before-attribute-name",t.missingEndTagName="missing-end-tag-name",t.unexpectedCharacterInAttributeName="unexpected-character-in-attribute-name",t.unknownNamedCharacterReference="unknown-named-character-reference",t.missingSemicolonAfterCharacterReference="missing-semicolon-after-character-reference",t.unexpectedCharacterAfterDoctypeSystemIdentifier="unexpected-character-after-doctype-system-identifier",t.unexpectedCharacterInUnquotedAttributeValue="unexpected-character-in-unquoted-attribute-value",t.eofBeforeTagName="eof-before-tag-name",t.eofInTag="eof-in-tag",t.missingAttributeValue="missing-attribute-value",t.missingWhitespaceBetweenAttributes="missing-whitespace-between-attributes",t.missingWhitespaceAfterDoctypePublicKeyword="missing-whitespace-after-doctype-public-keyword",t.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers="missing-whitespace-between-doctype-public-and-system-identifiers",t.missingWhitespaceAfterDoctypeSystemKeyword="missing-whitespace-after-doctype-system-keyword",t.missingQuoteBeforeDoctypePublicIdentifier="missing-quote-before-doctype-public-identifier",t.missingQuoteBeforeDoctypeSystemIdentifier="missing-quote-before-doctype-system-identifier",t.missingDoctypePublicIdentifier="missing-doctype-public-identifier",t.missingDoctypeSystemIdentifier="missing-doctype-system-identifier",t.abruptDoctypePublicIdentifier="abrupt-doctype-public-identifier",t.abruptDoctypeSystemIdentifier="abrupt-doctype-system-identifier",t.cdataInHtmlContent="cdata-in-html-content",t.incorrectlyOpenedComment="incorrectly-opened-comment",t.eofInScriptHtmlCommentLikeText="eof-in-script-html-comment-like-text",t.eofInDoctype="eof-in-doctype",t.nestedComment="nested-comment",t.abruptClosingOfEmptyComment="abrupt-closing-of-empty-comment",t.eofInComment="eof-in-comment",t.incorrectlyClosedComment="incorrectly-closed-comment",t.eofInCdata="eof-in-cdata",t.absenceOfDigitsInNumericCharacterReference="absence-of-digits-in-numeric-character-reference",t.nullCharacterReference="null-character-reference",t.surrogateCharacterReference="surrogate-character-reference",t.characterReferenceOutsideUnicodeRange="character-reference-outside-unicode-range",t.controlCharacterReference="control-character-reference",t.noncharacterCharacterReference="noncharacter-character-reference",t.missingWhitespaceBeforeDoctypeName="missing-whitespace-before-doctype-name",t.missingDoctypeName="missing-doctype-name",t.invalidCharacterSequenceAfterDoctypeName="invalid-character-sequence-after-doctype-name",t.duplicateAttribute="duplicate-attribute",t.nonConformingDoctype="non-conforming-doctype",t.missingDoctype="missing-doctype",t.misplacedDoctype="misplaced-doctype",t.endTagWithoutMatchingOpenElement="end-tag-without-matching-open-element",t.closingOfElementWithOpenChildElements="closing-of-element-with-open-child-elements",t.disallowedContentInNoscriptInHead="disallowed-content-in-noscript-in-head",t.openElementsLeftAfterEof="open-elements-left-after-eof",t.abandonedHeadElementChild="abandoned-head-element-child",t.misplacedStartTagForHeadElement="misplaced-start-tag-for-head-element",t.nestedNoscriptInHead="nested-noscript-in-head",t.eofInElementThatCanContainOnlyText="eof-in-element-that-can-contain-only-text"})(j||(j={}));const _5=65536;class y5{constructor(e){this.handler=e,this.html="",this.pos=-1,this.lastGapPos=-2,this.gapStack=[],this.skipNextNewLine=!1,this.lastChunkWritten=!1,this.endOfChunkHit=!1,this.bufferWaterline=_5,this.isEol=!1,this.lineStartPos=0,this.droppedBufferSize=0,this.line=1,this.lastErrOffset=-1}get col(){return this.pos-this.lineStartPos+ +(this.lastGapPos!==this.pos)}get offset(){return this.droppedBufferSize+this.pos}getError(e,n){const{line:r,col:s,offset:a}=this,i=s+n,o=a+n;return{code:e,startLine:r,endLine:r,startCol:i,endCol:i,startOffset:o,endOffset:o}}_err(e){this.handler.onParseError&&this.lastErrOffset!==this.offset&&(this.lastErrOffset=this.offset,this.handler.onParseError(this.getError(e,0)))}_addGap(){this.gapStack.push(this.lastGapPos),this.lastGapPos=this.pos}_processSurrogate(e){if(this.pos!==this.html.length-1){const n=this.html.charCodeAt(this.pos+1);if(g5(n))return this.pos++,this._addGap(),b5(e,n)}else if(!this.lastChunkWritten)return this.endOfChunkHit=!0,T.EOF;return this._err(j.surrogateInInputStream),e}willDropParsedChunk(){return this.pos>this.bufferWaterline}dropParsedChunk(){this.willDropParsedChunk()&&(this.html=this.html.substring(this.pos),this.lineStartPos-=this.pos,this.droppedBufferSize+=this.pos,this.pos=0,this.lastGapPos=-2,this.gapStack.length=0)}write(e,n){this.html.length>0?this.html+=e:this.html=e,this.endOfChunkHit=!1,this.lastChunkWritten=n}insertHtmlAtCurrentPos(e){this.html=this.html.substring(0,this.pos+1)+e+this.html.substring(this.pos+1),this.endOfChunkHit=!1}startsWith(e,n){if(this.pos+e.length>this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,!1;if(n)return this.html.startsWith(e,this.pos);for(let r=0;r<e.length;r++)if((this.html.charCodeAt(this.pos+r)|32)!==e.charCodeAt(r))return!1;return!0}peek(e){const n=this.pos+e;if(n>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,T.EOF;const r=this.html.charCodeAt(n);return r===T.CARRIAGE_RETURN?T.LINE_FEED:r}advance(){if(this.pos++,this.isEol&&(this.isEol=!1,this.line++,this.lineStartPos=this.pos),this.pos>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,T.EOF;let e=this.html.charCodeAt(this.pos);return e===T.CARRIAGE_RETURN?(this.isEol=!0,this.skipNextNewLine=!0,T.LINE_FEED):e===T.LINE_FEED&&(this.isEol=!0,this.skipNextNewLine)?(this.line--,this.skipNextNewLine=!1,this._addGap(),this.advance()):(this.skipNextNewLine=!1,Lw(e)&&(e=this._processSurrogate(e)),this.handler.onParseError===null||e>31&&e<127||e===T.LINE_FEED||e===T.CARRIAGE_RETURN||e>159&&e<64976||this._checkForProblematicCharacters(e),e)}_checkForProblematicCharacters(e){Dw(e)?this._err(j.controlCharacterInInputStream):Mw(e)&&this._err(j.noncharacterInInputStream)}retreat(e){for(this.pos-=e;this.pos<this.lastGapPos;)this.lastGapPos=this.gapStack.pop(),this.pos--;this.isEol=!1}}var je;(function(t){t[t.CHARACTER=0]="CHARACTER",t[t.NULL_CHARACTER=1]="NULL_CHARACTER",t[t.WHITESPACE_CHARACTER=2]="WHITESPACE_CHARACTER",t[t.START_TAG=3]="START_TAG",t[t.END_TAG=4]="END_TAG",t[t.COMMENT=5]="COMMENT",t[t.DOCTYPE=6]="DOCTYPE",t[t.EOF=7]="EOF",t[t.HIBERNATION=8]="HIBERNATION"})(je||(je={}));function Bw(t,e){for(let n=t.attrs.length-1;n>=0;n--)if(t.attrs[n].name===e)return t.attrs[n].value;return null}var G;(function(t){t.HTML="http://www.w3.org/1999/xhtml",t.MATHML="http://www.w3.org/1998/Math/MathML",t.SVG="http://www.w3.org/2000/svg",t.XLINK="http://www.w3.org/1999/xlink",t.XML="http://www.w3.org/XML/1998/namespace",t.XMLNS="http://www.w3.org/2000/xmlns/"})(G||(G={}));var gs;(function(t){t.TYPE="type",t.ACTION="action",t.ENCODING="encoding",t.PROMPT="prompt",t.NAME="name",t.COLOR="color",t.FACE="face",t.SIZE="size"})(gs||(gs={}));var fn;(function(t){t.NO_QUIRKS="no-quirks",t.QUIRKS="quirks",t.LIMITED_QUIRKS="limited-quirks"})(fn||(fn={}));var R;(function(t){t.A="a",t.ADDRESS="address",t.ANNOTATION_XML="annotation-xml",t.APPLET="applet",t.AREA="area",t.ARTICLE="article",t.ASIDE="aside",t.B="b",t.BASE="base",t.BASEFONT="basefont",t.BGSOUND="bgsound",t.BIG="big",t.BLOCKQUOTE="blockquote",t.BODY="body",t.BR="br",t.BUTTON="button",t.CAPTION="caption",t.CENTER="center",t.CODE="code",t.COL="col",t.COLGROUP="colgroup",t.DD="dd",t.DESC="desc",t.DETAILS="details",t.DIALOG="dialog",t.DIR="dir",t.DIV="div",t.DL="dl",t.DT="dt",t.EM="em",t.EMBED="embed",t.FIELDSET="fieldset",t.FIGCAPTION="figcaption",t.FIGURE="figure",t.FONT="font",t.FOOTER="footer",t.FOREIGN_OBJECT="foreignObject",t.FORM="form",t.FRAME="frame",t.FRAMESET="frameset",t.H1="h1",t.H2="h2",t.H3="h3",t.H4="h4",t.H5="h5",t.H6="h6",t.HEAD="head",t.HEADER="header",t.HGROUP="hgroup",t.HR="hr",t.HTML="html",t.I="i",t.IMG="img",t.IMAGE="image",t.INPUT="input",t.IFRAME="iframe",t.KEYGEN="keygen",t.LABEL="label",t.LI="li",t.LINK="link",t.LISTING="listing",t.MAIN="main",t.MALIGNMARK="malignmark",t.MARQUEE="marquee",t.MATH="math",t.MENU="menu",t.META="meta",t.MGLYPH="mglyph",t.MI="mi",t.MO="mo",t.MN="mn",t.MS="ms",t.MTEXT="mtext",t.NAV="nav",t.NOBR="nobr",t.NOFRAMES="noframes",t.NOEMBED="noembed",t.NOSCRIPT="noscript",t.OBJECT="object",t.OL="ol",t.OPTGROUP="optgroup",t.OPTION="option",t.P="p",t.PARAM="param",t.PLAINTEXT="plaintext",t.PRE="pre",t.RB="rb",t.RP="rp",t.RT="rt",t.RTC="rtc",t.RUBY="ruby",t.S="s",t.SCRIPT="script",t.SEARCH="search",t.SECTION="section",t.SELECT="select",t.SOURCE="source",t.SMALL="small",t.SPAN="span",t.STRIKE="strike",t.STRONG="strong",t.STYLE="style",t.SUB="sub",t.SUMMARY="summary",t.SUP="sup",t.TABLE="table",t.TBODY="tbody",t.TEMPLATE="template",t.TEXTAREA="textarea",t.TFOOT="tfoot",t.TD="td",t.TH="th",t.THEAD="thead",t.TITLE="title",t.TR="tr",t.TRACK="track",t.TT="tt",t.U="u",t.UL="ul",t.SVG="svg",t.VAR="var",t.WBR="wbr",t.XMP="xmp"})(R||(R={}));var h;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.A=1]="A",t[t.ADDRESS=2]="ADDRESS",t[t.ANNOTATION_XML=3]="ANNOTATION_XML",t[t.APPLET=4]="APPLET",t[t.AREA=5]="AREA",t[t.ARTICLE=6]="ARTICLE",t[t.ASIDE=7]="ASIDE",t[t.B=8]="B",t[t.BASE=9]="BASE",t[t.BASEFONT=10]="BASEFONT",t[t.BGSOUND=11]="BGSOUND",t[t.BIG=12]="BIG",t[t.BLOCKQUOTE=13]="BLOCKQUOTE",t[t.BODY=14]="BODY",t[t.BR=15]="BR",t[t.BUTTON=16]="BUTTON",t[t.CAPTION=17]="CAPTION",t[t.CENTER=18]="CENTER",t[t.CODE=19]="CODE",t[t.COL=20]="COL",t[t.COLGROUP=21]="COLGROUP",t[t.DD=22]="DD",t[t.DESC=23]="DESC",t[t.DETAILS=24]="DETAILS",t[t.DIALOG=25]="DIALOG",t[t.DIR=26]="DIR",t[t.DIV=27]="DIV",t[t.DL=28]="DL",t[t.DT=29]="DT",t[t.EM=30]="EM",t[t.EMBED=31]="EMBED",t[t.FIELDSET=32]="FIELDSET",t[t.FIGCAPTION=33]="FIGCAPTION",t[t.FIGURE=34]="FIGURE",t[t.FONT=35]="FONT",t[t.FOOTER=36]="FOOTER",t[t.FOREIGN_OBJECT=37]="FOREIGN_OBJECT",t[t.FORM=38]="FORM",t[t.FRAME=39]="FRAME",t[t.FRAMESET=40]="FRAMESET",t[t.H1=41]="H1",t[t.H2=42]="H2",t[t.H3=43]="H3",t[t.H4=44]="H4",t[t.H5=45]="H5",t[t.H6=46]="H6",t[t.HEAD=47]="HEAD",t[t.HEADER=48]="HEADER",t[t.HGROUP=49]="HGROUP",t[t.HR=50]="HR",t[t.HTML=51]="HTML",t[t.I=52]="I",t[t.IMG=53]="IMG",t[t.IMAGE=54]="IMAGE",t[t.INPUT=55]="INPUT",t[t.IFRAME=56]="IFRAME",t[t.KEYGEN=57]="KEYGEN",t[t.LABEL=58]="LABEL",t[t.LI=59]="LI",t[t.LINK=60]="LINK",t[t.LISTING=61]="LISTING",t[t.MAIN=62]="MAIN",t[t.MALIGNMARK=63]="MALIGNMARK",t[t.MARQUEE=64]="MARQUEE",t[t.MATH=65]="MATH",t[t.MENU=66]="MENU",t[t.META=67]="META",t[t.MGLYPH=68]="MGLYPH",t[t.MI=69]="MI",t[t.MO=70]="MO",t[t.MN=71]="MN",t[t.MS=72]="MS",t[t.MTEXT=73]="MTEXT",t[t.NAV=74]="NAV",t[t.NOBR=75]="NOBR",t[t.NOFRAMES=76]="NOFRAMES",t[t.NOEMBED=77]="NOEMBED",t[t.NOSCRIPT=78]="NOSCRIPT",t[t.OBJECT=79]="OBJECT",t[t.OL=80]="OL",t[t.OPTGROUP=81]="OPTGROUP",t[t.OPTION=82]="OPTION",t[t.P=83]="P",t[t.PARAM=84]="PARAM",t[t.PLAINTEXT=85]="PLAINTEXT",t[t.PRE=86]="PRE",t[t.RB=87]="RB",t[t.RP=88]="RP",t[t.RT=89]="RT",t[t.RTC=90]="RTC",t[t.RUBY=91]="RUBY",t[t.S=92]="S",t[t.SCRIPT=93]="SCRIPT",t[t.SEARCH=94]="SEARCH",t[t.SECTION=95]="SECTION",t[t.SELECT=96]="SELECT",t[t.SOURCE=97]="SOURCE",t[t.SMALL=98]="SMALL",t[t.SPAN=99]="SPAN",t[t.STRIKE=100]="STRIKE",t[t.STRONG=101]="STRONG",t[t.STYLE=102]="STYLE",t[t.SUB=103]="SUB",t[t.SUMMARY=104]="SUMMARY",t[t.SUP=105]="SUP",t[t.TABLE=106]="TABLE",t[t.TBODY=107]="TBODY",t[t.TEMPLATE=108]="TEMPLATE",t[t.TEXTAREA=109]="TEXTAREA",t[t.TFOOT=110]="TFOOT",t[t.TD=111]="TD",t[t.TH=112]="TH",t[t.THEAD=113]="THEAD",t[t.TITLE=114]="TITLE",t[t.TR=115]="TR",t[t.TRACK=116]="TRACK",t[t.TT=117]="TT",t[t.U=118]="U",t[t.UL=119]="UL",t[t.SVG=120]="SVG",t[t.VAR=121]="VAR",t[t.WBR=122]="WBR",t[t.XMP=123]="XMP"})(h||(h={}));const E5=new Map([[R.A,h.A],[R.ADDRESS,h.ADDRESS],[R.ANNOTATION_XML,h.ANNOTATION_XML],[R.APPLET,h.APPLET],[R.AREA,h.AREA],[R.ARTICLE,h.ARTICLE],[R.ASIDE,h.ASIDE],[R.B,h.B],[R.BASE,h.BASE],[R.BASEFONT,h.BASEFONT],[R.BGSOUND,h.BGSOUND],[R.BIG,h.BIG],[R.BLOCKQUOTE,h.BLOCKQUOTE],[R.BODY,h.BODY],[R.BR,h.BR],[R.BUTTON,h.BUTTON],[R.CAPTION,h.CAPTION],[R.CENTER,h.CENTER],[R.CODE,h.CODE],[R.COL,h.COL],[R.COLGROUP,h.COLGROUP],[R.DD,h.DD],[R.DESC,h.DESC],[R.DETAILS,h.DETAILS],[R.DIALOG,h.DIALOG],[R.DIR,h.DIR],[R.DIV,h.DIV],[R.DL,h.DL],[R.DT,h.DT],[R.EM,h.EM],[R.EMBED,h.EMBED],[R.FIELDSET,h.FIELDSET],[R.FIGCAPTION,h.FIGCAPTION],[R.FIGURE,h.FIGURE],[R.FONT,h.FONT],[R.FOOTER,h.FOOTER],[R.FOREIGN_OBJECT,h.FOREIGN_OBJECT],[R.FORM,h.FORM],[R.FRAME,h.FRAME],[R.FRAMESET,h.FRAMESET],[R.H1,h.H1],[R.H2,h.H2],[R.H3,h.H3],[R.H4,h.H4],[R.H5,h.H5],[R.H6,h.H6],[R.HEAD,h.HEAD],[R.HEADER,h.HEADER],[R.HGROUP,h.HGROUP],[R.HR,h.HR],[R.HTML,h.HTML],[R.I,h.I],[R.IMG,h.IMG],[R.IMAGE,h.IMAGE],[R.INPUT,h.INPUT],[R.IFRAME,h.IFRAME],[R.KEYGEN,h.KEYGEN],[R.LABEL,h.LABEL],[R.LI,h.LI],[R.LINK,h.LINK],[R.LISTING,h.LISTING],[R.MAIN,h.MAIN],[R.MALIGNMARK,h.MALIGNMARK],[R.MARQUEE,h.MARQUEE],[R.MATH,h.MATH],[R.MENU,h.MENU],[R.META,h.META],[R.MGLYPH,h.MGLYPH],[R.MI,h.MI],[R.MO,h.MO],[R.MN,h.MN],[R.MS,h.MS],[R.MTEXT,h.MTEXT],[R.NAV,h.NAV],[R.NOBR,h.NOBR],[R.NOFRAMES,h.NOFRAMES],[R.NOEMBED,h.NOEMBED],[R.NOSCRIPT,h.NOSCRIPT],[R.OBJECT,h.OBJECT],[R.OL,h.OL],[R.OPTGROUP,h.OPTGROUP],[R.OPTION,h.OPTION],[R.P,h.P],[R.PARAM,h.PARAM],[R.PLAINTEXT,h.PLAINTEXT],[R.PRE,h.PRE],[R.RB,h.RB],[R.RP,h.RP],[R.RT,h.RT],[R.RTC,h.RTC],[R.RUBY,h.RUBY],[R.S,h.S],[R.SCRIPT,h.SCRIPT],[R.SEARCH,h.SEARCH],[R.SECTION,h.SECTION],[R.SELECT,h.SELECT],[R.SOURCE,h.SOURCE],[R.SMALL,h.SMALL],[R.SPAN,h.SPAN],[R.STRIKE,h.STRIKE],[R.STRONG,h.STRONG],[R.STYLE,h.STYLE],[R.SUB,h.SUB],[R.SUMMARY,h.SUMMARY],[R.SUP,h.SUP],[R.TABLE,h.TABLE],[R.TBODY,h.TBODY],[R.TEMPLATE,h.TEMPLATE],[R.TEXTAREA,h.TEXTAREA],[R.TFOOT,h.TFOOT],[R.TD,h.TD],[R.TH,h.TH],[R.THEAD,h.THEAD],[R.TITLE,h.TITLE],[R.TR,h.TR],[R.TRACK,h.TRACK],[R.TT,h.TT],[R.U,h.U],[R.UL,h.UL],[R.SVG,h.SVG],[R.VAR,h.VAR],[R.WBR,h.WBR],[R.XMP,h.XMP]]);function dl(t){var e;return(e=E5.get(t))!==null&&e!==void 0?e:h.UNKNOWN}const Z=h,w5={[G.HTML]:new Set([Z.ADDRESS,Z.APPLET,Z.AREA,Z.ARTICLE,Z.ASIDE,Z.BASE,Z.BASEFONT,Z.BGSOUND,Z.BLOCKQUOTE,Z.BODY,Z.BR,Z.BUTTON,Z.CAPTION,Z.CENTER,Z.COL,Z.COLGROUP,Z.DD,Z.DETAILS,Z.DIR,Z.DIV,Z.DL,Z.DT,Z.EMBED,Z.FIELDSET,Z.FIGCAPTION,Z.FIGURE,Z.FOOTER,Z.FORM,Z.FRAME,Z.FRAMESET,Z.H1,Z.H2,Z.H3,Z.H4,Z.H5,Z.H6,Z.HEAD,Z.HEADER,Z.HGROUP,Z.HR,Z.HTML,Z.IFRAME,Z.IMG,Z.INPUT,Z.LI,Z.LINK,Z.LISTING,Z.MAIN,Z.MARQUEE,Z.MENU,Z.META,Z.NAV,Z.NOEMBED,Z.NOFRAMES,Z.NOSCRIPT,Z.OBJECT,Z.OL,Z.P,Z.PARAM,Z.PLAINTEXT,Z.PRE,Z.SCRIPT,Z.SECTION,Z.SELECT,Z.SOURCE,Z.STYLE,Z.SUMMARY,Z.TABLE,Z.TBODY,Z.TD,Z.TEMPLATE,Z.TEXTAREA,Z.TFOOT,Z.TH,Z.THEAD,Z.TITLE,Z.TR,Z.TRACK,Z.UL,Z.WBR,Z.XMP]),[G.MATHML]:new Set([Z.MI,Z.MO,Z.MN,Z.MS,Z.MTEXT,Z.ANNOTATION_XML]),[G.SVG]:new Set([Z.TITLE,Z.FOREIGN_OBJECT,Z.DESC]),[G.XLINK]:new Set,[G.XML]:new Set,[G.XMLNS]:new Set},Gh=new Set([Z.H1,Z.H2,Z.H3,Z.H4,Z.H5,Z.H6]),T5=new Set([R.STYLE,R.SCRIPT,R.XMP,R.IFRAME,R.NOEMBED,R.NOFRAMES,R.PLAINTEXT]);function S5(t,e){return T5.has(t)||e&&t===R.NOSCRIPT}var A;(function(t){t[t.DATA=0]="DATA",t[t.RCDATA=1]="RCDATA",t[t.RAWTEXT=2]="RAWTEXT",t[t.SCRIPT_DATA=3]="SCRIPT_DATA",t[t.PLAINTEXT=4]="PLAINTEXT",t[t.TAG_OPEN=5]="TAG_OPEN",t[t.END_TAG_OPEN=6]="END_TAG_OPEN",t[t.TAG_NAME=7]="TAG_NAME",t[t.RCDATA_LESS_THAN_SIGN=8]="RCDATA_LESS_THAN_SIGN",t[t.RCDATA_END_TAG_OPEN=9]="RCDATA_END_TAG_OPEN",t[t.RCDATA_END_TAG_NAME=10]="RCDATA_END_TAG_NAME",t[t.RAWTEXT_LESS_THAN_SIGN=11]="RAWTEXT_LESS_THAN_SIGN",t[t.RAWTEXT_END_TAG_OPEN=12]="RAWTEXT_END_TAG_OPEN",t[t.RAWTEXT_END_TAG_NAME=13]="RAWTEXT_END_TAG_NAME",t[t.SCRIPT_DATA_LESS_THAN_SIGN=14]="SCRIPT_DATA_LESS_THAN_SIGN",t[t.SCRIPT_DATA_END_TAG_OPEN=15]="SCRIPT_DATA_END_TAG_OPEN",t[t.SCRIPT_DATA_END_TAG_NAME=16]="SCRIPT_DATA_END_TAG_NAME",t[t.SCRIPT_DATA_ESCAPE_START=17]="SCRIPT_DATA_ESCAPE_START",t[t.SCRIPT_DATA_ESCAPE_START_DASH=18]="SCRIPT_DATA_ESCAPE_START_DASH",t[t.SCRIPT_DATA_ESCAPED=19]="SCRIPT_DATA_ESCAPED",t[t.SCRIPT_DATA_ESCAPED_DASH=20]="SCRIPT_DATA_ESCAPED_DASH",t[t.SCRIPT_DATA_ESCAPED_DASH_DASH=21]="SCRIPT_DATA_ESCAPED_DASH_DASH",t[t.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN=22]="SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN",t[t.SCRIPT_DATA_ESCAPED_END_TAG_OPEN=23]="SCRIPT_DATA_ESCAPED_END_TAG_OPEN",t[t.SCRIPT_DATA_ESCAPED_END_TAG_NAME=24]="SCRIPT_DATA_ESCAPED_END_TAG_NAME",t[t.SCRIPT_DATA_DOUBLE_ESCAPE_START=25]="SCRIPT_DATA_DOUBLE_ESCAPE_START",t[t.SCRIPT_DATA_DOUBLE_ESCAPED=26]="SCRIPT_DATA_DOUBLE_ESCAPED",t[t.SCRIPT_DATA_DOUBLE_ESCAPED_DASH=27]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH",t[t.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH=28]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH",t[t.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN=29]="SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN",t[t.SCRIPT_DATA_DOUBLE_ESCAPE_END=30]="SCRIPT_DATA_DOUBLE_ESCAPE_END",t[t.BEFORE_ATTRIBUTE_NAME=31]="BEFORE_ATTRIBUTE_NAME",t[t.ATTRIBUTE_NAME=32]="ATTRIBUTE_NAME",t[t.AFTER_ATTRIBUTE_NAME=33]="AFTER_ATTRIBUTE_NAME",t[t.BEFORE_ATTRIBUTE_VALUE=34]="BEFORE_ATTRIBUTE_VALUE",t[t.ATTRIBUTE_VALUE_DOUBLE_QUOTED=35]="ATTRIBUTE_VALUE_DOUBLE_QUOTED",t[t.ATTRIBUTE_VALUE_SINGLE_QUOTED=36]="ATTRIBUTE_VALUE_SINGLE_QUOTED",t[t.ATTRIBUTE_VALUE_UNQUOTED=37]="ATTRIBUTE_VALUE_UNQUOTED",t[t.AFTER_ATTRIBUTE_VALUE_QUOTED=38]="AFTER_ATTRIBUTE_VALUE_QUOTED",t[t.SELF_CLOSING_START_TAG=39]="SELF_CLOSING_START_TAG",t[t.BOGUS_COMMENT=40]="BOGUS_COMMENT",t[t.MARKUP_DECLARATION_OPEN=41]="MARKUP_DECLARATION_OPEN",t[t.COMMENT_START=42]="COMMENT_START",t[t.COMMENT_START_DASH=43]="COMMENT_START_DASH",t[t.COMMENT=44]="COMMENT",t[t.COMMENT_LESS_THAN_SIGN=45]="COMMENT_LESS_THAN_SIGN",t[t.COMMENT_LESS_THAN_SIGN_BANG=46]="COMMENT_LESS_THAN_SIGN_BANG",t[t.COMMENT_LESS_THAN_SIGN_BANG_DASH=47]="COMMENT_LESS_THAN_SIGN_BANG_DASH",t[t.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH=48]="COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH",t[t.COMMENT_END_DASH=49]="COMMENT_END_DASH",t[t.COMMENT_END=50]="COMMENT_END",t[t.COMMENT_END_BANG=51]="COMMENT_END_BANG",t[t.DOCTYPE=52]="DOCTYPE",t[t.BEFORE_DOCTYPE_NAME=53]="BEFORE_DOCTYPE_NAME",t[t.DOCTYPE_NAME=54]="DOCTYPE_NAME",t[t.AFTER_DOCTYPE_NAME=55]="AFTER_DOCTYPE_NAME",t[t.AFTER_DOCTYPE_PUBLIC_KEYWORD=56]="AFTER_DOCTYPE_PUBLIC_KEYWORD",t[t.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER=57]="BEFORE_DOCTYPE_PUBLIC_IDENTIFIER",t[t.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED=58]="DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED",t[t.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED=59]="DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED",t[t.AFTER_DOCTYPE_PUBLIC_IDENTIFIER=60]="AFTER_DOCTYPE_PUBLIC_IDENTIFIER",t[t.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS=61]="BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS",t[t.AFTER_DOCTYPE_SYSTEM_KEYWORD=62]="AFTER_DOCTYPE_SYSTEM_KEYWORD",t[t.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER=63]="BEFORE_DOCTYPE_SYSTEM_IDENTIFIER",t[t.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED=64]="DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED",t[t.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED=65]="DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED",t[t.AFTER_DOCTYPE_SYSTEM_IDENTIFIER=66]="AFTER_DOCTYPE_SYSTEM_IDENTIFIER",t[t.BOGUS_DOCTYPE=67]="BOGUS_DOCTYPE",t[t.CDATA_SECTION=68]="CDATA_SECTION",t[t.CDATA_SECTION_BRACKET=69]="CDATA_SECTION_BRACKET",t[t.CDATA_SECTION_END=70]="CDATA_SECTION_END",t[t.CHARACTER_REFERENCE=71]="CHARACTER_REFERENCE",t[t.AMBIGUOUS_AMPERSAND=72]="AMBIGUOUS_AMPERSAND"})(A||(A={}));const Qt={DATA:A.DATA,RCDATA:A.RCDATA,RAWTEXT:A.RAWTEXT,SCRIPT_DATA:A.SCRIPT_DATA,PLAINTEXT:A.PLAINTEXT,CDATA_SECTION:A.CDATA_SECTION};function A5(t){return t>=T.DIGIT_0&&t<=T.DIGIT_9}function ii(t){return t>=T.LATIN_CAPITAL_A&&t<=T.LATIN_CAPITAL_Z}function C5(t){return t>=T.LATIN_SMALL_A&&t<=T.LATIN_SMALL_Z}function Fr(t){return C5(t)||ii(t)}function Q0(t){return Fr(t)||A5(t)}function du(t){return t+32}function Fw(t){return t===T.SPACE||t===T.LINE_FEED||t===T.TABULATION||t===T.FORM_FEED}function eb(t){return Fw(t)||t===T.SOLIDUS||t===T.GREATER_THAN_SIGN}function v5(t){return t===T.NULL?j.nullCharacterReference:t>1114111?j.characterReferenceOutsideUnicodeRange:Lw(t)?j.surrogateCharacterReference:Mw(t)?j.noncharacterCharacterReference:Dw(t)||t===T.CARRIAGE_RETURN?j.controlCharacterReference:null}let O5=class{constructor(e,n){this.options=e,this.handler=n,this.paused=!1,this.inLoop=!1,this.inForeignNode=!1,this.lastStartTagName="",this.active=!1,this.state=A.DATA,this.returnState=A.DATA,this.entityStartPos=0,this.consumedAfterSnapshot=-1,this.currentCharacterToken=null,this.currentToken=null,this.currentAttr={name:"",value:""},this.preprocessor=new y5(n),this.currentLocation=this.getCurrentLocation(-1),this.entityDecoder=new bm(gm,(r,s)=>{this.preprocessor.pos=this.entityStartPos+s-1,this._flushCodePointConsumedAsCharacterReference(r)},n.onParseError?{missingSemicolonAfterCharacterReference:()=>{this._err(j.missingSemicolonAfterCharacterReference,1)},absenceOfDigitsInNumericCharacterReference:r=>{this._err(j.absenceOfDigitsInNumericCharacterReference,this.entityStartPos-this.preprocessor.pos+r)},validateNumericCharacterReference:r=>{const s=v5(r);s&&this._err(s,1)}}:void 0)}_err(e,n=0){var r,s;(s=(r=this.handler).onParseError)===null||s===void 0||s.call(r,this.preprocessor.getError(e,n))}getCurrentLocation(e){return this.options.sourceCodeLocationInfo?{startLine:this.preprocessor.line,startCol:this.preprocessor.col-e,startOffset:this.preprocessor.offset-e,endLine:-1,endCol:-1,endOffset:-1}:null}_runParsingLoop(){if(!this.inLoop){for(this.inLoop=!0;this.active&&!this.paused;){this.consumedAfterSnapshot=0;const e=this._consume();this._ensureHibernation()||this._callState(e)}this.inLoop=!1}}pause(){this.paused=!0}resume(e){if(!this.paused)throw new Error("Parser was already resumed");this.paused=!1,!this.inLoop&&(this._runParsingLoop(),this.paused||e==null||e())}write(e,n,r){this.active=!0,this.preprocessor.write(e,n),this._runParsingLoop(),this.paused||r==null||r()}insertHtmlAtCurrentPos(e){this.active=!0,this.preprocessor.insertHtmlAtCurrentPos(e),this._runParsingLoop()}_ensureHibernation(){return this.preprocessor.endOfChunkHit?(this.preprocessor.retreat(this.consumedAfterSnapshot),this.consumedAfterSnapshot=0,this.active=!1,!0):!1}_consume(){return this.consumedAfterSnapshot++,this.preprocessor.advance()}_advanceBy(e){this.consumedAfterSnapshot+=e;for(let n=0;n<e;n++)this.preprocessor.advance()}_consumeSequenceIfMatch(e,n){return this.preprocessor.startsWith(e,n)?(this._advanceBy(e.length-1),!0):!1}_createStartTagToken(){this.currentToken={type:je.START_TAG,tagName:"",tagID:h.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(1)}}_createEndTagToken(){this.currentToken={type:je.END_TAG,tagName:"",tagID:h.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(2)}}_createCommentToken(e){this.currentToken={type:je.COMMENT,data:"",location:this.getCurrentLocation(e)}}_createDoctypeToken(e){this.currentToken={type:je.DOCTYPE,name:e,forceQuirks:!1,publicId:null,systemId:null,location:this.currentLocation}}_createCharacterToken(e,n){this.currentCharacterToken={type:e,chars:n,location:this.currentLocation}}_createAttr(e){this.currentAttr={name:e,value:""},this.currentLocation=this.getCurrentLocation(0)}_leaveAttrName(){var e,n;const r=this.currentToken;if(Bw(r,this.currentAttr.name)===null){if(r.attrs.push(this.currentAttr),r.location&&this.currentLocation){const s=(e=(n=r.location).attrs)!==null&&e!==void 0?e:n.attrs=Object.create(null);s[this.currentAttr.name]=this.currentLocation,this._leaveAttrValue()}}else this._err(j.duplicateAttribute)}_leaveAttrValue(){this.currentLocation&&(this.currentLocation.endLine=this.preprocessor.line,this.currentLocation.endCol=this.preprocessor.col,this.currentLocation.endOffset=this.preprocessor.offset)}prepareToken(e){this._emitCurrentCharacterToken(e.location),this.currentToken=null,e.location&&(e.location.endLine=this.preprocessor.line,e.location.endCol=this.preprocessor.col+1,e.location.endOffset=this.preprocessor.offset+1),this.currentLocation=this.getCurrentLocation(-1)}emitCurrentTagToken(){const e=this.currentToken;this.prepareToken(e),e.tagID=dl(e.tagName),e.type===je.START_TAG?(this.lastStartTagName=e.tagName,this.handler.onStartTag(e)):(e.attrs.length>0&&this._err(j.endTagWithAttributes),e.selfClosing&&this._err(j.endTagWithTrailingSolidus),this.handler.onEndTag(e)),this.preprocessor.dropParsedChunk()}emitCurrentComment(e){this.prepareToken(e),this.handler.onComment(e),this.preprocessor.dropParsedChunk()}emitCurrentDoctype(e){this.prepareToken(e),this.handler.onDoctype(e),this.preprocessor.dropParsedChunk()}_emitCurrentCharacterToken(e){if(this.currentCharacterToken){switch(e&&this.currentCharacterToken.location&&(this.currentCharacterToken.location.endLine=e.startLine,this.currentCharacterToken.location.endCol=e.startCol,this.currentCharacterToken.location.endOffset=e.startOffset),this.currentCharacterToken.type){case je.CHARACTER:{this.handler.onCharacter(this.currentCharacterToken);break}case je.NULL_CHARACTER:{this.handler.onNullCharacter(this.currentCharacterToken);break}case je.WHITESPACE_CHARACTER:{this.handler.onWhitespaceCharacter(this.currentCharacterToken);break}}this.currentCharacterToken=null}}_emitEOFToken(){const e=this.getCurrentLocation(0);e&&(e.endLine=e.startLine,e.endCol=e.startCol,e.endOffset=e.startOffset),this._emitCurrentCharacterToken(e),this.handler.onEof({type:je.EOF,location:e}),this.active=!1}_appendCharToCurrentCharacterToken(e,n){if(this.currentCharacterToken)if(this.currentCharacterToken.type===e){this.currentCharacterToken.chars+=n;return}else this.currentLocation=this.getCurrentLocation(0),this._emitCurrentCharacterToken(this.currentLocation),this.preprocessor.dropParsedChunk();this._createCharacterToken(e,n)}_emitCodePoint(e){const n=Fw(e)?je.WHITESPACE_CHARACTER:e===T.NULL?je.NULL_CHARACTER:je.CHARACTER;this._appendCharToCurrentCharacterToken(n,String.fromCodePoint(e))}_emitChars(e){this._appendCharToCurrentCharacterToken(je.CHARACTER,e)}_startCharacterReference(){this.returnState=this.state,this.state=A.CHARACTER_REFERENCE,this.entityStartPos=this.preprocessor.pos,this.entityDecoder.startEntity(this._isCharacterReferenceInAttribute()?Cn.Attribute:Cn.Legacy)}_isCharacterReferenceInAttribute(){return this.returnState===A.ATTRIBUTE_VALUE_DOUBLE_QUOTED||this.returnState===A.ATTRIBUTE_VALUE_SINGLE_QUOTED||this.returnState===A.ATTRIBUTE_VALUE_UNQUOTED}_flushCodePointConsumedAsCharacterReference(e){this._isCharacterReferenceInAttribute()?this.currentAttr.value+=String.fromCodePoint(e):this._emitCodePoint(e)}_callState(e){switch(this.state){case A.DATA:{this._stateData(e);break}case A.RCDATA:{this._stateRcdata(e);break}case A.RAWTEXT:{this._stateRawtext(e);break}case A.SCRIPT_DATA:{this._stateScriptData(e);break}case A.PLAINTEXT:{this._statePlaintext(e);break}case A.TAG_OPEN:{this._stateTagOpen(e);break}case A.END_TAG_OPEN:{this._stateEndTagOpen(e);break}case A.TAG_NAME:{this._stateTagName(e);break}case A.RCDATA_LESS_THAN_SIGN:{this._stateRcdataLessThanSign(e);break}case A.RCDATA_END_TAG_OPEN:{this._stateRcdataEndTagOpen(e);break}case A.RCDATA_END_TAG_NAME:{this._stateRcdataEndTagName(e);break}case A.RAWTEXT_LESS_THAN_SIGN:{this._stateRawtextLessThanSign(e);break}case A.RAWTEXT_END_TAG_OPEN:{this._stateRawtextEndTagOpen(e);break}case A.RAWTEXT_END_TAG_NAME:{this._stateRawtextEndTagName(e);break}case A.SCRIPT_DATA_LESS_THAN_SIGN:{this._stateScriptDataLessThanSign(e);break}case A.SCRIPT_DATA_END_TAG_OPEN:{this._stateScriptDataEndTagOpen(e);break}case A.SCRIPT_DATA_END_TAG_NAME:{this._stateScriptDataEndTagName(e);break}case A.SCRIPT_DATA_ESCAPE_START:{this._stateScriptDataEscapeStart(e);break}case A.SCRIPT_DATA_ESCAPE_START_DASH:{this._stateScriptDataEscapeStartDash(e);break}case A.SCRIPT_DATA_ESCAPED:{this._stateScriptDataEscaped(e);break}case A.SCRIPT_DATA_ESCAPED_DASH:{this._stateScriptDataEscapedDash(e);break}case A.SCRIPT_DATA_ESCAPED_DASH_DASH:{this._stateScriptDataEscapedDashDash(e);break}case A.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataEscapedLessThanSign(e);break}case A.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:{this._stateScriptDataEscapedEndTagOpen(e);break}case A.SCRIPT_DATA_ESCAPED_END_TAG_NAME:{this._stateScriptDataEscapedEndTagName(e);break}case A.SCRIPT_DATA_DOUBLE_ESCAPE_START:{this._stateScriptDataDoubleEscapeStart(e);break}case A.SCRIPT_DATA_DOUBLE_ESCAPED:{this._stateScriptDataDoubleEscaped(e);break}case A.SCRIPT_DATA_DOUBLE_ESCAPED_DASH:{this._stateScriptDataDoubleEscapedDash(e);break}case A.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH:{this._stateScriptDataDoubleEscapedDashDash(e);break}case A.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataDoubleEscapedLessThanSign(e);break}case A.SCRIPT_DATA_DOUBLE_ESCAPE_END:{this._stateScriptDataDoubleEscapeEnd(e);break}case A.BEFORE_ATTRIBUTE_NAME:{this._stateBeforeAttributeName(e);break}case A.ATTRIBUTE_NAME:{this._stateAttributeName(e);break}case A.AFTER_ATTRIBUTE_NAME:{this._stateAfterAttributeName(e);break}case A.BEFORE_ATTRIBUTE_VALUE:{this._stateBeforeAttributeValue(e);break}case A.ATTRIBUTE_VALUE_DOUBLE_QUOTED:{this._stateAttributeValueDoubleQuoted(e);break}case A.ATTRIBUTE_VALUE_SINGLE_QUOTED:{this._stateAttributeValueSingleQuoted(e);break}case A.ATTRIBUTE_VALUE_UNQUOTED:{this._stateAttributeValueUnquoted(e);break}case A.AFTER_ATTRIBUTE_VALUE_QUOTED:{this._stateAfterAttributeValueQuoted(e);break}case A.SELF_CLOSING_START_TAG:{this._stateSelfClosingStartTag(e);break}case A.BOGUS_COMMENT:{this._stateBogusComment(e);break}case A.MARKUP_DECLARATION_OPEN:{this._stateMarkupDeclarationOpen(e);break}case A.COMMENT_START:{this._stateCommentStart(e);break}case A.COMMENT_START_DASH:{this._stateCommentStartDash(e);break}case A.COMMENT:{this._stateComment(e);break}case A.COMMENT_LESS_THAN_SIGN:{this._stateCommentLessThanSign(e);break}case A.COMMENT_LESS_THAN_SIGN_BANG:{this._stateCommentLessThanSignBang(e);break}case A.COMMENT_LESS_THAN_SIGN_BANG_DASH:{this._stateCommentLessThanSignBangDash(e);break}case A.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:{this._stateCommentLessThanSignBangDashDash(e);break}case A.COMMENT_END_DASH:{this._stateCommentEndDash(e);break}case A.COMMENT_END:{this._stateCommentEnd(e);break}case A.COMMENT_END_BANG:{this._stateCommentEndBang(e);break}case A.DOCTYPE:{this._stateDoctype(e);break}case A.BEFORE_DOCTYPE_NAME:{this._stateBeforeDoctypeName(e);break}case A.DOCTYPE_NAME:{this._stateDoctypeName(e);break}case A.AFTER_DOCTYPE_NAME:{this._stateAfterDoctypeName(e);break}case A.AFTER_DOCTYPE_PUBLIC_KEYWORD:{this._stateAfterDoctypePublicKeyword(e);break}case A.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateBeforeDoctypePublicIdentifier(e);break}case A.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypePublicIdentifierDoubleQuoted(e);break}case A.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypePublicIdentifierSingleQuoted(e);break}case A.AFTER_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateAfterDoctypePublicIdentifier(e);break}case A.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS:{this._stateBetweenDoctypePublicAndSystemIdentifiers(e);break}case A.AFTER_DOCTYPE_SYSTEM_KEYWORD:{this._stateAfterDoctypeSystemKeyword(e);break}case A.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateBeforeDoctypeSystemIdentifier(e);break}case A.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypeSystemIdentifierDoubleQuoted(e);break}case A.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypeSystemIdentifierSingleQuoted(e);break}case A.AFTER_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateAfterDoctypeSystemIdentifier(e);break}case A.BOGUS_DOCTYPE:{this._stateBogusDoctype(e);break}case A.CDATA_SECTION:{this._stateCdataSection(e);break}case A.CDATA_SECTION_BRACKET:{this._stateCdataSectionBracket(e);break}case A.CDATA_SECTION_END:{this._stateCdataSectionEnd(e);break}case A.CHARACTER_REFERENCE:{this._stateCharacterReference();break}case A.AMBIGUOUS_AMPERSAND:{this._stateAmbiguousAmpersand(e);break}default:throw new Error("Unknown state")}}_stateData(e){switch(e){case T.LESS_THAN_SIGN:{this.state=A.TAG_OPEN;break}case T.AMPERSAND:{this._startCharacterReference();break}case T.NULL:{this._err(j.unexpectedNullCharacter),this._emitCodePoint(e);break}case T.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateRcdata(e){switch(e){case T.AMPERSAND:{this._startCharacterReference();break}case T.LESS_THAN_SIGN:{this.state=A.RCDATA_LESS_THAN_SIGN;break}case T.NULL:{this._err(j.unexpectedNullCharacter),this._emitChars(st);break}case T.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateRawtext(e){switch(e){case T.LESS_THAN_SIGN:{this.state=A.RAWTEXT_LESS_THAN_SIGN;break}case T.NULL:{this._err(j.unexpectedNullCharacter),this._emitChars(st);break}case T.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptData(e){switch(e){case T.LESS_THAN_SIGN:{this.state=A.SCRIPT_DATA_LESS_THAN_SIGN;break}case T.NULL:{this._err(j.unexpectedNullCharacter),this._emitChars(st);break}case T.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_statePlaintext(e){switch(e){case T.NULL:{this._err(j.unexpectedNullCharacter),this._emitChars(st);break}case T.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateTagOpen(e){if(Fr(e))this._createStartTagToken(),this.state=A.TAG_NAME,this._stateTagName(e);else switch(e){case T.EXCLAMATION_MARK:{this.state=A.MARKUP_DECLARATION_OPEN;break}case T.SOLIDUS:{this.state=A.END_TAG_OPEN;break}case T.QUESTION_MARK:{this._err(j.unexpectedQuestionMarkInsteadOfTagName),this._createCommentToken(1),this.state=A.BOGUS_COMMENT,this._stateBogusComment(e);break}case T.EOF:{this._err(j.eofBeforeTagName),this._emitChars("<"),this._emitEOFToken();break}default:this._err(j.invalidFirstCharacterOfTagName),this._emitChars("<"),this.state=A.DATA,this._stateData(e)}}_stateEndTagOpen(e){if(Fr(e))this._createEndTagToken(),this.state=A.TAG_NAME,this._stateTagName(e);else switch(e){case T.GREATER_THAN_SIGN:{this._err(j.missingEndTagName),this.state=A.DATA;break}case T.EOF:{this._err(j.eofBeforeTagName),this._emitChars("</"),this._emitEOFToken();break}default:this._err(j.invalidFirstCharacterOfTagName),this._createCommentToken(2),this.state=A.BOGUS_COMMENT,this._stateBogusComment(e)}}_stateTagName(e){const n=this.currentToken;switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:{this.state=A.BEFORE_ATTRIBUTE_NAME;break}case T.SOLIDUS:{this.state=A.SELF_CLOSING_START_TAG;break}case T.GREATER_THAN_SIGN:{this.state=A.DATA,this.emitCurrentTagToken();break}case T.NULL:{this._err(j.unexpectedNullCharacter),n.tagName+=st;break}case T.EOF:{this._err(j.eofInTag),this._emitEOFToken();break}default:n.tagName+=String.fromCodePoint(ii(e)?du(e):e)}}_stateRcdataLessThanSign(e){e===T.SOLIDUS?this.state=A.RCDATA_END_TAG_OPEN:(this._emitChars("<"),this.state=A.RCDATA,this._stateRcdata(e))}_stateRcdataEndTagOpen(e){Fr(e)?(this.state=A.RCDATA_END_TAG_NAME,this._stateRcdataEndTagName(e)):(this._emitChars("</"),this.state=A.RCDATA,this._stateRcdata(e))}handleSpecialEndTag(e){if(!this.preprocessor.startsWith(this.lastStartTagName,!1))return!this._ensureHibernation();this._createEndTagToken();const n=this.currentToken;switch(n.tagName=this.lastStartTagName,this.preprocessor.peek(this.lastStartTagName.length)){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:return this._advanceBy(this.lastStartTagName.length),this.state=A.BEFORE_ATTRIBUTE_NAME,!1;case T.SOLIDUS:return this._advanceBy(this.lastStartTagName.length),this.state=A.SELF_CLOSING_START_TAG,!1;case T.GREATER_THAN_SIGN:return this._advanceBy(this.lastStartTagName.length),this.emitCurrentTagToken(),this.state=A.DATA,!1;default:return!this._ensureHibernation()}}_stateRcdataEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=A.RCDATA,this._stateRcdata(e))}_stateRawtextLessThanSign(e){e===T.SOLIDUS?this.state=A.RAWTEXT_END_TAG_OPEN:(this._emitChars("<"),this.state=A.RAWTEXT,this._stateRawtext(e))}_stateRawtextEndTagOpen(e){Fr(e)?(this.state=A.RAWTEXT_END_TAG_NAME,this._stateRawtextEndTagName(e)):(this._emitChars("</"),this.state=A.RAWTEXT,this._stateRawtext(e))}_stateRawtextEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=A.RAWTEXT,this._stateRawtext(e))}_stateScriptDataLessThanSign(e){switch(e){case T.SOLIDUS:{this.state=A.SCRIPT_DATA_END_TAG_OPEN;break}case T.EXCLAMATION_MARK:{this.state=A.SCRIPT_DATA_ESCAPE_START,this._emitChars("<!");break}default:this._emitChars("<"),this.state=A.SCRIPT_DATA,this._stateScriptData(e)}}_stateScriptDataEndTagOpen(e){Fr(e)?(this.state=A.SCRIPT_DATA_END_TAG_NAME,this._stateScriptDataEndTagName(e)):(this._emitChars("</"),this.state=A.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=A.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscapeStart(e){e===T.HYPHEN_MINUS?(this.state=A.SCRIPT_DATA_ESCAPE_START_DASH,this._emitChars("-")):(this.state=A.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscapeStartDash(e){e===T.HYPHEN_MINUS?(this.state=A.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-")):(this.state=A.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscaped(e){switch(e){case T.HYPHEN_MINUS:{this.state=A.SCRIPT_DATA_ESCAPED_DASH,this._emitChars("-");break}case T.LESS_THAN_SIGN:{this.state=A.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case T.NULL:{this._err(j.unexpectedNullCharacter),this._emitChars(st);break}case T.EOF:{this._err(j.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptDataEscapedDash(e){switch(e){case T.HYPHEN_MINUS:{this.state=A.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-");break}case T.LESS_THAN_SIGN:{this.state=A.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case T.NULL:{this._err(j.unexpectedNullCharacter),this.state=A.SCRIPT_DATA_ESCAPED,this._emitChars(st);break}case T.EOF:{this._err(j.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=A.SCRIPT_DATA_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataEscapedDashDash(e){switch(e){case T.HYPHEN_MINUS:{this._emitChars("-");break}case T.LESS_THAN_SIGN:{this.state=A.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case T.GREATER_THAN_SIGN:{this.state=A.SCRIPT_DATA,this._emitChars(">");break}case T.NULL:{this._err(j.unexpectedNullCharacter),this.state=A.SCRIPT_DATA_ESCAPED,this._emitChars(st);break}case T.EOF:{this._err(j.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=A.SCRIPT_DATA_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataEscapedLessThanSign(e){e===T.SOLIDUS?this.state=A.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:Fr(e)?(this._emitChars("<"),this.state=A.SCRIPT_DATA_DOUBLE_ESCAPE_START,this._stateScriptDataDoubleEscapeStart(e)):(this._emitChars("<"),this.state=A.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataEscapedEndTagOpen(e){Fr(e)?(this.state=A.SCRIPT_DATA_ESCAPED_END_TAG_NAME,this._stateScriptDataEscapedEndTagName(e)):(this._emitChars("</"),this.state=A.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataEscapedEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=A.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataDoubleEscapeStart(e){if(this.preprocessor.startsWith(Kt.SCRIPT,!1)&&eb(this.preprocessor.peek(Kt.SCRIPT.length))){this._emitCodePoint(e);for(let n=0;n<Kt.SCRIPT.length;n++)this._emitCodePoint(this._consume());this.state=A.SCRIPT_DATA_DOUBLE_ESCAPED}else this._ensureHibernation()||(this.state=A.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataDoubleEscaped(e){switch(e){case T.HYPHEN_MINUS:{this.state=A.SCRIPT_DATA_DOUBLE_ESCAPED_DASH,this._emitChars("-");break}case T.LESS_THAN_SIGN:{this.state=A.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case T.NULL:{this._err(j.unexpectedNullCharacter),this._emitChars(st);break}case T.EOF:{this._err(j.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedDash(e){switch(e){case T.HYPHEN_MINUS:{this.state=A.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH,this._emitChars("-");break}case T.LESS_THAN_SIGN:{this.state=A.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case T.NULL:{this._err(j.unexpectedNullCharacter),this.state=A.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(st);break}case T.EOF:{this._err(j.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=A.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedDashDash(e){switch(e){case T.HYPHEN_MINUS:{this._emitChars("-");break}case T.LESS_THAN_SIGN:{this.state=A.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case T.GREATER_THAN_SIGN:{this.state=A.SCRIPT_DATA,this._emitChars(">");break}case T.NULL:{this._err(j.unexpectedNullCharacter),this.state=A.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(st);break}case T.EOF:{this._err(j.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=A.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedLessThanSign(e){e===T.SOLIDUS?(this.state=A.SCRIPT_DATA_DOUBLE_ESCAPE_END,this._emitChars("/")):(this.state=A.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(e))}_stateScriptDataDoubleEscapeEnd(e){if(this.preprocessor.startsWith(Kt.SCRIPT,!1)&&eb(this.preprocessor.peek(Kt.SCRIPT.length))){this._emitCodePoint(e);for(let n=0;n<Kt.SCRIPT.length;n++)this._emitCodePoint(this._consume());this.state=A.SCRIPT_DATA_ESCAPED}else this._ensureHibernation()||(this.state=A.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(e))}_stateBeforeAttributeName(e){switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:break;case T.SOLIDUS:case T.GREATER_THAN_SIGN:case T.EOF:{this.state=A.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(e);break}case T.EQUALS_SIGN:{this._err(j.unexpectedEqualsSignBeforeAttributeName),this._createAttr("="),this.state=A.ATTRIBUTE_NAME;break}default:this._createAttr(""),this.state=A.ATTRIBUTE_NAME,this._stateAttributeName(e)}}_stateAttributeName(e){switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:case T.SOLIDUS:case T.GREATER_THAN_SIGN:case T.EOF:{this._leaveAttrName(),this.state=A.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(e);break}case T.EQUALS_SIGN:{this._leaveAttrName(),this.state=A.BEFORE_ATTRIBUTE_VALUE;break}case T.QUOTATION_MARK:case T.APOSTROPHE:case T.LESS_THAN_SIGN:{this._err(j.unexpectedCharacterInAttributeName),this.currentAttr.name+=String.fromCodePoint(e);break}case T.NULL:{this._err(j.unexpectedNullCharacter),this.currentAttr.name+=st;break}default:this.currentAttr.name+=String.fromCodePoint(ii(e)?du(e):e)}}_stateAfterAttributeName(e){switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:break;case T.SOLIDUS:{this.state=A.SELF_CLOSING_START_TAG;break}case T.EQUALS_SIGN:{this.state=A.BEFORE_ATTRIBUTE_VALUE;break}case T.GREATER_THAN_SIGN:{this.state=A.DATA,this.emitCurrentTagToken();break}case T.EOF:{this._err(j.eofInTag),this._emitEOFToken();break}default:this._createAttr(""),this.state=A.ATTRIBUTE_NAME,this._stateAttributeName(e)}}_stateBeforeAttributeValue(e){switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:break;case T.QUOTATION_MARK:{this.state=A.ATTRIBUTE_VALUE_DOUBLE_QUOTED;break}case T.APOSTROPHE:{this.state=A.ATTRIBUTE_VALUE_SINGLE_QUOTED;break}case T.GREATER_THAN_SIGN:{this._err(j.missingAttributeValue),this.state=A.DATA,this.emitCurrentTagToken();break}default:this.state=A.ATTRIBUTE_VALUE_UNQUOTED,this._stateAttributeValueUnquoted(e)}}_stateAttributeValueDoubleQuoted(e){switch(e){case T.QUOTATION_MARK:{this.state=A.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case T.AMPERSAND:{this._startCharacterReference();break}case T.NULL:{this._err(j.unexpectedNullCharacter),this.currentAttr.value+=st;break}case T.EOF:{this._err(j.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAttributeValueSingleQuoted(e){switch(e){case T.APOSTROPHE:{this.state=A.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case T.AMPERSAND:{this._startCharacterReference();break}case T.NULL:{this._err(j.unexpectedNullCharacter),this.currentAttr.value+=st;break}case T.EOF:{this._err(j.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAttributeValueUnquoted(e){switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:{this._leaveAttrValue(),this.state=A.BEFORE_ATTRIBUTE_NAME;break}case T.AMPERSAND:{this._startCharacterReference();break}case T.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=A.DATA,this.emitCurrentTagToken();break}case T.NULL:{this._err(j.unexpectedNullCharacter),this.currentAttr.value+=st;break}case T.QUOTATION_MARK:case T.APOSTROPHE:case T.LESS_THAN_SIGN:case T.EQUALS_SIGN:case T.GRAVE_ACCENT:{this._err(j.unexpectedCharacterInUnquotedAttributeValue),this.currentAttr.value+=String.fromCodePoint(e);break}case T.EOF:{this._err(j.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAfterAttributeValueQuoted(e){switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:{this._leaveAttrValue(),this.state=A.BEFORE_ATTRIBUTE_NAME;break}case T.SOLIDUS:{this._leaveAttrValue(),this.state=A.SELF_CLOSING_START_TAG;break}case T.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=A.DATA,this.emitCurrentTagToken();break}case T.EOF:{this._err(j.eofInTag),this._emitEOFToken();break}default:this._err(j.missingWhitespaceBetweenAttributes),this.state=A.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(e)}}_stateSelfClosingStartTag(e){switch(e){case T.GREATER_THAN_SIGN:{const n=this.currentToken;n.selfClosing=!0,this.state=A.DATA,this.emitCurrentTagToken();break}case T.EOF:{this._err(j.eofInTag),this._emitEOFToken();break}default:this._err(j.unexpectedSolidusInTag),this.state=A.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(e)}}_stateBogusComment(e){const n=this.currentToken;switch(e){case T.GREATER_THAN_SIGN:{this.state=A.DATA,this.emitCurrentComment(n);break}case T.EOF:{this.emitCurrentComment(n),this._emitEOFToken();break}case T.NULL:{this._err(j.unexpectedNullCharacter),n.data+=st;break}default:n.data+=String.fromCodePoint(e)}}_stateMarkupDeclarationOpen(e){this._consumeSequenceIfMatch(Kt.DASH_DASH,!0)?(this._createCommentToken(Kt.DASH_DASH.length+1),this.state=A.COMMENT_START):this._consumeSequenceIfMatch(Kt.DOCTYPE,!1)?(this.currentLocation=this.getCurrentLocation(Kt.DOCTYPE.length+1),this.state=A.DOCTYPE):this._consumeSequenceIfMatch(Kt.CDATA_START,!0)?this.inForeignNode?this.state=A.CDATA_SECTION:(this._err(j.cdataInHtmlContent),this._createCommentToken(Kt.CDATA_START.length+1),this.currentToken.data="[CDATA[",this.state=A.BOGUS_COMMENT):this._ensureHibernation()||(this._err(j.incorrectlyOpenedComment),this._createCommentToken(2),this.state=A.BOGUS_COMMENT,this._stateBogusComment(e))}_stateCommentStart(e){switch(e){case T.HYPHEN_MINUS:{this.state=A.COMMENT_START_DASH;break}case T.GREATER_THAN_SIGN:{this._err(j.abruptClosingOfEmptyComment),this.state=A.DATA;const n=this.currentToken;this.emitCurrentComment(n);break}default:this.state=A.COMMENT,this._stateComment(e)}}_stateCommentStartDash(e){const n=this.currentToken;switch(e){case T.HYPHEN_MINUS:{this.state=A.COMMENT_END;break}case T.GREATER_THAN_SIGN:{this._err(j.abruptClosingOfEmptyComment),this.state=A.DATA,this.emitCurrentComment(n);break}case T.EOF:{this._err(j.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="-",this.state=A.COMMENT,this._stateComment(e)}}_stateComment(e){const n=this.currentToken;switch(e){case T.HYPHEN_MINUS:{this.state=A.COMMENT_END_DASH;break}case T.LESS_THAN_SIGN:{n.data+="<",this.state=A.COMMENT_LESS_THAN_SIGN;break}case T.NULL:{this._err(j.unexpectedNullCharacter),n.data+=st;break}case T.EOF:{this._err(j.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+=String.fromCodePoint(e)}}_stateCommentLessThanSign(e){const n=this.currentToken;switch(e){case T.EXCLAMATION_MARK:{n.data+="!",this.state=A.COMMENT_LESS_THAN_SIGN_BANG;break}case T.LESS_THAN_SIGN:{n.data+="<";break}default:this.state=A.COMMENT,this._stateComment(e)}}_stateCommentLessThanSignBang(e){e===T.HYPHEN_MINUS?this.state=A.COMMENT_LESS_THAN_SIGN_BANG_DASH:(this.state=A.COMMENT,this._stateComment(e))}_stateCommentLessThanSignBangDash(e){e===T.HYPHEN_MINUS?this.state=A.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:(this.state=A.COMMENT_END_DASH,this._stateCommentEndDash(e))}_stateCommentLessThanSignBangDashDash(e){e!==T.GREATER_THAN_SIGN&&e!==T.EOF&&this._err(j.nestedComment),this.state=A.COMMENT_END,this._stateCommentEnd(e)}_stateCommentEndDash(e){const n=this.currentToken;switch(e){case T.HYPHEN_MINUS:{this.state=A.COMMENT_END;break}case T.EOF:{this._err(j.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="-",this.state=A.COMMENT,this._stateComment(e)}}_stateCommentEnd(e){const n=this.currentToken;switch(e){case T.GREATER_THAN_SIGN:{this.state=A.DATA,this.emitCurrentComment(n);break}case T.EXCLAMATION_MARK:{this.state=A.COMMENT_END_BANG;break}case T.HYPHEN_MINUS:{n.data+="-";break}case T.EOF:{this._err(j.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="--",this.state=A.COMMENT,this._stateComment(e)}}_stateCommentEndBang(e){const n=this.currentToken;switch(e){case T.HYPHEN_MINUS:{n.data+="--!",this.state=A.COMMENT_END_DASH;break}case T.GREATER_THAN_SIGN:{this._err(j.incorrectlyClosedComment),this.state=A.DATA,this.emitCurrentComment(n);break}case T.EOF:{this._err(j.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="--!",this.state=A.COMMENT,this._stateComment(e)}}_stateDoctype(e){switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:{this.state=A.BEFORE_DOCTYPE_NAME;break}case T.GREATER_THAN_SIGN:{this.state=A.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(e);break}case T.EOF:{this._err(j.eofInDoctype),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(j.missingWhitespaceBeforeDoctypeName),this.state=A.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(e)}}_stateBeforeDoctypeName(e){if(ii(e))this._createDoctypeToken(String.fromCharCode(du(e))),this.state=A.DOCTYPE_NAME;else switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:break;case T.NULL:{this._err(j.unexpectedNullCharacter),this._createDoctypeToken(st),this.state=A.DOCTYPE_NAME;break}case T.GREATER_THAN_SIGN:{this._err(j.missingDoctypeName),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=A.DATA;break}case T.EOF:{this._err(j.eofInDoctype),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._createDoctypeToken(String.fromCodePoint(e)),this.state=A.DOCTYPE_NAME}}_stateDoctypeName(e){const n=this.currentToken;switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:{this.state=A.AFTER_DOCTYPE_NAME;break}case T.GREATER_THAN_SIGN:{this.state=A.DATA,this.emitCurrentDoctype(n);break}case T.NULL:{this._err(j.unexpectedNullCharacter),n.name+=st;break}case T.EOF:{this._err(j.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.name+=String.fromCodePoint(ii(e)?du(e):e)}}_stateAfterDoctypeName(e){const n=this.currentToken;switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:break;case T.GREATER_THAN_SIGN:{this.state=A.DATA,this.emitCurrentDoctype(n);break}case T.EOF:{this._err(j.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._consumeSequenceIfMatch(Kt.PUBLIC,!1)?this.state=A.AFTER_DOCTYPE_PUBLIC_KEYWORD:this._consumeSequenceIfMatch(Kt.SYSTEM,!1)?this.state=A.AFTER_DOCTYPE_SYSTEM_KEYWORD:this._ensureHibernation()||(this._err(j.invalidCharacterSequenceAfterDoctypeName),n.forceQuirks=!0,this.state=A.BOGUS_DOCTYPE,this._stateBogusDoctype(e))}}_stateAfterDoctypePublicKeyword(e){const n=this.currentToken;switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:{this.state=A.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER;break}case T.QUOTATION_MARK:{this._err(j.missingWhitespaceAfterDoctypePublicKeyword),n.publicId="",this.state=A.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case T.APOSTROPHE:{this._err(j.missingWhitespaceAfterDoctypePublicKeyword),n.publicId="",this.state=A.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case T.GREATER_THAN_SIGN:{this._err(j.missingDoctypePublicIdentifier),n.forceQuirks=!0,this.state=A.DATA,this.emitCurrentDoctype(n);break}case T.EOF:{this._err(j.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(j.missingQuoteBeforeDoctypePublicIdentifier),n.forceQuirks=!0,this.state=A.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBeforeDoctypePublicIdentifier(e){const n=this.currentToken;switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:break;case T.QUOTATION_MARK:{n.publicId="",this.state=A.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case T.APOSTROPHE:{n.publicId="",this.state=A.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case T.GREATER_THAN_SIGN:{this._err(j.missingDoctypePublicIdentifier),n.forceQuirks=!0,this.state=A.DATA,this.emitCurrentDoctype(n);break}case T.EOF:{this._err(j.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(j.missingQuoteBeforeDoctypePublicIdentifier),n.forceQuirks=!0,this.state=A.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateDoctypePublicIdentifierDoubleQuoted(e){const n=this.currentToken;switch(e){case T.QUOTATION_MARK:{this.state=A.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case T.NULL:{this._err(j.unexpectedNullCharacter),n.publicId+=st;break}case T.GREATER_THAN_SIGN:{this._err(j.abruptDoctypePublicIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=A.DATA;break}case T.EOF:{this._err(j.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.publicId+=String.fromCodePoint(e)}}_stateDoctypePublicIdentifierSingleQuoted(e){const n=this.currentToken;switch(e){case T.APOSTROPHE:{this.state=A.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case T.NULL:{this._err(j.unexpectedNullCharacter),n.publicId+=st;break}case T.GREATER_THAN_SIGN:{this._err(j.abruptDoctypePublicIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=A.DATA;break}case T.EOF:{this._err(j.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.publicId+=String.fromCodePoint(e)}}_stateAfterDoctypePublicIdentifier(e){const n=this.currentToken;switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:{this.state=A.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS;break}case T.GREATER_THAN_SIGN:{this.state=A.DATA,this.emitCurrentDoctype(n);break}case T.QUOTATION_MARK:{this._err(j.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),n.systemId="",this.state=A.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case T.APOSTROPHE:{this._err(j.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),n.systemId="",this.state=A.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case T.EOF:{this._err(j.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(j.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=A.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBetweenDoctypePublicAndSystemIdentifiers(e){const n=this.currentToken;switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:break;case T.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=A.DATA;break}case T.QUOTATION_MARK:{n.systemId="",this.state=A.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case T.APOSTROPHE:{n.systemId="",this.state=A.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case T.EOF:{this._err(j.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(j.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=A.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateAfterDoctypeSystemKeyword(e){const n=this.currentToken;switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:{this.state=A.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER;break}case T.QUOTATION_MARK:{this._err(j.missingWhitespaceAfterDoctypeSystemKeyword),n.systemId="",this.state=A.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case T.APOSTROPHE:{this._err(j.missingWhitespaceAfterDoctypeSystemKeyword),n.systemId="",this.state=A.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case T.GREATER_THAN_SIGN:{this._err(j.missingDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=A.DATA,this.emitCurrentDoctype(n);break}case T.EOF:{this._err(j.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(j.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=A.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBeforeDoctypeSystemIdentifier(e){const n=this.currentToken;switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:break;case T.QUOTATION_MARK:{n.systemId="",this.state=A.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case T.APOSTROPHE:{n.systemId="",this.state=A.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case T.GREATER_THAN_SIGN:{this._err(j.missingDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=A.DATA,this.emitCurrentDoctype(n);break}case T.EOF:{this._err(j.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(j.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=A.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateDoctypeSystemIdentifierDoubleQuoted(e){const n=this.currentToken;switch(e){case T.QUOTATION_MARK:{this.state=A.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case T.NULL:{this._err(j.unexpectedNullCharacter),n.systemId+=st;break}case T.GREATER_THAN_SIGN:{this._err(j.abruptDoctypeSystemIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=A.DATA;break}case T.EOF:{this._err(j.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.systemId+=String.fromCodePoint(e)}}_stateDoctypeSystemIdentifierSingleQuoted(e){const n=this.currentToken;switch(e){case T.APOSTROPHE:{this.state=A.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case T.NULL:{this._err(j.unexpectedNullCharacter),n.systemId+=st;break}case T.GREATER_THAN_SIGN:{this._err(j.abruptDoctypeSystemIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=A.DATA;break}case T.EOF:{this._err(j.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.systemId+=String.fromCodePoint(e)}}_stateAfterDoctypeSystemIdentifier(e){const n=this.currentToken;switch(e){case T.SPACE:case T.LINE_FEED:case T.TABULATION:case T.FORM_FEED:break;case T.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=A.DATA;break}case T.EOF:{this._err(j.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(j.unexpectedCharacterAfterDoctypeSystemIdentifier),this.state=A.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBogusDoctype(e){const n=this.currentToken;switch(e){case T.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=A.DATA;break}case T.NULL:{this._err(j.unexpectedNullCharacter);break}case T.EOF:{this.emitCurrentDoctype(n),this._emitEOFToken();break}}}_stateCdataSection(e){switch(e){case T.RIGHT_SQUARE_BRACKET:{this.state=A.CDATA_SECTION_BRACKET;break}case T.EOF:{this._err(j.eofInCdata),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateCdataSectionBracket(e){e===T.RIGHT_SQUARE_BRACKET?this.state=A.CDATA_SECTION_END:(this._emitChars("]"),this.state=A.CDATA_SECTION,this._stateCdataSection(e))}_stateCdataSectionEnd(e){switch(e){case T.GREATER_THAN_SIGN:{this.state=A.DATA;break}case T.RIGHT_SQUARE_BRACKET:{this._emitChars("]");break}default:this._emitChars("]]"),this.state=A.CDATA_SECTION,this._stateCdataSection(e)}}_stateCharacterReference(){let e=this.entityDecoder.write(this.preprocessor.html,this.preprocessor.pos);if(e<0)if(this.preprocessor.lastChunkWritten)e=this.entityDecoder.end();else{this.active=!1,this.preprocessor.pos=this.preprocessor.html.length-1,this.consumedAfterSnapshot=0,this.preprocessor.endOfChunkHit=!0;return}e===0?(this.preprocessor.pos=this.entityStartPos,this._flushCodePointConsumedAsCharacterReference(T.AMPERSAND),this.state=!this._isCharacterReferenceInAttribute()&&Q0(this.preprocessor.peek(1))?A.AMBIGUOUS_AMPERSAND:this.returnState):this.state=this.returnState}_stateAmbiguousAmpersand(e){Q0(e)?this._flushCodePointConsumedAsCharacterReference(e):(e===T.SEMICOLON&&this._err(j.unknownNamedCharacterReference),this.state=this.returnState,this._callState(e))}};const Uw=new Set([h.DD,h.DT,h.LI,h.OPTGROUP,h.OPTION,h.P,h.RB,h.RP,h.RT,h.RTC]),tb=new Set([...Uw,h.CAPTION,h.COLGROUP,h.TBODY,h.TD,h.TFOOT,h.TH,h.THEAD,h.TR]),_c=new Set([h.APPLET,h.CAPTION,h.HTML,h.MARQUEE,h.OBJECT,h.TABLE,h.TD,h.TEMPLATE,h.TH]),I5=new Set([..._c,h.OL,h.UL]),k5=new Set([..._c,h.BUTTON]),nb=new Set([h.ANNOTATION_XML,h.MI,h.MN,h.MO,h.MS,h.MTEXT]),rb=new Set([h.DESC,h.FOREIGN_OBJECT,h.TITLE]),N5=new Set([h.TR,h.TEMPLATE,h.HTML]),R5=new Set([h.TBODY,h.TFOOT,h.THEAD,h.TEMPLATE,h.HTML]),P5=new Set([h.TABLE,h.TEMPLATE,h.HTML]),x5=new Set([h.TD,h.TH]);class L5{get currentTmplContentOrNode(){return this._isInTemplate()?this.treeAdapter.getTemplateContent(this.current):this.current}constructor(e,n,r){this.treeAdapter=n,this.handler=r,this.items=[],this.tagIDs=[],this.stackTop=-1,this.tmplCount=0,this.currentTagId=h.UNKNOWN,this.current=e}_indexOf(e){return this.items.lastIndexOf(e,this.stackTop)}_isInTemplate(){return this.currentTagId===h.TEMPLATE&&this.treeAdapter.getNamespaceURI(this.current)===G.HTML}_updateCurrentElement(){this.current=this.items[this.stackTop],this.currentTagId=this.tagIDs[this.stackTop]}push(e,n){this.stackTop++,this.items[this.stackTop]=e,this.current=e,this.tagIDs[this.stackTop]=n,this.currentTagId=n,this._isInTemplate()&&this.tmplCount++,this.handler.onItemPush(e,n,!0)}pop(){const e=this.current;this.tmplCount>0&&this._isInTemplate()&&this.tmplCount--,this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(e,!0)}replace(e,n){const r=this._indexOf(e);this.items[r]=n,r===this.stackTop&&(this.current=n)}insertAfter(e,n,r){const s=this._indexOf(e)+1;this.items.splice(s,0,n),this.tagIDs.splice(s,0,r),this.stackTop++,s===this.stackTop&&this._updateCurrentElement(),this.handler.onItemPush(this.current,this.currentTagId,s===this.stackTop)}popUntilTagNamePopped(e){let n=this.stackTop+1;do n=this.tagIDs.lastIndexOf(e,n-1);while(n>0&&this.treeAdapter.getNamespaceURI(this.items[n])!==G.HTML);this.shortenToLength(n<0?0:n)}shortenToLength(e){for(;this.stackTop>=e;){const n=this.current;this.tmplCount>0&&this._isInTemplate()&&(this.tmplCount-=1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(n,this.stackTop<e)}}popUntilElementPopped(e){const n=this._indexOf(e);this.shortenToLength(n<0?0:n)}popUntilPopped(e,n){const r=this._indexOfTagNames(e,n);this.shortenToLength(r<0?0:r)}popUntilNumberedHeaderPopped(){this.popUntilPopped(Gh,G.HTML)}popUntilTableCellPopped(){this.popUntilPopped(x5,G.HTML)}popAllUpToHtmlElement(){this.tmplCount=0,this.shortenToLength(1)}_indexOfTagNames(e,n){for(let r=this.stackTop;r>=0;r--)if(e.has(this.tagIDs[r])&&this.treeAdapter.getNamespaceURI(this.items[r])===n)return r;return-1}clearBackTo(e,n){const r=this._indexOfTagNames(e,n);this.shortenToLength(r+1)}clearBackToTableContext(){this.clearBackTo(P5,G.HTML)}clearBackToTableBodyContext(){this.clearBackTo(R5,G.HTML)}clearBackToTableRowContext(){this.clearBackTo(N5,G.HTML)}remove(e){const n=this._indexOf(e);n>=0&&(n===this.stackTop?this.pop():(this.items.splice(n,1),this.tagIDs.splice(n,1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(e,!1)))}tryPeekProperlyNestedBodyElement(){return this.stackTop>=1&&this.tagIDs[1]===h.BODY?this.items[1]:null}contains(e){return this._indexOf(e)>-1}getCommonAncestor(e){const n=this._indexOf(e)-1;return n>=0?this.items[n]:null}isRootHtmlElementCurrent(){return this.stackTop===0&&this.tagIDs[0]===h.HTML}hasInDynamicScope(e,n){for(let r=this.stackTop;r>=0;r--){const s=this.tagIDs[r];switch(this.treeAdapter.getNamespaceURI(this.items[r])){case G.HTML:{if(s===e)return!0;if(n.has(s))return!1;break}case G.SVG:{if(rb.has(s))return!1;break}case G.MATHML:{if(nb.has(s))return!1;break}}}return!0}hasInScope(e){return this.hasInDynamicScope(e,_c)}hasInListItemScope(e){return this.hasInDynamicScope(e,I5)}hasInButtonScope(e){return this.hasInDynamicScope(e,k5)}hasNumberedHeaderInScope(){for(let e=this.stackTop;e>=0;e--){const n=this.tagIDs[e];switch(this.treeAdapter.getNamespaceURI(this.items[e])){case G.HTML:{if(Gh.has(n))return!0;if(_c.has(n))return!1;break}case G.SVG:{if(rb.has(n))return!1;break}case G.MATHML:{if(nb.has(n))return!1;break}}}return!0}hasInTableScope(e){for(let n=this.stackTop;n>=0;n--)if(this.treeAdapter.getNamespaceURI(this.items[n])===G.HTML)switch(this.tagIDs[n]){case e:return!0;case h.TABLE:case h.HTML:return!1}return!0}hasTableBodyContextInTableScope(){for(let e=this.stackTop;e>=0;e--)if(this.treeAdapter.getNamespaceURI(this.items[e])===G.HTML)switch(this.tagIDs[e]){case h.TBODY:case h.THEAD:case h.TFOOT:return!0;case h.TABLE:case h.HTML:return!1}return!0}hasInSelectScope(e){for(let n=this.stackTop;n>=0;n--)if(this.treeAdapter.getNamespaceURI(this.items[n])===G.HTML)switch(this.tagIDs[n]){case e:return!0;case h.OPTION:case h.OPTGROUP:break;default:return!1}return!0}generateImpliedEndTags(){for(;Uw.has(this.currentTagId);)this.pop()}generateImpliedEndTagsThoroughly(){for(;tb.has(this.currentTagId);)this.pop()}generateImpliedEndTagsWithExclusion(e){for(;this.currentTagId!==e&&tb.has(this.currentTagId);)this.pop()}}const kd=3;var ar;(function(t){t[t.Marker=0]="Marker",t[t.Element=1]="Element"})(ar||(ar={}));const sb={type:ar.Marker};class D5{constructor(e){this.treeAdapter=e,this.entries=[],this.bookmark=null}_getNoahArkConditionCandidates(e,n){const r=[],s=n.length,a=this.treeAdapter.getTagName(e),i=this.treeAdapter.getNamespaceURI(e);for(let o=0;o<this.entries.length;o++){const u=this.entries[o];if(u.type===ar.Marker)break;const{element:c}=u;if(this.treeAdapter.getTagName(c)===a&&this.treeAdapter.getNamespaceURI(c)===i){const l=this.treeAdapter.getAttrList(c);l.length===s&&r.push({idx:o,attrs:l})}}return r}_ensureNoahArkCondition(e){if(this.entries.length<kd)return;const n=this.treeAdapter.getAttrList(e),r=this._getNoahArkConditionCandidates(e,n);if(r.length<kd)return;const s=new Map(n.map(i=>[i.name,i.value]));let a=0;for(let i=0;i<r.length;i++){const o=r[i];o.attrs.every(u=>s.get(u.name)===u.value)&&(a+=1,a>=kd&&this.entries.splice(o.idx,1))}}insertMarker(){this.entries.unshift(sb)}pushElement(e,n){this._ensureNoahArkCondition(e),this.entries.unshift({type:ar.Element,element:e,token:n})}insertElementAfterBookmark(e,n){const r=this.entries.indexOf(this.bookmark);this.entries.splice(r,0,{type:ar.Element,element:e,token:n})}removeEntry(e){const n=this.entries.indexOf(e);n>=0&&this.entries.splice(n,1)}clearToLastMarker(){const e=this.entries.indexOf(sb);e>=0?this.entries.splice(0,e+1):this.entries.length=0}getElementEntryInScopeWithTagName(e){const n=this.entries.find(r=>r.type===ar.Marker||this.treeAdapter.getTagName(r.element)===e);return n&&n.type===ar.Element?n:null}getElementEntry(e){return this.entries.find(n=>n.type===ar.Element&&n.element===e)}}const Ar={createDocument(){return{nodeName:"#document",mode:fn.NO_QUIRKS,childNodes:[]}},createDocumentFragment(){return{nodeName:"#document-fragment",childNodes:[]}},createElement(t,e,n){return{nodeName:t,tagName:t,attrs:n,namespaceURI:e,childNodes:[],parentNode:null}},createCommentNode(t){return{nodeName:"#comment",data:t,parentNode:null}},createTextNode(t){return{nodeName:"#text",value:t,parentNode:null}},appendChild(t,e){t.childNodes.push(e),e.parentNode=t},insertBefore(t,e,n){const r=t.childNodes.indexOf(n);t.childNodes.splice(r,0,e),e.parentNode=t},setTemplateContent(t,e){t.content=e},getTemplateContent(t){return t.content},setDocumentType(t,e,n,r){const s=t.childNodes.find(a=>a.nodeName==="#documentType");if(s)s.name=e,s.publicId=n,s.systemId=r;else{const a={nodeName:"#documentType",name:e,publicId:n,systemId:r,parentNode:null};Ar.appendChild(t,a)}},setDocumentMode(t,e){t.mode=e},getDocumentMode(t){return t.mode},detachNode(t){if(t.parentNode){const e=t.parentNode.childNodes.indexOf(t);t.parentNode.childNodes.splice(e,1),t.parentNode=null}},insertText(t,e){if(t.childNodes.length>0){const n=t.childNodes[t.childNodes.length-1];if(Ar.isTextNode(n)){n.value+=e;return}}Ar.appendChild(t,Ar.createTextNode(e))},insertTextBefore(t,e,n){const r=t.childNodes[t.childNodes.indexOf(n)-1];r&&Ar.isTextNode(r)?r.value+=e:Ar.insertBefore(t,Ar.createTextNode(e),n)},adoptAttributes(t,e){const n=new Set(t.attrs.map(r=>r.name));for(let r=0;r<e.length;r++)n.has(e[r].name)||t.attrs.push(e[r])},getFirstChild(t){return t.childNodes[0]},getChildNodes(t){return t.childNodes},getParentNode(t){return t.parentNode},getAttrList(t){return t.attrs},getTagName(t){return t.tagName},getNamespaceURI(t){return t.namespaceURI},getTextNodeContent(t){return t.value},getCommentNodeContent(t){return t.data},getDocumentTypeNodeName(t){return t.name},getDocumentTypeNodePublicId(t){return t.publicId},getDocumentTypeNodeSystemId(t){return t.systemId},isTextNode(t){return t.nodeName==="#text"},isCommentNode(t){return t.nodeName==="#comment"},isDocumentTypeNode(t){return t.nodeName==="#documentType"},isElementNode(t){return Object.prototype.hasOwnProperty.call(t,"tagName")},setNodeSourceCodeLocation(t,e){t.sourceCodeLocation=e},getNodeSourceCodeLocation(t){return t.sourceCodeLocation},updateNodeSourceCodeLocation(t,e){t.sourceCodeLocation={...t.sourceCodeLocation,...e}}},jw="html",M5="about:legacy-compat",B5="http://www.ibm.com/data/dtd/v11/ibmxhtml1-transitional.dtd",Hw=["+//silmaril//dtd html pro v0r11 19970101//","-//as//dtd html 3.0 aswedit + extensions//","-//advasoft ltd//dtd html 3.0 aswedit + extensions//","-//ietf//dtd html 2.0 level 1//","-//ietf//dtd html 2.0 level 2//","-//ietf//dtd html 2.0 strict level 1//","-//ietf//dtd html 2.0 strict level 2//","-//ietf//dtd html 2.0 strict//","-//ietf//dtd html 2.0//","-//ietf//dtd html 2.1e//","-//ietf//dtd html 3.0//","-//ietf//dtd html 3.2 final//","-//ietf//dtd html 3.2//","-//ietf//dtd html 3//","-//ietf//dtd html level 0//","-//ietf//dtd html level 1//","-//ietf//dtd html level 2//","-//ietf//dtd html level 3//","-//ietf//dtd html strict level 0//","-//ietf//dtd html strict level 1//","-//ietf//dtd html strict level 2//","-//ietf//dtd html strict level 3//","-//ietf//dtd html strict//","-//ietf//dtd html//","-//metrius//dtd metrius presentational//","-//microsoft//dtd internet explorer 2.0 html strict//","-//microsoft//dtd internet explorer 2.0 html//","-//microsoft//dtd internet explorer 2.0 tables//","-//microsoft//dtd internet explorer 3.0 html strict//","-//microsoft//dtd internet explorer 3.0 html//","-//microsoft//dtd internet explorer 3.0 tables//","-//netscape comm. corp.//dtd html//","-//netscape comm. corp.//dtd strict html//","-//o'reilly and associates//dtd html 2.0//","-//o'reilly and associates//dtd html extended 1.0//","-//o'reilly and associates//dtd html extended relaxed 1.0//","-//sq//dtd html 2.0 hotmetal + extensions//","-//softquad software//dtd hotmetal pro 6.0::19990601::extensions to html 4.0//","-//softquad//dtd hotmetal pro 4.0::19971010::extensions to html 4.0//","-//spyglass//dtd html 2.0 extended//","-//sun microsystems corp.//dtd hotjava html//","-//sun microsystems corp.//dtd hotjava strict html//","-//w3c//dtd html 3 1995-03-24//","-//w3c//dtd html 3.2 draft//","-//w3c//dtd html 3.2 final//","-//w3c//dtd html 3.2//","-//w3c//dtd html 3.2s draft//","-//w3c//dtd html 4.0 frameset//","-//w3c//dtd html 4.0 transitional//","-//w3c//dtd html experimental 19960712//","-//w3c//dtd html experimental 970421//","-//w3c//dtd w3 html//","-//w3o//dtd w3 html 3.0//","-//webtechs//dtd mozilla html 2.0//","-//webtechs//dtd mozilla html//"],F5=[...Hw,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"],U5=new Set(["-//w3o//dtd w3 html strict 3.0//en//","-/w3c/dtd html 4.0 transitional/en","html"]),$w=["-//w3c//dtd xhtml 1.0 frameset//","-//w3c//dtd xhtml 1.0 transitional//"],j5=[...$w,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"];function ab(t,e){return e.some(n=>t.startsWith(n))}function H5(t){return t.name===jw&&t.publicId===null&&(t.systemId===null||t.systemId===M5)}function $5(t){if(t.name!==jw)return fn.QUIRKS;const{systemId:e}=t;if(e&&e.toLowerCase()===B5)return fn.QUIRKS;let{publicId:n}=t;if(n!==null){if(n=n.toLowerCase(),U5.has(n))return fn.QUIRKS;let r=e===null?F5:Hw;if(ab(n,r))return fn.QUIRKS;if(r=e===null?$w:j5,ab(n,r))return fn.LIMITED_QUIRKS}return fn.NO_QUIRKS}const ib={TEXT_HTML:"text/html",APPLICATION_XML:"application/xhtml+xml"},q5="definitionurl",V5="definitionURL",z5=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(t=>[t.toLowerCase(),t])),W5=new Map([["xlink:actuate",{prefix:"xlink",name:"actuate",namespace:G.XLINK}],["xlink:arcrole",{prefix:"xlink",name:"arcrole",namespace:G.XLINK}],["xlink:href",{prefix:"xlink",name:"href",namespace:G.XLINK}],["xlink:role",{prefix:"xlink",name:"role",namespace:G.XLINK}],["xlink:show",{prefix:"xlink",name:"show",namespace:G.XLINK}],["xlink:title",{prefix:"xlink",name:"title",namespace:G.XLINK}],["xlink:type",{prefix:"xlink",name:"type",namespace:G.XLINK}],["xml:lang",{prefix:"xml",name:"lang",namespace:G.XML}],["xml:space",{prefix:"xml",name:"space",namespace:G.XML}],["xmlns",{prefix:"",name:"xmlns",namespace:G.XMLNS}],["xmlns:xlink",{prefix:"xmlns",name:"xlink",namespace:G.XMLNS}]]),G5=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(t=>[t.toLowerCase(),t])),K5=new Set([h.B,h.BIG,h.BLOCKQUOTE,h.BODY,h.BR,h.CENTER,h.CODE,h.DD,h.DIV,h.DL,h.DT,h.EM,h.EMBED,h.H1,h.H2,h.H3,h.H4,h.H5,h.H6,h.HEAD,h.HR,h.I,h.IMG,h.LI,h.LISTING,h.MENU,h.META,h.NOBR,h.OL,h.P,h.PRE,h.RUBY,h.S,h.SMALL,h.SPAN,h.STRONG,h.STRIKE,h.SUB,h.SUP,h.TABLE,h.TT,h.U,h.UL,h.VAR]);function Y5(t){const e=t.tagID;return e===h.FONT&&t.attrs.some(({name:r})=>r===gs.COLOR||r===gs.SIZE||r===gs.FACE)||K5.has(e)}function qw(t){for(let e=0;e<t.attrs.length;e++)if(t.attrs[e].name===q5){t.attrs[e].name=V5;break}}function Vw(t){for(let e=0;e<t.attrs.length;e++){const n=z5.get(t.attrs[e].name);n!=null&&(t.attrs[e].name=n)}}function Rm(t){for(let e=0;e<t.attrs.length;e++){const n=W5.get(t.attrs[e].name);n&&(t.attrs[e].prefix=n.prefix,t.attrs[e].name=n.name,t.attrs[e].namespace=n.namespace)}}function Z5(t){const e=G5.get(t.tagName);e!=null&&(t.tagName=e,t.tagID=dl(t.tagName))}function J5(t,e){return e===G.MATHML&&(t===h.MI||t===h.MO||t===h.MN||t===h.MS||t===h.MTEXT)}function X5(t,e,n){if(e===G.MATHML&&t===h.ANNOTATION_XML){for(let r=0;r<n.length;r++)if(n[r].name===gs.ENCODING){const s=n[r].value.toLowerCase();return s===ib.TEXT_HTML||s===ib.APPLICATION_XML}}return e===G.SVG&&(t===h.FOREIGN_OBJECT||t===h.DESC||t===h.TITLE)}function Q5(t,e,n,r){return(!r||r===G.HTML)&&X5(t,e,n)||(!r||r===G.MATHML)&&J5(t,e)}const eB="hidden",tB=8,nB=3;var v;(function(t){t[t.INITIAL=0]="INITIAL",t[t.BEFORE_HTML=1]="BEFORE_HTML",t[t.BEFORE_HEAD=2]="BEFORE_HEAD",t[t.IN_HEAD=3]="IN_HEAD",t[t.IN_HEAD_NO_SCRIPT=4]="IN_HEAD_NO_SCRIPT",t[t.AFTER_HEAD=5]="AFTER_HEAD",t[t.IN_BODY=6]="IN_BODY",t[t.TEXT=7]="TEXT",t[t.IN_TABLE=8]="IN_TABLE",t[t.IN_TABLE_TEXT=9]="IN_TABLE_TEXT",t[t.IN_CAPTION=10]="IN_CAPTION",t[t.IN_COLUMN_GROUP=11]="IN_COLUMN_GROUP",t[t.IN_TABLE_BODY=12]="IN_TABLE_BODY",t[t.IN_ROW=13]="IN_ROW",t[t.IN_CELL=14]="IN_CELL",t[t.IN_SELECT=15]="IN_SELECT",t[t.IN_SELECT_IN_TABLE=16]="IN_SELECT_IN_TABLE",t[t.IN_TEMPLATE=17]="IN_TEMPLATE",t[t.AFTER_BODY=18]="AFTER_BODY",t[t.IN_FRAMESET=19]="IN_FRAMESET",t[t.AFTER_FRAMESET=20]="AFTER_FRAMESET",t[t.AFTER_AFTER_BODY=21]="AFTER_AFTER_BODY",t[t.AFTER_AFTER_FRAMESET=22]="AFTER_AFTER_FRAMESET"})(v||(v={}));const rB={startLine:-1,startCol:-1,startOffset:-1,endLine:-1,endCol:-1,endOffset:-1},zw=new Set([h.TABLE,h.TBODY,h.TFOOT,h.THEAD,h.TR]),ob={scriptingEnabled:!0,sourceCodeLocationInfo:!1,treeAdapter:Ar,onParseError:null};let Ww=class{constructor(e,n,r=null,s=null){this.fragmentContext=r,this.scriptHandler=s,this.currentToken=null,this.stopped=!1,this.insertionMode=v.INITIAL,this.originalInsertionMode=v.INITIAL,this.headElement=null,this.formElement=null,this.currentNotInHTML=!1,this.tmplInsertionModeStack=[],this.pendingCharacterTokens=[],this.hasNonWhitespacePendingCharacterToken=!1,this.framesetOk=!0,this.skipNextNewLine=!1,this.fosterParentingEnabled=!1,this.options={...ob,...e},this.treeAdapter=this.options.treeAdapter,this.onParseError=this.options.onParseError,this.onParseError&&(this.options.sourceCodeLocationInfo=!0),this.document=n??this.treeAdapter.createDocument(),this.tokenizer=new O5(this.options,this),this.activeFormattingElements=new D5(this.treeAdapter),this.fragmentContextID=r?dl(this.treeAdapter.getTagName(r)):h.UNKNOWN,this._setContextModes(r??this.document,this.fragmentContextID),this.openElements=new L5(this.document,this.treeAdapter,this)}static parse(e,n){const r=new this(n);return r.tokenizer.write(e,!0),r.document}static getFragmentParser(e,n){const r={...ob,...n};e??(e=r.treeAdapter.createElement(R.TEMPLATE,G.HTML,[]));const s=r.treeAdapter.createElement("documentmock",G.HTML,[]),a=new this(r,s,e);return a.fragmentContextID===h.TEMPLATE&&a.tmplInsertionModeStack.unshift(v.IN_TEMPLATE),a._initTokenizerForFragmentParsing(),a._insertFakeRootElement(),a._resetInsertionMode(),a._findFormInFragmentContext(),a}getFragment(){const e=this.treeAdapter.getFirstChild(this.document),n=this.treeAdapter.createDocumentFragment();return this._adoptNodes(e,n),n}_err(e,n,r){var s;if(!this.onParseError)return;const a=(s=e.location)!==null&&s!==void 0?s:rB,i={code:n,startLine:a.startLine,startCol:a.startCol,startOffset:a.startOffset,endLine:r?a.startLine:a.endLine,endCol:r?a.startCol:a.endCol,endOffset:r?a.startOffset:a.endOffset};this.onParseError(i)}onItemPush(e,n,r){var s,a;(a=(s=this.treeAdapter).onItemPush)===null||a===void 0||a.call(s,e),r&&this.openElements.stackTop>0&&this._setContextModes(e,n)}onItemPop(e,n){var r,s;if(this.options.sourceCodeLocationInfo&&this._setEndLocation(e,this.currentToken),(s=(r=this.treeAdapter).onItemPop)===null||s===void 0||s.call(r,e,this.openElements.current),n){let a,i;this.openElements.stackTop===0&&this.fragmentContext?(a=this.fragmentContext,i=this.fragmentContextID):{current:a,currentTagId:i}=this.openElements,this._setContextModes(a,i)}}_setContextModes(e,n){const r=e===this.document||this.treeAdapter.getNamespaceURI(e)===G.HTML;this.currentNotInHTML=!r,this.tokenizer.inForeignNode=!r&&!this._isIntegrationPoint(n,e)}_switchToTextParsing(e,n){this._insertElement(e,G.HTML),this.tokenizer.state=n,this.originalInsertionMode=this.insertionMode,this.insertionMode=v.TEXT}switchToPlaintextParsing(){this.insertionMode=v.TEXT,this.originalInsertionMode=v.IN_BODY,this.tokenizer.state=Qt.PLAINTEXT}_getAdjustedCurrentElement(){return this.openElements.stackTop===0&&this.fragmentContext?this.fragmentContext:this.openElements.current}_findFormInFragmentContext(){let e=this.fragmentContext;for(;e;){if(this.treeAdapter.getTagName(e)===R.FORM){this.formElement=e;break}e=this.treeAdapter.getParentNode(e)}}_initTokenizerForFragmentParsing(){if(!(!this.fragmentContext||this.treeAdapter.getNamespaceURI(this.fragmentContext)!==G.HTML))switch(this.fragmentContextID){case h.TITLE:case h.TEXTAREA:{this.tokenizer.state=Qt.RCDATA;break}case h.STYLE:case h.XMP:case h.IFRAME:case h.NOEMBED:case h.NOFRAMES:case h.NOSCRIPT:{this.tokenizer.state=Qt.RAWTEXT;break}case h.SCRIPT:{this.tokenizer.state=Qt.SCRIPT_DATA;break}case h.PLAINTEXT:{this.tokenizer.state=Qt.PLAINTEXT;break}}}_setDocumentType(e){const n=e.name||"",r=e.publicId||"",s=e.systemId||"";if(this.treeAdapter.setDocumentType(this.document,n,r,s),e.location){const i=this.treeAdapter.getChildNodes(this.document).find(o=>this.treeAdapter.isDocumentTypeNode(o));i&&this.treeAdapter.setNodeSourceCodeLocation(i,e.location)}}_attachElementToTree(e,n){if(this.options.sourceCodeLocationInfo){const r=n&&{...n,startTag:n};this.treeAdapter.setNodeSourceCodeLocation(e,r)}if(this._shouldFosterParentOnInsertion())this._fosterParentElement(e);else{const r=this.openElements.currentTmplContentOrNode;this.treeAdapter.appendChild(r,e)}}_appendElement(e,n){const r=this.treeAdapter.createElement(e.tagName,n,e.attrs);this._attachElementToTree(r,e.location)}_insertElement(e,n){const r=this.treeAdapter.createElement(e.tagName,n,e.attrs);this._attachElementToTree(r,e.location),this.openElements.push(r,e.tagID)}_insertFakeElement(e,n){const r=this.treeAdapter.createElement(e,G.HTML,[]);this._attachElementToTree(r,null),this.openElements.push(r,n)}_insertTemplate(e){const n=this.treeAdapter.createElement(e.tagName,G.HTML,e.attrs),r=this.treeAdapter.createDocumentFragment();this.treeAdapter.setTemplateContent(n,r),this._attachElementToTree(n,e.location),this.openElements.push(n,e.tagID),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(r,null)}_insertFakeRootElement(){const e=this.treeAdapter.createElement(R.HTML,G.HTML,[]);this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(e,null),this.treeAdapter.appendChild(this.openElements.current,e),this.openElements.push(e,h.HTML)}_appendCommentNode(e,n){const r=this.treeAdapter.createCommentNode(e.data);this.treeAdapter.appendChild(n,r),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(r,e.location)}_insertCharacters(e){let n,r;if(this._shouldFosterParentOnInsertion()?({parent:n,beforeElement:r}=this._findFosterParentingLocation(),r?this.treeAdapter.insertTextBefore(n,e.chars,r):this.treeAdapter.insertText(n,e.chars)):(n=this.openElements.currentTmplContentOrNode,this.treeAdapter.insertText(n,e.chars)),!e.location)return;const s=this.treeAdapter.getChildNodes(n),a=r?s.lastIndexOf(r):s.length,i=s[a-1];if(this.treeAdapter.getNodeSourceCodeLocation(i)){const{endLine:u,endCol:c,endOffset:l}=e.location;this.treeAdapter.updateNodeSourceCodeLocation(i,{endLine:u,endCol:c,endOffset:l})}else this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(i,e.location)}_adoptNodes(e,n){for(let r=this.treeAdapter.getFirstChild(e);r;r=this.treeAdapter.getFirstChild(e))this.treeAdapter.detachNode(r),this.treeAdapter.appendChild(n,r)}_setEndLocation(e,n){if(this.treeAdapter.getNodeSourceCodeLocation(e)&&n.location){const r=n.location,s=this.treeAdapter.getTagName(e),a=n.type===je.END_TAG&&s===n.tagName?{endTag:{...r},endLine:r.endLine,endCol:r.endCol,endOffset:r.endOffset}:{endLine:r.startLine,endCol:r.startCol,endOffset:r.startOffset};this.treeAdapter.updateNodeSourceCodeLocation(e,a)}}shouldProcessStartTagTokenInForeignContent(e){if(!this.currentNotInHTML)return!1;let n,r;return this.openElements.stackTop===0&&this.fragmentContext?(n=this.fragmentContext,r=this.fragmentContextID):{current:n,currentTagId:r}=this.openElements,e.tagID===h.SVG&&this.treeAdapter.getTagName(n)===R.ANNOTATION_XML&&this.treeAdapter.getNamespaceURI(n)===G.MATHML?!1:this.tokenizer.inForeignNode||(e.tagID===h.MGLYPH||e.tagID===h.MALIGNMARK)&&!this._isIntegrationPoint(r,n,G.HTML)}_processToken(e){switch(e.type){case je.CHARACTER:{this.onCharacter(e);break}case je.NULL_CHARACTER:{this.onNullCharacter(e);break}case je.COMMENT:{this.onComment(e);break}case je.DOCTYPE:{this.onDoctype(e);break}case je.START_TAG:{this._processStartTag(e);break}case je.END_TAG:{this.onEndTag(e);break}case je.EOF:{this.onEof(e);break}case je.WHITESPACE_CHARACTER:{this.onWhitespaceCharacter(e);break}}}_isIntegrationPoint(e,n,r){const s=this.treeAdapter.getNamespaceURI(n),a=this.treeAdapter.getAttrList(n);return Q5(e,s,a,r)}_reconstructActiveFormattingElements(){const e=this.activeFormattingElements.entries.length;if(e){const n=this.activeFormattingElements.entries.findIndex(s=>s.type===ar.Marker||this.openElements.contains(s.element)),r=n<0?e-1:n-1;for(let s=r;s>=0;s--){const a=this.activeFormattingElements.entries[s];this._insertElement(a.token,this.treeAdapter.getNamespaceURI(a.element)),a.element=this.openElements.current}}}_closeTableCell(){this.openElements.generateImpliedEndTags(),this.openElements.popUntilTableCellPopped(),this.activeFormattingElements.clearToLastMarker(),this.insertionMode=v.IN_ROW}_closePElement(){this.openElements.generateImpliedEndTagsWithExclusion(h.P),this.openElements.popUntilTagNamePopped(h.P)}_resetInsertionMode(){for(let e=this.openElements.stackTop;e>=0;e--)switch(e===0&&this.fragmentContext?this.fragmentContextID:this.openElements.tagIDs[e]){case h.TR:{this.insertionMode=v.IN_ROW;return}case h.TBODY:case h.THEAD:case h.TFOOT:{this.insertionMode=v.IN_TABLE_BODY;return}case h.CAPTION:{this.insertionMode=v.IN_CAPTION;return}case h.COLGROUP:{this.insertionMode=v.IN_COLUMN_GROUP;return}case h.TABLE:{this.insertionMode=v.IN_TABLE;return}case h.BODY:{this.insertionMode=v.IN_BODY;return}case h.FRAMESET:{this.insertionMode=v.IN_FRAMESET;return}case h.SELECT:{this._resetInsertionModeForSelect(e);return}case h.TEMPLATE:{this.insertionMode=this.tmplInsertionModeStack[0];return}case h.HTML:{this.insertionMode=this.headElement?v.AFTER_HEAD:v.BEFORE_HEAD;return}case h.TD:case h.TH:{if(e>0){this.insertionMode=v.IN_CELL;return}break}case h.HEAD:{if(e>0){this.insertionMode=v.IN_HEAD;return}break}}this.insertionMode=v.IN_BODY}_resetInsertionModeForSelect(e){if(e>0)for(let n=e-1;n>0;n--){const r=this.openElements.tagIDs[n];if(r===h.TEMPLATE)break;if(r===h.TABLE){this.insertionMode=v.IN_SELECT_IN_TABLE;return}}this.insertionMode=v.IN_SELECT}_isElementCausesFosterParenting(e){return zw.has(e)}_shouldFosterParentOnInsertion(){return this.fosterParentingEnabled&&this._isElementCausesFosterParenting(this.openElements.currentTagId)}_findFosterParentingLocation(){for(let e=this.openElements.stackTop;e>=0;e--){const n=this.openElements.items[e];switch(this.openElements.tagIDs[e]){case h.TEMPLATE:{if(this.treeAdapter.getNamespaceURI(n)===G.HTML)return{parent:this.treeAdapter.getTemplateContent(n),beforeElement:null};break}case h.TABLE:{const r=this.treeAdapter.getParentNode(n);return r?{parent:r,beforeElement:n}:{parent:this.openElements.items[e-1],beforeElement:null}}}}return{parent:this.openElements.items[0],beforeElement:null}}_fosterParentElement(e){const n=this._findFosterParentingLocation();n.beforeElement?this.treeAdapter.insertBefore(n.parent,e,n.beforeElement):this.treeAdapter.appendChild(n.parent,e)}_isSpecialElement(e,n){const r=this.treeAdapter.getNamespaceURI(e);return w5[r].has(n)}onCharacter(e){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){x9(this,e);return}switch(this.insertionMode){case v.INITIAL:{Ga(this,e);break}case v.BEFORE_HTML:{bi(this,e);break}case v.BEFORE_HEAD:{_i(this,e);break}case v.IN_HEAD:{yi(this,e);break}case v.IN_HEAD_NO_SCRIPT:{Ei(this,e);break}case v.AFTER_HEAD:{wi(this,e);break}case v.IN_BODY:case v.IN_CAPTION:case v.IN_CELL:case v.IN_TEMPLATE:{Kw(this,e);break}case v.TEXT:case v.IN_SELECT:case v.IN_SELECT_IN_TABLE:{this._insertCharacters(e);break}case v.IN_TABLE:case v.IN_TABLE_BODY:case v.IN_ROW:{Nd(this,e);break}case v.IN_TABLE_TEXT:{eT(this,e);break}case v.IN_COLUMN_GROUP:{yc(this,e);break}case v.AFTER_BODY:{Ec(this,e);break}case v.AFTER_AFTER_BODY:{ku(this,e);break}}}onNullCharacter(e){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){P9(this,e);return}switch(this.insertionMode){case v.INITIAL:{Ga(this,e);break}case v.BEFORE_HTML:{bi(this,e);break}case v.BEFORE_HEAD:{_i(this,e);break}case v.IN_HEAD:{yi(this,e);break}case v.IN_HEAD_NO_SCRIPT:{Ei(this,e);break}case v.AFTER_HEAD:{wi(this,e);break}case v.TEXT:{this._insertCharacters(e);break}case v.IN_TABLE:case v.IN_TABLE_BODY:case v.IN_ROW:{Nd(this,e);break}case v.IN_COLUMN_GROUP:{yc(this,e);break}case v.AFTER_BODY:{Ec(this,e);break}case v.AFTER_AFTER_BODY:{ku(this,e);break}}}onComment(e){if(this.skipNextNewLine=!1,this.currentNotInHTML){Kh(this,e);return}switch(this.insertionMode){case v.INITIAL:case v.BEFORE_HTML:case v.BEFORE_HEAD:case v.IN_HEAD:case v.IN_HEAD_NO_SCRIPT:case v.AFTER_HEAD:case v.IN_BODY:case v.IN_TABLE:case v.IN_CAPTION:case v.IN_COLUMN_GROUP:case v.IN_TABLE_BODY:case v.IN_ROW:case v.IN_CELL:case v.IN_SELECT:case v.IN_SELECT_IN_TABLE:case v.IN_TEMPLATE:case v.IN_FRAMESET:case v.AFTER_FRAMESET:{Kh(this,e);break}case v.IN_TABLE_TEXT:{Ka(this,e);break}case v.AFTER_BODY:{lB(this,e);break}case v.AFTER_AFTER_BODY:case v.AFTER_AFTER_FRAMESET:{dB(this,e);break}}}onDoctype(e){switch(this.skipNextNewLine=!1,this.insertionMode){case v.INITIAL:{hB(this,e);break}case v.BEFORE_HEAD:case v.IN_HEAD:case v.IN_HEAD_NO_SCRIPT:case v.AFTER_HEAD:{this._err(e,j.misplacedDoctype);break}case v.IN_TABLE_TEXT:{Ka(this,e);break}}}onStartTag(e){this.skipNextNewLine=!1,this.currentToken=e,this._processStartTag(e),e.selfClosing&&!e.ackSelfClosing&&this._err(e,j.nonVoidHtmlElementStartTagWithTrailingSolidus)}_processStartTag(e){this.shouldProcessStartTagTokenInForeignContent(e)?L9(this,e):this._startTagOutsideForeignContent(e)}_startTagOutsideForeignContent(e){switch(this.insertionMode){case v.INITIAL:{Ga(this,e);break}case v.BEFORE_HTML:{fB(this,e);break}case v.BEFORE_HEAD:{pB(this,e);break}case v.IN_HEAD:{Jn(this,e);break}case v.IN_HEAD_NO_SCRIPT:{_B(this,e);break}case v.AFTER_HEAD:{EB(this,e);break}case v.IN_BODY:{Ft(this,e);break}case v.IN_TABLE:{ga(this,e);break}case v.IN_TABLE_TEXT:{Ka(this,e);break}case v.IN_CAPTION:{g9(this,e);break}case v.IN_COLUMN_GROUP:{Lm(this,e);break}case v.IN_TABLE_BODY:{ml(this,e);break}case v.IN_ROW:{pl(this,e);break}case v.IN_CELL:{y9(this,e);break}case v.IN_SELECT:{rT(this,e);break}case v.IN_SELECT_IN_TABLE:{w9(this,e);break}case v.IN_TEMPLATE:{S9(this,e);break}case v.AFTER_BODY:{C9(this,e);break}case v.IN_FRAMESET:{v9(this,e);break}case v.AFTER_FRAMESET:{I9(this,e);break}case v.AFTER_AFTER_BODY:{N9(this,e);break}case v.AFTER_AFTER_FRAMESET:{R9(this,e);break}}}onEndTag(e){this.skipNextNewLine=!1,this.currentToken=e,this.currentNotInHTML?D9(this,e):this._endTagOutsideForeignContent(e)}_endTagOutsideForeignContent(e){switch(this.insertionMode){case v.INITIAL:{Ga(this,e);break}case v.BEFORE_HTML:{mB(this,e);break}case v.BEFORE_HEAD:{gB(this,e);break}case v.IN_HEAD:{bB(this,e);break}case v.IN_HEAD_NO_SCRIPT:{yB(this,e);break}case v.AFTER_HEAD:{wB(this,e);break}case v.IN_BODY:{fl(this,e);break}case v.TEXT:{i9(this,e);break}case v.IN_TABLE:{Xi(this,e);break}case v.IN_TABLE_TEXT:{Ka(this,e);break}case v.IN_CAPTION:{b9(this,e);break}case v.IN_COLUMN_GROUP:{_9(this,e);break}case v.IN_TABLE_BODY:{Yh(this,e);break}case v.IN_ROW:{nT(this,e);break}case v.IN_CELL:{E9(this,e);break}case v.IN_SELECT:{sT(this,e);break}case v.IN_SELECT_IN_TABLE:{T9(this,e);break}case v.IN_TEMPLATE:{A9(this,e);break}case v.AFTER_BODY:{iT(this,e);break}case v.IN_FRAMESET:{O9(this,e);break}case v.AFTER_FRAMESET:{k9(this,e);break}case v.AFTER_AFTER_BODY:{ku(this,e);break}}}onEof(e){switch(this.insertionMode){case v.INITIAL:{Ga(this,e);break}case v.BEFORE_HTML:{bi(this,e);break}case v.BEFORE_HEAD:{_i(this,e);break}case v.IN_HEAD:{yi(this,e);break}case v.IN_HEAD_NO_SCRIPT:{Ei(this,e);break}case v.AFTER_HEAD:{wi(this,e);break}case v.IN_BODY:case v.IN_TABLE:case v.IN_CAPTION:case v.IN_COLUMN_GROUP:case v.IN_TABLE_BODY:case v.IN_ROW:case v.IN_CELL:case v.IN_SELECT:case v.IN_SELECT_IN_TABLE:{Xw(this,e);break}case v.TEXT:{o9(this,e);break}case v.IN_TABLE_TEXT:{Ka(this,e);break}case v.IN_TEMPLATE:{aT(this,e);break}case v.AFTER_BODY:case v.IN_FRAMESET:case v.AFTER_FRAMESET:case v.AFTER_AFTER_BODY:case v.AFTER_AFTER_FRAMESET:{xm(this,e);break}}}onWhitespaceCharacter(e){if(this.skipNextNewLine&&(this.skipNextNewLine=!1,e.chars.charCodeAt(0)===T.LINE_FEED)){if(e.chars.length===1)return;e.chars=e.chars.substr(1)}if(this.tokenizer.inForeignNode){this._insertCharacters(e);return}switch(this.insertionMode){case v.IN_HEAD:case v.IN_HEAD_NO_SCRIPT:case v.AFTER_HEAD:case v.TEXT:case v.IN_COLUMN_GROUP:case v.IN_SELECT:case v.IN_SELECT_IN_TABLE:case v.IN_FRAMESET:case v.AFTER_FRAMESET:{this._insertCharacters(e);break}case v.IN_BODY:case v.IN_CAPTION:case v.IN_CELL:case v.IN_TEMPLATE:case v.AFTER_BODY:case v.AFTER_AFTER_BODY:case v.AFTER_AFTER_FRAMESET:{Gw(this,e);break}case v.IN_TABLE:case v.IN_TABLE_BODY:case v.IN_ROW:{Nd(this,e);break}case v.IN_TABLE_TEXT:{Qw(this,e);break}}}};function sB(t,e){let n=t.activeFormattingElements.getElementEntryInScopeWithTagName(e.tagName);return n?t.openElements.contains(n.element)?t.openElements.hasInScope(e.tagID)||(n=null):(t.activeFormattingElements.removeEntry(n),n=null):Jw(t,e),n}function aB(t,e){let n=null,r=t.openElements.stackTop;for(;r>=0;r--){const s=t.openElements.items[r];if(s===e.element)break;t._isSpecialElement(s,t.openElements.tagIDs[r])&&(n=s)}return n||(t.openElements.shortenToLength(r<0?0:r),t.activeFormattingElements.removeEntry(e)),n}function iB(t,e,n){let r=e,s=t.openElements.getCommonAncestor(e);for(let a=0,i=s;i!==n;a++,i=s){s=t.openElements.getCommonAncestor(i);const o=t.activeFormattingElements.getElementEntry(i),u=o&&a>=nB;!o||u?(u&&t.activeFormattingElements.removeEntry(o),t.openElements.remove(i)):(i=oB(t,o),r===e&&(t.activeFormattingElements.bookmark=o),t.treeAdapter.detachNode(r),t.treeAdapter.appendChild(i,r),r=i)}return r}function oB(t,e){const n=t.treeAdapter.getNamespaceURI(e.element),r=t.treeAdapter.createElement(e.token.tagName,n,e.token.attrs);return t.openElements.replace(e.element,r),e.element=r,r}function uB(t,e,n){const r=t.treeAdapter.getTagName(e),s=dl(r);if(t._isElementCausesFosterParenting(s))t._fosterParentElement(n);else{const a=t.treeAdapter.getNamespaceURI(e);s===h.TEMPLATE&&a===G.HTML&&(e=t.treeAdapter.getTemplateContent(e)),t.treeAdapter.appendChild(e,n)}}function cB(t,e,n){const r=t.treeAdapter.getNamespaceURI(n.element),{token:s}=n,a=t.treeAdapter.createElement(s.tagName,r,s.attrs);t._adoptNodes(e,a),t.treeAdapter.appendChild(e,a),t.activeFormattingElements.insertElementAfterBookmark(a,s),t.activeFormattingElements.removeEntry(n),t.openElements.remove(n.element),t.openElements.insertAfter(e,a,s.tagID)}function Pm(t,e){for(let n=0;n<tB;n++){const r=sB(t,e);if(!r)break;const s=aB(t,r);if(!s)break;t.activeFormattingElements.bookmark=r;const a=iB(t,s,r.element),i=t.openElements.getCommonAncestor(r.element);t.treeAdapter.detachNode(a),i&&uB(t,i,a),cB(t,s,r)}}function Kh(t,e){t._appendCommentNode(e,t.openElements.currentTmplContentOrNode)}function lB(t,e){t._appendCommentNode(e,t.openElements.items[0])}function dB(t,e){t._appendCommentNode(e,t.document)}function xm(t,e){if(t.stopped=!0,e.location){const n=t.fragmentContext?0:2;for(let r=t.openElements.stackTop;r>=n;r--)t._setEndLocation(t.openElements.items[r],e);if(!t.fragmentContext&&t.openElements.stackTop>=0){const r=t.openElements.items[0],s=t.treeAdapter.getNodeSourceCodeLocation(r);if(s&&!s.endTag&&(t._setEndLocation(r,e),t.openElements.stackTop>=1)){const a=t.openElements.items[1],i=t.treeAdapter.getNodeSourceCodeLocation(a);i&&!i.endTag&&t._setEndLocation(a,e)}}}}function hB(t,e){t._setDocumentType(e);const n=e.forceQuirks?fn.QUIRKS:$5(e);H5(e)||t._err(e,j.nonConformingDoctype),t.treeAdapter.setDocumentMode(t.document,n),t.insertionMode=v.BEFORE_HTML}function Ga(t,e){t._err(e,j.missingDoctype,!0),t.treeAdapter.setDocumentMode(t.document,fn.QUIRKS),t.insertionMode=v.BEFORE_HTML,t._processToken(e)}function fB(t,e){e.tagID===h.HTML?(t._insertElement(e,G.HTML),t.insertionMode=v.BEFORE_HEAD):bi(t,e)}function mB(t,e){const n=e.tagID;(n===h.HTML||n===h.HEAD||n===h.BODY||n===h.BR)&&bi(t,e)}function bi(t,e){t._insertFakeRootElement(),t.insertionMode=v.BEFORE_HEAD,t._processToken(e)}function pB(t,e){switch(e.tagID){case h.HTML:{Ft(t,e);break}case h.HEAD:{t._insertElement(e,G.HTML),t.headElement=t.openElements.current,t.insertionMode=v.IN_HEAD;break}default:_i(t,e)}}function gB(t,e){const n=e.tagID;n===h.HEAD||n===h.BODY||n===h.HTML||n===h.BR?_i(t,e):t._err(e,j.endTagWithoutMatchingOpenElement)}function _i(t,e){t._insertFakeElement(R.HEAD,h.HEAD),t.headElement=t.openElements.current,t.insertionMode=v.IN_HEAD,t._processToken(e)}function Jn(t,e){switch(e.tagID){case h.HTML:{Ft(t,e);break}case h.BASE:case h.BASEFONT:case h.BGSOUND:case h.LINK:case h.META:{t._appendElement(e,G.HTML),e.ackSelfClosing=!0;break}case h.TITLE:{t._switchToTextParsing(e,Qt.RCDATA);break}case h.NOSCRIPT:{t.options.scriptingEnabled?t._switchToTextParsing(e,Qt.RAWTEXT):(t._insertElement(e,G.HTML),t.insertionMode=v.IN_HEAD_NO_SCRIPT);break}case h.NOFRAMES:case h.STYLE:{t._switchToTextParsing(e,Qt.RAWTEXT);break}case h.SCRIPT:{t._switchToTextParsing(e,Qt.SCRIPT_DATA);break}case h.TEMPLATE:{t._insertTemplate(e),t.activeFormattingElements.insertMarker(),t.framesetOk=!1,t.insertionMode=v.IN_TEMPLATE,t.tmplInsertionModeStack.unshift(v.IN_TEMPLATE);break}case h.HEAD:{t._err(e,j.misplacedStartTagForHeadElement);break}default:yi(t,e)}}function bB(t,e){switch(e.tagID){case h.HEAD:{t.openElements.pop(),t.insertionMode=v.AFTER_HEAD;break}case h.BODY:case h.BR:case h.HTML:{yi(t,e);break}case h.TEMPLATE:{xs(t,e);break}default:t._err(e,j.endTagWithoutMatchingOpenElement)}}function xs(t,e){t.openElements.tmplCount>0?(t.openElements.generateImpliedEndTagsThoroughly(),t.openElements.currentTagId!==h.TEMPLATE&&t._err(e,j.closingOfElementWithOpenChildElements),t.openElements.popUntilTagNamePopped(h.TEMPLATE),t.activeFormattingElements.clearToLastMarker(),t.tmplInsertionModeStack.shift(),t._resetInsertionMode()):t._err(e,j.endTagWithoutMatchingOpenElement)}function yi(t,e){t.openElements.pop(),t.insertionMode=v.AFTER_HEAD,t._processToken(e)}function _B(t,e){switch(e.tagID){case h.HTML:{Ft(t,e);break}case h.BASEFONT:case h.BGSOUND:case h.HEAD:case h.LINK:case h.META:case h.NOFRAMES:case h.STYLE:{Jn(t,e);break}case h.NOSCRIPT:{t._err(e,j.nestedNoscriptInHead);break}default:Ei(t,e)}}function yB(t,e){switch(e.tagID){case h.NOSCRIPT:{t.openElements.pop(),t.insertionMode=v.IN_HEAD;break}case h.BR:{Ei(t,e);break}default:t._err(e,j.endTagWithoutMatchingOpenElement)}}function Ei(t,e){const n=e.type===je.EOF?j.openElementsLeftAfterEof:j.disallowedContentInNoscriptInHead;t._err(e,n),t.openElements.pop(),t.insertionMode=v.IN_HEAD,t._processToken(e)}function EB(t,e){switch(e.tagID){case h.HTML:{Ft(t,e);break}case h.BODY:{t._insertElement(e,G.HTML),t.framesetOk=!1,t.insertionMode=v.IN_BODY;break}case h.FRAMESET:{t._insertElement(e,G.HTML),t.insertionMode=v.IN_FRAMESET;break}case h.BASE:case h.BASEFONT:case h.BGSOUND:case h.LINK:case h.META:case h.NOFRAMES:case h.SCRIPT:case h.STYLE:case h.TEMPLATE:case h.TITLE:{t._err(e,j.abandonedHeadElementChild),t.openElements.push(t.headElement,h.HEAD),Jn(t,e),t.openElements.remove(t.headElement);break}case h.HEAD:{t._err(e,j.misplacedStartTagForHeadElement);break}default:wi(t,e)}}function wB(t,e){switch(e.tagID){case h.BODY:case h.HTML:case h.BR:{wi(t,e);break}case h.TEMPLATE:{xs(t,e);break}default:t._err(e,j.endTagWithoutMatchingOpenElement)}}function wi(t,e){t._insertFakeElement(R.BODY,h.BODY),t.insertionMode=v.IN_BODY,hl(t,e)}function hl(t,e){switch(e.type){case je.CHARACTER:{Kw(t,e);break}case je.WHITESPACE_CHARACTER:{Gw(t,e);break}case je.COMMENT:{Kh(t,e);break}case je.START_TAG:{Ft(t,e);break}case je.END_TAG:{fl(t,e);break}case je.EOF:{Xw(t,e);break}}}function Gw(t,e){t._reconstructActiveFormattingElements(),t._insertCharacters(e)}function Kw(t,e){t._reconstructActiveFormattingElements(),t._insertCharacters(e),t.framesetOk=!1}function TB(t,e){t.openElements.tmplCount===0&&t.treeAdapter.adoptAttributes(t.openElements.items[0],e.attrs)}function SB(t,e){const n=t.openElements.tryPeekProperlyNestedBodyElement();n&&t.openElements.tmplCount===0&&(t.framesetOk=!1,t.treeAdapter.adoptAttributes(n,e.attrs))}function AB(t,e){const n=t.openElements.tryPeekProperlyNestedBodyElement();t.framesetOk&&n&&(t.treeAdapter.detachNode(n),t.openElements.popAllUpToHtmlElement(),t._insertElement(e,G.HTML),t.insertionMode=v.IN_FRAMESET)}function CB(t,e){t.openElements.hasInButtonScope(h.P)&&t._closePElement(),t._insertElement(e,G.HTML)}function vB(t,e){t.openElements.hasInButtonScope(h.P)&&t._closePElement(),Gh.has(t.openElements.currentTagId)&&t.openElements.pop(),t._insertElement(e,G.HTML)}function OB(t,e){t.openElements.hasInButtonScope(h.P)&&t._closePElement(),t._insertElement(e,G.HTML),t.skipNextNewLine=!0,t.framesetOk=!1}function IB(t,e){const n=t.openElements.tmplCount>0;(!t.formElement||n)&&(t.openElements.hasInButtonScope(h.P)&&t._closePElement(),t._insertElement(e,G.HTML),n||(t.formElement=t.openElements.current))}function kB(t,e){t.framesetOk=!1;const n=e.tagID;for(let r=t.openElements.stackTop;r>=0;r--){const s=t.openElements.tagIDs[r];if(n===h.LI&&s===h.LI||(n===h.DD||n===h.DT)&&(s===h.DD||s===h.DT)){t.openElements.generateImpliedEndTagsWithExclusion(s),t.openElements.popUntilTagNamePopped(s);break}if(s!==h.ADDRESS&&s!==h.DIV&&s!==h.P&&t._isSpecialElement(t.openElements.items[r],s))break}t.openElements.hasInButtonScope(h.P)&&t._closePElement(),t._insertElement(e,G.HTML)}function NB(t,e){t.openElements.hasInButtonScope(h.P)&&t._closePElement(),t._insertElement(e,G.HTML),t.tokenizer.state=Qt.PLAINTEXT}function RB(t,e){t.openElements.hasInScope(h.BUTTON)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(h.BUTTON)),t._reconstructActiveFormattingElements(),t._insertElement(e,G.HTML),t.framesetOk=!1}function PB(t,e){const n=t.activeFormattingElements.getElementEntryInScopeWithTagName(R.A);n&&(Pm(t,e),t.openElements.remove(n.element),t.activeFormattingElements.removeEntry(n)),t._reconstructActiveFormattingElements(),t._insertElement(e,G.HTML),t.activeFormattingElements.pushElement(t.openElements.current,e)}function xB(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,G.HTML),t.activeFormattingElements.pushElement(t.openElements.current,e)}function LB(t,e){t._reconstructActiveFormattingElements(),t.openElements.hasInScope(h.NOBR)&&(Pm(t,e),t._reconstructActiveFormattingElements()),t._insertElement(e,G.HTML),t.activeFormattingElements.pushElement(t.openElements.current,e)}function DB(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,G.HTML),t.activeFormattingElements.insertMarker(),t.framesetOk=!1}function MB(t,e){t.treeAdapter.getDocumentMode(t.document)!==fn.QUIRKS&&t.openElements.hasInButtonScope(h.P)&&t._closePElement(),t._insertElement(e,G.HTML),t.framesetOk=!1,t.insertionMode=v.IN_TABLE}function Yw(t,e){t._reconstructActiveFormattingElements(),t._appendElement(e,G.HTML),t.framesetOk=!1,e.ackSelfClosing=!0}function Zw(t){const e=Bw(t,gs.TYPE);return e!=null&&e.toLowerCase()===eB}function BB(t,e){t._reconstructActiveFormattingElements(),t._appendElement(e,G.HTML),Zw(e)||(t.framesetOk=!1),e.ackSelfClosing=!0}function FB(t,e){t._appendElement(e,G.HTML),e.ackSelfClosing=!0}function UB(t,e){t.openElements.hasInButtonScope(h.P)&&t._closePElement(),t._appendElement(e,G.HTML),t.framesetOk=!1,e.ackSelfClosing=!0}function jB(t,e){e.tagName=R.IMG,e.tagID=h.IMG,Yw(t,e)}function HB(t,e){t._insertElement(e,G.HTML),t.skipNextNewLine=!0,t.tokenizer.state=Qt.RCDATA,t.originalInsertionMode=t.insertionMode,t.framesetOk=!1,t.insertionMode=v.TEXT}function $B(t,e){t.openElements.hasInButtonScope(h.P)&&t._closePElement(),t._reconstructActiveFormattingElements(),t.framesetOk=!1,t._switchToTextParsing(e,Qt.RAWTEXT)}function qB(t,e){t.framesetOk=!1,t._switchToTextParsing(e,Qt.RAWTEXT)}function ub(t,e){t._switchToTextParsing(e,Qt.RAWTEXT)}function VB(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,G.HTML),t.framesetOk=!1,t.insertionMode=t.insertionMode===v.IN_TABLE||t.insertionMode===v.IN_CAPTION||t.insertionMode===v.IN_TABLE_BODY||t.insertionMode===v.IN_ROW||t.insertionMode===v.IN_CELL?v.IN_SELECT_IN_TABLE:v.IN_SELECT}function zB(t,e){t.openElements.currentTagId===h.OPTION&&t.openElements.pop(),t._reconstructActiveFormattingElements(),t._insertElement(e,G.HTML)}function WB(t,e){t.openElements.hasInScope(h.RUBY)&&t.openElements.generateImpliedEndTags(),t._insertElement(e,G.HTML)}function GB(t,e){t.openElements.hasInScope(h.RUBY)&&t.openElements.generateImpliedEndTagsWithExclusion(h.RTC),t._insertElement(e,G.HTML)}function KB(t,e){t._reconstructActiveFormattingElements(),qw(e),Rm(e),e.selfClosing?t._appendElement(e,G.MATHML):t._insertElement(e,G.MATHML),e.ackSelfClosing=!0}function YB(t,e){t._reconstructActiveFormattingElements(),Vw(e),Rm(e),e.selfClosing?t._appendElement(e,G.SVG):t._insertElement(e,G.SVG),e.ackSelfClosing=!0}function cb(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,G.HTML)}function Ft(t,e){switch(e.tagID){case h.I:case h.S:case h.B:case h.U:case h.EM:case h.TT:case h.BIG:case h.CODE:case h.FONT:case h.SMALL:case h.STRIKE:case h.STRONG:{xB(t,e);break}case h.A:{PB(t,e);break}case h.H1:case h.H2:case h.H3:case h.H4:case h.H5:case h.H6:{vB(t,e);break}case h.P:case h.DL:case h.OL:case h.UL:case h.DIV:case h.DIR:case h.NAV:case h.MAIN:case h.MENU:case h.ASIDE:case h.CENTER:case h.FIGURE:case h.FOOTER:case h.HEADER:case h.HGROUP:case h.DIALOG:case h.DETAILS:case h.ADDRESS:case h.ARTICLE:case h.SEARCH:case h.SECTION:case h.SUMMARY:case h.FIELDSET:case h.BLOCKQUOTE:case h.FIGCAPTION:{CB(t,e);break}case h.LI:case h.DD:case h.DT:{kB(t,e);break}case h.BR:case h.IMG:case h.WBR:case h.AREA:case h.EMBED:case h.KEYGEN:{Yw(t,e);break}case h.HR:{UB(t,e);break}case h.RB:case h.RTC:{WB(t,e);break}case h.RT:case h.RP:{GB(t,e);break}case h.PRE:case h.LISTING:{OB(t,e);break}case h.XMP:{$B(t,e);break}case h.SVG:{YB(t,e);break}case h.HTML:{TB(t,e);break}case h.BASE:case h.LINK:case h.META:case h.STYLE:case h.TITLE:case h.SCRIPT:case h.BGSOUND:case h.BASEFONT:case h.TEMPLATE:{Jn(t,e);break}case h.BODY:{SB(t,e);break}case h.FORM:{IB(t,e);break}case h.NOBR:{LB(t,e);break}case h.MATH:{KB(t,e);break}case h.TABLE:{MB(t,e);break}case h.INPUT:{BB(t,e);break}case h.PARAM:case h.TRACK:case h.SOURCE:{FB(t,e);break}case h.IMAGE:{jB(t,e);break}case h.BUTTON:{RB(t,e);break}case h.APPLET:case h.OBJECT:case h.MARQUEE:{DB(t,e);break}case h.IFRAME:{qB(t,e);break}case h.SELECT:{VB(t,e);break}case h.OPTION:case h.OPTGROUP:{zB(t,e);break}case h.NOEMBED:case h.NOFRAMES:{ub(t,e);break}case h.FRAMESET:{AB(t,e);break}case h.TEXTAREA:{HB(t,e);break}case h.NOSCRIPT:{t.options.scriptingEnabled?ub(t,e):cb(t,e);break}case h.PLAINTEXT:{NB(t,e);break}case h.COL:case h.TH:case h.TD:case h.TR:case h.HEAD:case h.FRAME:case h.TBODY:case h.TFOOT:case h.THEAD:case h.CAPTION:case h.COLGROUP:break;default:cb(t,e)}}function ZB(t,e){if(t.openElements.hasInScope(h.BODY)&&(t.insertionMode=v.AFTER_BODY,t.options.sourceCodeLocationInfo)){const n=t.openElements.tryPeekProperlyNestedBodyElement();n&&t._setEndLocation(n,e)}}function JB(t,e){t.openElements.hasInScope(h.BODY)&&(t.insertionMode=v.AFTER_BODY,iT(t,e))}function XB(t,e){const n=e.tagID;t.openElements.hasInScope(n)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(n))}function QB(t){const e=t.openElements.tmplCount>0,{formElement:n}=t;e||(t.formElement=null),(n||e)&&t.openElements.hasInScope(h.FORM)&&(t.openElements.generateImpliedEndTags(),e?t.openElements.popUntilTagNamePopped(h.FORM):n&&t.openElements.remove(n))}function e9(t){t.openElements.hasInButtonScope(h.P)||t._insertFakeElement(R.P,h.P),t._closePElement()}function t9(t){t.openElements.hasInListItemScope(h.LI)&&(t.openElements.generateImpliedEndTagsWithExclusion(h.LI),t.openElements.popUntilTagNamePopped(h.LI))}function n9(t,e){const n=e.tagID;t.openElements.hasInScope(n)&&(t.openElements.generateImpliedEndTagsWithExclusion(n),t.openElements.popUntilTagNamePopped(n))}function r9(t){t.openElements.hasNumberedHeaderInScope()&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilNumberedHeaderPopped())}function s9(t,e){const n=e.tagID;t.openElements.hasInScope(n)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(n),t.activeFormattingElements.clearToLastMarker())}function a9(t){t._reconstructActiveFormattingElements(),t._insertFakeElement(R.BR,h.BR),t.openElements.pop(),t.framesetOk=!1}function Jw(t,e){const n=e.tagName,r=e.tagID;for(let s=t.openElements.stackTop;s>0;s--){const a=t.openElements.items[s],i=t.openElements.tagIDs[s];if(r===i&&(r!==h.UNKNOWN||t.treeAdapter.getTagName(a)===n)){t.openElements.generateImpliedEndTagsWithExclusion(r),t.openElements.stackTop>=s&&t.openElements.shortenToLength(s);break}if(t._isSpecialElement(a,i))break}}function fl(t,e){switch(e.tagID){case h.A:case h.B:case h.I:case h.S:case h.U:case h.EM:case h.TT:case h.BIG:case h.CODE:case h.FONT:case h.NOBR:case h.SMALL:case h.STRIKE:case h.STRONG:{Pm(t,e);break}case h.P:{e9(t);break}case h.DL:case h.UL:case h.OL:case h.DIR:case h.DIV:case h.NAV:case h.PRE:case h.MAIN:case h.MENU:case h.ASIDE:case h.BUTTON:case h.CENTER:case h.FIGURE:case h.FOOTER:case h.HEADER:case h.HGROUP:case h.DIALOG:case h.ADDRESS:case h.ARTICLE:case h.DETAILS:case h.SEARCH:case h.SECTION:case h.SUMMARY:case h.LISTING:case h.FIELDSET:case h.BLOCKQUOTE:case h.FIGCAPTION:{XB(t,e);break}case h.LI:{t9(t);break}case h.DD:case h.DT:{n9(t,e);break}case h.H1:case h.H2:case h.H3:case h.H4:case h.H5:case h.H6:{r9(t);break}case h.BR:{a9(t);break}case h.BODY:{ZB(t,e);break}case h.HTML:{JB(t,e);break}case h.FORM:{QB(t);break}case h.APPLET:case h.OBJECT:case h.MARQUEE:{s9(t,e);break}case h.TEMPLATE:{xs(t,e);break}default:Jw(t,e)}}function Xw(t,e){t.tmplInsertionModeStack.length>0?aT(t,e):xm(t,e)}function i9(t,e){var n;e.tagID===h.SCRIPT&&((n=t.scriptHandler)===null||n===void 0||n.call(t,t.openElements.current)),t.openElements.pop(),t.insertionMode=t.originalInsertionMode}function o9(t,e){t._err(e,j.eofInElementThatCanContainOnlyText),t.openElements.pop(),t.insertionMode=t.originalInsertionMode,t.onEof(e)}function Nd(t,e){if(zw.has(t.openElements.currentTagId))switch(t.pendingCharacterTokens.length=0,t.hasNonWhitespacePendingCharacterToken=!1,t.originalInsertionMode=t.insertionMode,t.insertionMode=v.IN_TABLE_TEXT,e.type){case je.CHARACTER:{eT(t,e);break}case je.WHITESPACE_CHARACTER:{Qw(t,e);break}}else Co(t,e)}function u9(t,e){t.openElements.clearBackToTableContext(),t.activeFormattingElements.insertMarker(),t._insertElement(e,G.HTML),t.insertionMode=v.IN_CAPTION}function c9(t,e){t.openElements.clearBackToTableContext(),t._insertElement(e,G.HTML),t.insertionMode=v.IN_COLUMN_GROUP}function l9(t,e){t.openElements.clearBackToTableContext(),t._insertFakeElement(R.COLGROUP,h.COLGROUP),t.insertionMode=v.IN_COLUMN_GROUP,Lm(t,e)}function d9(t,e){t.openElements.clearBackToTableContext(),t._insertElement(e,G.HTML),t.insertionMode=v.IN_TABLE_BODY}function h9(t,e){t.openElements.clearBackToTableContext(),t._insertFakeElement(R.TBODY,h.TBODY),t.insertionMode=v.IN_TABLE_BODY,ml(t,e)}function f9(t,e){t.openElements.hasInTableScope(h.TABLE)&&(t.openElements.popUntilTagNamePopped(h.TABLE),t._resetInsertionMode(),t._processStartTag(e))}function m9(t,e){Zw(e)?t._appendElement(e,G.HTML):Co(t,e),e.ackSelfClosing=!0}function p9(t,e){!t.formElement&&t.openElements.tmplCount===0&&(t._insertElement(e,G.HTML),t.formElement=t.openElements.current,t.openElements.pop())}function ga(t,e){switch(e.tagID){case h.TD:case h.TH:case h.TR:{h9(t,e);break}case h.STYLE:case h.SCRIPT:case h.TEMPLATE:{Jn(t,e);break}case h.COL:{l9(t,e);break}case h.FORM:{p9(t,e);break}case h.TABLE:{f9(t,e);break}case h.TBODY:case h.TFOOT:case h.THEAD:{d9(t,e);break}case h.INPUT:{m9(t,e);break}case h.CAPTION:{u9(t,e);break}case h.COLGROUP:{c9(t,e);break}default:Co(t,e)}}function Xi(t,e){switch(e.tagID){case h.TABLE:{t.openElements.hasInTableScope(h.TABLE)&&(t.openElements.popUntilTagNamePopped(h.TABLE),t._resetInsertionMode());break}case h.TEMPLATE:{xs(t,e);break}case h.BODY:case h.CAPTION:case h.COL:case h.COLGROUP:case h.HTML:case h.TBODY:case h.TD:case h.TFOOT:case h.TH:case h.THEAD:case h.TR:break;default:Co(t,e)}}function Co(t,e){const n=t.fosterParentingEnabled;t.fosterParentingEnabled=!0,hl(t,e),t.fosterParentingEnabled=n}function Qw(t,e){t.pendingCharacterTokens.push(e)}function eT(t,e){t.pendingCharacterTokens.push(e),t.hasNonWhitespacePendingCharacterToken=!0}function Ka(t,e){let n=0;if(t.hasNonWhitespacePendingCharacterToken)for(;n<t.pendingCharacterTokens.length;n++)Co(t,t.pendingCharacterTokens[n]);else for(;n<t.pendingCharacterTokens.length;n++)t._insertCharacters(t.pendingCharacterTokens[n]);t.insertionMode=t.originalInsertionMode,t._processToken(e)}const tT=new Set([h.CAPTION,h.COL,h.COLGROUP,h.TBODY,h.TD,h.TFOOT,h.TH,h.THEAD,h.TR]);function g9(t,e){const n=e.tagID;tT.has(n)?t.openElements.hasInTableScope(h.CAPTION)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(h.CAPTION),t.activeFormattingElements.clearToLastMarker(),t.insertionMode=v.IN_TABLE,ga(t,e)):Ft(t,e)}function b9(t,e){const n=e.tagID;switch(n){case h.CAPTION:case h.TABLE:{t.openElements.hasInTableScope(h.CAPTION)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(h.CAPTION),t.activeFormattingElements.clearToLastMarker(),t.insertionMode=v.IN_TABLE,n===h.TABLE&&Xi(t,e));break}case h.BODY:case h.COL:case h.COLGROUP:case h.HTML:case h.TBODY:case h.TD:case h.TFOOT:case h.TH:case h.THEAD:case h.TR:break;default:fl(t,e)}}function Lm(t,e){switch(e.tagID){case h.HTML:{Ft(t,e);break}case h.COL:{t._appendElement(e,G.HTML),e.ackSelfClosing=!0;break}case h.TEMPLATE:{Jn(t,e);break}default:yc(t,e)}}function _9(t,e){switch(e.tagID){case h.COLGROUP:{t.openElements.currentTagId===h.COLGROUP&&(t.openElements.pop(),t.insertionMode=v.IN_TABLE);break}case h.TEMPLATE:{xs(t,e);break}case h.COL:break;default:yc(t,e)}}function yc(t,e){t.openElements.currentTagId===h.COLGROUP&&(t.openElements.pop(),t.insertionMode=v.IN_TABLE,t._processToken(e))}function ml(t,e){switch(e.tagID){case h.TR:{t.openElements.clearBackToTableBodyContext(),t._insertElement(e,G.HTML),t.insertionMode=v.IN_ROW;break}case h.TH:case h.TD:{t.openElements.clearBackToTableBodyContext(),t._insertFakeElement(R.TR,h.TR),t.insertionMode=v.IN_ROW,pl(t,e);break}case h.CAPTION:case h.COL:case h.COLGROUP:case h.TBODY:case h.TFOOT:case h.THEAD:{t.openElements.hasTableBodyContextInTableScope()&&(t.openElements.clearBackToTableBodyContext(),t.openElements.pop(),t.insertionMode=v.IN_TABLE,ga(t,e));break}default:ga(t,e)}}function Yh(t,e){const n=e.tagID;switch(e.tagID){case h.TBODY:case h.TFOOT:case h.THEAD:{t.openElements.hasInTableScope(n)&&(t.openElements.clearBackToTableBodyContext(),t.openElements.pop(),t.insertionMode=v.IN_TABLE);break}case h.TABLE:{t.openElements.hasTableBodyContextInTableScope()&&(t.openElements.clearBackToTableBodyContext(),t.openElements.pop(),t.insertionMode=v.IN_TABLE,Xi(t,e));break}case h.BODY:case h.CAPTION:case h.COL:case h.COLGROUP:case h.HTML:case h.TD:case h.TH:case h.TR:break;default:Xi(t,e)}}function pl(t,e){switch(e.tagID){case h.TH:case h.TD:{t.openElements.clearBackToTableRowContext(),t._insertElement(e,G.HTML),t.insertionMode=v.IN_CELL,t.activeFormattingElements.insertMarker();break}case h.CAPTION:case h.COL:case h.COLGROUP:case h.TBODY:case h.TFOOT:case h.THEAD:case h.TR:{t.openElements.hasInTableScope(h.TR)&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=v.IN_TABLE_BODY,ml(t,e));break}default:ga(t,e)}}function nT(t,e){switch(e.tagID){case h.TR:{t.openElements.hasInTableScope(h.TR)&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=v.IN_TABLE_BODY);break}case h.TABLE:{t.openElements.hasInTableScope(h.TR)&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=v.IN_TABLE_BODY,Yh(t,e));break}case h.TBODY:case h.TFOOT:case h.THEAD:{(t.openElements.hasInTableScope(e.tagID)||t.openElements.hasInTableScope(h.TR))&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=v.IN_TABLE_BODY,Yh(t,e));break}case h.BODY:case h.CAPTION:case h.COL:case h.COLGROUP:case h.HTML:case h.TD:case h.TH:break;default:Xi(t,e)}}function y9(t,e){const n=e.tagID;tT.has(n)?(t.openElements.hasInTableScope(h.TD)||t.openElements.hasInTableScope(h.TH))&&(t._closeTableCell(),pl(t,e)):Ft(t,e)}function E9(t,e){const n=e.tagID;switch(n){case h.TD:case h.TH:{t.openElements.hasInTableScope(n)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(n),t.activeFormattingElements.clearToLastMarker(),t.insertionMode=v.IN_ROW);break}case h.TABLE:case h.TBODY:case h.TFOOT:case h.THEAD:case h.TR:{t.openElements.hasInTableScope(n)&&(t._closeTableCell(),nT(t,e));break}case h.BODY:case h.CAPTION:case h.COL:case h.COLGROUP:case h.HTML:break;default:fl(t,e)}}function rT(t,e){switch(e.tagID){case h.HTML:{Ft(t,e);break}case h.OPTION:{t.openElements.currentTagId===h.OPTION&&t.openElements.pop(),t._insertElement(e,G.HTML);break}case h.OPTGROUP:{t.openElements.currentTagId===h.OPTION&&t.openElements.pop(),t.openElements.currentTagId===h.OPTGROUP&&t.openElements.pop(),t._insertElement(e,G.HTML);break}case h.HR:{t.openElements.currentTagId===h.OPTION&&t.openElements.pop(),t.openElements.currentTagId===h.OPTGROUP&&t.openElements.pop(),t._appendElement(e,G.HTML),e.ackSelfClosing=!0;break}case h.INPUT:case h.KEYGEN:case h.TEXTAREA:case h.SELECT:{t.openElements.hasInSelectScope(h.SELECT)&&(t.openElements.popUntilTagNamePopped(h.SELECT),t._resetInsertionMode(),e.tagID!==h.SELECT&&t._processStartTag(e));break}case h.SCRIPT:case h.TEMPLATE:{Jn(t,e);break}}}function sT(t,e){switch(e.tagID){case h.OPTGROUP:{t.openElements.stackTop>0&&t.openElements.currentTagId===h.OPTION&&t.openElements.tagIDs[t.openElements.stackTop-1]===h.OPTGROUP&&t.openElements.pop(),t.openElements.currentTagId===h.OPTGROUP&&t.openElements.pop();break}case h.OPTION:{t.openElements.currentTagId===h.OPTION&&t.openElements.pop();break}case h.SELECT:{t.openElements.hasInSelectScope(h.SELECT)&&(t.openElements.popUntilTagNamePopped(h.SELECT),t._resetInsertionMode());break}case h.TEMPLATE:{xs(t,e);break}}}function w9(t,e){const n=e.tagID;n===h.CAPTION||n===h.TABLE||n===h.TBODY||n===h.TFOOT||n===h.THEAD||n===h.TR||n===h.TD||n===h.TH?(t.openElements.popUntilTagNamePopped(h.SELECT),t._resetInsertionMode(),t._processStartTag(e)):rT(t,e)}function T9(t,e){const n=e.tagID;n===h.CAPTION||n===h.TABLE||n===h.TBODY||n===h.TFOOT||n===h.THEAD||n===h.TR||n===h.TD||n===h.TH?t.openElements.hasInTableScope(n)&&(t.openElements.popUntilTagNamePopped(h.SELECT),t._resetInsertionMode(),t.onEndTag(e)):sT(t,e)}function S9(t,e){switch(e.tagID){case h.BASE:case h.BASEFONT:case h.BGSOUND:case h.LINK:case h.META:case h.NOFRAMES:case h.SCRIPT:case h.STYLE:case h.TEMPLATE:case h.TITLE:{Jn(t,e);break}case h.CAPTION:case h.COLGROUP:case h.TBODY:case h.TFOOT:case h.THEAD:{t.tmplInsertionModeStack[0]=v.IN_TABLE,t.insertionMode=v.IN_TABLE,ga(t,e);break}case h.COL:{t.tmplInsertionModeStack[0]=v.IN_COLUMN_GROUP,t.insertionMode=v.IN_COLUMN_GROUP,Lm(t,e);break}case h.TR:{t.tmplInsertionModeStack[0]=v.IN_TABLE_BODY,t.insertionMode=v.IN_TABLE_BODY,ml(t,e);break}case h.TD:case h.TH:{t.tmplInsertionModeStack[0]=v.IN_ROW,t.insertionMode=v.IN_ROW,pl(t,e);break}default:t.tmplInsertionModeStack[0]=v.IN_BODY,t.insertionMode=v.IN_BODY,Ft(t,e)}}function A9(t,e){e.tagID===h.TEMPLATE&&xs(t,e)}function aT(t,e){t.openElements.tmplCount>0?(t.openElements.popUntilTagNamePopped(h.TEMPLATE),t.activeFormattingElements.clearToLastMarker(),t.tmplInsertionModeStack.shift(),t._resetInsertionMode(),t.onEof(e)):xm(t,e)}function C9(t,e){e.tagID===h.HTML?Ft(t,e):Ec(t,e)}function iT(t,e){var n;if(e.tagID===h.HTML){if(t.fragmentContext||(t.insertionMode=v.AFTER_AFTER_BODY),t.options.sourceCodeLocationInfo&&t.openElements.tagIDs[0]===h.HTML){t._setEndLocation(t.openElements.items[0],e);const r=t.openElements.items[1];r&&!(!((n=t.treeAdapter.getNodeSourceCodeLocation(r))===null||n===void 0)&&n.endTag)&&t._setEndLocation(r,e)}}else Ec(t,e)}function Ec(t,e){t.insertionMode=v.IN_BODY,hl(t,e)}function v9(t,e){switch(e.tagID){case h.HTML:{Ft(t,e);break}case h.FRAMESET:{t._insertElement(e,G.HTML);break}case h.FRAME:{t._appendElement(e,G.HTML),e.ackSelfClosing=!0;break}case h.NOFRAMES:{Jn(t,e);break}}}function O9(t,e){e.tagID===h.FRAMESET&&!t.openElements.isRootHtmlElementCurrent()&&(t.openElements.pop(),!t.fragmentContext&&t.openElements.currentTagId!==h.FRAMESET&&(t.insertionMode=v.AFTER_FRAMESET))}function I9(t,e){switch(e.tagID){case h.HTML:{Ft(t,e);break}case h.NOFRAMES:{Jn(t,e);break}}}function k9(t,e){e.tagID===h.HTML&&(t.insertionMode=v.AFTER_AFTER_FRAMESET)}function N9(t,e){e.tagID===h.HTML?Ft(t,e):ku(t,e)}function ku(t,e){t.insertionMode=v.IN_BODY,hl(t,e)}function R9(t,e){switch(e.tagID){case h.HTML:{Ft(t,e);break}case h.NOFRAMES:{Jn(t,e);break}}}function P9(t,e){e.chars=st,t._insertCharacters(e)}function x9(t,e){t._insertCharacters(e),t.framesetOk=!1}function oT(t){for(;t.treeAdapter.getNamespaceURI(t.openElements.current)!==G.HTML&&!t._isIntegrationPoint(t.openElements.currentTagId,t.openElements.current);)t.openElements.pop()}function L9(t,e){if(Y5(e))oT(t),t._startTagOutsideForeignContent(e);else{const n=t._getAdjustedCurrentElement(),r=t.treeAdapter.getNamespaceURI(n);r===G.MATHML?qw(e):r===G.SVG&&(Z5(e),Vw(e)),Rm(e),e.selfClosing?t._appendElement(e,r):t._insertElement(e,r),e.ackSelfClosing=!0}}function D9(t,e){if(e.tagID===h.P||e.tagID===h.BR){oT(t),t._endTagOutsideForeignContent(e);return}for(let n=t.openElements.stackTop;n>0;n--){const r=t.openElements.items[n];if(t.treeAdapter.getNamespaceURI(r)===G.HTML){t._endTagOutsideForeignContent(e);break}const s=t.treeAdapter.getTagName(r);if(s.toLowerCase()===e.tagName){e.tagName=s,t.openElements.shortenToLength(n);break}}}const M9=new Set([R.AREA,R.BASE,R.BASEFONT,R.BGSOUND,R.BR,R.COL,R.EMBED,R.FRAME,R.HR,R.IMG,R.INPUT,R.KEYGEN,R.LINK,R.META,R.PARAM,R.SOURCE,R.TRACK,R.WBR]);function B9(t,e){return e.treeAdapter.isElementNode(t)&&e.treeAdapter.getNamespaceURI(t)===G.HTML&&M9.has(e.treeAdapter.getTagName(t))}const F9={treeAdapter:Ar,scriptingEnabled:!0};function U9(t,e){const n={...F9,...e};return uT(t,n)}function j9(t,e){let n="";const r=e.treeAdapter.isElementNode(t)&&e.treeAdapter.getTagName(t)===R.TEMPLATE&&e.treeAdapter.getNamespaceURI(t)===G.HTML?e.treeAdapter.getTemplateContent(t):t,s=e.treeAdapter.getChildNodes(r);if(s)for(const a of s)n+=uT(a,e);return n}function uT(t,e){return e.treeAdapter.isElementNode(t)?H9(t,e):e.treeAdapter.isTextNode(t)?q9(t,e):e.treeAdapter.isCommentNode(t)?V9(t,e):e.treeAdapter.isDocumentTypeNode(t)?z9(t,e):""}function H9(t,e){const n=e.treeAdapter.getTagName(t);return`<${n}${$9(t,e)}>${B9(t,e)?"":`${j9(t,e)}</${n}>`}`}function $9(t,{treeAdapter:e}){let n="";for(const r of e.getAttrList(t)){if(n+=" ",r.namespace)switch(r.namespace){case G.XML:{n+=`xml:${r.name}`;break}case G.XMLNS:{r.name!=="xmlns"&&(n+="xmlns:"),n+=r.name;break}case G.XLINK:{n+=`xlink:${r.name}`;break}default:n+=`${r.prefix}:${r.name}`}else n+=r.name;n+=`="${QE(r.value)}"`}return n}function q9(t,e){const{treeAdapter:n}=e,r=n.getTextNodeContent(t),s=n.getParentNode(t),a=s&&n.isElementNode(s)&&n.getTagName(s);return a&&n.getNamespaceURI(s)===G.HTML&&S5(a,e.scriptingEnabled)?r:ew(r)}function V9(t,{treeAdapter:e}){return`<!--${e.getCommentNodeContent(t)}-->`}function z9(t,{treeAdapter:e}){return`<!DOCTYPE ${e.getDocumentTypeNodeName(t)}>`}function W9(t,e){return Ww.parse(t,e)}function G9(t,e,n){typeof t=="string"&&(n=e,e=t,t=null);const r=Ww.getFragmentParser(t,n);return r.tokenizer.write(e,!0),r.getFragment()}function lb(t){const e=t.includes('"')?"'":'"';return e+t+e}function K9(t,e,n){let r="!DOCTYPE ";return t&&(r+=t),e?r+=` PUBLIC ${lb(e)}`:n&&(r+=" SYSTEM"),n&&(r+=` ${lb(n)}`),r}const jr={isCommentNode:il,isElementNode:be,isTextNode:mr,createDocument(){const t=new Os([]);return t["x-mode"]=fn.NO_QUIRKS,t},createDocumentFragment(){return new Os([])},createElement(t,e,n){const r=Object.create(null),s=Object.create(null),a=Object.create(null);for(let o=0;o<n.length;o++){const u=n[o].name;r[u]=n[o].value,s[u]=n[o].namespace,a[u]=n[o].prefix}const i=new pm(t,r,[]);return i.namespace=e,i["x-attribsNamespace"]=s,i["x-attribsPrefix"]=a,i},createCommentNode(t){return new hm(t)},createTextNode(t){return new Gi(t)},appendChild(t,e){const n=t.children[t.children.length-1];n&&(n.next=e,e.prev=n),t.children.push(e),e.parent=t},insertBefore(t,e,n){const r=t.children.indexOf(n),{prev:s}=n;s&&(s.next=e,e.prev=s),n.prev=e,e.next=n,t.children.splice(r,0,e),e.parent=t},setTemplateContent(t,e){jr.appendChild(t,e)},getTemplateContent(t){return t.children[0]},setDocumentType(t,e,n,r){const s=K9(e,n,r);let a=t.children.find(i=>Bh(i)&&i.name==="!doctype");a?a.data=s??null:(a=new fm("!doctype",s),jr.appendChild(t,a)),a["x-name"]=e,a["x-publicId"]=n,a["x-systemId"]=r},setDocumentMode(t,e){t["x-mode"]=e},getDocumentMode(t){return t["x-mode"]},detachNode(t){if(t.parent){const e=t.parent.children.indexOf(t),{prev:n,next:r}=t;t.prev=null,t.next=null,n&&(n.next=r),r&&(r.prev=n),t.parent.children.splice(e,1),t.parent=null}},insertText(t,e){const n=t.children[t.children.length-1];n&&mr(n)?n.data+=e:jr.appendChild(t,jr.createTextNode(e))},insertTextBefore(t,e,n){const r=t.children[t.children.indexOf(n)-1];r&&mr(r)?r.data+=e:jr.insertBefore(t,jr.createTextNode(e),n)},adoptAttributes(t,e){for(let n=0;n<e.length;n++){const r=e[n].name;t.attribs[r]===void 0&&(t.attribs[r]=e[n].value,t["x-attribsNamespace"][r]=e[n].namespace,t["x-attribsPrefix"][r]=e[n].prefix)}},getFirstChild(t){return t.children[0]},getChildNodes(t){return t.children},getParentNode(t){return t.parent},getAttrList(t){return t.attributes},getTagName(t){return t.name},getNamespaceURI(t){return t.namespace},getTextNodeContent(t){return t.data},getCommentNodeContent(t){return t.data},getDocumentTypeNodeName(t){var e;return(e=t["x-name"])!==null&&e!==void 0?e:""},getDocumentTypeNodePublicId(t){var e;return(e=t["x-publicId"])!==null&&e!==void 0?e:""},getDocumentTypeNodeSystemId(t){var e;return(e=t["x-systemId"])!==null&&e!==void 0?e:""},isDocumentTypeNode(t){return Bh(t)&&t.name==="!doctype"},setNodeSourceCodeLocation(t,e){e&&(t.startIndex=e.startOffset,t.endIndex=e.endOffset),t.sourceCodeLocation=e},getNodeSourceCodeLocation(t){return t.sourceCodeLocation},updateNodeSourceCodeLocation(t,e){e.endOffset!=null&&(t.endIndex=e.endOffset),t.sourceCodeLocation={...t.sourceCodeLocation,...e}}};function Y9(t,e,n,r){var s;return(s=e.treeAdapter)!==null&&s!==void 0||(e.treeAdapter=jr),e.scriptingEnabled!==!1&&(e.scriptingEnabled=!0),n?W9(t,e):G9(r,t,e)}const Z9={treeAdapter:jr};function J9(t){const e="length"in t?t:[t];for(let r=0;r<e.length;r+=1){const s=e[r];Xr(s)&&Array.prototype.splice.call(e,r,1,...s.children)}let n="";for(let r=0;r<e.length;r+=1){const s=e[r];n+=U9(s,Z9)}return n}var pe;(function(t){t[t.Tab=9]="Tab",t[t.NewLine=10]="NewLine",t[t.FormFeed=12]="FormFeed",t[t.CarriageReturn=13]="CarriageReturn",t[t.Space=32]="Space",t[t.ExclamationMark=33]="ExclamationMark",t[t.Number=35]="Number",t[t.Amp=38]="Amp",t[t.SingleQuote=39]="SingleQuote",t[t.DoubleQuote=34]="DoubleQuote",t[t.Dash=45]="Dash",t[t.Slash=47]="Slash",t[t.Zero=48]="Zero",t[t.Nine=57]="Nine",t[t.Semi=59]="Semi",t[t.Lt=60]="Lt",t[t.Eq=61]="Eq",t[t.Gt=62]="Gt",t[t.Questionmark=63]="Questionmark",t[t.UpperA=65]="UpperA",t[t.LowerA=97]="LowerA",t[t.UpperF=70]="UpperF",t[t.LowerF=102]="LowerF",t[t.UpperZ=90]="UpperZ",t[t.LowerZ=122]="LowerZ",t[t.LowerX=120]="LowerX",t[t.OpeningSquareBracket=91]="OpeningSquareBracket"})(pe||(pe={}));var Y;(function(t){t[t.Text=1]="Text",t[t.BeforeTagName=2]="BeforeTagName",t[t.InTagName=3]="InTagName",t[t.InSelfClosingTag=4]="InSelfClosingTag",t[t.BeforeClosingTagName=5]="BeforeClosingTagName",t[t.InClosingTagName=6]="InClosingTagName",t[t.AfterClosingTagName=7]="AfterClosingTagName",t[t.BeforeAttributeName=8]="BeforeAttributeName",t[t.InAttributeName=9]="InAttributeName",t[t.AfterAttributeName=10]="AfterAttributeName",t[t.BeforeAttributeValue=11]="BeforeAttributeValue",t[t.InAttributeValueDq=12]="InAttributeValueDq",t[t.InAttributeValueSq=13]="InAttributeValueSq",t[t.InAttributeValueNq=14]="InAttributeValueNq",t[t.BeforeDeclaration=15]="BeforeDeclaration",t[t.InDeclaration=16]="InDeclaration",t[t.InProcessingInstruction=17]="InProcessingInstruction",t[t.BeforeComment=18]="BeforeComment",t[t.CDATASequence=19]="CDATASequence",t[t.InSpecialComment=20]="InSpecialComment",t[t.InCommentLike=21]="InCommentLike",t[t.BeforeSpecialS=22]="BeforeSpecialS",t[t.BeforeSpecialT=23]="BeforeSpecialT",t[t.SpecialStartSequence=24]="SpecialStartSequence",t[t.InSpecialTag=25]="InSpecialTag",t[t.InEntity=26]="InEntity"})(Y||(Y={}));function Sr(t){return t===pe.Space||t===pe.NewLine||t===pe.Tab||t===pe.FormFeed||t===pe.CarriageReturn}function hu(t){return t===pe.Slash||t===pe.Gt||Sr(t)}function X9(t){return t>=pe.LowerA&&t<=pe.LowerZ||t>=pe.UpperA&&t<=pe.UpperZ}var or;(function(t){t[t.NoValue=0]="NoValue",t[t.Unquoted=1]="Unquoted",t[t.Single=2]="Single",t[t.Double=3]="Double"})(or||(or={}));const kt={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101]),TextareaEnd:new Uint8Array([60,47,116,101,120,116,97,114,101,97])};class Q9{constructor({xmlMode:e=!1,decodeEntities:n=!0},r){this.cbs=r,this.state=Y.Text,this.buffer="",this.sectionStart=0,this.index=0,this.entityStart=0,this.baseState=Y.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.xmlMode=e,this.decodeEntities=n,this.entityDecoder=new bm(e?YE:gm,(s,a)=>this.emitCodePoint(s,a))}reset(){this.state=Y.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=Y.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(e){this.offset+=this.buffer.length,this.buffer=e,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}stateText(e){e===pe.Lt||!this.decodeEntities&&this.fastForwardTo(pe.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=Y.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&e===pe.Amp&&this.startEntity()}stateSpecialStartSequence(e){const n=this.sequenceIndex===this.currentSequence.length;if(!(n?hu(e):(e|32)===this.currentSequence[this.sequenceIndex]))this.isSpecial=!1;else if(!n){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=Y.InTagName,this.stateInTagName(e)}stateInSpecialTag(e){if(this.sequenceIndex===this.currentSequence.length){if(e===pe.Gt||Sr(e)){const n=this.index-this.currentSequence.length;if(this.sectionStart<n){const r=this.index;this.index=n,this.cbs.ontext(this.sectionStart,n),this.index=r}this.isSpecial=!1,this.sectionStart=n+2,this.stateInClosingTagName(e);return}this.sequenceIndex=0}(e|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===kt.TitleEnd?this.decodeEntities&&e===pe.Amp&&this.startEntity():this.fastForwardTo(pe.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(e===pe.Lt)}stateCDATASequence(e){e===kt.Cdata[this.sequenceIndex]?++this.sequenceIndex===kt.Cdata.length&&(this.state=Y.InCommentLike,this.currentSequence=kt.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=Y.InDeclaration,this.stateInDeclaration(e))}fastForwardTo(e){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===e)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(e){e===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===kt.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=Y.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):e!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(e){return this.xmlMode?!hu(e):X9(e)}startSpecial(e,n){this.isSpecial=!0,this.currentSequence=e,this.sequenceIndex=n,this.state=Y.SpecialStartSequence}stateBeforeTagName(e){if(e===pe.ExclamationMark)this.state=Y.BeforeDeclaration,this.sectionStart=this.index+1;else if(e===pe.Questionmark)this.state=Y.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(e)){const n=e|32;this.sectionStart=this.index,this.xmlMode?this.state=Y.InTagName:n===kt.ScriptEnd[2]?this.state=Y.BeforeSpecialS:n===kt.TitleEnd[2]?this.state=Y.BeforeSpecialT:this.state=Y.InTagName}else e===pe.Slash?this.state=Y.BeforeClosingTagName:(this.state=Y.Text,this.stateText(e))}stateInTagName(e){hu(e)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=Y.BeforeAttributeName,this.stateBeforeAttributeName(e))}stateBeforeClosingTagName(e){Sr(e)||(e===pe.Gt?this.state=Y.Text:(this.state=this.isTagStartChar(e)?Y.InClosingTagName:Y.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(e){(e===pe.Gt||Sr(e))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=Y.AfterClosingTagName,this.stateAfterClosingTagName(e))}stateAfterClosingTagName(e){(e===pe.Gt||this.fastForwardTo(pe.Gt))&&(this.state=Y.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(e){e===pe.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=Y.InSpecialTag,this.sequenceIndex=0):this.state=Y.Text,this.sectionStart=this.index+1):e===pe.Slash?this.state=Y.InSelfClosingTag:Sr(e)||(this.state=Y.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(e){e===pe.Gt?(this.cbs.onselfclosingtag(this.index),this.state=Y.Text,this.sectionStart=this.index+1,this.isSpecial=!1):Sr(e)||(this.state=Y.BeforeAttributeName,this.stateBeforeAttributeName(e))}stateInAttributeName(e){(e===pe.Eq||hu(e))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=this.index,this.state=Y.AfterAttributeName,this.stateAfterAttributeName(e))}stateAfterAttributeName(e){e===pe.Eq?this.state=Y.BeforeAttributeValue:e===pe.Slash||e===pe.Gt?(this.cbs.onattribend(or.NoValue,this.sectionStart),this.sectionStart=-1,this.state=Y.BeforeAttributeName,this.stateBeforeAttributeName(e)):Sr(e)||(this.cbs.onattribend(or.NoValue,this.sectionStart),this.state=Y.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(e){e===pe.DoubleQuote?(this.state=Y.InAttributeValueDq,this.sectionStart=this.index+1):e===pe.SingleQuote?(this.state=Y.InAttributeValueSq,this.sectionStart=this.index+1):Sr(e)||(this.sectionStart=this.index,this.state=Y.InAttributeValueNq,this.stateInAttributeValueNoQuotes(e))}handleInAttributeValue(e,n){e===n||!this.decodeEntities&&this.fastForwardTo(n)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(n===pe.DoubleQuote?or.Double:or.Single,this.index+1),this.state=Y.BeforeAttributeName):this.decodeEntities&&e===pe.Amp&&this.startEntity()}stateInAttributeValueDoubleQuotes(e){this.handleInAttributeValue(e,pe.DoubleQuote)}stateInAttributeValueSingleQuotes(e){this.handleInAttributeValue(e,pe.SingleQuote)}stateInAttributeValueNoQuotes(e){Sr(e)||e===pe.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(or.Unquoted,this.index),this.state=Y.BeforeAttributeName,this.stateBeforeAttributeName(e)):this.decodeEntities&&e===pe.Amp&&this.startEntity()}stateBeforeDeclaration(e){e===pe.OpeningSquareBracket?(this.state=Y.CDATASequence,this.sequenceIndex=0):this.state=e===pe.Dash?Y.BeforeComment:Y.InDeclaration}stateInDeclaration(e){(e===pe.Gt||this.fastForwardTo(pe.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=Y.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(e){(e===pe.Gt||this.fastForwardTo(pe.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=Y.Text,this.sectionStart=this.index+1)}stateBeforeComment(e){e===pe.Dash?(this.state=Y.InCommentLike,this.currentSequence=kt.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=Y.InDeclaration}stateInSpecialComment(e){(e===pe.Gt||this.fastForwardTo(pe.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=Y.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(e){const n=e|32;n===kt.ScriptEnd[3]?this.startSpecial(kt.ScriptEnd,4):n===kt.StyleEnd[3]?this.startSpecial(kt.StyleEnd,4):(this.state=Y.InTagName,this.stateInTagName(e))}stateBeforeSpecialT(e){const n=e|32;n===kt.TitleEnd[3]?this.startSpecial(kt.TitleEnd,4):n===kt.TextareaEnd[3]?this.startSpecial(kt.TextareaEnd,4):(this.state=Y.InTagName,this.stateInTagName(e))}startEntity(){this.baseState=this.state,this.state=Y.InEntity,this.entityStart=this.index,this.entityDecoder.startEntity(this.xmlMode?Cn.Strict:this.baseState===Y.Text||this.baseState===Y.InSpecialTag?Cn.Legacy:Cn.Attribute)}stateInEntity(){const e=this.entityDecoder.write(this.buffer,this.index-this.offset);e>=0?(this.state=this.baseState,e===0&&(this.index=this.entityStart)):this.index=this.offset+this.buffer.length-1}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===Y.Text||this.state===Y.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===Y.InAttributeValueDq||this.state===Y.InAttributeValueSq||this.state===Y.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const e=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case Y.Text:{this.stateText(e);break}case Y.SpecialStartSequence:{this.stateSpecialStartSequence(e);break}case Y.InSpecialTag:{this.stateInSpecialTag(e);break}case Y.CDATASequence:{this.stateCDATASequence(e);break}case Y.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(e);break}case Y.InAttributeName:{this.stateInAttributeName(e);break}case Y.InCommentLike:{this.stateInCommentLike(e);break}case Y.InSpecialComment:{this.stateInSpecialComment(e);break}case Y.BeforeAttributeName:{this.stateBeforeAttributeName(e);break}case Y.InTagName:{this.stateInTagName(e);break}case Y.InClosingTagName:{this.stateInClosingTagName(e);break}case Y.BeforeTagName:{this.stateBeforeTagName(e);break}case Y.AfterAttributeName:{this.stateAfterAttributeName(e);break}case Y.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(e);break}case Y.BeforeAttributeValue:{this.stateBeforeAttributeValue(e);break}case Y.BeforeClosingTagName:{this.stateBeforeClosingTagName(e);break}case Y.AfterClosingTagName:{this.stateAfterClosingTagName(e);break}case Y.BeforeSpecialS:{this.stateBeforeSpecialS(e);break}case Y.BeforeSpecialT:{this.stateBeforeSpecialT(e);break}case Y.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(e);break}case Y.InSelfClosingTag:{this.stateInSelfClosingTag(e);break}case Y.InDeclaration:{this.stateInDeclaration(e);break}case Y.BeforeDeclaration:{this.stateBeforeDeclaration(e);break}case Y.BeforeComment:{this.stateBeforeComment(e);break}case Y.InProcessingInstruction:{this.stateInProcessingInstruction(e);break}case Y.InEntity:{this.stateInEntity();break}}this.index++}this.cleanup()}finish(){this.state===Y.InEntity&&(this.entityDecoder.end(),this.state=this.baseState),this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const e=this.buffer.length+this.offset;this.sectionStart>=e||(this.state===Y.InCommentLike?this.currentSequence===kt.CdataEnd?this.cbs.oncdata(this.sectionStart,e,0):this.cbs.oncomment(this.sectionStart,e,0):this.state===Y.InTagName||this.state===Y.BeforeAttributeName||this.state===Y.BeforeAttributeValue||this.state===Y.AfterAttributeName||this.state===Y.InAttributeName||this.state===Y.InAttributeValueSq||this.state===Y.InAttributeValueDq||this.state===Y.InAttributeValueNq||this.state===Y.InClosingTagName||this.cbs.ontext(this.sectionStart,e))}emitCodePoint(e,n){this.baseState!==Y.Text&&this.baseState!==Y.InSpecialTag?(this.sectionStart<this.entityStart&&this.cbs.onattribdata(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+n,this.index=this.sectionStart-1,this.cbs.onattribentity(e)):(this.sectionStart<this.entityStart&&this.cbs.ontext(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+n,this.index=this.sectionStart-1,this.cbs.ontextentity(e,this.sectionStart))}}const $s=new Set(["input","option","optgroup","select","button","datalist","textarea"]),Qe=new Set(["p"]),db=new Set(["thead","tbody"]),hb=new Set(["dd","dt"]),fb=new Set(["rt","rp"]),eF=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",Qe],["h1",Qe],["h2",Qe],["h3",Qe],["h4",Qe],["h5",Qe],["h6",Qe],["select",$s],["input",$s],["output",$s],["button",$s],["datalist",$s],["textarea",$s],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",hb],["dt",hb],["address",Qe],["article",Qe],["aside",Qe],["blockquote",Qe],["details",Qe],["div",Qe],["dl",Qe],["fieldset",Qe],["figcaption",Qe],["figure",Qe],["footer",Qe],["form",Qe],["header",Qe],["hr",Qe],["main",Qe],["nav",Qe],["ol",Qe],["pre",Qe],["section",Qe],["table",Qe],["ul",Qe],["rt",fb],["rp",fb],["tbody",db],["tfoot",db]]),tF=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),mb=new Set(["math","svg"]),pb=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),nF=/\s|\//;class rF{constructor(e,n={}){var r,s,a,i,o,u;this.options=n,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=e??{},this.htmlMode=!this.options.xmlMode,this.lowerCaseTagNames=(r=n.lowerCaseTags)!==null&&r!==void 0?r:this.htmlMode,this.lowerCaseAttributeNames=(s=n.lowerCaseAttributeNames)!==null&&s!==void 0?s:this.htmlMode,this.recognizeSelfClosing=(a=n.recognizeSelfClosing)!==null&&a!==void 0?a:!this.htmlMode,this.tokenizer=new((i=n.Tokenizer)!==null&&i!==void 0?i:Q9)(this.options,this),this.foreignContext=[!this.htmlMode],(u=(o=this.cbs).onparserinit)===null||u===void 0||u.call(o,this)}ontext(e,n){var r,s;const a=this.getSlice(e,n);this.endIndex=n-1,(s=(r=this.cbs).ontext)===null||s===void 0||s.call(r,a),this.startIndex=n}ontextentity(e,n){var r,s;this.endIndex=n-1,(s=(r=this.cbs).ontext)===null||s===void 0||s.call(r,Fh(e)),this.startIndex=n}isVoidElement(e){return this.htmlMode&&tF.has(e)}onopentagname(e,n){this.endIndex=n;let r=this.getSlice(e,n);this.lowerCaseTagNames&&(r=r.toLowerCase()),this.emitOpenTag(r)}emitOpenTag(e){var n,r,s,a;this.openTagStart=this.startIndex,this.tagname=e;const i=this.htmlMode&&eF.get(e);if(i)for(;this.stack.length>0&&i.has(this.stack[0]);){const o=this.stack.shift();(r=(n=this.cbs).onclosetag)===null||r===void 0||r.call(n,o,!0)}this.isVoidElement(e)||(this.stack.unshift(e),this.htmlMode&&(mb.has(e)?this.foreignContext.unshift(!0):pb.has(e)&&this.foreignContext.unshift(!1))),(a=(s=this.cbs).onopentagname)===null||a===void 0||a.call(s,e),this.cbs.onopentag&&(this.attribs={})}endOpenTag(e){var n,r;this.startIndex=this.openTagStart,this.attribs&&((r=(n=this.cbs).onopentag)===null||r===void 0||r.call(n,this.tagname,this.attribs,e),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(e){this.endIndex=e,this.endOpenTag(!1),this.startIndex=e+1}onclosetag(e,n){var r,s,a,i,o,u,c,l;this.endIndex=n;let d=this.getSlice(e,n);if(this.lowerCaseTagNames&&(d=d.toLowerCase()),this.htmlMode&&(mb.has(d)||pb.has(d))&&this.foreignContext.shift(),this.isVoidElement(d))this.htmlMode&&d==="br"&&((i=(a=this.cbs).onopentagname)===null||i===void 0||i.call(a,"br"),(u=(o=this.cbs).onopentag)===null||u===void 0||u.call(o,"br",{},!0),(l=(c=this.cbs).onclosetag)===null||l===void 0||l.call(c,"br",!1));else{const m=this.stack.indexOf(d);if(m!==-1)for(let p=0;p<=m;p++){const f=this.stack.shift();(s=(r=this.cbs).onclosetag)===null||s===void 0||s.call(r,f,p!==m)}else this.htmlMode&&d==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=n+1}onselfclosingtag(e){this.endIndex=e,this.recognizeSelfClosing||this.foreignContext[0]?(this.closeCurrentTag(!1),this.startIndex=e+1):this.onopentagend(e)}closeCurrentTag(e){var n,r;const s=this.tagname;this.endOpenTag(e),this.stack[0]===s&&((r=(n=this.cbs).onclosetag)===null||r===void 0||r.call(n,s,!e),this.stack.shift())}onattribname(e,n){this.startIndex=e;const r=this.getSlice(e,n);this.attribname=this.lowerCaseAttributeNames?r.toLowerCase():r}onattribdata(e,n){this.attribvalue+=this.getSlice(e,n)}onattribentity(e){this.attribvalue+=Fh(e)}onattribend(e,n){var r,s;this.endIndex=n,(s=(r=this.cbs).onattribute)===null||s===void 0||s.call(r,this.attribname,this.attribvalue,e===or.Double?'"':e===or.Single?"'":e===or.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(e){const n=e.search(nF);let r=n<0?e:e.substr(0,n);return this.lowerCaseTagNames&&(r=r.toLowerCase()),r}ondeclaration(e,n){this.endIndex=n;const r=this.getSlice(e,n);if(this.cbs.onprocessinginstruction){const s=this.getInstructionName(r);this.cbs.onprocessinginstruction(`!${s}`,`!${r}`)}this.startIndex=n+1}onprocessinginstruction(e,n){this.endIndex=n;const r=this.getSlice(e,n);if(this.cbs.onprocessinginstruction){const s=this.getInstructionName(r);this.cbs.onprocessinginstruction(`?${s}`,`?${r}`)}this.startIndex=n+1}oncomment(e,n,r){var s,a,i,o;this.endIndex=n,(a=(s=this.cbs).oncomment)===null||a===void 0||a.call(s,this.getSlice(e,n-r)),(o=(i=this.cbs).oncommentend)===null||o===void 0||o.call(i),this.startIndex=n+1}oncdata(e,n,r){var s,a,i,o,u,c,l,d,m,p;this.endIndex=n;const f=this.getSlice(e,n-r);!this.htmlMode||this.options.recognizeCDATA?((a=(s=this.cbs).oncdatastart)===null||a===void 0||a.call(s),(o=(i=this.cbs).ontext)===null||o===void 0||o.call(i,f),(c=(u=this.cbs).oncdataend)===null||c===void 0||c.call(u)):((d=(l=this.cbs).oncomment)===null||d===void 0||d.call(l,`[CDATA[${f}]]`),(p=(m=this.cbs).oncommentend)===null||p===void 0||p.call(m)),this.startIndex=n+1}onend(){var e,n;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let r=0;r<this.stack.length;r++)this.cbs.onclosetag(this.stack[r],!0)}(n=(e=this.cbs).onend)===null||n===void 0||n.call(e)}reset(){var e,n,r,s;(n=(e=this.cbs).onreset)===null||n===void 0||n.call(e),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(s=(r=this.cbs).onparserinit)===null||s===void 0||s.call(r,this),this.buffers.length=0,this.foreignContext.length=0,this.foreignContext.unshift(!this.htmlMode),this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(e){this.reset(),this.end(e)}getSlice(e,n){for(;e-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let r=this.buffers[0].slice(e-this.bufferOffset,n-this.bufferOffset);for(;n-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),r+=this.buffers[0].slice(0,n-this.bufferOffset);return r}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(e){var n,r;if(this.ended){(r=(n=this.cbs).onerror)===null||r===void 0||r.call(n,new Error(".write() after done!"));return}this.buffers.push(e),this.tokenizer.running&&(this.tokenizer.write(e),this.writeIndex++)}end(e){var n,r;if(this.ended){(r=(n=this.cbs).onerror)===null||r===void 0||r.call(n,new Error(".end() after done!"));return}e&&this.write(e),this.ended=!0,this.tokenizer.end()}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(e){this.write(e)}done(e){this.end(e)}}function sF(t,e){const n=new iD(void 0,e);return new rF(n,e).end(t),n.root}const aF=L8((t,e,n,r)=>e._useHtmlParser2?sF(t,e):Y9(t,e,n,r)),iF=f5(aF,(t,e)=>e._useHtmlParser2?ol(t,e):J9(t));async function oF(t,e){try{const n=await t.invoke(e),r=typeof n=="string"?JSON.parse(`[${n}]`):n;return r.length===0?(to("没有搜索到结果"),[]):r}catch(n){console.error("解析搜索结果失败:",n)}return[]}async function uF(t){let e="";try{const n=await qe.get(t),r=iF(n.data);r("script").remove(),r("style").remove(),r("noscript").remove(),r("iframe").remove(),r("nav").remove(),r("footer").remove(),e=r("body").text().replace(/&nbsp;/g," ").trim()}catch(n){console.error(`Error crawling ${t}:`,n)}return e}class cF extends Mh{static lc_name(){return"ChatDeepSeek"}_llmType(){return"deepseek"}get lc_secrets(){return{apiKey:"DEEPSEEK_API_KEY"}}constructor(e){const n=(e==null?void 0:e.apiKey)||gn("DEEPSEEK_API_KEY");if(!n)throw new Error('Deepseek API key not found. Please set the DEEPSEEK_API_KEY environment variable or pass the key into "apiKey" field.');super({...e,apiKey:n,configuration:{baseURL:"https://api.deepseek.com",...e==null?void 0:e.configuration}}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","deepseek"]})}_convertOpenAIDeltaToBaseMessageChunk(e,n,r){const s=super._convertOpenAIDeltaToBaseMessageChunk(e,n,r);return s.additional_kwargs.reasoning_content=e.reasoning_content,s}_convertOpenAIChatCompletionMessageToBaseMessage(e,n){const r=super._convertOpenAIChatCompletionMessageToBaseMessage(e,n);return r.additional_kwargs.reasoning_content=e.reasoning_content,r}withStructuredOutput(e,n){const r={...n};return(r==null?void 0:r.method)===void 0&&(r.method="functionCalling"),super.withStructuredOutput(e,r)}}async function lF(t,e,n){const r=await t2(e),s=r-n,a=r+n,i=await c_(t);let o=[];for(let[u,c]of i.entries())u<s||u>a||o.push({link:`siyuan://blocks/${c.id}`,content:c.markdown});return o}let hn;function Dm(t){hn=t}async function dF(t){try{await navigator.clipboard.writeText(t)}catch{const n=document.createElement("textarea");n.value=t,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}}function hF(t,e){let n=[],r="";for(let[s,a]of t.entries())switch(s===t.length-1&&e.length>0?r=`${hn.searchResults}${JSON.stringify(e)}

${hn.answerBasedOnSearch}${a.content};`:r=a.content,!0){case a.role==="system":n.push(new ih(r));break;case a.role==="assistant":n.push(new ws(r));break;case a.role==="user":a.image?n.push(new cr({content:[{type:"text",text:r},{type:"image_url",image_url:{url:a.image}}]})):a.fileContent?n.push(new cr(`${a.fileContent}

${r}`)):n.push(new cr(r));break;case a.role==="image":break;default:n.push(new cr(r));break}return n}async function fu(t,e){let n=[],r=[],s=[],a="",i=e.isReason?`${hn.thinking}

`:"",o=!1;if(e.isSearch){let l=e.messages[e.messages.length-1].content;l||(l=e.messages[e.messages.length-2].content);const d=new Y4({apiBase:I2,params:{format:"json",engines:"google,bing",numResults:3},headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"}}),m=await oF(d,l);for(let[p,f]of m.entries()){if(f.link.includes("zhihu"))continue;p===0&&(a+=`${hn.relatedWebPages}:

`);const g=await uF(f.link);let b=g.length>1024?await fF(g.replace(`
`,""),e.apiKey):g;n.push(b),a+=`${hn.webLink}: ${f.link}
`,e.callback(a),a+=`${hn.title}:${f.title}
`,e.callback(a),a+=`${hn.summary}: ${f.snippet}

`,e.callback(a)}a+=`

---------------------------------------
`}if(e.isKnowledge){const l=e.messages[e.messages.length-1].content,d=await e.knowledgeCallback(l);let m=new Set;for(let p of d){if(m.has(p.metadata.blockId))continue;m.add(p.metadata.blockId);const f=await lF(p.metadata.docId,p.metadata.blockId,3);r.push(JSON.stringify(f))}s=[...e.messages.splice(0,-1),{role:"user",content:hn.knowledgeBasePrompt},{role:"assistant",content:`${hn.retrievedContent}:
${r}`},{role:"user",content:e.messages[e.messages.length-1].content}],e.messages=s}let u=hF(e.messages,n);if(e.isStream){const l=await t.stream(u,{timeout:e.timeout*1e3});try{for await(const d of l)d.additional_kwargs&&d.additional_kwargs.reasoning_content&&(i+=d.additional_kwargs.reasoning_content.toString()),d.content&&(e.isReason&&!o&&(i+=`

--------- 
`),o=!0,a+=d.content.toString()),e.callback(i+a,!0)}catch{throw new Error("User interrupted")}finally{e.callback(i+a,!1)}return a}const c=await t.invoke(u,{timeout:e.timeout*1e3});return c.additional_kwargs.reasoning_content?(i+=c.additional_kwargs.reasoning_content.toString(),i+=`

--------- 
`,a+=c.content.toString(),e.callback(`${i}${a}`),a):(a+=c.content.toString(),e.callback(a),a)}async function vo(t){let e="",n;try{switch(!0){case t.model.includes("claude"):n=new W6({model:t.model,apiKey:t.apiKey,anthropicApiUrl:`${Ro}/claude`,maxTokens:t.maxTokens,temperature:t.temperature}),e=await fu(n,t);break;case t.model.includes("deepseek-reasoner"):n=new cF({model:t.model,apiKey:t.apiKey,maxTokens:t.maxTokens,temperature:t.temperature,configuration:{baseURL:`${Ro}/v1`}}),t.isReason=!0,e=await fu(n,t);break;case t.model.includes("o3-mini"):n=new Mh({openAIApiKey:t.apiKey,modelName:t.model,configuration:{baseURL:`${Ro}/v1`}}),e=await fu(n,t);break;default:n=new Mh({openAIApiKey:t.apiKey,modelName:t.model,maxTokens:t.maxTokens,temperature:t.temperature,configuration:{baseURL:`${Ro}/v1`,timeout:t.timeout*1e3}}),e=await fu(n,t);break}t.isClipboard&&(document.body.focus(),await dF(e),ea(hn.contentCopied))}catch(r){return console.error(hn.generateAnswerError,r),e}finally{return e}}async function cT(t,e){return await vo({apiKey:e,model:"glm-4-flash",maxTokens:100,temperature:.5,timeout:90,isSearch:!1,isStream:!1,isClipboard:!1,callback:()=>{},messages:t})}async function fF(t,e){return await vo({apiKey:e,model:"glm-4-flash",maxTokens:4e3,temperature:.5,timeout:90,isSearch:!1,isStream:!1,isClipboard:!1,callback:()=>{},messages:[{role:"system",content:"请对用户提供的文本内容进行摘要总结"},{role:"user",content:t}]})}async function mF(t){const e=C2+"/v1/images/generations",n=t.messages[t.messages.length-1].imageParam,r={"Content-Type":"application/json",Authorization:`Bearer ${t.apiKey}`},s={model:t.model,prompt:t.messages[t.messages.length-1].content,image_size:n.size,num_inference_steps:n.steps,guidance_scale:n.guidance,negative_prompt:n.negativePrompt,seed:n.seed,prompt_enhancement:!0},a=await qe.post(e,s,{headers:r});return a.status===200?a.data.data[0].url:""}async function pF(t){let e="";try{e=await mF(t)}catch(n){return console.error(hn.generateAnswerError,n),e}finally{return e}}function gF(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,f;n=new bP({props:{currentChat:t[0],lute:t[9]}}),n.$on("edit",t[12]),n.$on("delete",t[13]);function g(S){t[16](S)}function b(S){t[17](S)}function _(S){t[18](S)}function y(S){t[19](S)}function E(S){t[20](S)}function I(S){t[21](S)}function w(S){t[22](S)}let O={settingStorage:t[8],isGenerating:t[10]};return t[11]!==void 0&&(O.isInterrupted=t[11]),t[2]!==void 0&&(O.selectedModel=t[2]),t[3]!==void 0&&(O.isSearchEnabled=t[3]),t[4]!==void 0&&(O.isKnowledgeEnabled=t[4]),t[5]!==void 0&&(O.imageUrl=t[5]),t[6]!==void 0&&(O.fileContent=t[6]),t[1]!==void 0&&(O.documentVectorStorage=t[1]),s=new kx({props:O}),fe.push(()=>Ee(s,"isInterrupted",g)),fe.push(()=>Ee(s,"selectedModel",b)),fe.push(()=>Ee(s,"isSearchEnabled",_)),fe.push(()=>Ee(s,"isKnowledgeEnabled",y)),fe.push(()=>Ee(s,"imageUrl",E)),fe.push(()=>Ee(s,"fileContent",I)),fe.push(()=>Ee(s,"documentVectorStorage",w)),p=new jx({props:{promptStorage:t[7],isGenerating:t[10]}}),p.$on("sendMessage",t[23]),{c(){e=F("div"),Ve(n.$$.fragment),r=te(),Ve(s.$$.fragment),m=te(),Ve(p.$$.fragment),C(e,"class","chat svelte-1cp6ff8")},m(S,x){he(S,e,x),Be(n,e,null),k(e,r),Be(s,e,null),k(e,m),Be(p,e,null),f=!0},p(S,[x]){const D={};x&1&&(D.currentChat=S[0]),x&512&&(D.lute=S[9]),n.$set(D);const B={};x&256&&(B.settingStorage=S[8]),x&1024&&(B.isGenerating=S[10]),!a&&x&2048&&(a=!0,B.isInterrupted=S[11],ye(()=>a=!1)),!i&&x&4&&(i=!0,B.selectedModel=S[2],ye(()=>i=!1)),!o&&x&8&&(o=!0,B.isSearchEnabled=S[3],ye(()=>o=!1)),!u&&x&16&&(u=!0,B.isKnowledgeEnabled=S[4],ye(()=>u=!1)),!c&&x&32&&(c=!0,B.imageUrl=S[5],ye(()=>c=!1)),!l&&x&64&&(l=!0,B.fileContent=S[6],ye(()=>l=!1)),!d&&x&2&&(d=!0,B.documentVectorStorage=S[1],ye(()=>d=!1)),s.$set(B);const Q={};x&128&&(Q.promptStorage=S[7]),x&1024&&(Q.isGenerating=S[10]),p.$set(Q)},i(S){f||(ae(n.$$.fragment,S),ae(s.$$.fragment,S),ae(p.$$.fragment,S),f=!0)},o(S){le(n.$$.fragment,S),le(s.$$.fragment,S),le(p.$$.fragment,S),f=!1},d(S){S&&de(e),Fe(n),Fe(s),Fe(p)}}}function bF(t,e,n){let{currentChat:r}=e,{chatHistoryStorage:s}=e,{promptStorage:a}=e,{settingStorage:i}=e,{documentVectorStorage:o}=e,{selectedModel:u}=e,{isSearchEnabled:c}=e,{isKnowledgeEnabled:l}=e,{imageUrl:d}=e,{fileContent:m}=e,{lute:p}=e,f=!1,g=!1;Dm(i.i18n);function b(K){const{message:ee}=K.detail,L=r.messages.findIndex(N=>N.id===ee.id);L!==-1&&(n(0,r.messages=r.messages.slice(0,L),r),n(0,r.messages=[...r.messages,{id:Date.now(),role:"user",content:ee.content,image:ee.image||"",model:u,fileContent:ee.fileContent||""}],r),n(0,r.messages=[...r.messages,{id:Date.now(),role:"assistant",content:"",model:u}],r),s.update(r),y())}function _(K){const{message:ee}=K.detail,L=r.messages.findIndex(N=>N.id===ee.id);L!==-1&&(n(0,r.messages=r.messages.slice(0,L),r),s.update(r))}async function y(){vo({apiKey:i.getValue("apiKey"),phone:i.getValue("phone"),model:r.model?r.model:u,maxTokens:i.getValue("maxOutputLengthChat"),temperature:i.getValue("temperatureChat"),timeout:i.getValue("responseTimeoutChat"),isSearch:c,isStream:!0,isClipboard:!0,isKnowledge:l,callback:(K,ee)=>{if(g)throw n(10,f=!1),new Error("User interrupted");n(0,r.messages[r.messages.length-1].content=K,r),n(0,r.messages[r.messages.length-1].model=u,r),s.update(r),n(10,f=ee)},knowledgeCallback:async K=>{const ee=await o.similaritySearchWithScore(K,i.getValue("knowledgeBaseRecallNumChat"));let L=[];for(const N of ee)N[1]<.7||L.push(N[0]);return L},messages:r.messages.slice(0,-1)})}async function E(K){if(!(f||!K.trim()))try{d&&n(0,r.model=Math.random()<.7?Sl[0]:Sl[Math.floor(Math.random()*(Sl.length-1))+1],r),n(0,r.messages=[...r.messages,{id:Date.now(),role:"user",content:K,image:d,model:u,fileContent:m}],r),s.update(r),n(0,r.messages=[...r.messages,{id:Date.now(),role:"assistant",content:"",model:u}],r);try{d.length>0&&(n(0,r.title="图像内容理解",r),s.update(r)),await y(),r.messages.length>3&&r.messages.length<=5&&d.length==0&&cT([...r.messages,{role:"user",content:s.i18n.summaryPrompt}],i.getValue("apiKey")).then(ee=>{n(0,r.title=ee,r),s.update(r),n(15,s)})}catch(ee){console.error("AI 响应出错:",ee),n(0,r.messages=r.messages.slice(0,-1),r)}}finally{s.update(r),n(15,s),n(10,f=!1),n(11,g=!1),n(5,d="")}}function I(K){g=K,n(11,g)}function w(K){u=K,n(2,u)}function O(K){c=K,n(3,c)}function S(K){l=K,n(4,l)}function x(K){d=K,n(5,d)}function D(K){m=K,n(6,m)}function B(K){o=K,n(1,o)}const Q=async({detail:K})=>await E(K);return t.$$set=K=>{"currentChat"in K&&n(0,r=K.currentChat),"chatHistoryStorage"in K&&n(15,s=K.chatHistoryStorage),"promptStorage"in K&&n(7,a=K.promptStorage),"settingStorage"in K&&n(8,i=K.settingStorage),"documentVectorStorage"in K&&n(1,o=K.documentVectorStorage),"selectedModel"in K&&n(2,u=K.selectedModel),"isSearchEnabled"in K&&n(3,c=K.isSearchEnabled),"isKnowledgeEnabled"in K&&n(4,l=K.isKnowledgeEnabled),"imageUrl"in K&&n(5,d=K.imageUrl),"fileContent"in K&&n(6,m=K.fileContent),"lute"in K&&n(9,p=K.lute)},[r,o,u,c,l,d,m,a,i,p,f,g,b,_,E,s,I,w,O,S,x,D,B,Q]}let _F=class extends rt{constructor(e){super(),nt(this,e,bF,gF,tt,{currentChat:0,chatHistoryStorage:15,promptStorage:7,settingStorage:8,documentVectorStorage:1,selectedModel:2,isSearchEnabled:3,isKnowledgeEnabled:4,imageUrl:5,fileContent:6,lute:9})}};function yF(t){let e,n,r,s,a,i,o,u,c,l;function d(y){t[12](y)}let m={};t[0]!==void 0&&(m.chatHistoryStorage=t[0]),n=new hP({props:m}),fe.push(()=>Ee(n,"chatHistoryStorage",d)),n.$on("selectChat",t[13]);function p(y){t[14](y)}function f(y){t[15](y)}function g(y){t[16](y)}function b(y){t[17](y)}let _={currentChat:t[5],promptStorage:t[3],settingStorage:t[2],selectedModel:t[8],isSearchEnabled:t[9],isKnowledgeEnabled:t[10],lute:t[4]};return t[0]!==void 0&&(_.chatHistoryStorage=t[0]),t[1]!==void 0&&(_.documentVectorStorage=t[1]),t[6]!==void 0&&(_.imageUrl=t[6]),t[7]!==void 0&&(_.fileContent=t[7]),a=new _F({props:_}),fe.push(()=>Ee(a,"chatHistoryStorage",p)),fe.push(()=>Ee(a,"documentVectorStorage",f)),fe.push(()=>Ee(a,"imageUrl",g)),fe.push(()=>Ee(a,"fileContent",b)),a.$on("messageUpdate",t[11]),a.$on("titleUpdate",t[11]),{c(){e=F("div"),Ve(n.$$.fragment),s=te(),Ve(a.$$.fragment),C(e,"class","chat-container svelte-wqoale")},m(y,E){he(y,e,E),Be(n,e,null),k(e,s),Be(a,e,null),l=!0},p(y,[E]){const I={};!r&&E&1&&(r=!0,I.chatHistoryStorage=y[0],ye(()=>r=!1)),n.$set(I);const w={};E&32&&(w.currentChat=y[5]),E&8&&(w.promptStorage=y[3]),E&4&&(w.settingStorage=y[2]),E&16&&(w.lute=y[4]),!i&&E&1&&(i=!0,w.chatHistoryStorage=y[0],ye(()=>i=!1)),!o&&E&2&&(o=!0,w.documentVectorStorage=y[1],ye(()=>o=!1)),!u&&E&64&&(u=!0,w.imageUrl=y[6],ye(()=>u=!1)),!c&&E&128&&(c=!0,w.fileContent=y[7],ye(()=>c=!1)),a.$set(w)},i(y){l||(ae(n.$$.fragment,y),ae(a.$$.fragment,y),l=!0)},o(y){le(n.$$.fragment,y),le(a.$$.fragment,y),l=!1},d(y){y&&de(e),Fe(n),Fe(a)}}}function EF(t,e,n){let{settingStorage:r}=e,{chatHistoryStorage:s}=e,{promptStorage:a}=e,{documentVectorStorage:i}=e,{lute:o}=e,u=r.getValue("modelSelections"),c=s.dump()[0],l=r.getValue("isSearchChat"),d=r.getValue("isisKnowledgeBaseChat"),m="",p="";function f(){let w=s.dump();n(5,c=w.find(O=>O.id===c.id)||w[0])}function g(w){s=w,n(0,s)}const b=w=>n(5,c=w.detail);function _(w){s=w,n(0,s)}function y(w){i=w,n(1,i)}function E(w){m=w,n(6,m)}function I(w){p=w,n(7,p)}return t.$$set=w=>{"settingStorage"in w&&n(2,r=w.settingStorage),"chatHistoryStorage"in w&&n(0,s=w.chatHistoryStorage),"promptStorage"in w&&n(3,a=w.promptStorage),"documentVectorStorage"in w&&n(1,i=w.documentVectorStorage),"lute"in w&&n(4,o=w.lute)},[s,i,r,a,o,c,m,p,u,l,d,f,g,b,_,y,E,I]}class wF extends rt{constructor(e){super(),nt(this,e,EF,yF,tt,{settingStorage:2,chatHistoryStorage:0,promptStorage:3,documentVectorStorage:1,lute:4})}}function TF(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,f,g,b,_,y,E,I,w,O,S,x,D,B,Q;function K(L){t[21](L)}let ee={type:"select",key:"modelSelections",style:"font-size: 12px; border-radius: 4px; border: none ;outline: none;background: transparent; align-self: center;",fnSize:!1,options:t[5].get("modelSelections").options};return t[2]!==void 0&&(ee.value=t[2]),S=new As({props:ee}),fe.push(()=>Ee(S,"value",K)),S.$on("changed",t[22]),{c(){e=F("div"),n=F("div"),r=F("textarea"),a=te(),i=F("div"),o=F("div"),u=F("button"),c=dn("svg"),l=dn("path"),d=te(),m=F("button"),p=dn("svg"),f=dn("path"),b=te(),_=F("button"),y=dn("svg"),E=dn("path"),w=te(),O=F("div"),Ve(S.$$.fragment),C(r,"placeholder",s=t[7].instructionInputPlaceholder),C(r,"class","svelte-1uickue"),C(n,"class","input svelte-1uickue"),C(l,"d","M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"),C(c,"viewBox","0 0 24 24"),C(c,"class","tools-icon svelte-1uickue"),ke(c,"active",t[3]),C(u,"type","button"),C(u,"class","tools-button svelte-1uickue"),C(f,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"),C(p,"viewBox","0 0 24 24"),C(p,"class","tools-icon svelte-1uickue"),ke(p,"active",t[8]),C(m,"title",g=t[7].onlineSearch),C(m,"type","button"),C(m,"class","tools-button svelte-1uickue"),ke(m,"active",t[8]),C(E,"d","M21 5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5zm-2 14H5V5h14v14zM7 15h10v2H7v-2zm0-4h10v2H7v-2zm0-4h10v2H7V7z"),C(y,"viewBox","0 0 24 24"),C(y,"class","tools-icon svelte-1uickue"),ke(y,"active",t[9]),C(_,"title",I=t[7].knowledgeBase),C(_,"type","button"),C(_,"class","tools-button svelte-1uickue"),ke(_,"active",t[9]),C(o,"class","tools svelte-1uickue"),C(O,"class","models svelte-1uickue"),C(i,"class","tools-group svelte-1uickue"),C(e,"class","input-container svelte-1uickue")},m(L,N){he(L,e,N),k(e,n),k(n,r),t[13](r),vt(r,t[0]),k(e,a),k(e,i),k(i,o),k(o,u),k(u,c),k(c,l),k(o,d),k(o,m),k(m,p),k(p,f),k(o,b),k(o,_),k(_,y),k(y,E),k(i,w),k(i,O),Be(S,O,null),D=!0,B||(Q=[ie(r,"input",t[14]),ie(r,"keydown",t[15]),ie(r,"focus",t[16]),ie(r,"blur",t[17]),ie(u,"click",t[18]),ie(m,"click",t[19]),ie(_,"click",t[20])],B=!0)},p(L,[N]){(!D||N&128&&s!==(s=L[7].instructionInputPlaceholder))&&C(r,"placeholder",s),N&1&&vt(r,L[0]),(!D||N&8)&&ke(c,"active",L[3]),(!D||N&256)&&ke(p,"active",L[8]),(!D||N&128&&g!==(g=L[7].onlineSearch))&&C(m,"title",g),(!D||N&256)&&ke(m,"active",L[8]),(!D||N&512)&&ke(y,"active",L[9]),(!D||N&128&&I!==(I=L[7].knowledgeBase))&&C(_,"title",I),(!D||N&512)&&ke(_,"active",L[9]);const U={};N&32&&(U.options=L[5].get("modelSelections").options),!x&&N&4&&(x=!0,U.value=L[2],ye(()=>x=!1)),S.$set(U)},i(L){D||(ae(S.$$.fragment,L),D=!0)},o(L){le(S.$$.fragment,L),D=!1},d(L){L&&de(e),t[13](null),Fe(S),B=!1,ct(Q)}}}function SF(t,e,n){let{inputValue:r}=e,{inputElement:s}=e,{selectedModel:a}=e,{settingStorage:i}=e,{documentVectorStorage:o}=e,{showParams:u}=e,{handleSubmit:c}=e,{i18n:l}=e,{isFocused:d=!0}=e,m=i.getValue("isSearchInstruction"),p=i.getValue("isKnowledgeBaseInstruction");function f(){n(8,m=!m),i.setValue("isSearchInstruction",m),i.save()}async function g(){n(9,p=!p),i.setValue("isKnowledgeBaseInstruction",p),i.save(),p?await o.load():(await o.save(),await o.release())}function b(B){fe[B?"unshift":"push"](()=>{s=B,n(1,s)})}function _(){r=this.value,n(0,r)}const y=B=>{B.key==="Enter"&&!B.shiftKey&&!B.isComposing&&(B.preventDefault(),c())},E=()=>{n(4,d=!0)},I=()=>{n(4,d=!1)},w=()=>{n(3,u=!u),u||i.save()},O=()=>{f()},S=()=>{g()};function x(B){a=B,n(2,a)}const D=({detail:B})=>{i.setValue(B.key,B.value),i.save()};return t.$$set=B=>{"inputValue"in B&&n(0,r=B.inputValue),"inputElement"in B&&n(1,s=B.inputElement),"selectedModel"in B&&n(2,a=B.selectedModel),"settingStorage"in B&&n(5,i=B.settingStorage),"documentVectorStorage"in B&&n(12,o=B.documentVectorStorage),"showParams"in B&&n(3,u=B.showParams),"handleSubmit"in B&&n(6,c=B.handleSubmit),"i18n"in B&&n(7,l=B.i18n),"isFocused"in B&&n(4,d=B.isFocused)},[r,s,a,u,d,i,c,l,m,p,f,g,o,b,_,y,E,I,w,O,S,x,D]}class AF extends rt{constructor(e){super(),nt(this,e,SF,TF,tt,{inputValue:0,inputElement:1,selectedModel:2,settingStorage:5,documentVectorStorage:12,showParams:3,handleSubmit:6,i18n:7,isFocused:4})}}function gb(t){let e,n,r=t[4]?"停止生成":"生成中...",s,a,i,o;return{c(){e=F("div"),n=F("button"),s=Ye(r),C(n,"type","button"),C(n,"class","generation-text svelte-1t9569r"),C(n,"aria-label",a=t[4]?"停止生成":"生成中..."),C(e,"class","generating svelte-1t9569r")},m(u,c){he(u,e,c),k(e,n),k(n,s),i||(o=[ie(n,"mouseenter",t[8]),ie(n,"mouseleave",t[9]),ie(n,"click",t[5]),ie(n,"keydown",t[10])],i=!0)},p(u,c){c&16&&r!==(r=u[4]?"停止生成":"生成中...")&&dt(s,r),c&16&&a!==(a=u[4]?"停止生成":"生成中...")&&C(n,"aria-label",a)},d(u){u&&de(e),i=!1,ct(o)}}}function CF(t){let e,n,r=t[3].Md2HTML(t[1])+"",s,a=t[2]&&gb(t);return{c(){e=F("div"),n=F("div"),s=te(),a&&a.c(),C(n,"class","output svelte-1t9569r"),C(e,"class","output-container svelte-1t9569r")},m(i,o){he(i,e,o),k(e,n),n.innerHTML=r,t[7](n),k(e,s),a&&a.m(e,null)},p(i,[o]){o&10&&r!==(r=i[3].Md2HTML(i[1])+"")&&(n.innerHTML=r),i[2]?a?a.p(i,o):(a=gb(i),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:et,o:et,d(i){i&&de(e),t[7](null),a&&a.d()}}}function vF(t,e,n){let{outputContent:r}=e,{isGenerating:s}=e,{outputContainer:a}=e,{lute:i}=e,{isInterrupted:o}=e,u=!1;function c(){n(6,o=!0)}function l(f){fe[f?"unshift":"push"](()=>{a=f,n(0,a)})}const d=()=>n(4,u=!0),m=()=>n(4,u=!1),p=f=>f.key==="Enter"&&c();return t.$$set=f=>{"outputContent"in f&&n(1,r=f.outputContent),"isGenerating"in f&&n(2,s=f.isGenerating),"outputContainer"in f&&n(0,a=f.outputContainer),"lute"in f&&n(3,i=f.lute),"isInterrupted"in f&&n(6,o=f.isInterrupted)},[a,r,s,i,u,c,o,l,d,m,p]}class lT extends rt{constructor(e){super(),nt(this,e,vF,CF,tt,{outputContent:1,isGenerating:2,outputContainer:0,lute:3,isInterrupted:6})}}function bb(t){let e,n,r,s,a;function i(l){t[18](l)}function o(l){t[19](l)}function u(l){t[20](l)}let c={outputContent:t[10],lute:t[3]};return t[12]!==void 0&&(c.isInterrupted=t[12]),t[11]!==void 0&&(c.isGenerating=t[11]),t[6]!==void 0&&(c.outputContainer=t[6]),e=new lT({props:c}),fe.push(()=>Ee(e,"isInterrupted",i)),fe.push(()=>Ee(e,"isGenerating",o)),fe.push(()=>Ee(e,"outputContainer",u)),{c(){Ve(e.$$.fragment)},m(l,d){Be(e,l,d),a=!0},p(l,d){const m={};d[0]&1024&&(m.outputContent=l[10]),d[0]&8&&(m.lute=l[3]),!n&&d[0]&4096&&(n=!0,m.isInterrupted=l[12],ye(()=>n=!1)),!r&&d[0]&2048&&(r=!0,m.isGenerating=l[11],ye(()=>r=!1)),!s&&d[0]&64&&(s=!0,m.outputContainer=l[6],ye(()=>s=!1)),e.$set(m)},i(l){a||(ae(e.$$.fragment,l),a=!0)},o(l){le(e.$$.fragment,l),a=!1},d(l){Fe(e,l)}}}function _b(t){let e,n,r;function s(i){t[27](i)}let a={group:"instruction"};return t[0]!==void 0&&(a.settingStorage=t[0]),e=new Ky({props:a}),fe.push(()=>Ee(e,"settingStorage",s)),{c(){Ve(e.$$.fragment)},m(i,o){Be(e,i,o),r=!0},p(i,o){const u={};!n&&o[0]&1&&(n=!0,u.settingStorage=i[0],ye(()=>n=!1)),e.$set(u)},i(i){r||(ae(e.$$.fragment,i),r=!0)},o(i){le(e.$$.fragment,i),r=!1},d(i){Fe(e,i)}}}function yb(t){let e,n,r,s,a;function i(l){t[28](l)}function o(l){t[29](l)}function u(l){t[30](l)}let c={isCommand:!1};return t[7]!==void 0&&(c.inputAreaComponent=t[7]),t[4]!==void 0&&(c.searchText=t[4]),t[1]!==void 0&&(c.promptStorage=t[1]),e=new Lf({props:c}),fe.push(()=>Ee(e,"inputAreaComponent",i)),fe.push(()=>Ee(e,"searchText",o)),fe.push(()=>Ee(e,"promptStorage",u)),{c(){Ve(e.$$.fragment)},m(l,d){Be(e,l,d),a=!0},p(l,d){const m={};!n&&d[0]&128&&(n=!0,m.inputAreaComponent=l[7],ye(()=>n=!1)),!r&&d[0]&16&&(r=!0,m.searchText=l[4],ye(()=>r=!1)),!s&&d[0]&2&&(s=!0,m.promptStorage=l[1],ye(()=>s=!1)),e.$set(m)},i(l){a||(ae(e.$$.fragment,l),a=!0)},o(l){le(e.$$.fragment,l),a=!1},d(l){Fe(e,l)}}}function OF(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,f=t[9]&&bb(t);function g(x){t[21](x)}function b(x){t[22](x)}function _(x){t[23](x)}function y(x){t[24](x)}function E(x){t[25](x)}function I(x){t[26](x)}let w={handleSubmit:t[15],i18n:t[14]};t[4]!==void 0&&(w.inputValue=t[4]),t[7]!==void 0&&(w.inputElement=t[7]),t[8]!==void 0&&(w.selectedModel=t[8]),t[0]!==void 0&&(w.settingStorage=t[0]),t[2]!==void 0&&(w.documentVectorStorage=t[2]),t[5]!==void 0&&(w.showParams=t[5]),r=new AF({props:w}),fe.push(()=>Ee(r,"inputValue",g)),fe.push(()=>Ee(r,"inputElement",b)),fe.push(()=>Ee(r,"selectedModel",_)),fe.push(()=>Ee(r,"settingStorage",y)),fe.push(()=>Ee(r,"documentVectorStorage",E)),fe.push(()=>Ee(r,"showParams",I));let O=t[5]&&_b(t),S=t[13]&&yb(t);return{c(){e=F("div"),f&&f.c(),n=te(),Ve(r.$$.fragment),l=te(),d=F("div"),O&&O.c(),m=te(),S&&S.c(),Ht(d,"width","100%"),C(e,"class","instruction-container svelte-1dkyoze")},m(x,D){he(x,e,D),f&&f.m(e,null),k(e,n),Be(r,e,null),k(e,l),k(e,d),O&&O.m(d,null),k(d,m),S&&S.m(d,null),p=!0},p(x,D){x[9]?f?(f.p(x,D),D[0]&512&&ae(f,1)):(f=bb(x),f.c(),ae(f,1),f.m(e,n)):f&&(hr(),le(f,1,1,()=>{f=null}),fr());const B={};!s&&D[0]&16&&(s=!0,B.inputValue=x[4],ye(()=>s=!1)),!a&&D[0]&128&&(a=!0,B.inputElement=x[7],ye(()=>a=!1)),!i&&D[0]&256&&(i=!0,B.selectedModel=x[8],ye(()=>i=!1)),!o&&D[0]&1&&(o=!0,B.settingStorage=x[0],ye(()=>o=!1)),!u&&D[0]&4&&(u=!0,B.documentVectorStorage=x[2],ye(()=>u=!1)),!c&&D[0]&32&&(c=!0,B.showParams=x[5],ye(()=>c=!1)),r.$set(B),x[5]?O?(O.p(x,D),D[0]&32&&ae(O,1)):(O=_b(x),O.c(),ae(O,1),O.m(d,m)):O&&(hr(),le(O,1,1,()=>{O=null}),fr()),x[13]?S?(S.p(x,D),D[0]&8192&&ae(S,1)):(S=yb(x),S.c(),ae(S,1),S.m(d,null)):S&&(hr(),le(S,1,1,()=>{S=null}),fr())},i(x){p||(ae(f),ae(r.$$.fragment,x),ae(O),ae(S),p=!0)},o(x){le(f),le(r.$$.fragment,x),le(O),le(S),p=!1},d(x){x&&de(e),f&&f.d(),Fe(r),O&&O.d(),S&&S.d()}}}function IF(t,e,n){let r,{settingStorage:s}=e,{promptStorage:a}=e,{documentVectorStorage:i}=e,{lute:o}=e,{selectedText:u}=e,{pageContent:c}=e;Dm(s.i18n);let l=s.i18n,d,m="",p=!1,f=s.getValue("modelSelections"),g=!1,b="",_=!1,y=!1,E;async function I(){n(9,g=!0),n(11,_=!0),n(10,b="");let W=m.startsWith("/")?m.slice(1):m,se=[];u.trim().length>0?se.push({role:"user",content:`${u}

${W}`}):s.getValue("isPageContent")?se.push({role:"user",content:`${c.title}

${c.content}

${W}`}):se.push({role:"user",content:`${W}`});try{await vo({apiKey:s.getValue("apiKey"),phone:s.getValue("phone"),model:f,maxTokens:s.getValue("maxOutputLengthInstruction"),temperature:s.getValue("temperatureInstruction"),timeout:s.getValue("responseTimeoutInstruction"),isSearch:s.getValue("isSearchInstruction"),isStream:!0,isClipboard:!0,isKnowledge:s.getValue("isKnowledgeBaseInstruction"),callback:(Pe,Oe)=>{if(y)throw new Error("User interrupted");n(10,b=Pe),E&&!w&&n(6,E.scrollTop=E.scrollHeight,E)},knowledgeCallback:async Pe=>{const Oe=await i.similaritySearchWithScore(Pe,s.getValue("knowledgeBaseRecallNumInstruction"));let yt=[];for(const It of Oe)It[1]<.7||yt.push(It[0]);return yt},messages:se})}finally{n(11,_=!1)}}let w=!1,O=0;function S(W){W&&W.addEventListener("scroll",()=>{W.scrollTop<O&&(w=!0),O=W.scrollTop,W.scrollHeight-W.scrollTop-W.clientHeight<50&&(w=!1)})}no(()=>{d.focus()});function x(W){y=W,n(12,y)}function D(W){_=W,n(11,_)}function B(W){E=W,n(6,E)}function Q(W){m=W,n(4,m)}function K(W){d=W,n(7,d)}function ee(W){f=W,n(8,f)}function L(W){s=W,n(0,s)}function N(W){i=W,n(2,i)}function U(W){p=W,n(5,p)}function V(W){s=W,n(0,s)}function M(W){d=W,n(7,d)}function z(W){m=W,n(4,m)}function X(W){a=W,n(1,a)}return t.$$set=W=>{"settingStorage"in W&&n(0,s=W.settingStorage),"promptStorage"in W&&n(1,a=W.promptStorage),"documentVectorStorage"in W&&n(2,i=W.documentVectorStorage),"lute"in W&&n(3,o=W.lute),"selectedText"in W&&n(16,u=W.selectedText),"pageContent"in W&&n(17,c=W.pageContent)},t.$$.update=()=>{t.$$.dirty[0]&48&&n(13,r=m.trim().startsWith("/")&&!p),t.$$.dirty[0]&64&&E&&S(E)},[s,a,i,o,m,p,E,d,f,g,b,_,y,r,l,I,u,c,x,D,B,Q,K,ee,L,N,U,V,M,z,X]}class kF extends rt{constructor(e){super(),nt(this,e,IF,OF,tt,{settingStorage:0,promptStorage:1,documentVectorStorage:2,lute:3,selectedText:16,pageContent:17},null,[-1,-1])}}function Eb(t,e,n){const r=t.slice();return r[6]=e[n],r}function wb(t){let e,n,r,s=t[6].title+"",a,i,o,u=t[6].time+"",c,l,d,m,p,f;function g(){return t[4](t[6])}function b(){return t[5](t[6])}return{c(){e=F("div"),n=F("button"),r=F("span"),a=Ye(s),i=te(),o=F("div"),c=Ye(u),l=te(),d=F("button"),d.innerHTML='<svg viewBox="0 0 24 24" width="1rem" height="1rem" stroke="currentColor" stroke-width="2" fill="none" class="svelte-x3noak"><path d="M18 6L6 18M6 6l12 12"></path></svg>',m=te(),C(r,"class","svelte-x3noak"),C(o,"class","time svelte-x3noak"),C(n,"class","item-content svelte-x3noak"),C(d,"class","delete-btn svelte-x3noak"),C(d,"title","删除对话"),C(e,"class","list-item svelte-x3noak")},m(_,y){he(_,e,y),k(e,n),k(n,r),k(r,a),k(n,i),k(n,o),k(o,c),k(e,l),k(e,d),k(e,m),p||(f=[ie(n,"click",g),ie(d,"click",p_(b))],p=!0)},p(_,y){t=_,y&1&&s!==(s=t[6].title+"")&&dt(a,s),y&1&&u!==(u=t[6].time+"")&&dt(c,u)},d(_){_&&de(e),p=!1,ct(f)}}}function NF(t){let e,n,r,s,a,i,o,u=t[0].i18n.newChat+"",c,l,d,m,p=Ot(t[0].dump()),f=[];for(let g=0;g<p.length;g+=1)f[g]=wb(Eb(t,p,g));return{c(){e=F("div"),n=F("div"),n.innerHTML='<h3 class="svelte-x3noak">SiYuan AI</h3>',r=te(),s=F("div"),a=F("button"),i=F("span"),o=Ye("+ "),c=Ye(u),l=te();for(let g=0;g<f.length;g+=1)f[g].c();C(n,"class","history-header svelte-x3noak"),C(i,"class","svelte-x3noak"),C(a,"class","new-chat-btn svelte-x3noak"),C(s,"class","list svelte-x3noak"),C(e,"class","history svelte-x3noak")},m(g,b){he(g,e,b),k(e,n),k(e,r),k(e,s),k(s,a),k(a,i),k(i,o),k(i,c),k(s,l);for(let _=0;_<f.length;_+=1)f[_]&&f[_].m(s,null);d||(m=ie(a,"click",t[2]),d=!0)},p(g,[b]){if(b&1&&u!==(u=g[0].i18n.newChat+"")&&dt(c,u),b&11){p=Ot(g[0].dump());let _;for(_=0;_<p.length;_+=1){const y=Eb(g,p,_);f[_]?f[_].p(y,b):(f[_]=wb(y),f[_].c(),f[_].m(s,null))}for(;_<f.length;_+=1)f[_].d(1);f.length=p.length}},i:et,o:et,d(g){g&&de(e),Ns(f,g),d=!1,m()}}}function RF(t,e,n){let{chatHistoryStorage:r}=e;const s=Wn();function a(){const c={id:Date.now(),title:r.i18n.newChat,time:y_().format("YYYY/M/D HH:mm:ss"),messages:[]};r.add(c),n(0,r),s("selectChat",c)}function i(c){r.delete(c),r.data.length===0&&a(),n(0,r),s("selectChat",r.dump()[0])}const o=c=>s("selectChat",c),u=c=>i(c.id);return t.$$set=c=>{"chatHistoryStorage"in c&&n(0,r=c.chatHistoryStorage)},[r,s,a,i,o,u]}class PF extends rt{constructor(e){super(),nt(this,e,RF,NF,tt,{chatHistoryStorage:0})}}function Tb(t,e,n){const r=t.slice();return r[16]=e[n],r}function Sb(t){let e,n,r=t[2].Md2HTML(t[16].content)+"",s,a,i,o,u;function c(...l){return t[9](t[16],...l)}return{c(){e=F("div"),n=F("div"),s=te(),C(n,"class","message-content"),C(e,"class",a="message "+(t[16].role==="user"?"user":"ai")+" svelte-1qgyyzz"),C(e,"role","button"),C(e,"aria-label",i=t[16].role==="user"?"用户消息":"AI 生成"),C(e,"tabindex","0")},m(l,d){he(l,e,d),k(e,n),n.innerHTML=r,k(e,s),o||(u=ie(e,"contextmenu",c),o=!0)},p(l,d){t=l,d&6&&r!==(r=t[2].Md2HTML(t[16].content)+"")&&(n.innerHTML=r),d&2&&a!==(a="message "+(t[16].role==="user"?"user":"ai")+" svelte-1qgyyzz")&&C(e,"class",a),d&2&&i!==(i=t[16].role==="user"?"用户消息":"AI 生成")&&C(e,"aria-label",i)},d(l){l&&de(e),o=!1,u()}}}function xF(t){let e,n,r,s,a,i,o,u,c=Ot(t[1].messages),l=[];for(let d=0;d<c.length;d+=1)l[d]=Sb(Tb(t,c,d));return{c(){e=F("div"),n=F("div"),r=F("div");for(let d=0;d<l.length;d+=1)l[d].c();s=te(),a=F("div"),i=F("textarea"),C(r,"class","messages-wrapper svelte-1qgyyzz"),C(n,"class","message-container svelte-1qgyyzz"),C(i,"placeholder","/触发命令，Enter 发送，Shift + Enter 换行"),i.disabled=t[0],C(i,"class","svelte-1qgyyzz"),C(a,"class","input-container svelte-1qgyyzz"),C(e,"class","image-container svelte-1qgyyzz")},m(d,m){he(d,e,m),k(e,n),k(n,r);for(let p=0;p<l.length;p+=1)l[p]&&l[p].m(r,null);t[10](n),k(e,s),k(e,a),k(a,i),t[11](i),vt(i,t[3]),o||(u=[ie(i,"input",t[12]),ie(i,"input",t[6]),ie(i,"keydown",t[7])],o=!0)},p(d,[m]){if(m&6){c=Ot(d[1].messages);let p;for(p=0;p<c.length;p+=1){const f=Tb(d,c,p);l[p]?l[p].p(f,m):(l[p]=Sb(f),l[p].c(),l[p].m(r,null))}for(;p<l.length;p+=1)l[p].d(1);l.length=c.length}m&1&&(i.disabled=d[0]),m&8&&vt(i,d[3])},i:et,o:et,d(d){d&&de(e),Ns(l,d),t[10](null),t[11](null),o=!1,ct(u)}}}async function LF(t,e){if(e.role!=="assistant")return;const n=e.content.match(/!\[.*?\]\((.*?)\)/);if(!n)return;t.preventDefault();const r=n[1];try{const s=document.createElement("a");s.href=r;const a=r.split("/").pop()||`image-${Date.now()}.png`;s.download=a,document.body.appendChild(s),s.click(),document.body.removeChild(s)}catch(s){console.error("下载图片失败:",s)}}function DF(t,e,n){let{promptStorage:r}=e,{isGenerating:s}=e,{currentChat:a}=e,{lute:i}=e,o="",u,c;const l=Wn();function d(){if(c){const E=c.scrollHeight,I=c.clientHeight,w=E-I;c.scrollTo({top:w,behavior:"smooth"})}}function m(E){const I=E.target;I.value==="/"&&I.selectionStart===1&&f()}function p(E){E.key==="Enter"&&!E.shiftKey&&!E.isComposing&&(E.preventDefault(),l("sendMessage",o),n(3,o=""))}function f(){const E=new en.Dialog({title:"",content:'<div id="chat-prompts-panel" style="height: 100%; margin:0px; padding:0px;"></div>',width:"40%",hideCloseIcon:!0});new Lf({target:E.element.querySelector("#chat-prompts-panel"),props:{inputAreaComponent:u,promptStorage:r,searchText:o,isCommand:!1}}).$on("searchTextChange",w=>{n(3,o=w.detail),n(4,u.style.height="auto",u),n(4,u.style.height=`${u.scrollHeight}px`,u)})}no(()=>{u.focus()});const g=(E,I)=>LF(I,E);function b(E){fe[E?"unshift":"push"](()=>{c=E,n(5,c)})}function _(E){fe[E?"unshift":"push"](()=>{u=E,n(4,u)})}function y(){o=this.value,n(3,o)}return t.$$set=E=>{"promptStorage"in E&&n(8,r=E.promptStorage),"isGenerating"in E&&n(0,s=E.isGenerating),"currentChat"in E&&n(1,a=E.currentChat),"lute"in E&&n(2,i=E.lute)},t.$$.update=()=>{if(t.$$.dirty&2&&a!=null&&a.messages){const E=a.messages[a.messages.length-1];E&&(E==null?void 0:E.role)!=="user"&&E.content&&d()}},[s,a,i,o,u,c,m,p,r,g,b,_,y]}class MF extends rt{constructor(e){super(),nt(this,e,DF,xF,tt,{promptStorage:8,isGenerating:0,currentChat:1,lute:2})}}function Ab(t,e,n){const r=t.slice();return r[3]=e[n],r}function Cb(t){let e,n,r,s;return r=new As({props:{type:t[3].type,key:t[3].key,value:t[3].value,options:t[3].options,style:"width=90%;"}}),r.$on("changed",t[2]),{c(){e=F("span"),e.textContent=`${t[3].title}`,n=te(),Ve(r.$$.fragment),C(e,"class","title svelte-duw9im")},m(a,i){he(a,e,i),he(a,n,i),Be(r,a,i),s=!0},p:et,i(a){s||(ae(r.$$.fragment,a),s=!0)},o(a){le(r.$$.fragment,a),s=!1},d(a){a&&(de(e),de(n)),Fe(r,a)}}}function BF(t){let e,n,r,s=Ot(t[1]),a=[];for(let o=0;o<s.length;o+=1)a[o]=Cb(Ab(t,s,o));const i=o=>le(a[o],1,1,()=>{a[o]=null});return{c(){e=F("div"),n=F("div");for(let o=0;o<a.length;o+=1)a[o].c();C(n,"class","param-group svelte-duw9im"),C(e,"class","params-container svelte-duw9im")},m(o,u){he(o,e,u),k(e,n);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(n,null);r=!0},p(o,[u]){if(u&3){s=Ot(o[1]);let c;for(c=0;c<s.length;c+=1){const l=Ab(o,s,c);a[c]?(a[c].p(l,u),ae(a[c],1)):(a[c]=Cb(l),a[c].c(),ae(a[c],1),a[c].m(n,null))}for(hr(),c=s.length;c<a.length;c+=1)i(c);fr()}},i(o){if(!r){for(let u=0;u<s.length;u+=1)ae(a[u]);r=!0}},o(o){a=a.filter(Boolean);for(let u=0;u<a.length;u+=1)le(a[u]);r=!1},d(o){o&&de(e),Ns(a,o)}}}function FF(t,e,n){let{settingStorage:r}=e,s=r.getSettingItems("image");const a=({detail:i})=>{r.setValue(i.key,i.value),r.save()};return t.$$set=i=>{"settingStorage"in i&&n(0,r=i.settingStorage)},[r,s,a]}class UF extends rt{constructor(e){super(),nt(this,e,FF,BF,tt,{settingStorage:0})}}async function jF(t,e,n){let r="";try{r=await pF({apiKey:t.getValue("apiKey"),model:e.model,messages:n});let s=await qe.get(r,{responseType:"blob"}).catch(o=>{throw new Error(`下载图片失败: ${o.message}`)}),a=new FormData;a.append("image",s.data),a.append("token",O2);const i=v2+"/api/index.php";if(s=await qe.post(i,a).catch(o=>{throw new Error(`上传图片到 EasyImage 失败: ${o.message}`)}),s.data.code!==200)throw new Error(`EasyImage 服务返回错误: ${s.data.message||"未知错误"}`);return r=s.data.url,r}catch(s){if(console.error("生成图片过程出错:",s),r)return r;throw s}}function HF(t){let e,n,r,s,a,i,o,u,c,l,d,m;function p(w){t[8](w)}let f={};t[1]!==void 0&&(f.chatHistoryStorage=t[1]),n=new PF({props:f}),fe.push(()=>Ee(n,"chatHistoryStorage",p)),n.$on("selectChat",t[9]);function g(w){t[10](w)}function b(w){t[11](w)}function _(w){t[12](w)}let y={lute:t[3]};t[2]!==void 0&&(y.promptStorage=t[2]),t[5]!==void 0&&(y.isGenerating=t[5]),t[4]!==void 0&&(y.currentChat=t[4]),a=new MF({props:y}),fe.push(()=>Ee(a,"promptStorage",g)),fe.push(()=>Ee(a,"isGenerating",b)),fe.push(()=>Ee(a,"currentChat",_)),a.$on("messageUpdate",t[6]),a.$on("sendMessage",t[13]);function E(w){t[14](w)}let I={};return t[0]!==void 0&&(I.settingStorage=t[0]),l=new UF({props:I}),fe.push(()=>Ee(l,"settingStorage",E)),{c(){e=F("div"),Ve(n.$$.fragment),s=te(),Ve(a.$$.fragment),c=te(),Ve(l.$$.fragment),C(e,"class","image-container-box svelte-1pbyj0v")},m(w,O){he(w,e,O),Be(n,e,null),k(e,s),Be(a,e,null),k(e,c),Be(l,e,null),m=!0},p(w,[O]){const S={};!r&&O&2&&(r=!0,S.chatHistoryStorage=w[1],ye(()=>r=!1)),n.$set(S);const x={};O&8&&(x.lute=w[3]),!i&&O&4&&(i=!0,x.promptStorage=w[2],ye(()=>i=!1)),!o&&O&32&&(o=!0,x.isGenerating=w[5],ye(()=>o=!1)),!u&&O&16&&(u=!0,x.currentChat=w[4],ye(()=>u=!1)),a.$set(x);const D={};!d&&O&1&&(d=!0,D.settingStorage=w[0],ye(()=>d=!1)),l.$set(D)},i(w){m||(ae(n.$$.fragment,w),ae(a.$$.fragment,w),ae(l.$$.fragment,w),m=!0)},o(w){le(n.$$.fragment,w),le(a.$$.fragment,w),le(l.$$.fragment,w),m=!1},d(w){w&&de(e),Fe(n),Fe(a),Fe(l)}}}function $F(t,e,n){let{settingStorage:r}=e,{chatHistoryStorage:s}=e,{promptStorage:a}=e,{lute:i}=e,o=s.dump()[0],u=!1;function c(){let y=s.dump();n(4,o=y.find(E=>E.id===o.id)||y[0])}async function l(y){if(!(u||!y.trim()))try{const E={model:r.getValue("modelImage"),size:r.getValue("sizeImage"),seed:r.getValue("seedImage"),steps:r.getValue("stepsImage"),guidance:r.getValue("guidanceImage"),negativePrompt:r.getValue("negativePromptImage")};n(4,o.messages=[...o.messages,{id:Date.now(),role:"user",content:y,imageParam:E}],o),s.update(o);try{const I=await jF(r,E,o.messages);n(4,o.messages=[...o.messages,{id:Date.now(),role:"assistant",content:`![](${I})`}],o),cT([{role:"user",content:`请为输入的内容总结出一个简短的中文标题【不要超过5个字】：${y}`}],r.getValue("apiKey")).then(w=>{n(4,o.title=w,o),s.update(o),n(1,s)})}catch(I){console.error("AI 响应出错:",I),n(4,o.messages=o.messages.slice(0,-1),o)}}finally{s.update(o),n(5,u=!1)}}function d(y){s=y,n(1,s)}const m=y=>n(4,o=y.detail);function p(y){a=y,n(2,a)}function f(y){u=y,n(5,u)}function g(y){o=y,n(4,o)}const b=async({detail:y})=>await l(y);function _(y){r=y,n(0,r)}return t.$$set=y=>{"settingStorage"in y&&n(0,r=y.settingStorage),"chatHistoryStorage"in y&&n(1,s=y.chatHistoryStorage),"promptStorage"in y&&n(2,a=y.promptStorage),"lute"in y&&n(3,i=y.lute)},[r,s,a,i,o,u,c,l,d,m,p,f,g,b,_]}class qF extends rt{constructor(e){super(),nt(this,e,$F,HF,tt,{settingStorage:0,chatHistoryStorage:1,promptStorage:2,lute:3})}}function vb(t){let e,n,r;return{c(){e=F("button"),e.innerHTML="<span>×</span>",C(e,"class","clear-btn svelte-5yxkd9")},m(s,a){he(s,e,a),n||(r=ie(e,"click",t[15]),n=!0)},p:et,d(s){s&&de(e),n=!1,r()}}}function Ob(t){let e,n,r,s;function a(u){t[22](u)}function i(u){t[23](u)}let o={};return t[4]!==void 0&&(o.showEditPanel=t[4]),t[5]!==void 0&&(o.currentPrompt=t[5]),e=new Zy({props:o}),fe.push(()=>Ee(e,"showEditPanel",a)),fe.push(()=>Ee(e,"currentPrompt",i)),e.$on("save",t[10]),{c(){Ve(e.$$.fragment)},m(u,c){Be(e,u,c),s=!0},p(u,c){const l={};!n&&c&16&&(n=!0,l.showEditPanel=u[4],ye(()=>n=!1)),!r&&c&32&&(r=!0,l.currentPrompt=u[5],ye(()=>r=!1)),e.$set(l)},i(u){s||(ae(e.$$.fragment,u),s=!0)},o(u){le(e.$$.fragment,u),s=!1},d(u){Fe(e,u)}}}function VF(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,f,g,b,_,y=t[1]&&vb(t);function E(O){t[17](O)}let I={type:"select",key:"modelSelections",style:"font-size: 12px; transition: all 0.2s ease; margin: 5px 0;  border-radius: 8px; border: 1px solid var(--b3-theme-surface-lighter); background: var(--b3-theme-surface);",fnSize:!1,options:t[0].get("modelSelections").options};t[3]!==void 0&&(I.value=t[3]),l=new As({props:I}),fe.push(()=>Ee(l,"value",E)),l.$on("changed",t[18]),p=new Jy({props:{inputAreaComponent:t[2],prompts:t[6]}}),p.$on("edit",t[19]),p.$on("delete",t[20]),p.$on("use",t[21]);let w=t[4]&&Ob(t);return{c(){e=F("div"),n=F("div"),r=F("textarea"),s=te(),y&&y.c(),a=te(),i=F("div"),o=F("button"),o.innerHTML='<span class="add-icon svelte-5yxkd9">+</span> <span class="btn-text svelte-5yxkd9">新建 Prompt</span>',u=te(),c=F("div"),Ve(l.$$.fragment),m=te(),Ve(p.$$.fragment),f=te(),w&&w.c(),C(r,"class","search-input svelte-5yxkd9"),C(r,"placeholder","搜索 Prompt..."),C(n,"class","search-container svelte-5yxkd9"),C(o,"class","add-prompt-btn svelte-5yxkd9"),C(c,"class","models"),C(i,"class","tools svelte-5yxkd9"),C(e,"class","prompts-panel svelte-5yxkd9")},m(O,S){he(O,e,S),k(e,n),k(n,r),t[13](r),vt(r,t[1]),k(n,s),y&&y.m(n,null),k(e,a),k(e,i),k(i,o),k(i,u),k(i,c),Be(l,c,null),k(e,m),Be(p,e,null),k(e,f),w&&w.m(e,null),g=!0,b||(_=[ie(r,"input",t[14]),ie(o,"click",t[16])],b=!0)},p(O,[S]){S&2&&vt(r,O[1]),O[1]?y?y.p(O,S):(y=vb(O),y.c(),y.m(n,null)):y&&(y.d(1),y=null);const x={};S&1&&(x.options=O[0].get("modelSelections").options),!d&&S&8&&(d=!0,x.value=O[3],ye(()=>d=!1)),l.$set(x);const D={};S&4&&(D.inputAreaComponent=O[2]),S&64&&(D.prompts=O[6]),p.$set(D),O[4]?w?(w.p(O,S),S&16&&ae(w,1)):(w=Ob(O),w.c(),ae(w,1),w.m(e,null)):w&&(hr(),le(w,1,1,()=>{w=null}),fr())},i(O){g||(ae(l.$$.fragment,O),ae(p.$$.fragment,O),ae(w),g=!0)},o(O){le(l.$$.fragment,O),le(p.$$.fragment,O),le(w),g=!1},d(O){O&&de(e),t[13](null),y&&y.d(),Fe(l),Fe(p),w&&w.d(),b=!1,ct(_)}}}function zF(t,e,n){let r,s,{promptStorage:a}=e,{settingStorage:i}=e,o,u,c=i.getValue("modelSelections"),l=!1,d;const m=()=>({id:Date.now(),title:"",content:""}),p=Wn();function f(ee){a.deletePrompt(ee),n(12,r=a.data)}function g(ee){n(5,d=ee?{...ee}:m()),n(4,l=!0)}function b(ee){n(1,o=ee.content),p("use",ee)}function _(){r.some(L=>L.id===d.id)?a.updatePrompt(d):a.addPrompt(d),n(4,l=!1),n(12,r=a.data)}function y(ee){fe[ee?"unshift":"push"](()=>{u=ee,n(2,u)})}function E(){o=this.value,n(1,o)}const I=()=>n(1,o=""),w=()=>g();function O(ee){c=ee,n(3,c)}const S=({detail:ee})=>{i.setValue(ee.key,ee.value),i.save()},x=ee=>g(ee.detail),D=ee=>f(ee.detail),B=ee=>b(ee.detail);function Q(ee){l=ee,n(4,l)}function K(ee){d=ee,n(5,d)}return t.$$set=ee=>{"promptStorage"in ee&&n(11,a=ee.promptStorage),"settingStorage"in ee&&n(0,i=ee.settingStorage)},t.$$.update=()=>{t.$$.dirty&2048&&n(12,r=a.data),t.$$.dirty&4098&&n(6,s=(o==null?void 0:o.length)>1?r.filter(ee=>{const L=o.slice(1).toLowerCase();return ee.title.toLowerCase().includes(L)||ee.content.toLowerCase().includes(L)}):r)},[i,o,u,c,l,d,s,f,g,b,_,a,r,y,E,I,w,O,S,x,D,B,Q,K]}class WF extends rt{constructor(e){super(),nt(this,e,zF,VF,tt,{promptStorage:11,settingStorage:0})}}function Ib(t){let e,n,r,s,a;function i(l){t[12](l)}function o(l){t[13](l)}function u(l){t[14](l)}let c={outputContent:t[5],lute:t[2]};return t[7]!==void 0&&(c.isInterrupted=t[7]),t[6]!==void 0&&(c.isGenerating=t[6]),t[3]!==void 0&&(c.outputContainer=t[3]),e=new lT({props:c}),fe.push(()=>Ee(e,"isInterrupted",i)),fe.push(()=>Ee(e,"isGenerating",o)),fe.push(()=>Ee(e,"outputContainer",u)),{c(){Ve(e.$$.fragment)},m(l,d){Be(e,l,d),a=!0},p(l,d){const m={};d&32&&(m.outputContent=l[5]),d&4&&(m.lute=l[2]),!n&&d&128&&(n=!0,m.isInterrupted=l[7],ye(()=>n=!1)),!r&&d&64&&(r=!0,m.isGenerating=l[6],ye(()=>r=!1)),!s&&d&8&&(s=!0,m.outputContainer=l[3],ye(()=>s=!1)),e.$set(m)},i(l){a||(ae(e.$$.fragment,l),a=!0)},o(l){le(e.$$.fragment,l),a=!1},d(l){Fe(e,l)}}}function GF(t){let e,n,r,s,a,i=t[4]&&Ib(t);function o(c){t[15](c)}let u={settingStorage:t[1]};return t[0]!==void 0&&(u.promptStorage=t[0]),r=new WF({props:u}),fe.push(()=>Ee(r,"promptStorage",o)),r.$on("use",t[16]),{c(){e=F("div"),i&&i.c(),n=te(),Ve(r.$$.fragment),C(e,"class","prompt-container svelte-1utspvn")},m(c,l){he(c,e,l),i&&i.m(e,null),k(e,n),Be(r,e,null),a=!0},p(c,[l]){c[4]?i?(i.p(c,l),l&16&&ae(i,1)):(i=Ib(c),i.c(),ae(i,1),i.m(e,n)):i&&(hr(),le(i,1,1,()=>{i=null}),fr());const d={};l&2&&(d.settingStorage=c[1]),!s&&l&1&&(s=!0,d.promptStorage=c[0],ye(()=>s=!1)),r.$set(d)},i(c){a||(ae(i),ae(r.$$.fragment,c),a=!0)},o(c){le(i),le(r.$$.fragment,c),a=!1},d(c){c&&de(e),i&&i.d(),Fe(r)}}}function KF(t,e,n){let{settingStorage:r}=e,{promptStorage:s}=e,{selectedText:a}=e,{pageContent:i}=e,{lute:o}=e,u=!1,c="",l=!1,d=!1,m,p="",f=!1,g=0;Dm(r.i18n);async function b(){n(4,u=!0),n(6,l=!0),n(5,c="");let S=[];a.trim().length>0?S.push({role:"user",content:`${a}

${p}`}):r.getValue("isPageContent")?S.push({role:"user",content:`${i.title}

${i.content}

${p}`}):S.push({role:"user",content:`${p}`});try{await vo({apiKey:r.getValue("apiKey"),phone:r.getValue("phone"),model:r.getValue("modelSelections"),maxTokens:r.getValue("maxOutputLengthInstruction"),temperature:r.getValue("temperatureInstruction"),timeout:r.getValue("responseTimeoutInstruction"),isSearch:r.getValue("isSearchInstruction"),isStream:!0,isClipboard:!0,isKnowledge:!1,callback:(D,B)=>{if(d)throw new Error("User interrupted");n(5,c=D),m&&!f&&n(3,m.scrollTop=m.scrollHeight,m)},knowledgeCallback:()=>{},messages:S})}finally{n(6,l=!1)}}function _(S){S&&S.addEventListener("scroll",()=>{S.scrollTop<g&&(f=!0),g=S.scrollTop,S.scrollHeight-S.scrollTop-S.clientHeight<50&&(f=!1)})}function y(S){d=S,n(7,d)}function E(S){l=S,n(6,l)}function I(S){m=S,n(3,m)}function w(S){s=S,n(0,s)}const O=async({detail:S})=>{n(8,p=S.content),await b()};return t.$$set=S=>{"settingStorage"in S&&n(1,r=S.settingStorage),"promptStorage"in S&&n(0,s=S.promptStorage),"selectedText"in S&&n(10,a=S.selectedText),"pageContent"in S&&n(11,i=S.pageContent),"lute"in S&&n(2,o=S.lute)},t.$$.update=()=>{t.$$.dirty&8&&m&&_(m)},[s,r,o,m,u,c,l,d,p,b,a,i,y,E,I,w,O]}class YF extends rt{constructor(e){super(),nt(this,e,KF,GF,tt,{settingStorage:1,promptStorage:0,selectedText:10,pageContent:11,lute:2})}}function kb(t,e,n){const r=new en.Dialog({title:"",content:'<div id="ai-instruction"></div>',width:"40%",hideCloseIcon:!0}),s=l_(),a=d_();t.getValue("apiKey").trim().length<=0&&to("请先设置API Key"),new kF({target:r.element.querySelector("#ai-instruction"),props:{settingStorage:t,promptStorage:e,documentVectorStorage:n,selectedText:s,pageContent:a,lute:window.Lute.New()}})}function Nb(t,e,n,r){const s=new en.Dialog({title:"",content:'<div id="ai-chat" style="height: 100%; margin: 0; padding: 0; overflow: hidden; display:flex;min-height: 0;"></div>',width:"50%",height:"60%",hideCloseIcon:!0});new wF({target:s.element.querySelector("#ai-chat"),props:{settingStorage:t,chatHistoryStorage:e,promptStorage:n,documentVectorStorage:r,lute:window.Lute.New()}})}function ZF(t,e){const n=new en.Dialog({title:"",content:'<div id="ai-prompt"></div>',width:"30%",hideCloseIcon:!0}),r=l_(),s=d_();t.getValue("apiKey").trim().length<=0&&to("请先设置API Key"),new YF({target:n.element.querySelector("#ai-prompt"),props:{settingStorage:t,promptStorage:e,selectedText:r,pageContent:s,lute:window.Lute.New()}})}function JF(t,e,n){const r=new en.Dialog({title:"",content:'<div id="ai-image" style="height: 100%; margin: 0; padding: 0; overflow: hidden; display:flex;min-height: 0;"></div>',width:"60%",height:"70%",hideCloseIcon:!0});new qF({target:r.element.querySelector("#ai-image"),props:{settingStorage:t,chatHistoryStorage:e,promptStorage:n,lute:window.Lute.New()}})}function Rb(t,e,n){const r=t.slice();return r[8]=e[n],r}function Pb(t){let e,n,r=t[0].i18n.settingGroup+"",s,a,i,o;function u(){return t[4](t[8])}return{c(){e=F("li"),n=F("span"),s=Ye(r),a=te(),C(n,"class","b3-list-item__text"),C(e,"data-name","editor"),C(e,"class","b3-list-item"),ke(e,"b3-list-item--focus",t[8]===t[2])},m(c,l){he(c,e,l),k(e,n),k(n,s),k(e,a),i||(o=[ie(e,"click",u),ie(e,"keydown",QF)],i=!0)},p(c,l){t=c,l&1&&r!==(r=t[0].i18n.settingGroup+"")&&dt(s,r),l&12&&ke(e,"b3-list-item--focus",t[8]===t[2])},d(c){c&&de(e),i=!1,ct(o)}}}function XF(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,f,g=Ot(t[3]),b=[];for(let _=0;_<g.length;_+=1)b[_]=Pb(Rb(t,g,_));return a=new Gy({props:{group:t[3][0],settingStorage:t[0],display:t[2]===t[3][0]}}),a.$on("changed",t[5]),u=new ec({props:{label:t[0].i18n.cancel,text:!0,outline:!0}}),u.$on("click",t[6]),m=new ec({props:{label:t[0].i18n.confirm,text:!1,outline:!1}}),m.$on("click",t[7]),{c(){e=F("div"),n=F("ul");for(let _=0;_<b.length;_+=1)b[_].c();r=te(),s=F("div"),Ve(a.$$.fragment),i=te(),o=F("div"),Ve(u.$$.fragment),c=te(),l=F("div"),d=te(),Ve(m.$$.fragment),C(n,"class","b3-tab-bar b3-list b3-list--background"),C(l,"class","fn__space"),C(o,"class",p="b3-dialog__action "+(t[2]==t[3][0]?"":"fn__none")),C(s,"class","config__tab-wrap"),C(e,"class","fn__flex-1 fn__flex config__panel")},m(_,y){he(_,e,y),k(e,n);for(let E=0;E<b.length;E+=1)b[E]&&b[E].m(n,null);k(e,r),k(e,s),Be(a,s,null),k(s,i),k(s,o),Be(u,o,null),k(o,c),k(o,l),k(o,d),Be(m,o,null),f=!0},p(_,[y]){if(y&13){g=Ot(_[3]);let O;for(O=0;O<g.length;O+=1){const S=Rb(_,g,O);b[O]?b[O].p(S,y):(b[O]=Pb(S),b[O].c(),b[O].m(n,null))}for(;O<b.length;O+=1)b[O].d(1);b.length=g.length}const E={};y&1&&(E.settingStorage=_[0]),y&4&&(E.display=_[2]===_[3][0]),a.$set(E);const I={};y&1&&(I.label=_[0].i18n.cancel),u.$set(I);const w={};y&1&&(w.label=_[0].i18n.confirm),m.$set(w),(!f||y&4&&p!==(p="b3-dialog__action "+(_[2]==_[3][0]?"":"fn__none")))&&C(o,"class",p)},i(_){f||(ae(a.$$.fragment,_),ae(u.$$.fragment,_),ae(m.$$.fragment,_),f=!0)},o(_){le(a.$$.fragment,_),le(u.$$.fragment,_),le(m.$$.fragment,_),f=!1},d(_){_&&de(e),Ns(b,_),Fe(a),Fe(u),Fe(m)}}}const QF=()=>{};function eU(t,e,n){let r=["🌈 设置"],s=r[0],{settingStorage:a}=e,{dialog:i}=e;const o=d=>{n(2,s=d)},u=({detail:d})=>{a.setValue(d.key,d.value)},c=()=>{a.load(),i.destroy()},l=()=>{a.save(),i.destroy()};return t.$$set=d=>{"settingStorage"in d&&n(0,a=d.settingStorage),"dialog"in d&&n(1,i=d.dialog)},[a,i,s,r,o,u,c,l]}class tU extends rt{constructor(e){super(),nt(this,e,eU,XF,tt,{settingStorage:0,dialog:1})}}const nU=`<symbol id="iconFace" viewBox="0 0 32 32">
<path d="M13.667 17.333c0 0.92-0.747 1.667-1.667 1.667s-1.667-0.747-1.667-1.667 0.747-1.667 1.667-1.667 1.667 0.747 1.667 1.667zM20 15.667c-0.92 0-1.667 0.747-1.667 1.667s0.747 1.667 1.667 1.667 1.667-0.747 1.667-1.667-0.747-1.667-1.667-1.667zM29.333 16c0 7.36-5.973 13.333-13.333 13.333s-13.333-5.973-13.333-13.333 5.973-13.333 13.333-13.333 13.333 5.973 13.333 13.333zM14.213 5.493c1.867 3.093 5.253 5.173 9.12 5.173 0.613 0 1.213-0.067 1.787-0.16-1.867-3.093-5.253-5.173-9.12-5.173-0.613 0-1.213 0.067-1.787 0.16zM5.893 12.627c2.28-1.293 4.040-3.4 4.88-5.92-2.28 1.293-4.040 3.4-4.88 5.92zM26.667 16c0-1.040-0.16-2.040-0.44-2.987-0.933 0.2-1.893 0.32-2.893 0.32-4.173 0-7.893-1.92-10.347-4.92-1.4 3.413-4.187 6.093-7.653 7.4 0.013 0.053 0 0.12 0 0.187 0 5.88 4.787 10.667 10.667 10.667s10.667-4.787 10.667-10.667z"></path>
</symbol>`,rU=`<symbol id="iconSaving" viewBox="0 0 32 32">
<path d="M20 13.333c0-0.733 0.6-1.333 1.333-1.333s1.333 0.6 1.333 1.333c0 0.733-0.6 1.333-1.333 1.333s-1.333-0.6-1.333-1.333zM10.667 12h6.667v-2.667h-6.667v2.667zM29.333 10v9.293l-3.76 1.253-2.24 7.453h-7.333v-2.667h-2.667v2.667h-7.333c0 0-3.333-11.28-3.333-15.333s3.28-7.333 7.333-7.333h6.667c1.213-1.613 3.147-2.667 5.333-2.667 1.107 0 2 0.893 2 2 0 0.28-0.053 0.533-0.16 0.773-0.187 0.453-0.347 0.973-0.427 1.533l3.027 3.027h2.893zM26.667 12.667h-1.333l-4.667-4.667c0-0.867 0.12-1.72 0.347-2.547-1.293 0.333-2.347 1.293-2.787 2.547h-8.227c-2.573 0-4.667 2.093-4.667 4.667 0 2.507 1.627 8.867 2.68 12.667h2.653v-2.667h8v2.667h2.68l2.067-6.867 3.253-1.093v-4.707z"></path>
</symbol>`,sU=`<symbol id="iconChat" viewBox="0 0 32 32">
  <path d="M16 2C8.268 2 2 8.268 2 16c0 2.25.54 4.373 1.5 6.25L1 29l6.75-2.5c1.876.96 4 1.5 6.25 1.5 7.732 0 14-6.268 14-14S23.732 2 16 2zm0 2c6.627 0 12 5.373 12 12s-5.373 12-12 12c-2.027 0-3.93-.506-5.602-1.397l-.467-.25-4.18 1.547 1.547-4.18-.25-.467C5.506 21.93 5 20.027 5 18c0-6.627 5.373-12 12-12zm-5 10v4h3v-4h-3zm7 0v4h3v-4h-3z"></path>
</symbol>
`,aU=`<symbol id="iconInstruction" viewBox="0 0 32 32">
  <path d="M28 16c0 6.627-5.373 12-12 12S4 22.627 4 16 9.373 4 16 4s12 5.373 12 12zM16 2C8.268 2 2 8.268 2 16s6.268 14 14 14 14-6.268 14-14S23.732 2 16 2zm-2 9.5v3h-2v3h2v3h4v-3h2v-3h-2v-3h-4zm1 1h2v2h2v1h-2v2h-2v-2h-2v-1h2v-2z"/>
</symbol>`;class iU extends en.Plugin{constructor(n){super(n);we(this,"_isMobile");we(this,"_settingStorage");we(this,"_promptStorage");we(this,"_chatHistoryStorage");we(this,"_imageHistoryStorage");we(this,"_documentVectorStorage");we(this,"_blockStorage");we(this,"_machineId");we(this,"_apiClient");this._apiClient=new QA,this._settingStorage=new cP(this,qd),this._promptStorage=new uP(this,zd),this._chatHistoryStorage=new wy(this,Vd),this._imageHistoryStorage=new oP(this,A2),this._isMobile=en.getFrontend()==="mobile"||en.getFrontend()==="browser-mobile"}async onload(){console.debug("onload...."),await this._settingStorage.load(),this.addIcons(nU),this.addIcons(rU),this.addIcons(sU),this.addIcons(aU),this.addTopBar({icon:"iconInstruction",title:this.i18n.instructionMode,position:"right",callback:()=>kb(this._settingStorage,this._promptStorage,this._documentVectorStorage)}),this.addTopBar({icon:"iconChat",title:"聊天模式",position:"right",callback:()=>Nb(this._settingStorage,this._chatHistoryStorage,this._promptStorage,this._documentVectorStorage)});let n=this._settingStorage.getValue("isVectorOnline"),r=this._settingStorage.getValue("phoneNumber"),s=this._settingStorage.getValue("apiKey"),a=this._settingStorage.getValue("includeKnowledgeBook"),i=this._settingStorage.getValue("excludeKnowledgeBook"),o=this._settingStorage.getValue("isKnowledge");const u=await $i(s);u.money<=0&&ea(this.i18n.balanceInsufficientMsg.replace("${balance}",String(Math.round(u.money*10)/10))),u.expiredTime<Math.floor(Date.now()/1e3)&&ea(this.i18n.apiKeyExpiredMsg),n&&r?this._documentVectorStorage=new Sx(this,Wd,s,r):this._documentVectorStorage=new Tx(this,Wd,s,r),this._machineId=await this.getMachineId(),console.debug("machineId:",this._machineId),this._blockStorage=new iP(this,E_,s,this._documentVectorStorage,a,i),$i(s).then(c=>{c.money>0&&c.expiredTime>Math.floor(Date.now()/1e3)&&(console.debug("apiKey 有效"),o&&this._blockStorage.load(),this._promptStorage.load(),this._chatHistoryStorage.load(),this._imageHistoryStorage.load())}),this.addCommand({langKey:"指令模式",hotkey:"⌥⌘K",callback:()=>kb(this._settingStorage,this._promptStorage,this._documentVectorStorage)}),this.addCommand({langKey:"聊天模式",hotkey:"⌥⌘L",callback:()=>Nb(this._settingStorage,this._chatHistoryStorage,this._promptStorage,this._documentVectorStorage)}),this.addCommand({langKey:"快捷指令",hotkey:"⌥⌘S",callback:()=>ZF(this._settingStorage,this._promptStorage)}),this.addCommand({langKey:"文生图",hotkey:"⇧⌘I",callback:()=>{JF(this._settingStorage,this._imageHistoryStorage,this._promptStorage)}}),console.debug("onload....end")}onLayoutReady(){}uninstall(){this.removeData(qd),this.removeData(zd),this.removeData(Vd),to("数据已清除，思源AI插件卸载成功！")}openSetting(){if(!this._settingStorage)return;if(this._isMobile){ea("请在桌面端使用");return}let n=new en.Dialog({title:"思源AI设置",width:"70%",height:"60%",content:'<div class="b3-dialog__content" id="AISettingPanel" ></div>'});new tU({target:n.element.querySelector("#AISettingPanel"),props:{settingStorage:this._settingStorage,dialog:n}})}getMachineId(){try{const n=window.navigator,r=window.screen,a=[n.userAgent,r.colorDepth,r.width,r.height,r.availWidth,r.availHeight,Intl.DateTimeFormat().resolvedOptions().timeZone].join("###");return btoa(a).replace(/[^a-zA-Z0-9]/g,"")}catch(n){return console.error("获取机器码失败:",n),""}}}module.exports=iU;
