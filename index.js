"use strict";var bT=Object.defineProperty;var _T=(t,e,n)=>e in t?bT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Te=(t,e,n)=>_T(t,typeof e!="symbol"?e+"":e,n);const dt=require("siyuan");var yT=Object.defineProperty,ET=(t,e,n)=>e in t?yT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,dn=(t,e,n)=>ET(t,typeof e!="symbol"?e+"":e,n);function Hb(t,e){return function(){return t.apply(e,arguments)}}const{toString:wT}=Object.prototype,{getPrototypeOf:ef}=Object,Cc=(t=>e=>{const n=wT.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Wn=t=>(t=t.toLowerCase(),e=>Cc(e)===t),vc=t=>e=>typeof e===t,{isArray:ya}=Array,Ci=vc("undefined");function TT(t){return t!==null&&!Ci(t)&&t.constructor!==null&&!Ci(t.constructor)&&mn(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const $b=Wn("ArrayBuffer");function ST(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&$b(t.buffer),e}const AT=vc("string"),mn=vc("function"),qb=vc("number"),Oc=t=>t!==null&&typeof t=="object",CT=t=>t===!0||t===!1,gu=t=>{if(Cc(t)!=="object")return!1;const e=ef(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},vT=Wn("Date"),OT=Wn("File"),kT=Wn("Blob"),IT=Wn("FileList"),NT=t=>Oc(t)&&mn(t.pipe),RT=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||mn(t.append)&&((e=Cc(t))==="formdata"||e==="object"&&mn(t.toString)&&t.toString()==="[object FormData]"))},PT=Wn("URLSearchParams"),[xT,LT,DT,MT]=["ReadableStream","Request","Response","Headers"].map(Wn),BT=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function no(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let r,s;if(typeof t!="object"&&(t=[t]),ya(t))for(r=0,s=t.length;r<s;r++)e.call(null,t[r],r,t);else{const a=n?Object.getOwnPropertyNames(t):Object.keys(t),i=a.length;let o;for(r=0;r<i;r++)o=a[r],e.call(null,t[o],o,t)}}function Vb(t,e){e=e.toLowerCase();const n=Object.keys(t);let r=n.length,s;for(;r-- >0;)if(s=n[r],e===s.toLowerCase())return s;return null}const us=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,zb=t=>!Ci(t)&&t!==us;function Dd(){const{caseless:t}=zb(this)&&this||{},e={},n=(r,s)=>{const a=t&&Vb(e,s)||s;gu(e[a])&&gu(r)?e[a]=Dd(e[a],r):gu(r)?e[a]=Dd({},r):ya(r)?e[a]=r.slice():e[a]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&no(arguments[r],n);return e}const FT=(t,e,n,{allOwnKeys:r}={})=>(no(e,(s,a)=>{n&&mn(s)?t[a]=Hb(s,n):t[a]=s},{allOwnKeys:r}),t),UT=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),jT=(t,e,n,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},HT=(t,e,n,r)=>{let s,a,i;const o={};if(e=e||{},t==null)return e;do{for(s=Object.getOwnPropertyNames(t),a=s.length;a-- >0;)i=s[a],(!r||r(i,t,e))&&!o[i]&&(e[i]=t[i],o[i]=!0);t=n!==!1&&ef(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},$T=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const r=t.indexOf(e,n);return r!==-1&&r===n},qT=t=>{if(!t)return null;if(ya(t))return t;let e=t.length;if(!qb(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},VT=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&ef(Uint8Array)),zT=(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=n.next())&&!r.done;){const s=r.value;e.call(t,s[0],s[1])}},WT=(t,e)=>{let n;const r=[];for(;(n=t.exec(e))!==null;)r.push(n);return r},GT=Wn("HTMLFormElement"),KT=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,r){return n.toUpperCase()+r}),Um=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),YT=Wn("RegExp"),Wb=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),r={};no(n,(s,a)=>{let i;(i=e(s,a,t))!==!1&&(r[a]=i||s)}),Object.defineProperties(t,r)},ZT=t=>{Wb(t,(e,n)=>{if(mn(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];if(mn(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},JT=(t,e)=>{const n={},r=s=>{s.forEach(a=>{n[a]=!0})};return ya(t)?r(t):r(String(t).split(e)),n},XT=()=>{},QT=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,wl="abcdefghijklmnopqrstuvwxyz",jm="0123456789",Gb={DIGIT:jm,ALPHA:wl,ALPHA_DIGIT:wl+wl.toUpperCase()+jm},eS=(t=16,e=Gb.ALPHA_DIGIT)=>{let n="";const{length:r}=e;for(;t--;)n+=e[Math.random()*r|0];return n};function tS(t){return!!(t&&mn(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const nS=t=>{const e=new Array(10),n=(r,s)=>{if(Oc(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const a=ya(r)?[]:{};return no(r,(i,o)=>{const u=n(i,s+1);!Ci(u)&&(a[o]=u)}),e[s]=void 0,a}}return r};return n(t,0)},rS=Wn("AsyncFunction"),sS=t=>t&&(Oc(t)||mn(t))&&mn(t.then)&&mn(t.catch),Kb=((t,e)=>t?setImmediate:e?((n,r)=>(us.addEventListener("message",({source:s,data:a})=>{s===us&&a===n&&r.length&&r.shift()()},!1),s=>{r.push(s),us.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",mn(us.postMessage)),aS=typeof queueMicrotask<"u"?queueMicrotask.bind(us):typeof process<"u"&&process.nextTick||Kb,q={isArray:ya,isArrayBuffer:$b,isBuffer:TT,isFormData:RT,isArrayBufferView:ST,isString:AT,isNumber:qb,isBoolean:CT,isObject:Oc,isPlainObject:gu,isReadableStream:xT,isRequest:LT,isResponse:DT,isHeaders:MT,isUndefined:Ci,isDate:vT,isFile:OT,isBlob:kT,isRegExp:YT,isFunction:mn,isStream:NT,isURLSearchParams:PT,isTypedArray:VT,isFileList:IT,forEach:no,merge:Dd,extend:FT,trim:BT,stripBOM:UT,inherits:jT,toFlatObject:HT,kindOf:Cc,kindOfTest:Wn,endsWith:$T,toArray:qT,forEachEntry:zT,matchAll:WT,isHTMLForm:GT,hasOwnProperty:Um,hasOwnProp:Um,reduceDescriptors:Wb,freezeMethods:ZT,toObjectSet:JT,toCamelCase:KT,noop:XT,toFiniteNumber:QT,findKey:Vb,global:us,isContextDefined:zb,ALPHABET:Gb,generateString:eS,isSpecCompliantForm:tS,toJSONObject:nS,isAsyncFn:rS,isThenable:sS,setImmediate:Kb,asap:aS};function Ae(t,e,n,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}q.inherits(Ae,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:q.toJSONObject(this.config),code:this.code,status:this.status}}});const Yb=Ae.prototype,Zb={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Zb[t]={value:t}});Object.defineProperties(Ae,Zb);Object.defineProperty(Yb,"isAxiosError",{value:!0});Ae.from=(t,e,n,r,s,a)=>{const i=Object.create(Yb);return q.toFlatObject(t,i,function(o){return o!==Error.prototype},o=>o!=="isAxiosError"),Ae.call(i,t.message,e,n,r,s),i.cause=t,i.name=t.name,a&&Object.assign(i,a),i};const iS=null;function Md(t){return q.isPlainObject(t)||q.isArray(t)}function Jb(t){return q.endsWith(t,"[]")?t.slice(0,-2):t}function Hm(t,e,n){return t?t.concat(e).map(function(r,s){return r=Jb(r),!n&&s?"["+r+"]":r}).join(n?".":""):e}function oS(t){return q.isArray(t)&&!t.some(Md)}const uS=q.toFlatObject(q,{},null,function(t){return/^is[A-Z]/.test(t)});function kc(t,e,n){if(!q.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=q.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(p,h){return!q.isUndefined(h[p])});const r=n.metaTokens,s=n.visitor||c,a=n.dots,i=n.indexes,o=(n.Blob||typeof Blob<"u"&&Blob)&&q.isSpecCompliantForm(e);if(!q.isFunction(s))throw new TypeError("visitor must be a function");function u(p){if(p===null)return"";if(q.isDate(p))return p.toISOString();if(!o&&q.isBlob(p))throw new Ae("Blob is not supported. Use a Buffer instead.");return q.isArrayBuffer(p)||q.isTypedArray(p)?o&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function c(p,h,g){let b=p;if(p&&!g&&typeof p=="object"){if(q.endsWith(h,"{}"))h=r?h:h.slice(0,-2),p=JSON.stringify(p);else if(q.isArray(p)&&oS(p)||(q.isFileList(p)||q.endsWith(h,"[]"))&&(b=q.toArray(p)))return h=Jb(h),b.forEach(function(_,y){!(q.isUndefined(_)||_===null)&&e.append(i===!0?Hm([h],y,a):i===null?h:h+"[]",u(_))}),!1}return Md(p)?!0:(e.append(Hm(g,h,a),u(p)),!1)}const l=[],d=Object.assign(uS,{defaultVisitor:c,convertValue:u,isVisitable:Md});function m(p,h){if(!q.isUndefined(p)){if(l.indexOf(p)!==-1)throw Error("Circular reference detected in "+h.join("."));l.push(p),q.forEach(p,function(g,b){(!(q.isUndefined(g)||g===null)&&s.call(e,g,q.isString(b)?b.trim():b,h,d))===!0&&m(g,h?h.concat(b):[b])}),l.pop()}}if(!q.isObject(t))throw new TypeError("data must be an object");return m(t),e}function $m(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function tf(t,e){this._pairs=[],t&&kc(t,this,e)}const Xb=tf.prototype;Xb.append=function(t,e){this._pairs.push([t,e])};Xb.toString=function(t){const e=t?function(n){return t.call(this,n,$m)}:$m;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};function cS(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Qb(t,e,n){if(!e)return t;const r=n&&n.encode||cS,s=n&&n.serialize;let a;if(s?a=s(e,n):a=q.isURLSearchParams(e)?e.toString():new tf(e,n).toString(r),a){const i=t.indexOf("#");i!==-1&&(t=t.slice(0,i)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class qm{constructor(){this.handlers=[]}use(e,n,r){return this.handlers.push({fulfilled:e,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){q.forEach(this.handlers,function(n){n!==null&&e(n)})}}const e_={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},lS=typeof URLSearchParams<"u"?URLSearchParams:tf,dS=typeof FormData<"u"?FormData:null,hS=typeof Blob<"u"?Blob:null,fS={isBrowser:!0,classes:{URLSearchParams:lS,FormData:dS,Blob:hS},protocols:["http","https","file","blob","url","data"]},nf=typeof window<"u"&&typeof document<"u",Bd=typeof navigator=="object"&&navigator||void 0,mS=nf&&(!Bd||["ReactNative","NativeScript","NS"].indexOf(Bd.product)<0),pS=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",gS=nf&&window.location.href||"http://localhost",bS=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:nf,hasStandardBrowserEnv:mS,hasStandardBrowserWebWorkerEnv:pS,navigator:Bd,origin:gS},Symbol.toStringTag,{value:"Module"})),nn={...bS,...fS};function _S(t,e){return kc(t,new nn.classes.URLSearchParams,Object.assign({visitor:function(n,r,s,a){return nn.isNode&&q.isBuffer(n)?(this.append(r,n.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function yS(t){return q.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function ES(t){const e={},n=Object.keys(t);let r;const s=n.length;let a;for(r=0;r<s;r++)a=n[r],e[a]=t[a];return e}function t_(t){function e(n,r,s,a){let i=n[a++];if(i==="__proto__")return!0;const o=Number.isFinite(+i),u=a>=n.length;return i=!i&&q.isArray(s)?s.length:i,u?(q.hasOwnProp(s,i)?s[i]=[s[i],r]:s[i]=r,!o):((!s[i]||!q.isObject(s[i]))&&(s[i]=[]),e(n,r,s[i],a)&&q.isArray(s[i])&&(s[i]=ES(s[i])),!o)}if(q.isFormData(t)&&q.isFunction(t.entries)){const n={};return q.forEachEntry(t,(r,s)=>{e(yS(r),s,n,0)}),n}return null}function wS(t,e,n){if(q.isString(t))try{return(e||JSON.parse)(t),q.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(0,JSON.stringify)(t)}const ro={transitional:e_,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",r=n.indexOf("application/json")>-1,s=q.isObject(t);if(s&&q.isHTMLForm(t)&&(t=new FormData(t)),q.isFormData(t))return r?JSON.stringify(t_(t)):t;if(q.isArrayBuffer(t)||q.isBuffer(t)||q.isStream(t)||q.isFile(t)||q.isBlob(t)||q.isReadableStream(t))return t;if(q.isArrayBufferView(t))return t.buffer;if(q.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return _S(t,this.formSerializer).toString();if((a=q.isFileList(t))||n.indexOf("multipart/form-data")>-1){const i=this.env&&this.env.FormData;return kc(a?{"files[]":t}:t,i&&new i,this.formSerializer)}}return s||r?(e.setContentType("application/json",!1),wS(t)):t}],transformResponse:[function(t){const e=this.transitional||ro.transitional,n=e&&e.forcedJSONParsing,r=this.responseType==="json";if(q.isResponse(t)||q.isReadableStream(t))return t;if(t&&q.isString(t)&&(n&&!this.responseType||r)){const s=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(t)}catch(a){if(s)throw a.name==="SyntaxError"?Ae.from(a,Ae.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:nn.classes.FormData,Blob:nn.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};q.forEach(["delete","get","head","post","put","patch"],t=>{ro.headers[t]={}});const TS=q.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),SS=t=>{const e={};let n,r,s;return t&&t.split(`
`).forEach(function(a){s=a.indexOf(":"),n=a.substring(0,s).trim().toLowerCase(),r=a.substring(s+1).trim(),!(!n||e[n]&&TS[n])&&(n==="set-cookie"?e[n]?e[n].push(r):e[n]=[r]:e[n]=e[n]?e[n]+", "+r:r)}),e},Vm=Symbol("internals");function Ba(t){return t&&String(t).trim().toLowerCase()}function bu(t){return t===!1||t==null?t:q.isArray(t)?t.map(bu):String(t)}function AS(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(t);)e[r[1]]=r[2];return e}const CS=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Tl(t,e,n,r,s){if(q.isFunction(r))return r.call(this,e,n);if(s&&(e=n),!!q.isString(e)){if(q.isString(r))return e.indexOf(r)!==-1;if(q.isRegExp(r))return r.test(e)}}function vS(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,r)=>n.toUpperCase()+r)}function OS(t,e){const n=q.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+n,{value:function(s,a,i){return this[r].call(this,e,s,a,i)},configurable:!0})})}let rn=class{constructor(t){t&&this.set(t)}set(t,e,n){const r=this;function s(i,o,u){const c=Ba(o);if(!c)throw new Error("header name must be a non-empty string");const l=q.findKey(r,c);(!l||r[l]===void 0||u===!0||u===void 0&&r[l]!==!1)&&(r[l||o]=bu(i))}const a=(i,o)=>q.forEach(i,(u,c)=>s(u,c,o));if(q.isPlainObject(t)||t instanceof this.constructor)a(t,e);else if(q.isString(t)&&(t=t.trim())&&!CS(t))a(SS(t),e);else if(q.isHeaders(t))for(const[i,o]of t.entries())s(o,i,n);else t!=null&&s(e,t,n);return this}get(t,e){if(t=Ba(t),t){const n=q.findKey(this,t);if(n){const r=this[n];if(!e)return r;if(e===!0)return AS(r);if(q.isFunction(e))return e.call(this,r,n);if(q.isRegExp(e))return e.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=Ba(t),t){const n=q.findKey(this,t);return!!(n&&this[n]!==void 0&&(!e||Tl(this,this[n],n,e)))}return!1}delete(t,e){const n=this;let r=!1;function s(a){if(a=Ba(a),a){const i=q.findKey(n,a);i&&(!e||Tl(n,n[i],i,e))&&(delete n[i],r=!0)}}return q.isArray(t)?t.forEach(s):s(t),r}clear(t){const e=Object.keys(this);let n=e.length,r=!1;for(;n--;){const s=e[n];(!t||Tl(this,this[s],s,t,!0))&&(delete this[s],r=!0)}return r}normalize(t){const e=this,n={};return q.forEach(this,(r,s)=>{const a=q.findKey(n,s);if(a){e[a]=bu(r),delete e[s];return}const i=t?vS(s):String(s).trim();i!==s&&delete e[s],e[i]=bu(r),n[i]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return q.forEach(this,(n,r)=>{n!=null&&n!==!1&&(e[r]=t&&q.isArray(n)?n.join(", "):n)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const n=new this(t);return e.forEach(r=>n.set(r)),n}static accessor(t){const e=(this[Vm]=this[Vm]={accessors:{}}).accessors,n=this.prototype;function r(s){const a=Ba(s);e[a]||(OS(n,s),e[a]=!0)}return q.isArray(t)?t.forEach(r):r(t),this}};rn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);q.reduceDescriptors(rn.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[n]=r}}});q.freezeMethods(rn);function Sl(t,e){const n=this||ro,r=e||n,s=rn.from(r.headers);let a=r.data;return q.forEach(t,function(i){a=i.call(n,a,s.normalize(),e?e.status:void 0)}),s.normalize(),a}function n_(t){return!!(t&&t.__CANCEL__)}function Ea(t,e,n){Ae.call(this,t??"canceled",Ae.ERR_CANCELED,e,n),this.name="CanceledError"}q.inherits(Ea,Ae,{__CANCEL__:!0});function r_(t,e,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?t(n):e(new Ae("Request failed with status code "+n.status,[Ae.ERR_BAD_REQUEST,Ae.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function kS(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function IS(t,e){t=t||10;const n=new Array(t),r=new Array(t);let s=0,a=0,i;return e=e!==void 0?e:1e3,function(o){const u=Date.now(),c=r[a];i||(i=u),n[s]=o,r[s]=u;let l=a,d=0;for(;l!==s;)d+=n[l++],l=l%t;if(s=(s+1)%t,s===a&&(a=(a+1)%t),u-i<e)return;const m=c&&u-c;return m?Math.round(d*1e3/m):void 0}}function NS(t,e){let n=0,r=1e3/e,s,a;const i=(o,u=Date.now())=>{n=u,s=null,a&&(clearTimeout(a),a=null),t.apply(null,o)};return[(...o)=>{const u=Date.now(),c=u-n;c>=r?i(o,u):(s=o,a||(a=setTimeout(()=>{a=null,i(s)},r-c)))},()=>s&&i(s)]}const Pu=(t,e,n=3)=>{let r=0;const s=IS(50,250);return NS(a=>{const i=a.loaded,o=a.lengthComputable?a.total:void 0,u=i-r,c=s(u),l=i<=o;r=i;const d={loaded:i,total:o,progress:o?i/o:void 0,bytes:u,rate:c||void 0,estimated:c&&o&&l?(o-i)/c:void 0,event:a,lengthComputable:o!=null,[e?"download":"upload"]:!0};t(d)},n)},zm=(t,e)=>{const n=t!=null;return[r=>e[0]({lengthComputable:n,total:t,loaded:r}),e[1]]},Wm=t=>(...e)=>q.asap(()=>t(...e)),RS=nn.hasStandardBrowserEnv?function(){const t=nn.navigator&&/(msie|trident)/i.test(nn.navigator.userAgent),e=document.createElement("a");let n;function r(s){let a=s;return t&&(e.setAttribute("href",a),a=e.href),e.setAttribute("href",a),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return n=r(window.location.href),function(s){const a=q.isString(s)?r(s):s;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}(),PS=nn.hasStandardBrowserEnv?{write(t,e,n,r,s,a){const i=[t+"="+encodeURIComponent(e)];q.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),q.isString(r)&&i.push("path="+r),q.isString(s)&&i.push("domain="+s),a===!0&&i.push("secure"),document.cookie=i.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function xS(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function LS(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function s_(t,e){return t&&!xS(e)?LS(t,e):e}const Gm=t=>t instanceof rn?{...t}:t;function Es(t,e){e=e||{};const n={};function r(c,l,d){return q.isPlainObject(c)&&q.isPlainObject(l)?q.merge.call({caseless:d},c,l):q.isPlainObject(l)?q.merge({},l):q.isArray(l)?l.slice():l}function s(c,l,d){if(q.isUndefined(l)){if(!q.isUndefined(c))return r(void 0,c,d)}else return r(c,l,d)}function a(c,l){if(!q.isUndefined(l))return r(void 0,l)}function i(c,l){if(q.isUndefined(l)){if(!q.isUndefined(c))return r(void 0,c)}else return r(void 0,l)}function o(c,l,d){if(d in e)return r(c,l);if(d in t)return r(void 0,c)}const u={url:a,method:a,data:a,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:o,headers:(c,l)=>s(Gm(c),Gm(l),!0)};return q.forEach(Object.keys(Object.assign({},t,e)),function(c){const l=u[c]||s,d=l(t[c],e[c],c);q.isUndefined(d)&&l!==o||(n[c]=d)}),n}const a_=t=>{const e=Es({},t);let{data:n,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:a,headers:i,auth:o}=e;e.headers=i=rn.from(i),e.url=Qb(s_(e.baseURL,e.url),t.params,t.paramsSerializer),o&&i.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let u;if(q.isFormData(n)){if(nn.hasStandardBrowserEnv||nn.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((u=i.getContentType())!==!1){const[c,...l]=u?u.split(";").map(d=>d.trim()).filter(Boolean):[];i.setContentType([c||"multipart/form-data",...l].join("; "))}}if(nn.hasStandardBrowserEnv&&(r&&q.isFunction(r)&&(r=r(e)),r||r!==!1&&RS(e.url))){const c=s&&a&&PS.read(a);c&&i.set(s,c)}return e},DS=typeof XMLHttpRequest<"u",MS=DS&&function(t){return new Promise(function(e,n){const r=a_(t);let s=r.data;const a=rn.from(r.headers).normalize();let{responseType:i,onUploadProgress:o,onDownloadProgress:u}=r,c,l,d,m,p;function h(){m&&m(),p&&p(),r.cancelToken&&r.cancelToken.unsubscribe(c),r.signal&&r.signal.removeEventListener("abort",c)}let g=new XMLHttpRequest;g.open(r.method.toUpperCase(),r.url,!0),g.timeout=r.timeout;function b(){if(!g)return;const y=rn.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),E={data:!i||i==="text"||i==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:y,config:t,request:g};r_(function(I){e(I),h()},function(I){n(I),h()},E),g=null}"onloadend"in g?g.onloadend=b:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(b)},g.onabort=function(){g&&(n(new Ae("Request aborted",Ae.ECONNABORTED,t,g)),g=null)},g.onerror=function(){n(new Ae("Network Error",Ae.ERR_NETWORK,t,g)),g=null},g.ontimeout=function(){let y=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const E=r.transitional||e_;r.timeoutErrorMessage&&(y=r.timeoutErrorMessage),n(new Ae(y,E.clarifyTimeoutError?Ae.ETIMEDOUT:Ae.ECONNABORTED,t,g)),g=null},s===void 0&&a.setContentType(null),"setRequestHeader"in g&&q.forEach(a.toJSON(),function(y,E){g.setRequestHeader(E,y)}),q.isUndefined(r.withCredentials)||(g.withCredentials=!!r.withCredentials),i&&i!=="json"&&(g.responseType=r.responseType),u&&([d,p]=Pu(u,!0),g.addEventListener("progress",d)),o&&g.upload&&([l,m]=Pu(o),g.upload.addEventListener("progress",l),g.upload.addEventListener("loadend",m)),(r.cancelToken||r.signal)&&(c=y=>{g&&(n(!y||y.type?new Ea(null,t,g):y),g.abort(),g=null)},r.cancelToken&&r.cancelToken.subscribe(c),r.signal&&(r.signal.aborted?c():r.signal.addEventListener("abort",c)));const _=kS(r.url);if(_&&nn.protocols.indexOf(_)===-1){n(new Ae("Unsupported protocol "+_+":",Ae.ERR_BAD_REQUEST,t));return}g.send(s||null)})},BS=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let r=new AbortController,s;const a=function(c){if(!s){s=!0,o();const l=c instanceof Error?c:this.reason;r.abort(l instanceof Ae?l:new Ea(l instanceof Error?l.message:l))}};let i=e&&setTimeout(()=>{i=null,a(new Ae(`timeout ${e} of ms exceeded`,Ae.ETIMEDOUT))},e);const o=()=>{t&&(i&&clearTimeout(i),i=null,t.forEach(c=>{c.unsubscribe?c.unsubscribe(a):c.removeEventListener("abort",a)}),t=null)};t.forEach(c=>c.addEventListener("abort",a));const{signal:u}=r;return u.unsubscribe=()=>q.asap(o),u}},FS=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let r=0,s;for(;r<n;)s=r+e,yield t.slice(r,s),r=s},US=async function*(t,e){for await(const n of jS(t))yield*FS(n,e)},jS=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:r}=await e.read();if(n)break;yield r}}finally{await e.cancel()}},Km=(t,e,n,r)=>{const s=US(t,e);let a=0,i,o=u=>{i||(i=!0,r&&r(u))};return new ReadableStream({async pull(u){try{const{done:c,value:l}=await s.next();if(c){o(),u.close();return}let d=l.byteLength;if(n){let m=a+=d;n(m)}u.enqueue(new Uint8Array(l))}catch(c){throw o(c),c}},cancel(u){return o(u),s.return()}},{highWaterMark:2})},Ic=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",i_=Ic&&typeof ReadableStream=="function",HS=Ic&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),o_=(t,...e)=>{try{return!!t(...e)}catch{return!1}},$S=i_&&o_(()=>{let t=!1;const e=new Request(nn.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),Ym=64*1024,Fd=i_&&o_(()=>q.isReadableStream(new Response("").body)),xu={stream:Fd&&(t=>t.body)};Ic&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!xu[e]&&(xu[e]=q.isFunction(t[e])?n=>n[e]():(n,r)=>{throw new Ae(`Response type '${e}' is not supported`,Ae.ERR_NOT_SUPPORT,r)})})})(new Response);const qS=async t=>{if(t==null)return 0;if(q.isBlob(t))return t.size;if(q.isSpecCompliantForm(t))return(await new Request(nn.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(q.isArrayBufferView(t)||q.isArrayBuffer(t))return t.byteLength;if(q.isURLSearchParams(t)&&(t=t+""),q.isString(t))return(await HS(t)).byteLength},VS=async(t,e)=>q.toFiniteNumber(t.getContentLength())??qS(e),zS=Ic&&(async t=>{let{url:e,method:n,data:r,signal:s,cancelToken:a,timeout:i,onDownloadProgress:o,onUploadProgress:u,responseType:c,headers:l,withCredentials:d="same-origin",fetchOptions:m}=a_(t);c=c?(c+"").toLowerCase():"text";let p=BS([s,a&&a.toAbortSignal()],i),h;const g=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let b;try{if(u&&$S&&n!=="get"&&n!=="head"&&(b=await VS(l,r))!==0){let w=new Request(e,{method:"POST",body:r,duplex:"half"}),R;if(q.isFormData(r)&&(R=w.headers.get("content-type"))&&l.setContentType(R),w.body){const[v,j]=zm(b,Pu(Wm(u)));r=Km(w.body,Ym,v,j)}}q.isString(d)||(d=d?"include":"omit");const _="credentials"in Request.prototype;h=new Request(e,{...m,signal:p,method:n.toUpperCase(),headers:l.normalize().toJSON(),body:r,duplex:"half",credentials:_?d:void 0});let y=await fetch(h);const E=Fd&&(c==="stream"||c==="response");if(Fd&&(o||E&&g)){const w={};["status","statusText","headers"].forEach(F=>{w[F]=y[F]});const R=q.toFiniteNumber(y.headers.get("content-length")),[v,j]=o&&zm(R,Pu(Wm(o),!0))||[];y=new Response(Km(y.body,Ym,v,()=>{j&&j(),g&&g()}),w)}c=c||"text";let I=await xu[q.findKey(xu,c)||"text"](y,t);return!E&&g&&g(),await new Promise((w,R)=>{r_(w,R,{data:I,headers:rn.from(y.headers),status:y.status,statusText:y.statusText,config:t,request:h})})}catch(_){throw g&&g(),_&&_.name==="TypeError"&&/fetch/i.test(_.message)?Object.assign(new Ae("Network Error",Ae.ERR_NETWORK,t,h),{cause:_.cause||_}):Ae.from(_,_&&_.code,t,h)}}),Ud={http:iS,xhr:MS,fetch:zS};q.forEach(Ud,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const Zm=t=>`- ${t}`,WS=t=>q.isFunction(t)||t===null||t===!1,u_={getAdapter:t=>{t=q.isArray(t)?t:[t];const{length:e}=t;let n,r;const s={};for(let a=0;a<e;a++){n=t[a];let i;if(r=n,!WS(n)&&(r=Ud[(i=String(n)).toLowerCase()],r===void 0))throw new Ae(`Unknown adapter '${i}'`);if(r)break;s[i||"#"+a]=r}if(!r){const a=Object.entries(s).map(([o,u])=>`adapter ${o} `+(u===!1?"is not supported by the environment":"is not available in the build"));let i=e?a.length>1?`since :
`+a.map(Zm).join(`
`):" "+Zm(a[0]):"as no adapter specified";throw new Ae("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return r},adapters:Ud};function Al(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Ea(null,t)}function Jm(t){return Al(t),t.headers=rn.from(t.headers),t.data=Sl.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),u_.getAdapter(t.adapter||ro.adapter)(t).then(function(e){return Al(t),e.data=Sl.call(t,t.transformResponse,e),e.headers=rn.from(e.headers),e},function(e){return n_(e)||(Al(t),e&&e.response&&(e.response.data=Sl.call(t,t.transformResponse,e.response),e.response.headers=rn.from(e.response.headers))),Promise.reject(e)})}const c_="1.7.7",rf={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{rf[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const Xm={};rf.transitional=function(t,e,n){function r(s,a){return"[Axios v"+c_+"] Transitional option '"+s+"'"+a+(n?". "+n:"")}return(s,a,i)=>{if(t===!1)throw new Ae(r(a," has been removed"+(e?" in "+e:"")),Ae.ERR_DEPRECATED);return e&&!Xm[a]&&(Xm[a]=!0,console.warn(r(a," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(s,a,i):!0}};function GS(t,e,n){if(typeof t!="object")throw new Ae("options must be an object",Ae.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let s=r.length;for(;s-- >0;){const a=r[s],i=e[a];if(i){const o=t[a],u=o===void 0||i(o,a,t);if(u!==!0)throw new Ae("option "+a+" must be "+u,Ae.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Ae("Unknown option "+a,Ae.ERR_BAD_OPTION)}}const jd={assertOptions:GS,validators:rf},xr=jd.validators;let ms=class{constructor(t){this.defaults=t,this.interceptors={request:new qm,response:new qm}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const s=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=Es(this.defaults,e);const{transitional:n,paramsSerializer:r,headers:s}=e;n!==void 0&&jd.assertOptions(n,{silentJSONParsing:xr.transitional(xr.boolean),forcedJSONParsing:xr.transitional(xr.boolean),clarifyTimeoutError:xr.transitional(xr.boolean)},!1),r!=null&&(q.isFunction(r)?e.paramsSerializer={serialize:r}:jd.assertOptions(r,{encode:xr.function,serialize:xr.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let a=s&&q.merge(s.common,s[e.method]);s&&q.forEach(["delete","get","head","post","put","patch","common"],p=>{delete s[p]}),e.headers=rn.concat(a,s);const i=[];let o=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(e)===!1||(o=o&&p.synchronous,i.unshift(p.fulfilled,p.rejected))});const u=[];this.interceptors.response.forEach(function(p){u.push(p.fulfilled,p.rejected)});let c,l=0,d;if(!o){const p=[Jm.bind(this),void 0];for(p.unshift.apply(p,i),p.push.apply(p,u),d=p.length,c=Promise.resolve(e);l<d;)c=c.then(p[l++],p[l++]);return c}d=i.length;let m=e;for(l=0;l<d;){const p=i[l++],h=i[l++];try{m=p(m)}catch(g){h.call(this,g);break}}try{c=Jm.call(this,m)}catch(p){return Promise.reject(p)}for(l=0,d=u.length;l<d;)c=c.then(u[l++],u[l++]);return c}getUri(t){t=Es(this.defaults,t);const e=s_(t.baseURL,t.url);return Qb(e,t.params,t.paramsSerializer)}};q.forEach(["delete","get","head","options"],function(t){ms.prototype[t]=function(e,n){return this.request(Es(n||{},{method:t,url:e,data:(n||{}).data}))}});q.forEach(["post","put","patch"],function(t){function e(n){return function(r,s,a){return this.request(Es(a||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:s}))}}ms.prototype[t]=e(),ms.prototype[t+"Form"]=e(!0)});let KS=class l_{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(s){n=s});const r=this;this.promise.then(s=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](s);r._listeners=null}),this.promise.then=s=>{let a;const i=new Promise(o=>{r.subscribe(o),a=o}).then(s);return i.cancel=function(){r.unsubscribe(a)},i},e(function(s,a,i){r.reason||(r.reason=new Ea(s,a,i),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=r=>{e.abort(r)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new l_(function(n){e=n}),cancel:e}}};function YS(t){return function(e){return t.apply(null,e)}}function ZS(t){return q.isObject(t)&&t.isAxiosError===!0}const Hd={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Hd).forEach(([t,e])=>{Hd[e]=t});function d_(t){const e=new ms(t),n=Hb(ms.prototype.request,e);return q.extend(n,ms.prototype,e,{allOwnKeys:!0}),q.extend(n,e,null,{allOwnKeys:!0}),n.create=function(r){return d_(Es(t,r))},n}const ht=d_(ro);ht.Axios=ms;ht.CanceledError=Ea;ht.CancelToken=KS;ht.isCancel=n_;ht.VERSION=c_;ht.toFormData=kc;ht.AxiosError=Ae;ht.Cancel=ht.CanceledError;ht.all=function(t){return Promise.all(t)};ht.spread=YS;ht.isAxiosError=ZS;ht.mergeConfig=Es;ht.AxiosHeaders=rn;ht.formToJSON=t=>t_(q.isHTMLForm(t)?new FormData(t):t);ht.getAdapter=u_.getAdapter;ht.HttpStatusCode=Hd;ht.default=ht;const{Axios:_U,AxiosError:yU,CanceledError:EU,isCancel:wU,CancelToken:TU,VERSION:SU,all:AU,Cancel:CU,isAxiosError:vU,spread:OU,toFormData:kU,AxiosHeaders:JS,HttpStatusCode:No,formToJSON:IU,getAdapter:NU,mergeConfig:RU}=ht;var Vs=null;typeof WebSocket<"u"?Vs=WebSocket:typeof MozWebSocket<"u"?Vs=MozWebSocket:typeof global<"u"?Vs=global.WebSocket||global.MozWebSocket:typeof window<"u"?Vs=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(Vs=self.WebSocket||self.MozWebSocket);const XS=Vs,Nc=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder;typeof TextEncoder=="function"&&new TextEncoder;const QS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Xa=Array.prototype.slice.call(QS),Ro=(t=>{let e={};return t.forEach((n,r)=>e[n]=r),e})(Xa),eA=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,_u=String.fromCharCode.bind(String),Qm=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),tA=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),h_=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),nA=t=>{let e,n,r,s,a="";const i=t.length%3;for(let o=0;o<t.length;){if((n=t.charCodeAt(o++))>255||(r=t.charCodeAt(o++))>255||(s=t.charCodeAt(o++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|s,a+=Xa[e>>18&63]+Xa[e>>12&63]+Xa[e>>6&63]+Xa[e&63]}return i?a.slice(0,i-3)+"===".substring(i):a},rA=typeof btoa=="function"?t=>btoa(t):Nc?t=>Buffer.from(t,"binary").toString("base64"):nA,ep=Nc?t=>Buffer.from(t).toString("base64"):t=>{let e=[];for(let n=0,r=t.length;n<r;n+=4096)e.push(_u.apply(null,t.subarray(n,n+4096)));return rA(e.join(""))},sA=(t,e=!1)=>e?tA(ep(t)):ep(t),aA=t=>{if(t=t.replace(/\s+/g,""),!eA.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",r,s;for(let a=0;a<t.length;)e=Ro[t.charAt(a++)]<<18|Ro[t.charAt(a++)]<<12|(r=Ro[t.charAt(a++)])<<6|(s=Ro[t.charAt(a++)]),n+=r===64?_u(e>>16&255):s===64?_u(e>>16&255,e>>8&255):_u(e>>16&255,e>>8&255,e&255);return n},iA=typeof atob=="function"?t=>atob(h_(t)):Nc?t=>Buffer.from(t,"base64").toString("binary"):aA,oA=Nc?t=>Qm(Buffer.from(t,"base64")):t=>Qm(iA(t).split("").map(e=>e.charCodeAt(0))),uA=t=>oA(cA(t)),cA=t=>h_(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),lA=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,dA=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,hA=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function fA(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){mA(t);return}return e}function mA(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function pA(t,e={}){if(typeof t!="string")return t;const n=t.trim();if(t[0]==='"'&&t.endsWith('"')&&!t.includes("\\"))return n.slice(1,-1);if(n.length<=9){const r=n.toLowerCase();if(r==="true")return!0;if(r==="false")return!1;if(r==="undefined")return;if(r==="null")return null;if(r==="nan")return Number.NaN;if(r==="infinity")return Number.POSITIVE_INFINITY;if(r==="-infinity")return Number.NEGATIVE_INFINITY}if(!hA.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(lA.test(t)||dA.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,fA)}return JSON.parse(t)}catch(r){if(e.strict)throw r;return t}}const gA=/#/g,bA=/&/g,_A=/\//g,yA=/=/g,sf=/\+/g,EA=/%5e/gi,wA=/%60/gi,TA=/%7c/gi,SA=/%20/gi;function AA(t){return encodeURI(""+t).replace(TA,"|")}function $d(t){return AA(typeof t=="string"?t:JSON.stringify(t)).replace(sf,"%2B").replace(SA,"+").replace(gA,"%23").replace(bA,"%26").replace(wA,"`").replace(EA,"^").replace(_A,"%2F")}function Cl(t){return $d(t).replace(yA,"%3D")}function f_(t=""){try{return decodeURIComponent(""+t)}catch{return""+t}}function CA(t){return f_(t.replace(sf," "))}function vA(t){return f_(t.replace(sf," "))}function OA(t=""){const e={};t[0]==="?"&&(t=t.slice(1));for(const n of t.split("&")){const r=n.match(/([^=]+)=?(.*)/)||[];if(r.length<2)continue;const s=CA(r[1]);if(s==="__proto__"||s==="constructor")continue;const a=vA(r[2]||"");e[s]===void 0?e[s]=a:Array.isArray(e[s])?e[s].push(a):e[s]=[e[s],a]}return e}function kA(t,e){return(typeof e=="number"||typeof e=="boolean")&&(e=String(e)),e?Array.isArray(e)?e.map(n=>`${Cl(t)}=${$d(n)}`).join("&"):`${Cl(t)}=${$d(e)}`:Cl(t)}function IA(t){return Object.keys(t).filter(e=>t[e]!==void 0).map(e=>kA(e,t[e])).filter(Boolean).join("&")}const NA=/^[\s\w\0+.-]{2,}:([/\\]{1,2})/,RA=/^[\s\w\0+.-]{2,}:([/\\]{2})?/,PA=/^([/\\]\s*){2,}[^/\\]/,xA=/^\.?\//;function m_(t,e={}){return typeof e=="boolean"&&(e={acceptRelative:e}),e.strict?NA.test(t):RA.test(t)||(e.acceptRelative?PA.test(t):!1)}function LA(t="",e){return t.endsWith("/")}function DA(t="",e){return(LA(t)?t.slice(0,-1):t)||"/"}function MA(t="",e){return t.endsWith("/")?t:t+"/"}function BA(t,e){if(UA(e)||m_(t))return t;const n=DA(e);return t.startsWith(n)?t:HA(n,t)}function FA(t,e){const n=$A(t),r={...OA(n.search),...e};return n.search=IA(r),qA(n)}function UA(t){return!t||t==="/"}function jA(t){return t&&t!=="/"}function HA(t,...e){let n=t||"";for(const r of e.filter(s=>jA(s)))if(n){const s=r.replace(xA,"");n=MA(n)+s}else n=r;return n}const p_=Symbol.for("ufo:protocolRelative");function $A(t="",e){const n=t.match(/^[\s\0]*(blob:|data:|javascript:|vbscript:)(.*)/i);if(n){const[,d,m=""]=n;return{protocol:d.toLowerCase(),pathname:m,href:d+m,auth:"",host:"",search:"",hash:""}}if(!m_(t,{acceptRelative:!0}))return tp(t);const[,r="",s,a=""]=t.replace(/\\/g,"/").match(/^[\s\0]*([\w+.-]{2,}:)?\/\/([^/@]+@)?(.*)/)||[];let[,i="",o=""]=a.match(/([^#/?]*)(.*)?/)||[];r==="file:"&&(o=o.replace(/\/(?=[A-Za-z]:)/,""));const{pathname:u,search:c,hash:l}=tp(o);return{protocol:r.toLowerCase(),auth:s?s.slice(0,Math.max(0,s.length-1)):"",host:i,pathname:u,search:c,hash:l,[p_]:!r}}function tp(t=""){const[e="",n="",r=""]=(t.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:e,search:n,hash:r}}function qA(t){const e=t.pathname||"",n=t.search?(t.search.startsWith("?")?"":"?")+t.search:"",r=t.hash||"",s=t.auth?t.auth+"@":"",a=t.host||"";return(t.protocol||t[p_]?(t.protocol||"")+"//":"")+s+a+e+n+r}class VA extends Error{constructor(e,n){super(e,n),this.name="FetchError",n!=null&&n.cause&&!this.cause&&(this.cause=n.cause)}}function zA(t){var e,n,r,s,a;const i=((e=t.error)==null?void 0:e.message)||((n=t.error)==null?void 0:n.toString())||"",o=((r=t.request)==null?void 0:r.method)||((s=t.options)==null?void 0:s.method)||"GET",u=((a=t.request)==null?void 0:a.url)||String(t.request)||"/",c=`[${o}] ${JSON.stringify(u)}`,l=t.response?`${t.response.status} ${t.response.statusText}`:"<no response>",d=`${c}: ${l}${i?` ${i}`:""}`,m=new VA(d,t.error?{cause:t.error}:void 0);for(const p of["request","options","response"])Object.defineProperty(m,p,{get(){return t[p]}});for(const[p,h]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(m,p,{get(){return t.response&&t.response[h]}});return m}const WA=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function np(t="GET"){return WA.has(t.toUpperCase())}function GA(t){if(t===void 0)return!1;const e=typeof t;return e==="string"||e==="number"||e==="boolean"||e===null?!0:e!=="object"?!1:Array.isArray(t)?!0:t.buffer?!1:t.constructor&&t.constructor.name==="Object"||typeof t.toJSON=="function"}const KA=new Set(["image/svg","application/xml","application/xhtml","application/html"]),YA=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function ZA(t=""){if(!t)return"json";const e=t.split(";").shift()||"";return YA.test(e)?"json":KA.has(e)||e.startsWith("text/")?"text":"blob"}function JA(t,e,n,r){const s=XA((e==null?void 0:e.headers)??(t==null?void 0:t.headers),n==null?void 0:n.headers,r);let a;return(n!=null&&n.query||n!=null&&n.params||e!=null&&e.params||e!=null&&e.query)&&(a={...n==null?void 0:n.params,...n==null?void 0:n.query,...e==null?void 0:e.params,...e==null?void 0:e.query}),{...n,...e,query:a,params:a,headers:s}}function XA(t,e,n){if(!e)return new n(t);const r=new n(e);if(t)for(const[s,a]of Symbol.iterator in t||Array.isArray(t)?t:new n(t))r.set(s,a);return r}async function Po(t,e){if(e)if(Array.isArray(e))for(const n of e)await n(t);else await e(t)}const QA=new Set([408,409,425,429,500,502,503,504]),e2=new Set([101,204,205,304]);function g_(t={}){const{fetch:e=globalThis.fetch,Headers:n=globalThis.Headers,AbortController:r=globalThis.AbortController}=t;async function s(o){const u=o.error&&o.error.name==="AbortError"&&!o.options.timeout||!1;if(o.options.retry!==!1&&!u){let l;typeof o.options.retry=="number"?l=o.options.retry:l=np(o.options.method)?0:1;const d=o.response&&o.response.status||500;if(l>0&&(Array.isArray(o.options.retryStatusCodes)?o.options.retryStatusCodes.includes(d):QA.has(d))){const m=typeof o.options.retryDelay=="function"?o.options.retryDelay(o):o.options.retryDelay||0;return m>0&&await new Promise(p=>setTimeout(p,m)),a(o.request,{...o.options,retry:l-1})}}const c=zA(o);throw Error.captureStackTrace&&Error.captureStackTrace(c,a),c}const a=async function(o,u={}){const c={request:o,options:JA(o,u,t.defaults,n),response:void 0,error:void 0};c.options.method&&(c.options.method=c.options.method.toUpperCase()),c.options.onRequest&&await Po(c,c.options.onRequest),typeof c.request=="string"&&(c.options.baseURL&&(c.request=BA(c.request,c.options.baseURL)),c.options.query&&(c.request=FA(c.request,c.options.query),delete c.options.query),"query"in c.options&&delete c.options.query,"params"in c.options&&delete c.options.params),c.options.body&&np(c.options.method)&&(GA(c.options.body)?(c.options.body=typeof c.options.body=="string"?c.options.body:JSON.stringify(c.options.body),c.options.headers=new n(c.options.headers||{}),c.options.headers.has("content-type")||c.options.headers.set("content-type","application/json"),c.options.headers.has("accept")||c.options.headers.set("accept","application/json")):("pipeTo"in c.options.body&&typeof c.options.body.pipeTo=="function"||typeof c.options.body.pipe=="function")&&("duplex"in c.options||(c.options.duplex="half")));let l;if(!c.options.signal&&c.options.timeout){const d=new r;l=setTimeout(()=>{const m=new Error("[TimeoutError]: The operation was aborted due to timeout");m.name="TimeoutError",m.code=23,d.abort(m)},c.options.timeout),c.options.signal=d.signal}try{c.response=await e(c.request,c.options)}catch(d){return c.error=d,c.options.onRequestError&&await Po(c,c.options.onRequestError),await s(c)}finally{l&&clearTimeout(l)}if((c.response.body||c.response._bodyInit)&&!e2.has(c.response.status)&&c.options.method!=="HEAD"){const d=(c.options.parseResponse?"json":c.options.responseType)||ZA(c.response.headers.get("content-type")||"");switch(d){case"json":{const m=await c.response.text(),p=c.options.parseResponse||pA;c.response._data=p(m);break}case"stream":{c.response._data=c.response.body||c.response._bodyInit;break}default:c.response._data=await c.response[d]()}}return c.options.onResponse&&await Po(c,c.options.onResponse),!c.options.ignoreResponseError&&c.response.status>=400&&c.response.status<600?(c.options.onResponseError&&await Po(c,c.options.onResponseError),await s(c)):c.response},i=async function(o,u){return(await a(o,u))._data};return i.raw=a,i.native=(...o)=>e(...o),i.create=(o={},u={})=>g_({...t,...u,defaults:{...t.defaults,...u.defaults,...o}}),i}const Lu=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),t2=Lu.fetch?(...t)=>Lu.fetch(...t):()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!")),n2=Lu.Headers,r2=Lu.AbortController,rp=g_({fetch:t2,Headers:n2,AbortController:r2}),vl={SCHEMA_DIR_RELATIVE_PATH:"./../schemas/",SCHEMA_FILENAME_PAYLOAD:"payload.schema.json",SCHEMA_FILENAME_RESPONSE:"response.schema.json",SIYUAN_DEFAULT_BASE_URL:"http://localhost:6806/",REQUEST_TIMEOUT:6e4};class s2 extends Error{constructor(e){super(e.statusText),dn(this,"status"),this.response=e,this.status=e.status}}class sp extends Error{constructor(e,n){super(e.msg),dn(this,"code"),dn(this,"msg"),dn(this,"data"),this.body=e,this.response=n,this.code=e.code,this.msg=e.msg,this.data=e.data}}var ap,ip,op,up,cp;const qd=class B{constructor(e={},n="xhr"){dn(this,"_type","xhr"),dn(this,"_baseURL",((ip=(ap=globalThis.top)==null?void 0:ap.document)==null?void 0:ip.baseURI)??((up=(op=globalThis.parent)==null?void 0:op.document)==null?void 0:up.baseURI)??((cp=globalThis.location)==null?void 0:cp.origin)??vl.SIYUAN_DEFAULT_BASE_URL),dn(this,"_token",null),dn(this,"_ofetch_options",{baseURL:this._baseURL,headers:this._headers}),dn(this,"_axios_options",{baseURL:this._baseURL,timeout:vl.REQUEST_TIMEOUT,headers:this._headers}),dn(this,"_fetch",rp.create(this._ofetch_options)),dn(this,"_axios",ht.create(this._axios_options)),this._setClientType(n),this._updateOptions(e,n)}static headers2record(e){const n={};return e.forEach((r,s)=>{n[s]=r}),n}static headers2records(e){const n=[];return e.forEach((r,s)=>{n.push({[s]:r})}),n}static headers2entries(e){const n=[];return Object.entries(e).forEach(([r,s])=>{s.forEach(a=>n.push([r,a]))}),n}static entries2record(e){const n={};for(const[r,s]of e)n[r]=s;return n}get _authorization(){return`Token ${this._token}`}get _headers(){return this._token!==null?{Authorization:this._authorization}:{}}_setClientType(e){this._type=e}_updateOptions(e,n=this._type){switch(this._baseURL=e.baseURL??this._baseURL,e.token){case void 0:break;case null:default:this._token=e.token,delete e.token;break}switch(n){case"fetch":{const r=e;switch(!0){case Array.isArray(r.headers):{r.headers.find(([s])=>s.toLowerCase()==="Authorization".toLowerCase())||r.headers.push(["Authorization",this._authorization]);break}case r.headers instanceof Headers:{r.headers.has("Authorization")||r.headers.set("Authorization",this._authorization);break}case typeof r.headers=="object":{"Authorization"in r.headers||(r.headers.Authorization=this._authorization);break}default:{r.headers=this._headers;break}}this._ofetch_options=r,this._fetch=rp.create(this._ofetch_options);break}case"xhr":default:{const r=e;if(r.headers)switch(!0){case r.headers instanceof JS:{r.headers.has("Authorization")||r.headers.set("Authorization",this._authorization);break}case typeof r.headers=="object":{switch(!0){case("common"in r.headers||"get"in r.headers||"post"in r.headers):{"common"in r.headers&&("Authorization"in r.headers.get||(r.headers.get.Authorization=this._authorization)),"get"in r.headers&&("Authorization"in r.headers.get||(r.headers.get.Authorization=this._authorization)),"post"in r.headers&&("Authorization"in r.headers.post||(r.headers.post.Authorization=this._authorization));break}default:{"Authorization"in r.headers||(r.headers.Authorization=this._authorization);break}}break}default:{r.headers=this._headers;break}}else r.headers=this._headers;this._axios_options=r,this._axios=ht.create(this._axios_options);break}}}async $fetch(e,n){const r=new Request(e,n),s=await this.forwardProxy({url:r.url,method:r.method,headers:B.headers2records(r.headers),payload:sA(new Uint8Array(await r.arrayBuffer())),timeout:vl.REQUEST_TIMEOUT,contentType:"application/json",payloadEncoding:"base64",responseEncoding:"base64"});return new Response(uA(s.data.body),{status:s.data.status,statusText:s.msg,headers:new Headers(B.headers2entries(s.data.headers))})}broadcast(e,n,r){var s;const a=(r==null?void 0:r.baseURL)??this._baseURL,i=(r==null?void 0:r.token)??this._token,o=new URLSearchParams(e);i&&o.set("token",i);const u=new URL(a,(s=globalThis.location)==null?void 0:s.href);return u.protocol=u.protocol.replace(/^http/,"ws"),u.pathname=u.pathname.endsWith("/")?`${u.pathname}${B.ws.broadcast.pathname.substring(1)}`:`${u.pathname}${B.ws.broadcast.pathname}`,u.search=o.toString(),new XS(u,n)}async upload(e,n){const r=new FormData;return e.id!=null&&r.append("id",e.id),e.assetsDirPath!=null&&r.append("assetsDirPath",e.assetsDirPath),e.skipIfDuplicated!=null&&r.append("skipIfDuplicated",String(e.skipIfDuplicated)),e.files.forEach(s=>r.append("file[]",s)),await this._request(B.api.asset.upload.pathname,B.api.asset.upload.method,r,n)}async getBlockAttrs(e,n){return await this._request(B.api.attr.getBlockAttrs.pathname,B.api.attr.getBlockAttrs.method,e,n)}async getBookmarkLabels(e){return await this._request(B.api.attr.getBookmarkLabels.pathname,B.api.attr.getBookmarkLabels.method,void 0,e)}async setBlockAttrs(e,n){return await this._request(B.api.attr.setBlockAttrs.pathname,B.api.attr.setBlockAttrs.method,e,n)}async appendBlock(e,n){return await this._request(B.api.block.appendBlock.pathname,B.api.block.appendBlock.method,e,n)}async deleteBlock(e,n){return await this._request(B.api.block.deleteBlock.pathname,B.api.block.deleteBlock.method,e,n)}async foldBlock(e,n){return await this._request(B.api.block.foldBlock.pathname,B.api.block.foldBlock.method,e,n)}async getBlockBreadcrumb(e,n){return await this._request(B.api.block.getBlockBreadcrumb.pathname,B.api.block.getBlockBreadcrumb.method,e,n)}async getBlockDOM(e,n){return await this._request(B.api.block.getBlockDOM.pathname,B.api.block.getBlockDOM.method,e,n)}async getBlockInfo(e,n){return await this._request(B.api.block.getBlockInfo.pathname,B.api.block.getBlockInfo.method,e,n)}async getBlockKramdown(e,n){return await this._request(B.api.block.getBlockKramdown.pathname,B.api.block.getBlockKramdown.method,e,n)}async getChildBlocks(e,n){return await this._request(B.api.block.getChildBlocks.pathname,B.api.block.getChildBlocks.method,e,n)}async getDocInfo(e,n){return await this._request(B.api.block.getDocInfo.pathname,B.api.block.getDocInfo.method,e,n)}async insertBlock(e,n){return await this._request(B.api.block.insertBlock.pathname,B.api.block.insertBlock.method,e,n)}async moveBlock(e,n){return await this._request(B.api.block.moveBlock.pathname,B.api.block.moveBlock.method,e,n)}async prependBlock(e,n){return await this._request(B.api.block.prependBlock.pathname,B.api.block.prependBlock.method,e,n)}async transferBlockRef(e,n){return await this._request(B.api.block.transferBlockRef.pathname,B.api.block.transferBlockRef.method,e,n)}async unfoldBlock(e,n){return await this._request(B.api.block.unfoldBlock.pathname,B.api.block.unfoldBlock.method,e,n)}async updateBlock(e,n){return await this._request(B.api.block.updateBlock.pathname,B.api.block.updateBlock.method,e,n)}async getChannelInfo(e,n){return await this._request(B.api.broadcast.getChannelInfo.pathname,B.api.broadcast.getChannelInfo.method,e,n)}async getChannels(e){return await this._request(B.api.broadcast.getChannels.pathname,B.api.broadcast.getChannels.method,void 0,e)}async postMessage(e,n){return await this._request(B.api.broadcast.postMessage.pathname,B.api.broadcast.postMessage.method,e,n)}async pandoc(e,n){return await this._request(B.api.convert.pandoc.pathname,B.api.convert.pandoc.method,e,n)}async exportHTML(e,n){return await this._request(B.api.export.exportHTML.pathname,B.api.export.exportHTML.method,e,n)}async exportMdContent(e,n){return await this._request(B.api.export.exportMdContent.pathname,B.api.export.exportMdContent.method,e,n)}async exportResources(e,n){return await this._request(B.api.export.exportResources.pathname,B.api.export.exportResources.method,e,n)}async getFile(e,n="text",r){return await this._request(B.api.file.getFile.pathname,B.api.file.getFile.method,e,r,!1,n)}async putFile(e,n){e.file!==void 0&&!(e.file instanceof File)&&(e.file=new File([e.file],e.path.split("/").pop()));const r=new FormData;for(const[s,a]of Object.entries(e))a instanceof Blob?r.append(s,a):r.append(s,String(a));return await this._request(B.api.file.putFile.pathname,B.api.file.putFile.method,r,n)}async readDir(e,n){return await this._request(B.api.file.readDir.pathname,B.api.file.readDir.method,e,n)}async removeFile(e,n){return await this._request(B.api.file.removeFile.pathname,B.api.file.removeFile.method,e,n)}async renameFile(e,n){return await this._request(B.api.file.renameFile.pathname,B.api.file.renameFile.method,e,n)}async createDailyNote(e,n){return await this._request(B.api.filetree.createDailyNote.pathname,B.api.filetree.createDailyNote.method,e,n)}async createDocWithMd(e,n){return await this._request(B.api.filetree.createDocWithMd.pathname,B.api.filetree.createDocWithMd.method,e,n)}async getDoc(e,n){return await this._request(B.api.filetree.getDoc.pathname,B.api.filetree.getDoc.method,e,n)}async getHPathByID(e,n){return await this._request(B.api.filetree.getHPathByID.pathname,B.api.filetree.getHPathByID.method,e,n)}async getHPathByPath(e,n){return await this._request(B.api.filetree.getHPathByPath.pathname,B.api.filetree.getHPathByPath.method,e,n)}async getIDsByHPath(e,n){return await this._request(B.api.filetree.getIDsByHPath.pathname,B.api.filetree.getIDsByHPath.method,e,n)}async listDocsByPath(e,n){return await this._request(B.api.filetree.listDocsByPath.pathname,B.api.filetree.listDocsByPath.method,e,n)}async moveDocs(e,n){return await this._request(B.api.filetree.moveDocs.pathname,B.api.filetree.moveDocs.method,e,n)}async removeDoc(e,n){return await this._request(B.api.filetree.removeDoc.pathname,B.api.filetree.removeDoc.method,e,n)}async renameDoc(e,n){return await this._request(B.api.filetree.renameDoc.pathname,B.api.filetree.renameDoc.method,e,n)}async searchDocs(e,n){return await this._request(B.api.filetree.searchDocs.pathname,B.api.filetree.searchDocs.method,e,n)}async getDocHistoryContent(e,n){return await this._request(B.api.history.getDocHistoryContent.pathname,B.api.history.getDocHistoryContent.method,e,n)}async getHistoryItems(e,n){return await this._request(B.api.history.getHistoryItems.pathname,B.api.history.getHistoryItems.method,e,n)}async getShorthand(e,n){return await this._request(B.api.inbox.getShorthand.pathname,B.api.inbox.getShorthand.method,e,n)}async echo(e,n){if(e)switch(n??(n={type:this._type}),n==null?void 0:n.type){case"fetch":{const r={};e.headers&&(r.headers=e.headers),e.query&&(r.query=B.entries2record(e.query.entries())),n.options?Object.assign(r,n.options):n.options=r;break}case"xhr":{const r={};e.headers&&(r.headers=Array.isArray(e.headers)?B.entries2record(e.headers):e.headers instanceof Headers?B.headers2record(e.headers):e.headers),e.query&&(r.params=e.query),n.options?Object.assign(r,n.options):n.options=r;break}}return await this._request(B.api.network.echo.pathname,(e==null?void 0:e.method)??B.api.network.echo.method,e==null?void 0:e.body,n)}async forwardProxy(e,n){return await this._request(B.api.network.forwardProxy.pathname,B.api.network.forwardProxy.method,e,n)}async closeNotebook(e,n){return await this._request(B.api.notebook.closeNotebook.pathname,B.api.notebook.closeNotebook.method,e,n)}async createNotebook(e,n){return await this._request(B.api.notebook.createNotebook.pathname,B.api.notebook.createNotebook.method,e,n)}async getNotebookConf(e,n){return await this._request(B.api.notebook.getNotebookConf.pathname,B.api.notebook.getNotebookConf.method,e,n)}async lsNotebooks(e){return await this._request(B.api.notebook.lsNotebooks.pathname,B.api.notebook.lsNotebooks.method,void 0,e)}async openNotebook(e,n){return await this._request(B.api.notebook.openNotebook.pathname,B.api.notebook.openNotebook.method,e,n)}async removeNotebook(e,n){return await this._request(B.api.notebook.removeNotebook.pathname,B.api.notebook.removeNotebook.method,e,n)}async renameNotebook(e,n){return await this._request(B.api.notebook.renameNotebook.pathname,B.api.notebook.renameNotebook.method,e,n)}async setNotebookConf(e,n){return await this._request(B.api.notebook.setNotebookConf.pathname,B.api.notebook.setNotebookConf.method,e,n)}async pushErrMsg(e,n){return await this._request(B.api.notification.pushErrMsg.pathname,B.api.notification.pushErrMsg.method,e,n)}async pushMsg(e,n){return await this._request(B.api.notification.pushMsg.pathname,B.api.notification.pushMsg.method,e,n)}async getDocOutline(e,n){return await this._request(B.api.outline.getDocOutline.pathname,B.api.outline.getDocOutline.method,e,n)}async sql(e,n){return await this._request(B.api.query.sql.pathname,B.api.query.sql.method,e,n)}async openRepoSnapshotDoc(e,n){return await this._request(B.api.repo.openRepoSnapshotDoc.pathname,B.api.repo.openRepoSnapshotDoc.method,e,n)}async fullTextSearchBlock(e,n){return await this._request(B.api.search.fullTextSearchBlock.pathname,B.api.search.fullTextSearchBlock.method,e,n)}async getSnippet(e,n){return await this._request(B.api.snippet.getSnippet.pathname,B.api.snippet.getSnippet.method,e,n)}async setSnippet(e,n){return await this._request(B.api.snippet.setSnippet.pathname,B.api.snippet.setSnippet.method,e,n)}async flushTransaction(e){return await this._request(B.api.sqlite.flushTransaction.pathname,B.api.sqlite.flushTransaction.method,e)}async getLocalStorage(e){return await this._request(B.api.storage.getLocalStorage.pathname,B.api.storage.getLocalStorage.method,void 0,e)}async getRecentDocs(e){return await this._request(B.api.storage.getRecentDocs.pathname,B.api.storage.getRecentDocs.method,void 0,e)}async setLocalStorage(e,n){return await this._request(B.api.storage.setLocalStorage.pathname,B.api.storage.setLocalStorage.method,e,n)}async setLocalStorageVal(e,n){return await this._request(B.api.storage.setLocalStorageVal.pathname,B.api.storage.setLocalStorageVal.method,e,n)}async bootProgress(e){return await this._request(B.api.system.bootProgress.pathname,B.api.system.bootProgress.method,void 0,e)}async currentTime(e){return await this._request(B.api.system.currentTime.pathname,B.api.system.currentTime.method,void 0,e)}async exit(e,n){return await this._request(B.api.system.exit.pathname,B.api.system.exit.method,e,n)}async getConf(e){return await this._request(B.api.system.getConf.pathname,B.api.system.getConf.method,void 0,e)}async logoutAuth(e){return await this._request(B.api.system.logoutAuth.pathname,B.api.system.logoutAuth.method,void 0,e)}async version(e){return await this._request(B.api.system.version.pathname,B.api.system.version.method,void 0,e)}async render(e,n){return await this._request(B.api.template.render.pathname,B.api.template.render.method,e,n)}async renderSprig(e,n){return await this._request(B.api.template.renderSprig.pathname,B.api.template.renderSprig.method,e,n)}async _request(e,n,r,s,a=!0,i="json"){switch((s==null?void 0:s.type)??this._type){case"fetch":{const o=s==null?void 0:s.options;i=(()=>{switch(i){case"arraybuffer":return"arrayBuffer";case"document":return"text";default:return i}})();const u=await this._fetch(e,{method:n,body:r,responseType:i,onResponse:c=>{switch(c.response.status){case No.Ok:switch(i){case"blob":c.response._data.contentType=c.response.headers.get("content-type");break}break;case No.Accepted:e===B.api.file.getFile.pathname&&this._parseFetchResponse(c.response._data);break}},...o});return a&&i==="json"&&typeof u=="object"?this._parseFetchResponse(u):u}case"xhr":default:{const o=s==null?void 0:s.options;i=(()=>{switch(i){case"arrayBuffer":return"arraybuffer";default:return i}})();const u=await this._axios.request({url:e,method:n,data:r,responseType:i,...o});switch(u.status){case No.Ok:if(a&&i==="json"&&typeof u.data=="object")return this._parseAxiosResponse(u);switch(i){case"blob":"content-type"in u.headers&&(u.data.contentType=u.headers["content-type"]);break}return u.data;case No.Accepted:return e===B.api.file.getFile.pathname?this._parseAxiosResponse(u):u.data;default:throw new s2(u)}}}}_parseFetchResponse(e){if(e.code===0)return e;throw new sp(e)}_parseAxiosResponse(e){if(e.data.code===0)return e.data;throw new sp(e.data,e)}};dn(qd,"ws",{broadcast:{pathname:"/ws/broadcast"}}),dn(qd,"api",{asset:{upload:{pathname:"/api/asset/upload",method:"POST"}},attr:{getBlockAttrs:{pathname:"/api/attr/getBlockAttrs",method:"POST"},getBookmarkLabels:{pathname:"/api/attr/getBookmarkLabels",method:"POST"},setBlockAttrs:{pathname:"/api/attr/setBlockAttrs",method:"POST"}},block:{appendBlock:{pathname:"/api/block/appendBlock",method:"POST"},deleteBlock:{pathname:"/api/block/deleteBlock",method:"POST"},foldBlock:{pathname:"/api/block/foldBlock",method:"POST"},getBlockBreadcrumb:{pathname:"/api/block/getBlockBreadcrumb",method:"POST"},getBlockDOM:{pathname:"/api/block/getBlockDOM",method:"POST"},getBlockInfo:{pathname:"/api/block/getBlockInfo",method:"POST"},getBlockKramdown:{pathname:"/api/block/getBlockKramdown",method:"POST"},getChildBlocks:{pathname:"/api/block/getChildBlocks",method:"POST"},getDocInfo:{pathname:"/api/block/getDocInfo",method:"POST"},insertBlock:{pathname:"/api/block/insertBlock",method:"POST"},moveBlock:{pathname:"/api/block/moveBlock",method:"POST"},prependBlock:{pathname:"/api/block/prependBlock",method:"POST"},transferBlockRef:{pathname:"/api/block/transferBlockRef",method:"POST"},unfoldBlock:{pathname:"/api/block/unfoldBlock",method:"POST"},updateBlock:{pathname:"/api/block/updateBlock",method:"POST"}},broadcast:{getChannelInfo:{pathname:"/api/broadcast/getChannelInfo",method:"POST"},getChannels:{pathname:"/api/broadcast/getChannels",method:"POST"},postMessage:{pathname:"/api/broadcast/postMessage",method:"POST"}},convert:{pandoc:{pathname:"/api/convert/pandoc",method:"POST"}},export:{exportHTML:{pathname:"/api/export/exportHTML",method:"POST"},exportMdContent:{pathname:"/api/export/exportMdContent",method:"POST"},exportResources:{pathname:"/api/export/exportResources",method:"POST"}},file:{getFile:{pathname:"/api/file/getFile",method:"POST"},putFile:{pathname:"/api/file/putFile",method:"POST"},readDir:{pathname:"/api/file/readDir",method:"POST"},removeFile:{pathname:"/api/file/removeFile",method:"POST"},renameFile:{pathname:"/api/file/renameFile",method:"POST"}},filetree:{createDailyNote:{pathname:"/api/filetree/createDailyNote",method:"POST"},createDocWithMd:{pathname:"/api/filetree/createDocWithMd",method:"POST"},getDoc:{pathname:"/api/filetree/getDoc",method:"POST"},getHPathByID:{pathname:"/api/filetree/getHPathByID",method:"POST"},getHPathByPath:{pathname:"/api/filetree/getHPathByPath",method:"POST"},getIDsByHPath:{pathname:"/api/filetree/getIDsByHPath",method:"POST"},listDocsByPath:{pathname:"/api/filetree/listDocsByPath",method:"POST"},moveDocs:{pathname:"/api/filetree/moveDocs",method:"POST"},removeDoc:{pathname:"/api/filetree/removeDoc",method:"POST"},renameDoc:{pathname:"/api/filetree/renameDoc",method:"POST"},searchDocs:{pathname:"/api/filetree/searchDocs",method:"POST"}},history:{getDocHistoryContent:{pathname:"/api/history/getDocHistoryContent",method:"POST"},getHistoryItems:{pathname:"/api/history/getHistoryItems",method:"POST"}},inbox:{getShorthand:{pathname:"/api/inbox/getShorthand",method:"POST"}},network:{echo:{pathname:"/api/network/echo",method:"POST"},forwardProxy:{pathname:"/api/network/forwardProxy",method:"POST"}},notebook:{closeNotebook:{pathname:"/api/notebook/closeNotebook",method:"POST"},createNotebook:{pathname:"/api/notebook/createNotebook",method:"POST"},getNotebookConf:{pathname:"/api/notebook/getNotebookConf",method:"POST"},lsNotebooks:{pathname:"/api/notebook/lsNotebooks",method:"POST"},openNotebook:{pathname:"/api/notebook/openNotebook",method:"POST"},removeNotebook:{pathname:"/api/notebook/removeNotebook",method:"POST"},renameNotebook:{pathname:"/api/notebook/renameNotebook",method:"POST"},setNotebookConf:{pathname:"/api/notebook/setNotebookConf",method:"POST"}},notification:{pushErrMsg:{pathname:"/api/notification/pushErrMsg",method:"POST"},pushMsg:{pathname:"/api/notification/pushMsg",method:"POST"}},outline:{getDocOutline:{pathname:"/api/outline/getDocOutline",method:"POST"}},query:{sql:{pathname:"/api/query/sql",method:"POST"}},repo:{openRepoSnapshotDoc:{pathname:"/api/repo/openRepoSnapshotDoc",method:"POST"}},search:{fullTextSearchBlock:{pathname:"/api/search/fullTextSearchBlock",method:"POST"}},snippet:{getSnippet:{pathname:"/api/snippet/getSnippet",method:"POST"},setSnippet:{pathname:"/api/snippet/setSnippet",method:"POST"}},sqlite:{flushTransaction:{pathname:"/api/sqlite/flushTransaction",method:"POST"}},storage:{getLocalStorage:{pathname:"/api/storage/getLocalStorage",method:"POST"},getRecentDocs:{pathname:"/api/storage/getRecentDocs",method:"POST"},setLocalStorage:{pathname:"/api/storage/setLocalStorage",method:"POST"},setLocalStorageVal:{pathname:"/api/storage/setLocalStorageVal",method:"POST"}},system:{bootProgress:{pathname:"/api/system/bootProgress",method:"POST"},currentTime:{pathname:"/api/system/currentTime",method:"POST"},exit:{pathname:"/api/system/exit",method:"POST"},getConf:{pathname:"/api/system/getConf",method:"POST"},logoutAuth:{pathname:"/api/system/logoutAuth",method:"POST"},version:{pathname:"/api/system/version",method:"POST"}},template:{render:{pathname:"/api/template/render",method:"POST"},renderSprig:{pathname:"/api/template/renderSprig",method:"POST"}}});let a2=qd;function Qn(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}function lp(t,e){for(var n="",r=0,s=-1,a=0,i,o=0;o<=t.length;++o){if(o<t.length)i=t.charCodeAt(o);else{if(i===47)break;i=47}if(i===47){if(!(s===o-1||a===1))if(s!==o-1&&a===2){if(n.length<2||r!==2||n.charCodeAt(n.length-1)!==46||n.charCodeAt(n.length-2)!==46){if(n.length>2){var u=n.lastIndexOf("/");if(u!==n.length-1){u===-1?(n="",r=0):(n=n.slice(0,u),r=n.length-1-n.lastIndexOf("/")),s=o,a=0;continue}}else if(n.length===2||n.length===1){n="",r=0,s=o,a=0;continue}}e&&(n.length>0?n+="/..":n="..",r=2)}else n.length>0?n+="/"+t.slice(s+1,o):n=t.slice(s+1,o),r=o-s-1;s=o,a=0}else i===46&&a!==-1?++a:a=-1}return n}function i2(t,e){var n=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return n?n===e.root?n+r:n+t+r:r}var li={resolve:function(){for(var t="",e=!1,n,r=arguments.length-1;r>=-1&&!e;r--){var s;r>=0?s=arguments[r]:(n===void 0&&(n=process.cwd()),s=n),Qn(s),s.length!==0&&(t=s+"/"+t,e=s.charCodeAt(0)===47)}return t=lp(t,!e),e?t.length>0?"/"+t:"/":t.length>0?t:"."},normalize:function(t){if(Qn(t),t.length===0)return".";var e=t.charCodeAt(0)===47,n=t.charCodeAt(t.length-1)===47;return t=lp(t,!e),t.length===0&&!e&&(t="."),t.length>0&&n&&(t+="/"),e?"/"+t:t},isAbsolute:function(t){return Qn(t),t.length>0&&t.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var t,e=0;e<arguments.length;++e){var n=arguments[e];Qn(n),n.length>0&&(t===void 0?t=n:t+="/"+n)}return t===void 0?".":li.normalize(t)},relative:function(t,e){if(Qn(t),Qn(e),t===e||(t=li.resolve(t),e=li.resolve(e),t===e))return"";for(var n=1;n<t.length&&t.charCodeAt(n)===47;++n);for(var r=t.length,s=r-n,a=1;a<e.length&&e.charCodeAt(a)===47;++a);for(var i=e.length,o=i-a,u=s<o?s:o,c=-1,l=0;l<=u;++l){if(l===u){if(o>u){if(e.charCodeAt(a+l)===47)return e.slice(a+l+1);if(l===0)return e.slice(a+l)}else s>u&&(t.charCodeAt(n+l)===47?c=l:l===0&&(c=0));break}var d=t.charCodeAt(n+l),m=e.charCodeAt(a+l);if(d!==m)break;d===47&&(c=l)}var p="";for(l=n+c+1;l<=r;++l)(l===r||t.charCodeAt(l)===47)&&(p.length===0?p+="..":p+="/..");return p.length>0?p+e.slice(a+c):(a+=c,e.charCodeAt(a)===47&&++a,e.slice(a))},_makeLong:function(t){return t},dirname:function(t){if(Qn(t),t.length===0)return".";for(var e=t.charCodeAt(0),n=e===47,r=-1,s=!0,a=t.length-1;a>=1;--a)if(e=t.charCodeAt(a),e===47){if(!s){r=a;break}}else s=!1;return r===-1?n?"/":".":n&&r===1?"//":t.slice(0,r)},basename:function(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');Qn(t);var n=0,r=-1,s=!0,a;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";var i=e.length-1,o=-1;for(a=t.length-1;a>=0;--a){var u=t.charCodeAt(a);if(u===47){if(!s){n=a+1;break}}else o===-1&&(s=!1,o=a+1),i>=0&&(u===e.charCodeAt(i)?--i===-1&&(r=a):(i=-1,r=o))}return n===r?r=o:r===-1&&(r=t.length),t.slice(n,r)}else{for(a=t.length-1;a>=0;--a)if(t.charCodeAt(a)===47){if(!s){n=a+1;break}}else r===-1&&(s=!1,r=a+1);return r===-1?"":t.slice(n,r)}},extname:function(t){Qn(t);for(var e=-1,n=0,r=-1,s=!0,a=0,i=t.length-1;i>=0;--i){var o=t.charCodeAt(i);if(o===47){if(!s){n=i+1;break}continue}r===-1&&(s=!1,r=i+1),o===46?e===-1?e=i:a!==1&&(a=1):e!==-1&&(a=-1)}return e===-1||r===-1||a===0||a===1&&e===r-1&&e===n+1?"":t.slice(e,r)},format:function(t){if(t===null||typeof t!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof t);return i2("/",t)},parse:function(t){Qn(t);var e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;var n=t.charCodeAt(0),r=n===47,s;r?(e.root="/",s=1):s=0;for(var a=-1,i=0,o=-1,u=!0,c=t.length-1,l=0;c>=s;--c){if(n=t.charCodeAt(c),n===47){if(!u){i=c+1;break}continue}o===-1&&(u=!1,o=c+1),n===46?a===-1?a=c:l!==1&&(l=1):a!==-1&&(l=-1)}return a===-1||o===-1||l===0||l===1&&a===o-1&&a===i+1?o!==-1&&(i===0&&r?e.base=e.name=t.slice(1,o):e.base=e.name=t.slice(i,o)):(i===0&&r?(e.name=t.slice(1,a),e.base=t.slice(1,o)):(e.name=t.slice(i,a),e.base=t.slice(i,o)),e.ext=t.slice(a,o)),i>0?e.dir=t.slice(0,i-1):r&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};li.posix=li;async function Rs(t,e){let n=await dt.fetchSyncPost(t,e);return n.code===0?n.data:null}async function b_(t){return Rs("/api/block/getChildBlocks",{id:t})}async function o2(t){return Rs("/api/block/getBlockIndex",{id:t})}async function ta(t,e=7e3){return Rs("/api/notification/pushMsg",{msg:t,timeout:e})}async function so(t,e=7e3){return Rs("/api/notification/pushErrMsg",{msg:t,timeout:e})}async function u2(){return Rs("/api/notebook/lsNotebooks","")}function __(){var n;let t=((n=window.getSelection())==null?void 0:n.toString())||"";return t||(document.querySelectorAll(".protyle-wysiwyg--select").forEach(r=>{const s=r.textContent;t+=`
`+s}),t)}function y_(){var r;let t="",e="";return t=(r=document.getElementsByClassName("protyle-title__input")[0])==null?void 0:r.textContent,document.querySelectorAll("[data-node-index]").forEach(s=>{e+=s.textContent+`
`}),{title:t,content:e}}function Ze(){}function Du(t,e){for(const n in e)t[n]=e[n];return t}function E_(t){return t()}function dp(){return Object.create(null)}function st(t){t.forEach(E_)}function w_(t){return typeof t=="function"}function Qe(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function c2(t){return Object.keys(t).length===0}function af(t,e,n,r){if(t){const s=T_(t,e,n,r);return t[0](s)}}function T_(t,e,n,r){return t[1]&&r?Du(n.ctx.slice(),t[1](r(e))):n.ctx}function of(t,e,n,r){if(t[2]&&r){const s=t[2](r(n));if(e.dirty===void 0)return s;if(typeof s=="object"){const a=[],i=Math.max(e.dirty.length,s.length);for(let o=0;o<i;o+=1)a[o]=e.dirty[o]|s[o];return a}return e.dirty|s}return e.dirty}function uf(t,e,n,r,s,a){if(s){const i=T_(e,n,r,a);t.p(i,s)}}function cf(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function hp(t){const e={};for(const n in t)n[0]!=="$"&&(e[n]=t[n]);return e}const l2=["",!0,1,"true","contenteditable"];function O(t,e){t.appendChild(e)}function ce(t,e,n){t.insertBefore(e,n||null)}function oe(t){t.parentNode&&t.parentNode.removeChild(t)}function Qr(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function M(t){return document.createElement(t)}function pt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Ke(t){return document.createTextNode(t)}function ee(){return Ke(" ")}function ao(){return Ke("")}function ne(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function S_(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function T(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}const d2=["width","height"];function fp(t,e){const n=Object.getOwnPropertyDescriptors(t.__proto__);for(const r in e)e[r]==null?t.removeAttribute(r):r==="style"?t.style.cssText=e[r]:r==="__value"?t.value=t[r]=e[r]:n[r]&&n[r].set&&d2.indexOf(r)===-1?t[r]=e[r]:T(t,r,e[r])}function Vd(t){return t===""?null:+t}function h2(t){return Array.from(t.childNodes)}function lt(t,e){e=""+e,t.data!==e&&(t.data=e)}function f2(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function m2(t,e,n){~l2.indexOf(n)?f2(t,e):lt(t,e)}function bt(t,e){t.value=e??""}function St(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,"")}function mp(t,e,n){for(let r=0;r<t.options.length;r+=1){const s=t.options[r];if(s.__value===e){s.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function p2(t){const e=t.querySelector(":checked");return e&&e.__value}function _e(t,e,n){t.classList.toggle(e,!!n)}function g2(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}let vi;function di(t){vi=t}function lf(){if(!vi)throw new Error("Function called outside component initialization");return vi}function Rr(t){lf().$$.on_mount.push(t)}function A_(t){lf().$$.after_update.push(t)}function yn(){const t=lf();return(e,n,{cancelable:r=!1}={})=>{const s=t.$$.callbacks[e];if(s){const a=g2(e,n,{cancelable:r});return s.slice().forEach(i=>{i.call(t,a)}),!a.defaultPrevented}return!0}}function b2(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const zs=[],ue=[];let na=[];const zd=[],_2=Promise.resolve();let Wd=!1;function y2(){Wd||(Wd=!0,_2.then(C_))}function Mu(t){na.push(t)}function me(t){zd.push(t)}const Ol=new Set;let Ds=0;function C_(){if(Ds!==0)return;const t=vi;do{try{for(;Ds<zs.length;){const e=zs[Ds];Ds++,di(e),E2(e.$$)}}catch(e){throw zs.length=0,Ds=0,e}for(di(null),zs.length=0,Ds=0;ue.length;)ue.pop()();for(let e=0;e<na.length;e+=1){const n=na[e];Ol.has(n)||(Ol.add(n),n())}na.length=0}while(zs.length);for(;zd.length;)zd.pop()();Wd=!1,Ol.clear(),di(t)}function E2(t){if(t.fragment!==null){t.update(),st(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Mu)}}function w2(t){const e=[],n=[];na.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),na=e}const yu=new Set;let cs;function hr(){cs={r:0,c:[],p:cs}}function fr(){cs.r||st(cs.c),cs=cs.p}function ie(t,e){t&&t.i&&(yu.delete(t),t.i(e))}function de(t,e,n,r){if(t&&t.o){if(yu.has(t))return;yu.add(t),cs.c.push(()=>{yu.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function _t(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function T2(t,e){t.d(1),e.delete(t.key)}function S2(t,e){de(t,1,1,()=>{e.delete(t.key)})}function v_(t,e,n,r,s,a,i,o,u,c,l,d){let m=t.length,p=a.length,h=m;const g={};for(;h--;)g[t[h].key]=h;const b=[],_=new Map,y=new Map,E=[];for(h=p;h--;){const v=d(s,a,h),j=n(v);let F=i.get(j);F?E.push(()=>F.p(v,e)):(F=c(j,v),F.c()),_.set(j,b[h]=F),j in g&&y.set(j,Math.abs(h-g[j]))}const I=new Set,w=new Set;function R(v){ie(v,1),v.m(o,l),i.set(v.key,v),l=v.first,p--}for(;m&&p;){const v=b[p-1],j=t[m-1],F=v.key,x=j.key;v===j?(l=v.first,m--,p--):_.has(x)?!i.has(F)||I.has(F)?R(v):w.has(x)?m--:y.get(F)>y.get(x)?(w.add(F),R(v)):(I.add(x),m--):(u(j,i),m--)}for(;m--;){const v=t[m];_.has(v.key)||u(v,i)}for(;p;)R(b[p-1]);return st(E),b}function A2(t,e){const n={},r={},s={$$scope:1};let a=t.length;for(;a--;){const i=t[a],o=e[a];if(o){for(const u in i)u in o||(r[u]=1);for(const u in o)s[u]||(n[u]=o[u],s[u]=1);t[a]=o}else for(const u in i)s[u]=1}for(const i in r)i in n||(n[i]=void 0);return n}function pe(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function De(t){t&&t.c()}function Pe(t,e,n){const{fragment:r,after_update:s}=t.$$;r&&r.m(e,n),Mu(()=>{const a=t.$$.on_mount.map(E_).filter(w_);t.$$.on_destroy?t.$$.on_destroy.push(...a):st(a),t.$$.on_mount=[]}),s.forEach(Mu)}function xe(t,e){const n=t.$$;n.fragment!==null&&(w2(n.after_update),st(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function C2(t,e){t.$$.dirty[0]===-1&&(zs.push(t),y2(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function et(t,e,n,r,s,a,i=null,o=[-1]){const u=vi;di(t);const c=t.$$={fragment:null,ctx:[],props:a,update:Ze,not_equal:s,bound:dp(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:dp(),dirty:o,skip_bound:!1,root:e.target||u.$$.root};i&&i(c.root);let l=!1;if(c.ctx=n?n(t,e.props||{},(d,m,...p)=>{const h=p.length?p[0]:m;return c.ctx&&s(c.ctx[d],c.ctx[d]=h)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](h),l&&C2(t,d)),m}):[],c.update(),l=!0,st(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const d=h2(e.target);c.fragment&&c.fragment.l(d),d.forEach(oe)}else c.fragment&&c.fragment.c();e.intro&&ie(t.$$.fragment),Pe(t,e.target,e.anchor),C_()}di(u)}class tt{constructor(){Te(this,"$$");Te(this,"$$set")}$destroy(){xe(this,1),this.$destroy=Ze}$on(e,n){if(!w_(n))return Ze;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const s=r.indexOf(n);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!c2(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const v2="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(v2);var O2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function io(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var O_={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(O2,function(){var n=1e3,r=6e4,s=36e5,a="millisecond",i="second",o="minute",u="hour",c="day",l="week",d="month",m="quarter",p="year",h="date",g="Invalid Date",b=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,_=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(N){var S=["th","st","nd","rd"],P=N%100;return"["+N+(S[(P-20)%10]||S[P]||S[0])+"]"}},E=function(N,S,P){var U=String(N);return!U||U.length>=S?N:""+Array(S+1-U.length).join(P)+N},I={s:E,z:function(N){var S=-N.utcOffset(),P=Math.abs(S),U=Math.floor(P/60),D=P%60;return(S<=0?"+":"-")+E(U,2,"0")+":"+E(D,2,"0")},m:function N(S,P){if(S.date()<P.date())return-N(P,S);var U=12*(P.year()-S.year())+(P.month()-S.month()),D=S.clone().add(U,d),W=P-D<0,K=S.clone().add(U+(W?-1:1),d);return+(-(U+(P-D)/(W?D-K:K-D))||0)},a:function(N){return N<0?Math.ceil(N)||0:Math.floor(N)},p:function(N){return{M:d,y:p,w:l,d:c,D:h,h:u,m:o,s:i,ms:a,Q:m}[N]||String(N||"").toLowerCase().replace(/s$/,"")},u:function(N){return N===void 0}},w="en",R={};R[w]=y;var v="$isDayjsObject",j=function(N){return N instanceof te||!(!N||!N[v])},F=function N(S,P,U){var D;if(!S)return w;if(typeof S=="string"){var W=S.toLowerCase();R[W]&&(D=W),P&&(R[W]=P,D=W);var K=S.split("-");if(!D&&K.length>1)return N(K[0])}else{var G=S.name;R[G]=S,D=G}return!U&&D&&(w=D),D||!U&&w},x=function(N,S){if(j(N))return N.clone();var P=typeof S=="object"?S:{};return P.date=N,P.args=arguments,new te(P)},H=I;H.l=F,H.i=j,H.w=function(N,S){return x(N,{locale:S.$L,utc:S.$u,x:S.$x,$offset:S.$offset})};var te=function(){function N(P){this.$L=F(P.locale,null,!0),this.parse(P),this.$x=this.$x||P.x||{},this[v]=!0}var S=N.prototype;return S.parse=function(P){this.$d=function(U){var D=U.date,W=U.utc;if(D===null)return new Date(NaN);if(H.u(D))return new Date;if(D instanceof Date)return new Date(D);if(typeof D=="string"&&!/Z$/i.test(D)){var K=D.match(b);if(K){var G=K[2]-1||0,se=(K[7]||"0").substring(0,3);return W?new Date(Date.UTC(K[1],G,K[3]||1,K[4]||0,K[5]||0,K[6]||0,se)):new Date(K[1],G,K[3]||1,K[4]||0,K[5]||0,K[6]||0,se)}}return new Date(D)}(P),this.init()},S.init=function(){var P=this.$d;this.$y=P.getFullYear(),this.$M=P.getMonth(),this.$D=P.getDate(),this.$W=P.getDay(),this.$H=P.getHours(),this.$m=P.getMinutes(),this.$s=P.getSeconds(),this.$ms=P.getMilliseconds()},S.$utils=function(){return H},S.isValid=function(){return this.$d.toString()!==g},S.isSame=function(P,U){var D=x(P);return this.startOf(U)<=D&&D<=this.endOf(U)},S.isAfter=function(P,U){return x(P)<this.startOf(U)},S.isBefore=function(P,U){return this.endOf(U)<x(P)},S.$g=function(P,U,D){return H.u(P)?this[U]:this.set(D,P)},S.unix=function(){return Math.floor(this.valueOf()/1e3)},S.valueOf=function(){return this.$d.getTime()},S.startOf=function(P,U){var D=this,W=!!H.u(U)||U,K=H.p(P),G=function(In,Ct){var Xn=H.w(D.$u?Date.UTC(D.$y,Ct,In):new Date(D.$y,Ct,In),D);return W?Xn:Xn.endOf(c)},se=function(In,Ct){return H.w(D.toDate()[In].apply(D.toDate("s"),(W?[0,0,0,0]:[23,59,59,999]).slice(Ct)),D)},we=this.$W,Le=this.$M,ke=this.$D,At="set"+(this.$u?"UTC":"");switch(K){case p:return W?G(1,0):G(31,11);case d:return W?G(1,Le):G(0,Le+1);case l:var Rt=this.$locale().weekStart||0,Pr=(we<Rt?we+7:we)-Rt;return G(W?ke-Pr:ke+(6-Pr),Le);case c:case h:return se(At+"Hours",0);case u:return se(At+"Minutes",1);case o:return se(At+"Seconds",2);case i:return se(At+"Milliseconds",3);default:return this.clone()}},S.endOf=function(P){return this.startOf(P,!1)},S.$set=function(P,U){var D,W=H.p(P),K="set"+(this.$u?"UTC":""),G=(D={},D[c]=K+"Date",D[h]=K+"Date",D[d]=K+"Month",D[p]=K+"FullYear",D[u]=K+"Hours",D[o]=K+"Minutes",D[i]=K+"Seconds",D[a]=K+"Milliseconds",D)[W],se=W===c?this.$D+(U-this.$W):U;if(W===d||W===p){var we=this.clone().set(h,1);we.$d[G](se),we.init(),this.$d=we.set(h,Math.min(this.$D,we.daysInMonth())).$d}else G&&this.$d[G](se);return this.init(),this},S.set=function(P,U){return this.clone().$set(P,U)},S.get=function(P){return this[H.p(P)]()},S.add=function(P,U){var D,W=this;P=Number(P);var K=H.p(U),G=function(Le){var ke=x(W);return H.w(ke.date(ke.date()+Math.round(Le*P)),W)};if(K===d)return this.set(d,this.$M+P);if(K===p)return this.set(p,this.$y+P);if(K===c)return G(1);if(K===l)return G(7);var se=(D={},D[o]=r,D[u]=s,D[i]=n,D)[K]||1,we=this.$d.getTime()+P*se;return H.w(we,this)},S.subtract=function(P,U){return this.add(-1*P,U)},S.format=function(P){var U=this,D=this.$locale();if(!this.isValid())return D.invalidDate||g;var W=P||"YYYY-MM-DDTHH:mm:ssZ",K=H.z(this),G=this.$H,se=this.$m,we=this.$M,Le=D.weekdays,ke=D.months,At=D.meridiem,Rt=function(Ct,Xn,Ma,Io){return Ct&&(Ct[Xn]||Ct(U,W))||Ma[Xn].slice(0,Io)},Pr=function(Ct){return H.s(G%12||12,Ct,"0")},In=At||function(Ct,Xn,Ma){var Io=Ct<12?"AM":"PM";return Ma?Io.toLowerCase():Io};return W.replace(_,function(Ct,Xn){return Xn||function(Ma){switch(Ma){case"YY":return String(U.$y).slice(-2);case"YYYY":return H.s(U.$y,4,"0");case"M":return we+1;case"MM":return H.s(we+1,2,"0");case"MMM":return Rt(D.monthsShort,we,ke,3);case"MMMM":return Rt(ke,we);case"D":return U.$D;case"DD":return H.s(U.$D,2,"0");case"d":return String(U.$W);case"dd":return Rt(D.weekdaysMin,U.$W,Le,2);case"ddd":return Rt(D.weekdaysShort,U.$W,Le,3);case"dddd":return Le[U.$W];case"H":return String(G);case"HH":return H.s(G,2,"0");case"h":return Pr(1);case"hh":return Pr(2);case"a":return In(G,se,!0);case"A":return In(G,se,!1);case"m":return String(se);case"mm":return H.s(se,2,"0");case"s":return String(U.$s);case"ss":return H.s(U.$s,2,"0");case"SSS":return H.s(U.$ms,3,"0");case"Z":return K}return null}(Ct)||K.replace(":","")})},S.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},S.diff=function(P,U,D){var W,K=this,G=H.p(U),se=x(P),we=(se.utcOffset()-this.utcOffset())*r,Le=this-se,ke=function(){return H.m(K,se)};switch(G){case p:W=ke()/12;break;case d:W=ke();break;case m:W=ke()/3;break;case l:W=(Le-we)/6048e5;break;case c:W=(Le-we)/864e5;break;case u:W=Le/s;break;case o:W=Le/r;break;case i:W=Le/n;break;default:W=Le}return D?W:H.a(W)},S.daysInMonth=function(){return this.endOf(d).$D},S.$locale=function(){return R[this.$L]},S.locale=function(P,U){if(!P)return this.$L;var D=this.clone(),W=F(P,U,!0);return W&&(D.$L=W),D},S.clone=function(){return H.w(this.$d,this)},S.toDate=function(){return new Date(this.valueOf())},S.toJSON=function(){return this.isValid()?this.toISOString():null},S.toISOString=function(){return this.$d.toISOString()},S.toString=function(){return this.$d.toUTCString()},N}(),Z=te.prototype;return x.prototype=Z,[["$ms",a],["$s",i],["$m",o],["$H",u],["$W",c],["$M",d],["$y",p],["$D",h]].forEach(function(N){Z[N[1]]=function(S){return this.$g(S,N[0],N[1])}}),x.extend=function(N,S){return N.$i||(N(S,te,x),N.$i=!0),x},x.locale=F,x.isDayjs=j,x.unix=function(N){return x(1e3*N)},x.en=R[w],x.Ls=R,x.p={},x})})(O_);var k2=O_.exports;const Bu=io(k2),Gd="siyuan-ai-plugin-setting",Kd="siyuan-ai-plugin-chat-history",I2="siyuan-ai-plugin-image-history",Yd="siyuan-ai-plugin-prompts",k_="siyuan-ai-plugin-blockid",Zd="siyuan-ai-plugin-document-vector";atob("YzFiOWMwMzFkYWFhMzFmMDE2MzUxNzJmNWI1M2NkYTE");const xo=dt.getBackend()=="docker"?atob("aHR0cHM6Ly9vbmVhcGkuZ2Vla3NwaGVyZS5vbmxpbmU="):atob("aHR0cDovL25iMS5mcnAueWh0dWouY246MTYwNzg"),N2=dt.getBackend()=="docker"?atob("aHR0cHM6Ly9vbmVhcGkuZ2Vla3NwaGVyZS5vbmxpbmU="):atob("aHR0cDovL25iMS5mcnAueWh0dWouY246MTYwNzg");atob("aHR0cDovL25iMS5mcnAueWh0dWouY246MTM1NDE");const R2=atob("aHR0cHM6Ly9zZWFyY2guZ2Vla3NwaGVyZS5vbmxpbmUv"),pp=dt.getBackend()=="docker"?atob("aHR0cHM6Ly9hcGkuZ2Vla3NwaGVyZS5vbmxpbmUvZW1iZWRkaW5nL2NhbA=="):atob("aHR0cDovL25iMS5mcnAueWh0dWouY246MTMwNTkvY2Fs"),gp=dt.getBackend()=="docker"?atob("aHR0cHM6Ly9hcGkuZ2Vla3NwaGVyZS5vbmxpbmUvZW1iZWRkaW5nL2NhbA=="):atob("aHR0cDovL25iMS5mcnAueWh0dWouY246MTMwNTkvY2Fs"),df=dt.getBackend()=="docker"?atob("aHR0cHM6Ly9hcGkuZ2Vla3NwaGVyZS5vbmxpbmUvZW1iZWRkaW5n"):atob("aHR0cDovL25iMS5mcnAueWh0dWouY246MTMwNTk"),P2=dt.getBackend()=="docker"?atob("aHR0cHM6Ly9hcGkuZ2Vla3NwaGVyZS5vbmxpbmU="):atob("aHR0cDovL25iMS5mcnAueWh0dWouY246MTQ5Mjg="),ra=["qwen-vl-plus-latest","doubao-vision-pro-32k","qwen-vl-max-latest"];async function x2(t){let e={path:t},n="/api/file/getFile";return new Promise((r,s)=>{dt.fetchPost(n,e,a=>{r(a)})})}async function L2(t,e,n){let r=new FormData;return r.append("path",t),r.append("isDir",e.toString()),r.append("modTime",Math.floor(Date.now()/1e3).toString()),r.append("file",n),Rs("/api/file/putFile",r)}async function D2(t,e){return Rs("/api/filetree/listDocTree",{notebook:t,path:e})}let ls=class{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent!==void 0?e.pageContent.toString():"",this.metadata=e.metadata??{},this.id=e.id}};var Ue;(function(t){t.assertEqual=s=>s;function e(s){}t.assertIs=e;function n(s){throw new Error}t.assertNever=n,t.arrayToEnum=s=>{const a={};for(const i of s)a[i]=i;return a},t.getValidEnumValues=s=>{const a=t.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(const o of a)i[o]=s[o];return t.objectValues(i)},t.objectValues=s=>t.objectKeys(s).map(function(a){return s[a]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},t.find=(s,a)=>{for(const i of s)if(a(i))return i},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}t.joinValues=r,t.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(Ue||(Ue={}));var Jd;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(Jd||(Jd={}));const ae=Ue.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Cr=t=>{switch(typeof t){case"undefined":return ae.undefined;case"string":return ae.string;case"number":return isNaN(t)?ae.nan:ae.number;case"boolean":return ae.boolean;case"function":return ae.function;case"bigint":return ae.bigint;case"symbol":return ae.symbol;case"object":return Array.isArray(t)?ae.array:t===null?ae.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?ae.promise:typeof Map<"u"&&t instanceof Map?ae.map:typeof Set<"u"&&t instanceof Set?ae.set:typeof Date<"u"&&t instanceof Date?ae.date:ae.object;default:return ae.unknown}},Q=Ue.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),M2=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class pn extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(a){return a.message},r={_errors:[]},s=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(n(i));else{let o=r,u=0;for(;u<i.path.length;){const c=i.path[u];u===i.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(n(i))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return s(this),r}static assert(e){if(!(e instanceof pn))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ue.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},r=[];for(const s of this.issues)s.path.length>0?(n[s.path[0]]=n[s.path[0]]||[],n[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}pn.create=t=>new pn(t);const la=(t,e)=>{let n;switch(t.code){case Q.invalid_type:t.received===ae.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case Q.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,Ue.jsonStringifyReplacer)}`;break;case Q.unrecognized_keys:n=`Unrecognized key(s) in object: ${Ue.joinValues(t.keys,", ")}`;break;case Q.invalid_union:n="Invalid input";break;case Q.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Ue.joinValues(t.options)}`;break;case Q.invalid_enum_value:n=`Invalid enum value. Expected ${Ue.joinValues(t.options)}, received '${t.received}'`;break;case Q.invalid_arguments:n="Invalid function arguments";break;case Q.invalid_return_type:n="Invalid function return type";break;case Q.invalid_date:n="Invalid date";break;case Q.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:Ue.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case Q.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case Q.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case Q.custom:n="Invalid input";break;case Q.invalid_intersection_types:n="Intersection results could not be merged";break;case Q.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case Q.not_finite:n="Number must be finite";break;default:n=e.defaultError,Ue.assertNever(t)}return{message:n}};let I_=la;function B2(t){I_=t}function Fu(){return I_}const Uu=t=>{const{data:e,path:n,errorMaps:r,issueData:s}=t,a=[...n,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="";const u=r.filter(c=>!!c).slice().reverse();for(const c of u)o=c(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}},F2=[];function re(t,e){const n=Fu(),r=Uu({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===la?void 0:la].filter(s=>!!s)});t.common.issues.push(r)}class jt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const r=[];for(const s of n){if(s.status==="aborted")return ye;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){const r=[];for(const s of n){const a=await s.key,i=await s.value;r.push({key:a,value:i})}return jt.mergeObjectSync(e,r)}static mergeObjectSync(e,n){const r={};for(const s of n){const{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return ye;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(r[a.value]=i.value)}return{status:e.value,value:r}}}const ye=Object.freeze({status:"aborted"}),Js=t=>({status:"dirty",value:t}),Vt=t=>({status:"valid",value:t}),Xd=t=>t.status==="aborted",Qd=t=>t.status==="dirty",ws=t=>t.status==="valid",Oi=t=>typeof Promise<"u"&&t instanceof Promise;function ju(t,e,n,r){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(t)}function N_(t,e,n,r,s){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n}var le;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(le||(le={}));var Qa,ei;class pr{constructor(e,n,r,s){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const bp=(t,e)=>{if(ws(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new pn(t.common.issues);return this._error=n,this._error}}};function ve(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:r,description:s}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{var u,c;const{message:l}=t;return i.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:(u=l??r)!==null&&u!==void 0?u:o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:(c=l??n)!==null&&c!==void 0?c:o.defaultError}},description:s}}class Ne{get description(){return this._def.description}_getType(e){return Cr(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:Cr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new jt,ctx:{common:e.parent.common,data:e.data,parsedType:Cr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(Oi(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){var r;const s={common:{issues:[],async:(r=n==null?void 0:n.async)!==null&&r!==void 0?r:!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Cr(e)},a=this._parseSync({data:e,path:s.path,parent:s});return bp(s,a)}"~validate"(e){var n,r;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Cr(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:s});return ws(a)?{value:a.value}:{issues:s.common.issues}}catch(a){!((r=(n=a==null?void 0:a.message)===null||n===void 0?void 0:n.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(a=>ws(a)?{value:a.value}:{issues:s.common.issues})}async parseAsync(e,n){const r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Cr(e)},s=this._parse({data:e,path:r.path,parent:r}),a=await(Oi(s)?s:Promise.resolve(s));return bp(r,a)}refine(e,n){const r=s=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(s):n;return this._refinement((s,a)=>{const i=e(s),o=()=>a.addIssue({code:Q.custom,...r(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(u=>u?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,n){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof n=="function"?n(r,s):n),!1))}_refinement(e){return new Vn({schema:this,typeName:z.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Hn.create(this,this._def)}nullable(){return Kr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return jn.create(this)}promise(){return ha.create(this,this._def)}or(e){return Ri.create([this,e],this._def)}and(e){return Pi.create(this,e,this._def)}transform(e){return new Vn({...ve(this._def),schema:this,typeName:z.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new Bi({...ve(this._def),innerType:this,defaultValue:n,typeName:z.ZodDefault})}brand(){return new hf({typeName:z.ZodBranded,type:this,...ve(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new Fi({...ve(this._def),innerType:this,catchValue:n,typeName:z.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return oo.create(this,e)}readonly(){return Ui.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const U2=/^c[^\s-]{8,}$/i,j2=/^[0-9a-z]+$/,H2=/^[0-9A-HJKMNP-TV-Z]{26}$/i,$2=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,q2=/^[a-z0-9_-]{21}$/i,V2=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,z2=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,W2=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,G2="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let kl;const K2=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Y2=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Z2=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,J2=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,X2=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Q2=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,R_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",eC=new RegExp(`^${R_}$`);function P_(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function tC(t){return new RegExp(`^${P_(t)}$`)}function x_(t){let e=`${R_}T${P_(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function nC(t,e){return!!((e==="v4"||!e)&&K2.test(t)||(e==="v6"||!e)&&Z2.test(t))}function rC(t,e){if(!V2.test(t))return!1;try{const[n]=t.split("."),r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function sC(t,e){return!!((e==="v4"||!e)&&Y2.test(t)||(e==="v6"||!e)&&J2.test(t))}class Bn extends Ne{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ae.string){const a=this._getOrReturnCtx(e);return re(a,{code:Q.invalid_type,expected:ae.string,received:a.parsedType}),ye}const r=new jt;let s;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),re(s,{code:Q.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),re(s,{code:Q.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?re(s,{code:Q.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&re(s,{code:Q.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")W2.test(e.data)||(s=this._getOrReturnCtx(e,s),re(s,{validation:"email",code:Q.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")kl||(kl=new RegExp(G2,"u")),kl.test(e.data)||(s=this._getOrReturnCtx(e,s),re(s,{validation:"emoji",code:Q.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")$2.test(e.data)||(s=this._getOrReturnCtx(e,s),re(s,{validation:"uuid",code:Q.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")q2.test(e.data)||(s=this._getOrReturnCtx(e,s),re(s,{validation:"nanoid",code:Q.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")U2.test(e.data)||(s=this._getOrReturnCtx(e,s),re(s,{validation:"cuid",code:Q.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")j2.test(e.data)||(s=this._getOrReturnCtx(e,s),re(s,{validation:"cuid2",code:Q.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")H2.test(e.data)||(s=this._getOrReturnCtx(e,s),re(s,{validation:"ulid",code:Q.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),re(s,{validation:"url",code:Q.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),re(s,{validation:"regex",code:Q.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),re(s,{code:Q.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),re(s,{code:Q.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),re(s,{code:Q.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?x_(a).test(e.data)||(s=this._getOrReturnCtx(e,s),re(s,{code:Q.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?eC.test(e.data)||(s=this._getOrReturnCtx(e,s),re(s,{code:Q.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?tC(a).test(e.data)||(s=this._getOrReturnCtx(e,s),re(s,{code:Q.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?z2.test(e.data)||(s=this._getOrReturnCtx(e,s),re(s,{validation:"duration",code:Q.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?nC(e.data,a.version)||(s=this._getOrReturnCtx(e,s),re(s,{validation:"ip",code:Q.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?rC(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),re(s,{validation:"jwt",code:Q.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?sC(e.data,a.version)||(s=this._getOrReturnCtx(e,s),re(s,{validation:"cidr",code:Q.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?X2.test(e.data)||(s=this._getOrReturnCtx(e,s),re(s,{validation:"base64",code:Q.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?Q2.test(e.data)||(s=this._getOrReturnCtx(e,s),re(s,{validation:"base64url",code:Q.invalid_string,message:a.message}),r.dirty()):Ue.assertNever(a);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(s=>e.test(s),{validation:n,code:Q.invalid_string,...le.errToObj(r)})}_addCheck(e){return new Bn({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...le.errToObj(e)})}url(e){return this._addCheck({kind:"url",...le.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...le.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...le.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...le.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...le.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...le.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...le.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...le.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...le.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...le.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...le.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...le.errToObj(e)})}datetime(e){var n,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(n=e==null?void 0:e.offset)!==null&&n!==void 0?n:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...le.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...le.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...le.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...le.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...le.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...le.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...le.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...le.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...le.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...le.errToObj(n)})}nonempty(e){return this.min(1,le.errToObj(e))}trim(){return new Bn({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Bn({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Bn({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Bn.create=t=>{var e;return new Bn({checks:[],typeName:z.ZodString,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...ve(t)})};function aC(t,e){const n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=n>r?n:r,a=parseInt(t.toFixed(s).replace(".","")),i=parseInt(e.toFixed(s).replace(".",""));return a%i/Math.pow(10,s)}class zr extends Ne{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ae.number){const a=this._getOrReturnCtx(e);return re(a,{code:Q.invalid_type,expected:ae.number,received:a.parsedType}),ye}let r;const s=new jt;for(const a of this._def.checks)a.kind==="int"?Ue.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),re(r,{code:Q.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),re(r,{code:Q.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),re(r,{code:Q.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?aC(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),re(r,{code:Q.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),re(r,{code:Q.not_finite,message:a.message}),s.dirty()):Ue.assertNever(a);return{status:s.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,le.toString(n))}gt(e,n){return this.setLimit("min",e,!1,le.toString(n))}lte(e,n){return this.setLimit("max",e,!0,le.toString(n))}lt(e,n){return this.setLimit("max",e,!1,le.toString(n))}setLimit(e,n,r,s){return new zr({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:le.toString(s)}]})}_addCheck(e){return new zr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:le.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:le.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:le.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:le.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:le.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:le.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:le.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:le.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:le.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Ue.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}}zr.create=t=>new zr({checks:[],typeName:z.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...ve(t)});class Wr extends Ne{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ae.bigint)return this._getInvalidInput(e);let r;const s=new jt;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),re(r,{code:Q.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),re(r,{code:Q.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),re(r,{code:Q.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):Ue.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return re(n,{code:Q.invalid_type,expected:ae.bigint,received:n.parsedType}),ye}gte(e,n){return this.setLimit("min",e,!0,le.toString(n))}gt(e,n){return this.setLimit("min",e,!1,le.toString(n))}lte(e,n){return this.setLimit("max",e,!0,le.toString(n))}lt(e,n){return this.setLimit("max",e,!1,le.toString(n))}setLimit(e,n,r,s){return new Wr({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:le.toString(s)}]})}_addCheck(e){return new Wr({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:le.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:le.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:le.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:le.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:le.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Wr.create=t=>{var e;return new Wr({checks:[],typeName:z.ZodBigInt,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...ve(t)})};class ki extends Ne{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ae.boolean){const r=this._getOrReturnCtx(e);return re(r,{code:Q.invalid_type,expected:ae.boolean,received:r.parsedType}),ye}return Vt(e.data)}}ki.create=t=>new ki({typeName:z.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...ve(t)});class Ts extends Ne{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ae.date){const a=this._getOrReturnCtx(e);return re(a,{code:Q.invalid_type,expected:ae.date,received:a.parsedType}),ye}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return re(a,{code:Q.invalid_date}),ye}const r=new jt;let s;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),re(s,{code:Q.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),re(s,{code:Q.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):Ue.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ts({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:le.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:le.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}Ts.create=t=>new Ts({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:z.ZodDate,...ve(t)});class Hu extends Ne{_parse(e){if(this._getType(e)!==ae.symbol){const r=this._getOrReturnCtx(e);return re(r,{code:Q.invalid_type,expected:ae.symbol,received:r.parsedType}),ye}return Vt(e.data)}}Hu.create=t=>new Hu({typeName:z.ZodSymbol,...ve(t)});class Ii extends Ne{_parse(e){if(this._getType(e)!==ae.undefined){const r=this._getOrReturnCtx(e);return re(r,{code:Q.invalid_type,expected:ae.undefined,received:r.parsedType}),ye}return Vt(e.data)}}Ii.create=t=>new Ii({typeName:z.ZodUndefined,...ve(t)});class Ni extends Ne{_parse(e){if(this._getType(e)!==ae.null){const r=this._getOrReturnCtx(e);return re(r,{code:Q.invalid_type,expected:ae.null,received:r.parsedType}),ye}return Vt(e.data)}}Ni.create=t=>new Ni({typeName:z.ZodNull,...ve(t)});class da extends Ne{constructor(){super(...arguments),this._any=!0}_parse(e){return Vt(e.data)}}da.create=t=>new da({typeName:z.ZodAny,...ve(t)});class ps extends Ne{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Vt(e.data)}}ps.create=t=>new ps({typeName:z.ZodUnknown,...ve(t)});class Nr extends Ne{_parse(e){const n=this._getOrReturnCtx(e);return re(n,{code:Q.invalid_type,expected:ae.never,received:n.parsedType}),ye}}Nr.create=t=>new Nr({typeName:z.ZodNever,...ve(t)});class $u extends Ne{_parse(e){if(this._getType(e)!==ae.undefined){const r=this._getOrReturnCtx(e);return re(r,{code:Q.invalid_type,expected:ae.void,received:r.parsedType}),ye}return Vt(e.data)}}$u.create=t=>new $u({typeName:z.ZodVoid,...ve(t)});class jn extends Ne{_parse(e){const{ctx:n,status:r}=this._processInputParams(e),s=this._def;if(n.parsedType!==ae.array)return re(n,{code:Q.invalid_type,expected:ae.array,received:n.parsedType}),ye;if(s.exactLength!==null){const i=n.data.length>s.exactLength.value,o=n.data.length<s.exactLength.value;(i||o)&&(re(n,{code:i?Q.too_big:Q.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&n.data.length<s.minLength.value&&(re(n,{code:Q.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&n.data.length>s.maxLength.value&&(re(n,{code:Q.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((i,o)=>s.type._parseAsync(new pr(n,i,n.path,o)))).then(i=>jt.mergeArray(r,i));const a=[...n.data].map((i,o)=>s.type._parseSync(new pr(n,i,n.path,o)));return jt.mergeArray(r,a)}get element(){return this._def.type}min(e,n){return new jn({...this._def,minLength:{value:e,message:le.toString(n)}})}max(e,n){return new jn({...this._def,maxLength:{value:e,message:le.toString(n)}})}length(e,n){return new jn({...this._def,exactLength:{value:e,message:le.toString(n)}})}nonempty(e){return this.min(1,e)}}jn.create=(t,e)=>new jn({type:t,minLength:null,maxLength:null,exactLength:null,typeName:z.ZodArray,...ve(e)});function Ws(t){if(t instanceof ut){const e={};for(const n in t.shape){const r=t.shape[n];e[n]=Hn.create(Ws(r))}return new ut({...t._def,shape:()=>e})}else return t instanceof jn?new jn({...t._def,type:Ws(t.element)}):t instanceof Hn?Hn.create(Ws(t.unwrap())):t instanceof Kr?Kr.create(Ws(t.unwrap())):t instanceof gr?gr.create(t.items.map(e=>Ws(e))):t}class ut extends Ne{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=Ue.objectKeys(e);return this._cached={shape:e,keys:n}}_parse(e){if(this._getType(e)!==ae.object){const c=this._getOrReturnCtx(e);return re(c,{code:Q.invalid_type,expected:ae.object,received:c.parsedType}),ye}const{status:r,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof Nr&&this._def.unknownKeys==="strip"))for(const c in s.data)i.includes(c)||o.push(c);const u=[];for(const c of i){const l=a[c],d=s.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new pr(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof Nr){const c=this._def.unknownKeys;if(c==="passthrough")for(const l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(c==="strict")o.length>0&&(re(s,{code:Q.unrecognized_keys,keys:o}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const l of o){const d=s.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new pr(s,d,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const c=[];for(const l of u){const d=await l.key,m=await l.value;c.push({key:d,value:m,alwaysSet:l.alwaysSet})}return c}).then(c=>jt.mergeObjectSync(r,c)):jt.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return le.errToObj,new ut({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{var s,a,i,o;const u=(i=(a=(s=this._def).errorMap)===null||a===void 0?void 0:a.call(s,n,r).message)!==null&&i!==void 0?i:r.defaultError;return n.code==="unrecognized_keys"?{message:(o=le.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new ut({...this._def,unknownKeys:"strip"})}passthrough(){return new ut({...this._def,unknownKeys:"passthrough"})}extend(e){return new ut({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ut({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:z.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new ut({...this._def,catchall:e})}pick(e){const n={};return Ue.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(n[r]=this.shape[r])}),new ut({...this._def,shape:()=>n})}omit(e){const n={};return Ue.objectKeys(this.shape).forEach(r=>{e[r]||(n[r]=this.shape[r])}),new ut({...this._def,shape:()=>n})}deepPartial(){return Ws(this)}partial(e){const n={};return Ue.objectKeys(this.shape).forEach(r=>{const s=this.shape[r];e&&!e[r]?n[r]=s:n[r]=s.optional()}),new ut({...this._def,shape:()=>n})}required(e){const n={};return Ue.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])n[r]=this.shape[r];else{let a=this.shape[r];for(;a instanceof Hn;)a=a._def.innerType;n[r]=a}}),new ut({...this._def,shape:()=>n})}keyof(){return L_(Ue.objectKeys(this.shape))}}ut.create=(t,e)=>new ut({shape:()=>t,unknownKeys:"strip",catchall:Nr.create(),typeName:z.ZodObject,...ve(e)});ut.strictCreate=(t,e)=>new ut({shape:()=>t,unknownKeys:"strict",catchall:Nr.create(),typeName:z.ZodObject,...ve(e)});ut.lazycreate=(t,e)=>new ut({shape:t,unknownKeys:"strip",catchall:Nr.create(),typeName:z.ZodObject,...ve(e)});class Ri extends Ne{_parse(e){const{ctx:n}=this._processInputParams(e),r=this._def.options;function s(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return n.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new pn(o.ctx.common.issues));return re(n,{code:Q.invalid_union,unionErrors:i}),ye}if(n.common.async)return Promise.all(r.map(async a=>{const i={...n,common:{...n.common,issues:[]},parent:null};return{result:await a._parseAsync({data:n.data,path:n.path,parent:i}),ctx:i}})).then(s);{let a;const i=[];for(const u of r){const c={...n,common:{...n.common,issues:[]},parent:null},l=u._parseSync({data:n.data,path:n.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!a&&(a={result:l,ctx:c}),c.common.issues.length&&i.push(c.common.issues)}if(a)return n.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(u=>new pn(u));return re(n,{code:Q.invalid_union,unionErrors:o}),ye}}get options(){return this._def.options}}Ri.create=(t,e)=>new Ri({options:t,typeName:z.ZodUnion,...ve(e)});const wr=t=>t instanceof Li?wr(t.schema):t instanceof Vn?wr(t.innerType()):t instanceof Di?[t.value]:t instanceof Gr?t.options:t instanceof Mi?Ue.objectValues(t.enum):t instanceof Bi?wr(t._def.innerType):t instanceof Ii?[void 0]:t instanceof Ni?[null]:t instanceof Hn?[void 0,...wr(t.unwrap())]:t instanceof Kr?[null,...wr(t.unwrap())]:t instanceof hf||t instanceof Ui?wr(t.unwrap()):t instanceof Fi?wr(t._def.innerType):[];class Rc extends Ne{_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==ae.object)return re(n,{code:Q.invalid_type,expected:ae.object,received:n.parsedType}),ye;const r=this.discriminator,s=n.data[r],a=this.optionsMap.get(s);return a?n.common.async?a._parseAsync({data:n.data,path:n.path,parent:n}):a._parseSync({data:n.data,path:n.path,parent:n}):(re(n,{code:Q.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),ye)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,r){const s=new Map;for(const a of n){const i=wr(a.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of i){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,a)}}return new Rc({typeName:z.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:s,...ve(r)})}}function eh(t,e){const n=Cr(t),r=Cr(e);if(t===e)return{valid:!0,data:t};if(n===ae.object&&r===ae.object){const s=Ue.objectKeys(e),a=Ue.objectKeys(t).filter(o=>s.indexOf(o)!==-1),i={...t,...e};for(const o of a){const u=eh(t[o],e[o]);if(!u.valid)return{valid:!1};i[o]=u.data}return{valid:!0,data:i}}else if(n===ae.array&&r===ae.array){if(t.length!==e.length)return{valid:!1};const s=[];for(let a=0;a<t.length;a++){const i=t[a],o=e[a],u=eh(i,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return n===ae.date&&r===ae.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class Pi extends Ne{_parse(e){const{status:n,ctx:r}=this._processInputParams(e),s=(a,i)=>{if(Xd(a)||Xd(i))return ye;const o=eh(a.value,i.value);return o.valid?((Qd(a)||Qd(i))&&n.dirty(),{status:n.value,value:o.data}):(re(r,{code:Q.invalid_intersection_types}),ye)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Pi.create=(t,e,n)=>new Pi({left:t,right:e,typeName:z.ZodIntersection,...ve(n)});class gr extends Ne{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==ae.array)return re(r,{code:Q.invalid_type,expected:ae.array,received:r.parsedType}),ye;if(r.data.length<this._def.items.length)return re(r,{code:Q.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ye;!this._def.rest&&r.data.length>this._def.items.length&&(re(r,{code:Q.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const a=[...r.data].map((i,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new pr(r,i,r.path,o)):null}).filter(i=>!!i);return r.common.async?Promise.all(a).then(i=>jt.mergeArray(n,i)):jt.mergeArray(n,a)}get items(){return this._def.items}rest(e){return new gr({...this._def,rest:e})}}gr.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new gr({items:t,typeName:z.ZodTuple,rest:null,...ve(e)})};class xi extends Ne{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==ae.object)return re(r,{code:Q.invalid_type,expected:ae.object,received:r.parsedType}),ye;const s=[],a=this._def.keyType,i=this._def.valueType;for(const o in r.data)s.push({key:a._parse(new pr(r,o,r.path,o)),value:i._parse(new pr(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?jt.mergeObjectAsync(n,s):jt.mergeObjectSync(n,s)}get element(){return this._def.valueType}static create(e,n,r){return n instanceof Ne?new xi({keyType:e,valueType:n,typeName:z.ZodRecord,...ve(r)}):new xi({keyType:Bn.create(),valueType:e,typeName:z.ZodRecord,...ve(n)})}}class qu extends Ne{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==ae.map)return re(r,{code:Q.invalid_type,expected:ae.map,received:r.parsedType}),ye;const s=this._def.keyType,a=this._def.valueType,i=[...r.data.entries()].map(([o,u],c)=>({key:s._parse(new pr(r,o,r.path,[c,"key"])),value:a._parse(new pr(r,u,r.path,[c,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of i){const c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return ye;(c.status==="dirty"||l.status==="dirty")&&n.dirty(),o.set(c.value,l.value)}return{status:n.value,value:o}})}else{const o=new Map;for(const u of i){const c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return ye;(c.status==="dirty"||l.status==="dirty")&&n.dirty(),o.set(c.value,l.value)}return{status:n.value,value:o}}}}qu.create=(t,e,n)=>new qu({valueType:e,keyType:t,typeName:z.ZodMap,...ve(n)});class Ss extends Ne{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==ae.set)return re(r,{code:Q.invalid_type,expected:ae.set,received:r.parsedType}),ye;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(re(r,{code:Q.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),n.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(re(r,{code:Q.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),n.dirty());const a=this._def.valueType;function i(u){const c=new Set;for(const l of u){if(l.status==="aborted")return ye;l.status==="dirty"&&n.dirty(),c.add(l.value)}return{status:n.value,value:c}}const o=[...r.data.values()].map((u,c)=>a._parse(new pr(r,u,r.path,c)));return r.common.async?Promise.all(o).then(u=>i(u)):i(o)}min(e,n){return new Ss({...this._def,minSize:{value:e,message:le.toString(n)}})}max(e,n){return new Ss({...this._def,maxSize:{value:e,message:le.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}Ss.create=(t,e)=>new Ss({valueType:t,minSize:null,maxSize:null,typeName:z.ZodSet,...ve(e)});class sa extends Ne{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==ae.function)return re(n,{code:Q.invalid_type,expected:ae.function,received:n.parsedType}),ye;function r(o,u){return Uu({data:o,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Fu(),la].filter(c=>!!c),issueData:{code:Q.invalid_arguments,argumentsError:u}})}function s(o,u){return Uu({data:o,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Fu(),la].filter(c=>!!c),issueData:{code:Q.invalid_return_type,returnTypeError:u}})}const a={errorMap:n.common.contextualErrorMap},i=n.data;if(this._def.returns instanceof ha){const o=this;return Vt(async function(...u){const c=new pn([]),l=await o._def.args.parseAsync(u,a).catch(p=>{throw c.addIssue(r(u,p)),c}),d=await Reflect.apply(i,this,l);return await o._def.returns._def.type.parseAsync(d,a).catch(p=>{throw c.addIssue(s(d,p)),c})})}else{const o=this;return Vt(function(...u){const c=o._def.args.safeParse(u,a);if(!c.success)throw new pn([r(u,c.error)]);const l=Reflect.apply(i,this,c.data),d=o._def.returns.safeParse(l,a);if(!d.success)throw new pn([s(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new sa({...this._def,args:gr.create(e).rest(ps.create())})}returns(e){return new sa({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,r){return new sa({args:e||gr.create([]).rest(ps.create()),returns:n||ps.create(),typeName:z.ZodFunction,...ve(r)})}}class Li extends Ne{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}Li.create=(t,e)=>new Li({getter:t,typeName:z.ZodLazy,...ve(e)});class Di extends Ne{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return re(n,{received:n.data,code:Q.invalid_literal,expected:this._def.value}),ye}return{status:"valid",value:e.data}}get value(){return this._def.value}}Di.create=(t,e)=>new Di({value:t,typeName:z.ZodLiteral,...ve(e)});function L_(t,e){return new Gr({values:t,typeName:z.ZodEnum,...ve(e)})}class Gr extends Ne{constructor(){super(...arguments),Qa.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),r=this._def.values;return re(n,{expected:Ue.joinValues(r),received:n.parsedType,code:Q.invalid_type}),ye}if(ju(this,Qa)||N_(this,Qa,new Set(this._def.values)),!ju(this,Qa).has(e.data)){const n=this._getOrReturnCtx(e),r=this._def.values;return re(n,{received:n.data,code:Q.invalid_enum_value,options:r}),ye}return Vt(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return Gr.create(e,{...this._def,...n})}exclude(e,n=this._def){return Gr.create(this.options.filter(r=>!e.includes(r)),{...this._def,...n})}}Qa=new WeakMap;Gr.create=L_;class Mi extends Ne{constructor(){super(...arguments),ei.set(this,void 0)}_parse(e){const n=Ue.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==ae.string&&r.parsedType!==ae.number){const s=Ue.objectValues(n);return re(r,{expected:Ue.joinValues(s),received:r.parsedType,code:Q.invalid_type}),ye}if(ju(this,ei)||N_(this,ei,new Set(Ue.getValidEnumValues(this._def.values))),!ju(this,ei).has(e.data)){const s=Ue.objectValues(n);return re(r,{received:r.data,code:Q.invalid_enum_value,options:s}),ye}return Vt(e.data)}get enum(){return this._def.values}}ei=new WeakMap;Mi.create=(t,e)=>new Mi({values:t,typeName:z.ZodNativeEnum,...ve(e)});class ha extends Ne{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==ae.promise&&n.common.async===!1)return re(n,{code:Q.invalid_type,expected:ae.promise,received:n.parsedType}),ye;const r=n.parsedType===ae.promise?n.data:Promise.resolve(n.data);return Vt(r.then(s=>this._def.type.parseAsync(s,{path:n.path,errorMap:n.common.contextualErrorMap})))}}ha.create=(t,e)=>new ha({type:t,typeName:z.ZodPromise,...ve(e)});class Vn extends Ne{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===z.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:r}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{re(r,i),i.fatal?n.abort():n.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){const i=s.transform(r.data,a);if(r.common.async)return Promise.resolve(i).then(async o=>{if(n.value==="aborted")return ye;const u=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return u.status==="aborted"?ye:u.status==="dirty"||n.value==="dirty"?Js(u.value):u});{if(n.value==="aborted")return ye;const o=this._def.schema._parseSync({data:i,path:r.path,parent:r});return o.status==="aborted"?ye:o.status==="dirty"||n.value==="dirty"?Js(o.value):o}}if(s.type==="refinement"){const i=o=>{const u=s.refinement(o,a);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?ye:(o.status==="dirty"&&n.dirty(),i(o.value),{status:n.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?ye:(o.status==="dirty"&&n.dirty(),i(o.value).then(()=>({status:n.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!ws(i))return i;const o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>ws(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:n.value,value:o})):i);Ue.assertNever(s)}}Vn.create=(t,e,n)=>new Vn({schema:t,typeName:z.ZodEffects,effect:e,...ve(n)});Vn.createWithPreprocess=(t,e,n)=>new Vn({schema:e,effect:{type:"preprocess",transform:t},typeName:z.ZodEffects,...ve(n)});class Hn extends Ne{_parse(e){return this._getType(e)===ae.undefined?Vt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Hn.create=(t,e)=>new Hn({innerType:t,typeName:z.ZodOptional,...ve(e)});class Kr extends Ne{_parse(e){return this._getType(e)===ae.null?Vt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Kr.create=(t,e)=>new Kr({innerType:t,typeName:z.ZodNullable,...ve(e)});class Bi extends Ne{_parse(e){const{ctx:n}=this._processInputParams(e);let r=n.data;return n.parsedType===ae.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}Bi.create=(t,e)=>new Bi({innerType:t,typeName:z.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...ve(e)});class Fi extends Ne{_parse(e){const{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Oi(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new pn(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new pn(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Fi.create=(t,e)=>new Fi({innerType:t,typeName:z.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...ve(e)});class Vu extends Ne{_parse(e){if(this._getType(e)!==ae.nan){const r=this._getOrReturnCtx(e);return re(r,{code:Q.invalid_type,expected:ae.nan,received:r.parsedType}),ye}return{status:"valid",value:e.data}}}Vu.create=t=>new Vu({typeName:z.ZodNaN,...ve(t)});const iC=Symbol("zod_brand");class hf extends Ne{_parse(e){const{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class oo extends Ne{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?ye:a.status==="dirty"?(n.dirty(),Js(a.value)):this._def.out._parseAsync({data:a.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?ye:s.status==="dirty"?(n.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,n){return new oo({in:e,out:n,typeName:z.ZodPipeline})}}class Ui extends Ne{_parse(e){const n=this._def.innerType._parse(e),r=s=>(ws(s)&&(s.value=Object.freeze(s.value)),s);return Oi(n)?n.then(s=>r(s)):r(n)}unwrap(){return this._def.innerType}}Ui.create=(t,e)=>new Ui({innerType:t,typeName:z.ZodReadonly,...ve(e)});function D_(t,e={},n){return t?da.create().superRefine((r,s)=>{var a,i;if(!t(r)){const o=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,u=(i=(a=o.fatal)!==null&&a!==void 0?a:n)!==null&&i!==void 0?i:!0,c=typeof o=="string"?{message:o}:o;s.addIssue({code:"custom",...c,fatal:u})}}):da.create()}const oC={object:ut.lazycreate};var z;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(z||(z={}));const uC=(t,e={message:`Input not instance of ${t.name}`})=>D_(n=>n instanceof t,e),M_=Bn.create,B_=zr.create,cC=Vu.create,lC=Wr.create,F_=ki.create,dC=Ts.create,hC=Hu.create,fC=Ii.create,mC=Ni.create,pC=da.create,gC=ps.create,bC=Nr.create,_C=$u.create,yC=jn.create,EC=ut.create,wC=ut.strictCreate,TC=Ri.create,SC=Rc.create,AC=Pi.create,CC=gr.create,vC=xi.create,OC=qu.create,kC=Ss.create,IC=sa.create,NC=Li.create,RC=Di.create,PC=Gr.create,xC=Mi.create,LC=ha.create,_p=Vn.create,DC=Hn.create,MC=Kr.create,BC=Vn.createWithPreprocess,FC=oo.create,UC=()=>M_().optional(),jC=()=>B_().optional(),HC=()=>F_().optional(),$C={string:t=>Bn.create({...t,coerce:!0}),number:t=>zr.create({...t,coerce:!0}),boolean:t=>ki.create({...t,coerce:!0}),bigint:t=>Wr.create({...t,coerce:!0}),date:t=>Ts.create({...t,coerce:!0})},qC=ye;var Or=Object.freeze({__proto__:null,defaultErrorMap:la,setErrorMap:B2,getErrorMap:Fu,makeIssue:Uu,EMPTY_PATH:F2,addIssueToContext:re,ParseStatus:jt,INVALID:ye,DIRTY:Js,OK:Vt,isAborted:Xd,isDirty:Qd,isValid:ws,isAsync:Oi,get util(){return Ue},get objectUtil(){return Jd},ZodParsedType:ae,getParsedType:Cr,ZodType:Ne,datetimeRegex:x_,ZodString:Bn,ZodNumber:zr,ZodBigInt:Wr,ZodBoolean:ki,ZodDate:Ts,ZodSymbol:Hu,ZodUndefined:Ii,ZodNull:Ni,ZodAny:da,ZodUnknown:ps,ZodNever:Nr,ZodVoid:$u,ZodArray:jn,ZodObject:ut,ZodUnion:Ri,ZodDiscriminatedUnion:Rc,ZodIntersection:Pi,ZodTuple:gr,ZodRecord:xi,ZodMap:qu,ZodSet:Ss,ZodFunction:sa,ZodLazy:Li,ZodLiteral:Di,ZodEnum:Gr,ZodNativeEnum:Mi,ZodPromise:ha,ZodEffects:Vn,ZodTransformer:Vn,ZodOptional:Hn,ZodNullable:Kr,ZodDefault:Bi,ZodCatch:Fi,ZodNaN:Vu,BRAND:iC,ZodBranded:hf,ZodPipeline:oo,ZodReadonly:Ui,custom:D_,Schema:Ne,ZodSchema:Ne,late:oC,get ZodFirstPartyTypeKind(){return z},coerce:$C,any:pC,array:yC,bigint:lC,boolean:F_,date:dC,discriminatedUnion:SC,effect:_p,enum:PC,function:IC,instanceof:uC,intersection:AC,lazy:NC,literal:RC,map:OC,nan:cC,nativeEnum:xC,never:bC,null:mC,nullable:MC,number:B_,object:EC,oboolean:HC,onumber:jC,optional:DC,ostring:UC,pipeline:FC,preprocess:BC,promise:LC,record:vC,set:kC,strictObject:wC,string:M_,symbol:hC,transformer:_p,tuple:CC,undefined:fC,union:TC,unknown:gC,void:_C,NEVER:qC,ZodIssueCode:Q,quotelessJson:M2,ZodError:pn}),Pc={exports:{}},U_={};function kn(t,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var VC=kn;kn.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};kn.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};kn.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=new Date().getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},n),this._options.unref&&this._timer.unref(),!0};kn.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};kn.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)};kn.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)};kn.prototype.start=kn.prototype.try;kn.prototype.errors=function(){return this._errors};kn.prototype.attempts=function(){return this._attempts};kn.prototype.mainError=function(){if(this._errors.length===0)return null;for(var t={},e=null,n=0,r=0;r<this._errors.length;r++){var s=this._errors[r],a=s.message,i=(t[a]||0)+1;t[a]=i,i>=n&&(e=s,n=i)}return e};(function(t){var e=VC;t.operation=function(n){var r=t.timeouts(n);return new e(r,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})},t.timeouts=function(n){if(n instanceof Array)return[].concat(n);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in n)r[s]=n[s];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],i=0;i<r.retries;i++)a.push(this.createTimeout(i,r));return n&&n.forever&&!a.length&&a.push(this.createTimeout(i,r)),a.sort(function(o,u){return o-u}),a},t.createTimeout=function(n,r){var s=r.randomize?Math.random()+1:1,a=Math.round(s*Math.max(r.minTimeout,1)*Math.pow(r.factor,n));return a=Math.min(a,r.maxTimeout),a},t.wrap=function(n,r,s){if(r instanceof Array&&(s=r,r=null),!s){s=[];for(var a in n)typeof n[a]=="function"&&s.push(a)}for(var i=0;i<s.length;i++){var o=s[i],u=n[o];n[o]=(function(l){var d=t.operation(r),m=Array.prototype.slice.call(arguments,1),p=m.pop();m.push(function(h){d.retry(h)||(h&&(arguments[0]=d.mainError()),p.apply(this,arguments))}),d.attempt(function(){l.apply(n,m)})}).bind(n,u),n[o].options=r}}})(U_);var zC=U_;const WC=zC,GC=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class j_ extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const KC=(t,e,n)=>{const r=n.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=r,t},YC=t=>GC.includes(t),H_=(t,e)=>new Promise((n,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const s=WC.operation(e);s.attempt(async a=>{try{n(await t(a))}catch(i){if(!(i instanceof Error)){r(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof j_)s.stop(),r(i.originalError);else if(i instanceof TypeError&&!YC(i.message))s.stop(),r(i);else{KC(i,a,e);try{await e.onFailedAttempt(i)}catch(o){r(o);return}s.retry(i)||r(s.mainError())}}})});Pc.exports=H_;Pc.exports.default=H_;Pc.exports.AbortError=j_;var ZC=Pc.exports;const zu=io(ZC),JC=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function hi(t){return typeof t=="string"&&JC.test(t)}var xt=[];for(var Il=0;Il<256;++Il)xt.push((Il+256).toString(16).slice(1));function XC(t,e=0){return(xt[t[e+0]]+xt[t[e+1]]+xt[t[e+2]]+xt[t[e+3]]+"-"+xt[t[e+4]]+xt[t[e+5]]+"-"+xt[t[e+6]]+xt[t[e+7]]+"-"+xt[t[e+8]]+xt[t[e+9]]+"-"+xt[t[e+10]]+xt[t[e+11]]+xt[t[e+12]]+xt[t[e+13]]+xt[t[e+14]]+xt[t[e+15]]).toLowerCase()}var Lo,QC=new Uint8Array(16);function ev(){if(!Lo&&(Lo=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Lo))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Lo(QC)}var tv=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const yp={randomUUID:tv};function Qt(t,e,n){if(yp.randomUUID&&!t)return yp.randomUUID();t=t||{};var r=t.random||(t.rng||ev)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,XC(r)}var $_={},q_={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function s(u,c,l){this.fn=u,this.context=c,this.once=l||!1}function a(u,c,l,d,m){if(typeof l!="function")throw new TypeError("The listener must be a function");var p=new s(l,d||u,m),h=n?n+c:c;return u._events[h]?u._events[h].fn?u._events[h]=[u._events[h],p]:u._events[h].push(p):(u._events[h]=p,u._eventsCount++),u}function i(u,c){--u._eventsCount===0?u._events=new r:delete u._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],l,d;if(this._eventsCount===0)return c;for(d in l=this._events)e.call(l,d)&&c.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},o.prototype.listeners=function(c){var l=n?n+c:c,d=this._events[l];if(!d)return[];if(d.fn)return[d.fn];for(var m=0,p=d.length,h=new Array(p);m<p;m++)h[m]=d[m].fn;return h},o.prototype.listenerCount=function(c){var l=n?n+c:c,d=this._events[l];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,l,d,m,p,h){var g=n?n+c:c;if(!this._events[g])return!1;var b=this._events[g],_=arguments.length,y,E;if(b.fn){switch(b.once&&this.removeListener(c,b.fn,void 0,!0),_){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,l),!0;case 3:return b.fn.call(b.context,l,d),!0;case 4:return b.fn.call(b.context,l,d,m),!0;case 5:return b.fn.call(b.context,l,d,m,p),!0;case 6:return b.fn.call(b.context,l,d,m,p,h),!0}for(E=1,y=new Array(_-1);E<_;E++)y[E-1]=arguments[E];b.fn.apply(b.context,y)}else{var I=b.length,w;for(E=0;E<I;E++)switch(b[E].once&&this.removeListener(c,b[E].fn,void 0,!0),_){case 1:b[E].fn.call(b[E].context);break;case 2:b[E].fn.call(b[E].context,l);break;case 3:b[E].fn.call(b[E].context,l,d);break;case 4:b[E].fn.call(b[E].context,l,d,m);break;default:if(!y)for(w=1,y=new Array(_-1);w<_;w++)y[w-1]=arguments[w];b[E].fn.apply(b[E].context,y)}}return!0},o.prototype.on=function(c,l,d){return a(this,c,l,d,!1)},o.prototype.once=function(c,l,d){return a(this,c,l,d,!0)},o.prototype.removeListener=function(c,l,d,m){var p=n?n+c:c;if(!this._events[p])return this;if(!l)return i(this,p),this;var h=this._events[p];if(h.fn)h.fn===l&&(!m||h.once)&&(!d||h.context===d)&&i(this,p);else{for(var g=0,b=[],_=h.length;g<_;g++)(h[g].fn!==l||m&&!h[g].once||d&&h[g].context!==d)&&b.push(h[g]);b.length?this._events[p]=b.length===1?b[0]:b:i(this,p)}return this},o.prototype.removeAllListeners=function(c){var l;return c?(l=n?n+c:c,this._events[l]&&i(this,l)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,t.exports=o})(q_);var nv=q_.exports,xc={exports:{}},rv=(t,e)=>(e=e||(()=>{}),t.then(n=>new Promise(r=>{r(e())}).then(()=>n),n=>new Promise(r=>{r(e())}).then(()=>{throw n})));const sv=rv;class V_ extends Error{constructor(e){super(e),this.name="TimeoutError"}}const z_=(t,e,n)=>new Promise((r,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(t);return}const a=setTimeout(()=>{if(typeof n=="function"){try{r(n())}catch(u){s(u)}return}const i=typeof n=="string"?n:`Promise timed out after ${e} milliseconds`,o=n instanceof Error?n:new V_(i);typeof t.cancel=="function"&&t.cancel(),s(o)},e);sv(t.then(r,s),()=>{clearTimeout(a)})});xc.exports=z_;xc.exports.default=z_;xc.exports.TimeoutError=V_;var av=xc.exports,ff={},mf={};Object.defineProperty(mf,"__esModule",{value:!0});function iv(t,e,n){let r=0,s=t.length;for(;s>0;){const a=s/2|0;let i=r+a;n(t[i],e)<=0?(r=++i,s-=a+1):s=a}return r}mf.default=iv;Object.defineProperty(ff,"__esModule",{value:!0});const ov=mf;class uv{constructor(){this._queue=[]}enqueue(e,n){n=Object.assign({priority:0},n);const r={priority:n.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=n.priority){this._queue.push(r);return}const s=ov.default(this._queue,r,(a,i)=>i.priority-a.priority);this._queue.splice(s,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(n=>n.priority===e.priority).map(n=>n.run)}get size(){return this._queue.length}}ff.default=uv;Object.defineProperty($_,"__esModule",{value:!0});const cv=nv,W_=av,lv=ff,Do=()=>{},dv=new W_.TimeoutError;class hv extends cv{constructor(e){var n,r,s,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Do,this._resolveIdle=Do,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:lv.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(n=e.intervalCap)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(a=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Do,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Do,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const n=this._intervalEnd-e;if(n<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},n)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const n=this._queue.dequeue();return n?(this.emit("active"),n(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,n={}){return new Promise((r,s)=>{const a=async()=>{this._pendingCount++,this._intervalCount++;try{const i=this._timeout===void 0&&n.timeout===void 0?e():W_.default(Promise.resolve(e()),n.timeout===void 0?this._timeout:n.timeout,()=>{(n.throwOnTimeout===void 0?this._throwOnTimeout:n.throwOnTimeout)&&s(dv)});r(await i)}catch(i){s(i)}this._next()};this._queue.enqueue(a,n),this._tryToStartAnother(),this.emit("add")})}async addAll(e,n){return Promise.all(e.map(async r=>this.add(r,n)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const n=this._resolveEmpty;this._resolveEmpty=()=>{n(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const n=this._resolveIdle;this._resolveIdle=()=>{n(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var kr=$_.default=hv;const fv=(...t)=>fetch(...t),mv=Symbol.for("ls:fetch_implementation"),he=()=>globalThis[mv]??fv,pv=[400,401,403,404,405,406,407,408],gv=[409];let Ep=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in kr?this.queue=new kr.default({concurrency:this.maxConcurrency}):this.queue=new kr({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...n){const r=this.onFailedResponseHook;return this.queue.add(()=>zu(()=>e(...n).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;const a=s==null?void 0:s.response,i=a==null?void 0:a.status;if(i){if(pv.includes(+i))throw s;if(gv.includes(+i))return;r&&await r(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,n,...r){return e.signal?Promise.race([this.call(n,...r),new Promise((s,a)=>{var i;(i=e.signal)==null||i.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(n,...r)}fetch(...e){return this.call(()=>he()(...e).then(n=>n.ok?n:Promise.reject(n)))}};function wp(t){return typeof(t==null?void 0:t._getType)=="function"}function Tp(t){const e={type:t._getType(),data:{content:t.content}};return t!=null&&t.additional_kwargs&&Object.keys(t.additional_kwargs).length>0&&(e.data.additional_kwargs={...t.additional_kwargs}),e}function Oe(t,e){if(!hi(t)){const n=e!==void 0?`Invalid UUID for ${e}: ${t}`:`Invalid UUID: ${t}`;throw new Error(n)}return t}const Sp={};function G_(t){Sp[t]||(console.warn(t),Sp[t]=!0)}var th={exports:{}};const bv="2.0.0",K_=256,_v=Number.MAX_SAFE_INTEGER||9007199254740991,yv=16,Ev=K_-6,wv=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var Lc={MAX_LENGTH:K_,MAX_SAFE_COMPONENT_LENGTH:yv,MAX_SAFE_BUILD_LENGTH:Ev,MAX_SAFE_INTEGER:_v,RELEASE_TYPES:wv,SEMVER_SPEC_VERSION:bv,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const Tv=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};var Dc=Tv;(function(t,e){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:s}=Lc,a=Dc;e=t.exports={};const i=e.re=[],o=e.safeRe=[],u=e.src=[],c=e.t={};let l=0;const d="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",s],[d,r]],p=g=>{for(const[b,_]of m)g=g.split(`${b}*`).join(`${b}{0,${_}}`).split(`${b}+`).join(`${b}{1,${_}}`);return g},h=(g,b,_)=>{const y=p(b),E=l++;a(g,E,b),c[g]=E,u[E]=b,i[E]=new RegExp(b,_?"g":void 0),o[E]=new RegExp(y,_?"g":void 0)};h("NUMERICIDENTIFIER","0|[1-9]\\d*"),h("NUMERICIDENTIFIERLOOSE","\\d+"),h("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${d}*`),h("MAINVERSION",`(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})`),h("MAINVERSIONLOOSE",`(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})`),h("PRERELEASEIDENTIFIER",`(?:${u[c.NUMERICIDENTIFIER]}|${u[c.NONNUMERICIDENTIFIER]})`),h("PRERELEASEIDENTIFIERLOOSE",`(?:${u[c.NUMERICIDENTIFIERLOOSE]}|${u[c.NONNUMERICIDENTIFIER]})`),h("PRERELEASE",`(?:-(${u[c.PRERELEASEIDENTIFIER]}(?:\\.${u[c.PRERELEASEIDENTIFIER]})*))`),h("PRERELEASELOOSE",`(?:-?(${u[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[c.PRERELEASEIDENTIFIERLOOSE]})*))`),h("BUILDIDENTIFIER",`${d}+`),h("BUILD",`(?:\\+(${u[c.BUILDIDENTIFIER]}(?:\\.${u[c.BUILDIDENTIFIER]})*))`),h("FULLPLAIN",`v?${u[c.MAINVERSION]}${u[c.PRERELEASE]}?${u[c.BUILD]}?`),h("FULL",`^${u[c.FULLPLAIN]}$`),h("LOOSEPLAIN",`[v=\\s]*${u[c.MAINVERSIONLOOSE]}${u[c.PRERELEASELOOSE]}?${u[c.BUILD]}?`),h("LOOSE",`^${u[c.LOOSEPLAIN]}$`),h("GTLT","((?:<|>)?=?)"),h("XRANGEIDENTIFIERLOOSE",`${u[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),h("XRANGEIDENTIFIER",`${u[c.NUMERICIDENTIFIER]}|x|X|\\*`),h("XRANGEPLAIN",`[v=\\s]*(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:${u[c.PRERELEASE]})?${u[c.BUILD]}?)?)?`),h("XRANGEPLAINLOOSE",`[v=\\s]*(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:${u[c.PRERELEASELOOSE]})?${u[c.BUILD]}?)?)?`),h("XRANGE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAIN]}$`),h("XRANGELOOSE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAINLOOSE]}$`),h("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),h("COERCE",`${u[c.COERCEPLAIN]}(?:$|[^\\d])`),h("COERCEFULL",u[c.COERCEPLAIN]+`(?:${u[c.PRERELEASE]})?(?:${u[c.BUILD]})?(?:$|[^\\d])`),h("COERCERTL",u[c.COERCE],!0),h("COERCERTLFULL",u[c.COERCEFULL],!0),h("LONETILDE","(?:~>?)"),h("TILDETRIM",`(\\s*)${u[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",h("TILDE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAIN]}$`),h("TILDELOOSE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAINLOOSE]}$`),h("LONECARET","(?:\\^)"),h("CARETTRIM",`(\\s*)${u[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",h("CARET",`^${u[c.LONECARET]}${u[c.XRANGEPLAIN]}$`),h("CARETLOOSE",`^${u[c.LONECARET]}${u[c.XRANGEPLAINLOOSE]}$`),h("COMPARATORLOOSE",`^${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]})$|^$`),h("COMPARATOR",`^${u[c.GTLT]}\\s*(${u[c.FULLPLAIN]})$|^$`),h("COMPARATORTRIM",`(\\s*)${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]}|${u[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",h("HYPHENRANGE",`^\\s*(${u[c.XRANGEPLAIN]})\\s+-\\s+(${u[c.XRANGEPLAIN]})\\s*$`),h("HYPHENRANGELOOSE",`^\\s*(${u[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[c.XRANGEPLAINLOOSE]})\\s*$`),h("STAR","(<|>)?=?\\s*\\*"),h("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),h("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(th,th.exports);var uo=th.exports;const Sv=Object.freeze({loose:!0}),Av=Object.freeze({}),Cv=t=>t?typeof t!="object"?Sv:t:Av;var pf=Cv;const Ap=/^[0-9]+$/,Y_=(t,e)=>{const n=Ap.test(t),r=Ap.test(e);return n&&r&&(t=+t,e=+e),t===e?0:n&&!r?-1:r&&!n?1:t<e?-1:1},vv=(t,e)=>Y_(e,t);var Z_={compareIdentifiers:Y_,rcompareIdentifiers:vv};const Mo=Dc,{MAX_LENGTH:Cp,MAX_SAFE_INTEGER:Bo}=Lc,{safeRe:Fo,t:Uo}=uo,Ov=pf,{compareIdentifiers:Ms}=Z_;let kv=class nr{constructor(e,n){if(n=Ov(n),e instanceof nr){if(e.loose===!!n.loose&&e.includePrerelease===!!n.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Cp)throw new TypeError(`version is longer than ${Cp} characters`);Mo("SemVer",e,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const r=e.trim().match(n.loose?Fo[Uo.LOOSE]:Fo[Uo.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Bo||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Bo||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Bo||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){const a=+s;if(a>=0&&a<Bo)return a}return s}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Mo("SemVer.compare",this.version,this.options,e),!(e instanceof nr)){if(typeof e=="string"&&e===this.version)return 0;e=new nr(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof nr||(e=new nr(e,this.options)),Ms(this.major,e.major)||Ms(this.minor,e.minor)||Ms(this.patch,e.patch)}comparePre(e){if(e instanceof nr||(e=new nr(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let n=0;do{const r=this.prerelease[n],s=e.prerelease[n];if(Mo("prerelease compare",n,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return Ms(r,s)}while(++n)}compareBuild(e){e instanceof nr||(e=new nr(e,this.options));let n=0;do{const r=this.build[n],s=e.build[n];if(Mo("build compare",n,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return Ms(r,s)}while(++n)}inc(e,n,r){if(e.startsWith("pre")){if(!n&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(n){const s=`-${n}`.match(this.options.loose?Fo[Uo.PRERELEASELOOSE]:Fo[Uo.PRERELEASE]);if(!s||s[1]!==n)throw new Error(`invalid identifier: ${n}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n,r),this.inc("pre",n,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n,r),this.inc("pre",n,r);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const s=Number(r)?1:0;if(this.prerelease.length===0)this.prerelease=[s];else{let a=this.prerelease.length;for(;--a>=0;)typeof this.prerelease[a]=="number"&&(this.prerelease[a]++,a=-2);if(a===-1){if(n===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(n){let a=[n,s];r===!1&&(a=[n]),Ms(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var Wt=kv;const vp=Wt,Iv=(t,e,n=!1)=>{if(t instanceof vp)return t;try{return new vp(t,e)}catch(r){if(!n)return null;throw r}};var wa=Iv;const Nv=wa,Rv=(t,e)=>{const n=Nv(t,e);return n?n.version:null};var Pv=Rv;const xv=wa,Lv=(t,e)=>{const n=xv(t.trim().replace(/^[=v]+/,""),e);return n?n.version:null};var Dv=Lv;const Op=Wt,Mv=(t,e,n,r,s)=>{typeof n=="string"&&(s=r,r=n,n=void 0);try{return new Op(t instanceof Op?t.version:t,n).inc(e,r,s).version}catch{return null}};var Bv=Mv;const kp=wa,Fv=(t,e)=>{const n=kp(t,null,!0),r=kp(e,null,!0),s=n.compare(r);if(s===0)return null;const a=s>0,i=a?n:r,o=a?r:n,u=!!i.prerelease.length;if(!!o.prerelease.length&&!u){if(!o.patch&&!o.minor)return"major";if(o.compareMain(i)===0)return o.minor&&!o.patch?"minor":"patch"}const l=u?"pre":"";return n.major!==r.major?l+"major":n.minor!==r.minor?l+"minor":n.patch!==r.patch?l+"patch":"prerelease"};var Uv=Fv;const jv=Wt,Hv=(t,e)=>new jv(t,e).major;var $v=Hv;const qv=Wt,Vv=(t,e)=>new qv(t,e).minor;var zv=Vv;const Wv=Wt,Gv=(t,e)=>new Wv(t,e).patch;var Kv=Gv;const Yv=wa,Zv=(t,e)=>{const n=Yv(t,e);return n&&n.prerelease.length?n.prerelease:null};var Jv=Zv;const Ip=Wt,Xv=(t,e,n)=>new Ip(t,n).compare(new Ip(e,n));var Gn=Xv;const Qv=Gn,eO=(t,e,n)=>Qv(e,t,n);var tO=eO;const nO=Gn,rO=(t,e)=>nO(t,e,!0);var sO=rO;const Np=Wt,aO=(t,e,n)=>{const r=new Np(t,n),s=new Np(e,n);return r.compare(s)||r.compareBuild(s)};var gf=aO;const iO=gf,oO=(t,e)=>t.sort((n,r)=>iO(n,r,e));var uO=oO;const cO=gf,lO=(t,e)=>t.sort((n,r)=>cO(r,n,e));var dO=lO;const hO=Gn,fO=(t,e,n)=>hO(t,e,n)>0;var Mc=fO;const mO=Gn,pO=(t,e,n)=>mO(t,e,n)<0;var bf=pO;const gO=Gn,bO=(t,e,n)=>gO(t,e,n)===0;var J_=bO;const _O=Gn,yO=(t,e,n)=>_O(t,e,n)!==0;var X_=yO;const EO=Gn,wO=(t,e,n)=>EO(t,e,n)>=0;var _f=wO;const TO=Gn,SO=(t,e,n)=>TO(t,e,n)<=0;var yf=SO;const AO=J_,CO=X_,vO=Mc,OO=_f,kO=bf,IO=yf,NO=(t,e,n,r)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t===n;case"!==":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t!==n;case"":case"=":case"==":return AO(t,n,r);case"!=":return CO(t,n,r);case">":return vO(t,n,r);case">=":return OO(t,n,r);case"<":return kO(t,n,r);case"<=":return IO(t,n,r);default:throw new TypeError(`Invalid operator: ${e}`)}};var Q_=NO;const RO=Wt,PO=wa,{safeRe:jo,t:Ho}=uo,xO=(t,e)=>{if(t instanceof RO)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let n=null;if(!e.rtl)n=t.match(e.includePrerelease?jo[Ho.COERCEFULL]:jo[Ho.COERCE]);else{const u=e.includePrerelease?jo[Ho.COERCERTLFULL]:jo[Ho.COERCERTL];let c;for(;(c=u.exec(t))&&(!n||n.index+n[0].length!==t.length);)(!n||c.index+c[0].length!==n.index+n[0].length)&&(n=c),u.lastIndex=c.index+c[1].length+c[2].length;u.lastIndex=-1}if(n===null)return null;const r=n[2],s=n[3]||"0",a=n[4]||"0",i=e.includePrerelease&&n[5]?`-${n[5]}`:"",o=e.includePrerelease&&n[6]?`+${n[6]}`:"";return PO(`${r}.${s}.${a}${i}${o}`,e)};var LO=xO;class DO{constructor(){this.max=1e3,this.map=new Map}get(e){const n=this.map.get(e);if(n!==void 0)return this.map.delete(e),this.map.set(e,n),n}delete(e){return this.map.delete(e)}set(e,n){if(!this.delete(e)&&n!==void 0){if(this.map.size>=this.max){const s=this.map.keys().next().value;this.delete(s)}this.map.set(e,n)}return this}}var MO=DO,Nl,Rp;function Kn(){if(Rp)return Nl;Rp=1;const t=/\s+/g;class e{constructor(S,P){if(P=s(P),S instanceof e)return S.loose===!!P.loose&&S.includePrerelease===!!P.includePrerelease?S:new e(S.raw,P);if(S instanceof a)return this.raw=S.value,this.set=[[S]],this.formatted=void 0,this;if(this.options=P,this.loose=!!P.loose,this.includePrerelease=!!P.includePrerelease,this.raw=S.trim().replace(t," "),this.set=this.raw.split("||").map(U=>this.parseRange(U.trim())).filter(U=>U.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const U=this.set[0];if(this.set=this.set.filter(D=>!g(D[0])),this.set.length===0)this.set=[U];else if(this.set.length>1){for(const D of this.set)if(D.length===1&&b(D[0])){this.set=[D];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let S=0;S<this.set.length;S++){S>0&&(this.formatted+="||");const P=this.set[S];for(let U=0;U<P.length;U++)U>0&&(this.formatted+=" "),this.formatted+=P[U].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(S){const U=((this.options.includePrerelease&&p)|(this.options.loose&&h))+":"+S,D=r.get(U);if(D)return D;const W=this.options.loose,K=W?u[c.HYPHENRANGELOOSE]:u[c.HYPHENRANGE];S=S.replace(K,te(this.options.includePrerelease)),i("hyphen replace",S),S=S.replace(u[c.COMPARATORTRIM],l),i("comparator trim",S),S=S.replace(u[c.TILDETRIM],d),i("tilde trim",S),S=S.replace(u[c.CARETTRIM],m),i("caret trim",S);let G=S.split(" ").map(ke=>y(ke,this.options)).join(" ").split(/\s+/).map(ke=>H(ke,this.options));W&&(G=G.filter(ke=>(i("loose invalid filter",ke,this.options),!!ke.match(u[c.COMPARATORLOOSE])))),i("range list",G);const se=new Map,we=G.map(ke=>new a(ke,this.options));for(const ke of we){if(g(ke))return[ke];se.set(ke.value,ke)}se.size>1&&se.has("")&&se.delete("");const Le=[...se.values()];return r.set(U,Le),Le}intersects(S,P){if(!(S instanceof e))throw new TypeError("a Range is required");return this.set.some(U=>_(U,P)&&S.set.some(D=>_(D,P)&&U.every(W=>D.every(K=>W.intersects(K,P)))))}test(S){if(!S)return!1;if(typeof S=="string")try{S=new o(S,this.options)}catch{return!1}for(let P=0;P<this.set.length;P++)if(Z(this.set[P],S,this.options))return!0;return!1}}Nl=e;const n=MO,r=new n,s=pf,a=Bc(),i=Dc,o=Wt,{safeRe:u,t:c,comparatorTrimReplace:l,tildeTrimReplace:d,caretTrimReplace:m}=uo,{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:h}=Lc,g=N=>N.value==="<0.0.0-0",b=N=>N.value==="",_=(N,S)=>{let P=!0;const U=N.slice();let D=U.pop();for(;P&&U.length;)P=U.every(W=>D.intersects(W,S)),D=U.pop();return P},y=(N,S)=>(i("comp",N,S),N=R(N,S),i("caret",N),N=I(N,S),i("tildes",N),N=j(N,S),i("xrange",N),N=x(N,S),i("stars",N),N),E=N=>!N||N.toLowerCase()==="x"||N==="*",I=(N,S)=>N.trim().split(/\s+/).map(P=>w(P,S)).join(" "),w=(N,S)=>{const P=S.loose?u[c.TILDELOOSE]:u[c.TILDE];return N.replace(P,(U,D,W,K,G)=>{i("tilde",N,U,D,W,K,G);let se;return E(D)?se="":E(W)?se=`>=${D}.0.0 <${+D+1}.0.0-0`:E(K)?se=`>=${D}.${W}.0 <${D}.${+W+1}.0-0`:G?(i("replaceTilde pr",G),se=`>=${D}.${W}.${K}-${G} <${D}.${+W+1}.0-0`):se=`>=${D}.${W}.${K} <${D}.${+W+1}.0-0`,i("tilde return",se),se})},R=(N,S)=>N.trim().split(/\s+/).map(P=>v(P,S)).join(" "),v=(N,S)=>{i("caret",N,S);const P=S.loose?u[c.CARETLOOSE]:u[c.CARET],U=S.includePrerelease?"-0":"";return N.replace(P,(D,W,K,G,se)=>{i("caret",N,D,W,K,G,se);let we;return E(W)?we="":E(K)?we=`>=${W}.0.0${U} <${+W+1}.0.0-0`:E(G)?W==="0"?we=`>=${W}.${K}.0${U} <${W}.${+K+1}.0-0`:we=`>=${W}.${K}.0${U} <${+W+1}.0.0-0`:se?(i("replaceCaret pr",se),W==="0"?K==="0"?we=`>=${W}.${K}.${G}-${se} <${W}.${K}.${+G+1}-0`:we=`>=${W}.${K}.${G}-${se} <${W}.${+K+1}.0-0`:we=`>=${W}.${K}.${G}-${se} <${+W+1}.0.0-0`):(i("no pr"),W==="0"?K==="0"?we=`>=${W}.${K}.${G}${U} <${W}.${K}.${+G+1}-0`:we=`>=${W}.${K}.${G}${U} <${W}.${+K+1}.0-0`:we=`>=${W}.${K}.${G} <${+W+1}.0.0-0`),i("caret return",we),we})},j=(N,S)=>(i("replaceXRanges",N,S),N.split(/\s+/).map(P=>F(P,S)).join(" ")),F=(N,S)=>{N=N.trim();const P=S.loose?u[c.XRANGELOOSE]:u[c.XRANGE];return N.replace(P,(U,D,W,K,G,se)=>{i("xRange",N,U,D,W,K,G,se);const we=E(W),Le=we||E(K),ke=Le||E(G),At=ke;return D==="="&&At&&(D=""),se=S.includePrerelease?"-0":"",we?D===">"||D==="<"?U="<0.0.0-0":U="*":D&&At?(Le&&(K=0),G=0,D===">"?(D=">=",Le?(W=+W+1,K=0,G=0):(K=+K+1,G=0)):D==="<="&&(D="<",Le?W=+W+1:K=+K+1),D==="<"&&(se="-0"),U=`${D+W}.${K}.${G}${se}`):Le?U=`>=${W}.0.0${se} <${+W+1}.0.0-0`:ke&&(U=`>=${W}.${K}.0${se} <${W}.${+K+1}.0-0`),i("xRange return",U),U})},x=(N,S)=>(i("replaceStars",N,S),N.trim().replace(u[c.STAR],"")),H=(N,S)=>(i("replaceGTE0",N,S),N.trim().replace(u[S.includePrerelease?c.GTE0PRE:c.GTE0],"")),te=N=>(S,P,U,D,W,K,G,se,we,Le,ke,At)=>(E(U)?P="":E(D)?P=`>=${U}.0.0${N?"-0":""}`:E(W)?P=`>=${U}.${D}.0${N?"-0":""}`:K?P=`>=${P}`:P=`>=${P}${N?"-0":""}`,E(we)?se="":E(Le)?se=`<${+we+1}.0.0-0`:E(ke)?se=`<${we}.${+Le+1}.0-0`:At?se=`<=${we}.${Le}.${ke}-${At}`:N?se=`<${we}.${Le}.${+ke+1}-0`:se=`<=${se}`,`${P} ${se}`.trim()),Z=(N,S,P)=>{for(let U=0;U<N.length;U++)if(!N[U].test(S))return!1;if(S.prerelease.length&&!P.includePrerelease){for(let U=0;U<N.length;U++)if(i(N[U].semver),N[U].semver!==a.ANY&&N[U].semver.prerelease.length>0){const D=N[U].semver;if(D.major===S.major&&D.minor===S.minor&&D.patch===S.patch)return!0}return!1}return!0};return Nl}var Rl,Pp;function Bc(){if(Pp)return Rl;Pp=1;const t=Symbol("SemVer ANY");class e{static get ANY(){return t}constructor(l,d){if(d=n(d),l instanceof e){if(l.loose===!!d.loose)return l;l=l.value}l=l.trim().split(/\s+/).join(" "),i("comparator",l,d),this.options=d,this.loose=!!d.loose,this.parse(l),this.semver===t?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(l){const d=this.options.loose?r[s.COMPARATORLOOSE]:r[s.COMPARATOR],m=l.match(d);if(!m)throw new TypeError(`Invalid comparator: ${l}`);this.operator=m[1]!==void 0?m[1]:"",this.operator==="="&&(this.operator=""),m[2]?this.semver=new o(m[2],this.options.loose):this.semver=t}toString(){return this.value}test(l){if(i("Comparator.test",l,this.options.loose),this.semver===t||l===t)return!0;if(typeof l=="string")try{l=new o(l,this.options)}catch{return!1}return a(l,this.operator,this.semver,this.options)}intersects(l,d){if(!(l instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(l.value,d).test(this.value):l.operator===""?l.value===""?!0:new u(this.value,d).test(l.semver):(d=n(d),d.includePrerelease&&(this.value==="<0.0.0-0"||l.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||l.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&l.operator.startsWith(">")||this.operator.startsWith("<")&&l.operator.startsWith("<")||this.semver.version===l.semver.version&&this.operator.includes("=")&&l.operator.includes("=")||a(this.semver,"<",l.semver,d)&&this.operator.startsWith(">")&&l.operator.startsWith("<")||a(this.semver,">",l.semver,d)&&this.operator.startsWith("<")&&l.operator.startsWith(">")))}}Rl=e;const n=pf,{safeRe:r,t:s}=uo,a=Q_,i=Dc,o=Wt,u=Kn();return Rl}const BO=Kn(),FO=(t,e,n)=>{try{e=new BO(e,n)}catch{return!1}return e.test(t)};var Fc=FO;const UO=Kn(),jO=(t,e)=>new UO(t,e).set.map(n=>n.map(r=>r.value).join(" ").trim().split(" "));var HO=jO;const $O=Wt,qO=Kn(),VO=(t,e,n)=>{let r=null,s=null,a=null;try{a=new qO(e,n)}catch{return null}return t.forEach(i=>{a.test(i)&&(!r||s.compare(i)===-1)&&(r=i,s=new $O(r,n))}),r};var zO=VO;const WO=Wt,GO=Kn(),KO=(t,e,n)=>{let r=null,s=null,a=null;try{a=new GO(e,n)}catch{return null}return t.forEach(i=>{a.test(i)&&(!r||s.compare(i)===1)&&(r=i,s=new WO(r,n))}),r};var YO=KO;const Pl=Wt,ZO=Kn(),xp=Mc,JO=(t,e)=>{t=new ZO(t,e);let n=new Pl("0.0.0");if(t.test(n)||(n=new Pl("0.0.0-0"),t.test(n)))return n;n=null;for(let r=0;r<t.set.length;++r){const s=t.set[r];let a=null;s.forEach(i=>{const o=new Pl(i.semver.version);switch(i.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!a||xp(o,a))&&(a=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${i.operator}`)}}),a&&(!n||xp(n,a))&&(n=a)}return n&&t.test(n)?n:null};var XO=JO;const QO=Kn(),ek=(t,e)=>{try{return new QO(t,e).range||"*"}catch{return null}};var tk=ek;const nk=Wt,ey=Bc(),{ANY:rk}=ey,sk=Kn(),ak=Fc,Lp=Mc,Dp=bf,ik=yf,ok=_f,uk=(t,e,n,r)=>{t=new nk(t,r),e=new sk(e,r);let s,a,i,o,u;switch(n){case">":s=Lp,a=ik,i=Dp,o=">",u=">=";break;case"<":s=Dp,a=ok,i=Lp,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ak(t,e,r))return!1;for(let c=0;c<e.set.length;++c){const l=e.set[c];let d=null,m=null;if(l.forEach(p=>{p.semver===rk&&(p=new ey(">=0.0.0")),d=d||p,m=m||p,s(p.semver,d.semver,r)?d=p:i(p.semver,m.semver,r)&&(m=p)}),d.operator===o||d.operator===u||(!m.operator||m.operator===o)&&a(t,m.semver))return!1;if(m.operator===u&&i(t,m.semver))return!1}return!0};var Ef=uk;const ck=Ef,lk=(t,e,n)=>ck(t,e,">",n);var dk=lk;const hk=Ef,fk=(t,e,n)=>hk(t,e,"<",n);var mk=fk;const Mp=Kn(),pk=(t,e,n)=>(t=new Mp(t,n),e=new Mp(e,n),t.intersects(e,n));var gk=pk;const bk=Fc,_k=Gn;var yk=(t,e,n)=>{const r=[];let s=null,a=null;const i=t.sort((l,d)=>_k(l,d,n));for(const l of i)bk(l,e,n)?(a=l,s||(s=l)):(a&&r.push([s,a]),a=null,s=null);s&&r.push([s,null]);const o=[];for(const[l,d]of r)l===d?o.push(l):!d&&l===i[0]?o.push("*"):d?l===i[0]?o.push(`<=${d}`):o.push(`${l} - ${d}`):o.push(`>=${l}`);const u=o.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e};const Bp=Kn(),wf=Bc(),{ANY:xl}=wf,Fa=Fc,Tf=Gn,Ek=(t,e,n={})=>{if(t===e)return!0;t=new Bp(t,n),e=new Bp(e,n);let r=!1;e:for(const s of t.set){for(const a of e.set){const i=Tk(s,a,n);if(r=r||i!==null,i)continue e}if(r)return!1}return!0},wk=[new wf(">=0.0.0-0")],Fp=[new wf(">=0.0.0")],Tk=(t,e,n)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===xl){if(e.length===1&&e[0].semver===xl)return!0;n.includePrerelease?t=wk:t=Fp}if(e.length===1&&e[0].semver===xl){if(n.includePrerelease)return!0;e=Fp}const r=new Set;let s,a;for(const p of t)p.operator===">"||p.operator===">="?s=Up(s,p,n):p.operator==="<"||p.operator==="<="?a=jp(a,p,n):r.add(p.semver);if(r.size>1)return null;let i;if(s&&a){if(i=Tf(s.semver,a.semver,n),i>0)return null;if(i===0&&(s.operator!==">="||a.operator!=="<="))return null}for(const p of r){if(s&&!Fa(p,String(s),n)||a&&!Fa(p,String(a),n))return null;for(const h of e)if(!Fa(p,String(h),n))return!1;return!0}let o,u,c,l,d=a&&!n.includePrerelease&&a.semver.prerelease.length?a.semver:!1,m=s&&!n.includePrerelease&&s.semver.prerelease.length?s.semver:!1;d&&d.prerelease.length===1&&a.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(const p of e){if(l=l||p.operator===">"||p.operator===">=",c=c||p.operator==="<"||p.operator==="<=",s){if(m&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===m.major&&p.semver.minor===m.minor&&p.semver.patch===m.patch&&(m=!1),p.operator===">"||p.operator===">="){if(o=Up(s,p,n),o===p&&o!==s)return!1}else if(s.operator===">="&&!Fa(s.semver,String(p),n))return!1}if(a){if(d&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===d.major&&p.semver.minor===d.minor&&p.semver.patch===d.patch&&(d=!1),p.operator==="<"||p.operator==="<="){if(u=jp(a,p,n),u===p&&u!==a)return!1}else if(a.operator==="<="&&!Fa(a.semver,String(p),n))return!1}if(!p.operator&&(a||s)&&i!==0)return!1}return!(s&&c&&!a&&i!==0||a&&l&&!s&&i!==0||m||d)},Up=(t,e,n)=>{if(!t)return e;const r=Tf(t.semver,e.semver,n);return r>0?t:r<0||e.operator===">"&&t.operator===">="?e:t},jp=(t,e,n)=>{if(!t)return e;const r=Tf(t.semver,e.semver,n);return r<0?t:r>0||e.operator==="<"&&t.operator==="<="?e:t};var Sk=Ek;const Ll=uo,Hp=Lc,Ak=Wt,$p=Z_,Ck=wa,vk=Pv,Ok=Dv,kk=Bv,Ik=Uv,Nk=$v,Rk=zv,Pk=Kv,xk=Jv,Lk=Gn,Dk=tO,Mk=sO,Bk=gf,Fk=uO,Uk=dO,jk=Mc,Hk=bf,$k=J_,qk=X_,Vk=_f,zk=yf,Wk=Q_,Gk=LO,Kk=Bc(),Yk=Kn(),Zk=Fc,Jk=HO,Xk=zO,Qk=YO,eI=XO,tI=tk,nI=Ef,rI=dk,sI=mk,aI=gk,iI=yk,oI=Sk;Ll.re,Ll.src,Ll.t,Hp.SEMVER_SPEC_VERSION,Hp.RELEASE_TYPES,$p.compareIdentifiers,$p.rcompareIdentifiers;function Lr(t){if(!t||t.split("/").length>2||t.startsWith("/")||t.endsWith("/")||t.split(":").length>2)throw new Error(`Invalid identifier format: ${t}`);const[e,n]=t.split(":"),r=n||"latest";if(e.includes("/")){const[s,a]=e.split("/",2);if(!s||!a)throw new Error(`Invalid identifier format: ${t}`);return[s,a,r]}else{if(!e)throw new Error(`Invalid identifier format: ${t}`);return["-",e,r]}}class uI extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function Se(t,e,n){let r;if(t.ok){n&&(r=await t.text());return}r=await t.text();const s=`Failed to ${e}. Received status [${t.status}]: ${t.statusText}. Server response: ${r}`;throw t.status===409?new uI(s):new Error(s)}var qp="[...]",cI={result:"[Circular]"},Wu=[],Xs=[];function lI(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function un(t,e,n,r){var i;try{return JSON.stringify(t,e,n)}catch(o){if(!((i=o.message)!=null&&i.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),"[Unserializable]";console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof r>"u"&&(r=lI()),nh(t,"",0,[],void 0,0,r);var s;try{Xs.length===0?s=JSON.stringify(t,e,n):s=JSON.stringify(t,dI(e),n)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Wu.length!==0;){var a=Wu.pop();a.length===4?Object.defineProperty(a[0],a[1],a[3]):a[0][a[1]]=a[2]}}return s}}function Dl(t,e,n,r){var s=Object.getOwnPropertyDescriptor(r,n);s.get!==void 0?s.configurable?(Object.defineProperty(r,n,{value:t}),Wu.push([r,n,e,s])):Xs.push([e,n,t]):(r[n]=t,Wu.push([r,n,e]))}function nh(t,e,n,r,s,a,i){a+=1;var o;if(typeof t=="object"&&t!==null){for(o=0;o<r.length;o++)if(r[o]===t){Dl(cI,t,e,s);return}if(typeof i.depthLimit<"u"&&a>i.depthLimit){Dl(qp,t,e,s);return}if(typeof i.edgesLimit<"u"&&n+1>i.edgesLimit){Dl(qp,t,e,s);return}if(r.push(t),Array.isArray(t))for(o=0;o<t.length;o++)nh(t[o],o,o,r,t,a,i);else{var u=Object.keys(t);for(o=0;o<u.length;o++){var c=u[o];nh(t[c],c,o,r,t,a,i)}}r.pop()}}function dI(t){return t=typeof t<"u"?t:function(e,n){return n},function(e,n){if(Xs.length>0)for(var r=0;r<Xs.length;r++){var s=Xs[r];if(s[1]===e&&s[0]===n){n=s[2],Xs.splice(r,1);break}}return t.call(this,e,n)}}function Vp(t){const e=ry(),n=AI(),r=t.extra??{},s=r.metadata;return t.extra={...r,runtime:{...e,...r==null?void 0:r.runtime},metadata:{...n,...n.revision_id||t.revision_id?{revision_id:t.revision_id??n.revision_id}:{},...s}},t}const hI=()=>{const t=$r("TRACING_SAMPLING_RATE");if(t===void 0)return;const e=parseFloat(t);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},fI=t=>{const n=t.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return n==="localhost"||n==="127.0.0.1"||n==="::1"};async function mI(t){const e=[];for await(const n of t)e.push(n);return e}function Ml(t){if(t!==void 0)return t.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const pI=async t=>{if((t==null?void 0:t.status)===429){const e=parseInt(t.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(n=>setTimeout(n,e)),!0}return!1};class gI{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let n;const r=new Promise(a=>{n=a}),s=un(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:n,itemPromise:r,size:s}),this.sizeBytes+=s,r}pop(e){var s;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const n=[];let r=0;for(;r+(((s=this.peek())==null?void 0:s.size)??0)<e&&this.items.length>0;){const a=this.items.shift();a&&(n.push(a),r+=a.size,this.sizeBytes-=a.size)}if(n.length===0&&this.items.length>0){const a=this.items.shift();n.push(a),r+=a.size,this.sizeBytes-=a.size}return[n.map(a=>({action:a.action,item:a.payload})),()=>n.forEach(a=>a.itemPromiseResolve())]}}const bI=20971520,_I=2500;class ji{constructor(e={}){var r;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new gI}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:gs("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1});const n=ji.getDefaultClientConfig();if(this.tracingSampleRate=hI(),this.apiUrl=Ml(e.apiUrl??n.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Ml(e.apiKey??n.apiKey),this.webUrl=Ml(e.webUrl??n.webUrl),(r=this.webUrl)!=null&&r.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new Ep(e.callerOptions??{}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.batchIngestCaller=new Ep({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:pI}),this.hideInputs=e.hideInputs??e.anonymizer??n.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??n.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=$r("API_KEY"),n=$r("ENDPOINT")??"https://api.smith.langchain.com",r=$r("HIDE_INPUTS")==="true",s=$r("HIDE_OUTPUTS")==="true";return{apiUrl:n,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:fI(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${ty}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const n={...e};return n.inputs!==void 0&&(n.inputs=this.processInputs(n.inputs)),n.outputs!==void 0&&(n.outputs=this.processOutputs(n.outputs)),n}async _getResponse(e,n){const r=(n==null?void 0:n.toString())??"",s=`${this.apiUrl}${e}?${r}`,a=await this.caller.call(he(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(a,`Failed to fetch ${e}`),a}async _get(e,n){return(await this._getResponse(e,n)).json()}async*_getPaginated(e,n=new URLSearchParams,r){let s=Number(n.get("offset"))||0;const a=Number(n.get("limit"))||100;for(;;){n.set("offset",String(s)),n.set("limit",String(a));const i=`${this.apiUrl}${e}?${n}`,o=await this.caller.call(he(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(o,`Failed to fetch ${e}`);const u=r?r(await o.json()):await o.json();if(u.length===0||(yield u,u.length<a))break;s+=u.length}}async*_getCursorPaginatedList(e,n=null,r="POST",s="runs"){const a=n?{...n}:{};for(;;){const o=await(await this.caller.call(he(),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)})).json();if(!o||!o[s])break;yield o[s];const u=o.cursors;if(!u||!u.next)break;a.cursor=u.next}}_filterForSampling(e,n=!1){if(this.tracingSampleRate===void 0)return e;if(n){const r=[];for(const s of e)this.filteredPostUuids.has(s.id)?this.filteredPostUuids.delete(s.id):r.push(s);return r}else{const r=[];for(const s of e)s.id!==s.trace_id&&!this.filteredPostUuids.has(s.trace_id)||Math.random()<this.tracingSampleRate?r.push(s):this.filteredPostUuids.add(s.id);return r}}async _getBatchSizeLimitBytes(){var n;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((n=e.batch_ingest_config)==null?void 0:n.size_limit_bytes)??bI}async _getMultiPartSupport(){var n;return((n=(await this._ensureServerInfo()).instance_flags)==null?void 0:n.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const n=[];for(;this.autoBatchQueue.items.length>0;){const[r,s]=this.autoBatchQueue.pop(e);if(!r.length){s();break}const a=this._processBatch(r,s).catch(console.error);n.push(a)}return Promise.all(n)}async _processBatch(e,n){var r;if(!e.length){n();return}try{const s={runCreates:e.filter(i=>i.action==="create").map(i=>i.item),runUpdates:e.filter(i=>i.action==="update").map(i=>i.item)},a=await this._ensureServerInfo();(r=a==null?void 0:a.batch_ingest_config)!=null&&r.use_multipart_endpoint?await this.multipartIngestRuns(s):await this.batchIngestRuns(s)}finally{n()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=Vp(e.item));const n=this.autoBatchQueue.push(e);if(this.manualFlushMode)return n;const r=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>r&&this.drainAutoBatchQueue(r),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(r)},this.autoBatchAggregationDelayMs)),n}async _getServerInfo(){const e=await he()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(_I),...this.fetchOptions});return await Se(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const n={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const s=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}const a=Vp(s),i=await this.caller.call(he(),`${this.apiUrl}/runs`,{method:"POST",headers:n,body:un(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(i,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:n}){if(e===void 0&&n===void 0)return;let r=(e==null?void 0:e.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[],s=(n==null?void 0:n.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[];if(r.length>0&&s.length>0){const o=r.reduce((c,l)=>(l.id&&(c[l.id]=l),c),{}),u=[];for(const c of s)c.id!==void 0&&o[c.id]?o[c.id]={...o[c.id],...c}:u.push(c);r=Object.values(o),s=u}const a={post:this._filterForSampling(r),patch:this._filterForSampling(s,!0)};if(!a.post.length&&!a.patch.length)return;const i={post:[],patch:[]};for(const o of["post","patch"]){const u=o,c=a[u].reverse();let l=c.pop();for(;l!==void 0;)i[u].push(l),l=c.pop()}(i.post.length>0||i.patch.length>0)&&await this._postBatchIngestRuns(un(i))}async _postBatchIngestRuns(e){const n={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(he(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:n,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:n}){if(e===void 0&&n===void 0)return;const r={};let s=[];for(const l of e??[]){const d=this.prepareRunCreateOrUpdateInputs(l);d.id!==void 0&&d.attachments!==void 0&&(r[d.id]=d.attachments),delete d.attachments,s.push(d)}let a=[];for(const l of n??[])a.push(this.prepareRunCreateOrUpdateInputs(l));if(s.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&a.length>0){const l=s.reduce((m,p)=>(p.id&&(m[p.id]=p),m),{}),d=[];for(const m of a)m.id!==void 0&&l[m.id]?l[m.id]={...l[m.id],...m}:d.push(m);s=Object.values(l),a=d}if(s.length===0&&a.length===0)return;const u=[],c=[];for(const[l,d]of[["post",s],["patch",a]])for(const m of d){const{inputs:p,outputs:h,events:g,attachments:b,..._}=m,y={inputs:p,outputs:h,events:g},E=un(_);c.push({name:`${l}.${_.id}`,payload:new Blob([E],{type:`application/json; length=${E.length}`})});for(const[I,w]of Object.entries(y)){if(w===void 0)continue;const R=un(w);c.push({name:`${l}.${_.id}.${I}`,payload:new Blob([R],{type:`application/json; length=${R.length}`})})}if(_.id!==void 0){const I=r[_.id];if(I){delete r[_.id];for(const[w,R]of Object.entries(I)){let v,j;if(Array.isArray(R)?[v,j]=R:(v=R.mimeType,j=R.data),w.includes(".")){console.warn(`Skipping attachment '${w}' for run ${_.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}c.push({name:`attachment.${_.id}.${w}`,payload:new Blob([j],{type:`${v}; length=${j.byteLength}`})})}}}u.push(`trace=${_.trace_id},id=${_.id}`)}await this._sendMultipartRequest(c,u.join("; "))}async _sendMultipartRequest(e,n){try{const r="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),s=[];for(const u of e)s.push(new Blob([`--${r}\r
`])),s.push(new Blob([`Content-Disposition: form-data; name="${u.name}"\r
`,`Content-Type: ${u.payload.type}\r
\r
`])),s.push(u.payload),s.push(new Blob([`\r
`]));s.push(new Blob([`--${r}--\r
`]));const i=await new Blob(s).arrayBuffer(),o=await this.batchIngestCaller.call(he(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${r}`},body:i,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(o,"ingest multipart runs",!0)}catch(r){console.warn(`${r.message.trim()}

Context: ${n}`)}}async updateRun(e,n){Oe(e),n.inputs&&(n.inputs=this.processInputs(n.inputs)),n.outputs&&(n.outputs=this.processOutputs(n.outputs));const r={...n,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(n.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:r}).catch(console.error);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}const s={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(he(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:un(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(a,"update run",!0)}async readRun(e,{loadChildRuns:n}={loadChildRuns:!1}){Oe(e);let r=await this._get(`/runs/${e}`);return n&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:n,projectOpts:r}){if(n!==void 0){let s;n.session_id?s=n.session_id:r!=null&&r.projectName?s=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?s=r==null?void 0:r.projectId:s=(await this.readProject({projectName:$r("PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s}/r/${n.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const n=await mI(this.listRuns({id:e.child_run_ids})),r={},s={};n.sort((a,i)=>((a==null?void 0:a.dotted_order)??"").localeCompare((i==null?void 0:i.dotted_order)??""));for(const a of n){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);a.parent_run_id in r||(r[a.parent_run_id]=[]),r[a.parent_run_id].push(a),s[a.id]=a}e.child_runs=r[e.id]||[];for(const a in r)a!==e.id&&(s[a].child_runs=r[a]);return e}async*listRuns(e){const{projectId:n,projectName:r,parentRunId:s,traceId:a,referenceExampleId:i,startTime:o,executionOrder:u,isRoot:c,runType:l,error:d,id:m,query:p,filter:h,traceFilter:g,treeFilter:b,limit:_,select:y}=e;let E=[];if(n&&(E=Array.isArray(n)?n:[n]),r){const v=Array.isArray(r)?r:[r],j=await Promise.all(v.map(F=>this.readProject({projectName:F}).then(x=>x.id)));E.push(...j)}const I=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],w={session:E.length?E:null,run_type:l,reference_example:i,query:p,filter:h,trace_filter:g,tree_filter:b,execution_order:u,parent_run:s,start_time:o?o.toISOString():null,error:d,id:m,limit:_,trace:a,select:y||I,is_root:c};let R=0;for await(const v of this._getCursorPaginatedList("/runs/query",w))if(_){if(R>=_)break;if(v.length+R>_){yield*v.slice(0,_-R);break}R+=v.length,yield*v}else yield*v}async getRunStats({id:e,trace:n,parentRun:r,runType:s,projectNames:a,projectIds:i,referenceExampleIds:o,startTime:u,endTime:c,error:l,query:d,filter:m,traceFilter:p,treeFilter:h,isRoot:g,dataSourceType:b}){let _=i||[];a&&(_=[...i||[],...await Promise.all(a.map(R=>this.readProject({projectName:R}).then(v=>v.id)))]);const E=Object.fromEntries(Object.entries({id:e,trace:n,parent_run:r,run_type:s,session:_,reference_example:o,start_time:u,end_time:c,error:l,query:d,filter:m,trace_filter:p,tree_filter:h,is_root:g,data_source_type:b}).filter(([R,v])=>v!==void 0));return await(await this.caller.call(he(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(E),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:n}={}){const r={run_id:e,share_token:n||Qt()};Oe(e);const a=await(await this.caller.call(he(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){Oe(e);const n=await this.caller.call(he(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(n,"unshare run",!0)}async readRunSharedLink(e){Oe(e);const r=await(await this.caller.call(he(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:n}={}){const r=new URLSearchParams({share_token:e});if(n!==void 0)for(const i of n)r.append("id",i);return Oe(e),await(await this.caller.call(he(),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,n){if(!e&&!n)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:n})).id),Oe(e);const s=await(await this.caller.call(he(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,n){if(!e&&!n)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:n})).id);const r={dataset_id:e};Oe(e);const a=await(await this.caller.call(he(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){Oe(e);const n=await this.caller.call(he(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(n,"unshare dataset",!0)}async readSharedDataset(e){return Oe(e),await(await this.caller.call(he(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,n){const r={};n!=null&&n.exampleIds&&(r.id=n.exampleIds);const s=new URLSearchParams;Object.entries(r).forEach(([o,u])=>{Array.isArray(u)?u.forEach(c=>s.append(o,c)):s.append(o,u)});const a=await this.caller.call(he(),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await a.json();if(!a.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${i.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return i.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:n=null,metadata:r=null,upsert:s=!1,projectExtra:a=null,referenceDatasetId:i=null}){const o=s?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,c=a||{};r&&(c.metadata=r);const l={name:e,extra:c,description:n};i!==null&&(l.reference_dataset_id=i);const d=await this.caller.call(he(),u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(d,"create project"),await d.json()}async updateProject(e,{name:n=null,description:r=null,metadata:s=null,projectExtra:a=null,endTime:i=null}){const o=`${this.apiUrl}/sessions/${e}`;let u=a;s&&(u={...u||{},metadata:s});const c={name:n,extra:u,description:r,end_time:i?new Date(i).toISOString():null},l=await this.caller.call(he(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(l,"update project"),await l.json()}async hasProject({projectId:e,projectName:n}){let r="/sessions";const s=new URLSearchParams;if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Oe(e),r+=`/${e}`;else if(n!==void 0)s.append("name",n);else throw new Error("Must provide projectName or projectId");const a=await this.caller.call(he(),`${this.apiUrl}${r}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const i=await a.json();return a.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:n,includeStats:r}){let s="/sessions";const a=new URLSearchParams;if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Oe(e),s+=`/${e}`;else if(n!==void 0)a.append("name",n);else throw new Error("Must provide projectName or projectId");r!==void 0&&a.append("include_stats",r.toString());const i=await this._get(s,a);let o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${n}] not found`);o=i[0]}else o=i;return o}async getProjectUrl({projectId:e,projectName:n}){if(e===void 0&&n===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:n}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:n}){if(e===void 0&&n===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:n}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const n of this._getPaginated("/sessions",e))return this._tenantId=n[0].tenant_id,n[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:n,nameContains:r,referenceDatasetId:s,referenceDatasetName:a,referenceFree:i,metadata:o}={}){const u=new URLSearchParams;if(e!==void 0)for(const c of e)u.append("id",c);if(n!==void 0&&u.append("name",n),r!==void 0&&u.append("name_contains",r),s!==void 0)u.append("reference_dataset",s);else if(a!==void 0){const c=await this.readDataset({datasetName:a});u.append("reference_dataset",c.id)}i!==void 0&&u.append("reference_free",i.toString()),o!==void 0&&u.append("metadata",JSON.stringify(o));for await(const c of this._getPaginated("/sessions",u))yield*c}async deleteProject({projectId:e,projectName:n}){let r;if(e===void 0&&n===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:n})).id:r=e,Oe(r);const s=await this.caller.call(he(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(s,`delete session ${r} (${n})`,!0)}async uploadCsv({csvFile:e,fileName:n,inputKeys:r,outputKeys:s,description:a,dataType:i,name:o}){const u=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,n),r.forEach(m=>{c.append("input_keys",m)}),s.forEach(m=>{c.append("output_keys",m)}),a&&c.append("description",a),i&&c.append("data_type",i),o&&c.append("name",o);const l=await this.caller.call(he(),u,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(l,"upload CSV"),await l.json()}async createDataset(e,{description:n,dataType:r,inputsSchema:s,outputsSchema:a,metadata:i}={}){const o={name:e,description:n,extra:i?{metadata:i}:void 0};r&&(o.data_type=r),s&&(o.inputs_schema_definition=s),a&&(o.outputs_schema_definition=a);const u=await this.caller.call(he(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(u,"create dataset"),await u.json()}async readDataset({datasetId:e,datasetName:n}){let r="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)Oe(e),r+=`/${e}`;else if(n!==void 0)s.append("name",n);else throw new Error("Must provide datasetName or datasetId");const a=await this._get(r,s);let i;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${n}] not found`);i=a[0]}else i=a;return i}async hasDataset({datasetId:e,datasetName:n}){try{return await this.readDataset({datasetId:e,datasetName:n}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:n,fromVersion:r,toVersion:s}){let a=e;if(a===void 0&&n===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:n})).id);const i=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:n}){const r="/datasets";if(e===void 0)if(n!==void 0)e=(await this.readDataset({datasetName:n})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:n=0,datasetIds:r,datasetName:s,datasetNameContains:a,metadata:i}={}){const o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:n.toString()});if(r!==void 0)for(const c of r)u.append("id",c);s!==void 0&&u.append("name",s),a!==void 0&&u.append("name_contains",a),i!==void 0&&u.append("metadata",JSON.stringify(i));for await(const c of this._getPaginated(o,u))yield*c}async updateDataset(e){const{datasetId:n,datasetName:r,...s}=e;if(!n&&!r)throw new Error("Must provide either datasetName or datasetId");const a=n??(await this.readDataset({datasetName:r})).id;Oe(a);const i=await this.caller.call(he(),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(i,"update dataset"),await i.json()}async updateDatasetTag(e){const{datasetId:n,datasetName:r,asOf:s,tag:a}=e;if(!n&&!r)throw new Error("Must provide either datasetName or datasetId");const i=n??(await this.readDataset({datasetName:r})).id;Oe(i);const o=await this.caller.call(he(),`${this.apiUrl}/datasets/${i}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:n}){let r="/datasets",s=e;if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(n!==void 0&&(s=(await this.readDataset({datasetName:n})).id),s!==void 0)Oe(s),r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const a=await this.caller.call(he(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(a,`delete ${r}`),await a.json()}async indexDataset({datasetId:e,datasetName:n,tag:r}){let s=e;if(!s&&!n)throw new Error("Must provide either datasetName or datasetId");if(s&&n)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:n})).id),Oe(s);const a={tag:r},i=await this.caller.call(he(),`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(i,"index dataset"),await i.json()}async similarExamples(e,n,r,{filter:s}={}){const a={limit:r,inputs:e};s!==void 0&&(a.filter=s),Oe(n);const i=await this.caller.call(he(),`${this.apiUrl}/datasets/${n}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,n,{datasetId:r,datasetName:s,createdAt:a,exampleId:i,metadata:o,split:u,sourceRunId:c}){let l=r;if(l===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(l!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");l===void 0&&(l=(await this.readDataset({datasetName:s})).id);const d=a||new Date,m={dataset_id:l,inputs:e,outputs:n,created_at:d==null?void 0:d.toISOString(),id:i,metadata:o,split:u,source_run_id:c},p=await this.caller.call(he(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(p,"create example"),await p.json()}async createExamples(e){const{inputs:n,outputs:r,metadata:s,sourceRunIds:a,exampleIds:i,datasetId:o,datasetName:u}=e;let c=o;if(c===void 0&&u===void 0)throw new Error("Must provide either datasetName or datasetId");if(c!==void 0&&u!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");c===void 0&&(c=(await this.readDataset({datasetName:u})).id);const l=n.map((p,h)=>({dataset_id:c,inputs:p,outputs:r?r[h]:void 0,metadata:s?s[h]:void 0,split:e.splits?e.splits[h]:void 0,id:i?i[h]:void 0,source_run_id:a?a[h]:void 0})),d=await this.caller.call(he(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(d,"create examples"),await d.json()}async createLLMExample(e,n,r){return this.createExample({input:e},{output:n},r)}async createChatExample(e,n,r){const s=e.map(i=>wp(i)?Tp(i):i),a=wp(n)?Tp(n):n;return this.createExample({input:s},{output:a},r)}async readExample(e){Oe(e);const n=`/examples/${e}`,r=await this._get(n),{attachment_urls:s,...a}=r,i=a;return s&&(i.attachments=Object.entries(s).reduce((o,[u,c])=>(o[u.slice(11)]={presigned_url:c.presigned_url,mime_type:c.mime_type},o),{})),i}async*listExamples({datasetId:e,datasetName:n,exampleIds:r,asOf:s,splits:a,inlineS3Urls:i,metadata:o,limit:u,offset:c,filter:l,includeAttachments:d}={}){let m;if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)m=e;else if(n!==void 0)m=(await this.readDataset({datasetName:n})).id;else throw new Error("Must provide a datasetName or datasetId");const p=new URLSearchParams({dataset:m}),h=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;h&&p.append("as_of",h);const g=i??!0;if(p.append("inline_s3_urls",g.toString()),r!==void 0)for(const _ of r)p.append("id",_);if(a!==void 0)for(const _ of a)p.append("splits",_);if(o!==void 0){const _=JSON.stringify(o);p.append("metadata",_)}u!==void 0&&p.append("limit",u.toString()),c!==void 0&&p.append("offset",c.toString()),l!==void 0&&p.append("filter",l),d===!0&&["attachment_urls","outputs","metadata"].forEach(_=>p.append("select",_));let b=0;for await(const _ of this._getPaginated("/examples",p)){for(const y of _){const{attachment_urls:E,...I}=y,w=I;E&&(w.attachments=Object.entries(E).reduce((R,[v,j])=>(R[v.slice(11)]={presigned_url:j.presigned_url,mime_type:j.mime_type||void 0},R),{})),yield w,b++}if(u!==void 0&&b>=u)break}}async deleteExample(e){Oe(e);const n=`/examples/${e}`,r=await this.caller.call(he(),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(r,`delete ${n}`),await r.json()}async updateExample(e,n){Oe(e);const r=await this.caller.call(he(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(r,"update example"),await r.json()}async updateExamples(e){const n=await this.caller.call(he(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(n,"update examples"),await n.json()}async readDatasetVersion({datasetId:e,datasetName:n,asOf:r,tag:s}){let a;if(e?a=e:a=(await this.readDataset({datasetName:n})).id,Oe(a),r&&s||!r&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const i=new URLSearchParams;r!==void 0&&i.append("as_of",typeof r=="string"?r:r.toISOString()),s!==void 0&&i.append("tag",s);const o=await this.caller.call(he(),`${this.apiUrl}/datasets/${a}/version?${i.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:n,asOf:r}){let s;if(e===void 0&&n===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:n})).id:s=e,Oe(s);const a=new URLSearchParams,i=r?typeof r=="string"?r:r==null?void 0:r.toISOString():void 0;return i&&a.append("as_of",i),await this._get(`/datasets/${s}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:n,splitName:r,exampleIds:s,remove:a=!1}){let i;if(e===void 0&&n===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:n})).id:i=e,Oe(i);const o={split_name:r,examples:s.map(c=>(Oe(c),c)),remove:a},u=await this.caller.call(he(),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(u,"update dataset splits",!0)}async evaluateRun(e,n,{sourceInfo:r,loadChildRuns:s,referenceExample:a}={loadChildRuns:!1}){G_("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(a=await this.readExample(i.reference_example_id));const o=await n.evaluateRun(i,a),[u,c]=await this._logEvaluationFeedback(o,i,r);return c[0]}async createFeedback(e,n,{score:r,value:s,correction:a,comment:i,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:c,feedbackId:l,feedbackConfig:d,projectId:m,comparativeExperimentId:p}){var y;if(!e&&!m)throw new Error("One of runId or projectId must be provided");if(e&&m)throw new Error("Only one of runId or projectId can be provided");const h={type:u??"api",metadata:o??{}};c!==void 0&&(h==null?void 0:h.metadata)!==void 0&&!h.metadata.__run&&(h.metadata.__run={run_id:c}),(h==null?void 0:h.metadata)!==void 0&&((y=h.metadata.__run)==null?void 0:y.run_id)!==void 0&&Oe(h.metadata.__run.run_id);const g={id:l??Qt(),run_id:e,key:n,score:r,value:s,correction:a,comment:i,feedback_source:h,comparative_experiment_id:p,feedbackConfig:d,session_id:m},b=`${this.apiUrl}/feedback`,_=await this.caller.call(he(),b,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(g),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(_,"create feedback",!0),g}async updateFeedback(e,{score:n,value:r,correction:s,comment:a}){const i={};n!=null&&(i.score=n),r!=null&&(i.value=r),s!=null&&(i.correction=s),a!=null&&(i.comment=a),Oe(e);const o=await this.caller.call(he(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(o,"update feedback",!0)}async readFeedback(e){Oe(e);const n=`/feedback/${e}`;return await this._get(n)}async deleteFeedback(e){Oe(e);const n=`/feedback/${e}`,r=await this.caller.call(he(),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(r,`delete ${n}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:n,feedbackSourceTypes:r}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),n)for(const a of n)s.append("key",a);if(r)for(const a of r)s.append("source",a);for await(const a of this._getPaginated("/feedback",s))yield*a}async createPresignedFeedbackToken(e,n,{expiration:r,feedbackConfig:s}={}){const a={run_id:e,feedback_key:n,feedback_config:s};return r?typeof r=="string"?a.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(a.expires_in=r):a.expires_in={hours:3},await(await this.caller.call(he(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:n,referenceDatasetId:r,createdAt:s,description:a,metadata:i,id:o}){var l;if(n.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:n[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const u={id:o,name:e,experiment_ids:n,reference_dataset_id:r,description:a,created_at:(l=s??new Date)==null?void 0:l.toISOString(),extra:{}};return i&&(u.extra.metadata=i),await(await this.caller.call(he(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){Oe(e);const n=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",n))yield*r}_selectEvalResults(e){let n;return"results"in e?n=e.results:n=[e],n}async _logEvaluationFeedback(e,n,r){const s=this._selectEvalResults(e),a=[];for(const i of s){let o=r||{};i.evaluatorInfo&&(o={...i.evaluatorInfo,...o});let u=null;i.targetRunId?u=i.targetRunId:n&&(u=n.id),a.push(await this.createFeedback(u,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[s,a]}async logEvaluationFeedback(e,n,r){const[s]=await this._logEvaluationFeedback(e,n,r);return s}async*listAnnotationQueues(e={}){const{queueIds:n,name:r,nameContains:s,limit:a}=e,i=new URLSearchParams;n&&n.forEach((u,c)=>{Oe(u,`queueIds[${c}]`),i.append("ids",u)}),r&&i.append("name",r),s&&i.append("name_contains",s),i.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(const u of this._getPaginated("/annotation-queues",i))if(yield*u,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){const{name:n,description:r,queueId:s}=e,a={name:n,description:r,id:s||Qt()},i=await this.caller.call(he(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(a).filter(([u,c])=>c!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(i,"create annotation queue"),await i.json()}async readAnnotationQueue(e){const n=await this.listAnnotationQueues({queueIds:[e]}).next();if(n.done)throw new Error(`Annotation queue with ID ${e} not found`);return n.value}async updateAnnotationQueue(e,n){const{name:r,description:s}=n,a=await this.caller.call(he(),`${this.apiUrl}/annotation-queues/${Oe(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:s}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(a,"update annotation queue")}async deleteAnnotationQueue(e){const n=await this.caller.call(he(),`${this.apiUrl}/annotation-queues/${Oe(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(n,"delete annotation queue")}async addRunsToAnnotationQueue(e,n){const r=await this.caller.call(he(),`${this.apiUrl}/annotation-queues/${Oe(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n.map((s,a)=>Oe(s,`runIds[${a}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,n){const r=`/annotation-queues/${Oe(e,"queueId")}/run`,s=await this.caller.call(he(),`${this.apiUrl}${r}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(s,"get run from annotation queue"),await s.json()}async deleteRunFromAnnotationQueue(e,n){const r=await this.caller.call(he(),`${this.apiUrl}/annotation-queues/${Oe(e,"queueId")}/runs/${Oe(n,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(r,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const n=await this.caller.call(he(),`${this.apiUrl}/annotation-queues/${Oe(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(n,"get size from annotation queue"),await n.json()}async _currentTenantIsOwner(e){const n=await this._getSettings();return e=="-"||n.tenant_handle===e}async _ownerConflictError(e,n){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${n}`)}async _getLatestCommitHash(e){const n=await this.caller.call(he(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await n.json();if(!n.ok){const s=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),a=new Error(`Error ${n.status}: ${n.statusText}
${s}`);throw a.statusCode=n.status,a}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,n){const[r,s,a]=Lr(e),i=await this.caller.call(he(),`${this.apiUrl}/likes/${r}/${s}`,{method:"POST",body:JSON.stringify({like:n}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(i,`${n?"like":"unlike"} prompt`),await i.json()}async _getPromptUrl(e){const[n,r,s]=Lr(e);if(await this._currentTenantIsOwner(n)){const a=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${r}/${s.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${a.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${n}/${r}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${n}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const n of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*n}async*listPrompts(e){const n=new URLSearchParams;n.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),n.append("sort_direction","desc"),n.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&n.append("is_public",e.isPublic.toString()),e!=null&&e.query&&n.append("query",e.query);for await(const r of this._getPaginated("/repos",n,s=>s.repos))yield*r}async getPrompt(e){const[n,r,s]=Lr(e),a=await this.caller.call(he(),`${this.apiUrl}/repos/${n}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(a.status===404)return null;await Se(a,"get prompt");const i=await a.json();return i.repo?i.repo:null}async createPrompt(e,n){const r=await this._getSettings();if(n!=null&&n.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,a,i]=Lr(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:a,...(n==null?void 0:n.description)&&{description:n.description},...(n==null?void 0:n.readme)&&{readme:n.readme},...(n==null?void 0:n.tags)&&{tags:n.tags},is_public:!!(n!=null&&n.isPublic)},u=await this.caller.call(he(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(u,"create prompt");const{repo:c}=await u.json();return c}async createCommit(e,n,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,a,i]=Lr(e),o=(r==null?void 0:r.parentCommitHash)==="latest"||!(r!=null&&r.parentCommitHash)?await this._getLatestCommitHash(`${s}/${a}`):r==null?void 0:r.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(n)),parent_commit:o},c=await this.caller.call(he(),`${this.apiUrl}/commits/${s}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(c,"create commit");const l=await c.json();return this._getPromptUrl(`${s}/${a}${l.commit_hash?`:${l.commit_hash}`:""}`)}async updateExamplesMultipart(e,n=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const r=new FormData;for(const i of n){const o=i.id,u={...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split}},c=un(u),l=new Blob([c],{type:"application/json"});if(r.append(o,l),i.inputs){const d=un(i.inputs),m=new Blob([d],{type:"application/json"});r.append(`${o}.inputs`,m)}if(i.outputs){const d=un(i.outputs),m=new Blob([d],{type:"application/json"});r.append(`${o}.outputs`,m)}if(i.attachments)for(const[d,m]of Object.entries(i.attachments)){let p,h;Array.isArray(m)?[p,h]=m:(p=m.mimeType,h=m.data);const g=new Blob([h],{type:`${p}; length=${h.byteLength}`});r.append(`${o}.attachment.${d}`,g)}if(i.attachments_operations){const d=un(i.attachments_operations),m=new Blob([d],{type:"application/json"});r.append(`${o}.attachments_operations`,m)}}return await(await this.caller.call(he(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"PATCH",headers:this.headers,body:r})).json()}async uploadExamplesMultipart(e,n=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const r=new FormData;for(const i of n){const o=(i.id??Qt()).toString(),u={created_at:i.created_at,...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split}},c=un(u),l=new Blob([c],{type:"application/json"});r.append(o,l);const d=un(i.inputs),m=new Blob([d],{type:"application/json"});if(r.append(`${o}.inputs`,m),i.outputs){const p=un(i.outputs),h=new Blob([p],{type:"application/json"});r.append(`${o}.outputs`,h)}if(i.attachments)for(const[p,h]of Object.entries(i.attachments)){let g,b;Array.isArray(h)?[g,b]=h:(g=h.mimeType,b=h.data);const _=new Blob([b],{type:`${g}; length=${b.byteLength}`});r.append(`${o}.attachment.${p}`,_)}}return await(await this.caller.call(he(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:r})).json()}async updatePrompt(e,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,s]=Lr(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const a={};if((n==null?void 0:n.description)!==void 0&&(a.description=n.description),(n==null?void 0:n.readme)!==void 0&&(a.readme=n.readme),(n==null?void 0:n.tags)!==void 0&&(a.tags=n.tags),(n==null?void 0:n.isPublic)!==void 0&&(a.is_public=n.isPublic),(n==null?void 0:n.isArchived)!==void 0&&(a.is_archived=n.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");const i=await this.caller.call(he(),`${this.apiUrl}/repos/${r}/${s}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,r,s]=Lr(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("delete a prompt",n);return await(await this.caller.call(he(),`${this.apiUrl}/repos/${n}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,n){const[r,s,a]=Lr(e),i=await this.caller.call(he(),`${this.apiUrl}/commits/${r}/${s}/${a}${n!=null&&n.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(i,"pull prompt commit");const o=await i.json();return{owner:r,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,n){const r=await this.pullPromptCommit(e,{includeModel:n==null?void 0:n.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,n){return await this.promptExists(e)?n&&Object.keys(n).some(s=>s!=="object")&&await this.updatePrompt(e,{description:n==null?void 0:n.description,readme:n==null?void 0:n.readme,tags:n==null?void 0:n.tags,isPublic:n==null?void 0:n.isPublic}):await this.createPrompt(e,{description:n==null?void 0:n.description,readme:n==null?void 0:n.readme,tags:n==null?void 0:n.tags,isPublic:n==null?void 0:n.isPublic}),n!=null&&n.object?await this.createCommit(e,n==null?void 0:n.object,{parentCommitHash:n==null?void 0:n.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,n={}){const{sourceApiUrl:r=this.apiUrl,datasetName:s}=n,[a,i]=this.parseTokenOrUrl(e,r),o=new ji({apiUrl:a,apiKey:"placeholder"}),u=await o.readSharedDataset(i),c=s||u.name;try{if(await this.hasDataset({datasetId:c})){console.log(`Dataset ${c} already exists in your tenant. Skipping.`);return}}catch{}const l=await o.listSharedExamples(i),d=await this.createDataset(c,{description:u.description,dataType:u.data_type||"kv",inputsSchema:u.inputs_schema_definition??void 0,outputsSchema:u.outputs_schema_definition??void 0});try{await this.createExamples({inputs:l.map(m=>m.inputs),outputs:l.flatMap(m=>m.outputs?[m.outputs]:[]),datasetId:d.id})}catch(m){throw console.error(`An error occurred while creating dataset ${c}. You should delete it manually.`),m}}parseTokenOrUrl(e,n,r=2,s="dataset"){try{return Oe(e),[n,e]}catch{}try{const i=new URL(e).pathname.split("/").filter(o=>o!=="");if(i.length>=r){const o=i[i.length-r];return[n,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}const ty="0.3.3";let br;const yI=()=>typeof window<"u"&&typeof window.document<"u",EI=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",wI=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),ny=()=>typeof Deno<"u",TI=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!ny(),SI=()=>br||(yI()?br="browser":TI()?br="node":EI()?br="webworker":wI()?br="jsdom":ny()?br="deno":br="other",br);let Bl;function ry(){if(Bl===void 0){const t=SI(),e=vI();Bl={library:"langsmith",runtime:t,sdk:"langsmith-js",sdk_version:ty,...e}}return Bl}function AI(){const t=CI()||{},e={},n=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[r,s]of Object.entries(t))(r.startsWith("LANGCHAIN_")||r.startsWith("LANGSMITH_"))&&typeof s=="string"&&!n.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[r]=s);return e}function CI(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((t,[e,n])=>(t[e]=String(n),t),{}):void 0}catch{return}}function gs(t){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[t]:void 0}catch{return}}function $r(t){return gs(`LANGSMITH_${t}`)||gs(`LANGCHAIN_${t}`)}let Fl;function vI(){if(Fl!==void 0)return Fl;const t=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const n of t){const r=gs(n);r!==void 0&&(e[n]=r)}return Fl=e,e}const OI=t=>!!["TRACING_V2","TRACING"].find(n=>$r(n)==="true"),Ul=Symbol.for("lc:context_variables");function kI(t){return t.replace(/[-:.]/g,"")}function II(t,e,n=1){const r=n.toFixed(0).slice(0,3).padStart(3,"0");return kI(`${new Date(t).toISOString().slice(0,-1)}${r}Z`)+e}class Gu{constructor(e,n){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=n}static fromHeader(e){const n=e.split(",");let r={},s=[];for(const a of n){const[i,o]=a.split("="),u=decodeURIComponent(o);i==="langsmith-metadata"?r=JSON.parse(u):i==="langsmith-tags"&&(s=u.split(","))}return new Gu(r,s)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class ln{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),sy(e)){Object.assign(this,{...e});return}const n=ln.getDefaultConfig(),{metadata:r,...s}=e,a=s.client??ln.getSharedClient(),i={...r,...(o=s==null?void 0:s.extra)==null?void 0:o.metadata};if(s.extra={...s.extra,metadata:i},Object.assign(this,{...n,...s,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const u=II(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+u:this.dotted_order=u}}static getDefaultConfig(){return{id:Qt(),run_type:"chain",project_name:$r("PROJECT")??gs("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:gs("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:gs("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return ln.sharedClient||(ln.sharedClient=new ji),ln.sharedClient}createChild(e){var u,c,l,d,m,p;const n=this.child_execution_order+1,r=new ln({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:n,child_execution_order:n});Ul in this&&(r[Ul]=this[Ul]);const s=Symbol.for("lc:child_config"),a=((u=e.extra)==null?void 0:u[s])??this.extra[s];if(RI(a)){const h={...a},g=NI(h.callbacks)?(l=(c=h.callbacks).copy)==null?void 0:l.call(c):void 0;g&&(Object.assign(g,{_parentRunId:r.id}),(p=(m=(d=g.handlers)==null?void 0:d.find(ay))==null?void 0:m.updateFromRunTree)==null||p.call(m,r),h.callbacks=g),r.extra[s]=h}const i=new Set;let o=this;for(;o!=null&&!i.has(o.id);)i.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,n),o=o.parent_run;return this.child_runs.push(r),r}async end(e,n,r=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??n,this.end_time=this.end_time??r,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,n,r=!0){var u;const s=e.extra??{};if(s.runtime||(s.runtime={}),n)for(const[c,l]of Object.entries(n))s.runtime[c]||(s.runtime[c]=l);let a,i;return r?(i=(u=e.parent_run)==null?void 0:u.id,a=[]):(a=e.child_runs.map(c=>this._convertToCreate(c,n,r)),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments}}async postRun(e=!0){try{const n=ry(),r=await this._convertToCreate(this,n,!0);if(await this.client.createRun(r),!e){G_("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const s of this.child_runs)await s.postRun(!1)}}catch(n){console.error(`Error in postRun for run ${this.id}:`,n)}}async patchRun(){var e;try{const n={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments};await this.client.updateRun(this.id,n)}catch(n){console.error(`Error in patchRun for run ${this.id}`,n)}}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,n){var c,l,d,m;const r=e==null?void 0:e.callbacks;let s,a,i,o=OI();if(r){const p=((c=r==null?void 0:r.getParentRunId)==null?void 0:c.call(r))??"",h=(l=r==null?void 0:r.handlers)==null?void 0:l.find(g=>(g==null?void 0:g.name)=="langchain_tracer");s=(d=h==null?void 0:h.getRun)==null?void 0:d.call(h,p),a=h==null?void 0:h.projectName,i=h==null?void 0:h.client,o=o||!!h}return s?new ln({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:i,tracingEnabled:o,project_name:a,tags:[...new Set(((s==null?void 0:s.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(m=s==null?void 0:s.extra)==null?void 0:m.metadata,...e==null?void 0:e.metadata}}}).createChild(n):new ln({...n,client:i,tracingEnabled:o,project_name:a})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,n){var c;const r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=r["langsmith-trace"];if(!s||typeof s!="string")return;const a=s.trim(),i=a.split(".").map(l=>{const[d,m]=l.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:m}}),o=i[0].uuid,u={...n,name:(n==null?void 0:n.name)??"parent",run_type:(n==null?void 0:n.run_type)??"chain",start_time:(n==null?void 0:n.start_time)??Date.now(),id:(c=i.at(-1))==null?void 0:c.uuid,trace_id:o,dotted_order:a};if(r.baggage&&typeof r.baggage=="string"){const l=Gu.fromHeader(r.baggage);u.metadata=l.metadata,u.tags=l.tags}return new ln(u)}toHeaders(e){var r;const n={"langsmith-trace":this.dotted_order,baggage:new Gu((r=this.extra)==null?void 0:r.metadata,this.tags).toHeader()};if(e)for(const[s,a]of Object.entries(n))e.set(s,a);return n}}Object.defineProperty(ln,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function sy(t){return t!==void 0&&typeof t.createChild=="function"&&typeof t.postRun=="function"}function ay(t){return typeof t=="object"&&t!=null&&typeof t.name=="string"&&t.name==="langchain_tracer"}function zp(t){return Array.isArray(t)&&t.some(e=>ay(e))}function NI(t){return typeof t=="object"&&t!=null&&Array.isArray(t.handlers)}function RI(t){var e;return t!==void 0&&typeof t.callbacks=="object"&&(zp((e=t.callbacks)==null?void 0:e.handlers)||zp(t.callbacks))}let PI=class{getStore(){}run(e,n){return n()}};const jl=Symbol.for("ls:tracing_async_local_storage"),xI=new PI;let LI=class{getInstance(){return globalThis[jl]??xI}initializeGlobalInstance(e){globalThis[jl]===void 0&&(globalThis[jl]=e)}};const DI=new LI,MI=()=>{const t=DI.getInstance().getStore();if(!sy(t))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function and that tracing is enabled."].join(`
`));return t};function Sf(t){return typeof t=="function"&&"langsmith:traceable"in t}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const BI=Object.prototype.hasOwnProperty;function rh(t,e){return BI.call(t,e)}function sh(t){if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=""+r;return n}if(Object.keys)return Object.keys(t);let e=[];for(let n in t)rh(t,n)&&e.push(n);return e}function ur(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function ah(t){let e=0;const n=t.length;let r;for(;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Bs(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function FI(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function ih(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(ih(t[n]))return!0}else if(typeof t=="object"){const n=sh(t),r=n.length;for(var e=0;e<r;e++)if(ih(t[n[e]]))return!0}}return!1}function Wp(t,e){const n=[t];for(const r in e){const s=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof s<"u"&&n.push(`${r}: ${s}`)}return n.join(`
`)}class UI extends Error{constructor(e,n,r,s,a){super(Wp(e,{name:n,index:r,operation:s,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=Wp(e,{name:n,index:r,operation:s,tree:a})}}const mt=UI,Qs={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){let r=oh(n,this.path);r&&(r=ur(r));const s=fi(n,{op:"remove",path:this.from}).removed;return fi(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:r}},copy:function(t,e,n){const r=oh(n,this.from);return fi(n,{op:"add",path:this.path,value:ur(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:Yu(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}};var jI={add:function(t,e,n){return ah(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:Qs.move,copy:Qs.copy,test:Qs.test,_get:Qs._get};function oh(t,e){if(e=="")return t;var n={op:"_get",path:e};return fi(t,n),n.value}function fi(t,e,n=!1,r=!0,s=!0,a=0){if(n&&(typeof n=="function"?n(e,0,t,e.path):uh(e,0)),e.path===""){let i={newDocument:t};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=t,i;if(e.op==="move"||e.op==="copy")return i.newDocument=oh(t,e.from),e.op==="move"&&(i.removed=t),i;if(e.op==="test"){if(i.test=Yu(t,e.value),i.test===!1)throw new mt("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return i.newDocument=t,i}else{if(e.op==="remove")return i.removed=t,i.newDocument=null,i;if(e.op==="_get")return e.value=t,i;if(n)throw new mt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,t);return i}}else{r||(t=ur(t));const o=(e.path||"").split("/");let u=t,c=1,l=o.length,d,m,p;for(typeof n=="function"?p=n:p=uh;;){if(m=o[c],m&&m.indexOf("~")!=-1&&(m=FI(m)),s&&(m=="__proto__"||m=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(u[m]===void 0?d=o.slice(0,c).join("/"):c==l-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),c++,Array.isArray(u)){if(m==="-")m=u.length;else{if(n&&!ah(m))throw new mt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,t);ah(m)&&(m=~~m)}if(c>=l){if(n&&e.op==="add"&&m>u.length)throw new mt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,t);const h=jI[e.op].call(e,u,m,t);if(h.test===!1)throw new mt("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return h}}else if(c>=l){const h=Qs[e.op].call(e,u,m,t);if(h.test===!1)throw new mt("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return h}if(u=u[m],n&&c<l&&(!u||typeof u!="object"))throw new mt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,t)}}}function Ku(t,e,n,r=!0,s=!0){if(n&&!Array.isArray(e))throw new mt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=ur(t));const a=new Array(e.length);for(let i=0,o=e.length;i<o;i++)a[i]=fi(t,e[i],n,!0,s,i),t=a[i].newDocument;return a.newDocument=t,a}function uh(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new mt("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(Qs[t.op]){if(typeof t.path!="string")throw new mt("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new mt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new mt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new mt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&ih(t.value))throw new mt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var s=t.path.split("/").length,a=r.split("/").length;if(s!==a+1&&s!==a)throw new mt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new mt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var i={op:"_get",path:t.from,value:void 0},o=HI([i],n);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new mt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new mt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function HI(t,e,n){try{if(!Array.isArray(t))throw new mt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Ku(ur(e),ur(t),n||!0);else{n=n||uh;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(s){if(s instanceof mt)return s;throw s}}function Yu(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),s,a,i;if(n&&r){if(a=t.length,a!=e.length)return!1;for(s=a;s--!==0;)if(!Yu(t[s],e[s]))return!1;return!0}if(n!=r)return!1;var o=Object.keys(t);if(a=o.length,a!==Object.keys(e).length)return!1;for(s=a;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=a;s--!==0;)if(i=o[s],!Yu(t[i],e[i]))return!1;return!0}return t!==t&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function iy(t,e,n,r,s){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var a=sh(e),i=sh(t),o=!1,u=i.length-1;u>=0;u--){var c=i[u],l=t[c];if(rh(e,c)&&!(e[c]===void 0&&l!==void 0&&Array.isArray(e)===!1)){var d=e[c];typeof l=="object"&&l!=null&&typeof d=="object"&&d!=null&&Array.isArray(l)===Array.isArray(d)?iy(l,d,n,r+"/"+Bs(c),s):l!==d&&(s&&n.push({op:"test",path:r+"/"+Bs(c),value:ur(l)}),n.push({op:"replace",path:r+"/"+Bs(c),value:ur(d)}))}else Array.isArray(t)===Array.isArray(e)?(s&&n.push({op:"test",path:r+"/"+Bs(c),value:ur(l)}),n.push({op:"remove",path:r+"/"+Bs(c)}),o=!0):(s&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!o&&a.length==i.length))for(var u=0;u<a.length;u++){var c=a[u];!rh(t,c)&&e[c]!==void 0&&n.push({op:"add",path:r+"/"+Bs(c),value:ur(e[c])})}}}function $I(t,e,n=!1){var r=[];return iy(t,e,r,"",n),r}var qI=function(t,e){if(typeof t!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,t.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const VI=io(qI);var oy={exports:{}};const zI=/[\p{Lu}]/u,WI=/[\p{Ll}]/u,Gp=/^[\p{Lu}](?![\p{Lu}])/gu,uy=/([\p{Alpha}\p{N}_]|$)/u,cy=/[_.\- ]+/,GI=new RegExp("^"+cy.source),Kp=new RegExp(cy.source+uy.source,"gu"),Yp=new RegExp("\\d+"+uy.source,"gu"),KI=(t,e,n)=>{let r=!1,s=!1,a=!1;for(let i=0;i<t.length;i++){const o=t[i];r&&zI.test(o)?(t=t.slice(0,i)+"-"+t.slice(i),r=!1,a=s,s=!0,i++):s&&a&&WI.test(o)?(t=t.slice(0,i-1)+"-"+t.slice(i-1),a=s,s=!1,r=!0):(r=e(o)===o&&n(o)!==o,a=s,s=n(o)===o&&e(o)!==o)}return t},YI=(t,e)=>(Gp.lastIndex=0,t.replace(Gp,n=>e(n))),ZI=(t,e)=>(Kp.lastIndex=0,Yp.lastIndex=0,t.replace(Kp,(n,r)=>e(r)).replace(Yp,n=>e(n))),ly=(t,e)=>{if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(a=>a.trim()).filter(a=>a.length).join("-"):t=t.trim(),t.length===0)return"";const n=e.locale===!1?a=>a.toLowerCase():a=>a.toLocaleLowerCase(e.locale),r=e.locale===!1?a=>a.toUpperCase():a=>a.toLocaleUpperCase(e.locale);return t.length===1?e.pascalCase?r(t):n(t):(t!==n(t)&&(t=KI(t,n,r)),t=t.replace(GI,""),e.preserveConsecutiveUppercase?t=YI(t,n):t=n(t),e.pascalCase&&(t=r(t.charAt(0))+t.slice(1)),ZI(t,r))};oy.exports=ly;oy.exports.default=ly;function JI(t,e){return(e==null?void 0:e[t])||VI(t)}function XI(t,e,n){const r={};for(const s in t)Object.hasOwn(t,s)&&(r[e(s,n)]=t[s]);return r}function Zp(t){return Array.isArray(t)?[...t]:{...t}}function QI(t,e){const n=Zp(t);for(const[r,s]of Object.entries(e)){const[a,...i]=r.split(".").reverse();let o=n;for(const u of i.reverse()){if(o[u]===void 0)break;o[u]=Zp(o[u]),o=o[u]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[s]})}return n}function dy(t){const e=Object.getPrototypeOf(t);return typeof t.lc_name=="function"&&(typeof e.lc_name!="function"||t.lc_name()!==e.lc_name())?t.lc_name():t.name}class Yr{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,dy(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...n){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof Yr||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},n={},r=Object.keys(this.lc_kwargs).reduce((s,a)=>(s[a]=a in this?this[a]:this.lc_kwargs[a],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(n,Reflect.get(s,"lc_secrets",this)),Object.assign(r,Reflect.get(s,"lc_attributes",this));return Object.keys(n).forEach(s=>{let a=this,i=r;const[o,...u]=s.split(".").reverse();for(const c of u.reverse()){if(!(c in a)||a[c]===void 0)return;(!(c in i)||i[c]===void 0)&&(typeof a[c]=="object"&&a[c]!=null?i[c]={}:Array.isArray(a[c])&&(i[c]=[])),a=a[c],i=i[c]}o in a&&a[o]!==void 0&&(i[o]=i[o]||a[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:XI(Object.keys(n).length?QI(r,n):r,JI,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}const eN=()=>typeof window<"u"&&typeof window.document<"u",tN=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",nN=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Af=()=>typeof Deno<"u",rN=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Af(),sN=()=>{let t;return eN()?t="browser":rN()?t="node":tN()?t="webworker":nN()?t="jsdom":Af()?t="deno":t="other",t};let Hl;async function aN(){return Hl===void 0&&(Hl={library:"langchain-js",runtime:sN()}),Hl}function gn(t){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[t]:Af()?Deno==null?void 0:Deno.env.get(t):void 0}catch{return}}class iN{}function oN(t){return"lc_prefer_streaming"in t&&t.lc_prefer_streaming}class co extends iN{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,dy(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:gn("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Yr.prototype.toJSON.call(this)}toJSONNotImplemented(){return Yr.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class n extends co{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Qt()}),Object.assign(this,e)}}return new n}}const uN=t=>{const e=t;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};function $l(t,e){return t&&!Array.isArray(t)&&typeof t=="object"?t:{[e]:t}}function cN(t){return t.replace(/[-:.]/g,"")}function lN(t,e,n){const r=n.toFixed(0).slice(0,3).padStart(3,"0");return cN(`${new Date(t).toISOString().slice(0,-1)}${r}Z`)+e}function Ua(t){return typeof t._addRunToRunMap=="function"}class lo extends co{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,n){e.child_runs.push(n)}_addRunToRunMap(e){const n=lN(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){const s=this.runMap.get(r.parent_run_id);s&&(this._addChildRun(s,r),s.child_execution_order=Math.max(s.child_execution_order,r.child_execution_order),r.trace_id=s.trace_id,s.dotted_order!==void 0&&(r.dotted_order=[s.dotted_order,n].join(".")))}else r.trace_id=r.id,r.dotted_order=n;return this.runMap.set(r.id,r),r}async _endTrace(e){var r;const n=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);n?n.child_execution_order=Math.max(n.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((r=this.onRunUpdate)==null?void 0:r.call(this,e))}_getExecutionOrder(e){const n=e!==void 0&&this.runMap.get(e);return n?n.child_execution_order+1:1}_createRunForLLMStart(e,n,r,s,a,i,o,u){const c=this._getExecutionOrder(s),l=Date.now(),d=o?{...a,metadata:o}:a,m={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{prompts:n},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(m)}async handleLLMStart(e,n,r,s,a,i,o,u){var l,d;const c=this.runMap.get(r)??this._createRunForLLMStart(e,n,r,s,a,i,o,u);return await((l=this.onRunCreate)==null?void 0:l.call(this,c)),await((d=this.onLLMStart)==null?void 0:d.call(this,c)),c}_createRunForChatModelStart(e,n,r,s,a,i,o,u){const c=this._getExecutionOrder(s),l=Date.now(),d=o?{...a,metadata:o}:a,m={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{messages:n},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(m)}async handleChatModelStart(e,n,r,s,a,i,o,u){var l,d;const c=this.runMap.get(r)??this._createRunForChatModelStart(e,n,r,s,a,i,o,u);return await((l=this.onRunCreate)==null?void 0:l.call(this,c)),await((d=this.onLLMStart)==null?void 0:d.call(this,c)),c}async handleLLMEnd(e,n,r,s,a){var o;const i=this.runMap.get(n);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.outputs=e,i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...a},await((o=this.onLLMEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleLLMError(e,n,r,s,a){var o;const i=this.runMap.get(n);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...a},await((o=this.onLLMError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForChainStart(e,n,r,s,a,i,o,u){const c=this._getExecutionOrder(s),l=Date.now(),d={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:n,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(d)}async handleChainStart(e,n,r,s,a,i,o,u){var l,d;const c=this.runMap.get(r)??this._createRunForChainStart(e,n,r,s,a,i,o,u);return await((l=this.onRunCreate)==null?void 0:l.call(this,c)),await((d=this.onChainStart)==null?void 0:d.call(this,c)),c}async handleChainEnd(e,n,r,s,a){var o;const i=this.runMap.get(n);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=$l(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=$l(a.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleChainError(e,n,r,s,a){var o;const i=this.runMap.get(n);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=$l(a.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForToolStart(e,n,r,s,a,i,o){const u=this._getExecutionOrder(s),c=Date.now(),l={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:n},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(l)}async handleToolStart(e,n,r,s,a,i,o){var c,l;const u=this.runMap.get(r)??this._createRunForToolStart(e,n,r,s,a,i,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((l=this.onToolStart)==null?void 0:l.call(this,u)),u}async handleToolEnd(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleToolError(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,n){var a;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentAction)==null?void 0:a.call(this,r))}async handleAgentEnd(e,n){var s;const r=this.runMap.get(n);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,r)))}_createRunForRetrieverStart(e,n,r,s,a,i,o){const u=this._getExecutionOrder(s),c=Date.now(),l={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:n},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(l)}async handleRetrieverStart(e,n,r,s,a,i,o){var c,l;const u=this.runMap.get(r)??this._createRunForRetrieverStart(e,n,r,s,a,i,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((l=this.onRetrieverStart)==null?void 0:l.call(this,u)),u}async handleRetrieverEnd(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleText(e,n){var s;const r=this.runMap.get(n);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,r)))}async handleLLMNewToken(e,n,r,s,a,i){var u;const o=this.runMap.get(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:n,chunk:i==null?void 0:i.chunk}}),await((u=this.onLLMNewToken)==null?void 0:u.call(this,o,e,{chunk:i==null?void 0:i.chunk})),o}}var Cf={exports:{}};Cf.exports;(function(t){const n=(a=0)=>i=>`\x1B[${38+a};5;${i}m`,r=(a=0)=>(i,o,u)=>`\x1B[${38+a};2;${i};${o};${u}m`;function s(){const a=new Map,i={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};i.color.gray=i.color.blackBright,i.bgColor.bgGray=i.bgColor.bgBlackBright,i.color.grey=i.color.blackBright,i.bgColor.bgGrey=i.bgColor.bgBlackBright;for(const[o,u]of Object.entries(i)){for(const[c,l]of Object.entries(u))i[c]={open:`\x1B[${l[0]}m`,close:`\x1B[${l[1]}m`},u[c]=i[c],a.set(l[0],l[1]);Object.defineProperty(i,o,{value:u,enumerable:!1})}return Object.defineProperty(i,"codes",{value:a,enumerable:!1}),i.color.close="\x1B[39m",i.bgColor.close="\x1B[49m",i.color.ansi256=n(),i.color.ansi16m=r(),i.bgColor.ansi256=n(10),i.bgColor.ansi16m=r(10),Object.defineProperties(i,{rgbToAnsi256:{value:(o,u,c)=>o===u&&u===c?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(u/255*5)+Math.round(c/255*5),enumerable:!1},hexToRgb:{value:o=>{const u=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!u)return[0,0,0];let{colorString:c}=u.groups;c.length===3&&(c=c.split("").map(d=>d+d).join(""));const l=Number.parseInt(c,16);return[l>>16&255,l>>8&255,l&255]},enumerable:!1},hexToAnsi256:{value:o=>i.rgbToAnsi256(...i.hexToRgb(o)),enumerable:!1}}),i}Object.defineProperty(t,"exports",{enumerable:!0,get:s})})(Cf);var dN=Cf.exports;const hy=io(dN);function $t(t,e){return`${t.open}${e}${t.close}`}function Sn(t,e){try{return JSON.stringify(t,null,2)}catch{return e}}function Jp(t){return typeof t=="string"?t.trim():t==null?t:Sn(t,t.toString())}function Dr(t){if(!t.end_time)return"";const e=t.end_time-t.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Gt}=hy;class Xp extends lo{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const n=[];let r=e;for(;r.parent_run_id;){const s=this.runMap.get(r.parent_run_id);if(s)n.push(s),r=s;else break}return n}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((s,a,i)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return a===i.length-1?$t(hy.bold,o):o}).join(" > ");return $t(Gt.grey,r)}onChainStart(e){const n=this.getBreadcrumbs(e);console.log(`${$t(Gt.green,"[chain/start]")} [${n}] Entering Chain run with input: ${Sn(e.inputs,"[inputs]")}`)}onChainEnd(e){const n=this.getBreadcrumbs(e);console.log(`${$t(Gt.cyan,"[chain/end]")} [${n}] [${Dr(e)}] Exiting Chain run with output: ${Sn(e.outputs,"[outputs]")}`)}onChainError(e){const n=this.getBreadcrumbs(e);console.log(`${$t(Gt.red,"[chain/error]")} [${n}] [${Dr(e)}] Chain run errored with error: ${Sn(e.error,"[error]")}`)}onLLMStart(e){const n=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${$t(Gt.green,"[llm/start]")} [${n}] Entering LLM run with input: ${Sn(r,"[inputs]")}`)}onLLMEnd(e){const n=this.getBreadcrumbs(e);console.log(`${$t(Gt.cyan,"[llm/end]")} [${n}] [${Dr(e)}] Exiting LLM run with output: ${Sn(e.outputs,"[response]")}`)}onLLMError(e){const n=this.getBreadcrumbs(e);console.log(`${$t(Gt.red,"[llm/error]")} [${n}] [${Dr(e)}] LLM run errored with error: ${Sn(e.error,"[error]")}`)}onToolStart(e){const n=this.getBreadcrumbs(e);console.log(`${$t(Gt.green,"[tool/start]")} [${n}] Entering Tool run with input: "${Jp(e.inputs.input)}"`)}onToolEnd(e){var r;const n=this.getBreadcrumbs(e);console.log(`${$t(Gt.cyan,"[tool/end]")} [${n}] [${Dr(e)}] Exiting Tool run with output: "${Jp((r=e.outputs)==null?void 0:r.output)}"`)}onToolError(e){const n=this.getBreadcrumbs(e);console.log(`${$t(Gt.red,"[tool/error]")} [${n}] [${Dr(e)}] Tool run errored with error: ${Sn(e.error,"[error]")}`)}onRetrieverStart(e){const n=this.getBreadcrumbs(e);console.log(`${$t(Gt.green,"[retriever/start]")} [${n}] Entering Retriever run with input: ${Sn(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const n=this.getBreadcrumbs(e);console.log(`${$t(Gt.cyan,"[retriever/end]")} [${n}] [${Dr(e)}] Exiting Retriever run with output: ${Sn(e.outputs,"[outputs]")}`)}onRetrieverError(e){const n=this.getBreadcrumbs(e);console.log(`${$t(Gt.red,"[retriever/error]")} [${n}] [${Dr(e)}] Retriever run errored with error: ${Sn(e.error,"[error]")}`)}onAgentAction(e){const n=e,r=this.getBreadcrumbs(e);console.log(`${$t(Gt.blue,"[agent/action]")} [${r}] Agent selected action: ${Sn(n.actions[n.actions.length-1],"[action]")}`)}}function fy(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,t}function vf(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="tool_call")}class my extends Error{constructor(e,n){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=n}}function Qp(t,e=Of){t=t.trim();const n=/```(json)?(.*)```/s.exec(t);return e(n?n[2]:t)}function Of(t){if(typeof t>"u")return null;try{return JSON.parse(t)}catch{}let e="";const n=[];let r=!1,s=!1;for(let a of t){if(r)a==='"'&&!s?r=!1:a===`
`&&!s?a="\\n":a==="\\"?s=!s:s=!1;else if(a==='"')r=!0,s=!1;else if(a==="{")n.push("}");else if(a==="[")n.push("]");else if(a==="}"||a==="]")if(n[n.length-1]===a)n.pop();else return null;e+=a}r&&(e+='"');for(let a=n.length-1;a>=0;a-=1)e+=n[a];try{return JSON.parse(e)}catch{return null}}function Ta(t,e){return typeof t=="string"?typeof e=="string"?t+e:[{type:"text",text:t},...e]:Array.isArray(e)?Uc(t,e)??[...t,...e]:[...t,{type:"text",text:e}]}function hN(t,e){return t==="error"||e==="error"?"error":"success"}function fN(t,e){function n(r,s){if(typeof r!="object"||r===null||r===void 0)return r;if(s>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(i=>n(i,s+1));const a={};for(const i of Object.keys(r))a[i]=n(r[i],s+1);return a}return JSON.stringify(n(t,0),null,2)}class Sa extends Yr{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}getType(){return this._getType()}constructor(e,n){typeof e=="string"&&(e={content:e,additional_kwargs:n,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const n=fN(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${n}`}}function zt(t,e){const n={...t};for(const[r,s]of Object.entries(e))if(n[r]==null)n[r]=s;else{if(s==null)continue;if(typeof n[r]!=typeof s||Array.isArray(n[r])!==Array.isArray(s))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof n[r]=="string"){if(r==="type")continue;n[r]+=s}else if(typeof n[r]=="object"&&!Array.isArray(n[r]))n[r]=zt(n[r],s);else if(Array.isArray(n[r]))n[r]=Uc(n[r],s);else{if(n[r]===s)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return n}function Uc(t,e){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t||e;{const n=[...t];for(const r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){const s=n.findIndex(a=>a.index===r.index);s!==-1?n[s]=zt(n[s],r):n.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;n.push(r)}return n}}}function mN(t,e){if(!t&&!e)throw new Error("Cannot merge two undefined objects.");if(!t||!e)return t||e;if(typeof t!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof t}
Right ${typeof e}`);if(typeof t=="string"&&typeof e=="string")return t+e;if(Array.isArray(t)&&Array.isArray(e))return Uc(t,e);if(typeof t=="object"&&typeof e=="object")return zt(t,e);if(t===e)return t;throw new Error(`Can not merge objects of different types.
Left ${t}
Right ${e}`)}class Aa extends Sa{}function pN(t){return typeof t.role=="string"}function jc(t){return typeof(t==null?void 0:t._getType)=="function"}function gN(t){return jc(t)&&typeof t.concat=="function"}function bN(t){return t!=null&&typeof t=="object"&&"lc_direct_tool_output"in t&&t.lc_direct_tool_output===!0}class ch extends Sa{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,n,r){typeof e=="string"&&(e={content:e,name:r,tool_call_id:n}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class kf extends Aa{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new kf({content:Ta(this.content,e.content),additional_kwargs:zt(this.additional_kwargs,e.additional_kwargs),response_metadata:zt(this.response_metadata,e.response_metadata),artifact:mN(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:hN(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function _N(t){const e=[],n=[];for(const r of t)if(r.function){const s=r.function.name;try{const a=JSON.parse(r.function.arguments),i={name:s||"",args:a||{},id:r.id};e.push(i)}catch{n.push({name:s,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,n]}class As extends Sa{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,n){var s;let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:n??{}};else{r=e;const a=(s=r.additional_kwargs)==null?void 0:s.tool_calls,i=r.tool_calls;a!=null&&a.length>0&&(i===void 0||i.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(a!=null&&i===void 0){const[o,u]=_N(a);r.tool_calls=o??[],r.invalid_tool_calls=u??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function ho(t){return t._getType()==="ai"}function eg(t){return t._getType()==="ai"}class en extends Aa{constructor(e){let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)n={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const r=[],s=[];for(const a of e.tool_call_chunks){let i={};try{if(i=Of(a.args||"{}"),i===null||typeof i!="object"||Array.isArray(i))throw new Error("Malformed tool call chunk args.");r.push({name:a.name??"",args:i,id:a.id,type:"tool_call"})}catch{s.push({name:a.name,args:a.args,id:a.id,error:"Malformed args.",type:"invalid_tool_call"})}}n={...e,tool_calls:r,invalid_tool_calls:s,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=n.tool_call_chunks??this.tool_call_chunks,this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=n.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var r,s,a,i,o,u,c,l,d,m,p,h,g,b,_,y,E,I,w,R,v,j,F,x,H,te,Z,N,S,P,U,D,W,K,G,se,we,Le,ke,At;const n={content:Ta(this.content,e.content),additional_kwargs:zt(this.additional_kwargs,e.additional_kwargs),response_metadata:zt(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const Rt=Uc(this.tool_call_chunks,e.tool_call_chunks);Rt!==void 0&&Rt.length>0&&(n.tool_call_chunks=Rt)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const Rt={...(((s=(r=this.usage_metadata)==null?void 0:r.input_token_details)==null?void 0:s.audio)!==void 0||((i=(a=e.usage_metadata)==null?void 0:a.input_token_details)==null?void 0:i.audio)!==void 0)&&{audio:(((u=(o=this.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:u.audio)??0)+(((l=(c=e.usage_metadata)==null?void 0:c.input_token_details)==null?void 0:l.audio)??0)},...(((m=(d=this.usage_metadata)==null?void 0:d.input_token_details)==null?void 0:m.cache_read)!==void 0||((h=(p=e.usage_metadata)==null?void 0:p.input_token_details)==null?void 0:h.cache_read)!==void 0)&&{cache_read:(((b=(g=this.usage_metadata)==null?void 0:g.input_token_details)==null?void 0:b.cache_read)??0)+(((y=(_=e.usage_metadata)==null?void 0:_.input_token_details)==null?void 0:y.cache_read)??0)},...(((I=(E=this.usage_metadata)==null?void 0:E.input_token_details)==null?void 0:I.cache_creation)!==void 0||((R=(w=e.usage_metadata)==null?void 0:w.input_token_details)==null?void 0:R.cache_creation)!==void 0)&&{cache_creation:(((j=(v=this.usage_metadata)==null?void 0:v.input_token_details)==null?void 0:j.cache_creation)??0)+(((x=(F=e.usage_metadata)==null?void 0:F.input_token_details)==null?void 0:x.cache_creation)??0)}},Pr={...(((te=(H=this.usage_metadata)==null?void 0:H.output_token_details)==null?void 0:te.audio)!==void 0||((N=(Z=e.usage_metadata)==null?void 0:Z.output_token_details)==null?void 0:N.audio)!==void 0)&&{audio:(((P=(S=this.usage_metadata)==null?void 0:S.output_token_details)==null?void 0:P.audio)??0)+(((D=(U=e.usage_metadata)==null?void 0:U.output_token_details)==null?void 0:D.audio)??0)},...(((K=(W=this.usage_metadata)==null?void 0:W.output_token_details)==null?void 0:K.reasoning)!==void 0||((se=(G=e.usage_metadata)==null?void 0:G.output_token_details)==null?void 0:se.reasoning)!==void 0)&&{reasoning:(((Le=(we=this.usage_metadata)==null?void 0:we.output_token_details)==null?void 0:Le.reasoning)??0)+(((At=(ke=e.usage_metadata)==null?void 0:ke.output_token_details)==null?void 0:At.reasoning)??0)}},In=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Ct=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Xn={input_tokens:In.input_tokens+Ct.input_tokens,output_tokens:In.output_tokens+Ct.output_tokens,total_tokens:In.total_tokens+Ct.total_tokens,...Object.keys(Rt).length>0&&{input_token_details:Rt},...Object.keys(Pr).length>0&&{output_token_details:Pr}};n.usage_metadata=Xn}return new en(n)}}class fo extends Sa{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return fo}constructor(e,n){typeof e=="string"&&(e={content:e,role:n}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class Hc extends Aa{static lc_name(){return"ChatMessageChunk"}constructor(e,n){typeof e=="string"&&(e={content:e,role:n}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Hc({content:Ta(this.content,e.content),additional_kwargs:zt(this.additional_kwargs,e.additional_kwargs),response_metadata:zt(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class $c extends Aa{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new $c({content:Ta(this.content,e.content),additional_kwargs:zt(this.additional_kwargs,e.additional_kwargs),response_metadata:zt(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class cr extends Sa{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class qc extends Aa{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new qc({content:Ta(this.content,e.content),additional_kwargs:zt(this.additional_kwargs,e.additional_kwargs),response_metadata:zt(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class lh extends Sa{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class Hi extends Aa{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new Hi({content:Ta(this.content,e.content),additional_kwargs:zt(this.additional_kwargs,e.additional_kwargs),response_metadata:zt(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function yN(t){return vf(t)?t:typeof t.id=="string"&&t.type==="function"&&typeof t.function=="object"&&t.function!==null&&"arguments"in t.function&&typeof t.function.arguments=="string"&&"name"in t.function&&typeof t.function.name=="string"?{id:t.id,args:JSON.parse(t.function.arguments),name:t.function.name,type:"tool_call"}:t}function EN(t){return typeof t=="object"&&t!=null&&t.lc===1&&Array.isArray(t.id)&&t.kwargs!=null&&typeof t.kwargs=="object"}function ql(t){let e,n;if(EN(t)){const r=t.id.at(-1);r==="HumanMessage"||r==="HumanMessageChunk"?e="user":r==="AIMessage"||r==="AIMessageChunk"?e="assistant":r==="SystemMessage"||r==="SystemMessageChunk"?e="system":e="unknown",n=t.kwargs}else{const{type:r,...s}=t;e=r,n=s}if(e==="human"||e==="user")return new cr(n);if(e==="ai"||e==="assistant"){const{tool_calls:r,...s}=n;if(!Array.isArray(r))return new As(n);const a=r.map(yN);return new As({...s,tool_calls:a})}else{if(e==="system")return new lh(n);if(e==="developer")return new lh({...n,additional_kwargs:{...n.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in n)return new ch({...n,content:n.content,tool_call_id:n.tool_call_id,name:n.name});throw fy(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(t,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function ti(t){if(typeof t=="string")return new cr(t);if(jc(t))return t;if(Array.isArray(t)){const[e,n]=t;return ql({type:e,content:n})}else if(pN(t)){const{role:e,...n}=t;return ql({...n,type:e})}else return ql(t)}function py(t,e="Human",n="AI"){const r=[];for(const s of t){let a;if(s._getType()==="human")a=e;else if(s._getType()==="ai")a=n;else if(s._getType()==="system")a="System";else if(s._getType()==="function")a="Function";else if(s._getType()==="tool")a="Tool";else if(s._getType()==="generic")a=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);const i=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);r.push(`${a}: ${i}${o}`)}return r.join(`
`)}function wN(t){var n;const e=t._getType();if(e==="human")return new qc({...t});if(e==="ai"){let r={...t};return"tool_calls"in r&&(r={...r,tool_call_chunks:(n=r.tool_calls)==null?void 0:n.map(s=>({...s,type:"tool_call_chunk",index:void 0,args:JSON.stringify(s.args)}))}),new en({...r})}else{if(e==="system")return new Hi({...t});if(e==="function")return new $c({...t});if(fo.isInstance(t))return new Hc({...t});throw new Error("Unknown message type.")}}let Vl;const TN=()=>{if(Vl===void 0){const t=gn("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};Vl=new ji(t)}return Vl};class mi extends lo{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:n,projectName:r,client:s}=e;this.projectName=r??gn("LANGCHAIN_PROJECT")??gn("LANGCHAIN_SESSION"),this.exampleId=n,this.client=s??TN();const a=mi.getTraceableRunTree();a&&this.updateFromRunTree(a)}async _convertToCreate(e,n=void 0){return{...e,extra:{...e.extra,runtime:await aN()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:n}}async persistRun(e){}async onRunCreate(e){const n=await this._convertToCreate(e,this.exampleId);await this.client.createRun(n)}async onRunUpdate(e){const n={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id,extra:e.extra};await this.client.updateRun(e.id,n)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let n=e;const r=new Set;for(;n.parent_run&&!(r.has(n.id)||(r.add(n.id),!n.parent_run));)n=n.parent_run;r.clear();const s=[n];for(;s.length>0;){const a=s.shift();!a||r.has(a.id)||(r.add(a.id),this.runMap.set(a.id,a),a.child_runs&&s.push(...a.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const n={},r=[];for(const[s,a]of this.runMap){const i=new ln({...a,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});n[s]=i,r.push([s,a.dotted_order])}r.sort((s,a)=>!s[1]||!a[1]?0:s[1].localeCompare(a[1]));for(const[s]of r){const a=this.runMap.get(s),i=n[s];if(!(!a||!i)&&a.parent_run_id){const o=n[a.parent_run_id];o&&(o.child_runs.push(i),i.parent_run=o)}}return n[e]}static getTraceableRunTree(){try{return MI()}catch{return}}}const gy=Symbol.for("ls:tracing_async_local_storage"),Eu=Symbol.for("lc:context_variables"),SN=t=>{globalThis[gy]=t},$i=()=>globalThis[gy];let pi;function AN(){const t="default"in kr?kr.default:kr;return new t({autoStart:!0,concurrency:1})}function CN(){return typeof pi>"u"&&(pi=AN()),pi}async function wt(t,e){if(e===!0){const n=$i();n!==void 0?await n.run(void 0,async()=>t()):await t()}else pi=CN(),pi.add(async()=>{const n=$i();n!==void 0?await n.run(void 0,async()=>t()):await t()})}const vN=t=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(n=>gn(n)==="true");function by(t){var r;const e=$i();if(e===void 0)return;const n=e.getStore();return(r=n==null?void 0:n[Eu])==null?void 0:r[t]}const ON=Symbol("lc:configure_hooks"),kN=()=>by(ON)||[];function _y(t){return t?Array.isArray(t)||"name"in t?{callbacks:t}:t:{}}class IN{setHandler(e){return this.setHandlers([e])}}class Vc{constructor(e,n,r,s,a,i,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(n=>wt(async()=>{var r;try{await((r=n.handleText)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleText: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}async handleCustomEvent(e,n,r,s,a){await Promise.all(this.handlers.map(i=>wt(async()=>{var o;try{await((o=i.handleCustomEvent)==null?void 0:o.call(i,e,n,this.runId,this.tags,this.metadata))}catch(u){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${u}`),i.raiseError)throw u}},i.awaitHandlers)))}}class NN extends Vc{getChild(e){const n=new Ut(this.runId);return n.setHandlers(this.inheritableHandlers),n.addTags(this.inheritableTags),n.addMetadata(this.inheritableMetadata),e&&n.addTags([e],!1),n}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(n=>wt(async()=>{var r;if(!n.ignoreRetriever)try{await((r=n.handleRetrieverEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleRetriever`),n.raiseError)throw s}},n.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(n=>wt(async()=>{var r;if(!n.ignoreRetriever)try{await((r=n.handleRetrieverError)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleRetrieverError: ${s}`),n.raiseError)throw e}},n.awaitHandlers)))}}class tg extends Vc{async handleLLMNewToken(e,n,r,s,a,i){await Promise.all(this.handlers.map(o=>wt(async()=>{var u;if(!o.ignoreLLM)try{await((u=o.handleLLMNewToken)==null?void 0:u.call(o,e,n??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i))}catch(c){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${c}`),o.raiseError)throw c}},o.awaitHandlers)))}async handleLLMError(e,n,r,s,a){await Promise.all(this.handlers.map(i=>wt(async()=>{var o;if(!i.ignoreLLM)try{await((o=i.handleLLMError)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMError: ${u}`),i.raiseError)throw u}},i.awaitHandlers)))}async handleLLMEnd(e,n,r,s,a){await Promise.all(this.handlers.map(i=>wt(async()=>{var o;if(!i.ignoreLLM)try{await((o=i.handleLLMEnd)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMEnd: ${u}`),i.raiseError)throw u}},i.awaitHandlers)))}}class RN extends Vc{getChild(e){const n=new Ut(this.runId);return n.setHandlers(this.inheritableHandlers),n.addTags(this.inheritableTags),n.addMetadata(this.inheritableMetadata),e&&n.addTags([e],!1),n}async handleChainError(e,n,r,s,a){await Promise.all(this.handlers.map(i=>wt(async()=>{var o;if(!i.ignoreChain)try{await((o=i.handleChainError)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainError: ${u}`),i.raiseError)throw u}},i.awaitHandlers)))}async handleChainEnd(e,n,r,s,a){await Promise.all(this.handlers.map(i=>wt(async()=>{var o;if(!i.ignoreChain)try{await((o=i.handleChainEnd)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainEnd: ${u}`),i.raiseError)throw u}},i.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(n=>wt(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleAgentAction)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleAgentAction: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(n=>wt(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleAgentEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleAgentEnd: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}}class PN extends Vc{getChild(e){const n=new Ut(this.runId);return n.setHandlers(this.inheritableHandlers),n.addTags(this.inheritableTags),n.addMetadata(this.inheritableMetadata),e&&n.addTags([e],!1),n}async handleToolError(e){await Promise.all(this.handlers.map(n=>wt(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleToolError)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleToolError: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(n=>wt(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleToolEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleToolEnd: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}}class Ut extends IN{constructor(e,n){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(n==null?void 0:n.handlers)??this.handlers,this.inheritableHandlers=(n==null?void 0:n.inheritableHandlers)??this.inheritableHandlers,this.tags=(n==null?void 0:n.tags)??this.tags,this.inheritableTags=(n==null?void 0:n.inheritableTags)??this.inheritableTags,this.metadata=(n==null?void 0:n.metadata)??this.metadata,this.inheritableMetadata=(n==null?void 0:n.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,n,r=void 0,s=void 0,a=void 0,i=void 0,o=void 0,u=void 0){return Promise.all(n.map(async(c,l)=>{const d=l===0&&r?r:Qt();return await Promise.all(this.handlers.map(m=>{if(!m.ignoreLLM)return Ua(m)&&m._createRunForLLMStart(e,[c],d,this._parentRunId,a,this.tags,this.metadata,u),wt(async()=>{var p;try{await((p=m.handleLLMStart)==null?void 0:p.call(m,e,[c],d,this._parentRunId,a,this.tags,this.metadata,u))}catch(h){if((m.raiseError?console.error:console.warn)(`Error in handler ${m.constructor.name}, handleLLMStart: ${h}`),m.raiseError)throw h}},m.awaitHandlers)})),new tg(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,n,r=void 0,s=void 0,a=void 0,i=void 0,o=void 0,u=void 0){return Promise.all(n.map(async(c,l)=>{const d=l===0&&r?r:Qt();return await Promise.all(this.handlers.map(m=>{if(!m.ignoreLLM)return Ua(m)&&m._createRunForChatModelStart(e,[c],d,this._parentRunId,a,this.tags,this.metadata,u),wt(async()=>{var p,h;try{if(m.handleChatModelStart)await((p=m.handleChatModelStart)==null?void 0:p.call(m,e,[c],d,this._parentRunId,a,this.tags,this.metadata,u));else if(m.handleLLMStart){const g=py(c);await((h=m.handleLLMStart)==null?void 0:h.call(m,e,[g],d,this._parentRunId,a,this.tags,this.metadata,u))}}catch(g){if((m.raiseError?console.error:console.warn)(`Error in handler ${m.constructor.name}, handleLLMStart: ${g}`),m.raiseError)throw g}},m.awaitHandlers)})),new tg(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,n,r=Qt(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreChain)return Ua(u)&&u._createRunForChainStart(e,n,r,this._parentRunId,this.tags,this.metadata,s,o),wt(async()=>{var c;try{await((c=u.handleChainStart)==null?void 0:c.call(u,e,n,r,this._parentRunId,this.tags,this.metadata,s,o))}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new RN(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,n,r=Qt(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return Ua(u)&&u._createRunForToolStart(e,n,r,this._parentRunId,this.tags,this.metadata,o),wt(async()=>{var c;try{await((c=u.handleToolStart)==null?void 0:c.call(u,e,n,r,this._parentRunId,this.tags,this.metadata,o))}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new PN(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,n,r=Qt(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return Ua(u)&&u._createRunForRetrieverStart(e,n,r,this._parentRunId,this.tags,this.metadata,o),wt(async()=>{var c;try{await((c=u.handleRetrieverStart)==null?void 0:c.call(u,e,n,r,this._parentRunId,this.tags,this.metadata,o))}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new NN(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,n,r,s,a){await Promise.all(this.handlers.map(i=>wt(async()=>{var o;if(!i.ignoreCustomEvent)try{await((o=i.handleCustomEvent)==null?void 0:o.call(i,e,n,r,this.tags,this.metadata))}catch(u){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${u}`),i.raiseError)throw u}},i.awaitHandlers)))}addHandler(e,n=!0){this.handlers.push(e),n&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(n=>n!==e),this.inheritableHandlers=this.inheritableHandlers.filter(n=>n!==e)}setHandlers(e,n=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,n)}addTags(e,n=!0){this.removeTags(e),this.tags.push(...e),n&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(n=>!e.includes(n)),this.inheritableTags=this.inheritableTags.filter(n=>!e.includes(n))}addMetadata(e,n=!0){this.metadata={...this.metadata,...e},n&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const n of Object.keys(e))delete this.metadata[n],delete this.inheritableMetadata[n]}copy(e=[],n=!0){const r=new Ut(this._parentRunId);for(const s of this.handlers){const a=this.inheritableHandlers.includes(s);r.addHandler(s,a)}for(const s of this.tags){const a=this.inheritableTags.includes(s);r.addTags([s],a)}for(const s of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(s);r.addMetadata({[s]:this.metadata[s]},a)}for(const s of e)r.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===s.name)||r.addHandler(s,n);return r}static fromHandlers(e){class n extends co{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Qt()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new n),r}static configure(e,n,r,s,a,i,o){return this._configureSync(e,n,r,s,a,i,o)}static _configureSync(e,n,r,s,a,i,o){var m,p;let u;(e||n)&&(Array.isArray(e)||!e?(u=new Ut,u.setHandlers((e==null?void 0:e.map(Zu))??[],!0)):u=e,u=u.copy(Array.isArray(n)?n.map(Zu):n==null?void 0:n.handlers,!1));const c=gn("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),l=((m=mi.getTraceableRunTree())==null?void 0:m.tracingEnabled)||vN(),d=l||(gn("LANGCHAIN_TRACING")??!1);if(c||d){if(u||(u=new Ut),c&&!u.handlers.some(h=>h.name===Xp.prototype.name)){const h=new Xp;u.addHandler(h,!0)}if(d&&!u.handlers.some(h=>h.name==="langchain_tracer")&&l){const h=new mi;u.addHandler(h,!0),u._parentRunId=((p=mi.getTraceableRunTree())==null?void 0:p.id)??u._parentRunId}}for(const{contextVar:h,inheritable:g=!0,handlerClass:b,envVar:_}of kN()){const y=_&&gn(_)==="true"&&b;let E;const I=h!==void 0?by(h):void 0;I&&uN(I)?E=I:y&&(E=new b({})),E!==void 0&&(u||(u=new Ut),u.handlers.some(w=>w.name===E.name)||u.addHandler(E,g))}return(r||s)&&u&&(u.addTags(r??[]),u.addTags(s??[],!1)),(a||i)&&u&&(u.addMetadata(a??{}),u.addMetadata(i??{},!1)),u}}function Zu(t){return"name"in t?t:co.fromMethods(t)}class xN{getStore(){}run(e,n){return n()}enterWith(e){}}const LN=new xN,ng=Symbol.for("lc:child_config");class DN{getInstance(){return $i()??LN}getRunnableConfig(){var n,r;return(r=(n=this.getInstance().getStore())==null?void 0:n.extra)==null?void 0:r[ng]}runWithConfig(e,n,r){var l;const s=Ut._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),a=this.getInstance(),i=a.getStore(),o=s==null?void 0:s.getParentRunId(),u=(l=s==null?void 0:s.handlers)==null?void 0:l.find(d=>(d==null?void 0:d.name)==="langchain_tracer");let c;return u&&o?c=u.convertToRunTree(o):r||(c=new ln({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[ng]:e}),i!==void 0&&i[Eu]!==void 0&&(c[Eu]=i[Eu]),a.run(c,n)}initializeGlobalInstance(e){$i()===void 0&&SN(e)}}const Zr=new DN,zl=25;async function $n(t){return Ut._configureSync(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata)}function rg(...t){const e={};for(const n of t.filter(r=>!!r))for(const r of Object.keys(n))if(r==="metadata")e[r]={...e[r],...n[r]};else if(r==="tags"){const s=e[r]??[];e[r]=[...new Set(s.concat(n[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...n[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=n.timeout:n.timeout!==void 0&&(e.timeout=Math.min(e.timeout,n.timeout));else if(r==="signal")e.signal===void 0?e.signal=n.signal:n.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,n.signal]):e.signal=n.signal);else if(r==="callbacks"){const s=e.callbacks,a=n.callbacks;if(Array.isArray(a))if(!s)e.callbacks=a;else if(Array.isArray(s))e.callbacks=s.concat(a);else{const i=s.copy();for(const o of a)i.addHandler(Zu(o),!0);e.callbacks=i}else if(a)if(!s)e.callbacks=a;else if(Array.isArray(s)){const i=a.copy();for(const o of s)i.addHandler(Zu(o),!0);e.callbacks=i}else e.callbacks=new Ut(a._parentRunId,{handlers:s.handlers.concat(a.handlers),inheritableHandlers:s.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(a.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(a.inheritableTags))),metadata:{...s.metadata,...a.metadata}})}else{const s=r;e[s]=n[s]??e[s]}return e}const MN=new Set(["string","number","boolean"]);function $e(t){var r;const e=Zr.getRunnableConfig();let n={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:s,runName:a,...i}=e;n=Object.entries(i).reduce((o,[u,c])=>(c!==void 0&&(o[u]=c),o),n)}if(t&&(n=Object.entries(t).reduce((s,[a,i])=>(i!==void 0&&(s[a]=i),s),n)),n!=null&&n.configurable)for(const s of Object.keys(n.configurable))MN.has(typeof n.configurable[s])&&!((r=n.metadata)!=null&&r[s])&&(n.metadata||(n.metadata={}),n.metadata[s]=n.configurable[s]);if(n.timeout!==void 0){if(n.timeout<=0)throw new Error("Timeout must be a positive number");const s=AbortSignal.timeout(n.timeout);n.signal!==void 0?"any"in AbortSignal&&(n.signal=AbortSignal.any([n.signal,s])):n.signal=s,delete n.timeout}return n}function Bt(t={},{callbacks:e,maxConcurrency:n,recursionLimit:r,runName:s,configurable:a,runId:i}={}){const o=$e(t);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),n!==void 0&&(o.maxConcurrency=n),s!==void 0&&(o.runName=s),a!==void 0&&(o.configurable={...o.configurable,...a}),i!==void 0&&delete o.runId,o}function fa(t){return t?{configurable:t.configurable,recursionLimit:t.recursionLimit,callbacks:t.callbacks,tags:t.tags,metadata:t.metadata,maxConcurrency:t.maxConcurrency,timeout:t.timeout,signal:t.signal}:void 0}async function Jr(t,e){if(e===void 0)return t;let n;return Promise.race([t.catch(r=>{if(!(e!=null&&e.aborted))throw r}),new Promise((r,s)=>{n=()=>{s(new Error("Aborted"))},e.addEventListener("abort",n),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",n))}class _n extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const n=this.reader.cancel();this.reader.releaseLock(),await n}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const n=e.getReader();return new _n({start(r){return s();function s(){return n.read().then(({done:a,value:i})=>{if(a){r.close();return}return r.enqueue(i),s()})}},cancel(){n.releaseLock()}})}static fromAsyncGenerator(e){return new _n({async pull(n){const{value:r,done:s}=await e.next();s&&n.close(),n.enqueue(r)},async cancel(n){await e.return(n)}})}}function yy(t,e=2){const n=Array.from({length:e},()=>[]);return n.map(async function*(s){for(;;)if(s.length===0){const a=await t.next();for(const i of n)i.push(a)}else{if(s[0].done)return;yield s.shift().value}})}function qn(t,e){if(Array.isArray(t)&&Array.isArray(e))return t.concat(e);if(typeof t=="string"&&typeof e=="string")return t+e;if(typeof t=="number"&&typeof e=="number")return t+e;if("concat"in t&&typeof t.concat=="function")return t.concat(e);if(typeof t=="object"&&typeof e=="object"){const n={...t};for(const[r,s]of Object.entries(e))r in n&&!Array.isArray(n[r])?n[r]=qn(n[r],s):n[r]=s;return n}else throw new Error(`Cannot concat ${typeof t} and ${typeof e}`)}class Ca{constructor(e){var n;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((n=this.config)==null?void 0:n.signal),this.setup=new Promise((r,s)=>{Zr.runWithConfig(fa(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(r,s):this.firstResult.then(a=>r(void 0),s)},!0)})}async next(...e){var n;return(n=this.signal)==null||n.throwIfAborted(),this.firstResultUsed?Zr.runWithConfig(fa(this.config),this.signal?async()=>Jr(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function BN(t,e,n,r,...s){const a=new Ca({generator:e,startSetup:n,signal:r}),i=await a.setup;return{output:t(a,i,...s),setup:i}}class jr{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const n=this.ops.concat(e.ops),r=Ku({},n);return new qi({ops:n,state:r[r.length-1].newDocument})}}class qi extends jr{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const n=this.ops.concat(e.ops),r=Ku(this.state,e.ops);return new qi({ops:n,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const n=Ku({},e.ops);return new qi({ops:e.ops,state:n[n.length-1].newDocument})}}const FN=t=>t.name==="log_stream_tracer";async function sg(t,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:n}=t;if(["retriever","llm","prompt"].includes(t.run_type))return n;if(!(Object.keys(n).length===1&&(n==null?void 0:n.input)===""))return n.input}async function ag(t,e){const{outputs:n}=t;return e==="original"||["retriever","llm","prompt"].includes(t.run_type)?n:n!==void 0&&Object.keys(n).length===1&&(n==null?void 0:n.output)!==void 0?n.output:n}function UN(t){return t!==void 0&&t.message!==void 0}class ig extends lo{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=_n.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const n=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||n.find(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&n.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),r}async*tapOutputIterable(e,n){for await(const r of n){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new jr({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new jr({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const n=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=n===1?e.name:`${e.name}:${n}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await sg(e,this._schemaFormat)),await this.writer.write(new jr({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const n=this.keyMapByRunId[e.id];if(n===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${n}/inputs`,value:await sg(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${n}/final_output`,value:await ag(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${n}/end_time`,value:new Date(e.end_time).toISOString()});const s=new jr({ops:r});await this.writer.write(s)}finally{if(e.id===this.rootId){const n=new jr({ops:[{op:"replace",path:"/final_output",value:await ag(e,this._schemaFormat)}]});await this.writer.write(n),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,n,r){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const a=e.inputs.messages!==void 0;let i;a?UN(r==null?void 0:r.chunk)?i=r==null?void 0:r.chunk:i=new en({id:`run-${e.id}`,content:n}):i=n;const o=new jr({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:n},{op:"add",path:`/logs/${s}/streamed_output/-`,value:i}]});await this.writer.write(o)}}const og="__run";class ma{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new ma({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class Cs extends ma{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new Cs({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function $o({name:t,serialized:e}){return t!==void 0?t:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const jN=t=>t.name==="event_stream_tracer";class HN extends lo{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=_n.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const n=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||n.find(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&n.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),r}async*tapOutputIterable(e,n){const r=await n.next();if(r.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield r.value;return}function a(o,u){return o==="llm"&&typeof u=="string"?new ma({text:u}):u}let i=this.tappedPromises.get(e);if(i===void 0){let o;i=new Promise(u=>{o=u}),this.tappedPromises.set(e,i);try{const u={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...u,data:{chunk:a(s.runType,r.value)}},s),yield r.value;for await(const c of n)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...u,data:{chunk:a(s.runType,c)}},s),yield c}finally{o()}}else{yield r.value;for await(const o of n)yield o}}async send(e,n){this._includeRun(n)&&await this.writer.write(e)}async sendEndEvent(e,n){const r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,n)}):await this.send(e,n)}async onLLMStart(e){var i,o;const n=$o(e),r=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:n,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,s);const a=`on_${r}_start`;await this.send({event:a,data:{input:e.inputs},name:n,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,n,r){const s=this.runInfoMap.get(e.id);let a,i;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")i="on_chat_model_stream",(r==null?void 0:r.chunk)===void 0?a=new en({content:n,id:`run-${e.id}`}):a=r.chunk.message;else if(s.runType==="llm")i="on_llm_stream",(r==null?void 0:r.chunk)===void 0?a=new ma({text:n}):a=r.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:i,data:{chunk:a},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){var i,o,u;const n=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(n===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(i=e.outputs)==null?void 0:i.generations;let a;if(n.runType==="chat_model"){for(const c of s??[]){if(a!==void 0)break;a=(o=c[0])==null?void 0:o.message}r="on_chat_model_end"}else if(n.runType==="llm")a={generations:s==null?void 0:s.map(c=>c.map(l=>({text:l.text,generationInfo:l.generationInfo}))),llmOutput:((u=e.outputs)==null?void 0:u.llmOutput)??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${n.runType}`);await this.sendEndEvent({event:r,data:{output:a,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async onChainStart(e){var i,o;const n=$o(e),r=e.run_type??"chain",s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:n,runType:e.run_type};let a={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(a={},s.inputs={}):e.inputs.input!==void 0?(a.input=e.inputs.input,s.inputs=e.inputs.input):(a.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${r}_start`,data:a,name:n,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),n===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,s=e.inputs??n.inputs??{},i={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(i.input=s.input,n.inputs=s.input),await this.sendEndEvent({event:r,data:i,run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata??{}},n)}async onToolStart(e){var s,a;const n=$o(e),r={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:n,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:n,run_id:e.id,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{}},r)}async onToolEnd(e){var s;const n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),n===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(n.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async onRetrieverStart(e){var a,i;const n=$o(e),s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:n,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:n,tags:e.tags??[],run_id:e.id,metadata:((i=e.extra)==null?void 0:i.metadata)??{}},s)}async onRetrieverEnd(e){var r;const n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),n===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((r=e.outputs)==null?void 0:r.documents)??e.outputs,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async handleCustomEvent(e,n,r){const s=this.runInfoMap.get(r);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:s.tags,metadata:s.metadata,data:n},s)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const $N=[400,401,402,403,404,405,406,407,409],qN=t=>{var n,r;if(t.message.startsWith("Cancel")||t.message.startsWith("AbortError")||t.name==="AbortError"||(t==null?void 0:t.code)==="ECONNABORTED")throw t;const e=((n=t==null?void 0:t.response)==null?void 0:n.status)??(t==null?void 0:t.status);if(e&&$N.includes(+e))throw t;if(((r=t==null?void 0:t.error)==null?void 0:r.code)==="insufficient_quota"){const s=new Error(t==null?void 0:t.message);throw s.name="InsufficientQuotaError",s}};class If{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??qN;const n="default"in kr?kr.default:kr;this.queue=new n({concurrency:this.maxConcurrency})}call(e,...n){return this.queue.add(()=>zu(()=>e(...n).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,n,...r){return e.signal?Promise.race([this.call(n,...r),new Promise((s,a)=>{var i;(i=e.signal)==null||i.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(n,...r)}fetch(...e){return this.call(()=>fetch(...e).then(n=>n.ok?n:Promise.reject(n)))}}class Ey extends lo{constructor({config:e,onStart:n,onEnd:r,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=n,this.argOnEnd=r,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function Nf(t){return t?t.lc_runnable:!1}class VN{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,n){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const s=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(n)),this.includeTags!==void 0&&(r=r||s.some(a=>{var i;return(i=this.includeTags)==null?void 0:i.includes(a)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(n)),this.excludeTags!==void 0&&(r=r&&s.every(a=>{var i;return!((i=this.excludeTags)!=null&&i.includes(a))})),r}}const zN=Symbol("Let zodToJsonSchema decide on which parser to use"),WN={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},GN=t=>({...WN,...t}),KN=t=>{const e=GN(t),n=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function wy(t,e,n,r){r!=null&&r.errorMessages&&n&&(t.errorMessage={...t.errorMessage,[e]:n})}function Je(t,e,n,r,s){t[e]=n,wy(t,e,r,s)}function YN(){return{}}function ZN(t,e){var r,s,a;const n={type:"array"};return(r=t.type)!=null&&r._def&&((a=(s=t.type)==null?void 0:s._def)==null?void 0:a.typeName)!==z.ZodAny&&(n.items=ze(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&Je(n,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&Je(n,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(Je(n,"minItems",t.exactLength.value,t.exactLength.message,e),Je(n,"maxItems",t.exactLength.value,t.exactLength.message,e)),n}function JN(t,e){const n={type:"integer",format:"int64"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Je(n,"minimum",r.value,r.message,e):Je(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),Je(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Je(n,"maximum",r.value,r.message,e):Je(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),Je(n,"maximum",r.value,r.message,e));break;case"multipleOf":Je(n,"multipleOf",r.value,r.message,e);break}return n}function XN(){return{type:"boolean"}}function Ty(t,e){return ze(t.type._def,e)}const QN=(t,e)=>ze(t.innerType._def,e);function Sy(t,e,n){const r=n??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,a)=>Sy(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return eR(t,e)}}const eR=(t,e)=>{const n={type:"integer",format:"unix-time"};if(e.target==="openApi3")return n;for(const r of t.checks)switch(r.kind){case"min":Je(n,"minimum",r.value,r.message,e);break;case"max":Je(n,"maximum",r.value,r.message,e);break}return n};function tR(t,e){return{...ze(t.innerType._def,e),default:t.defaultValue()}}function nR(t,e){return e.effectStrategy==="input"?ze(t.schema._def,e):{}}function rR(t){return{type:"string",enum:Array.from(t.values)}}const sR=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function aR(t,e){const n=[ze(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),ze(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return n.forEach(a=>{if(sR(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...u}=a;i=u}else r=void 0;s.push(i)}}),s.length?{allOf:s,...r}:void 0}function iR(t,e){const n=typeof t.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[t.value]}:{type:n==="bigint"?"integer":n,const:t.value}}let Wl;const Nn={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Wl===void 0&&(Wl=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Wl),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Ay(t,e){const n={type:"string"};if(t.checks)for(const r of t.checks)switch(r.kind){case"min":Je(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,e);break;case"max":Je(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Rn(n,"email",r.message,e);break;case"format:idn-email":Rn(n,"idn-email",r.message,e);break;case"pattern:zod":qt(n,Nn.email,r.message,e);break}break;case"url":Rn(n,"uri",r.message,e);break;case"uuid":Rn(n,"uuid",r.message,e);break;case"regex":qt(n,r.regex,r.message,e);break;case"cuid":qt(n,Nn.cuid,r.message,e);break;case"cuid2":qt(n,Nn.cuid2,r.message,e);break;case"startsWith":qt(n,RegExp(`^${Gl(r.value,e)}`),r.message,e);break;case"endsWith":qt(n,RegExp(`${Gl(r.value,e)}$`),r.message,e);break;case"datetime":Rn(n,"date-time",r.message,e);break;case"date":Rn(n,"date",r.message,e);break;case"time":Rn(n,"time",r.message,e);break;case"duration":Rn(n,"duration",r.message,e);break;case"length":Je(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,e),Je(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,e);break;case"includes":{qt(n,RegExp(Gl(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&Rn(n,"ipv4",r.message,e),r.version!=="v4"&&Rn(n,"ipv6",r.message,e);break}case"base64url":qt(n,Nn.base64url,r.message,e);break;case"jwt":qt(n,Nn.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&qt(n,Nn.ipv4Cidr,r.message,e),r.version!=="v4"&&qt(n,Nn.ipv6Cidr,r.message,e);break}case"emoji":qt(n,Nn.emoji(),r.message,e);break;case"ulid":{qt(n,Nn.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Rn(n,"binary",r.message,e);break}case"contentEncoding:base64":{Je(n,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{qt(n,Nn.base64,r.message,e);break}}break}case"nanoid":qt(n,Nn.nanoid,r.message,e)}return n}function Gl(t,e){return e.patternStrategy==="escape"?uR(t):t}const oR=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function uR(t){let e="";for(let n=0;n<t.length;n++)oR.has(t[n])||(e+="\\"),e+=t[n];return e}function Rn(t,e,n,r){var s;t.format||(s=t.anyOf)!=null&&s.some(a=>a.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&r.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Je(t,"format",e,n,r)}function qt(t,e,n,r){var s;t.pattern||(s=t.allOf)!=null&&s.some(a=>a.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&r.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:ug(e,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Je(t,"pattern",ug(e,r),n,r)}function ug(t,e){var u;if(!e.applyRegexFlags||!t.flags)return t.source;const n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=n.i?t.source.toLowerCase():t.source;let s="",a=!1,i=!1,o=!1;for(let c=0;c<r.length;c++){if(a){s+=r[c],a=!1;continue}if(n.i){if(i){if(r[c].match(/[a-z]/)){o?(s+=r[c],s+=`${r[c-2]}-${r[c]}`.toUpperCase(),o=!1):r[c+1]==="-"&&((u=r[c+2])!=null&&u.match(/[a-z]/))?(s+=r[c],o=!0):s+=`${r[c]}${r[c].toUpperCase()}`;continue}}else if(r[c].match(/[a-z]/)){s+=`[${r[c]}${r[c].toUpperCase()}]`;continue}}if(n.m){if(r[c]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[c]==="$"){s+=`($|(?=[\r
]))`;continue}}if(n.s&&r[c]==="."){s+=i?`${r[c]}\r
`:`[${r[c]}\r
]`;continue}s+=r[c],r[c]==="\\"?a=!0:i&&r[c]==="]"?i=!1:!i&&r[c]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s}function Cy(t,e){var r,s,a,i,o,u;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=t.keyType)==null?void 0:r._def.typeName)===z.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((c,l)=>({...c,[l]:ze(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const n={type:"object",additionalProperties:ze(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return n;if(((s=t.keyType)==null?void 0:s._def.typeName)===z.ZodString&&((a=t.keyType._def.checks)!=null&&a.length)){const{type:c,...l}=Ay(t.keyType._def,e);return{...n,propertyNames:l}}else{if(((i=t.keyType)==null?void 0:i._def.typeName)===z.ZodEnum)return{...n,propertyNames:{enum:t.keyType._def.values}};if(((o=t.keyType)==null?void 0:o._def.typeName)===z.ZodBranded&&t.keyType._def.type._def.typeName===z.ZodString&&((u=t.keyType._def.type._def.checks)!=null&&u.length)){const{type:c,...l}=Ty(t.keyType._def,e);return{...n,propertyNames:l}}}return n}function cR(t,e){if(e.mapStrategy==="record")return Cy(t,e);const n=ze(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=ze(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function lR(t){const e=t.values,r=Object.keys(t.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(r.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function dR(){return{not:{}}}function hR(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Ju={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function fR(t,e){if(e.target==="openApi3")return cg(t,e);const n=t.options instanceof Map?Array.from(t.options.values()):t.options;if(n.every(r=>r._def.typeName in Ju&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((s,a)=>{const i=Ju[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===n.length){const s=r.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:n.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,s)=>[...r,...s._def.values.filter(a=>!r.includes(a))],[])};return cg(t,e)}const cg=(t,e)=>{const n=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>ze(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function mR(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:Ju[t.innerType._def.typeName],nullable:!0}:{type:[Ju[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=ze(t.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=ze(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function pR(t,e){const n={type:"number"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"int":n.type="integer",wy(n,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Je(n,"minimum",r.value,r.message,e):Je(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),Je(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Je(n,"maximum",r.value,r.message,e):Je(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),Je(n,"maximum",r.value,r.message,e));break;case"multipleOf":Je(n,"multipleOf",r.value,r.message,e);break}return n}function gR(t,e){return e.removeAdditionalStrategy==="strict"?t.catchall._def.typeName==="ZodNever"?t.unknownKeys!=="strict":ze(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:t.catchall._def.typeName==="ZodNever"?t.unknownKeys==="passthrough":ze(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function bR(t,e){const n=e.target==="openAi",r={type:"object",...Object.entries(t.shape()).reduce((s,[a,i])=>{if(i===void 0||i._def===void 0)return s;let o=i.isOptional();o&&n&&(i instanceof Hn&&(i=i._def.innerType),i.isNullable()||(i=i.nullable()),o=!1);const u=ze(i._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});return u===void 0?s:{properties:{...s.properties,[a]:u},required:o?s.required:[...s.required,a]}},{properties:{},required:[]}),additionalProperties:gR(t,e)};return r.required.length||delete r.required,r}const _R=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return ze(t.innerType._def,e);const n=ze(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}},yR=(t,e)=>{if(e.pipeStrategy==="input")return ze(t.in._def,e);if(e.pipeStrategy==="output")return ze(t.out._def,e);const n=ze(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=ze(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(s=>s!==void 0)}};function ER(t,e){return ze(t.type._def,e)}function wR(t,e){const r={type:"array",uniqueItems:!0,items:ze(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&Je(r,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&Je(r,"maxItems",t.maxSize.value,t.maxSize.message,e),r}function TR(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((n,r)=>ze(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:ze(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((n,r)=>ze(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function SR(){return{not:{}}}function AR(){return{}}const CR=(t,e)=>ze(t.innerType._def,e);function ze(t,e,n=!1){var i;const r=e.seen.get(t);if(e.override){const o=(i=e.override)==null?void 0:i.call(e,t,e,r,n);if(o!==zN)return o}if(r&&!n){const o=vR(r,e);if(o!==void 0)return o}const s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);const a=kR(t,t.typeName,e);return a&&IR(t,e,a),s.jsonSchema=a,a}const vR=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:OR(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((n,r)=>e.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},OR=(t,e)=>{let n=0;for(;n<t.length&&n<e.length&&t[n]===e[n];n++);return[(t.length-n).toString(),...e.slice(n)].join("/")},kR=(t,e,n)=>{switch(e){case z.ZodString:return Ay(t,n);case z.ZodNumber:return pR(t,n);case z.ZodObject:return bR(t,n);case z.ZodBigInt:return JN(t,n);case z.ZodBoolean:return XN();case z.ZodDate:return Sy(t,n);case z.ZodUndefined:return SR();case z.ZodNull:return hR(n);case z.ZodArray:return ZN(t,n);case z.ZodUnion:case z.ZodDiscriminatedUnion:return fR(t,n);case z.ZodIntersection:return aR(t,n);case z.ZodTuple:return TR(t,n);case z.ZodRecord:return Cy(t,n);case z.ZodLiteral:return iR(t,n);case z.ZodEnum:return rR(t);case z.ZodNativeEnum:return lR(t);case z.ZodNullable:return mR(t,n);case z.ZodOptional:return _R(t,n);case z.ZodMap:return cR(t,n);case z.ZodSet:return wR(t,n);case z.ZodLazy:return ze(t.getter()._def,n);case z.ZodPromise:return ER(t,n);case z.ZodNaN:case z.ZodNever:return dR();case z.ZodEffects:return nR(t,n);case z.ZodAny:return YN();case z.ZodUnknown:return AR();case z.ZodDefault:return tR(t,n);case z.ZodBranded:return Ty(t,n);case z.ZodReadonly:return CR(t,n);case z.ZodCatch:return QN(t,n);case z.ZodPipeline:return yR(t,n);case z.ZodFunction:case z.ZodVoid:case z.ZodSymbol:return;default:return(r=>{})()}},IR=(t,e,n)=>(t.description&&(n.description=t.description,e.markdownDescription&&(n.markdownDescription=t.description)),n),vs=(t,e)=>{const n=KN(e),r=void 0,s=e==null?void 0:e.name,a=ze(t._def,n,!1)??{},i=s===void 0?r?{...a,[n.definitionPath]:r}:a:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,s].join("/"),[n.definitionPath]:{...r,[s]:a}};return n.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(n.target==="jsonSchema2019-09"||n.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),n.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};function Kl(t){return t.replace(/[^a-zA-Z-_0-9]/g,"_")}const NR=["*","_","`"];function RR(t){let e="";for(const[n,r]of Object.entries(t))e+=`	classDef ${n} ${r};
`;return e}function PR(t,e,n){const{firstNode:r,lastNode:s,nodeColors:a,withStyles:i=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=n;let c=i?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(i){const p="default",h={[p]:"{0}({1})"};r!==void 0&&(h[r]="{0}([{1}]):::first"),s!==void 0&&(h[s]="{0}([{1}]):::last");for(const[g,b]of Object.entries(t)){const _=b.name.split(":").pop()??"";let E=NR.some(w=>_.startsWith(w)&&_.endsWith(w))?`<p>${_}</p>`:_;Object.keys(b.metadata??{}).length&&(E+=`<hr/><small><em>${Object.entries(b.metadata??{}).map(([w,R])=>`${w} = ${R}`).join(`
`)}</em></small>`);const I=(h[g]??h[p]).replace("{0}",Kl(g)).replace("{1}",E);c+=`	${I}
`}}const l={};for(const p of e){const h=p.source.split(":"),g=p.target.split(":"),b=h.filter((_,y)=>_===g[y]).join(":");l[b]||(l[b]=[]),l[b].push(p)}const d=new Set;function m(p,h){const g=p.length===1&&p[0].source===p[0].target;if(h&&!g){const b=h.split(":").pop();if(d.has(b))throw new Error(`Found duplicate subgraph '${b}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(b),c+=`	subgraph ${b}
`}for(const b of p){const{source:_,target:y,data:E,conditional:I}=b;let w="";if(E!==void 0){let R=E;const v=R.split(" ");v.length>u&&(R=Array.from({length:Math.ceil(v.length/u)},(j,F)=>v.slice(F*u,(F+1)*u).join(" ")).join("&nbsp;<br>&nbsp;")),w=I?` -. &nbsp;${R}&nbsp; .-> `:` -- &nbsp;${R}&nbsp; --> `}else w=I?" -.-> ":" --> ";c+=`	${Kl(_)}${w}${Kl(y)};
`}for(const b in l)b.startsWith(`${h}:`)&&b!==h&&m(l[b],b);h&&!g&&(c+=`	end
`)}m(l[""]??[],"");for(const p in l)!p.includes(":")&&p!==""&&m(l[p],p);return i&&(c+=RR(a??{})),c}async function xR(t,e){let{backgroundColor:n="white"}=e;const r=btoa(t);n!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(n)||(n=`!${n}`));const s=`https://mermaid.ink/img/${r}?bgColor=${n}`,a=await fetch(s);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}function LR(t,e){if(t!==void 0&&!hi(t))return t;if(Nf(e))try{let n=e.getName();return n=n.startsWith("Runnable")?n.slice(8):n,n}catch{return e.getName()}else return e.name??"UnknownSchema"}function DR(t){return Nf(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...vs(t.data.schema),title:t.data.name}}}class zc{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((n,r)=>{e[n.id]=hi(n.id)?r:n.id}),{nodes:Object.values(this.nodes).map(n=>({id:e[n.id],...DR(n)})),edges:this.edges.map(n=>{const r={source:e[n.source],target:e[n.target]};return typeof n.data<"u"&&(r.data=n.data),typeof n.conditional<"u"&&(r.conditional=n.conditional),r})}}addNode(e,n,r){if(n!==void 0&&this.nodes[n]!==void 0)throw new Error(`Node with id ${n} already exists`);const s=n??Qt(),a={id:s,data:e,name:LR(n,e),metadata:r};return this.nodes[s]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(n=>n.source!==e.id&&n.target!==e.id)}addEdge(e,n,r,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[n.id]===void 0)throw new Error(`Target node ${n.id} not in graph`);const a={source:e.id,target:n.id,data:r,conditional:s};return this.edges.push(a),a}firstNode(){return lg(this)}lastNode(){return dg(this)}extend(e,n=""){let r=n;Object.values(e.nodes).map(c=>c.id).every(hi)&&(r="");const a=c=>r?`${r}:${c}`:c;Object.entries(e.nodes).forEach(([c,l])=>{this.nodes[a(c)]={...l,id:a(c)}});const i=e.edges.map(c=>({...c,source:a(c.source),target:a(c.target)}));this.edges=[...this.edges,...i];const o=e.firstNode(),u=e.lastNode();return[o?{id:a(o.id),data:o.data}:void 0,u?{id:a(u.id),data:u.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&lg(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&dg(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),n=new Map;Object.values(e).forEach(s=>{n.set(s,(n.get(s)||0)+1)});const r=s=>{const a=e[s];return hi(s)&&n.get(a)===1?a:s};return new zc({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,a])=>[r(s),{...a,id:r(s)}])),edges:this.edges.map(s=>({...s,source:r(s.source),target:r(s.target)}))})}drawMermaid(e){const{withStyles:n,curveStyle:r,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:a}=e??{},i=this.reid(),o=i.firstNode(),u=i.lastNode();return PR(i.nodes,i.edges,{firstNode:o==null?void 0:o.id,lastNode:u==null?void 0:u.id,withStyles:n,curveStyle:r,nodeColors:s,wrapLabelNWords:a})}async drawMermaidPng(e){const n=this.drawMermaid(e);return xR(n,{backgroundColor:e==null?void 0:e.backgroundColor})}}function lg(t,e=[]){const n=new Set(t.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),r=[];for(const s of Object.values(t.nodes))!e.includes(s.id)&&!n.has(s.id)&&r.push(s);return r.length===1?r[0]:void 0}function dg(t,e=[]){const n=new Set(t.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),r=[];for(const s of Object.values(t.nodes))!e.includes(s.id)&&!n.has(s.id)&&r.push(s);return r.length===1?r[0]:void 0}function MR(t){const e=new TextEncoder,n=new ReadableStream({async start(r){for await(const s of t)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return _n.fromReadableStream(n)}function hg(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.iterator]=="function"&&typeof t.next=="function"}const BR=t=>t!=null&&typeof t=="object"&&"next"in t&&typeof t.next=="function";function dh(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.asyncIterator]=="function"}function*fg(t,e){for(;;){const{value:n,done:r}=Zr.runWithConfig(fa(t),e.next.bind(e),!0);if(r)break;yield n}}async function*hh(t,e){const n=e[Symbol.asyncIterator]();for(;;){const{value:r,done:s}=await Zr.runWithConfig(fa(t),n.next.bind(e),!0);if(s)break;yield r}}function It(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}class gt extends Yr{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const n=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${n}${e}`:n}bind(e){return new bs({bound:this,kwargs:e,config:{}})}map(){return new Xu({bound:this})}withRetry(e){return new FR({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new bs({bound:this,config:e,kwargs:{}})}withFallbacks(e){const n=Array.isArray(e)?e:e.fallbacks;return new jR({runnable:this,fallbacks:n})}_getOptionsList(e,n=0){if(Array.isArray(e)&&e.length!==n)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${n} inputs`);if(Array.isArray(e))return e.map($e);if(n>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:n},(s,a)=>$e(a===0?e:r))}return Array.from({length:n},()=>$e(e))}async batch(e,n,r){var u;const s=this._getOptionsList(n??{},e.length),a=((u=s[0])==null?void 0:u.maxConcurrency)??(r==null?void 0:r.maxConcurrency),i=new If({maxConcurrency:a,onFailedAttempt:c=>{throw c}}),o=e.map((c,l)=>i.call(async()=>{try{return await this.invoke(c,s[l])}catch(d){if(r!=null&&r.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,n){yield this.invoke(e,n)}async stream(e,n){const r=$e(n),s=new Ca({generator:this._streamIterator(e,r),config:r});return await s.setup,_n.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let n;e===void 0?n=$e(e):n=$e({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[n,r]}async _callWithConfig(e,n,r){const s=$e(r),a=await $n(s),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),It(n,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{const u=e.call(this,n,s,i);o=await Jr(u,r==null?void 0:r.signal)}catch(u){throw await(i==null?void 0:i.handleChainError(u)),u}return await(i==null?void 0:i.handleChainEnd(It(o,"output"))),o}async _batchWithConfig(e,n,r,s){var c;const a=this._getOptionsList(r??{},n.length),i=await Promise.all(a.map($n)),o=await Promise.all(i.map(async(l,d)=>{const m=await(l==null?void 0:l.handleChainStart(this.toJSON(),It(n[d],"input"),a[d].runId,a[d].runType,void 0,void 0,a[d].runName??this.getName()));return delete a[d].runId,m}));let u;try{const l=e.call(this,n,a,o,s);u=await Jr(l,(c=a==null?void 0:a[0])==null?void 0:c.signal)}catch(l){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(l))),l}return await Promise.all(o.map(l=>l==null?void 0:l.handleChainEnd(It(u,"output")))),u}async*_transformStreamWithConfig(e,n,r){let s,a=!0,i,o=!0;const u=$e(r),c=await $n(u);async function*l(){for await(const m of e){if(a)if(s===void 0)s=m;else try{s=qn(s,m)}catch{s=void 0,a=!1}yield m}}let d;try{const m=await BN(n.bind(this),l(),async()=>c==null?void 0:c.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName()),r==null?void 0:r.signal,u);delete u.runId,d=m.setup;const p=d==null?void 0:d.handlers.find(jN);let h=m.output;p!==void 0&&d!==void 0&&(h=p.tapOutputIterable(d.runId,h));const g=d==null?void 0:d.handlers.find(FN);g!==void 0&&d!==void 0&&(h=g.tapOutputIterable(d.runId,h));for await(const b of h)if(yield b,o)if(i===void 0)i=b;else try{i=qn(i,b)}catch{i=void 0,o=!1}}catch(m){throw await(d==null?void 0:d.handleChainError(m,void 0,void 0,void 0,{inputs:It(s,"input")})),m}await(d==null?void 0:d.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:It(s,"input")}))}getGraph(e){const n=new zc,r=n.addNode({name:`${this.getName()}Input`,schema:Or.any()}),s=n.addNode(this),a=n.addNode({name:`${this.getName()}Output`,schema:Or.any()});return n.addEdge(r,s),n.addEdge(s,a),n}pipe(e){return new lr({first:this,last:ds(e)})}pick(e){return this.pipe(new HR(e))}assign(e){return this.pipe(new vy(new va({steps:e})))}async*transform(e,n){let r;for await(const s of e)r===void 0?r=s:r=qn(r,s);yield*this._streamIterator(r,$e(n))}async*streamLog(e,n,r){const s=new ig({...r,autoClose:!1,_schemaFormat:"original"}),a=$e(n);yield*this._streamLog(e,s,a)}async*_streamLog(e,n,r){const{callbacks:s}=r;if(s===void 0)r.callbacks=[n];else if(Array.isArray(s))r.callbacks=s.concat([n]);else{const u=s.copy();u.addHandler(n,!0),r.callbacks=u}const a=this.stream(e,r);async function i(){try{const u=await a;for await(const c of u){const l=new jr({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await n.writer.write(l)}}finally{await n.writer.close()}}const o=i();try{for await(const u of n)yield u}finally{await o}}streamEvents(e,n,r){let s;if(n.version==="v1")s=this._streamEventsV1(e,n,r);else if(n.version==="v2")s=this._streamEventsV2(e,n,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return n.encoding==="text/event-stream"?MR(s):_n.fromAsyncGenerator(s)}async*_streamEventsV2(e,n,r){var p;const s=new HN({...r,autoClose:!1}),a=$e(n),i=a.runId??Qt();a.runId=i;const o=a.callbacks;if(o===void 0)a.callbacks=[s];else if(Array.isArray(o))a.callbacks=o.concat(s);else{const h=o.copy();h.addHandler(s,!0),a.callbacks=h}const u=this;async function c(){try{const h=await u.stream(e,a),g=s.tapOutputIterable(i,h);for await(const b of g);}finally{await s.finish()}}const l=c();let d=!1,m;try{for await(const h of s){if(!d){h.data.input=e,d=!0,m=h.run_id,yield h;continue}h.run_id===m&&h.event.endsWith("_end")&&(p=h.data)!=null&&p.input&&delete h.data.input,yield h}}finally{await l}}async*_streamEventsV1(e,n,r){let s,a=!1;const i=$e(n),o=i.tags??[],u=i.metadata??{},c=i.runName??this.getName(),l=new ig({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new VN({...r}),m=this._streamLog(e,l,i);for await(const h of m){if(s?s=s.concat(h):s=qi.fromRunLogPatch(h),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const y={...s.state},E={run_id:y.id,event:`on_${y.type}_start`,name:c,tags:o,metadata:u,data:{input:e}};d.includeEvent(E,y.type)&&(yield E)}const g=h.ops.filter(y=>y.path.startsWith("/logs/")).map(y=>y.path.split("/")[2]),b=[...new Set(g)];for(const y of b){let E,I={};const w=s.state.logs[y];if(w.end_time===void 0?w.streamed_output.length>0?E="stream":E="start":E="end",E==="start")w.inputs!==void 0&&(I.input=w.inputs);else if(E==="end")w.inputs!==void 0&&(I.input=w.inputs),I.output=w.final_output;else if(E==="stream"){const R=w.streamed_output.length;if(R!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${R} instead. Encountered in: "${w.name}"`);I={chunk:w.streamed_output[0]},w.streamed_output=[]}yield{event:`on_${w.type}_${E}`,name:w.name,run_id:w.id,tags:w.tags,metadata:w.metadata,data:I}}const{state:_}=s;if(_.streamed_output.length>0){const y=_.streamed_output.length;if(y!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${y} instead. Encountered in: "${_.name}"`);const E={chunk:_.streamed_output[0]};_.streamed_output=[];const I={event:`on_${_.type}_stream`,run_id:_.id,tags:o,metadata:u,name:c,data:E};d.includeEvent(I,_.type)&&(yield I)}}const p=s==null?void 0:s.state;if(p!==void 0){const h={event:`on_${p.type}_end`,name:c,run_id:p.id,tags:o,metadata:u,data:{output:p.final_output}};d.includeEvent(h,p.type)&&(yield h)}}static isRunnable(e){return Nf(e)}withListeners({onStart:e,onEnd:n,onError:r}){return new bs({bound:this,config:{},configFactories:[s=>({callbacks:[new Ey({config:s,onStart:e,onEnd:n,onError:r})]})]})}asTool(e){return $R(this,e)}}class bs extends gt{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const n=rg(this.config,...e);return rg(n,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(n))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,n){return this.bound.invoke(e,await this._mergeConfig($e(n),this.kwargs))}async batch(e,n,r){const s=Array.isArray(n)?await Promise.all(n.map(async a=>this._mergeConfig($e(a),this.kwargs))):await this._mergeConfig($e(n),this.kwargs);return this.bound.batch(e,s,r)}async*_streamIterator(e,n){yield*this.bound._streamIterator(e,await this._mergeConfig($e(n),this.kwargs))}async stream(e,n){return this.bound.stream(e,await this._mergeConfig($e(n),this.kwargs))}async*transform(e,n){yield*this.bound.transform(e,await this._mergeConfig($e(n),this.kwargs))}streamEvents(e,n,r){const s=this,a=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig($e(n),s.kwargs),version:n.version},r)};return _n.fromAsyncGenerator(a())}static isRunnableBinding(e){return e.bound&&gt.isRunnable(e.bound)}withListeners({onStart:e,onEnd:n,onError:r}){return new bs({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new Ey({config:s,onStart:e,onEnd:n,onError:r})]})]})}}class Xu extends gt{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new Xu({bound:this.bound.bind(e)})}async invoke(e,n){return this._callWithConfig(this._invoke.bind(this),e,n)}async _invoke(e,n,r){return this.bound.batch(e,Bt(n,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:n,onError:r}){return new Xu({bound:this.bound.withListeners({onStart:e,onEnd:n,onError:r})})}}class FR extends bs{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,n,r){const s=e>1?`retry:attempt:${e}`:void 0;return Bt(n,{callbacks:r==null?void 0:r.getChild(s)})}async _invoke(e,n,r){return zu(s=>super.invoke(e,this._patchConfigForRetry(s,n,r)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,n){return this._callWithConfig(this._invoke.bind(this),e,n)}async _batch(e,n,r,s){const a={};try{await zu(async i=>{const o=e.map((m,p)=>p).filter(m=>a[m.toString()]===void 0||a[m.toString()]instanceof Error),u=o.map(m=>e[m]),c=o.map(m=>this._patchConfigForRetry(i,n==null?void 0:n[m],r==null?void 0:r[m])),l=await super.batch(u,c,{...s,returnExceptions:!0});let d;for(let m=0;m<l.length;m+=1){const p=l[m],h=o[m];p instanceof Error&&d===void 0&&(d=p,d.input=u[m]),a[h.toString()]=p}if(d)throw d;return l},{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if((s==null?void 0:s.returnExceptions)!==!0)throw i}return Object.keys(a).sort((i,o)=>parseInt(i,10)-parseInt(o,10)).map(i=>a[parseInt(i,10)])}async batch(e,n,r){return this._batchWithConfig(this._batch.bind(this),e,n,r)}}class lr extends gt{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,n){var u;const r=$e(n),s=await $n(r),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),It(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let i=e,o;try{const c=[this.first,...this.middle];for(let l=0;l<c.length;l+=1){const m=c[l].invoke(i,Bt(r,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${l+1}`)}));i=await Jr(m,n==null?void 0:n.signal)}if((u=n==null?void 0:n.signal)!=null&&u.aborted)throw new Error("Aborted");o=await this.last.invoke(i,Bt(r,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(c){throw await(a==null?void 0:a.handleChainError(c)),c}return await(a==null?void 0:a.handleChainEnd(It(o,"output"))),o}async batch(e,n,r){var u;const s=this._getOptionsList(n??{},e.length),a=await Promise.all(s.map($n)),i=await Promise.all(a.map(async(c,l)=>{const d=await(c==null?void 0:c.handleChainStart(this.toJSON(),It(e[l],"input"),s[l].runId,void 0,void 0,void 0,s[l].runName));return delete s[l].runId,d}));let o=e;try{for(let c=0;c<this.steps.length;c+=1){const d=this.steps[c].batch(o,i.map((m,p)=>{const h=m==null?void 0:m.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`);return Bt(s[p],{callbacks:h})}),r);o=await Jr(d,(u=s[0])==null?void 0:u.signal)}}catch(c){throw await Promise.all(i.map(l=>l==null?void 0:l.handleChainError(c))),c}return await Promise.all(i.map(c=>c==null?void 0:c.handleChainEnd(It(o,"output")))),o}async*_streamIterator(e,n){var d;const r=await $n(n),{runId:s,...a}=n??{},i=await(r==null?void 0:r.handleChainStart(this.toJSON(),It(e,"input"),s,void 0,void 0,void 0,a==null?void 0:a.runName)),o=[this.first,...this.middle,this.last];let u=!0,c;async function*l(){yield e}try{let m=o[0].transform(l(),Bt(a,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let p=1;p<o.length;p+=1)m=await o[p].transform(m,Bt(a,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${p+1}`)}));for await(const p of m)if((d=n==null?void 0:n.signal)==null||d.throwIfAborted(),yield p,u)if(c===void 0)c=p;else try{c=qn(c,p)}catch{c=void 0,u=!1}}catch(m){throw await(i==null?void 0:i.handleChainError(m)),m}await(i==null?void 0:i.handleChainEnd(It(c,"output")))}getGraph(e){const n=new zc;let r=null;return this.steps.forEach((s,a)=>{const i=s.getGraph(e);a!==0&&i.trimFirstNode(),a!==this.steps.length-1&&i.trimLastNode(),n.extend(i);const o=i.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);r&&n.addEdge(r,o),r=i.lastNode()}),n}pipe(e){return lr.isRunnableSequence(e)?new lr({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new lr({first:this.first,middle:[...this.middle,this.last],last:ds(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&gt.isRunnable(e)}static from([e,...n],r){let s={};return typeof r=="string"?s.name=r:r!==void 0&&(s=r),new lr({...s,first:ds(e),middle:n.slice(0,-1).map(ds),last:ds(n[n.length-1])})}}class va extends gt{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[n,r]of Object.entries(e.steps))this.steps[n]=ds(r)}static from(e){return new va({steps:e})}async invoke(e,n){const r=$e(n),s=await $n(r),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const i={};try{const o=Object.entries(this.steps).map(async([u,c])=>{i[u]=await c.invoke(e,Bt(r,{callbacks:a==null?void 0:a.getChild(`map:key:${u}`)}))});await Jr(Promise.all(o),n==null?void 0:n.signal)}catch(o){throw await(a==null?void 0:a.handleChainError(o)),o}return await(a==null?void 0:a.handleChainEnd(i)),i}async*_transform(e,n,r){const s={...this.steps},a=yy(e,Object.keys(s).length),i=new Map(Object.entries(s).map(([o,u],c)=>{const l=u.transform(a[c],Bt(r,{callbacks:n==null?void 0:n.getChild(`map:key:${o}`)}));return[o,l.next().then(d=>({key:o,gen:l,result:d}))]}));for(;i.size;){const o=Promise.race(i.values()),{key:u,result:c,gen:l}=await Jr(o,r==null?void 0:r.signal);i.delete(u),c.done||(yield{[u]:c.value},i.set(u,l.next().then(d=>({key:u,gen:l,result:d}))))}}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=$e(n),a=new Ca({generator:this.transform(r(),s),config:s});return await a.setup,_n.fromAsyncGenerator(a)}}class Rf extends gt{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!Sf(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,n){const[r]=this._getOptionsList(n??{},1),s=await $n(r),a=this.func(Bt(r,{callbacks:s}),e);return Jr(a,r==null?void 0:r.signal)}async*_streamIterator(e,n){var a,i;const[r]=this._getOptionsList(n??{},1),s=await this.invoke(e,n);if(dh(s)){for await(const o of s)(a=r==null?void 0:r.signal)==null||a.throwIfAborted(),yield o;return}if(BR(s)){for(;;){(i=r==null?void 0:r.signal)==null||i.throwIfAborted();const o=s.next();if(o.done)break;yield o.value}return}yield s}static from(e){return new Rf({func:e})}}function UR(t){if(Sf(t))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class mo extends gt{static lc_name(){return"RunnableLambda"}constructor(e){if(Sf(e.func))return Rf.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),UR(e.func),this.func=e.func}static from(e){return new mo({func:e})}async _invoke(e,n,r){return new Promise((s,a)=>{const i=Bt(n,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??zl)-1});Zr.runWithConfig(fa(i),async()=>{var o,u;try{let c=await this.func(e,{...i});if(c&&gt.isRunnable(c)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");c=await c.invoke(e,{...i,recursionLimit:(i.recursionLimit??zl)-1})}else if(dh(c)){let l;for await(const d of hh(i,c))if((o=n==null?void 0:n.signal)==null||o.throwIfAborted(),l===void 0)l=d;else try{l=qn(l,d)}catch{l=d}c=l}else if(hg(c)){let l;for(const d of fg(i,c))if((u=n==null?void 0:n.signal)==null||u.throwIfAborted(),l===void 0)l=d;else try{l=qn(l,d)}catch{l=d}c=l}s(c)}catch(c){a(c)}})})}async invoke(e,n){return this._callWithConfig(this._invoke.bind(this),e,n)}async*_transform(e,n,r){var o,u;let s;for await(const c of e)if(s===void 0)s=c;else try{s=qn(s,c)}catch{s=c}const a=Bt(r,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??zl)-1}),i=await new Promise((c,l)=>{Zr.runWithConfig(fa(a),async()=>{try{const d=await this.func(s,{...a,config:a});c(d)}catch(d){l(d)}})});if(i&&gt.isRunnable(i)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const c=await i.stream(s,a);for await(const l of c)yield l}else if(dh(i))for await(const c of hh(a,i))(o=r==null?void 0:r.signal)==null||o.throwIfAborted(),yield c;else if(hg(i))for(const c of fg(a,i))(u=r==null?void 0:r.signal)==null||u.throwIfAborted(),yield c;else yield i}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=$e(n),a=new Ca({generator:this.transform(r(),s),config:s});return await a.setup,_n.fromAsyncGenerator(a)}}class jR extends gt{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,n){const r=$e(n),s=await $n(r),{runId:a,...i}=r,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),It(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName)),u=Bt(i,{callbacks:o==null?void 0:o.getChild()});return await Zr.runWithConfig(u,async()=>{var d;let l;for(const m of this.runnables()){(d=r==null?void 0:r.signal)==null||d.throwIfAborted();try{const p=await m.invoke(e,u);return await(o==null?void 0:o.handleChainEnd(It(p,"output"))),p}catch(p){l===void 0&&(l=p)}}throw l===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(l)),l)})}async*_streamIterator(e,n){var d;const r=$e(n),s=await $n(r),{runId:a,...i}=r,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),It(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName));let u,c;for(const m of this.runnables()){(d=r==null?void 0:r.signal)==null||d.throwIfAborted();const p=Bt(i,{callbacks:o==null?void 0:o.getChild()});try{const h=await m.stream(e,p);c=hh(p,h);break}catch(h){u===void 0&&(u=h)}}if(c===void 0){const m=u??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(m)),m}let l;try{for await(const m of c){yield m;try{l=l===void 0?l:qn(l,m)}catch{l=void 0}}}catch(m){throw await(o==null?void 0:o.handleChainError(m)),m}await(o==null?void 0:o.handleChainEnd(It(l,"output")))}async batch(e,n,r){var u;if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(n??{},e.length),a=await Promise.all(s.map(c=>$n(c))),i=await Promise.all(a.map(async(c,l)=>{const d=await(c==null?void 0:c.handleChainStart(this.toJSON(),It(e[l],"input"),s[l].runId,void 0,void 0,void 0,s[l].runName));return delete s[l].runId,d}));let o;for(const c of this.runnables()){(u=s[0].signal)==null||u.throwIfAborted();try{const l=await c.batch(e,i.map((d,m)=>Bt(s[m],{callbacks:d==null?void 0:d.getChild()})),r);return await Promise.all(i.map((d,m)=>d==null?void 0:d.handleChainEnd(It(l[m],"output")))),l}catch(l){o===void 0&&(o=l)}}throw o?(await Promise.all(i.map(c=>c==null?void 0:c.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function ds(t){if(typeof t=="function")return new mo({func:t});if(gt.isRunnable(t))return t;if(!Array.isArray(t)&&typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))e[n]=ds(r);return new va({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class vy extends gt{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof va&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,n){const r=await this.mapper.invoke(e,n);return{...e,...r}}async*_transform(e,n,r){const s=this.mapper.getStepsKeys(),[a,i]=yy(e),o=this.mapper.transform(i,Bt(r,{callbacks:n==null?void 0:n.getChild()})),u=o.next();for await(const c of a){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);const l=Object.fromEntries(Object.entries(c).filter(([d])=>!s.includes(d)));Object.keys(l).length>0&&(yield l)}yield(await u).value;for await(const c of o)yield c}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=$e(n),a=new Ca({generator:this.transform(r(),s),config:s});return await a.setup,_n.fromAsyncGenerator(a)}}class HR extends gt{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const n=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return n.length===0?void 0:Object.fromEntries(n)}}async invoke(e,n){return this._callWithConfig(this._pick.bind(this),e,n)}async*_transform(e){for await(const n of e){const r=await this._pick(n);r!==void 0&&(yield r)}}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=$e(n),a=new Ca({generator:this.transform(r(),s),config:s});return await a.setup,_n.fromAsyncGenerator(a)}}class mg extends bs{constructor(e){const n=lr.from([mo.from(async r=>{let s;if(vf(r))try{s=await this.schema.parseAsync(r.args)}catch{throw new my("Received tool input did not match expected schema",JSON.stringify(r.args))}else s=r;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:n,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function $R(t,e){var s;const n=e.name??t.getName(),r=e.description??((s=e.schema)==null?void 0:s.description);return e.schema.constructor===Or.ZodString?new mg({name:n,description:r,schema:Or.object({input:Or.string()}).transform(a=>a.input),bound:t}):new mg({name:n,description:r,schema:e.schema,bound:t})}class qR extends gt{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","documents","transformers"]})}invoke(e,n){return this.transformDocuments(e)}}var Wc={};Wc.byteLength=WR;Wc.toByteArray=KR;Wc.fromByteArray=JR;var ir=[],An=[],VR=typeof Uint8Array<"u"?Uint8Array:Array,Yl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Fs=0,zR=Yl.length;Fs<zR;++Fs)ir[Fs]=Yl[Fs],An[Yl.charCodeAt(Fs)]=Fs;An[45]=62;An[95]=63;function Oy(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function WR(t){var e=Oy(t),n=e[0],r=e[1];return(n+r)*3/4-r}function GR(t,e,n){return(e+n)*3/4-n}function KR(t){var e,n=Oy(t),r=n[0],s=n[1],a=new VR(GR(t,r,s)),i=0,o=s>0?r-4:r,u;for(u=0;u<o;u+=4)e=An[t.charCodeAt(u)]<<18|An[t.charCodeAt(u+1)]<<12|An[t.charCodeAt(u+2)]<<6|An[t.charCodeAt(u+3)],a[i++]=e>>16&255,a[i++]=e>>8&255,a[i++]=e&255;return s===2&&(e=An[t.charCodeAt(u)]<<2|An[t.charCodeAt(u+1)]>>4,a[i++]=e&255),s===1&&(e=An[t.charCodeAt(u)]<<10|An[t.charCodeAt(u+1)]<<4|An[t.charCodeAt(u+2)]>>2,a[i++]=e>>8&255,a[i++]=e&255),a}function YR(t){return ir[t>>18&63]+ir[t>>12&63]+ir[t>>6&63]+ir[t&63]}function ZR(t,e,n){for(var r,s=[],a=e;a<n;a+=3)r=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(t[a+2]&255),s.push(YR(r));return s.join("")}function JR(t){for(var e,n=t.length,r=n%3,s=[],a=16383,i=0,o=n-r;i<o;i+=a)s.push(ZR(t,i,i+a>o?o:i+a));return r===1?(e=t[n-1],s.push(ir[e>>2]+ir[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],s.push(ir[e>>10]+ir[e>>4&63]+ir[e<<2&63]+"=")),s.join("")}var XR=Object.defineProperty,QR=(t,e,n)=>e in t?XR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,eP=(t,e,n)=>(QR(t,e+"",n),n);function tP(t,e){let n=Array.from({length:t.length},(r,s)=>({start:s,end:s+1}));for(;n.length>1;){let r=null;for(let s=0;s<n.length-1;s++){const a=t.slice(n[s].start,n[s+1].end),i=e.get(a.join(","));i!=null&&(r==null||i<r[0])&&(r=[i,s])}if(r!=null){const s=r[1];n[s]={start:n[s].start,end:n[s+1].end},n.splice(s+1,1)}else break}return n}function nP(t,e){return t.length===1?[e.get(t.join(","))]:tP(t,e).map(n=>e.get(t.slice(n.start,n.end).join(","))).filter(n=>n!=null)}function rP(t){return t.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var fh=class{constructor(t,e){Te(this,"specialTokens");Te(this,"inverseSpecialTokens");Te(this,"patStr");Te(this,"textEncoder",new TextEncoder);Te(this,"textDecoder",new TextDecoder("utf-8"));Te(this,"rankMap",new Map);Te(this,"textMap",new Map);this.patStr=t.pat_str;const n=t.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{const[a,i,...o]=s.split(" "),u=Number.parseInt(i,10);return o.forEach((c,l)=>r[c]=u+l),r},{});for(const[r,s]of Object.entries(n)){const a=Wc.toByteArray(r);this.rankMap.set(a.join(","),s),this.textMap.set(s,a)}this.specialTokens={...t.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,a])=>(r[a]=this.textEncoder.encode(s),r),{})}encode(t,e=[],n="all"){const r=new RegExp(this.patStr,"ug"),s=fh.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(n==="all"?Object.keys(this.specialTokens).filter(c=>!i.has(c)):n);if(o.size>0){const c=fh.specialTokenRegex([...o]),l=t.match(c);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let u=0;for(;;){let c=null,l=u;for(;s.lastIndex=l,c=s.exec(t),!(c==null||i.has(c[0]));)l=c.index+1;const d=(c==null?void 0:c.index)??t.length;for(const p of t.substring(u,d).matchAll(r)){const h=this.textEncoder.encode(p[0]),g=this.rankMap.get(h.join(","));if(g!=null){a.push(g);continue}a.push(...nP(h,this.rankMap))}if(c==null)break;let m=this.specialTokens[c[0]];a.push(m),u=c.index+c[0].length}return a}decode(t){const e=[];let n=0;for(let a=0;a<t.length;++a){const i=t[a],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),n+=o.length)}const r=new Uint8Array(n);let s=0;for(const a of e)r.set(a,s),s+=a.length;return this.textDecoder.decode(r)}},ky=fh;eP(ky,"specialTokenRegex",t=>new RegExp(t.map(e=>rP(e)).join("|"),"g"));function sP(t){switch(t){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1-2024-12-17":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}const qo={},aP=new If({});async function iP(t){return t in qo||(qo[t]=aP.fetch(`https://tiktoken.pages.dev/js/${t}.json`).then(e=>e.json()).then(e=>new ky(e)).catch(e=>{throw delete qo[t],e})),await qo[t]}async function oP(t){return iP(sP(t))}class uP extends qR{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.lengthFunction=(e==null?void 0:e.lengthFunction)??(n=>n.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,n={}){return this.splitDocuments(e,n)}splitOnSeparator(e,n){let r;if(n)if(this.keepSeparator){const s=n.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");r=e.split(new RegExp(`(?=${s})`))}else r=e.split(n);else r=e.split("");return r.filter(s=>s!=="")}async createDocuments(e,n=[],r={}){const s=n.length>0?n:[...Array(e.length)].map(()=>({})),{chunkHeader:a="",chunkOverlapHeader:i="(cont'd) ",appendChunkOverlapHeader:o=!1}=r,u=new Array;for(let c=0;c<e.length;c+=1){const l=e[c];let d=1,m=null,p=-1;for(const h of await this.splitText(l)){let g=a;const b=l.indexOf(h,p+1);if(m===null){const I=this.numberOfNewLines(l,0,b);d+=I}else{const I=p+await this.lengthFunction(m);if(I<b){const w=this.numberOfNewLines(l,I,b);d+=w}else if(I>b){const w=this.numberOfNewLines(l,b,I);d-=w}o&&(g+=i)}const _=this.numberOfNewLines(h),y=s[c].loc&&typeof s[c].loc=="object"?{...s[c].loc}:{};y.lines={from:d,to:d+_};const E={...s[c],loc:y};g+=h,u.push(new ls({pageContent:g,metadata:E})),d+=_,m=h,p=b}}return u}numberOfNewLines(e,n,r){return(e.slice(n,r).match(/\n/g)||[]).length}async splitDocuments(e,n={}){const r=e.filter(i=>i.pageContent!==void 0),s=r.map(i=>i.pageContent),a=r.map(i=>i.metadata);return this.createDocuments(s,a,n)}joinDocs(e,n){const r=e.join(n).trim();return r===""?null:r}async mergeSplits(e,n){const r=[],s=[];let a=0;for(const o of e){const u=await this.lengthFunction(o);if(a+u+s.length*n.length>this.chunkSize&&(a>this.chunkSize&&console.warn(`Created a chunk of size ${a}, +
which is longer than the specified ${this.chunkSize}`),s.length>0)){const c=this.joinDocs(s,n);for(c!==null&&r.push(c);a>this.chunkOverlap||a+u+s.length*n.length>this.chunkSize&&a>0;)a-=await this.lengthFunction(s[0]),s.shift()}s.push(o),a+=u}const i=this.joinDocs(s,n);return i!==null&&r.push(i),r}}class Qu extends uP{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(e==null?void 0:e.separators)??this.separators,this.keepSeparator=(e==null?void 0:e.keepSeparator)??!0}async _splitText(e,n){const r=[];let s=n[n.length-1],a;for(let c=0;c<n.length;c+=1){const l=n[c];if(l===""){s=l;break}if(e.includes(l)){s=l,a=n.slice(c+1);break}}const i=this.splitOnSeparator(e,s);let o=[];const u=this.keepSeparator?"":s;for(const c of i)if(await this.lengthFunction(c)<this.chunkSize)o.push(c);else{if(o.length){const l=await this.mergeSplits(o,u);r.push(...l),o=[]}if(!a)r.push(c);else{const l=await this._splitText(c,a);r.push(...l)}}if(o.length){const c=await this.mergeSplits(o,u);r.push(...c)}return r}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,n){return new Qu({...n,separators:Qu.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}}class po{constructor(e,n){Te(this,"data");Te(this,"plugin");Te(this,"name");Te(this,"file");Te(this,"i18n");this.name=n,this.plugin=e,this.i18n=e.i18n}async customSaveData(e,n){n=n||this.file;const r=`/ai/${n}`;let s;return typeof e=="object"?s=new File([new Blob([JSON.stringify(e)],{type:"application/json"})],r.split("/").pop()):s=new File([new Blob([e])],r.split("/").pop()),L2(r,!1,s)}async customLoadData(e){e=e||this.file;const n=`/ai/${e}`;return new Promise(r=>{dt.fetchPost("/api/file/getFile",{path:n},s=>{s.code!==404&&(this.data=s),r(this.data)})})}async load(){let e=await this.plugin.loadData(this.file);return e?this.data=e:this.save(),this.data}async save(e){return e=e??this.data,this.plugin.saveData(this.file,e),e}}class cP extends po{constructor(n,r,s,a,i,o){super(n,r);Te(this,"apiKey");Te(this,"documentVectorStorage");Te(this,"data",new Map);Te(this,"BATCH_SIZE",20);Te(this,"MAX_CONTENT_LENGTH",510);Te(this,"includeNotebooks");Te(this,"excludeNotebooks");Te(this,"recursiveCharacterTextSplitter");this.name=r??k_,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this.apiKey=s,this.documentVectorStorage=a,this.includeNotebooks=i,this.excludeNotebooks=o,this.recursiveCharacterTextSplitter=new Qu({chunkSize:this.MAX_CONTENT_LENGTH,chunkOverlap:50})}async load(){return console.debug("BlockStorage load"),this.data.size===0&&(this.data=await this.documentVectorStorage.embeddingBlocks()),await this.knowledgeProcess(),await this.documentVectorStorage.release(),this.data}get(n){return this.data[n]}has(n){return this.data.has(n)}add(n,r){this.data.set(n,r)}async getDocuments(){const n=[],r=a=>{if(!Array.isArray(a)){console.warn(this.i18n.invalidNodesArray);return}a.forEach(i=>{var o;n.push(i.id),((o=i.children)==null?void 0:o.length)>0&&r(i.children)})},s=await u2();if(!s)return n;for(const a of s.notebooks)if(!(this.excludeNotebooks&&this.excludeNotebooks.includes(a.name))&&(this.includeNotebooks===""||this.includeNotebooks.includes(a.name))){const i=await D2(a.id,"/");r(i.tree)}return n}async getBlocks(){const n=[],r=new Set(["widget","iframe","audio"]);try{const s=await this.getDocuments();return await Promise.allSettled(s.map(async a=>{try{const o=(await b_(a)).filter(u=>{var c;return!r.has(u.type)&&((c=u.content)==null?void 0:c.length)>2}).map(u=>({docId:a,blockId:u.id,content:u.content}));n.push(...o)}catch(i){console.error(` ${a} :`,i)}})),n}catch(s){return console.error(":",s),[]}}async blocksToInsert(){console.debug("BlockStorage::blocksToInsert");const n=await this.getBlocks();return n?n==null?void 0:n.filter(r=>!this.has(r.blockId)):[]}async blocksToDelete(){console.debug("BlockStorage::blocksToDelete");const n=[];try{const r=await this.getBlocks(),s=new Set(r.map(a=>a.blockId));for(const[a,i]of this.data.entries())s.has(a)||(this.data.delete(a),n.push({blockId:a,docId:i}));return n}catch(r){return console.error("ID:",r),n}}async processSingleBlock(n){const r=[];let s=n.content??"";return s.length>this.MAX_CONTENT_LENGTH&&(await this.recursiveCharacterTextSplitter.splitText(s)).forEach(i=>{r.push({blockId:n.blockId,docId:n.docId,content:i,isSummary:!1})}),r}async genBatchBlocks(n){const r=[];let s=[];for(const a of n)(await this.processSingleBlock(a)).forEach(o=>{s.push({pageContent:o.content,metadata:{blockId:o.blockId,docId:o.docId,isSummary:o.isSummary},id:o.blockId}),s.length===this.BATCH_SIZE&&(r.push(s),s=[])});return s.length>0&&r.push(s),r}async knowledgeProcess(){const n=await this.blocksToInsert(),r=await this.genBatchBlocks(n),s=r.length;let a=0,i=0;for(const u of r){a++;const c=Math.round(a/s*100);c>=i+5&&(ta(`${this.documentVectorStorage.i18n.knowledgeBaseProgress}: ${c}%`,2e3),i=c,await this.documentVectorStorage.save()),console.log(`${a}${s}`),await this.documentVectorStorage.addDocuments(u)}await this.documentVectorStorage.save(),ta(this.documentVectorStorage.i18n.knowledgeReady,1e4);const o=await this.blocksToDelete();(o==null?void 0:o.length)>0&&this.documentVectorStorage.deleteDocuments(o)}}class Iy extends po{constructor(n,r){super(n,r);Te(this,"data",[{id:1,title:this.i18n.translation,time:"2025/1/22 17:06:59",messages:[{id:1,role:"system",content:this.i18n.defaultSystemPrompt},{id:2,role:"user",content:this.i18n.defaultTranslationExample},{id:3,role:"assistant",content:this.i18n.defaultTranslationResponse}]},{id:2,title:this.i18n.greeting,time:"2025/1/22 17:05:59",messages:[{id:1,role:"system",content:this.i18n.defaultSystemPrompt},{id:2,role:"user",content:this.i18n.helloMessage},{id:3,role:"assistant",content:this.i18n.helloResponse}]}]);this.name=r??Kd,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`}add(n){return this.data.unshift(n),this.save()}async update(n){const r=this.data.findIndex(s=>s.id===n.id);return r!==-1?(this.data[r]={...n},await this.save(),this.data[r]):null}updateMessage(n){return this.data=this.data.map(r=>({...r,messages:r.messages.map(s=>s.id===n.id?n:s)})),this.save()}delete(n){return this.data=this.data.filter(r=>r.id!==n),this.save()}deleteMessage(n){return this.data=this.data.map(r=>({...r,messages:r.messages.filter(s=>s.id!==n)})),this.save()}get(n){return this.data.find(r=>r.id===n)}set(n){return this.data.push(n),this.save()}dump(){return this.data}}class lP extends Iy{constructor(){super(...arguments);Te(this,"data",[{id:1,title:"",time:"2025/1/22 17:06:59",messages:[{id:1,role:"user",content:"an island near sea, with seagulls, moon shining over the sea, light house, boats int he background, fish flying over the sea",imageParam:{model:"Pro/black-forest-labs/FLUX.1-schnell",size:"1:1",seed:2345,steps:4,guidance:1,negativePrompt:""}},{id:2,role:"assistant",content:"![](https://easyimage.geeksphere.online/i/2025/02/18/gxsk8p.png)",imageParam:{model:"Pro/black-forest-labs/FLUX.1-schnell",size:"1:1",seed:2345,steps:4,guidance:1,negativePrompt:""}}]}])}}class dP extends po{constructor(n,r){super(n,r);Te(this,"data",[{id:0,title:this.i18n.translationPromptTitle,content:this.i18n.translationPromptContent},{id:1,title:this.i18n.extractTitlePromptTitle,content:this.i18n.extractTitlePromptContent}]);this.name=r??Yd,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`}addPrompt(n){this.data=[...this.data,n],this.save()}updatePrompt(n){this.data=this.data.map(r=>r.id===n.id?n:r),this.save()}deletePrompt(n){this.data=this.data.filter(r=>r.id!==n),this.save()}get(n){return this.data.find(r=>r.id===n)}set(n){this.data.push(n),this.save()}}class hP extends po{constructor(n,r){super(n,r);Te(this,"data",new Map);this.name=r??Gd,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this._defaultSettings()}async load(){let n=await this.plugin.loadData(this.file);if(n)for(let[r,s]of this.data){if(r==="isKnowledgeBaseInstruction"||r==="isKnowledgeBaseChat"){s.value=!1;continue}s.value=(n==null?void 0:n[r])??s.value}else this.save();return n}async save(n){return n=n??this.dump(),await this.plugin.saveData(this.file,n),n}get(n){return this.data.get(n)}getValue(n){var s;let r=(s=this.data.get(n))==null?void 0:s.value;return n==="apiKey"&&(r==null?void 0:r.length)===0&&so(this.i18n.pleaseConfigureApiKey,2e3),r}getSettingItems(n){let r=[];for(let[s,a]of this.data)n&&a.group!==n||r.push(a);return r}set(n,r){this.data.set(n,r)}setValue(n,r){let s=this.data.get(n);s.value=r}dump(){let n={};for(let[r,s]of this.data)n[r]=s.value;return n}_defaultSettings(){const n={group:" ",title:this.i18n.apiKeyTitle,description:this.i18n.apiKeyDescription,type:"textinput",key:"apiKey",value:"",placeholder:this.i18n.apiKeyPlaceholder};this.data.set(n.key,n);const r={group:" ",title:"",description:"",type:"checkbox",key:"isKnowledge",value:!1};this.data.set(r.key,r);const s={group:" ",title:"",description:"[]",type:"checkbox",key:"isVectorOnline",value:!1};this.data.set(s.key,s);const a={group:" ",title:"",description:"[,]",type:"textinput",key:"phoneNumber",value:"",placeholder:""};this.data.set(a.key,a);const i={group:" ",title:this.i18n.excludeknowledgeBookTitle,description:this.i18n.excludeknowledgeBookDescription,type:"textinput",key:"excludeKnowledgeBook",value:"",placeholder:this.i18n.knowledgeBookPlaceholder};this.data.set(i.key,i);const o={group:" ",title:this.i18n.includeknowledgeBookTitle,description:this.i18n.includeknowledgeBookDescription,type:"textinput",key:"includeKnowledgeBook",value:"",placeholder:this.i18n.knowledgeBookPlaceholder};this.data.set(o.key,o);const u={group:"instruction",title:"",description:"token5",key:"knowledgeBaseRecallNumInstruction",type:"number",value:5};this.data.set(u.key,u);const c={group:"chat",title:"",description:"token5",key:"knowledgeBaseRecallNumChat",type:"number",value:5},l={group:"instructionIcon",title:this.i18n.searchInstructionTitle,description:this.i18n.searchInstructionDesc,type:"checkbox",key:"isSearchInstruction",value:!1};this.data.set(l.key,l);const d={group:"instruction",title:this.i18n.pageContentTitle,description:this.i18n.pageContentDesc,type:"checkbox",key:"isPageContent",value:!1};this.data.set(d.key,d);const m={group:"instruction",title:this.i18n.temperatureTitle,description:this.i18n.temperatureDesc,type:"slider",key:"temperatureInstruction",slider:{min:0,max:1,step:.1},value:.5};this.data.set(m.key,m);const p={group:"instruction",title:this.i18n.maxTokensTitle,description:this.i18n.maxTokensDesc,type:"number",key:"maxOutputLengthInstruction",value:4e3};this.data.set(p.key,p);const h={group:"custom",title:this.i18n.searchChatTitle,description:this.i18n.searchChatDesc,key:"isSearchChat",type:"checkbox",value:!1};this.data.set(h.key,h),this.data.set(c.key,c);const g={group:"chat",title:this.i18n.maxTokensTitle,description:this.i18n.maxTokensDesc,type:"number",key:"maxOutputLengthChat",value:4e3};this.data.set(g.key,g);const b={group:"instruction",title:this.i18n.responseTimeoutTitle,description:this.i18n.responseTimeoutDesc,type:"number",key:"responseTimeoutInstruction",value:90};this.data.set(b.key,b);const _={group:"chat",title:this.i18n.responseTimeoutTitle,description:this.i18n.responseTimeoutDesc,type:"number",key:"responseTimeoutChat",value:90};this.data.set(_.key,_);const y={group:"chat",title:this.i18n.temperatureTitle,description:this.i18n.temperatureDesc,type:"slider",key:"temperatureChat",slider:{min:0,max:1,step:.1},value:.5};this.data.set(y.key,y);const E={group:"custom",title:this.i18n.knowledgeBaseTitle,description:this.i18n.knowledgeBaseDesc,type:"checkbox",key:"isKnowledgeBaseInstruction",value:!1};this.data.set(E.key,E);const I={group:"custom",title:this.i18n.knowledgeBaseTitle,description:this.i18n.knowledgeBaseDesc,type:"checkbox",key:"isKnowledgeBaseChat",value:!1};this.data.set(I.key,I);const w={group:"image",title:"",description:"",type:"select",key:"modelImage",value:"stabilityai/stable-diffusion-3-5-large-turbo",options:{"stabilityai/stable-diffusion-3-5-large-turbo":"Stable Diffusion 3.5","black-forest-labs/FLUX.1-dev":"FLUX.1.dev","LoRA/black-forest-labs/FLUX.1-dev":"FLUX.1.dev.LoRA","Pro/black-forest-labs/FLUX.1-schnell":"FLUX.1.schnell"}};this.data.set(w.key,w);const R={group:"image",title:"",description:"",type:"select",key:"sizeImage",value:"1024x1024",options:{"1024x1024":"1024x1024","512x1024":"512x1024","768x512":"768x512","768x1024":"768x1024","1024x576":"1024x576","576x1024":"576x1024"}};this.data.set(R.key,R),this.data.set(w.key,w);const v={group:"image",title:"",description:"",type:"textinput",key:"seedImage",value:"2345",placeholder:""};this.data.set(v.key,v),this.data.set(w.key,w);const j={group:"image",title:"",description:"",type:"slider",key:"stepsImage",value:4,slider:{min:1,max:20,step:1}};this.data.set(j.key,j);const F={group:"image",title:"",description:"",type:"slider",key:"guidanceImage",value:1,slider:{min:1,max:20,step:.1}};this.data.set(F.key,F);const x={group:"image",title:"",description:"",type:"textarea",key:"negativePromptImage",value:"",placeholder:""};this.data.set(x.key,x);const H={group:"model",title:this.i18n.modelTitle,description:this.i18n.modelDesc,type:"select",key:"modelSelections",value:"deepseek-chat",options:{"deepseek-chat":"DeepSeek V3","deepseek-reasoner":"DeepSeek R1","gemini-2.0-flash-lite-preview-02-05":"Gemini 2.0 Lite","gemini-2.0-flash-thinking-exp-01-21":"Gemini 2.0 Thinking","gemini-2.0-flash":"Gemini 2.0 Flash","moonshot-v1-auto":"Moonshot Chat","glm-4-flash":"GLM 4 Flash","qwen-turbo-latest":"Qwen Turbo","qwen-plus-latest":"Qwen Plus","qwen-max-latest":"Qwen Max","doubao-1.5-lite-32k":"Doubao 1.5 Lite","doubao-1.5-pro-32k":"Doubao 1.5 Pro","gpt-4o-mini":"GPT 4o mini"}};this.data.set(H.key,H),this.load()}}function pg(t,e,n){const r=t.slice();return r[6]=e[n],r}function gg(t){let e,n,r,s=t[6].title+"",a,i,o,u=t[6].time+"",c,l,d,m,p,h;function g(){return t[4](t[6])}function b(){return t[5](t[6])}return{c(){e=M("div"),n=M("button"),r=M("span"),a=Ke(s),i=ee(),o=M("div"),c=Ke(u),l=ee(),d=M("button"),d.innerHTML='<svg viewBox="0 0 24 24" width="1rem" height="1rem" stroke="currentColor" stroke-width="2" fill="none" class="svelte-1f7dc1o"><path d="M18 6L6 18M6 6l12 12"></path></svg>',m=ee(),T(r,"class","svelte-1f7dc1o"),T(o,"class","time svelte-1f7dc1o"),T(n,"class","item-content svelte-1f7dc1o"),T(d,"class","delete-btn svelte-1f7dc1o"),T(d,"title",""),T(e,"class","list-item svelte-1f7dc1o")},m(_,y){ce(_,e,y),O(e,n),O(n,r),O(r,a),O(n,i),O(n,o),O(o,c),O(e,l),O(e,d),O(e,m),p||(h=[ne(n,"click",g),ne(d,"click",S_(b))],p=!0)},p(_,y){t=_,y&1&&s!==(s=t[6].title+"")&&lt(a,s),y&1&&u!==(u=t[6].time+"")&&lt(c,u)},d(_){_&&oe(e),p=!1,st(h)}}}function fP(t){let e,n,r,s,a,i,o,u=t[0].i18n.newChat+"",c,l,d,m,p=_t(t[0].dump()),h=[];for(let g=0;g<p.length;g+=1)h[g]=gg(pg(t,p,g));return{c(){e=M("div"),n=M("div"),n.innerHTML='<h3 class="svelte-1f7dc1o">SiYuan AI</h3>',r=ee(),s=M("div"),a=M("button"),i=M("span"),o=Ke("+ "),c=Ke(u),l=ee();for(let g=0;g<h.length;g+=1)h[g].c();T(n,"class","history-header svelte-1f7dc1o"),T(i,"class","svelte-1f7dc1o"),T(a,"class","new-chat-btn svelte-1f7dc1o"),T(s,"class","list svelte-1f7dc1o"),T(e,"class","history svelte-1f7dc1o")},m(g,b){ce(g,e,b),O(e,n),O(e,r),O(e,s),O(s,a),O(a,i),O(i,o),O(i,c),O(s,l);for(let _=0;_<h.length;_+=1)h[_]&&h[_].m(s,null);d||(m=ne(a,"click",t[2]),d=!0)},p(g,[b]){if(b&1&&u!==(u=g[0].i18n.newChat+"")&&lt(c,u),b&11){p=_t(g[0].dump());let _;for(_=0;_<p.length;_+=1){const y=pg(g,p,_);h[_]?h[_].p(y,b):(h[_]=gg(y),h[_].c(),h[_].m(s,null))}for(;_<h.length;_+=1)h[_].d(1);h.length=p.length}},i:Ze,o:Ze,d(g){g&&oe(e),Qr(h,g),d=!1,m()}}}function mP(t,e,n){let{chatHistoryStorage:r}=e;const s=yn();function a(){const c={id:Date.now(),title:r.i18n.newChat,time:Bu().format("YYYY/M/D HH:mm:ss"),messages:[{id:Date.now(),role:"system",content:"You are a helpful assistant. You can help me by answering my questions. You can also ask me questions."}]};r.add(c),n(0,r),s("selectChat",c)}function i(c){r.delete(c),n(0,r),r.data.length===0&&a(),s("selectChat",r.dump()[0])}const o=c=>s("selectChat",c),u=c=>i(c.id);return t.$$set=c=>{"chatHistoryStorage"in c&&n(0,r=c.chatHistoryStorage)},[r,s,a,i,o,u]}let pP=class extends tt{constructor(e){super(),et(this,e,mP,fP,Qe,{chatHistoryStorage:0})}};function bg(t,e,n){const r=t.slice();return r[12]=e[n],r}function gP(t){var b;let e,n,r,s=t[1].Md2HTML(t[12].content)+"",a,i,o,u,c,l,d,m,p=((b=t[12])==null?void 0:b.fileContent)&&_g(),h=t[12].role==="user"&&yg(t);function g(){return t[8](t[12])}return{c(){e=M("div"),p&&p.c(),n=ee(),r=M("div"),a=ee(),i=M("div"),h&&h.c(),o=ee(),u=M("button"),u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1i5a28a"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',c=ee(),T(r,"class","message-content svelte-1i5a28a"),T(u,"class","action-btn svelte-1i5a28a"),T(i,"class","message-actions svelte-1i5a28a"),T(e,"class",l="message "+(t[12].role==="user"?"user":"ai")+" svelte-1i5a28a")},m(_,y){ce(_,e,y),p&&p.m(e,null),O(e,n),O(e,r),r.innerHTML=s,O(e,a),O(e,i),h&&h.m(i,null),O(i,o),O(i,u),O(e,c),d||(m=ne(u,"click",g),d=!0)},p(_,y){var E;t=_,(E=t[12])!=null&&E.fileContent?p||(p=_g(),p.c(),p.m(e,n)):p&&(p.d(1),p=null),y&3&&s!==(s=t[1].Md2HTML(t[12].content)+"")&&(r.innerHTML=s),t[12].role==="user"?h?h.p(t,y):(h=yg(t),h.c(),h.m(i,o)):h&&(h.d(1),h=null),y&1&&l!==(l="message "+(t[12].role==="user"?"user":"ai")+" svelte-1i5a28a")&&T(e,"class",l)},d(_){_&&oe(e),p&&p.d(),h&&h.d(),d=!1,m()}}}function bP(t){let e,n,r=t[1].Md2HTML(`![User uploaded image](${t[12].image})

${t[12].content}`)+"",s,a,i,o,u,c,l,d,m=t[12].role==="user"&&Eg(t);function p(){return t[6](t[12])}return{c(){e=M("div"),n=M("div"),s=ee(),a=M("div"),m&&m.c(),i=ee(),o=M("button"),o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1i5a28a"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',u=ee(),T(n,"class","message-content svelte-1i5a28a"),T(o,"class","action-btn svelte-1i5a28a"),T(a,"class","message-actions svelte-1i5a28a"),T(e,"class",c="message "+(t[12].role==="user"?"user":"ai")+" svelte-1i5a28a")},m(h,g){ce(h,e,g),O(e,n),n.innerHTML=r,O(e,s),O(e,a),m&&m.m(a,null),O(a,i),O(a,o),O(e,u),l||(d=ne(o,"click",p),l=!0)},p(h,g){t=h,g&3&&r!==(r=t[1].Md2HTML(`![User uploaded image](${t[12].image})

${t[12].content}`)+"")&&(n.innerHTML=r),t[12].role==="user"?m?m.p(t,g):(m=Eg(t),m.c(),m.m(a,i)):m&&(m.d(1),m=null),g&1&&c!==(c="message "+(t[12].role==="user"?"user":"ai")+" svelte-1i5a28a")&&T(e,"class",c)},d(h){h&&oe(e),m&&m.d(),l=!1,d()}}}function _g(t){let e;return{c(){e=M("span"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>',T(e,"class","file-icon svelte-1i5a28a")},m(n,r){ce(n,e,r)},d(n){n&&oe(e)}}}function yg(t){let e,n,r;function s(){return t[7](t[12])}return{c(){e=M("button"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1i5a28a"><path d="M23 4v6h-6M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>',T(e,"class","action-btn svelte-1i5a28a")},m(a,i){ce(a,e,i),n||(r=ne(e,"click",s),n=!0)},p(a,i){t=a},d(a){a&&oe(e),n=!1,r()}}}function Eg(t){let e,n,r;function s(){return t[5](t[12])}return{c(){e=M("button"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1i5a28a"><path d="M23 4v6h-6M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>',T(e,"class","action-btn svelte-1i5a28a")},m(a,i){ce(a,e,i),n||(r=ne(e,"click",s),n=!0)},p(a,i){t=a},d(a){a&&oe(e),n=!1,r()}}}function wg(t){let e;function n(a,i){var o,u;return((u=(o=a[12])==null?void 0:o.image)==null?void 0:u.length)>0?bP:gP}let r=n(t),s=r(t);return{c(){s.c(),e=ao()},m(a,i){s.m(a,i),ce(a,e,i)},p(a,i){r===(r=n(a))&&s?s.p(a,i):(s.d(1),s=r(a),s&&(s.c(),s.m(e.parentNode,e)))},d(a){a&&oe(e),s.d(a)}}}function _P(t){let e,n,r=_t(t[0].messages),s=[];for(let a=0;a<r.length;a+=1)s[a]=wg(bg(t,r,a));return{c(){e=M("div"),n=M("div");for(let a=0;a<s.length;a+=1)s[a].c();T(n,"class","messages-wrapper svelte-1i5a28a"),T(e,"class","message-container svelte-1i5a28a")},m(a,i){ce(a,e,i),O(e,n);for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(n,null);t[9](e)},p(a,[i]){if(i&27){r=_t(a[0].messages);let o;for(o=0;o<r.length;o+=1){const u=bg(a,r,o);s[o]?s[o].p(u,i):(s[o]=wg(u),s[o].c(),s[o].m(n,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=r.length}},i:Ze,o:Ze,d(a){a&&oe(e),Qr(s,a),t[9](null)}}}function yP(t,e,n){let{currentChat:r}=e,{lute:s}=e,a;const i=yn();function o(){if(a){const g=a.scrollHeight,b=a.clientHeight,_=g-b;a.scrollTo({top:_,behavior:"smooth"})}}function u(g){i("edit",{message:g})}function c(g){i("delete",{message:g})}A_(()=>{var g;if(((g=r==null?void 0:r.messages)==null?void 0:g.length)>0){const b=r.messages[r.messages.length-1];(b==null?void 0:b.role)==="assistant"&&setTimeout(o,50)}}),Rr(o);const l=g=>u(g),d=g=>c(g),m=g=>u(g),p=g=>c(g);function h(g){ue[g?"unshift":"push"](()=>{a=g,n(2,a)})}return t.$$set=g=>{"currentChat"in g&&n(0,r=g.currentChat),"lute"in g&&n(1,s=g.lute)},t.$$.update=()=>{if(t.$$.dirty&1&&r!=null&&r.messages){const g=r.messages[r.messages.length-1];(g==null?void 0:g.role)!=="user"&&g.content&&o()}},[r,s,a,u,c,l,d,m,p,h]}let EP=class extends tt{constructor(e){super(),et(this,e,yP,_P,Qe,{currentChat:0,lute:1})}};function Tg(t,e,n){const r=t.slice();return r[0]=e[n][0],r[18]=e[n][1],r}function wP(t){let e,n,r,s,a,i,o;return{c(){e=M("div"),n=M("input"),T(n,"id","fontSize"),T(n,"min",r=t[5].min),T(n,"max",s=t[5].max),T(n,"step",a=t[5].step),T(n,"type","range"),T(n,"style",t[8]),_e(n,"b3-slider",!0),_e(n,"fn__size200",t[7]),T(e,"class","b3-tooltips b3-tooltips__n"),T(e,"aria-label",t[0])},m(u,c){ce(u,e,c),O(e,n),bt(n,t[0]),i||(o=[ne(n,"change",t[16]),ne(n,"input",t[16]),ne(n,"change",t[10])],i=!0)},p(u,c){c&32&&r!==(r=u[5].min)&&T(n,"min",r),c&32&&s!==(s=u[5].max)&&T(n,"max",s),c&32&&a!==(a=u[5].step)&&T(n,"step",a),c&256&&T(n,"style",u[8]),c&17&&bt(n,u[0]),c&128&&_e(n,"fn__size200",u[7]),c&17&&T(e,"aria-label",u[0])},d(u){u&&oe(e),i=!1,st(o)}}}function TP(t){let e,n,r,s=_t(Object.entries(t[4])),a=[];for(let i=0;i<s.length;i+=1)a[i]=Sg(Tg(t,s,i));return{c(){e=M("select");for(let i=0;i<a.length;i+=1)a[i].c();T(e,"id","iconPosition"),T(e,"style",t[8]),t[0]===void 0&&Mu(()=>t[15].call(e)),_e(e,"b3-select",!0),_e(e,"fn__flex-center",!0),_e(e,"fn__size200",t[7])},m(i,o){ce(i,e,o);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(e,null);mp(e,t[0],!0),n||(r=[ne(e,"change",t[15]),ne(e,"change",t[10])],n=!0)},p(i,o){if(o&16){s=_t(Object.entries(i[4]));let u;for(u=0;u<s.length;u+=1){const c=Tg(i,s,u);a[u]?a[u].p(c,o):(a[u]=Sg(c),a[u].c(),a[u].m(e,null))}for(;u<a.length;u+=1)a[u].d(1);a.length=s.length}o&256&&T(e,"style",i[8]),o&17&&mp(e,i[0]),o&128&&_e(e,"fn__size200",i[7])},d(i){i&&oe(e),Qr(a,i),n=!1,st(r)}}}function SP(t){let e,n=t[6].label+"",r,s,a;return{c(){e=M("button"),r=Ke(n),T(e,"id",t[2]),T(e,"style",t[8]),_e(e,"b3-button",!0),_e(e,"b3-button--outline",!0),_e(e,"fn__flex-center",!0),_e(e,"fn__size200",t[7])},m(i,o){ce(i,e,o),O(e,r),s||(a=ne(e,"click",t[9]),s=!0)},p(i,o){o&64&&n!==(n=i[6].label+"")&&lt(r,n),o&4&&T(e,"id",i[2]),o&256&&T(e,"style",i[8]),o&128&&_e(e,"fn__size200",i[7])},d(i){i&&oe(e),s=!1,a()}}}function AP(t){let e,n,r;return{c(){e=M("input"),T(e,"id",t[2]),T(e,"type","number"),T(e,"style",t[8]),_e(e,"b3-text-field",!0),_e(e,"fn__flex-center",!0),_e(e,"fn__size200",t[7])},m(s,a){ce(s,e,a),bt(e,t[0]),n||(r=[ne(e,"input",t[14]),ne(e,"change",t[10])],n=!0)},p(s,a){a&4&&T(e,"id",s[2]),a&256&&T(e,"style",s[8]),a&17&&Vd(e.value)!==s[0]&&bt(e,s[0]),a&128&&_e(e,"fn__size200",s[7])},d(s){s&&oe(e),n=!1,st(r)}}}function CP(t){let e,n,r,s;return{c(){e=M("textarea"),T(e,"class","b3-text-field fn__block"),T(e,"style",n=`resize: vertical; height: 10em; white-space: nowrap; ${t[8]}`)},m(a,i){ce(a,e,i),bt(e,t[0]),r||(s=[ne(e,"input",t[13]),ne(e,"change",t[10])],r=!0)},p(a,i){i&256&&n!==(n=`resize: vertical; height: 10em; white-space: nowrap; ${a[8]}`)&&T(e,"style",n),i&17&&bt(e,a[0])},d(a){a&&oe(e),r=!1,st(s)}}}function vP(t){let e,n,r;return{c(){e=M("input"),T(e,"id",t[2]),T(e,"placeholder",t[3]),T(e,"style",t[8]),_e(e,"b3-text-field",!0),_e(e,"fn__flex-center",!0),_e(e,"fn__size200",t[7])},m(s,a){ce(s,e,a),bt(e,t[0]),n||(r=[ne(e,"input",t[12]),ne(e,"change",t[10])],n=!0)},p(s,a){a&4&&T(e,"id",s[2]),a&8&&T(e,"placeholder",s[3]),a&256&&T(e,"style",s[8]),a&17&&e.value!==s[0]&&bt(e,s[0]),a&128&&_e(e,"fn__size200",s[7])},d(s){s&&oe(e),n=!1,st(r)}}}function OP(t){let e,n,r;return{c(){e=M("input"),T(e,"class","b3-switch fn__flex-center"),T(e,"id",t[2]),T(e,"type","checkbox"),T(e,"style",t[8])},m(s,a){ce(s,e,a),e.checked=t[0],n||(r=[ne(e,"change",t[11]),ne(e,"change",t[10])],n=!0)},p(s,a){a&4&&T(e,"id",s[2]),a&256&&T(e,"style",s[8]),a&17&&(e.checked=s[0])},d(s){s&&oe(e),n=!1,st(r)}}}function Sg(t){let e,n=t[18]+"",r,s;return{c(){e=M("option"),r=Ke(n),e.__value=s=t[0],bt(e,e.__value)},m(a,i){ce(a,e,i),O(e,r)},p(a,i){i&16&&n!==(n=a[18]+"")&&lt(r,n),i&16&&s!==(s=a[0])&&(e.__value=s,bt(e,e.__value))},d(a){a&&oe(e)}}}function kP(t){let e;function n(a,i){if(a[1]==="checkbox")return OP;if(a[1]==="textinput")return vP;if(a[1]==="textarea")return CP;if(a[1]==="number")return AP;if(a[1]==="button")return SP;if(a[1]==="select")return TP;if(a[1]=="slider")return wP}let r=n(t),s=r&&r(t);return{c(){s&&s.c(),e=ao()},m(a,i){s&&s.m(a,i),ce(a,e,i)},p(a,[i]){r===(r=n(a))&&s?s.p(a,i):(s&&s.d(1),s=r&&r(a),s&&(s.c(),s.m(e.parentNode,e)))},i:Ze,o:Ze,d(a){a&&oe(e),s&&s.d(a)}}}function IP(t,e,n){let{type:r}=e,{key:s}=e,{value:a}=e,{placeholder:i=""}=e,{options:o={}}=e,{slider:u={min:0,max:100,step:1}}=e,{button:c={label:a,callback:()=>{}}}=e,{fnSize:l=!0}=e,{style:d=""}=e;const m=yn();function p(){c==null||c.callback(),m("click",{key:s})}function h(){m("changed",{key:s,value:a})}function g(){a=this.checked,n(0,a),n(4,o)}function b(){a=this.value,n(0,a),n(4,o)}function _(){a=this.value,n(0,a),n(4,o)}function y(){a=Vd(this.value),n(0,a),n(4,o)}function E(){a=p2(this),n(0,a),n(4,o)}function I(){a=Vd(this.value),n(0,a),n(4,o)}return t.$$set=w=>{"type"in w&&n(1,r=w.type),"key"in w&&n(2,s=w.key),"value"in w&&n(0,a=w.value),"placeholder"in w&&n(3,i=w.placeholder),"options"in w&&n(4,o=w.options),"slider"in w&&n(5,u=w.slider),"button"in w&&n(6,c=w.button),"fnSize"in w&&n(7,l=w.fnSize),"style"in w&&n(8,d=w.style)},[a,r,s,i,o,u,c,l,d,p,h,g,b,_,y,E,I]}let Xr=class extends tt{constructor(e){super(),et(this,e,IP,kP,Qe,{type:1,key:2,value:0,placeholder:3,options:4,slider:5,button:6,fnSize:7,style:8})}};function NP(t){let e,n,r,s,a,i,o=ec(t[1],t[3])+"",u,c,l,d;const m=t[5].default,p=af(m,t,t[4],null);return{c(){e=M("div"),n=M("div"),r=M("span"),s=Ke(t[0]),a=ee(),i=M("div"),u=ee(),c=M("span"),l=ee(),p&&p.c(),T(r,"class","title svelte-ikiu6h"),T(i,"class","b3-label__text"),T(n,"class","fn__flex-1"),T(c,"class","fn__space"),T(e,"class","item-wrap fn__flex b3-label config__item svelte-ikiu6h")},m(h,g){ce(h,e,g),O(e,n),O(n,r),O(r,s),O(n,a),O(n,i),i.innerHTML=o,O(e,u),O(e,c),O(e,l),p&&p.m(e,null),d=!0},p(h,g){(!d||g&1)&&lt(s,h[0]),(!d||g&10)&&o!==(o=ec(h[1],h[3])+"")&&(i.innerHTML=o),p&&p.p&&(!d||g&16)&&uf(p,m,h,h[4],d?of(m,h[4],g,null):cf(h[4]),null)},i(h){d||(ie(p,h),d=!0)},o(h){de(p,h),d=!1},d(h){h&&oe(e),p&&p.d(h)}}}function RP(t){let e,n,r,s,a,i,o=ec(t[1],t[3])+"",u,c,l,d,m;const p=t[5].default,h=af(p,t,t[4],null);return{c(){e=M("div"),n=M("div"),r=M("span"),s=Ke(t[0]),a=ee(),i=M("div"),u=ee(),c=M("div"),l=ee(),d=M("div"),h&&h.c(),T(r,"class","title svelte-ikiu6h"),T(i,"class","b3-label__text"),T(c,"class","fn__hr"),St(d,"display","flex"),St(d,"flex-direction","column"),St(d,"gap","5px"),St(d,"position","relative"),T(n,"class","fn__block"),T(e,"class","item-wrap b3-label svelte-ikiu6h"),T(e,"data-key","CustomCSS")},m(g,b){ce(g,e,b),O(e,n),O(n,r),O(r,s),O(n,a),O(n,i),i.innerHTML=o,O(n,u),O(n,c),O(n,l),O(n,d),h&&h.m(d,null),m=!0},p(g,b){(!m||b&1)&&lt(s,g[0]),(!m||b&10)&&o!==(o=ec(g[1],g[3])+"")&&(i.innerHTML=o),h&&h.p&&(!m||b&16)&&uf(h,p,g,g[4],m?of(p,g[4],b,null):cf(g[4]),null)},i(g){m||(ie(h,g),m=!0)},o(g){de(h,g),m=!1},d(g){g&&oe(e),h&&h.d(g)}}}function PP(t){let e,n,r,s;const a=[RP,NP],i=[];function o(u,c){return u[2]==="row"?0:1}return e=o(t),n=i[e]=a[e](t),{c(){n.c(),r=ao()},m(u,c){i[e].m(u,c),ce(u,r,c),s=!0},p(u,[c]){let l=e;e=o(u),e===l?i[e].p(u,c):(hr(),de(i[l],1,1,()=>{i[l]=null}),fr(),n=i[e],n?n.p(u,c):(n=i[e]=a[e](u),n.c()),ie(n,1),n.m(r.parentNode,r))},i(u){s||(ie(n),s=!0)},o(u){de(n),s=!1},d(u){u&&oe(r),i[e].d(u)}}}function ec(t,e=!1){return e&&t.length>20?t.slice(0,20)+"...":t}function xP(t,e,n){let{$$slots:r={},$$scope:s}=e,{title:a}=e,{description:i}=e,{direction:o="column"}=e,{isSimple:u=!1}=e;return t.$$set=c=>{"title"in c&&n(0,a=c.title),"description"in c&&n(1,i=c.description),"direction"in c&&n(2,o=c.direction),"isSimple"in c&&n(3,u=c.isSimple),"$$scope"in c&&n(4,s=c.$$scope)},[a,i,o,u,s,r]}class LP extends tt{constructor(e){super(),et(this,e,xP,PP,Qe,{title:0,description:1,direction:2,isSimple:3})}}const Ny={Wrap:LP,Input:Xr};function Ry(t,e){return function(){return t.apply(e,arguments)}}const{toString:DP}=Object.prototype,{getPrototypeOf:Pf}=Object,Gc=(t=>e=>{const n=DP.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Yn=t=>(t=t.toLowerCase(),e=>Gc(e)===t),Kc=t=>e=>typeof e===t,{isArray:Oa}=Array,Vi=Kc("undefined");function MP(t){return t!==null&&!Vi(t)&&t.constructor!==null&&!Vi(t.constructor)&&bn(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Py=Yn("ArrayBuffer");function BP(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Py(t.buffer),e}const FP=Kc("string"),bn=Kc("function"),xy=Kc("number"),Yc=t=>t!==null&&typeof t=="object",UP=t=>t===!0||t===!1,wu=t=>{if(Gc(t)!=="object")return!1;const e=Pf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},jP=Yn("Date"),HP=Yn("File"),$P=Yn("Blob"),qP=Yn("FileList"),VP=t=>Yc(t)&&bn(t.pipe),zP=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||bn(t.append)&&((e=Gc(t))==="formdata"||e==="object"&&bn(t.toString)&&t.toString()==="[object FormData]"))},WP=Yn("URLSearchParams"),[GP,KP,YP,ZP]=["ReadableStream","Request","Response","Headers"].map(Yn),JP=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function go(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let r,s;if(typeof t!="object"&&(t=[t]),Oa(t))for(r=0,s=t.length;r<s;r++)e.call(null,t[r],r,t);else{const a=n?Object.getOwnPropertyNames(t):Object.keys(t),i=a.length;let o;for(r=0;r<i;r++)o=a[r],e.call(null,t[o],o,t)}}function Ly(t,e){e=e.toLowerCase();const n=Object.keys(t);let r=n.length,s;for(;r-- >0;)if(s=n[r],e===s.toLowerCase())return s;return null}const hs=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Dy=t=>!Vi(t)&&t!==hs;function mh(){const{caseless:t}=Dy(this)&&this||{},e={},n=(r,s)=>{const a=t&&Ly(e,s)||s;wu(e[a])&&wu(r)?e[a]=mh(e[a],r):wu(r)?e[a]=mh({},r):Oa(r)?e[a]=r.slice():e[a]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&go(arguments[r],n);return e}const XP=(t,e,n,{allOwnKeys:r}={})=>(go(e,(s,a)=>{n&&bn(s)?t[a]=Ry(s,n):t[a]=s},{allOwnKeys:r}),t),QP=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),e3=(t,e,n,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},t3=(t,e,n,r)=>{let s,a,i;const o={};if(e=e||{},t==null)return e;do{for(s=Object.getOwnPropertyNames(t),a=s.length;a-- >0;)i=s[a],(!r||r(i,t,e))&&!o[i]&&(e[i]=t[i],o[i]=!0);t=n!==!1&&Pf(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},n3=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const r=t.indexOf(e,n);return r!==-1&&r===n},r3=t=>{if(!t)return null;if(Oa(t))return t;let e=t.length;if(!xy(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},s3=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&Pf(Uint8Array)),a3=(t,e)=>{const r=(t&&t[Symbol.iterator]).call(t);let s;for(;(s=r.next())&&!s.done;){const a=s.value;e.call(t,a[0],a[1])}},i3=(t,e)=>{let n;const r=[];for(;(n=t.exec(e))!==null;)r.push(n);return r},o3=Yn("HTMLFormElement"),u3=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,s){return r.toUpperCase()+s}),Ag=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),c3=Yn("RegExp"),My=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),r={};go(n,(s,a)=>{let i;(i=e(s,a,t))!==!1&&(r[a]=i||s)}),Object.defineProperties(t,r)},l3=t=>{My(t,(e,n)=>{if(bn(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];if(bn(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},d3=(t,e)=>{const n={},r=s=>{s.forEach(a=>{n[a]=!0})};return Oa(t)?r(t):r(String(t).split(e)),n},h3=()=>{},f3=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,Zl="abcdefghijklmnopqrstuvwxyz",Cg="0123456789",By={DIGIT:Cg,ALPHA:Zl,ALPHA_DIGIT:Zl+Zl.toUpperCase()+Cg},m3=(t=16,e=By.ALPHA_DIGIT)=>{let n="";const{length:r}=e;for(;t--;)n+=e[Math.random()*r|0];return n};function p3(t){return!!(t&&bn(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const g3=t=>{const e=new Array(10),n=(r,s)=>{if(Yc(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const a=Oa(r)?[]:{};return go(r,(i,o)=>{const u=n(i,s+1);!Vi(u)&&(a[o]=u)}),e[s]=void 0,a}}return r};return n(t,0)},b3=Yn("AsyncFunction"),_3=t=>t&&(Yc(t)||bn(t))&&bn(t.then)&&bn(t.catch),Fy=((t,e)=>t?setImmediate:e?((n,r)=>(hs.addEventListener("message",({source:s,data:a})=>{s===hs&&a===n&&r.length&&r.shift()()},!1),s=>{r.push(s),hs.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",bn(hs.postMessage)),y3=typeof queueMicrotask<"u"?queueMicrotask.bind(hs):typeof process<"u"&&process.nextTick||Fy,V={isArray:Oa,isArrayBuffer:Py,isBuffer:MP,isFormData:zP,isArrayBufferView:BP,isString:FP,isNumber:xy,isBoolean:UP,isObject:Yc,isPlainObject:wu,isReadableStream:GP,isRequest:KP,isResponse:YP,isHeaders:ZP,isUndefined:Vi,isDate:jP,isFile:HP,isBlob:$P,isRegExp:c3,isFunction:bn,isStream:VP,isURLSearchParams:WP,isTypedArray:s3,isFileList:qP,forEach:go,merge:mh,extend:XP,trim:JP,stripBOM:QP,inherits:e3,toFlatObject:t3,kindOf:Gc,kindOfTest:Yn,endsWith:n3,toArray:r3,forEachEntry:a3,matchAll:i3,isHTMLForm:o3,hasOwnProperty:Ag,hasOwnProp:Ag,reduceDescriptors:My,freezeMethods:l3,toObjectSet:d3,toCamelCase:u3,noop:h3,toFiniteNumber:f3,findKey:Ly,global:hs,isContextDefined:Dy,ALPHABET:By,generateString:m3,isSpecCompliantForm:p3,toJSONObject:g3,isAsyncFn:b3,isThenable:_3,setImmediate:Fy,asap:y3};function Ce(t,e,n,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}V.inherits(Ce,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:V.toJSONObject(this.config),code:this.code,status:this.status}}});const Uy=Ce.prototype,jy={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{jy[t]={value:t}});Object.defineProperties(Ce,jy);Object.defineProperty(Uy,"isAxiosError",{value:!0});Ce.from=(t,e,n,r,s,a)=>{const i=Object.create(Uy);return V.toFlatObject(t,i,function(u){return u!==Error.prototype},o=>o!=="isAxiosError"),Ce.call(i,t.message,e,n,r,s),i.cause=t,i.name=t.name,a&&Object.assign(i,a),i};const E3=null;function ph(t){return V.isPlainObject(t)||V.isArray(t)}function Hy(t){return V.endsWith(t,"[]")?t.slice(0,-2):t}function vg(t,e,n){return t?t.concat(e).map(function(s,a){return s=Hy(s),!n&&a?"["+s+"]":s}).join(n?".":""):e}function w3(t){return V.isArray(t)&&!t.some(ph)}const T3=V.toFlatObject(V,{},null,function(e){return/^is[A-Z]/.test(e)});function Zc(t,e,n){if(!V.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=V.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,b){return!V.isUndefined(b[g])});const r=n.metaTokens,s=n.visitor||l,a=n.dots,i=n.indexes,u=(n.Blob||typeof Blob<"u"&&Blob)&&V.isSpecCompliantForm(e);if(!V.isFunction(s))throw new TypeError("visitor must be a function");function c(h){if(h===null)return"";if(V.isDate(h))return h.toISOString();if(!u&&V.isBlob(h))throw new Ce("Blob is not supported. Use a Buffer instead.");return V.isArrayBuffer(h)||V.isTypedArray(h)?u&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function l(h,g,b){let _=h;if(h&&!b&&typeof h=="object"){if(V.endsWith(g,"{}"))g=r?g:g.slice(0,-2),h=JSON.stringify(h);else if(V.isArray(h)&&w3(h)||(V.isFileList(h)||V.endsWith(g,"[]"))&&(_=V.toArray(h)))return g=Hy(g),_.forEach(function(E,I){!(V.isUndefined(E)||E===null)&&e.append(i===!0?vg([g],I,a):i===null?g:g+"[]",c(E))}),!1}return ph(h)?!0:(e.append(vg(b,g,a),c(h)),!1)}const d=[],m=Object.assign(T3,{defaultVisitor:l,convertValue:c,isVisitable:ph});function p(h,g){if(!V.isUndefined(h)){if(d.indexOf(h)!==-1)throw Error("Circular reference detected in "+g.join("."));d.push(h),V.forEach(h,function(_,y){(!(V.isUndefined(_)||_===null)&&s.call(e,_,V.isString(y)?y.trim():y,g,m))===!0&&p(_,g?g.concat(y):[y])}),d.pop()}}if(!V.isObject(t))throw new TypeError("data must be an object");return p(t),e}function Og(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function xf(t,e){this._pairs=[],t&&Zc(t,this,e)}const $y=xf.prototype;$y.append=function(e,n){this._pairs.push([e,n])};$y.toString=function(e){const n=e?function(r){return e.call(this,r,Og)}:Og;return this._pairs.map(function(s){return n(s[0])+"="+n(s[1])},"").join("&")};function S3(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function qy(t,e,n){if(!e)return t;const r=n&&n.encode||S3;V.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let a;if(s?a=s(e,n):a=V.isURLSearchParams(e)?e.toString():new xf(e,n).toString(r),a){const i=t.indexOf("#");i!==-1&&(t=t.slice(0,i)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class kg{constructor(){this.handlers=[]}use(e,n,r){return this.handlers.push({fulfilled:e,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){V.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Vy={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},A3=typeof URLSearchParams<"u"?URLSearchParams:xf,C3=typeof FormData<"u"?FormData:null,v3=typeof Blob<"u"?Blob:null,O3={isBrowser:!0,classes:{URLSearchParams:A3,FormData:C3,Blob:v3},protocols:["http","https","file","blob","url","data"]},Lf=typeof window<"u"&&typeof document<"u",gh=typeof navigator=="object"&&navigator||void 0,k3=Lf&&(!gh||["ReactNative","NativeScript","NS"].indexOf(gh.product)<0),I3=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",N3=Lf&&window.location.href||"http://localhost",R3=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Lf,hasStandardBrowserEnv:k3,hasStandardBrowserWebWorkerEnv:I3,navigator:gh,origin:N3},Symbol.toStringTag,{value:"Module"})),Ft={...R3,...O3};function P3(t,e){return Zc(t,new Ft.classes.URLSearchParams,Object.assign({visitor:function(n,r,s,a){return Ft.isNode&&V.isBuffer(n)?(this.append(r,n.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function x3(t){return V.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function L3(t){const e={},n=Object.keys(t);let r;const s=n.length;let a;for(r=0;r<s;r++)a=n[r],e[a]=t[a];return e}function zy(t){function e(n,r,s,a){let i=n[a++];if(i==="__proto__")return!0;const o=Number.isFinite(+i),u=a>=n.length;return i=!i&&V.isArray(s)?s.length:i,u?(V.hasOwnProp(s,i)?s[i]=[s[i],r]:s[i]=r,!o):((!s[i]||!V.isObject(s[i]))&&(s[i]=[]),e(n,r,s[i],a)&&V.isArray(s[i])&&(s[i]=L3(s[i])),!o)}if(V.isFormData(t)&&V.isFunction(t.entries)){const n={};return V.forEachEntry(t,(r,s)=>{e(x3(r),s,n,0)}),n}return null}function D3(t,e,n){if(V.isString(t))try{return(e||JSON.parse)(t),V.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(0,JSON.stringify)(t)}const bo={transitional:Vy,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const r=n.getContentType()||"",s=r.indexOf("application/json")>-1,a=V.isObject(e);if(a&&V.isHTMLForm(e)&&(e=new FormData(e)),V.isFormData(e))return s?JSON.stringify(zy(e)):e;if(V.isArrayBuffer(e)||V.isBuffer(e)||V.isStream(e)||V.isFile(e)||V.isBlob(e)||V.isReadableStream(e))return e;if(V.isArrayBufferView(e))return e.buffer;if(V.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return P3(e,this.formSerializer).toString();if((o=V.isFileList(e))||r.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return Zc(o?{"files[]":e}:e,u&&new u,this.formSerializer)}}return a||s?(n.setContentType("application/json",!1),D3(e)):e}],transformResponse:[function(e){const n=this.transitional||bo.transitional,r=n&&n.forcedJSONParsing,s=this.responseType==="json";if(V.isResponse(e)||V.isReadableStream(e))return e;if(e&&V.isString(e)&&(r&&!this.responseType||s)){const i=!(n&&n.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(o){if(i)throw o.name==="SyntaxError"?Ce.from(o,Ce.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ft.classes.FormData,Blob:Ft.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};V.forEach(["delete","get","head","post","put","patch"],t=>{bo.headers[t]={}});const M3=V.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),B3=t=>{const e={};let n,r,s;return t&&t.split(`
`).forEach(function(i){s=i.indexOf(":"),n=i.substring(0,s).trim().toLowerCase(),r=i.substring(s+1).trim(),!(!n||e[n]&&M3[n])&&(n==="set-cookie"?e[n]?e[n].push(r):e[n]=[r]:e[n]=e[n]?e[n]+", "+r:r)}),e},Ig=Symbol("internals");function ja(t){return t&&String(t).trim().toLowerCase()}function Tu(t){return t===!1||t==null?t:V.isArray(t)?t.map(Tu):String(t)}function F3(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(t);)e[r[1]]=r[2];return e}const U3=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Jl(t,e,n,r,s){if(V.isFunction(r))return r.call(this,e,n);if(s&&(e=n),!!V.isString(e)){if(V.isString(r))return e.indexOf(r)!==-1;if(V.isRegExp(r))return r.test(e)}}function j3(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,r)=>n.toUpperCase()+r)}function H3(t,e){const n=V.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+n,{value:function(s,a,i){return this[r].call(this,e,s,a,i)},configurable:!0})})}class sn{constructor(e){e&&this.set(e)}set(e,n,r){const s=this;function a(o,u,c){const l=ja(u);if(!l)throw new Error("header name must be a non-empty string");const d=V.findKey(s,l);(!d||s[d]===void 0||c===!0||c===void 0&&s[d]!==!1)&&(s[d||u]=Tu(o))}const i=(o,u)=>V.forEach(o,(c,l)=>a(c,l,u));if(V.isPlainObject(e)||e instanceof this.constructor)i(e,n);else if(V.isString(e)&&(e=e.trim())&&!U3(e))i(B3(e),n);else if(V.isHeaders(e))for(const[o,u]of e.entries())a(u,o,r);else e!=null&&a(n,e,r);return this}get(e,n){if(e=ja(e),e){const r=V.findKey(this,e);if(r){const s=this[r];if(!n)return s;if(n===!0)return F3(s);if(V.isFunction(n))return n.call(this,s,r);if(V.isRegExp(n))return n.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=ja(e),e){const r=V.findKey(this,e);return!!(r&&this[r]!==void 0&&(!n||Jl(this,this[r],r,n)))}return!1}delete(e,n){const r=this;let s=!1;function a(i){if(i=ja(i),i){const o=V.findKey(r,i);o&&(!n||Jl(r,r[o],o,n))&&(delete r[o],s=!0)}}return V.isArray(e)?e.forEach(a):a(e),s}clear(e){const n=Object.keys(this);let r=n.length,s=!1;for(;r--;){const a=n[r];(!e||Jl(this,this[a],a,e,!0))&&(delete this[a],s=!0)}return s}normalize(e){const n=this,r={};return V.forEach(this,(s,a)=>{const i=V.findKey(r,a);if(i){n[i]=Tu(s),delete n[a];return}const o=e?j3(a):String(a).trim();o!==a&&delete n[a],n[o]=Tu(s),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return V.forEach(this,(r,s)=>{r!=null&&r!==!1&&(n[s]=e&&V.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const r=new this(e);return n.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[Ig]=this[Ig]={accessors:{}}).accessors,s=this.prototype;function a(i){const o=ja(i);r[o]||(H3(s,i),r[o]=!0)}return V.isArray(e)?e.forEach(a):a(e),this}}sn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);V.reduceDescriptors(sn.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[n]=r}}});V.freezeMethods(sn);function Xl(t,e){const n=this||bo,r=e||n,s=sn.from(r.headers);let a=r.data;return V.forEach(t,function(o){a=o.call(n,a,s.normalize(),e?e.status:void 0)}),s.normalize(),a}function Wy(t){return!!(t&&t.__CANCEL__)}function ka(t,e,n){Ce.call(this,t??"canceled",Ce.ERR_CANCELED,e,n),this.name="CanceledError"}V.inherits(ka,Ce,{__CANCEL__:!0});function Gy(t,e,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?t(n):e(new Ce("Request failed with status code "+n.status,[Ce.ERR_BAD_REQUEST,Ce.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function $3(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function q3(t,e){t=t||10;const n=new Array(t),r=new Array(t);let s=0,a=0,i;return e=e!==void 0?e:1e3,function(u){const c=Date.now(),l=r[a];i||(i=c),n[s]=u,r[s]=c;let d=a,m=0;for(;d!==s;)m+=n[d++],d=d%t;if(s=(s+1)%t,s===a&&(a=(a+1)%t),c-i<e)return;const p=l&&c-l;return p?Math.round(m*1e3/p):void 0}}function V3(t,e){let n=0,r=1e3/e,s,a;const i=(c,l=Date.now())=>{n=l,s=null,a&&(clearTimeout(a),a=null),t.apply(null,c)};return[(...c)=>{const l=Date.now(),d=l-n;d>=r?i(c,l):(s=c,a||(a=setTimeout(()=>{a=null,i(s)},r-d)))},()=>s&&i(s)]}const tc=(t,e,n=3)=>{let r=0;const s=q3(50,250);return V3(a=>{const i=a.loaded,o=a.lengthComputable?a.total:void 0,u=i-r,c=s(u),l=i<=o;r=i;const d={loaded:i,total:o,progress:o?i/o:void 0,bytes:u,rate:c||void 0,estimated:c&&o&&l?(o-i)/c:void 0,event:a,lengthComputable:o!=null,[e?"download":"upload"]:!0};t(d)},n)},Ng=(t,e)=>{const n=t!=null;return[r=>e[0]({lengthComputable:n,total:t,loaded:r}),e[1]]},Rg=t=>(...e)=>V.asap(()=>t(...e)),z3=Ft.hasStandardBrowserEnv?((t,e)=>n=>(n=new URL(n,Ft.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new URL(Ft.origin),Ft.navigator&&/(msie|trident)/i.test(Ft.navigator.userAgent)):()=>!0,W3=Ft.hasStandardBrowserEnv?{write(t,e,n,r,s,a){const i=[t+"="+encodeURIComponent(e)];V.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),V.isString(r)&&i.push("path="+r),V.isString(s)&&i.push("domain="+s),a===!0&&i.push("secure"),document.cookie=i.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function G3(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function K3(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Ky(t,e){return t&&!G3(e)?K3(t,e):e}const Pg=t=>t instanceof sn?{...t}:t;function Os(t,e){e=e||{};const n={};function r(c,l,d,m){return V.isPlainObject(c)&&V.isPlainObject(l)?V.merge.call({caseless:m},c,l):V.isPlainObject(l)?V.merge({},l):V.isArray(l)?l.slice():l}function s(c,l,d,m){if(V.isUndefined(l)){if(!V.isUndefined(c))return r(void 0,c,d,m)}else return r(c,l,d,m)}function a(c,l){if(!V.isUndefined(l))return r(void 0,l)}function i(c,l){if(V.isUndefined(l)){if(!V.isUndefined(c))return r(void 0,c)}else return r(void 0,l)}function o(c,l,d){if(d in e)return r(c,l);if(d in t)return r(void 0,c)}const u={url:a,method:a,data:a,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:o,headers:(c,l,d)=>s(Pg(c),Pg(l),d,!0)};return V.forEach(Object.keys(Object.assign({},t,e)),function(l){const d=u[l]||s,m=d(t[l],e[l],l);V.isUndefined(m)&&d!==o||(n[l]=m)}),n}const Yy=t=>{const e=Os({},t);let{data:n,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:a,headers:i,auth:o}=e;e.headers=i=sn.from(i),e.url=qy(Ky(e.baseURL,e.url),t.params,t.paramsSerializer),o&&i.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let u;if(V.isFormData(n)){if(Ft.hasStandardBrowserEnv||Ft.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((u=i.getContentType())!==!1){const[c,...l]=u?u.split(";").map(d=>d.trim()).filter(Boolean):[];i.setContentType([c||"multipart/form-data",...l].join("; "))}}if(Ft.hasStandardBrowserEnv&&(r&&V.isFunction(r)&&(r=r(e)),r||r!==!1&&z3(e.url))){const c=s&&a&&W3.read(a);c&&i.set(s,c)}return e},Y3=typeof XMLHttpRequest<"u",Z3=Y3&&function(t){return new Promise(function(n,r){const s=Yy(t);let a=s.data;const i=sn.from(s.headers).normalize();let{responseType:o,onUploadProgress:u,onDownloadProgress:c}=s,l,d,m,p,h;function g(){p&&p(),h&&h(),s.cancelToken&&s.cancelToken.unsubscribe(l),s.signal&&s.signal.removeEventListener("abort",l)}let b=new XMLHttpRequest;b.open(s.method.toUpperCase(),s.url,!0),b.timeout=s.timeout;function _(){if(!b)return;const E=sn.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),w={data:!o||o==="text"||o==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:E,config:t,request:b};Gy(function(v){n(v),g()},function(v){r(v),g()},w),b=null}"onloadend"in b?b.onloadend=_:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(_)},b.onabort=function(){b&&(r(new Ce("Request aborted",Ce.ECONNABORTED,t,b)),b=null)},b.onerror=function(){r(new Ce("Network Error",Ce.ERR_NETWORK,t,b)),b=null},b.ontimeout=function(){let I=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const w=s.transitional||Vy;s.timeoutErrorMessage&&(I=s.timeoutErrorMessage),r(new Ce(I,w.clarifyTimeoutError?Ce.ETIMEDOUT:Ce.ECONNABORTED,t,b)),b=null},a===void 0&&i.setContentType(null),"setRequestHeader"in b&&V.forEach(i.toJSON(),function(I,w){b.setRequestHeader(w,I)}),V.isUndefined(s.withCredentials)||(b.withCredentials=!!s.withCredentials),o&&o!=="json"&&(b.responseType=s.responseType),c&&([m,h]=tc(c,!0),b.addEventListener("progress",m)),u&&b.upload&&([d,p]=tc(u),b.upload.addEventListener("progress",d),b.upload.addEventListener("loadend",p)),(s.cancelToken||s.signal)&&(l=E=>{b&&(r(!E||E.type?new ka(null,t,b):E),b.abort(),b=null)},s.cancelToken&&s.cancelToken.subscribe(l),s.signal&&(s.signal.aborted?l():s.signal.addEventListener("abort",l)));const y=$3(s.url);if(y&&Ft.protocols.indexOf(y)===-1){r(new Ce("Unsupported protocol "+y+":",Ce.ERR_BAD_REQUEST,t));return}b.send(a||null)})},J3=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let r=new AbortController,s;const a=function(c){if(!s){s=!0,o();const l=c instanceof Error?c:this.reason;r.abort(l instanceof Ce?l:new ka(l instanceof Error?l.message:l))}};let i=e&&setTimeout(()=>{i=null,a(new Ce(`timeout ${e} of ms exceeded`,Ce.ETIMEDOUT))},e);const o=()=>{t&&(i&&clearTimeout(i),i=null,t.forEach(c=>{c.unsubscribe?c.unsubscribe(a):c.removeEventListener("abort",a)}),t=null)};t.forEach(c=>c.addEventListener("abort",a));const{signal:u}=r;return u.unsubscribe=()=>V.asap(o),u}},X3=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let r=0,s;for(;r<n;)s=r+e,yield t.slice(r,s),r=s},Q3=async function*(t,e){for await(const n of ex(t))yield*X3(n,e)},ex=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:r}=await e.read();if(n)break;yield r}}finally{await e.cancel()}},xg=(t,e,n,r)=>{const s=Q3(t,e);let a=0,i,o=u=>{i||(i=!0,r&&r(u))};return new ReadableStream({async pull(u){try{const{done:c,value:l}=await s.next();if(c){o(),u.close();return}let d=l.byteLength;if(n){let m=a+=d;n(m)}u.enqueue(new Uint8Array(l))}catch(c){throw o(c),c}},cancel(u){return o(u),s.return()}},{highWaterMark:2})},Jc=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Zy=Jc&&typeof ReadableStream=="function",tx=Jc&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),Jy=(t,...e)=>{try{return!!t(...e)}catch{return!1}},nx=Zy&&Jy(()=>{let t=!1;const e=new Request(Ft.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),Lg=64*1024,bh=Zy&&Jy(()=>V.isReadableStream(new Response("").body)),nc={stream:bh&&(t=>t.body)};Jc&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!nc[e]&&(nc[e]=V.isFunction(t[e])?n=>n[e]():(n,r)=>{throw new Ce(`Response type '${e}' is not supported`,Ce.ERR_NOT_SUPPORT,r)})})})(new Response);const rx=async t=>{if(t==null)return 0;if(V.isBlob(t))return t.size;if(V.isSpecCompliantForm(t))return(await new Request(Ft.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(V.isArrayBufferView(t)||V.isArrayBuffer(t))return t.byteLength;if(V.isURLSearchParams(t)&&(t=t+""),V.isString(t))return(await tx(t)).byteLength},sx=async(t,e)=>{const n=V.toFiniteNumber(t.getContentLength());return n??rx(e)},ax=Jc&&(async t=>{let{url:e,method:n,data:r,signal:s,cancelToken:a,timeout:i,onDownloadProgress:o,onUploadProgress:u,responseType:c,headers:l,withCredentials:d="same-origin",fetchOptions:m}=Yy(t);c=c?(c+"").toLowerCase():"text";let p=J3([s,a&&a.toAbortSignal()],i),h;const g=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let b;try{if(u&&nx&&n!=="get"&&n!=="head"&&(b=await sx(l,r))!==0){let w=new Request(e,{method:"POST",body:r,duplex:"half"}),R;if(V.isFormData(r)&&(R=w.headers.get("content-type"))&&l.setContentType(R),w.body){const[v,j]=Ng(b,tc(Rg(u)));r=xg(w.body,Lg,v,j)}}V.isString(d)||(d=d?"include":"omit");const _="credentials"in Request.prototype;h=new Request(e,{...m,signal:p,method:n.toUpperCase(),headers:l.normalize().toJSON(),body:r,duplex:"half",credentials:_?d:void 0});let y=await fetch(h);const E=bh&&(c==="stream"||c==="response");if(bh&&(o||E&&g)){const w={};["status","statusText","headers"].forEach(F=>{w[F]=y[F]});const R=V.toFiniteNumber(y.headers.get("content-length")),[v,j]=o&&Ng(R,tc(Rg(o),!0))||[];y=new Response(xg(y.body,Lg,v,()=>{j&&j(),g&&g()}),w)}c=c||"text";let I=await nc[V.findKey(nc,c)||"text"](y,t);return!E&&g&&g(),await new Promise((w,R)=>{Gy(w,R,{data:I,headers:sn.from(y.headers),status:y.status,statusText:y.statusText,config:t,request:h})})}catch(_){throw g&&g(),_&&_.name==="TypeError"&&/fetch/i.test(_.message)?Object.assign(new Ce("Network Error",Ce.ERR_NETWORK,t,h),{cause:_.cause||_}):Ce.from(_,_&&_.code,t,h)}}),_h={http:E3,xhr:Z3,fetch:ax};V.forEach(_h,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const Dg=t=>`- ${t}`,ix=t=>V.isFunction(t)||t===null||t===!1,Xy={getAdapter:t=>{t=V.isArray(t)?t:[t];const{length:e}=t;let n,r;const s={};for(let a=0;a<e;a++){n=t[a];let i;if(r=n,!ix(n)&&(r=_h[(i=String(n)).toLowerCase()],r===void 0))throw new Ce(`Unknown adapter '${i}'`);if(r)break;s[i||"#"+a]=r}if(!r){const a=Object.entries(s).map(([o,u])=>`adapter ${o} `+(u===!1?"is not supported by the environment":"is not available in the build"));let i=e?a.length>1?`since :
`+a.map(Dg).join(`
`):" "+Dg(a[0]):"as no adapter specified";throw new Ce("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return r},adapters:_h};function Ql(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new ka(null,t)}function Mg(t){return Ql(t),t.headers=sn.from(t.headers),t.data=Xl.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Xy.getAdapter(t.adapter||bo.adapter)(t).then(function(r){return Ql(t),r.data=Xl.call(t,t.transformResponse,r),r.headers=sn.from(r.headers),r},function(r){return Wy(r)||(Ql(t),r&&r.response&&(r.response.data=Xl.call(t,t.transformResponse,r.response),r.response.headers=sn.from(r.response.headers))),Promise.reject(r)})}const Qy="1.7.9",Xc={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Xc[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const Bg={};Xc.transitional=function(e,n,r){function s(a,i){return"[Axios v"+Qy+"] Transitional option '"+a+"'"+i+(r?". "+r:"")}return(a,i,o)=>{if(e===!1)throw new Ce(s(i," has been removed"+(n?" in "+n:"")),Ce.ERR_DEPRECATED);return n&&!Bg[i]&&(Bg[i]=!0,console.warn(s(i," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(a,i,o):!0}};Xc.spelling=function(e){return(n,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function ox(t,e,n){if(typeof t!="object")throw new Ce("options must be an object",Ce.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let s=r.length;for(;s-- >0;){const a=r[s],i=e[a];if(i){const o=t[a],u=o===void 0||i(o,a,t);if(u!==!0)throw new Ce("option "+a+" must be "+u,Ce.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Ce("Unknown option "+a,Ce.ERR_BAD_OPTION)}}const Su={assertOptions:ox,validators:Xc},er=Su.validators;class _s{constructor(e){this.defaults=e,this.interceptors={request:new kg,response:new kg}}async request(e,n){try{return await this._request(e,n)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const a=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}catch{}}throw r}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=Os(this.defaults,n);const{transitional:r,paramsSerializer:s,headers:a}=n;r!==void 0&&Su.assertOptions(r,{silentJSONParsing:er.transitional(er.boolean),forcedJSONParsing:er.transitional(er.boolean),clarifyTimeoutError:er.transitional(er.boolean)},!1),s!=null&&(V.isFunction(s)?n.paramsSerializer={serialize:s}:Su.assertOptions(s,{encode:er.function,serialize:er.function},!0)),Su.assertOptions(n,{baseUrl:er.spelling("baseURL"),withXsrfToken:er.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let i=a&&V.merge(a.common,a[n.method]);a&&V.forEach(["delete","get","head","post","put","patch","common"],h=>{delete a[h]}),n.headers=sn.concat(i,a);const o=[];let u=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(n)===!1||(u=u&&g.synchronous,o.unshift(g.fulfilled,g.rejected))});const c=[];this.interceptors.response.forEach(function(g){c.push(g.fulfilled,g.rejected)});let l,d=0,m;if(!u){const h=[Mg.bind(this),void 0];for(h.unshift.apply(h,o),h.push.apply(h,c),m=h.length,l=Promise.resolve(n);d<m;)l=l.then(h[d++],h[d++]);return l}m=o.length;let p=n;for(d=0;d<m;){const h=o[d++],g=o[d++];try{p=h(p)}catch(b){g.call(this,b);break}}try{l=Mg.call(this,p)}catch(h){return Promise.reject(h)}for(d=0,m=c.length;d<m;)l=l.then(c[d++],c[d++]);return l}getUri(e){e=Os(this.defaults,e);const n=Ky(e.baseURL,e.url);return qy(n,e.params,e.paramsSerializer)}}V.forEach(["delete","get","head","options"],function(e){_s.prototype[e]=function(n,r){return this.request(Os(r||{},{method:e,url:n,data:(r||{}).data}))}});V.forEach(["post","put","patch"],function(e){function n(r){return function(a,i,o){return this.request(Os(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:i}))}}_s.prototype[e]=n(),_s.prototype[e+"Form"]=n(!0)});class Df{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(a){n=a});const r=this;this.promise.then(s=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](s);r._listeners=null}),this.promise.then=s=>{let a;const i=new Promise(o=>{r.subscribe(o),a=o}).then(s);return i.cancel=function(){r.unsubscribe(a)},i},e(function(a,i,o){r.reason||(r.reason=new ka(a,i,o),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=r=>{e.abort(r)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new Df(function(s){e=s}),cancel:e}}}function ux(t){return function(n){return t.apply(null,n)}}function cx(t){return V.isObject(t)&&t.isAxiosError===!0}const yh={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(yh).forEach(([t,e])=>{yh[e]=t});function e1(t){const e=new _s(t),n=Ry(_s.prototype.request,e);return V.extend(n,_s.prototype,e,{allOwnKeys:!0}),V.extend(n,e,null,{allOwnKeys:!0}),n.create=function(s){return e1(Os(t,s))},n}const Ye=e1(bo);Ye.Axios=_s;Ye.CanceledError=ka;Ye.CancelToken=Df;Ye.isCancel=Wy;Ye.VERSION=Qy;Ye.toFormData=Zc;Ye.AxiosError=Ce;Ye.Cancel=Ye.CanceledError;Ye.all=function(e){return Promise.all(e)};Ye.spread=ux;Ye.isAxiosError=cx;Ye.mergeConfig=Os;Ye.AxiosHeaders=sn;Ye.formToJSON=t=>zy(V.isHTMLForm(t)?new FormData(t):t);Ye.getAdapter=Xy.getAdapter;Ye.HttpStatusCode=yh;Ye.default=Ye;async function zi(t){if(!t||t.length==0)return[0,0];const e={method:"POST",url:P2+"/admin-api/aigc/balance/token",headers:{"content-type":"application/json"},data:{apikey:t.replace("sk-","")}};let n=await Ye.request(e);return!n||n.status!=200?[0,0]:n.data.data}function lx(t){let e,n,r,s=t[0].balanceQuery+"",a,i,o,u=t[0].accountBalance+"",c,l,d,m,p,h,g=t[0].validUntil+"",b,_,y=new Date(t[3]).toLocaleString()+"",E,I,w,R,v,j=t[0].refresh+"",F,x,H;return{c(){e=M("label"),n=M("div"),r=M("span"),a=Ke(s),i=ee(),o=M("div"),c=Ke(u),l=Ke(" : "),d=Ke(t[2]),m=Ke(` 
      `),p=M("br"),h=ee(),b=Ke(g),_=Ke(" : "),E=Ke(y),I=ee(),w=M("span"),R=ee(),v=M("button"),F=Ke(j),T(r,"class","title"),T(o,"class","b3-label__text"),T(n,"class","fn__flex-1"),T(w,"class","fn__space"),T(v,"class","b3-button b3-button--outline fn__flex-center fn__size200"),T(e,"class","item-wrap fn__flex b3-label config__item")},m(te,Z){ce(te,e,Z),O(e,n),O(n,r),O(r,a),O(n,i),O(n,o),O(o,c),O(o,l),O(o,d),O(o,m),O(o,p),O(o,h),O(o,b),O(o,_),O(o,E),O(e,I),O(e,w),O(e,R),O(e,v),O(v,F),x||(H=ne(v,"click",t[4]),x=!0)},p(te,[Z]){Z&1&&s!==(s=te[0].balanceQuery+"")&&lt(a,s),Z&1&&u!==(u=te[0].accountBalance+"")&&lt(c,u),Z&4&&lt(d,te[2]),Z&1&&g!==(g=te[0].validUntil+"")&&lt(b,g),Z&8&&y!==(y=new Date(te[3]).toLocaleString()+"")&&lt(E,y),Z&1&&j!==(j=te[0].refresh+"")&&lt(F,j)},i:Ze,o:Ze,d(te){te&&oe(e),x=!1,H()}}}function dx(t,e,n){let{i18n:r}=e,{apiKey:s}=e,a=0,i=0;Rr(async()=>{await zi(s).then(u=>{n(2,a=Math.round(u.money*10)/10),n(3,i=u.expiredTime*1e3)})});const o=async()=>{zi(s).then(u=>{n(3,i=u.expiredTime*1e3),n(2,a=Math.round(u.money*10)/10)})};return t.$$set=u=>{"i18n"in u&&n(0,r=u.i18n),"apiKey"in u&&n(1,s=u.apiKey)},[r,s,a,i,o]}let hx=class extends tt{constructor(e){super(),et(this,e,dx,lx,Qe,{i18n:0,apiKey:1})}};function Fg(t,e,n){const r=t.slice();return r[13]=e[n],r[14]=e,r[15]=n,r}function Ug(t){let e=t[5].buyKeyOnTaobao+"",n,r,s;return{c(){n=Ke(e),r=ee(),s=M("div"),s.innerHTML='<img src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/taobao.png" alt="" style="max-width: 200px; height: auto;"/>',T(s,"class","config__img-container")},m(a,i){ce(a,n,i),ce(a,r,i),ce(a,s,i)},p:Ze,d(a){a&&(oe(n),oe(r),oe(s))}}}function fx(t){var i,o,u,c;let e,n,r;function s(l){t[10](l,t[13])}let a={type:t[13].type,key:t[13].key,placeholder:(i=t[13])==null?void 0:i.placeholder,options:(o=t[13])==null?void 0:o.options,slider:(u=t[13])==null?void 0:u.slider,button:(c=t[13])==null?void 0:c.button};return t[13].value!==void 0&&(a.value=t[13].value),e=new Ny.Input({props:a}),ue.push(()=>pe(e,"value",s)),e.$on("click",t[6]),e.$on("changed",t[7]),{c(){De(e.$$.fragment)},m(l,d){Pe(e,l,d),r=!0},p(l,d){var p,h,g,b;t=l;const m={};d&4&&(m.type=t[13].type),d&4&&(m.key=t[13].key),d&4&&(m.placeholder=(p=t[13])==null?void 0:p.placeholder),d&4&&(m.options=(h=t[13])==null?void 0:h.options),d&4&&(m.slider=(g=t[13])==null?void 0:g.slider),d&4&&(m.button=(b=t[13])==null?void 0:b.button),!n&&d&4&&(n=!0,m.value=t[13].value,me(()=>n=!1)),e.$set(m)},i(l){r||(ie(e.$$.fragment,l),r=!0)},o(l){de(e.$$.fragment,l),r=!1},d(l){xe(e,l)}}}function jg(t,e){var a;let n,r,s;return r=new Ny.Wrap({props:{title:e[13].title,description:e[13].description,direction:(a=e[13])==null?void 0:a.direction,$$slots:{default:[fx]},$$scope:{ctx:e}}}),{key:t,first:null,c(){n=ao(),De(r.$$.fragment),this.first=n},m(i,o){ce(i,n,o),Pe(r,i,o),s=!0},p(i,o){var c;e=i;const u={};o&4&&(u.title=e[13].title),o&4&&(u.description=e[13].description),o&4&&(u.direction=(c=e[13])==null?void 0:c.direction),o&2052&&(u.$$scope={dirty:o,ctx:e}),r.$set(u)},i(i){s||(ie(r.$$.fragment,i),s=!0)},o(i){de(r.$$.fragment,i),s=!1},d(i){i&&oe(n),xe(r,i)}}}function Hg(t){let e,n;return e=new hx({props:{apiKey:t[1].getValue("apiKey"),i18n:t[5]}}),{c(){De(e.$$.fragment)},m(r,s){Pe(e,r,s),n=!0},p(r,s){const a={};s&2&&(a.apiKey=r[1].getValue("apiKey")),e.$set(a)},i(r){n||(ie(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){xe(e,r)}}}function mx(t){let e,n,r,s=[],a=new Map,i,o,u;const c=t[9].default,l=af(c,t,t[11],null);let d=t[3]&&Ug(t),m=_t(t[2]);const p=g=>g[13].key;for(let g=0;g<m.length;g+=1){let b=Fg(t,m,g),_=p(b);a.set(_,s[g]=jg(_,b))}let h=t[3]&&Hg(t);return{c(){e=M("div"),l&&l.c(),n=ee(),d&&d.c(),r=ee();for(let g=0;g<s.length;g+=1)s[g].c();i=ee(),h&&h.c(),T(e,"class",o="config__tab-container "+t[4]),T(e,"data-name",t[0])},m(g,b){ce(g,e,b),l&&l.m(e,null),O(e,n),d&&d.m(e,null),O(e,r);for(let _=0;_<s.length;_+=1)s[_]&&s[_].m(e,null);O(e,i),h&&h.m(e,null),u=!0},p(g,[b]){l&&l.p&&(!u||b&2048)&&uf(l,c,g,g[11],u?of(c,g[11],b,null):cf(g[11]),null),g[3]?d?d.p(g,b):(d=Ug(g),d.c(),d.m(e,r)):d&&(d.d(1),d=null),b&196&&(m=_t(g[2]),hr(),s=v_(s,b,p,1,g,m,a,e,S2,jg,i,Fg),fr()),g[3]?h?(h.p(g,b),b&8&&ie(h,1)):(h=Hg(g),h.c(),ie(h,1),h.m(e,null)):h&&(hr(),de(h,1,1,()=>{h=null}),fr()),(!u||b&16&&o!==(o="config__tab-container "+g[4]))&&T(e,"class",o),(!u||b&1)&&T(e,"data-name",g[0])},i(g){if(!u){ie(l,g);for(let b=0;b<m.length;b+=1)ie(s[b]);ie(h),u=!0}},o(g){de(l,g);for(let b=0;b<s.length;b+=1)de(s[b]);de(h),u=!1},d(g){g&&oe(e),l&&l.d(g),d&&d.d();for(let b=0;b<s.length;b+=1)s[b].d();h&&h.d()}}}function px(t,e,n){let r,s,{$$slots:a={},$$scope:i}=e,{group:o}=e,{settingStorage:u}=e,{display:c=!0}=e,l=u.getSettingItems(o);const d=u.plugin.i18n,m=yn();function p({detail:b}){m("click",{key:b.key})}function h({detail:b}){m("changed",{group:o,...b})}function g(b,_){t.$$.not_equal(_.value,b)&&(_.value=b,n(2,l))}return t.$$set=b=>{"group"in b&&n(0,o=b.group),"settingStorage"in b&&n(1,u=b.settingStorage),"display"in b&&n(8,c=b.display),"$$scope"in b&&n(11,i=b.$$scope)},t.$$.update=()=>{t.$$.dirty&256&&n(4,r=c?"":"fn__none"),t.$$.dirty&1&&n(3,s=o===" ")},[o,u,l,s,r,d,p,h,c,a,g,i]}class t1 extends tt{constructor(e){super(),et(this,e,px,mx,Qe,{group:0,settingStorage:1,display:8})}}function gx(t){let e,n,r;return n=new t1({props:{group:t[1],settingStorage:t[0],display:!0}}),n.$on("changed",t[2]),{c(){e=M("div"),De(n.$$.fragment),St(e,"margin-top","10px"),St(e,"padding","10px"),St(e,"background","none"),St(e,"border-radius","4px"),St(e,"border","1px solid var(--b3-border-color)")},m(s,a){ce(s,e,a),Pe(n,e,null),r=!0},p(s,[a]){const i={};a&2&&(i.group=s[1]),a&1&&(i.settingStorage=s[0]),n.$set(i)},i(s){r||(ie(n.$$.fragment,s),r=!0)},o(s){de(n.$$.fragment,s),r=!1},d(s){s&&oe(e),xe(n)}}}function bx(t,e,n){let{settingStorage:r}=e,{group:s}=e;const a=({detail:i})=>{r.setValue(i.key,i.value),r.save()};return t.$$set=i=>{"settingStorage"in i&&n(0,r=i.settingStorage),"group"in i&&n(1,s=i.group)},[r,s,a]}class Mf extends tt{constructor(e){super(),et(this,e,bx,gx,Qe,{settingStorage:0,group:1})}}const os=class os{constructor(e){Te(this,"apiKey");this.apiKey=e}async embedDocuments(e){const n=await this.requestEmbedding({inputs:e});if(!n||!n.data)throw console.debug("Failed to get embedding"),new Error("Failed to get embedding");return n.data.data.map(r=>r.embedding)}async embedQuery(e){const n=await this.requestEmbedding({inputs:e});if(!n||!n.data)throw console.debug("Failed to get embedding"),new Error("Failed to get embedding");return n.data.data[0].embedding}async requestEmbedding(e){return await this.retryRequest(0,e)}async retryRequest(e,n){try{const r={Authorization:`Bearer ${this.apiKey}`},s=typeof n.inputs=="string"?Math.random()<.97?gp:pp:Math.random()<.97?pp:gp;return await Ye.post(s,n,{headers:r})}catch{if(e<os.MAX_RETRIES)return console.debug(`${os.RETRY_DELAY/1e3}${e+1}`),await new Promise(s=>setTimeout(s,os.RETRY_DELAY)),this.retryRequest(e+1,n)}}};Te(os,"MAX_RETRIES",3),Te(os,"RETRY_DELAY",1e3);let Eh=os;class _x extends gt{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e==null?void 0:e.callbacks,this.tags=(e==null?void 0:e.tags)??[],this.metadata=(e==null?void 0:e.metadata)??{},this.verbose=(e==null?void 0:e.verbose)??!1}_getRelevantDocuments(e,n){throw new Error("Not implemented!")}async invoke(e,n){return this.getRelevantDocuments(e,$e(n))}async getRelevantDocuments(e,n){const r=$e(_y(n)),s=await Ut.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),a=await(s==null?void 0:s.handleRetrieverStart(this.toJSON(),e,r.runId,void 0,void 0,void 0,r.runName));try{const i=await this._getRelevantDocuments(e,a);return await(a==null?void 0:a.handleRetrieverEnd(i)),i}catch(i){throw await(a==null?void 0:a.handleRetrieverError(i)),i}}}class ed extends _x{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,n){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},n==null?void 0:n.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,n==null?void 0:n.getChild("vectorstore"))}async addDocuments(e,n){return this.vectorStore.addDocuments(e,n)}}class yx extends Yr{constructor(e,n){super(n),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,n=4,r=void 0,s=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),n,r)).map(i=>i[0])}async similaritySearchWithScore(e,n=4,r=void 0,s=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),n,r)}static fromTexts(e,n,r,s){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,n,r){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,n,r,s,a,i){if(typeof e=="number")return new ed({vectorStore:this,k:e,filter:n,tags:[...s??[],this._vectorstoreType()],metadata:a,verbose:i,callbacks:r});{const o={vectorStore:this,k:e==null?void 0:e.k,filter:e==null?void 0:e.filter,tags:[...(e==null?void 0:e.tags)??[],this._vectorstoreType()],metadata:e==null?void 0:e.metadata,verbose:e==null?void 0:e.verbose,callbacks:e==null?void 0:e.callbacks,searchType:e==null?void 0:e.searchType};return(e==null?void 0:e.searchType)==="mmr"?new ed({...o,searchKwargs:e.searchKwargs}):new ed({...o})}}}function Ex(t,e){let n=0,r=0,s=0;for(let a=0;a<t.length;a++)n+=t[a]*e[a],r+=t[a]*t[a],s+=e[a]*e[a];return n/(Math.sqrt(r)*Math.sqrt(s))}function wx(t,e){let n=0,r=0,s=0;for(let a=0;a<t.length;a++)n+=t[a]*e[a],r+=t[a]*t[a],s+=e[a]*e[a];return n/(Math.sqrt(r)*Math.sqrt(s))}function Tx(t,e,n){if(t.length===0||t[0].length===0||e.length===0||e[0].length===0)return[[]];if(t[0].length!==e[0].length)throw new Error(`Number of columns in X and Y must be the same. X has shape ${[t.length,t[0].length]} and Y has shape ${[e.length,e[0].length]}.`);return t.map(r=>e.map(s=>n(r,s)).map(s=>Number.isNaN(s)?0:s))}function $g(t,e){return Tx(t,e,wx)}function Sx(t,e,n=.5,r=4){if(Math.min(r,e.length)<=0)return[];const s=Array.isArray(t[0])?t:[t],a=$g(s,e)[0],i=Ax(a).maxIndex,o=[e[i]],u=[i];for(;u.length<Math.min(r,e.length);){let c=-1/0,l=-1;const d=$g(e,o);a.forEach((m,p)=>{if(u.includes(p))return;const h=Math.max(...d[p]),g=n*m-(1-n)*h;g>c&&(c=g,l=p)}),o.push(e[l]),u.push(l)}return u}function Ax(t){if(t.length===0)return{maxIndex:-1,maxValue:NaN};let e=t[0],n=0;for(let r=1;r<t.length;r+=1)t[r]>e&&(n=r,e=t[r]);return{maxIndex:n,maxValue:e}}class Bf extends yx{_vectorstoreType(){return"memory"}constructor(e,{similarity:n,...r}={}){super(e,r),Object.defineProperty(this,"memoryVectors",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"similarity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.similarity=n??Ex}async addDocuments(e){const n=e.map(({pageContent:r})=>r);return this.addVectors(await this.embeddings.embedDocuments(n),e)}async addVectors(e,n){const r=e.map((s,a)=>({content:n[a].pageContent,embedding:s,metadata:n[a].metadata,id:n[a].id}));this.memoryVectors=this.memoryVectors.concat(r)}async _queryVectors(e,n,r){const s=i=>{if(!r)return!0;const o=new ls({metadata:i.metadata,pageContent:i.content,id:i.id});return r(o)};return this.memoryVectors.filter(s).map((i,o)=>({similarity:this.similarity(e,i.embedding),index:o,metadata:i.metadata,content:i.content,embedding:i.embedding,id:i.id})).sort((i,o)=>i.similarity>o.similarity?-1:0).slice(0,n)}async similaritySearchVectorWithScore(e,n,r){return(await this._queryVectors(e,n,r)).map(i=>[new ls({metadata:i.metadata,pageContent:i.content,id:i.id}),i.similarity])}async maxMarginalRelevanceSearch(e,n){const r=await this.embeddings.embedQuery(e),s=await this._queryVectors(r,n.fetchK??20,n.filter),a=s.map(o=>o.embedding);return Sx(r,a,n.lambda,n.k).map(o=>new ls({metadata:s[o].metadata,pageContent:s[o].content,id:s[o].id}))}static async fromTexts(e,n,r,s){const a=[];for(let i=0;i<e.length;i+=1){const o=Array.isArray(n)?n[i]:n,u=new ls({pageContent:e[i],metadata:o});a.push(u)}return Bf.fromDocuments(a,r,s)}static async fromDocuments(e,n,r){const s=new this(n,r);return await s.addDocuments(e),s}static async fromExistingIndex(e,n){return new this(e,n)}}class n1 extends po{constructor(n,r,s,a){super(n,r);Te(this,"apiKey");Te(this,"phone");this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this.apiKey=s,this.phone=a}}class Cx extends n1{constructor(n,r,s,a){super(n,r,s,a);Te(this,"memoryVectorStore");Te(this,"embeddingService");this.name=r??Zd,this.plugin.removeData(this.file),this.embeddingService=new Eh(s),this.memoryVectorStore=new Bf(this.embeddingService)}async customLoadData(n){console.debug("MemoryVectorStorage::customLoadData"),n=n||this.file;const r=`/ai/${n}`,s=await x2(r);return(s==null?void 0:s.code)==404?[]:s}async load(){console.debug("MemoryVectorStorage::load");const n=await zi(this.apiKey);if((n==null?void 0:n.money)>0&&(n==null?void 0:n.expiredTime)>Math.floor(Date.now()/1e3)){const r=await this.customLoadData(this.file);r&&(this.memoryVectorStore.memoryVectors=r)}}async save(){console.debug("MemoryVectorStorage::save"),await this.customSaveData(this.memoryVectorStore.memoryVectors)}async release(){console.debug("MemoryVectorStorage::release"),this.memoryVectorStore.memoryVectors=[]}async embeddingBlocks(){console.debug("MemoryVectorStorage::embeddingBlocks"),await this.load();let n=new Map;return this.memoryVectorStore.memoryVectors.map(r=>{n.set(r.metadata.blockId,r.metadata.docId)}),n}async getDocuments(){return console.debug("MemoryVectorStorage::getDocuments"),this.memoryVectorStore.memoryVectors.map(n=>new ls({pageContent:n.content,metadata:n.metadata}))}async addDocuments(n){console.debug("MemoryVectorStorage::addDocuments");const r=n.map(a=>a.pageContent),s=await this.embeddingService.embedDocuments(r);return await this.memoryVectorStore.addVectors(s,n),!0}async deleteDocument(n){console.debug("MemoryVectorStorage::deleteDocument");const r=this.memoryVectorStore.memoryVectors.findIndex(s=>s.metadata.blockId===n.blockId);return r!==-1?(this.memoryVectorStore.memoryVectors.splice(r,1),await this.save(),!0):!1}async deleteDocuments(n){console.debug("MemoryVectorStorage::deleteDocuments");const r=new Set(n.map(s=>s.blockId));return this.memoryVectorStore.memoryVectors=this.memoryVectorStore.memoryVectors.filter(s=>!r.has(s.metadata.blockId)),await this.save(),!0}async addVectors(n,r){return console.debug("MemoryVectorStorage::addVectors"),this.memoryVectorStore.addVectors(n,r)}async similaritySearch(n,r=3){return console.debug("MemoryVectorStorage::similaritySearch"),this.memoryVectorStore.similaritySearch(n,r)}async similaritySearchWithScore(n,r=3){return console.debug("MemoryVectorStorage::similaritySearchWithScore"),this.memoryVectorStore.similaritySearchWithScore(n,r)}}class vx extends n1{constructor(n,r,s,a){super(n,r,s,a);Te(this,"baseUrl",df)}async embeddingBlocks(){console.debug("MilvusVectorStorage::embeddingBlocks");const n={phone:this.phone},r=await Ye.post(`${this.baseUrl}/list`,n);let s=new Map;return r.data.map(a=>{s.set(a.block_id,a.document_id)}),s}async release(){}async save(n){}async load(){}transformDocumentToRequestData(n){return{phone:this.phone,block_id:n.metadata.blockId,document_id:n.metadata.docId,content:n.pageContent,is_summary:n.metadata.isSummary}}async makeRequest(n,r){try{const s={Authorization:`Bearer ${this.apiKey}`};return(await Ye.post(`${this.baseUrl}${n}`,r,{headers:s})).status===200}catch(s){return console.error(`API: ${n}`,s),!1}}async getDocuments(){try{const n={Authorization:`Bearer ${this.apiKey}`},r=await Ye.post(`${this.baseUrl}/list`,{phone:this.phone},{headers:n});return r.status===200?r.data.map(s=>this.transformHitToDocument(s)):[]}catch(n){return console.error(":",n),[]}}async addDocuments(n){const r=n.map(this.transformDocumentToRequestData.bind(this));return this.makeRequest("/add",r)}async deleteDocument(n){console.debug("MilvusVectorStorage::deleteDocument");const r=[{phone:this.phone,block_id:n.blockId,document_id:n.docId}];return this.makeRequest("/delete",r)}async deleteDocuments(n){console.debug("MilvusVectorStorage::deleteDocuments",n);const r=n.map(s=>({phone:this.phone,block_id:s.blockId,document_id:s.docId}));return this.makeRequest("/delete",r)}async addVectors(n,r){}transformHitToDocument(n){return new ls({pageContent:n.content,metadata:{blockId:n.block_id,docId:n.document_id,isSummary:n.is_summary}})}async similaritySearch(n,r){try{const s={Authorization:`Bearer ${this.apiKey}`},a=await Ye.post(`${this.baseUrl}/search`,{phone:this.phone,query:n,top_k:r},{headers:s});return a.status===200?a.data.map(i=>this.transformHitToDocument(i)):[]}catch(s){return console.error(":",s),[]}}async similaritySearchWithScore(n,r){try{const s={Authorization:`Bearer ${this.apiKey}`},a=await Ye.post(`${this.baseUrl}/search`,{phone:this.phone,query:n,top_k:r},{headers:s});return a.status===200?a.data.map(i=>[this.transformHitToDocument(i),i.distance]):[]}catch(s){return console.error(":",s),[]}}}async function rc(t,e){const n=df+"/extractFileContent";let r=new FormData;r.append("file",t,t.name),r.append("purpose","file-extract");const s={Authorization:e};return(await Ye.post(n,r,{headers:s})).data.content}function qg(t){let e,n=t[7]?"":"...",r,s,a,i;return{c(){e=M("button"),r=Ke(n),T(e,"type","button"),T(e,"class","generation-text svelte-k9nhz1"),T(e,"aria-label",s=t[7]?"":"...")},m(o,u){ce(o,e,u),O(e,r),a||(i=[ne(e,"mouseenter",t[17]),ne(e,"mouseleave",t[18]),ne(e,"click",t[9]),ne(e,"keydown",t[19])],a=!0)},p(o,u){u&128&&n!==(n=o[7]?"":"...")&&lt(r,n),u&128&&s!==(s=o[7]?"":"...")&&T(e,"aria-label",s)},d(o){o&&oe(e),a=!1,st(i)}}}function Ox(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,h,g,b,_,y,E,I,w,R,v,j,F,x,H,te,Z,N,S=t[6]&&qg(t);function P(D){t[20](D)}let U={type:"select",key:"modelSelections",fnSize:!1,options:t[5].get("modelSelections").options,style:"margin-right: 6px; font-size: 12px; padding: 2px 4px; border-radius: 4px; border: none ;outline: none; height: 2em; background: transparent; align-self: center;margin-left: auto;"};return t[0]!==void 0&&(U.value=t[0]),x=new Xr({props:U}),ue.push(()=>pe(x,"value",P)),x.$on("changed",t[21]),{c(){e=M("div"),n=M("button"),r=pt("svg"),s=pt("path"),a=pt("path"),i=ee(),o=M("button"),u=pt("svg"),c=pt("path"),l=ee(),d=M("button"),m=pt("svg"),p=pt("path"),h=ee(),g=M("button"),b=M("input"),_=ee(),y=M("label"),y.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" class="svelte-k9nhz1"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><path d="M13 2v7h7"></path></svg>',E=ee(),I=M("button"),w=M("input"),R=ee(),v=M("label"),v.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" class="svelte-k9nhz1"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><path d="m21 15-5-5L5 21"></path></svg>',j=ee(),S&&S.c(),F=ee(),De(x.$$.fragment),T(s,"d","M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"),T(a,"d","M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c.26.604.852.997 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1Z"),T(r,"viewBox","0 0 24 24"),T(r,"width","16"),T(r,"height","16"),T(r,"stroke","currentColor"),T(r,"stroke-width","2"),T(r,"fill","none"),T(r,"class","svelte-k9nhz1"),T(n,"title",t[8].settings),T(n,"class","svelte-k9nhz1"),T(c,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"),T(u,"viewBox","0 0 24 24"),T(u,"width","16"),T(u,"height","16"),T(u,"stroke","currentColor"),T(u,"stroke-width","2"),T(u,"fill","none"),T(u,"class","svelte-k9nhz1"),T(o,"title",t[8].onlineSearch),T(o,"class","svelte-k9nhz1"),_e(o,"active",t[1]),T(p,"d","M21 5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5zm-2 14H5V5h14v14zM7 15h10v2H7v-2zm0-4h10v2H7v-2zm0-4h10v2H7V7z"),T(m,"viewBox","0 0 24 24"),T(m,"width","16"),T(m,"height","16"),T(m,"stroke","currentColor"),T(m,"stroke-width","2"),T(m,"fill","none"),T(m,"class","svelte-k9nhz1"),T(d,"title",t[8].knowledgeBase),T(d,"class","svelte-k9nhz1"),_e(d,"active",t[2]),T(b,"type","file"),T(b,"accept",".pdf,.docx,.md,.txt"),St(b,"display","none"),T(b,"id","file-upload"),T(y,"for","file-upload"),St(y,"cursor","pointer"),T(g,"title",t[8].file),T(g,"class","svelte-k9nhz1"),_e(g,"active",t[4].length>0),T(w,"type","file"),T(w,"accept","image/*"),St(w,"display","none"),T(w,"id","image-upload"),T(v,"for","image-upload"),St(v,"cursor","pointer"),T(I,"title",t[8].image),T(I,"class","svelte-k9nhz1"),_e(I,"active",t[3].length>0),T(e,"class","tools-container svelte-k9nhz1")},m(D,W){ce(D,e,W),O(e,n),O(n,r),O(r,s),O(r,a),O(e,i),O(e,o),O(o,u),O(u,c),O(e,l),O(e,d),O(d,m),O(m,p),O(e,h),O(e,g),O(g,b),O(g,_),O(g,y),O(e,E),O(e,I),O(I,w),O(I,R),O(I,v),O(e,j),S&&S.m(e,null),O(e,F),Pe(x,e,null),te=!0,Z||(N=[ne(n,"click",t[13]),ne(o,"click",t[11]),ne(d,"click",t[12]),ne(b,"change",t[10]),ne(w,"change",t[14])],Z=!0)},p(D,[W]){(!te||W&2)&&_e(o,"active",D[1]),(!te||W&4)&&_e(d,"active",D[2]),(!te||W&16)&&_e(g,"active",D[4].length>0),(!te||W&8)&&_e(I,"active",D[3].length>0),D[6]?S?S.p(D,W):(S=qg(D),S.c(),S.m(e,F)):S&&(S.d(1),S=null);const K={};W&32&&(K.options=D[5].get("modelSelections").options),!H&&W&1&&(H=!0,K.value=D[0],me(()=>H=!1)),x.$set(K)},i(D){te||(ie(x.$$.fragment,D),te=!0)},o(D){de(x.$$.fragment,D),te=!1},d(D){D&&oe(e),S&&S.d(),xe(x),Z=!1,st(N)}}}function kx(t,e,n){let{settingStorage:r}=e,{documentVectorStorage:s}=e,{selectedModel:a}=e,{isSearchEnabled:i}=e,{isKnowledgeEnabled:o}=e,{imageUrl:u=""}=e,{fileContent:c=""}=e,{isInterrupted:l=!1}=e,{isGenerating:d=!1}=e,m=r.i18n,p=!1;function h(){n(15,l=!0)}async function g(F){var x,H;try{const te=F.target,Z=(x=te.files)==null?void 0:x[0];if(!Z)return;switch((H=Z.name.split(".").pop())==null?void 0:H.toLowerCase()){case"txt":case"csv":case"md":const S=new FileReader;S.onload=P=>{var U;(U=P.target)!=null&&U.result&&(n(4,c=P.target.result),console.debug(c))},S.readAsText(Z);break;case"pdf":n(4,c=await rc(Z,r.getValue("apiKey")));break;default:n(4,c=await rc(Z,r.getValue("apiKey")))}te.value=""}catch(te){console.error(m.fileProcessingFailed,te),n(4,c="")}}function b(){n(1,i=!i),r.setValue("isSearchChat",i),r.save()}async function _(){n(2,o=!o),r.setValue("isKnowledgeBaseChat",o),r.save(),o?await s.load():(await s.save(),await s.release())}function y(){const F=new dt.Dialog({title:"",content:'<div id="chat-params-panel" style="height: 100%; margin:0px; padding:0px;"></div>',width:"40%",height:"40%",hideCloseIcon:!0});new Mf({target:F.element.querySelector("#chat-params-panel"),props:{settingStorage:r,group:"chat"}})}async function E(F){var te;const H=(te=F.target.files)==null?void 0:te[0];if(H)try{const Z=new FileReader;Z.onload=N=>{var S;(S=N.target)!=null&&S.result&&n(3,u=N.target.result)},console.debug(u),Z.readAsDataURL(H)}catch(Z){console.error(m.imageProcessingFailed,Z)}}const I=()=>n(7,p=!0),w=()=>n(7,p=!1),R=F=>F.key==="Enter"&&h();function v(F){a=F,n(0,a)}const j=({detail:F})=>{r.setValue(F.key,F.value),r.save()};return t.$$set=F=>{"settingStorage"in F&&n(5,r=F.settingStorage),"documentVectorStorage"in F&&n(16,s=F.documentVectorStorage),"selectedModel"in F&&n(0,a=F.selectedModel),"isSearchEnabled"in F&&n(1,i=F.isSearchEnabled),"isKnowledgeEnabled"in F&&n(2,o=F.isKnowledgeEnabled),"imageUrl"in F&&n(3,u=F.imageUrl),"fileContent"in F&&n(4,c=F.fileContent),"isInterrupted"in F&&n(15,l=F.isInterrupted),"isGenerating"in F&&n(6,d=F.isGenerating)},[a,i,o,u,c,r,d,p,m,h,g,b,_,y,E,l,s,I,w,R,v,j]}let Ix=class extends tt{constructor(e){super(),et(this,e,kx,Ox,Qe,{settingStorage:5,documentVectorStorage:16,selectedModel:0,isSearchEnabled:1,isKnowledgeEnabled:2,imageUrl:3,fileContent:4,isInterrupted:15,isGenerating:6})}};function Nx(t){let e,n,r,s,a,i=[{type:"button"},t[4],{class:r=["b3-button",t[3],t[2]].join(" ")},{style:t[1]}],o={};for(let u=0;u<i.length;u+=1)o=Du(o,i[u]);return{c(){e=M("button"),n=Ke(t[0]),fp(e,o)},m(u,c){ce(u,e,c),O(e,n),e.autofocus&&e.focus(),s||(a=ne(e,"click",t[8]),s=!0)},p(u,[c]){c&1&&m2(n,u[0],o.contenteditable),fp(e,o=A2(i,[{type:"button"},c&16&&u[4],c&12&&r!==(r=["b3-button",u[3],u[2]].join(" "))&&{class:r},c&2&&{style:u[1]}]))},i:Ze,o:Ze,d(u){u&&oe(e),s=!1,a()}}}function Rx(t,e,n){let r,s,a,{text:i=!1}=e,{outline:o=!1}=e,{backgroundColor:u=void 0}=e,{label:c=""}=e;function l(d){b2.call(this,t,d)}return t.$$set=d=>{n(4,e=Du(Du({},e),hp(d))),"text"in d&&n(5,i=d.text),"outline"in d&&n(6,o=d.outline),"backgroundColor"in d&&n(7,u=d.backgroundColor),"label"in d&&n(0,c=d.label)},t.$$.update=()=>{t.$$.dirty&64&&n(3,r=o?"b3-button--outline":""),t.$$.dirty&32&&n(2,s=i?"b3-button--text":""),t.$$.dirty&128&&n(1,a=u?`background-color: ${u}`:"")},e=hp(e),[c,a,s,r,e,i,o,u,l]}class sc extends tt{constructor(e){super(),et(this,e,Rx,Nx,Qe,{text:5,outline:6,backgroundColor:7,label:0})}}function Px(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,h,g,b;function _(w){t[3](w)}let y={type:"textinput",placeholder:"",key:"title",style:"width: 100%; margin-bottom: 16px;"};t[1].title!==void 0&&(y.value=t[1].title),s=new Xr({props:y}),ue.push(()=>pe(s,"value",_));function E(w){t[4](w)}let I={type:"textarea",placeholder:"",key:"content",style:"width: 100%; white-space: pre-wrap; word-wrap: break-word;"};return t[1].content!==void 0&&(I.value=t[1].content),o=new Xr({props:I}),ue.push(()=>pe(o,"value",E)),d=new sc({props:{label:"",text:!0,outline:!0}}),d.$on("click",t[5]),g=new sc({props:{label:"",text:!1,outline:!1}}),g.$on("click",t[6]),{c(){e=M("div"),n=M("div"),r=M("div"),De(s.$$.fragment),i=ee(),De(o.$$.fragment),c=ee(),l=M("div"),De(d.$$.fragment),m=ee(),p=M("div"),h=ee(),De(g.$$.fragment),T(r,"class","edit-content__body svelte-c66fm5"),T(p,"class","fn__space"),T(l,"class","b3-dialog__action svelte-c66fm5"),T(n,"class","edit-content svelte-c66fm5"),T(e,"class","edit-panel svelte-c66fm5")},m(w,R){ce(w,e,R),O(e,n),O(n,r),Pe(s,r,null),O(r,i),Pe(o,r,null),O(n,c),O(n,l),Pe(d,l,null),O(l,m),O(l,p),O(l,h),Pe(g,l,null),b=!0},p(w,[R]){const v={};!a&&R&2&&(a=!0,v.value=w[1].title,me(()=>a=!1)),s.$set(v);const j={};!u&&R&2&&(u=!0,j.value=w[1].content,me(()=>u=!1)),o.$set(j)},i(w){b||(ie(s.$$.fragment,w),ie(o.$$.fragment,w),ie(d.$$.fragment,w),ie(g.$$.fragment,w),b=!0)},o(w){de(s.$$.fragment,w),de(o.$$.fragment,w),de(d.$$.fragment,w),de(g.$$.fragment,w),b=!1},d(w){w&&oe(e),xe(s),xe(o),xe(d),xe(g)}}}function xx(t,e,n){let{showEditPanel:r=!1}=e,{currentPrompt:s}=e;const a=yn();function i(l){t.$$.not_equal(s.title,l)&&(s.title=l,n(1,s))}function o(l){t.$$.not_equal(s.content,l)&&(s.content=l,n(1,s))}const u=()=>n(0,r=!1),c=()=>a("save");return t.$$set=l=>{"showEditPanel"in l&&n(0,r=l.showEditPanel),"currentPrompt"in l&&n(1,s=l.currentPrompt)},[r,s,a,i,o,u,c]}class r1 extends tt{constructor(e){super(),et(this,e,xx,Px,Qe,{showEditPanel:0,currentPrompt:1})}}function Vg(t,e,n){const r=t.slice();return r[6]=e[n],r}function zg(t,e){let n,r,s,a=e[6].title+"",i,o,u,c,l,d,m,p,h,g,b;function _(){return e[3](e[6])}function y(){return e[4](e[6])}function E(){return e[5](e[6])}return{key:t,first:null,c(){n=M("div"),r=M("div"),s=M("span"),i=Ke(a),o=ee(),u=M("div"),c=M("button"),c.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconTrashcan"></use></svg>',l=ee(),d=M("button"),d.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconEdit"></use></svg>',m=ee(),p=M("button"),p.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconPlay"></use></svg>',h=ee(),T(s,"class","title"),T(r,"class","fn__flex-1"),T(c,"class","b3-list-item"),T(c,"title",""),T(d,"class","b3-list-item"),T(d,"title",""),T(p,"class","b3-list-item"),T(p,"title",""),T(u,"class","fn__flex"),T(n,"class","item-wrap fn__flex b3-label config__item prompt-item svelte-1706rdx"),St(n,"height","1.5em"),this.first=n},m(I,w){ce(I,n,w),O(n,r),O(r,s),O(s,i),O(n,o),O(n,u),O(u,c),O(u,l),O(u,d),O(u,m),O(u,p),O(n,h),g||(b=[ne(c,"click",_),ne(d,"click",y),ne(p,"click",E)],g=!0)},p(I,w){e=I,w&1&&a!==(a=e[6].title+"")&&lt(i,a)},d(I){I&&oe(n),g=!1,st(b)}}}function Lx(t){let e,n=[],r=new Map,s=_t(t[0]);const a=i=>i[6].id;for(let i=0;i<s.length;i+=1){let o=Vg(t,s,i),u=a(o);r.set(u,n[i]=zg(u,o))}return{c(){e=M("div");for(let i=0;i<n.length;i+=1)n[i].c();T(e,"class","b3-tab-bar b3-list b3-list--background")},m(i,o){ce(i,e,o);for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(e,null)},p(i,[o]){o&7&&(s=_t(i[0]),n=v_(n,o,a,1,i,s,r,e,T2,zg,null,Vg))},i:Ze,o:Ze,d(i){i&&oe(e);for(let o=0;o<n.length;o+=1)n[o].d()}}}function Dx(t,e,n){let{prompts:r}=e,{inputAreaComponent:s}=e;const a=yn(),i=c=>a("delete",c.id),o=c=>a("edit",c),u=c=>{a("use",c),s.focus()};return t.$$set=c=>{"prompts"in c&&n(0,r=c.prompts),"inputAreaComponent"in c&&n(1,s=c.inputAreaComponent)},[r,s,a,i,o,u]}class s1 extends tt{constructor(e){super(),et(this,e,Dx,Lx,Qe,{prompts:0,inputAreaComponent:1})}}function Wg(t){let e,n,r,s;function a(u){t[16](u)}function i(u){t[17](u)}let o={};return t[1]!==void 0&&(o.showEditPanel=t[1]),t[2]!==void 0&&(o.currentPrompt=t[2]),e=new r1({props:o}),ue.push(()=>pe(e,"showEditPanel",a)),ue.push(()=>pe(e,"currentPrompt",i)),e.$on("save",t[7]),{c(){De(e.$$.fragment)},m(u,c){Pe(e,u,c),s=!0},p(u,c){const l={};!n&&c&2&&(n=!0,l.showEditPanel=u[1],me(()=>n=!1)),!r&&c&4&&(r=!0,l.currentPrompt=u[2],me(()=>r=!1)),e.$set(l)},i(u){s||(ie(e.$$.fragment,u),s=!0)},o(u){de(e.$$.fragment,u),s=!1},d(u){xe(e,u)}}}function Mx(t){let e,n,r,s,a,i,o,u;s=new s1({props:{inputAreaComponent:t[0],prompts:t[3]}}),s.$on("edit",t[13]),s.$on("delete",t[14]),s.$on("use",t[15]);let c=t[1]&&Wg(t);return{c(){e=M("div"),n=M("button"),n.innerHTML='<span class="add-icon svelte-19yd9nj">+</span> <span class="btn-text svelte-19yd9nj"> Prompt</span>',r=ee(),De(s.$$.fragment),a=ee(),c&&c.c(),T(n,"class","add-prompt-btn svelte-19yd9nj"),T(e,"class","prompts-panel svelte-19yd9nj")},m(l,d){ce(l,e,d),O(e,n),O(e,r),Pe(s,e,null),O(e,a),c&&c.m(e,null),i=!0,o||(u=ne(n,"click",t[12]),o=!0)},p(l,[d]){const m={};d&1&&(m.inputAreaComponent=l[0]),d&8&&(m.prompts=l[3]),s.$set(m),l[1]?c?(c.p(l,d),d&2&&ie(c,1)):(c=Wg(l),c.c(),ie(c,1),c.m(e,null)):c&&(hr(),de(c,1,1,()=>{c=null}),fr())},i(l){i||(ie(s.$$.fragment,l),ie(c),i=!0)},o(l){de(s.$$.fragment,l),de(c),i=!1},d(l){l&&oe(e),xe(s),c&&c.d(),o=!1,u()}}}function Bx(t,e,n){let r,s,{promptStorage:a}=e,{searchText:i}=e,{inputAreaComponent:o}=e,{isCommand:u}=e,c=!1,l;const d=()=>({id:Date.now(),title:"",content:""}),m=yn();function p(v){a.deletePrompt(v),n(11,r=a.data)}function h(v){n(2,l=v?{...v}:d()),n(1,c=!0)}function g(v){n(8,i=v.content)}function b(){r.some(j=>j.id===l.id)?a.updatePrompt(l):a.addPrompt(l),n(1,c=!1),n(11,r=a.data)}const _=()=>h(),y=v=>h(v.detail),E=v=>p(v.detail),I=v=>g(v.detail);function w(v){c=v,n(1,c)}function R(v){l=v,n(2,l)}return t.$$set=v=>{"promptStorage"in v&&n(9,a=v.promptStorage),"searchText"in v&&n(8,i=v.searchText),"inputAreaComponent"in v&&n(0,o=v.inputAreaComponent),"isCommand"in v&&n(10,u=v.isCommand)},t.$$.update=()=>{t.$$.dirty&512&&n(11,r=a.data),t.$$.dirty&2304&&n(3,s=i.length>1?r.filter(v=>{const j=i.slice(1).toLowerCase();return v.title.toLowerCase().includes(j)||v.content.toLowerCase().includes(j)}):r),t.$$.dirty&256&&m("searchTextChange",i)},[o,c,l,s,p,h,g,b,i,a,u,r,_,y,E,I,w,R]}class Qc extends tt{constructor(e){super(),et(this,e,Bx,Mx,Qe,{promptStorage:9,searchText:8,inputAreaComponent:0,isCommand:10})}}function Fx(t){let e,n,r,s;return{c(){e=M("div"),n=M("textarea"),T(n,"placeholder","/Enter Shift + Enter "),n.disabled=t[0],T(n,"class","svelte-7ohy60"),T(e,"class","input-container svelte-7ohy60")},m(a,i){ce(a,e,i),O(e,n),t[7](n),bt(n,t[1]),r||(s=[ne(n,"input",t[8]),ne(n,"input",t[3]),ne(n,"keydown",t[4])],r=!0)},p(a,[i]){i&1&&(n.disabled=a[0]),i&2&&bt(n,a[1])},i:Ze,o:Ze,d(a){a&&oe(e),t[7](null),r=!1,st(s)}}}function Ux(t,e,n){let{promptStorage:r}=e,{isGenerating:s}=e,{draftMessage:a=""}=e,i=a,o;const u=yn();function c(h){const g=h.target;g.value==="/"&&g.selectionStart===1&&d()}function l(h){h.key==="Enter"&&!h.shiftKey&&!h.isComposing&&(h.preventDefault(),u("sendMessage",i),n(1,i=""),n(5,a=""))}function d(){const h=new dt.Dialog({title:"",content:'<div id="chat-prompts-panel" style="height: 100%; margin:0px; padding:0px;"></div>',width:"40%",hideCloseIcon:!0});new Qc({target:h.element.querySelector("#chat-prompts-panel"),props:{inputAreaComponent:o,promptStorage:r,searchText:i,isCommand:!1}}).$on("searchTextChange",b=>{n(1,i=b.detail),n(2,o.style.height="auto",o),n(2,o.style.height=`${o.scrollHeight}px`,o)})}Rr(()=>{o.focus()});function m(h){ue[h?"unshift":"push"](()=>{o=h,n(2,o)})}function p(){i=this.value,n(1,i)}return t.$$set=h=>{"promptStorage"in h&&n(6,r=h.promptStorage),"isGenerating"in h&&n(0,s=h.isGenerating),"draftMessage"in h&&n(5,a=h.draftMessage)},t.$$.update=()=>{t.$$.dirty&2&&n(5,a=i)},[s,i,o,c,l,a,r,m,p]}let jx=class extends tt{constructor(e){super(),et(this,e,Ux,Fx,Qe,{promptStorage:6,isGenerating:0,draftMessage:5})}};const Gs="0.32.1";let Gg=!1,gi,a1,wh,i1,o1,u1;function Hx(t,e={auto:!1}){if(Gg)throw new Error(`you must \`import '@anthropic-ai/sdk/shims/${t.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(gi)throw new Error(`can't \`import '@anthropic-ai/sdk/shims/${t.kind}'\` after \`import '@anthropic-ai/sdk/shims/${gi}'\``);Gg=e.auto,gi=t.kind,a1=t.fetch,wh=t.File,i1=t.ReadableStream,o1=t.getDefaultAgent,u1=t.fileFromPath}let $x=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function qx({manuallyImported:t}={}){const e=t?"You may need to use polyfills":"Add one of these imports before your first `import  from '@anthropic-ai/sdk'`:\n- `import '@anthropic-ai/sdk/shims/node'` (if you're running on Node)\n- `import '@anthropic-ai/sdk/shims/web'` (otherwise)\n";let n,r,s,a;try{n=fetch,r=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:n,Request:r,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new $x(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:i=>!1}}gi||Hx(qx(),{auto:!0});class qe extends Error{}let En=class Th extends qe{constructor(e,n,r,s){super(`${Th.makeMessage(e,n,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["request-id"],this.error=n}static makeMessage(e,n,r){const s=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,n,r,s){if(!e)return new el({message:r,cause:Ah(n)});const a=n;return e===400?new l1(e,a,r,s):e===401?new d1(e,a,r,s):e===403?new h1(e,a,r,s):e===404?new f1(e,a,r,s):e===409?new m1(e,a,r,s):e===422?new p1(e,a,r,s):e===429?new g1(e,a,r,s):e>=500?new b1(e,a,r,s):new Th(e,a,r,s)}},Fn=class extends En{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},el=class extends En{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,n&&(this.cause=n)}},c1=class extends el{constructor({message:e}={}){super({message:e??"Request timed out."})}},l1=class extends En{constructor(){super(...arguments),this.status=400}},d1=class extends En{constructor(){super(...arguments),this.status=401}},h1=class extends En{constructor(){super(...arguments),this.status=403}},f1=class extends En{constructor(){super(...arguments),this.status=404}},m1=class extends En{constructor(){super(...arguments),this.status=409}},p1=class extends En{constructor(){super(...arguments),this.status=422}},g1=class extends En{constructor(){super(...arguments),this.status=429}},b1=class extends En{},_o=class Sh{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let n=this.decodeText(e);if(this.trailingCR&&(n="\r"+n,this.trailingCR=!1),n.endsWith("\r")&&(this.trailingCR=!0,n=n.slice(0,-1)),!n)return[];const r=Sh.NEWLINE_CHARS.has(n[n.length-1]||"");let s=n.split(Sh.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new qe(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new qe(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new qe("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};_o.NEWLINE_CHARS=new Set([`
`,"\r"]);_o.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let Wi=class ni{constructor(e,n){this.iterator=e,this.controller=n}static fromSSEResponse(e,n){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const i of Vx(e,n)){if(i.event==="completion")try{yield JSON.parse(i.data)}catch(o){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),o}if(i.event==="message_start"||i.event==="message_delta"||i.event==="message_stop"||i.event==="content_block_start"||i.event==="content_block_delta"||i.event==="content_block_stop")try{yield JSON.parse(i.data)}catch(o){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),o}if(i.event!=="ping"&&i.event==="error")throw En.generate(void 0,`SSE Error: ${i.data}`,i.data,w1(e.headers))}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||n.abort()}}return new ni(s,n)}static fromReadableStream(e,n){let r=!1;async function*s(){const i=new _o,o=Ff(e);for await(const u of o)for(const c of i.decode(u))yield c;for(const u of i.flush())yield u}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||n.abort()}}return new ni(a,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],r=this.iterator(),s=a=>({next:()=>{if(a.length===0){const i=r.next();e.push(i),n.push(i)}return a.shift()}});return[new ni(()=>s(e),this.controller),new ni(()=>s(n),this.controller)]}toReadableStream(){const e=this;let n;const r=new TextEncoder;return new i1({async start(){n=e[Symbol.asyncIterator]()},async pull(s){try{const{value:a,done:i}=await n.next();if(i)return s.close();const o=r.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){var s;await((s=n.return)==null?void 0:s.call(n))}})}};async function*Vx(t,e){if(!t.body)throw e.abort(),new qe("Attempted to iterate over a response with no body");const n=new Gx,r=new _o,s=Ff(t.body);for await(const a of zx(s))for(const i of r.decode(a)){const o=n.decode(i);o&&(yield o)}for(const a of r.flush()){const i=n.decode(a);i&&(yield i)}}async function*zx(t){let e=new Uint8Array;for await(const n of t){if(n==null)continue;const r=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let a;for(;(a=Wx(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}function Wx(t){for(let r=0;r<t.length-2;r++){if(t[r]===10&&t[r+1]===10||t[r]===13&&t[r+1]===13)return r+2;if(t[r]===13&&t[r+1]===10&&r+3<t.length&&t[r+2]===13&&t[r+3]===10)return r+4}return-1}let Gx=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,s]=Kx(e,":");return s.startsWith(" ")&&(s=s.substring(1)),n==="event"?this.event=s:n==="data"&&this.data.push(s),null}};function Kx(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}function Ff(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Yx=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",Zx=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&tl(t),tl=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function";async function Jx(t,e,n){var s;if(t=await t,Zx(t))return t;if(Yx(t)){const a=await t.blob();e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=tl(a)?[await a.arrayBuffer()]:[a];return new wh(i,e,n)}const r=await Xx(t);if(e||(e=eL(t)??"unknown_file"),!(n!=null&&n.type)){const a=(s=r[0])==null?void 0:s.type;typeof a=="string"&&(n={...n,type:a})}return new wh(r,e,n)}async function Xx(t){var n;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(tl(t))e.push(await t.arrayBuffer());else if(tL(t))for await(const r of t)e.push(r);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${(n=t==null?void 0:t.constructor)==null?void 0:n.name}; props: ${Qx(t)}`);return e}function Qx(t){return`[${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}function eL(t){var e;return td(t.name)||td(t.filename)||((e=td(t.path))==null?void 0:e.split(/[\\/]/).pop())}const td=t=>{if(typeof t=="string")return t;if(typeof Buffer<"u"&&t instanceof Buffer)return String(t)},tL=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",Kg=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody";var nL=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},rL=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},Vo;async function _1(t){const{response:e}=t;if(t.options.stream)return aa("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):Wi.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const n=e.headers.get("content-type");if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.includes("application/vnd.api+json"))){const a=await e.json();return aa("response",e.status,e.url,e.headers,a),a}const s=await e.text();return aa("response",e.status,e.url,e.headers,s),s}let y1=class E1 extends Promise{constructor(e,n=_1){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=n}_thenUnwrap(e){return new E1(this.responsePromise,async n=>e(await this.parseResponse(n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},sL=class{constructor({baseURL:e,maxRetries:n=2,timeout:r=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=nd("maxRetries",n),this.timeout=nd("timeout",r),this.httpAgent=s,this.fetch=a??a1}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...lL(),...this.authHeaders(e)}}validateHeaders(e,n){}defaultIdempotencyKey(){return`stainless-node-retry-${pL()}`}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,r){return this.request(Promise.resolve(r).then(async s=>{const a=s&&tl(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:n,...s,body:a}}))}getAPIList(e,n,r){return this.requestAPIList(n,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:n=0}={}){var g;const{method:r,path:s,query:a,headers:i={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:Kg(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,u=this.calculateContentLength(o),c=this.buildURL(s,a);"timeout"in e&&nd("timeout",e.timeout);const l=e.timeout??this.timeout,d=e.httpAgent??this.httpAgent??o1(c),m=l+1e3;typeof((g=d==null?void 0:d.options)==null?void 0:g.timeout)=="number"&&m>(d.options.timeout??0)&&(d.options.timeout=m),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const p=this.buildHeaders({options:e,headers:i,contentLength:u,retryCount:n});return{req:{method:r,...o&&{body:o},headers:p,...d&&{agent:d},signal:e.signal??null},url:c,timeout:l}}buildHeaders({options:e,headers:n,contentLength:r,retryCount:s}){const a={};r&&(a["content-length"]=r);const i=this.defaultHeaders(e);return Xg(a,i),Xg(a,n),Kg(e.body)&&gi!=="node"&&delete a["content-type"],Qg(i,"x-stainless-retry-count")===void 0&&Qg(n,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(s)),this.validateHeaders(a,n),a}async prepareOptions(e){}async prepareRequest(e,{url:n,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(n=>[...n])):{...e}:{}}makeStatusError(e,n,r,s){return En.generate(e,n,r,s)}request(e,n=null){return new y1(this.makeRequest(e,n))}async makeRequest(e,n){var d,m;const r=await e,s=r.maxRetries??this.maxRetries;n==null&&(n=s),await this.prepareOptions(r);const{req:a,url:i,timeout:o}=this.buildRequest(r,{retryCount:s-n});if(await this.prepareRequest(a,{url:i,options:r}),aa("request",i,r,a.headers),(d=r.signal)!=null&&d.aborted)throw new Fn;const u=new AbortController,c=await this.fetchWithTimeout(i,a,o,u).catch(Ah);if(c instanceof Error){if((m=r.signal)!=null&&m.aborted)throw new Fn;if(n)return this.retryRequest(r,n);throw c.name==="AbortError"?new c1:new el({cause:c})}const l=w1(c.headers);if(!c.ok){if(n&&this.shouldRetry(c)){const y=`retrying, ${n} attempts remaining`;return aa(`response (error; ${y})`,c.status,i,l),this.retryRequest(r,n,l)}const p=await c.text().catch(y=>Ah(y).message),h=dL(p),g=h?void 0:p;throw aa(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,c.status,i,l,g),this.makeStatusError(c.status,h,g,l)}return{response:c,options:r,controller:u}}requestAPIList(e,n){const r=this.makeRequest(n,null);return new iL(this,r,e)}buildURL(e,n){const r=fL(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return ac(s)||(n={...s,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(r.search=this.stringifyQuery(n)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new qe(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,n,r,s){const{signal:a,...i}=n||{};a&&a.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...i}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,r){let s;const a=r==null?void 0:r["retry-after-ms"];if(a){const o=parseFloat(a);Number.isNaN(o)||(s=o)}const i=r==null?void 0:r["retry-after"];if(i&&!s){const o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(n,o)}return await mL(s),this.makeRequest(e,n-1)}calculateDefaultRetryTimeoutMillis(e,n){const a=n-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Gs}`}},aL=class{constructor(e,n,r,s){Vo.set(this,void 0),nL(this,Vo,e,"f"),this.options=s,this.response=n,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new qe("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...this.options};if("params"in e&&typeof n.query=="object")n.query={...n.query,...e.params};else if("url"in e){const r=[...Object.entries(n.query||{}),...e.url.searchParams.entries()];for(const[s,a]of r)e.url.searchParams.set(s,a);n.query=void 0,n.path=e.url.toString()}return await rL(this,Vo,"f").requestAPIList(this.constructor,n)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Vo=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const n of e.getPaginatedItems())yield n}},iL=class extends y1{constructor(e,n,r){super(n,async s=>new r(e,s.response,await _1(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const n of e)yield n}};const w1=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,n){const r=n.toString();return e[r.toLowerCase()]||e[r]}}),oL={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},zo=t=>typeof t=="object"&&t!==null&&!ac(t)&&Object.keys(t).every(e=>T1(oL,e)),uL=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gs,"X-Stainless-OS":Zg(Deno.build.os),"X-Stainless-Arch":Yg(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gs,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gs,"X-Stainless-OS":Zg(process.platform),"X-Stainless-Arch":Yg(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=cL();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gs,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gs,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function cL(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const r=n.exec(navigator.userAgent);if(r){const s=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}const Yg=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",Zg=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let Jg;const lL=()=>Jg??(Jg=uL()),dL=t=>{try{return JSON.parse(t)}catch{return}},hL=new RegExp("^(?:[a-z]+:)?//","i"),fL=t=>hL.test(t),mL=t=>new Promise(e=>setTimeout(e,t)),nd=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new qe(`${t} must be an integer`);if(e<0)throw new qe(`${t} must be a positive integer`);return e},Ah=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch{}return new Error(String(t))},rd=t=>{var e,n,r,s,a;if(typeof process<"u")return((n=(e=process.env)==null?void 0:e[t])==null?void 0:n.trim())??void 0;if(typeof Deno<"u")return(a=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,t))==null?void 0:a.trim()};function ac(t){if(!t)return!0;for(const e in t)return!1;return!0}function T1(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Xg(t,e){for(const n in e){if(!T1(e,n))continue;const r=n.toLowerCase();if(!r)continue;const s=e[n];s===null?delete t[r]:s!==void 0&&(t[r]=s)}}function aa(t,...e){var n;typeof process<"u"&&((n=process==null?void 0:process.env)==null?void 0:n.DEBUG)==="true"&&console.log(`Anthropic:DEBUG:${t}`,...e)}const pL=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),gL=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",bL=t=>typeof(t==null?void 0:t.get)=="function",Qg=(t,e)=>{var r;const n=e.toLowerCase();if(bL(t)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,i,o)=>i+o.toUpperCase());for(const a of[e,n,e.toUpperCase(),s]){const i=t.get(a);if(i)return i}}for(const[s,a]of Object.entries(t))if(s.toLowerCase()===n)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a};let _L=class extends aL{constructor(e,n,r,s){super(e,n,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.first_id=r.first_id||null,this.last_id=r.last_id||null}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const n=Object.fromEntries(e.url.searchParams);return Object.keys(n).length?n:null}nextPageInfo(){var n;if((n=this.options.query)!=null&&n.before_id){const r=this.first_id;return r?{params:{before_id:r}}:null}const e=this.last_id;return e?{params:{after_id:e}}:null}},Ps=class{constructor(e){this._client=e}};class Uf{constructor(e,n){this.iterator=e,this.controller=n}async*decoder(){const e=new _o;for await(const n of this.iterator)for(const r of e.decode(n))yield JSON.parse(r);for(const n of e.flush())yield JSON.parse(n)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,n){if(!e.body)throw n.abort(),new qe("Attempted to iterate over a response with no body");return new Uf(Ff(e.body),n)}}let jf=class extends Ps{create(e,n){const{betas:r,...s}=e;return this._client.post("/v1/messages/batches?beta=true",{body:s,...n,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...n==null?void 0:n.headers}})}retrieve(e,n={},r){if(zo(n))return this.retrieve(e,{},n);const{betas:s}=n;return this._client.get(`/v1/messages/batches/${e}?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}list(e={},n){if(zo(e))return this.list({},e);const{betas:r,...s}=e;return this._client.getAPIList("/v1/messages/batches?beta=true",Hf,{query:s,...n,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...n==null?void 0:n.headers}})}cancel(e,n={},r){if(zo(n))return this.cancel(e,{},n);const{betas:s}=n;return this._client.post(`/v1/messages/batches/${e}/cancel?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}async results(e,n={},r){if(zo(n))return this.results(e,{},n);const s=await this.retrieve(e);if(!s.results_url)throw new qe(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);const{betas:a}=n;return this._client.get(s.results_url,{...r,headers:{"anthropic-beta":[...a??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers},__binaryResponse:!0})._thenUnwrap((i,o)=>Uf.fromResponse(o.response,o.controller))}};class Hf extends _L{}jf.BetaMessageBatchesPage=Hf;let nl=class extends Ps{constructor(){super(...arguments),this.batches=new jf(this._client)}create(e,n){const{betas:r,...s}=e;return this._client.post("/v1/messages?beta=true",{body:s,timeout:this._client._options.timeout??6e5,...n,headers:{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0,...n==null?void 0:n.headers},stream:e.stream??!1})}countTokens(e,n){const{betas:r,...s}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:s,...n,headers:{"anthropic-beta":[...r??[],"token-counting-2024-11-01"].toString(),...n==null?void 0:n.headers}})}};nl.Batches=jf;nl.BetaMessageBatchesPage=Hf;const yL=t=>{let e=0,n=[];for(;e<t.length;){let r=t[e];if(r==="\\"){e++;continue}if(r==="{"){n.push({type:"brace",value:"{"}),e++;continue}if(r==="}"){n.push({type:"brace",value:"}"}),e++;continue}if(r==="["){n.push({type:"paren",value:"["}),e++;continue}if(r==="]"){n.push({type:"paren",value:"]"}),e++;continue}if(r===":"){n.push({type:"separator",value:":"}),e++;continue}if(r===","){n.push({type:"delimiter",value:","}),e++;continue}if(r==='"'){let o="",u=!1;for(r=t[++e];r!=='"';){if(e===t.length){u=!0;break}if(r==="\\"){if(e++,e===t.length){u=!0;break}o+=r+t[e],r=t[++e]}else o+=r,r=t[++e]}r=t[++e],u||n.push({type:"string",value:o});continue}if(r&&/\s/.test(r)){e++;continue}let a=/[0-9]/;if(r&&a.test(r)||r==="-"||r==="."){let o="";for(r==="-"&&(o+=r,r=t[++e]);r&&a.test(r)||r===".";)o+=r,r=t[++e];n.push({type:"number",value:o});continue}let i=/[a-z]/i;if(r&&i.test(r)){let o="";for(;r&&i.test(r)&&e!==t.length;)o+=r,r=t[++e];if(o=="true"||o=="false"||o==="null")n.push({type:"name",value:o});else{e++;continue}continue}e++}return n},Ks=t=>{if(t.length===0)return t;let e=t[t.length-1];switch(e.type){case"separator":return t=t.slice(0,t.length-1),Ks(t);case"number":let n=e.value[e.value.length-1];if(n==="."||n==="-")return t=t.slice(0,t.length-1),Ks(t);case"string":let r=t[t.length-2];if((r==null?void 0:r.type)==="delimiter")return t=t.slice(0,t.length-1),Ks(t);if((r==null?void 0:r.type)==="brace"&&r.value==="{")return t=t.slice(0,t.length-1),Ks(t);break;case"delimiter":return t=t.slice(0,t.length-1),Ks(t)}return t},EL=t=>{let e=[];return t.map(n=>{n.type==="brace"&&(n.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),n.type==="paren"&&(n.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(n=>{n==="}"?t.push({type:"brace",value:"}"}):n==="]"&&t.push({type:"paren",value:"]"})}),t},wL=t=>{let e="";return t.map(n=>{switch(n.type){case"string":e+='"'+n.value+'"';break;default:e+=n.value;break}}),e},S1=t=>JSON.parse(wL(EL(Ks(yL(t)))));var Kt=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},Me=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},wn,Mr,Wo,Go,Ha,$a,Ko,qa,_r,Va,Yo,Zo,Us,sd,e0,ad,id,od,ud,t0;const n0="__json_buf";class ic{constructor(){wn.add(this),this.messages=[],this.receivedMessages=[],Mr.set(this,void 0),this.controller=new AbortController,Wo.set(this,void 0),Go.set(this,()=>{}),Ha.set(this,()=>{}),$a.set(this,void 0),Ko.set(this,()=>{}),qa.set(this,()=>{}),_r.set(this,{}),Va.set(this,!1),Yo.set(this,!1),Zo.set(this,!1),Us.set(this,!1),ad.set(this,e=>{if(Kt(this,Yo,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Fn),e instanceof Fn)return Kt(this,Zo,!0,"f"),this._emit("abort",e);if(e instanceof qe)return this._emit("error",e);if(e instanceof Error){const n=new qe(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new qe(String(e)))}),Kt(this,Wo,new Promise((e,n)=>{Kt(this,Go,e,"f"),Kt(this,Ha,n,"f")}),"f"),Kt(this,$a,new Promise((e,n)=>{Kt(this,Ko,e,"f"),Kt(this,qa,n,"f")}),"f"),Me(this,Wo,"f").catch(()=>{}),Me(this,$a,"f").catch(()=>{})}static fromReadableStream(e){const n=new ic;return n._run(()=>n._fromReadableStream(e)),n}static createMessage(e,n,r){const s=new ic;for(const a of n.messages)s._addPromptCachingBetaMessageParam(a);return s._run(()=>s._createPromptCachingBetaMessage(e,{...n,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},Me(this,ad,"f"))}_addPromptCachingBetaMessageParam(e){this.messages.push(e)}_addPromptCachingBetaMessage(e,n=!0){this.receivedMessages.push(e),n&&this._emit("message",e)}async _createPromptCachingBetaMessage(e,n,r){var i;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Me(this,wn,"m",id).call(this);const a=await e.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of a)Me(this,wn,"m",od).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new Fn;Me(this,wn,"m",ud).call(this)}_connected(){this.ended||(Me(this,Go,"f").call(this),this._emit("connect"))}get ended(){return Me(this,Va,"f")}get errored(){return Me(this,Yo,"f")}get aborted(){return Me(this,Zo,"f")}abort(){this.controller.abort()}on(e,n){return(Me(this,_r,"f")[e]||(Me(this,_r,"f")[e]=[])).push({listener:n}),this}off(e,n){const r=Me(this,_r,"f")[e];if(!r)return this;const s=r.findIndex(a=>a.listener===n);return s>=0&&r.splice(s,1),this}once(e,n){return(Me(this,_r,"f")[e]||(Me(this,_r,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,r)=>{Kt(this,Us,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,n)})}async done(){Kt(this,Us,!0,"f"),await Me(this,$a,"f")}get currentMessage(){return Me(this,Mr,"f")}async finalMessage(){return await this.done(),Me(this,wn,"m",sd).call(this)}async finalText(){return await this.done(),Me(this,wn,"m",e0).call(this)}_emit(e,...n){if(Me(this,Va,"f"))return;e==="end"&&(Kt(this,Va,!0,"f"),Me(this,Ko,"f").call(this));const r=Me(this,_r,"f")[e];if(r&&(Me(this,_r,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...n))),e==="abort"){const s=n[0];!Me(this,Us,"f")&&!(r!=null&&r.length)&&Promise.reject(s),Me(this,Ha,"f").call(this,s),Me(this,qa,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=n[0];!Me(this,Us,"f")&&!(r!=null&&r.length)&&Promise.reject(s),Me(this,Ha,"f").call(this,s),Me(this,qa,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalPromptCachingBetaMessage",Me(this,wn,"m",sd).call(this))}async _fromReadableStream(e,n){var a;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Me(this,wn,"m",id).call(this),this._connected();const s=Wi.fromReadableStream(e,this.controller);for await(const i of s)Me(this,wn,"m",od).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new Fn;Me(this,wn,"m",ud).call(this)}[(Mr=new WeakMap,Wo=new WeakMap,Go=new WeakMap,Ha=new WeakMap,$a=new WeakMap,Ko=new WeakMap,qa=new WeakMap,_r=new WeakMap,Va=new WeakMap,Yo=new WeakMap,Zo=new WeakMap,Us=new WeakMap,ad=new WeakMap,wn=new WeakSet,sd=function(){if(this.receivedMessages.length===0)throw new qe("stream ended without producing a PromptCachingBetaMessage with role=assistant");return this.receivedMessages.at(-1)},e0=function(){if(this.receivedMessages.length===0)throw new qe("stream ended without producing a PromptCachingBetaMessage with role=assistant");const n=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(n.length===0)throw new qe("stream ended without producing a content block with type=text");return n.join(" ")},id=function(){this.ended||Kt(this,Mr,void 0,"f")},od=function(n){if(this.ended)return;const r=Me(this,wn,"m",t0).call(this,n);switch(this._emit("streamEvent",n,r),n.type){case"content_block_delta":{const s=r.content.at(-1);n.delta.type==="text_delta"&&s.type==="text"?this._emit("text",n.delta.text,s.text||""):n.delta.type==="input_json_delta"&&s.type==="tool_use"&&s.input&&this._emit("inputJson",n.delta.partial_json,s.input);break}case"message_stop":{this._addPromptCachingBetaMessageParam(r),this._addPromptCachingBetaMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{Kt(this,Mr,r,"f");break}}},ud=function(){if(this.ended)throw new qe("stream has ended, this shouldn't happen");const n=Me(this,Mr,"f");if(!n)throw new qe("request ended without sending any chunks");return Kt(this,Mr,void 0,"f"),n},t0=function(n){let r=Me(this,Mr,"f");if(n.type==="message_start"){if(r)throw new qe(`Unexpected event order, got ${n.type} before receiving "message_stop"`);return n.message}if(!r)throw new qe(`Unexpected event order, got ${n.type} before "message_start"`);switch(n.type){case"message_stop":return r;case"message_delta":return r.stop_reason=n.delta.stop_reason,r.stop_sequence=n.delta.stop_sequence,r.usage.output_tokens=n.usage.output_tokens,r;case"content_block_start":return r.content.push(n.content_block),r;case"content_block_delta":{const s=r.content.at(n.index);if((s==null?void 0:s.type)==="text"&&n.delta.type==="text_delta")s.text+=n.delta.text;else if((s==null?void 0:s.type)==="tool_use"&&n.delta.type==="input_json_delta"){let a=s[n0]||"";a+=n.delta.partial_json,Object.defineProperty(s,n0,{value:a,enumerable:!1,writable:!0}),a&&(s.input=S1(a))}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("streamEvent",s=>{const a=n.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>n.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Wi(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}let A1=class extends Ps{create(e,n){const{betas:r,...s}=e;return this._client.post("/v1/messages?beta=prompt_caching",{body:s,timeout:this._client._options.timeout??6e5,...n,headers:{"anthropic-beta":[...r??[],"prompt-caching-2024-07-31"].toString(),...n==null?void 0:n.headers},stream:e.stream??!1})}stream(e,n){return ic.createMessage(this,e,n)}};class $f extends Ps{constructor(){super(...arguments),this.messages=new A1(this._client)}}$f.Messages=A1;let rl=class extends Ps{constructor(){super(...arguments),this.messages=new nl(this._client),this.promptCaching=new $f(this._client)}};rl.Messages=nl;rl.PromptCaching=$f;let C1=class extends Ps{create(e,n){return this._client.post("/v1/complete",{body:e,timeout:this._client._options.timeout??6e5,...n,stream:e.stream??!1})}};var Yt=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},Be=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},Tn,Br,Jo,Xo,za,Wa,Qo,Ga,yr,Ka,eu,tu,js,cd,r0,ld,dd,hd,fd,s0;const a0="__json_buf";class oc{constructor(){Tn.add(this),this.messages=[],this.receivedMessages=[],Br.set(this,void 0),this.controller=new AbortController,Jo.set(this,void 0),Xo.set(this,()=>{}),za.set(this,()=>{}),Wa.set(this,void 0),Qo.set(this,()=>{}),Ga.set(this,()=>{}),yr.set(this,{}),Ka.set(this,!1),eu.set(this,!1),tu.set(this,!1),js.set(this,!1),ld.set(this,e=>{if(Yt(this,eu,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Fn),e instanceof Fn)return Yt(this,tu,!0,"f"),this._emit("abort",e);if(e instanceof qe)return this._emit("error",e);if(e instanceof Error){const n=new qe(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new qe(String(e)))}),Yt(this,Jo,new Promise((e,n)=>{Yt(this,Xo,e,"f"),Yt(this,za,n,"f")}),"f"),Yt(this,Wa,new Promise((e,n)=>{Yt(this,Qo,e,"f"),Yt(this,Ga,n,"f")}),"f"),Be(this,Jo,"f").catch(()=>{}),Be(this,Wa,"f").catch(()=>{})}static fromReadableStream(e){const n=new oc;return n._run(()=>n._fromReadableStream(e)),n}static createMessage(e,n,r){const s=new oc;for(const a of n.messages)s._addMessageParam(a);return s._run(()=>s._createMessage(e,{...n,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},Be(this,ld,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,n=!0){this.receivedMessages.push(e),n&&this._emit("message",e)}async _createMessage(e,n,r){var i;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Be(this,Tn,"m",dd).call(this);const a=await e.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of a)Be(this,Tn,"m",hd).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new Fn;Be(this,Tn,"m",fd).call(this)}_connected(){this.ended||(Be(this,Xo,"f").call(this),this._emit("connect"))}get ended(){return Be(this,Ka,"f")}get errored(){return Be(this,eu,"f")}get aborted(){return Be(this,tu,"f")}abort(){this.controller.abort()}on(e,n){return(Be(this,yr,"f")[e]||(Be(this,yr,"f")[e]=[])).push({listener:n}),this}off(e,n){const r=Be(this,yr,"f")[e];if(!r)return this;const s=r.findIndex(a=>a.listener===n);return s>=0&&r.splice(s,1),this}once(e,n){return(Be(this,yr,"f")[e]||(Be(this,yr,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,r)=>{Yt(this,js,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,n)})}async done(){Yt(this,js,!0,"f"),await Be(this,Wa,"f")}get currentMessage(){return Be(this,Br,"f")}async finalMessage(){return await this.done(),Be(this,Tn,"m",cd).call(this)}async finalText(){return await this.done(),Be(this,Tn,"m",r0).call(this)}_emit(e,...n){if(Be(this,Ka,"f"))return;e==="end"&&(Yt(this,Ka,!0,"f"),Be(this,Qo,"f").call(this));const r=Be(this,yr,"f")[e];if(r&&(Be(this,yr,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...n))),e==="abort"){const s=n[0];!Be(this,js,"f")&&!(r!=null&&r.length)&&Promise.reject(s),Be(this,za,"f").call(this,s),Be(this,Ga,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=n[0];!Be(this,js,"f")&&!(r!=null&&r.length)&&Promise.reject(s),Be(this,za,"f").call(this,s),Be(this,Ga,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",Be(this,Tn,"m",cd).call(this))}async _fromReadableStream(e,n){var a;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Be(this,Tn,"m",dd).call(this),this._connected();const s=Wi.fromReadableStream(e,this.controller);for await(const i of s)Be(this,Tn,"m",hd).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new Fn;Be(this,Tn,"m",fd).call(this)}[(Br=new WeakMap,Jo=new WeakMap,Xo=new WeakMap,za=new WeakMap,Wa=new WeakMap,Qo=new WeakMap,Ga=new WeakMap,yr=new WeakMap,Ka=new WeakMap,eu=new WeakMap,tu=new WeakMap,js=new WeakMap,ld=new WeakMap,Tn=new WeakSet,cd=function(){if(this.receivedMessages.length===0)throw new qe("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},r0=function(){if(this.receivedMessages.length===0)throw new qe("stream ended without producing a Message with role=assistant");const n=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(n.length===0)throw new qe("stream ended without producing a content block with type=text");return n.join(" ")},dd=function(){this.ended||Yt(this,Br,void 0,"f")},hd=function(n){if(this.ended)return;const r=Be(this,Tn,"m",s0).call(this,n);switch(this._emit("streamEvent",n,r),n.type){case"content_block_delta":{const s=r.content.at(-1);n.delta.type==="text_delta"&&s.type==="text"?this._emit("text",n.delta.text,s.text||""):n.delta.type==="input_json_delta"&&s.type==="tool_use"&&s.input&&this._emit("inputJson",n.delta.partial_json,s.input);break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{Yt(this,Br,r,"f");break}}},fd=function(){if(this.ended)throw new qe("stream has ended, this shouldn't happen");const n=Be(this,Br,"f");if(!n)throw new qe("request ended without sending any chunks");return Yt(this,Br,void 0,"f"),n},s0=function(n){let r=Be(this,Br,"f");if(n.type==="message_start"){if(r)throw new qe(`Unexpected event order, got ${n.type} before receiving "message_stop"`);return n.message}if(!r)throw new qe(`Unexpected event order, got ${n.type} before "message_start"`);switch(n.type){case"message_stop":return r;case"message_delta":return r.stop_reason=n.delta.stop_reason,r.stop_sequence=n.delta.stop_sequence,r.usage.output_tokens=n.usage.output_tokens,r;case"content_block_start":return r.content.push(n.content_block),r;case"content_block_delta":{const s=r.content.at(n.index);if((s==null?void 0:s.type)==="text"&&n.delta.type==="text_delta")s.text+=n.delta.text;else if((s==null?void 0:s.type)==="tool_use"&&n.delta.type==="input_json_delta"){let a=s[a0]||"";a+=n.delta.partial_json,Object.defineProperty(s,a0,{value:a,enumerable:!1,writable:!0}),a&&(s.input=S1(a))}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("streamEvent",s=>{const a=n.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>n.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Wi(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}let v1=class extends Ps{create(e,n){return e.model in i0&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${i0[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages",{body:e,timeout:this._client._options.timeout??6e5,...n,stream:e.stream??!1})}stream(e,n){return oc.createMessage(this,e,n)}};const i0={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024"};var O1;class it extends sL{constructor({baseURL:e=rd("ANTHROPIC_BASE_URL"),apiKey:n=rd("ANTHROPIC_API_KEY")??null,authToken:r=rd("ANTHROPIC_AUTH_TOKEN")??null,...s}={}){const a={apiKey:n,authToken:r,...s,baseURL:e||"https://api.anthropic.com"};if(!a.dangerouslyAllowBrowser&&gL())throw new qe(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });

TODO: link!
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new C1(this),this.messages=new v1(this),this.beta=new rl(this),this._options=a,this.apiKey=n,this.authToken=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(e,n){if(!(this.apiKey&&e["x-api-key"])&&n["x-api-key"]!==null&&!(this.authToken&&e.authorization)&&n.authorization!==null)throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){const n=this.apiKeyAuth(e),r=this.bearerAuth(e);return n!=null&&!ac(n)?n:r!=null&&!ac(r)?r:{}}apiKeyAuth(e){return this.apiKey==null?{}:{"X-Api-Key":this.apiKey}}bearerAuth(e){return this.authToken==null?{}:{Authorization:`Bearer ${this.authToken}`}}}O1=it;it.Anthropic=O1;it.HUMAN_PROMPT=`

Human:`;it.AI_PROMPT=`

Assistant:`;it.DEFAULT_TIMEOUT=6e5;it.AnthropicError=qe;it.APIError=En;it.APIConnectionError=el;it.APIConnectionTimeoutError=c1;it.APIUserAbortError=Fn;it.NotFoundError=f1;it.ConflictError=m1;it.RateLimitError=g1;it.BadRequestError=l1;it.AuthenticationError=d1;it.InternalServerError=b1;it.PermissionDeniedError=h1;it.UnprocessableEntityError=p1;it.toFile=Jx;it.fileFromPath=u1;it.Completions=C1;it.Messages=v1;it.Beta=rl;/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var TL=typeof window=="object"?window:{},Ie="0123456789abcdef".split(""),SL=[-2147483648,8388608,32768,128],Pn=[24,16,8,0],vt=[];function zn(t){t?(vt[0]=vt[16]=vt[1]=vt[2]=vt[3]=vt[4]=vt[5]=vt[6]=vt[7]=vt[8]=vt[9]=vt[10]=vt[11]=vt[12]=vt[13]=vt[14]=vt[15]=0,this.blocks=vt):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}zn.prototype.update=function(t){if(!this.finalized){var e=typeof t!="string";e&&t.constructor===TL.ArrayBuffer&&(t=new Uint8Array(t));for(var n,r=0,s,a=t.length||0,i=this.blocks;r<a;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),e)for(s=this.start;r<a&&s<64;++r)i[s>>2]|=t[r]<<Pn[s++&3];else for(s=this.start;r<a&&s<64;++r)n=t.charCodeAt(r),n<128?i[s>>2]|=n<<Pn[s++&3]:n<2048?(i[s>>2]|=(192|n>>6)<<Pn[s++&3],i[s>>2]|=(128|n&63)<<Pn[s++&3]):n<55296||n>=57344?(i[s>>2]|=(224|n>>12)<<Pn[s++&3],i[s>>2]|=(128|n>>6&63)<<Pn[s++&3],i[s>>2]|=(128|n&63)<<Pn[s++&3]):(n=65536+((n&1023)<<10|t.charCodeAt(++r)&1023),i[s>>2]|=(240|n>>18)<<Pn[s++&3],i[s>>2]|=(128|n>>12&63)<<Pn[s++&3],i[s>>2]|=(128|n>>6&63)<<Pn[s++&3],i[s>>2]|=(128|n&63)<<Pn[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=i[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};zn.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[16]=this.block,t[e>>2]|=SL[e&3],this.block=t[16],e>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}};zn.prototype.hash=function(){var t=this.h0,e=this.h1,n=this.h2,r=this.h3,s=this.h4,a,i,o,u=this.blocks;for(i=16;i<80;++i)o=u[i-3]^u[i-8]^u[i-14]^u[i-16],u[i]=o<<1|o>>>31;for(i=0;i<20;i+=5)a=e&n|~e&r,o=t<<5|t>>>27,s=o+a+s+1518500249+u[i]<<0,e=e<<30|e>>>2,a=t&e|~t&n,o=s<<5|s>>>27,r=o+a+r+1518500249+u[i+1]<<0,t=t<<30|t>>>2,a=s&t|~s&e,o=r<<5|r>>>27,n=o+a+n+1518500249+u[i+2]<<0,s=s<<30|s>>>2,a=r&s|~r&t,o=n<<5|n>>>27,e=o+a+e+1518500249+u[i+3]<<0,r=r<<30|r>>>2,a=n&r|~n&s,o=e<<5|e>>>27,t=o+a+t+1518500249+u[i+4]<<0,n=n<<30|n>>>2;for(;i<40;i+=5)a=e^n^r,o=t<<5|t>>>27,s=o+a+s+1859775393+u[i]<<0,e=e<<30|e>>>2,a=t^e^n,o=s<<5|s>>>27,r=o+a+r+1859775393+u[i+1]<<0,t=t<<30|t>>>2,a=s^t^e,o=r<<5|r>>>27,n=o+a+n+1859775393+u[i+2]<<0,s=s<<30|s>>>2,a=r^s^t,o=n<<5|n>>>27,e=o+a+e+1859775393+u[i+3]<<0,r=r<<30|r>>>2,a=n^r^s,o=e<<5|e>>>27,t=o+a+t+1859775393+u[i+4]<<0,n=n<<30|n>>>2;for(;i<60;i+=5)a=e&n|e&r|n&r,o=t<<5|t>>>27,s=o+a+s-1894007588+u[i]<<0,e=e<<30|e>>>2,a=t&e|t&n|e&n,o=s<<5|s>>>27,r=o+a+r-1894007588+u[i+1]<<0,t=t<<30|t>>>2,a=s&t|s&e|t&e,o=r<<5|r>>>27,n=o+a+n-1894007588+u[i+2]<<0,s=s<<30|s>>>2,a=r&s|r&t|s&t,o=n<<5|n>>>27,e=o+a+e-1894007588+u[i+3]<<0,r=r<<30|r>>>2,a=n&r|n&s|r&s,o=e<<5|e>>>27,t=o+a+t-1894007588+u[i+4]<<0,n=n<<30|n>>>2;for(;i<80;i+=5)a=e^n^r,o=t<<5|t>>>27,s=o+a+s-899497514+u[i]<<0,e=e<<30|e>>>2,a=t^e^n,o=s<<5|s>>>27,r=o+a+r-899497514+u[i+1]<<0,t=t<<30|t>>>2,a=s^t^e,o=r<<5|r>>>27,n=o+a+n-899497514+u[i+2]<<0,s=s<<30|s>>>2,a=r^s^t,o=n<<5|n>>>27,e=o+a+e-899497514+u[i+3]<<0,r=r<<30|r>>>2,a=n^r^s,o=e<<5|e>>>27,t=o+a+t-899497514+u[i+4]<<0,n=n<<30|n>>>2;this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+n<<0,this.h3=this.h3+r<<0,this.h4=this.h4+s<<0};zn.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,r=this.h3,s=this.h4;return Ie[t>>28&15]+Ie[t>>24&15]+Ie[t>>20&15]+Ie[t>>16&15]+Ie[t>>12&15]+Ie[t>>8&15]+Ie[t>>4&15]+Ie[t&15]+Ie[e>>28&15]+Ie[e>>24&15]+Ie[e>>20&15]+Ie[e>>16&15]+Ie[e>>12&15]+Ie[e>>8&15]+Ie[e>>4&15]+Ie[e&15]+Ie[n>>28&15]+Ie[n>>24&15]+Ie[n>>20&15]+Ie[n>>16&15]+Ie[n>>12&15]+Ie[n>>8&15]+Ie[n>>4&15]+Ie[n&15]+Ie[r>>28&15]+Ie[r>>24&15]+Ie[r>>20&15]+Ie[r>>16&15]+Ie[r>>12&15]+Ie[r>>8&15]+Ie[r>>4&15]+Ie[r&15]+Ie[s>>28&15]+Ie[s>>24&15]+Ie[s>>20&15]+Ie[s>>16&15]+Ie[s>>12&15]+Ie[s>>8&15]+Ie[s>>4&15]+Ie[s&15]};zn.prototype.toString=zn.prototype.hex;zn.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,r=this.h3,s=this.h4;return[t>>24&255,t>>16&255,t>>8&255,t&255,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24&255,n>>16&255,n>>8&255,n&255,r>>24&255,r>>16&255,r>>8&255,r&255,s>>24&255,s>>16&255,s>>8&255,s&255]};zn.prototype.array=zn.prototype.digest;zn.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(20),e=new DataView(t);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),t};const AL=t=>new zn(!0).update(t).hex(),o0=(...t)=>AL(t.join("_"));class CL{}const vL=new Map;class qf extends CL{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,n){return Promise.resolve(this.cache.get(o0(e,n))??null)}async update(e,n,r){this.cache.set(o0(e,n),r)}static global(){return new qf(vL)}}class k1 extends Yr{}class OL extends k1{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new cr(this.value)]}}class kL extends k1{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return py(this.messages)}toChatMessages(){return this.messages}}const IL=t=>t.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":t.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":t.startsWith("gpt-4-32k")?"gpt-4-32k":t.startsWith("gpt-4-")?"gpt-4":t.startsWith("gpt-4o")?"gpt-4o":t;function I1(t){return typeof t!="object"||!t?!1:!!("type"in t&&t.type==="function"&&"function"in t&&typeof t.function=="object"&&t.function&&"name"in t.function&&"parameters"in t.function)}const NL=()=>!1;class N1 extends gt{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??NL(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class RL extends N1{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:n,...r}){const{cache:s,...a}=r;super({callbacks:e??n,...a}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof s=="object"?this.cache=s:s?this.cache=qf.global():this.cache=void 0,this.caller=new If(r??{})}async getNumTokens(e){if(typeof e!="string")return 0;let n=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await oP("modelName"in this?IL(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{n=this._encoding.encode(e).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return n}static _convertInputToPromptValue(e){return typeof e=="string"?new OL(e):Array.isArray(e)?new kL(e.map(ti)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...n}){const r={...this._identifyingParams(),...n,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([i,o])=>o!==void 0).map(([i,o])=>`${i}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class pa extends gt{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,n){const r=$e(n);return this.func&&await this.func(e,r),this._callWithConfig(s=>Promise.resolve(s),e,r)}async*transform(e,n){const r=$e(n);let s,a=!0;for await(const i of this._transformStreamWithConfig(e,o=>o,r))if(yield i,a)if(s===void 0)s=i;else try{s=qn(s,i)}catch{s=void 0,a=!1}this.func&&s!==void 0&&await this.func(s,r)}static assign(e){return new vy(new va({steps:e}))}}function Vf(t){return typeof(t==null?void 0:t.parse)=="function"}class vr extends RL{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[n,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=n.signal,[n,r]}async invoke(e,n){const r=vr._convertInputToPromptValue(e);return(await this.generatePrompt([r],n,n==null?void 0:n.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,n,r){throw new Error("Not implemented.")}async*_streamIterator(e,n){var r;if(this._streamResponseChunks===vr.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,n);else{const a=vr._convertInputToPromptValue(e).toChatMessages(),[i,o]=this._separateRunnableConfigFromCallOptionsCompat(n),u={...i.metadata,...this.getLsParams(o)},c=await Ut.configure(i.callbacks,this.callbacks,i.tags,this.tags,u,this.metadata,{verbose:this.verbose}),l={options:o,invocation_params:this==null?void 0:this.invocationParams(o),batch_size:1},d=await(c==null?void 0:c.handleChatModelStart(this.toJSON(),[a],i.runId,void 0,l,void 0,void 0,i.runName));let m,p;try{for await(const h of this._streamResponseChunks(a,o,d==null?void 0:d[0])){if(h.message.id==null){const g=(r=d==null?void 0:d.at(0))==null?void 0:r.runId;g!=null&&h.message._updateId(`run-${g}`)}h.message.response_metadata={...h.generationInfo,...h.message.response_metadata},yield h.message,m?m=m.concat(h):m=h,eg(h.message)&&h.message.usage_metadata!==void 0&&(p={tokenUsage:{promptTokens:h.message.usage_metadata.input_tokens,completionTokens:h.message.usage_metadata.output_tokens,totalTokens:h.message.usage_metadata.total_tokens}})}}catch(h){throw await Promise.all((d??[]).map(g=>g==null?void 0:g.handleLLMError(h))),h}await Promise.all((d??[]).map(h=>h==null?void 0:h.handleLLMEnd({generations:[[m]],llmOutput:p})))}}getLsParams(e){const n=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:n}}async _generateUncached(e,n,r,s){var d,m;const a=e.map(p=>p.map(ti));let i;if(s!==void 0&&s.length===a.length)i=s;else{const p={...r.metadata,...this.getLsParams(n)},h=await Ut.configure(r.callbacks,this.callbacks,r.tags,this.tags,p,this.metadata,{verbose:this.verbose}),g={options:n,invocation_params:this==null?void 0:this.invocationParams(n),batch_size:1};i=await(h==null?void 0:h.handleChatModelStart(this.toJSON(),a,r.runId,void 0,g,void 0,void 0,r.runName))}const o=[],u=[];if(!!(i!=null&&i[0].handlers.find(oN))&&!this.disableStreaming&&a.length===1&&this._streamResponseChunks!==vr.prototype._streamResponseChunks)try{const p=await this._streamResponseChunks(a[0],n,i==null?void 0:i[0]);let h,g;for await(const b of p){if(b.message.id==null){const _=(d=i==null?void 0:i.at(0))==null?void 0:d.runId;_!=null&&b.message._updateId(`run-${_}`)}h===void 0?h=b:h=qn(h,b),eg(b.message)&&b.message.usage_metadata!==void 0&&(g={tokenUsage:{promptTokens:b.message.usage_metadata.input_tokens,completionTokens:b.message.usage_metadata.output_tokens,totalTokens:b.message.usage_metadata.total_tokens}})}if(h===void 0)throw new Error("Received empty response from chat model call.");o.push([h]),await(i==null?void 0:i[0].handleLLMEnd({generations:o,llmOutput:g}))}catch(p){throw await(i==null?void 0:i[0].handleLLMError(p)),p}else{const p=await Promise.allSettled(a.map((h,g)=>this._generate(h,{...n,promptIndex:g},i==null?void 0:i[g])));await Promise.all(p.map(async(h,g)=>{var b,_,y;if(h.status==="fulfilled"){const E=h.value;for(const I of E.generations){if(I.message.id==null){const w=(b=i==null?void 0:i.at(0))==null?void 0:b.runId;w!=null&&I.message._updateId(`run-${w}`)}I.message.response_metadata={...I.generationInfo,...I.message.response_metadata}}return E.generations.length===1&&(E.generations[0].message.response_metadata={...E.llmOutput,...E.generations[0].message.response_metadata}),o[g]=E.generations,u[g]=E.llmOutput,(_=i==null?void 0:i[g])==null?void 0:_.handleLLMEnd({generations:[E.generations],llmOutput:E.llmOutput})}else return await((y=i==null?void 0:i[g])==null?void 0:y.handleLLMError(h.reason)),Promise.reject(h.reason)}))}const l={generations:o,llmOutput:u.length?(m=this._combineLLMOutput)==null?void 0:m.call(this,...u):void 0};return Object.defineProperty(l,og,{value:i?{runIds:i==null?void 0:i.map(p=>p.runId)}:void 0,configurable:!0}),l}async _generateCached({messages:e,cache:n,llmStringKey:r,parsedOptions:s,handledOptions:a}){const i=e.map(b=>b.map(ti)),o={...a.metadata,...this.getLsParams(s)},u=await Ut.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1},l=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),i,a.runId,void 0,c,void 0,void 0,a.runName)),d=[],p=(await Promise.allSettled(i.map(async(b,_)=>{const y=vr._convertInputToPromptValue(b).toString(),E=await n.lookup(y,r);return E==null&&d.push(_),E}))).map((b,_)=>({result:b,runManager:l==null?void 0:l[_]})).filter(({result:b})=>b.status==="fulfilled"&&b.value!=null||b.status==="rejected"),h=[];await Promise.all(p.map(async({result:b,runManager:_},y)=>{if(b.status==="fulfilled"){const E=b.value;return h[y]=E.map(I=>("message"in I&&jc(I.message)&&ho(I.message)&&(I.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),I.generationInfo={...I.generationInfo,tokenUsage:{}},I)),E.length&&await(_==null?void 0:_.handleLLMNewToken(E[0].text)),_==null?void 0:_.handleLLMEnd({generations:[E]},void 0,void 0,void 0,{cached:!0})}else return await(_==null?void 0:_.handleLLMError(b.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(b.reason)}));const g={generations:h,missingPromptIndices:d,startedRunManagers:l};return Object.defineProperty(g,og,{value:l?{runIds:l==null?void 0:l.map(b=>b.runId)}:void 0,configurable:!0}),g}async generate(e,n,r){let s;Array.isArray(n)?s={stop:n}:s=n;const a=e.map(h=>h.map(ti)),[i,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(i.callbacks=i.callbacks??r,!this.cache)return this._generateUncached(a,o,i);const{cache:u}=this,c=this._getSerializedCacheKeyParametersForCall(o),{generations:l,missingPromptIndices:d,startedRunManagers:m}=await this._generateCached({messages:a,cache:u,llmStringKey:c,parsedOptions:o,handledOptions:i});let p={};if(d.length>0){const h=await this._generateUncached(d.map(g=>a[g]),o,i,m!==void 0?d.map(g=>m==null?void 0:m[g]):void 0);await Promise.all(h.generations.map(async(g,b)=>{const _=d[b];l[_]=g;const y=vr._convertInputToPromptValue(a[_]).toString();return u.update(y,c,g)})),p=h.llmOutput??{}}return{generations:l,llmOutput:p}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,n,r){const s=e.map(a=>a.toChatMessages());return this.generate(s,n,r)}async call(e,n,r){return(await this.generate([e.map(ti)],n,r)).generations[0][0].message}async callPrompt(e,n,r){const s=e.toChatMessages();return this.call(s,n,r)}async predictMessages(e,n,r){return this.call(e,n,r)}async predict(e,n,r){const s=new cr(e),a=await this.call([s],n,r);if(typeof a.content!="string")throw new Error("Cannot use predict when output is not a string.");return a.content}withStructuredOutput(e,n){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(n!=null&&n.strict)throw new Error('"strict" mode is not supported for this model by default.');const r=e,s=n==null?void 0:n.name,a=r.description??"A function available to call.",i=n==null?void 0:n.method,o=n==null?void 0:n.includeRaw;if(i==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let u=s??"extract",c;Vf(r)?c=[{type:"function",function:{name:u,description:a,parameters:vs(r)}}]:("name"in r&&(u=r.name),c=[{type:"function",function:{name:u,description:a,parameters:r}}]);const l=this.bindTools(c),d=mo.from(g=>{if(!g.tool_calls||g.tool_calls.length===0)throw new Error("No tool calls found in the response.");const b=g.tool_calls.find(_=>_.name===u);if(!b)throw new Error(`No tool call found with name ${u}.`);return b.args});if(!o)return l.pipe(d).withConfig({runName:"StructuredOutput"});const m=pa.assign({parsed:(g,b)=>d.invoke(g.raw,b)}),p=pa.assign({parsed:()=>null}),h=m.withFallbacks({fallbacks:[p]});return lr.from([{raw:l},h]).withConfig({runName:"StructuredOutputRunnable"})}}function PL(t,e){const n=typeof e=="number"?void 0:e;return{name:t.name,description:t.description,parameters:vs(t.schema),...(n==null?void 0:n.strict)!==void 0?{strict:n.strict}:{}}}function xL(t){return t!==void 0&&Array.isArray(t.lc_namespace)}function LL(t){return t!==void 0&&gt.isRunnable(t)&&"lc_name"in t.constructor&&typeof t.constructor.lc_name=="function"&&t.constructor.lc_name()==="RunnableToolLike"}function DL(t){return!!t&&typeof t=="object"&&"name"in t&&"schema"in t&&Vf(t.schema)}function R1(t){return DL(t)||LL(t)||xL(t)}class P1 extends gt{parseResultWithPrompt(e,n,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,n){return typeof e=="string"?this._callWithConfig(async(r,s)=>this.parseResult([{text:r}],s==null?void 0:s.callbacks),e,{...n,runType:"parser"}):this._callWithConfig(async(r,s)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],s==null?void 0:s.callbacks),e,{...n,runType:"parser"})}}class x1 extends P1{parseResult(e,n){return this.parse(e[0].text,n)}async parseWithPrompt(e,n,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class Gi extends Error{constructor(e,n,r,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=n,this.observation=r,this.sendToLLM=s,s&&(r===void 0||n===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");fy(this,"OUTPUT_PARSING_FAILURE")}}function Ch(t,e){const n=typeof t;if(n!==typeof e)return!1;if(Array.isArray(t)){if(!Array.isArray(e))return!1;const r=t.length;if(r!==e.length)return!1;for(let s=0;s<r;s++)if(!Ch(t[s],e[s]))return!1;return!0}if(n==="object"){if(!t||!e)return t===e;const r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(const i of r)if(!Ch(t[i],e[i]))return!1;return!0}return t===e}class ML extends x1{async*_transform(e){for await(const n of e)typeof n=="string"?yield this.parseResult([{text:n}]):yield this.parseResult([{message:n,text:this._baseMessageToString(n)}])}async*transform(e,n){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...n,runType:"parser"})}}class L1 extends ML{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let n,r;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let a;if(gN(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new Cs({message:s,text:s.content})}else if(jc(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new Cs({message:wN(s),text:s.content})}else a=new ma({text:s});r===void 0?r=a:r=r.concat(a);const i=await this.parsePartialResult([r]);i!=null&&!Ch(i,n)&&(this.diff?yield this._diff(n,i):yield i,n=i)}}getFormatInstructions(){return""}}class u0 extends x1{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const n=Or.object(Object.fromEntries(Object.entries(e).map(([r,s])=>[r,Or.string().describe(s)])));return new this(n)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(vs(this.schema))}
\`\`\`
`}async parse(e){try{const r=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(s,a)=>`"${a.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(r))}catch(n){throw new Gi(`Failed to parse. Text: "${e}". Error: ${n}`,e)}}}class c0 extends L1{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,n){if(n)return e?$I(e,n):[{op:"replace",path:"",value:n}]}async parsePartialResult(e){return Qp(e[0].text)}async parse(e){return Qp(e,JSON.parse)}getFormatInstructions(){return""}}class l0 extends P1{static lc_name(){return"AnthropicToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","anthropic","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){let n=e;if(typeof e=="string")try{n=JSON.parse(e)}catch(s){throw new Gi(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(s.message)}`,e)}else n=e;if(this.zodSchema===void 0)return n;const r=await this.zodSchema.safeParseAsync(n);if(r.success)return r.data;throw new Gi(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(r.error.errors)}`,JSON.stringify(n,null,2))}async parseResult(e){const n=e.flatMap(a=>{const{message:i}=a;return Array.isArray(i.content)?D1(i.content)[0]:[]});if(n[0]===void 0)throw new Error("No parseable tool calls provided to AnthropicToolsOutputParser.");const[r]=n;return await this._validateResult(r.args)}}function D1(t){const e=[];for(const n of t)n.type==="tool_use"&&e.push({name:n.name,args:n.input,id:n.id,type:"tool_call"});return e}function BL(t){if(t)return t==="any"?{type:"any"}:t==="auto"?{type:"auto"}:typeof t=="string"?{type:"tool",name:t}:t}function d0(t){const e=/^data:(image\/.+);base64,(.+)$/,n=t.match(e);if(n===null)throw new Error(["Anthropic only supports base64-encoded images currently.","Example: data:image/png;base64,/9j/4AAQSk..."].join(`

`));return{type:"base64",media_type:n[1]??"",data:n[2]??""}}function FL(t){const e=[];for(const n of t)if(n._getType()==="tool")if(typeof n.content=="string"){const r=e[e.length-1];(r==null?void 0:r._getType())==="human"&&Array.isArray(r.content)&&"type"in r.content[0]&&r.content[0].type==="tool_result"?r.content.push({type:"tool_result",content:n.content,tool_use_id:n.tool_call_id}):e.push(new cr({content:[{type:"tool_result",content:n.content,tool_use_id:n.tool_call_id}]}))}else e.push(new cr({content:[{type:"tool_result",content:vh(n.content),tool_use_id:n.tool_call_id}]}));else e.push(n);return e}function h0(t){if(t.id===void 0)throw new Error('Anthropic requires all tool calls to have an "id".');return{type:"tool_use",id:t.id,name:t.name,input:t.args}}function vh(t){const e=["tool_use","tool_result","input_json_delta"],n=["text","text_delta"];return typeof t=="string"?t:t.map(s=>{const a="cache_control"in s?s.cache_control:void 0;if(s.type==="image_url"){let i;return typeof s.image_url=="string"?i=d0(s.image_url):i=d0(s.image_url.url),{type:"image",source:i,...a?{cache_control:a}:{}}}else{if(s.type==="document")return{type:"document",source:s.source,...a?{cache_control:a}:{}};if(n.find(i=>i===s.type)&&"text"in s)return{type:"text",text:s.text,...a?{cache_control:a}:{}};if(e.find(i=>i===s.type)){const i={...s};if("index"in i&&delete i.index,i.type==="input_json_delta"&&(i.type="tool_use"),"input"in i)try{i.input=JSON.parse(i.input)}catch{}return{...i,...a?{cache_control:a}:{}}}else throw new Error("Unsupported message content format")}})}function f0(t){const e=FL(t);let n;e.length>0&&e[0]._getType()==="system"&&(n=t[0].content);const s=(n!==void 0?e.slice(1):e).map(a=>{var o;let i;if(a._getType()==="human")i="user";else if(a._getType()==="ai")i="assistant";else if(a._getType()==="tool")i="user";else throw a._getType()==="system"?new Error("System messages are only permitted as the first passed message."):new Error(`Message type "${a._getType()}" is not supported.`);if(ho(a)&&((o=a.tool_calls)!=null&&o.length)){if(typeof a.content=="string")return a.content===""?{role:i,content:a.tool_calls.map(h0)}:{role:i,content:[{type:"text",text:a.content},...a.tool_calls.map(h0)]};{const{content:u}=a;return!a.tool_calls.every(l=>u.find(d=>(d.type==="tool_use"||d.type==="input_json_delta")&&d.id===l.id))&&console.warn('The "tool_calls" field on a message is only respected if content is a string.'),{role:i,content:vh(a.content)}}}else return{role:i,content:vh(a.content)}});return{messages:UL(s),system:n}}function UL(t){if(!t||t.length<=1)return t;const e=[];let n=t[0];const r=a=>typeof a=="string"?[{type:"text",text:a}]:a,s=a=>a.role!=="user"||typeof a.content=="string"?!1:Array.isArray(a.content)&&a.content.every(i=>i.type==="tool_result");for(let a=1;a<t.length;a+=1){const i=t[a];s(n)&&s(i)?n={...n,content:[...r(n.content),...r(i.content)]}:(e.push(n),n=i)}return e.push(n),e}function jL(t,e){var n,r;if(t.type==="message_start"){const{content:s,usage:a,...i}=t.message,o={};for(const[m,p]of Object.entries(i))p!=null&&(o[m]=p);const{input_tokens:u,output_tokens:c,...l}=a??{},d={input_tokens:u,output_tokens:c,total_tokens:u+c,input_token_details:{cache_creation:l.cache_creation_input_tokens,cache_read:l.cache_read_input_tokens}};return{chunk:new en({content:e.coerceContentToString?"":[],additional_kwargs:o,usage_metadata:e.streamUsage?d:void 0,response_metadata:{usage:{...l}},id:t.message.id})}}else if(t.type==="message_delta"){const s={input_tokens:0,output_tokens:t.usage.output_tokens,total_tokens:t.usage.output_tokens,input_token_details:{cache_creation:t.usage.cache_creation_input_tokens,cache_read:t.usage.cache_read_input_tokens}};return{chunk:new en({content:e.coerceContentToString?"":[],additional_kwargs:{...t.delta},usage_metadata:e.streamUsage?s:void 0})}}else if(t.type==="content_block_start"&&t.content_block.type==="tool_use"){const s=t.content_block;return{chunk:new en({content:e.coerceContentToString?"":[{index:t.index,...t.content_block,input:""}],additional_kwargs:{},tool_call_chunks:[{id:s.id,index:t.index,name:s.name,args:""}]})}}else if(t.type==="content_block_delta"&&t.delta.type==="text_delta"){const s=(n=t.delta)==null?void 0:n.text;if(s!==void 0)return{chunk:new en({content:e.coerceContentToString?s:[{index:t.index,...t.delta}],additional_kwargs:{}})}}else{if(t.type==="content_block_delta"&&t.delta.type==="input_json_delta")return{chunk:new en({content:e.coerceContentToString?"":[{index:t.index,input:t.delta.partial_json,type:t.delta.type}],additional_kwargs:{},tool_call_chunks:[{index:t.index,args:t.delta.partial_json}]})};if(t.type==="content_block_start"&&t.content_block.type==="text"){const s=(r=t.content_block)==null?void 0:r.text;if(s!==void 0)return{chunk:new en({content:e.coerceContentToString?s:[{index:t.index,...t.content_block}],additional_kwargs:{}})}}}return null}function HL(t,e){const n=e.usage,r=n!=null?{input_tokens:n.input_tokens??0,output_tokens:n.output_tokens??0,total_tokens:(n.input_tokens??0)+(n.output_tokens??0),input_token_details:{cache_creation:n.cache_creation_input_tokens,cache_read:n.cache_read_input_tokens}}:void 0;if(t.length===1&&t[0].type==="text")return[{text:t[0].text,message:new As({content:t[0].text,additional_kwargs:e,usage_metadata:r,response_metadata:e,id:e.id})}];{const s=D1(t);return[{text:"",message:new As({content:t,additional_kwargs:e,tool_calls:s,usage_metadata:r,response_metadata:e,id:e.id})}]}}function nu(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,t}function m0(t){let e;return t.status===400&&t.message.includes("tool")?e=nu(t,"INVALID_TOOL_RESULTS"):t.status===401?e=nu(t,"MODEL_AUTHENTICATION"):t.status===404?e=nu(t,"MODEL_NOT_FOUND"):t.status===429?e=nu(t,"MODEL_RATE_LIMIT"):e=t,e}function $L(t){return!!(t.tools&&t.tools.length>0)}function qL(t){return"input_schema"in t}function VL(t){if(typeof t.content=="string")return t.content;if(Array.isArray(t.content)&&t.content.length>=1&&"input"in t.content[0])return typeof t.content[0].input=="string"?t.content[0].input:JSON.stringify(t.content[0].input);if(Array.isArray(t.content)&&t.content.length>=1&&"text"in t.content[0])return t.content[0].text}class zL extends vr{static lc_name(){return"ChatAnthropic"}get lc_secrets(){return{anthropicApiKey:"ANTHROPIC_API_KEY",apiKey:"ANTHROPIC_API_KEY"}}get lc_aliases(){return{modelName:"model"}}constructor(e){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"anthropicApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"invocationKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"clientOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamingClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"createClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.anthropicApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.anthropicApiKey)??gn("ANTHROPIC_API_KEY"),!this.anthropicApiKey&&!(e!=null&&e.createClient))throw new Error("Anthropic API key not found");this.clientOptions=(e==null?void 0:e.clientOptions)??{},this.apiKey=this.anthropicApiKey,this.apiUrl=e==null?void 0:e.anthropicApiUrl,this.modelName=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.model=this.modelName,this.invocationKwargs=(e==null?void 0:e.invocationKwargs)??{},this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topK=(e==null?void 0:e.topK)??this.topK,this.topP=(e==null?void 0:e.topP)??this.topP,this.maxTokens=(e==null?void 0:e.maxTokensToSample)??(e==null?void 0:e.maxTokens)??this.maxTokens,this.stopSequences=(e==null?void 0:e.stopSequences)??this.stopSequences,this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.createClient=(e==null?void 0:e.createClient)??(n=>new it(n))}getLsParams(e){const n=this.invocationParams(e);return{ls_provider:"anthropic",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:n.temperature??void 0,ls_max_tokens:n.max_tokens??void 0,ls_stop:e.stop}}formatStructuredToolToAnthropic(e){if(!(!e||!e.length))return e.map(n=>{if(qL(n))return n;if(I1(n))return{name:n.function.name,description:n.function.description,input_schema:n.function.parameters};if(R1(n))return{name:n.name,description:n.description,input_schema:vs(n.schema)};throw new Error(`Unknown tool type passed to ChatAnthropic: ${JSON.stringify(n,null,2)}`)})}bindTools(e,n){return this.bind({tools:this.formatStructuredToolToAnthropic(e),...n})}invocationParams(e){const n=BL(e==null?void 0:e.tool_choice);return{model:this.model,temperature:this.temperature,top_k:this.topK,top_p:this.topP,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:n,...this.invocationKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams()}}identifyingParams(){return{model_name:this.model,...this.invocationParams()}}async*_streamResponseChunks(e,n,r){var u;const s=this.invocationParams(n),a=f0(e),i=!$L({...s,...a,stream:!1}),o=await this.createStreamWithRetry({...s,...a,stream:!0},{headers:n.headers});for await(const c of o){if((u=n.signal)!=null&&u.aborted)throw o.controller.abort(),new Error("AbortError: User aborted the request.");const l=this.streamUsage??n.streamUsage,d=jL(c,{streamUsage:l,coerceContentToString:i});if(!d)continue;const{chunk:m}=d,p=VL(m),h=new Cs({message:new en({content:m.content,additional_kwargs:m.additional_kwargs,tool_call_chunks:m.tool_call_chunks,usage_metadata:l?m.usage_metadata:void 0,response_metadata:m.response_metadata,id:m.id}),text:p??""});yield h,await(r==null?void 0:r.handleLLMNewToken(p??"",void 0,void 0,void 0,void 0,{chunk:h}))}}async _generateNonStreaming(e,n,r){const s=await this.completionWithRetry({...n,stream:!1,...f0(e)},r),{content:a,...i}=s,o=HL(a,i),{role:u,type:c,...l}=i;return{generations:o,llmOutput:l}}async _generate(e,n,r){if(this.stopSequences&&n.stop)throw new Error('"stopSequence" parameter found in input and default params');const s=this.invocationParams(n);if(s.stream){let a;const i=this._streamResponseChunks(e,n,r);for await(const o of i)a===void 0?a=o:a=a.concat(o);if(a===void 0)throw new Error("No chunks returned from Anthropic API.");return{generations:[{text:a.text,message:a.message}]}}else return this._generateNonStreaming(e,s,{signal:n.signal,headers:n.headers})}async createStreamWithRetry(e,n){if(!this.streamingClient){const s=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.streamingClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...s,apiKey:this.apiKey,maxRetries:0})}const r=async()=>{try{return await this.streamingClient.messages.create({...e,...this.invocationKwargs,stream:!0},n)}catch(s){throw m0(s)}};return this.caller.call(r)}async completionWithRetry(e,n){if(!this.batchClient){const s=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.batchClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...s,apiKey:this.apiKey,maxRetries:0})}const r=async()=>{try{return await this.batchClient.messages.create({...e,...this.invocationKwargs},n)}catch(s){throw m0(s)}};return this.caller.callWithOptions({signal:n.signal??void 0},r)}_llmType(){return"anthropic"}withStructuredOutput(e,n){const r=e,s=n==null?void 0:n.name,a=n==null?void 0:n.method,i=n==null?void 0:n.includeRaw;if(a==="jsonMode")throw new Error('Anthropic only supports "functionCalling" as a method.');let o=s??"extract",u,c;if(Vf(r)){const h=vs(r);c=[{name:o,description:h.description??"A function available to call.",input_schema:h}],u=new l0({returnSingle:!0,keyName:o,zodSchema:r})}else{let h;typeof r.name=="string"&&typeof r.description=="string"&&typeof r.input_schema=="object"&&r.input_schema!=null?(h=r,o=r.name):h={name:o,description:r.description??"",input_schema:r},c=[h],u=new l0({returnSingle:!0,keyName:o})}const l=this.bind({tools:c,tool_choice:{type:"tool",name:o}});if(!i)return l.pipe(u).withConfig({runName:"ChatAnthropicStructuredOutput"});const d=pa.assign({parsed:(h,g)=>u.invoke(h.raw,g)}),m=pa.assign({parsed:()=>null}),p=d.withFallbacks({fallbacks:[m]});return lr.from([{raw:l},p]).withConfig({runName:"StructuredOutputRunnable"})}}class WL extends zL{}const Oh="RFC3986",kh={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:t=>String(t)},GL="RFC1738",KL=Array.isArray,tr=(()=>{const t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})(),md=1024,YL=(t,e,n,r,s)=>{if(t.length===0)return t;let a=t;if(typeof t=="symbol"?a=Symbol.prototype.toString.call(t):typeof t!="string"&&(a=String(t)),n==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=md){const u=a.length>=md?a.slice(o,o+md):a,c=[];for(let l=0;l<u.length;++l){let d=u.charCodeAt(l);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===GL&&(d===40||d===41)){c[c.length]=u.charAt(l);continue}if(d<128){c[c.length]=tr[d];continue}if(d<2048){c[c.length]=tr[192|d>>6]+tr[128|d&63];continue}if(d<55296||d>=57344){c[c.length]=tr[224|d>>12]+tr[128|d>>6&63]+tr[128|d&63];continue}l+=1,d=65536+((d&1023)<<10|u.charCodeAt(l)&1023),c[c.length]=tr[240|d>>18]+tr[128|d>>12&63]+tr[128|d>>6&63]+tr[128|d&63]}i+=c.join("")}return i};function ZL(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function p0(t,e){if(KL(t)){const n=[];for(let r=0;r<t.length;r+=1)n.push(e(t[r]));return n}return e(t)}const JL=Object.prototype.hasOwnProperty,M1={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},rr=Array.isArray,XL=Array.prototype.push,B1=function(t,e){XL.apply(t,rr(e)?e:[e])},QL=Date.prototype.toISOString,Et={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:YL,encodeValuesOnly:!1,format:Oh,formatter:kh[Oh],indices:!1,serializeDate(t){return QL.call(t)},skipNulls:!1,strictNullHandling:!1};function e6(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}const pd={};function F1(t,e,n,r,s,a,i,o,u,c,l,d,m,p,h,g,b,_){let y=t,E=_,I=0,w=!1;for(;(E=E.get(pd))!==void 0&&!w;){const x=E.get(t);if(I+=1,typeof x<"u"){if(x===I)throw new RangeError("Cyclic object value");w=!0}typeof E.get(pd)>"u"&&(I=0)}if(typeof c=="function"?y=c(e,y):y instanceof Date?y=m==null?void 0:m(y):n==="comma"&&rr(y)&&(y=p0(y,function(x){return x instanceof Date?m==null?void 0:m(x):x})),y===null){if(a)return u&&!g?u(e,Et.encoder,b,"key",p):e;y=""}if(e6(y)||ZL(y)){if(u){const x=g?e:u(e,Et.encoder,b,"key",p);return[(h==null?void 0:h(x))+"="+(h==null?void 0:h(u(y,Et.encoder,b,"value",p)))]}return[(h==null?void 0:h(e))+"="+(h==null?void 0:h(String(y)))]}const R=[];if(typeof y>"u")return R;let v;if(n==="comma"&&rr(y))g&&u&&(y=p0(y,u)),v=[{value:y.length>0?y.join(",")||null:void 0}];else if(rr(c))v=c;else{const x=Object.keys(y);v=l?x.sort(l):x}const j=o?String(e).replace(/\./g,"%2E"):String(e),F=r&&rr(y)&&y.length===1?j+"[]":j;if(s&&rr(y)&&y.length===0)return F+"[]";for(let x=0;x<v.length;++x){const H=v[x],te=typeof H=="object"&&typeof H.value<"u"?H.value:y[H];if(i&&te===null)continue;const Z=d&&o?H.replace(/\./g,"%2E"):H,N=rr(y)?typeof n=="function"?n(F,Z):F:F+(d?"."+Z:"["+Z+"]");_.set(t,I);const S=new WeakMap;S.set(pd,_),B1(R,F1(te,N,n,r,s,a,i,o,n==="comma"&&g&&rr(y)?null:u,c,l,d,m,p,h,g,b,S))}return R}function t6(t=Et){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=t.charset||Et.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=Oh;if(typeof t.format<"u"){if(!JL.call(kh,t.format))throw new TypeError("Unknown format option provided.");n=t.format}const r=kh[n];let s=Et.filter;(typeof t.filter=="function"||rr(t.filter))&&(s=t.filter);let a;if(t.arrayFormat&&t.arrayFormat in M1?a=t.arrayFormat:"indices"in t?a=t.indices?"indices":"repeat":a=Et.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:Et.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:Et.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:Et.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Et.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?Et.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:Et.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:Et.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:Et.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:Et.encodeValuesOnly,filter:s,format:n,formatter:r,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:Et.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:Et.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Et.strictNullHandling}}function n6(t,e={}){let n=t;const r=t6(e);let s,a;typeof r.filter=="function"?(a=r.filter,n=a("",n)):rr(r.filter)&&(a=r.filter,s=a);const i=[];if(typeof n!="object"||n===null)return"";const o=M1[r.arrayFormat],u=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(n)),r.sort&&s.sort(r.sort);const c=new WeakMap;for(let m=0;m<s.length;++m){const p=s[m];r.skipNulls&&n[p]===null||B1(i,F1(n[p],p,o,u,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}const l=i.join(r.delimiter);let d=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),l.length>0?d+l:""}const Ys="4.83.0";let g0=!1,bi,U1,j1,Ih,H1,$1,q1,V1,z1;function r6(t,e={auto:!1}){if(g0)throw new Error(`you must \`import 'openai/shims/${t.kind}'\` before importing anything else from openai`);if(bi)throw new Error(`can't \`import 'openai/shims/${t.kind}'\` after \`import 'openai/shims/${bi}'\``);g0=e.auto,bi=t.kind,U1=t.fetch,j1=t.FormData,Ih=t.File,H1=t.ReadableStream,$1=t.getMultipartRequestOptions,q1=t.getDefaultAgent,V1=t.fileFromPath,z1=t.isFsReadStream}class s6{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function a6({manuallyImported:t}={}){const e=t?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,r,s,a;try{n=fetch,r=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:n,Request:r,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new s6(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}bi||r6(a6(),{auto:!0});class Fe extends Error{}class Dt extends Fe{constructor(e,n,r,s){super(`${Dt.makeMessage(e,n,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=n;const a=n;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,n,r){const s=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,n,r,s){if(!e||!s)return new sl({message:r,cause:Rh(n)});const a=n==null?void 0:n.error;return e===400?new W1(e,a,r,s):e===401?new G1(e,a,r,s):e===403?new K1(e,a,r,s):e===404?new Y1(e,a,r,s):e===409?new Z1(e,a,r,s):e===422?new J1(e,a,r,s):e===429?new X1(e,a,r,s):e>=500?new Q1(e,a,r,s):new Dt(e,a,r,s)}}class On extends Dt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class sl extends Dt{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class al extends sl{constructor({message:e}={}){super({message:e??"Request timed out."})}}class W1 extends Dt{}class G1 extends Dt{}class K1 extends Dt{}class Y1 extends Dt{}class Z1 extends Dt{}class J1 extends Dt{}class X1 extends Dt{}class Q1 extends Dt{}class eE extends Fe{constructor(){super("Could not parse response content as the length limit was reached")}}class tE extends Fe{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class ks{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let n=this.decodeText(e);if(this.trailingCR&&(n="\r"+n,this.trailingCR=!1),n.endsWith("\r")&&(this.trailingCR=!0,n=n.slice(0,-1)),!n)return[];const r=ks.NEWLINE_CHARS.has(n[n.length-1]||"");let s=n.split(ks.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Fe(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Fe(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Fe("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}ks.NEWLINE_CHARS=new Set([`
`,"\r"]);ks.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function nE(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class dr{constructor(e,n){this.iterator=e,this.controller=n}static fromSSEResponse(e,n){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const i of i6(e,n))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null){let o;try{o=JSON.parse(i.data)}catch(u){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),u}if(o&&o.error)throw new Dt(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(i.data)}catch(u){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),u}if(i.event=="error")throw new Dt(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||n.abort()}}return new dr(s,n)}static fromReadableStream(e,n){let r=!1;async function*s(){const i=new ks,o=nE(e);for await(const u of o)for(const c of i.decode(u))yield c;for(const u of i.flush())yield u}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||n.abort()}}return new dr(a,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],r=this.iterator(),s=a=>({next:()=>{if(a.length===0){const i=r.next();e.push(i),n.push(i)}return a.shift()}});return[new dr(()=>s(e),this.controller),new dr(()=>s(n),this.controller)]}toReadableStream(){const e=this;let n;const r=new TextEncoder;return new H1({async start(){n=e[Symbol.asyncIterator]()},async pull(s){try{const{value:a,done:i}=await n.next();if(i)return s.close();const o=r.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){var s;await((s=n.return)==null?void 0:s.call(n))}})}}async function*i6(t,e){if(!t.body)throw e.abort(),new Fe("Attempted to iterate over a response with no body");const n=new c6,r=new ks,s=nE(t.body);for await(const a of o6(s))for(const i of r.decode(a)){const o=n.decode(i);o&&(yield o)}for(const a of r.flush()){const i=n.decode(a);i&&(yield i)}}async function*o6(t){let e=new Uint8Array;for await(const n of t){if(n==null)continue;const r=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let a;for(;(a=u6(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}function u6(t){for(let r=0;r<t.length-2;r++){if(t[r]===10&&t[r+1]===10||t[r]===13&&t[r+1]===13)return r+2;if(t[r]===13&&t[r+1]===10&&r+3<t.length&&t[r+2]===13&&t[r+3]===10)return r+4}return-1}class c6{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,s]=l6(e,":");return s.startsWith(" ")&&(s=s.substring(1)),n==="event"?this.event=s:n==="data"&&this.data.push(s),null}}function l6(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}const rE=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",sE=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&il(t),il=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",d6=t=>sE(t)||rE(t)||z1(t);async function aE(t,e,n){var s;if(t=await t,sE(t))return t;if(rE(t)){const a=await t.blob();e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=il(a)?[await a.arrayBuffer()]:[a];return new Ih(i,e,n)}const r=await h6(t);if(e||(e=m6(t)??"unknown_file"),!(n!=null&&n.type)){const a=(s=r[0])==null?void 0:s.type;typeof a=="string"&&(n={...n,type:a})}return new Ih(r,e,n)}async function h6(t){var n;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(il(t))e.push(await t.arrayBuffer());else if(p6(t))for await(const r of t)e.push(r);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${(n=t==null?void 0:t.constructor)==null?void 0:n.name}; props: ${f6(t)}`);return e}function f6(t){return`[${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}function m6(t){var e;return gd(t.name)||gd(t.filename)||((e=gd(t.path))==null?void 0:e.split(/[\\/]/).pop())}const gd=t=>{if(typeof t=="string")return t;if(typeof Buffer<"u"&&t instanceof Buffer)return String(t)},p6=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",b0=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody",ga=async t=>{const e=await g6(t.body);return $1(e,t)},g6=async t=>{const e=new j1;return await Promise.all(Object.entries(t||{}).map(([n,r])=>Nh(e,n,r))),e},Nh=async(t,e,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")t.append(e,String(n));else if(d6(n)){const r=await aE(n);t.append(e,r)}else if(Array.isArray(n))await Promise.all(n.map(r=>Nh(t,e+"[]",r)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([r,s])=>Nh(t,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}};var b6=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},_6=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},ru;async function iE(t){const{response:e}=t;if(t.options.stream)return ia("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):dr.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const n=e.headers.get("content-type");if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.includes("application/vnd.api+json"))){const a=await e.json();return ia("response",e.status,e.url,e.headers,a),oE(a,e)}const s=await e.text();return ia("response",e.status,e.url,e.headers,s),s}function oE(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class ol extends Promise{constructor(e,n=iE){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=n}_thenUnwrap(e){return new ol(this.responsePromise,async n=>oE(e(await this.parseResponse(n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class y6{constructor({baseURL:e,maxRetries:n=2,timeout:r=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=bd("maxRetries",n),this.timeout=bd("timeout",r),this.httpAgent=s,this.fetch=a??U1}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...C6(),...this.authHeaders(e)}}validateHeaders(e,n){}defaultIdempotencyKey(){return`stainless-node-retry-${I6()}`}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,r){return this.request(Promise.resolve(r).then(async s=>{const a=s&&il(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:n,...s,body:a}}))}getAPIList(e,n,r){return this.requestAPIList(n,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:n=0}={}){var h;e={...e};const{method:r,path:s,query:a,headers:i={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:b0(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,u=this.calculateContentLength(o),c=this.buildURL(s,a);"timeout"in e&&bd("timeout",e.timeout),e.timeout=e.timeout??this.timeout;const l=e.httpAgent??this.httpAgent??q1(c),d=e.timeout+1e3;typeof((h=l==null?void 0:l.options)==null?void 0:h.timeout)=="number"&&d>(l.options.timeout??0)&&(l.options.timeout=d),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const m=this.buildHeaders({options:e,headers:i,contentLength:u,retryCount:n});return{req:{method:r,...o&&{body:o},headers:m,...l&&{agent:l},signal:e.signal??null},url:c,timeout:e.timeout}}buildHeaders({options:e,headers:n,contentLength:r,retryCount:s}){const a={};r&&(a["content-length"]=r);const i=this.defaultHeaders(e);return w0(a,i),w0(a,n),b0(e.body)&&bi!=="node"&&delete a["content-type"],au(i,"x-stainless-retry-count")===void 0&&au(n,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(s)),au(i,"x-stainless-timeout")===void 0&&au(n,"x-stainless-timeout")===void 0&&e.timeout&&(a["x-stainless-timeout"]=String(e.timeout)),this.validateHeaders(a,n),a}async prepareOptions(e){}async prepareRequest(e,{url:n,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(n=>[...n])):{...e}:{}}makeStatusError(e,n,r,s){return Dt.generate(e,n,r,s)}request(e,n=null){return new ol(this.makeRequest(e,n))}async makeRequest(e,n){var d,m;const r=await e,s=r.maxRetries??this.maxRetries;n==null&&(n=s),await this.prepareOptions(r);const{req:a,url:i,timeout:o}=this.buildRequest(r,{retryCount:s-n});if(await this.prepareRequest(a,{url:i,options:r}),ia("request",i,r,a.headers),(d=r.signal)!=null&&d.aborted)throw new On;const u=new AbortController,c=await this.fetchWithTimeout(i,a,o,u).catch(Rh);if(c instanceof Error){if((m=r.signal)!=null&&m.aborted)throw new On;if(n)return this.retryRequest(r,n);throw c.name==="AbortError"?new al:new sl({cause:c})}const l=w6(c.headers);if(!c.ok){if(n&&this.shouldRetry(c)){const y=`retrying, ${n} attempts remaining`;return ia(`response (error; ${y})`,c.status,i,l),this.retryRequest(r,n,l)}const p=await c.text().catch(y=>Rh(y).message),h=v6(p),g=h?void 0:p;throw ia(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,c.status,i,l,g),this.makeStatusError(c.status,h,g,l)}return{response:c,options:r,controller:u}}requestAPIList(e,n){const r=this.makeRequest(n,null);return new E6(this,r,e)}buildURL(e,n){const r=k6(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return cE(s)||(n={...s,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(r.search=this.stringifyQuery(n)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new Fe(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,n,r,s){const{signal:a,...i}=n||{};a&&a.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r),u={signal:s.signal,...i};return u.method&&(u.method=u.method.toUpperCase()),this.fetch.call(void 0,e,u).finally(()=>{clearTimeout(o)})}shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,r){let s;const a=r==null?void 0:r["retry-after-ms"];if(a){const o=parseFloat(a);Number.isNaN(o)||(s=o)}const i=r==null?void 0:r["retry-after"];if(i&&!s){const o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(n,o)}return await yo(s),this.makeRequest(e,n-1)}calculateDefaultRetryTimeoutMillis(e,n){const a=n-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ys}`}}class uE{constructor(e,n,r,s){ru.set(this,void 0),b6(this,ru,e,"f"),this.options=s,this.response=n,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new Fe("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...this.options};if("params"in e&&typeof n.query=="object")n.query={...n.query,...e.params};else if("url"in e){const r=[...Object.entries(n.query||{}),...e.url.searchParams.entries()];for(const[s,a]of r)e.url.searchParams.set(s,a);n.query=void 0,n.path=e.url.toString()}return await _6(this,ru,"f").requestAPIList(this.constructor,n)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(ru=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const n of e.getPaginatedItems())yield n}}class E6 extends ol{constructor(e,n,r){super(n,async s=>new r(e,s.response,await iE(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const n of e)yield n}}const w6=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,n){const r=n.toString();return e[r.toLowerCase()]||e[r]}}),T6={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},an=t=>typeof t=="object"&&t!==null&&!cE(t)&&Object.keys(t).every(e=>lE(T6,e)),S6=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ys,"X-Stainless-OS":y0(Deno.build.os),"X-Stainless-Arch":_0(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ys,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ys,"X-Stainless-OS":y0(process.platform),"X-Stainless-Arch":_0(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=A6();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ys,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ys,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function A6(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const r=n.exec(navigator.userAgent);if(r){const s=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}const _0=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",y0=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let E0;const C6=()=>E0??(E0=S6()),v6=t=>{try{return JSON.parse(t)}catch{return}},O6=/^[a-z][a-z0-9+.-]*:/i,k6=t=>O6.test(t),yo=t=>new Promise(e=>setTimeout(e,t)),bd=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Fe(`${t} must be an integer`);if(e<0)throw new Fe(`${t} must be a positive integer`);return e},Rh=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch{}return new Error(t)},su=t=>{var e,n,r,s,a;if(typeof process<"u")return((n=(e=process.env)==null?void 0:e[t])==null?void 0:n.trim())??void 0;if(typeof Deno<"u")return(a=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,t))==null?void 0:a.trim()};function cE(t){if(!t)return!0;for(const e in t)return!1;return!0}function lE(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function w0(t,e){for(const n in e){if(!lE(e,n))continue;const r=n.toLowerCase();if(!r)continue;const s=e[n];s===null?delete t[r]:s!==void 0&&(t[r]=s)}}const T0=new Set(["authorization","api-key"]);function ia(t,...e){var n;if(typeof process<"u"&&((n=process==null?void 0:process.env)==null?void 0:n.DEBUG)==="true"){const r=e.map(s=>{if(!s)return s;if(s.headers){const i={...s,headers:{...s.headers}};for(const o in s.headers)T0.has(o.toLowerCase())&&(i.headers[o]="REDACTED");return i}let a=null;for(const i in s)T0.has(i.toLowerCase())&&(a??(a={...s}),a[i]="REDACTED");return a??s});console.log(`OpenAI:DEBUG:${t}`,...r)}}const I6=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),N6=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",R6=t=>typeof(t==null?void 0:t.get)=="function",au=(t,e)=>{var r;const n=e.toLowerCase();if(R6(t)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,i,o)=>i+o.toUpperCase());for(const a of[e,n,e.toUpperCase(),s]){const i=t.get(a);if(i)return i}}for(const[s,a]of Object.entries(t))if(s.toLowerCase()===n)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a};function _d(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}class P6 extends uE{constructor(e,n,r,s){super(e,n,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Zn extends uE{constructor(e,n,r,s){super(e,n,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const n=Object.fromEntries(e.url.searchParams);return Object.keys(n).length?n:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const n=(r=e[e.length-1])==null?void 0:r.id;return n?{params:{after:n}}:null}}class Ge{constructor(e){this._client=e}}let dE=class extends Ge{create(e,n){return this._client.post("/chat/completions",{body:e,...n,stream:e.stream??!1})}},zf=class extends Ge{constructor(){super(...arguments),this.completions=new dE(this._client)}};zf.Completions=dE;class hE extends Ge{create(e,n){return this._client.post("/audio/speech",{body:e,...n,headers:{Accept:"application/octet-stream",...n==null?void 0:n.headers},__binaryResponse:!0})}}class fE extends Ge{create(e,n){return this._client.post("/audio/transcriptions",ga({body:e,...n,__metadata:{model:e.model}}))}}class mE extends Ge{create(e,n){return this._client.post("/audio/translations",ga({body:e,...n,__metadata:{model:e.model}}))}}class Eo extends Ge{constructor(){super(...arguments),this.transcriptions=new fE(this._client),this.translations=new mE(this._client),this.speech=new hE(this._client)}}Eo.Transcriptions=fE;Eo.Translations=mE;Eo.Speech=hE;class Wf extends Ge{create(e,n){return this._client.post("/batches",{body:e,...n})}retrieve(e,n){return this._client.get(`/batches/${e}`,n)}list(e={},n){return an(e)?this.list({},e):this._client.getAPIList("/batches",Gf,{query:e,...n})}cancel(e,n){return this._client.post(`/batches/${e}/cancel`,n)}}class Gf extends Zn{}Wf.BatchesPage=Gf;class Kf extends Ge{create(e,n){return this._client.post("/assistants",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,r){return this._client.post(`/assistants/${e}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},n){return an(e)?this.list({},e):this._client.getAPIList("/assistants",Yf,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Yf extends Zn{}Kf.AssistantsPage=Yf;function S0(t){return typeof t.parse=="function"}const oa=t=>(t==null?void 0:t.role)==="assistant",pE=t=>(t==null?void 0:t.role)==="function",gE=t=>(t==null?void 0:t.role)==="tool";var Dn=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},ot=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},Ph,Au,Cu,ri,si,vu,ai,Tr,ii,uc,cc,Zs,bE;class _E{constructor(){Ph.add(this),this.controller=new AbortController,Au.set(this,void 0),Cu.set(this,()=>{}),ri.set(this,()=>{}),si.set(this,void 0),vu.set(this,()=>{}),ai.set(this,()=>{}),Tr.set(this,{}),ii.set(this,!1),uc.set(this,!1),cc.set(this,!1),Zs.set(this,!1),Dn(this,Au,new Promise((e,n)=>{Dn(this,Cu,e,"f"),Dn(this,ri,n,"f")}),"f"),Dn(this,si,new Promise((e,n)=>{Dn(this,vu,e,"f"),Dn(this,ai,n,"f")}),"f"),ot(this,Au,"f").catch(()=>{}),ot(this,si,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},ot(this,Ph,"m",bE).bind(this))},0)}_connected(){this.ended||(ot(this,Cu,"f").call(this),this._emit("connect"))}get ended(){return ot(this,ii,"f")}get errored(){return ot(this,uc,"f")}get aborted(){return ot(this,cc,"f")}abort(){this.controller.abort()}on(e,n){return(ot(this,Tr,"f")[e]||(ot(this,Tr,"f")[e]=[])).push({listener:n}),this}off(e,n){const r=ot(this,Tr,"f")[e];if(!r)return this;const s=r.findIndex(a=>a.listener===n);return s>=0&&r.splice(s,1),this}once(e,n){return(ot(this,Tr,"f")[e]||(ot(this,Tr,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,r)=>{Dn(this,Zs,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,n)})}async done(){Dn(this,Zs,!0,"f"),await ot(this,si,"f")}_emit(e,...n){if(ot(this,ii,"f"))return;e==="end"&&(Dn(this,ii,!0,"f"),ot(this,vu,"f").call(this));const r=ot(this,Tr,"f")[e];if(r&&(ot(this,Tr,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...n))),e==="abort"){const s=n[0];!ot(this,Zs,"f")&&!(r!=null&&r.length)&&Promise.reject(s),ot(this,ri,"f").call(this,s),ot(this,ai,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=n[0];!ot(this,Zs,"f")&&!(r!=null&&r.length)&&Promise.reject(s),ot(this,ri,"f").call(this,s),ot(this,ai,"f").call(this,s),this._emit("end")}}_emitFinal(){}}Au=new WeakMap,Cu=new WeakMap,ri=new WeakMap,si=new WeakMap,vu=new WeakMap,ai=new WeakMap,Tr=new WeakMap,ii=new WeakMap,uc=new WeakMap,cc=new WeakMap,Zs=new WeakMap,Ph=new WeakSet,bE=function(e){if(Dn(this,uc,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new On),e instanceof On)return Dn(this,cc,!0,"f"),this._emit("abort",e);if(e instanceof Fe)return this._emit("error",e);if(e instanceof Error){const n=new Fe(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new Fe(String(e)))};function x6(t,e){const n={...t};return Object.defineProperties(n,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),n}function yE(t){return(t==null?void 0:t.$brand)==="auto-parseable-response-format"}function L6(t,{parser:e,callback:n}){const r={...t};return Object.defineProperties(r,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:n,enumerable:!1}}),r}function wo(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function D6(t,e){return!e||!EE(e)?{...t,choices:t.choices.map(n=>({...n,message:{...n.message,parsed:null,tool_calls:n.message.tool_calls??[]}}))}:Zf(t,e)}function Zf(t,e){const n=t.choices.map(r=>{var s;if(r.finish_reason==="length")throw new eE;if(r.finish_reason==="content_filter")throw new tE;return{...r,message:{...r.message,tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(a=>B6(e,a)))??[],parsed:r.message.content&&!r.message.refusal?M6(e,r.message.content):null}}});return{...t,choices:n}}function M6(t,e){var n,r;return((n=t.response_format)==null?void 0:n.type)!=="json_schema"?null:((r=t.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function B6(t,e){var r;const n=(r=t.tools)==null?void 0:r.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:wo(n)?n.$parseRaw(e.function.arguments):n!=null&&n.function.strict?JSON.parse(e.function.arguments):null}}}function F6(t,e){var r;if(!t)return!1;const n=(r=t.tools)==null?void 0:r.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return wo(n)||(n==null?void 0:n.function.strict)||!1}function EE(t){var e;return yE(t.response_format)?!0:((e=t.tools)==null?void 0:e.some(n=>wo(n)||n.type==="function"&&n.function.strict===!0))??!1}function U6(t){for(const e of t??[]){if(e.type!=="function")throw new Fe(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new Fe(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Jt=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},Mt,xh,lc,Lh,Dh,Mh,wE,Bh;const A0=10;class TE extends _E{constructor(){super(...arguments),Mt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const n=(r=e.choices[0])==null?void 0:r.message;return n&&this._addMessage(n),e}_addMessage(e,n=!0){if("content"in e||(e.content=null),this.messages.push(e),n){if(this._emit("message",e),(pE(e)||gE(e))&&e.content)this._emit("functionCallResult",e.content);else if(oa(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(oa(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new Fe("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Jt(this,Mt,"m",xh).call(this)}async finalMessage(){return await this.done(),Jt(this,Mt,"m",lc).call(this)}async finalFunctionCall(){return await this.done(),Jt(this,Mt,"m",Lh).call(this)}async finalFunctionCallResult(){return await this.done(),Jt(this,Mt,"m",Dh).call(this)}async totalUsage(){return await this.done(),Jt(this,Mt,"m",Mh).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const n=Jt(this,Mt,"m",lc).call(this);n&&this._emit("finalMessage",n);const r=Jt(this,Mt,"m",xh).call(this);r&&this._emit("finalContent",r);const s=Jt(this,Mt,"m",Lh).call(this);s&&this._emit("finalFunctionCall",s);const a=Jt(this,Mt,"m",Dh).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",Jt(this,Mt,"m",Mh).call(this))}async _createChatCompletion(e,n,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Jt(this,Mt,"m",wE).call(this,n);const a=await e.chat.completions.create({...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Zf(a,n))}async _runChatCompletion(e,n,r){for(const s of n.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,n,r)}async _runFunctions(e,n,r){var m;const s="function",{function_call:a="auto",stream:i,...o}=n,u=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:c=A0}=r||{},l={};for(const p of n.functions)l[p.name||p.function.name]=p;const d=n.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(const p of n.messages)this._addMessage(p,!1);for(let p=0;p<c;++p){const g=(m=(await this._createChatCompletion(e,{...o,function_call:a,functions:d,messages:[...this.messages]},r)).choices[0])==null?void 0:m.message;if(!g)throw new Fe("missing message in ChatCompletion response");if(!g.function_call)return;const{name:b,arguments:_}=g.function_call,y=l[b];if(y){if(u&&u!==b){const R=`Invalid function_call: ${JSON.stringify(b)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,name:b,content:R});continue}}else{const R=`Invalid function_call: ${JSON.stringify(b)}. Available options are: ${d.map(v=>JSON.stringify(v.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:b,content:R});continue}let E;try{E=S0(y)?await y.parse(_):_}catch(R){this._addMessage({role:s,name:b,content:R instanceof Error?R.message:String(R)});continue}const I=await y.function(E,this),w=Jt(this,Mt,"m",Bh).call(this,I);if(this._addMessage({role:s,name:b,content:w}),u)return}}async _runTools(e,n,r){var p,h,g;const s="tool",{tool_choice:a="auto",stream:i,...o}=n,u=typeof a!="string"&&((p=a==null?void 0:a.function)==null?void 0:p.name),{maxChatCompletions:c=A0}=r||{},l=n.tools.map(b=>{if(wo(b)){if(!b.$callback)throw new Fe("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:b.$callback,name:b.function.name,description:b.function.description||"",parameters:b.function.parameters,parse:b.$parseRaw,strict:!0}}}return b}),d={};for(const b of l)b.type==="function"&&(d[b.function.name||b.function.function.name]=b.function);const m="tools"in n?l.map(b=>b.type==="function"?{type:"function",function:{name:b.function.name||b.function.function.name,parameters:b.function.parameters,description:b.function.description,strict:b.function.strict}}:b):void 0;for(const b of n.messages)this._addMessage(b,!1);for(let b=0;b<c;++b){const y=(h=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:m,messages:[...this.messages]},r)).choices[0])==null?void 0:h.message;if(!y)throw new Fe("missing message in ChatCompletion response");if(!((g=y.tool_calls)!=null&&g.length))return;for(const E of y.tool_calls){if(E.type!=="function")continue;const I=E.id,{name:w,arguments:R}=E.function,v=d[w];if(v){if(u&&u!==w){const H=`Invalid tool_call: ${JSON.stringify(w)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,tool_call_id:I,content:H});continue}}else{const H=`Invalid tool_call: ${JSON.stringify(w)}. Available options are: ${Object.keys(d).map(te=>JSON.stringify(te)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:I,content:H});continue}let j;try{j=S0(v)?await v.parse(R):R}catch(H){const te=H instanceof Error?H.message:String(H);this._addMessage({role:s,tool_call_id:I,content:te});continue}const F=await v.function(j,this),x=Jt(this,Mt,"m",Bh).call(this,F);if(this._addMessage({role:s,tool_call_id:I,content:x}),u)return}}}}Mt=new WeakSet,xh=function(){return Jt(this,Mt,"m",lc).call(this).content??null},lc=function(){let e=this.messages.length;for(;e-- >0;){const n=this.messages[e];if(oa(n)){const{function_call:r,...s}=n,a={...s,content:n.content??null,refusal:n.refusal??null};return r&&(a.function_call=r),a}}throw new Fe("stream ended without producing a ChatCompletionMessage with role=assistant")},Lh=function(){var e,n;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(oa(s)&&(s!=null&&s.function_call))return s.function_call;if(oa(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(n=s.tool_calls.at(-1))==null?void 0:n.function}},Dh=function(){for(let e=this.messages.length-1;e>=0;e--){const n=this.messages[e];if(pE(n)&&n.content!=null||gE(n)&&n.content!=null&&typeof n.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(a=>a.type==="function"&&a.id===n.tool_call_id))}))return n.content}},Mh=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:n}of this._chatCompletions)n&&(e.completion_tokens+=n.completion_tokens,e.prompt_tokens+=n.prompt_tokens,e.total_tokens+=n.total_tokens);return e},wE=function(e){if(e.n!=null&&e.n>1)throw new Fe("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Bh=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Ki extends TE{static runFunctions(e,n,r){const s=new Ki,a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,n,a)),s}static runTools(e,n,r){const s=new Ki,a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,n,a)),s}_addMessage(e,n=!0){super._addMessage(e,n),oa(e)&&e.content&&this._emit("content",e.content)}}const SE=1,AE=2,CE=4,vE=8,OE=16,kE=32,IE=64,NE=128,RE=256,PE=NE|RE,xE=OE|kE|PE|IE,LE=SE|AE|xE,DE=CE|vE,j6=LE|DE,kt={STR:SE,NUM:AE,ARR:CE,OBJ:vE,NULL:OE,BOOL:kE,NAN:IE,INFINITY:NE,MINUS_INFINITY:RE,INF:PE,SPECIAL:xE,ATOM:LE,COLLECTION:DE,ALL:j6};class H6 extends Error{}class $6 extends Error{}function q6(t,e=kt.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return V6(t.trim(),e)}const V6=(t,e)=>{const n=t.length;let r=0;const s=m=>{throw new H6(`${m} at position ${r}`)},a=m=>{throw new $6(`${m} at position ${r}`)},i=()=>(d(),r>=n&&s("Unexpected end of input"),t[r]==='"'?o():t[r]==="{"?u():t[r]==="["?c():t.substring(r,r+4)==="null"||kt.NULL&e&&n-r<4&&"null".startsWith(t.substring(r))?(r+=4,null):t.substring(r,r+4)==="true"||kt.BOOL&e&&n-r<4&&"true".startsWith(t.substring(r))?(r+=4,!0):t.substring(r,r+5)==="false"||kt.BOOL&e&&n-r<5&&"false".startsWith(t.substring(r))?(r+=5,!1):t.substring(r,r+8)==="Infinity"||kt.INFINITY&e&&n-r<8&&"Infinity".startsWith(t.substring(r))?(r+=8,1/0):t.substring(r,r+9)==="-Infinity"||kt.MINUS_INFINITY&e&&1<n-r&&n-r<9&&"-Infinity".startsWith(t.substring(r))?(r+=9,-1/0):t.substring(r,r+3)==="NaN"||kt.NAN&e&&n-r<3&&"NaN".startsWith(t.substring(r))?(r+=3,NaN):l()),o=()=>{const m=r;let p=!1;for(r++;r<n&&(t[r]!=='"'||p&&t[r-1]==="\\");)p=t[r]==="\\"?!p:!1,r++;if(t.charAt(r)=='"')try{return JSON.parse(t.substring(m,++r-Number(p)))}catch(h){a(String(h))}else if(kt.STR&e)try{return JSON.parse(t.substring(m,r-Number(p))+'"')}catch{return JSON.parse(t.substring(m,t.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},u=()=>{r++,d();const m={};try{for(;t[r]!=="}";){if(d(),r>=n&&kt.OBJ&e)return m;const p=o();d(),r++;try{const h=i();Object.defineProperty(m,p,{value:h,writable:!0,enumerable:!0,configurable:!0})}catch(h){if(kt.OBJ&e)return m;throw h}d(),t[r]===","&&r++}}catch{if(kt.OBJ&e)return m;s("Expected '}' at end of object")}return r++,m},c=()=>{r++;const m=[];try{for(;t[r]!=="]";)m.push(i()),d(),t[r]===","&&r++}catch{if(kt.ARR&e)return m;s("Expected ']' at end of array")}return r++,m},l=()=>{if(r===0){t==="-"&&kt.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t)}catch(p){if(kt.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}a(String(p))}}const m=r;for(t[r]==="-"&&r++;t[r]&&!",]}".includes(t[r]);)r++;r==n&&!(kt.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(t.substring(m,r))}catch{t.substring(m,r)==="-"&&kt.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t.substring(m,t.lastIndexOf("e")))}catch(h){a(String(h))}}},d=()=>{for(;r<n&&` 
\r	`.includes(t[r]);)r++};return i()},C0=t=>q6(t,kt.ALL^kt.NUM);var Hs=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},nt=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},yt,Er,$s,Fr,yd,iu,Ed,wd,Td,ou,Sd,v0;class Yi extends TE{constructor(e){super(),yt.add(this),Er.set(this,void 0),$s.set(this,void 0),Fr.set(this,void 0),Hs(this,Er,e,"f"),Hs(this,$s,[],"f")}get currentChatCompletionSnapshot(){return nt(this,Fr,"f")}static fromReadableStream(e){const n=new Yi(null);return n._run(()=>n._fromReadableStream(e)),n}static createChatCompletion(e,n,r){const s=new Yi(n);return s._run(()=>s._runChatCompletion(e,{...n,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,n,r){var i;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),nt(this,yt,"m",yd).call(this);const a=await e.chat.completions.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of a)nt(this,yt,"m",Ed).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new On;return this._addChatCompletion(nt(this,yt,"m",ou).call(this))}async _fromReadableStream(e,n){var i;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),nt(this,yt,"m",yd).call(this),this._connected();const s=dr.fromReadableStream(e,this.controller);let a;for await(const o of s)a&&a!==o.id&&this._addChatCompletion(nt(this,yt,"m",ou).call(this)),nt(this,yt,"m",Ed).call(this,o),a=o.id;if((i=s.controller.signal)!=null&&i.aborted)throw new On;return this._addChatCompletion(nt(this,yt,"m",ou).call(this))}[(Er=new WeakMap,$s=new WeakMap,Fr=new WeakMap,yt=new WeakSet,yd=function(){this.ended||Hs(this,Fr,void 0,"f")},iu=function(n){let r=nt(this,$s,"f")[n.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},nt(this,$s,"f")[n.index]=r,r)},Ed=function(n){var s,a,i,o,u,c,l,d,m,p,h,g,b,_,y;if(this.ended)return;const r=nt(this,yt,"m",v0).call(this,n);this._emit("chunk",n,r);for(const E of n.choices){const I=r.choices[E.index];E.delta.content!=null&&((s=I.message)==null?void 0:s.role)==="assistant"&&((a=I.message)!=null&&a.content)&&(this._emit("content",E.delta.content,I.message.content),this._emit("content.delta",{delta:E.delta.content,snapshot:I.message.content,parsed:I.message.parsed})),E.delta.refusal!=null&&((i=I.message)==null?void 0:i.role)==="assistant"&&((o=I.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:E.delta.refusal,snapshot:I.message.refusal}),((u=E.logprobs)==null?void 0:u.content)!=null&&((c=I.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(l=E.logprobs)==null?void 0:l.content,snapshot:((d=I.logprobs)==null?void 0:d.content)??[]}),((m=E.logprobs)==null?void 0:m.refusal)!=null&&((p=I.message)==null?void 0:p.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(h=E.logprobs)==null?void 0:h.refusal,snapshot:((g=I.logprobs)==null?void 0:g.refusal)??[]});const w=nt(this,yt,"m",iu).call(this,I);I.finish_reason&&(nt(this,yt,"m",Td).call(this,I),w.current_tool_call_index!=null&&nt(this,yt,"m",wd).call(this,I,w.current_tool_call_index));for(const R of E.delta.tool_calls??[])w.current_tool_call_index!==R.index&&(nt(this,yt,"m",Td).call(this,I),w.current_tool_call_index!=null&&nt(this,yt,"m",wd).call(this,I,w.current_tool_call_index)),w.current_tool_call_index=R.index;for(const R of E.delta.tool_calls??[]){const v=(b=I.message.tool_calls)==null?void 0:b[R.index];v!=null&&v.type&&((v==null?void 0:v.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(_=v.function)==null?void 0:_.name,index:R.index,arguments:v.function.arguments,parsed_arguments:v.function.parsed_arguments,arguments_delta:((y=R.function)==null?void 0:y.arguments)??""}):(v==null||v.type,void 0))}}},wd=function(n,r){var i,o,u;if(nt(this,yt,"m",iu).call(this,n).done_tool_calls.has(r))return;const a=(i=n.message.tool_calls)==null?void 0:i[r];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const c=(u=(o=nt(this,Er,"f"))==null?void 0:o.tools)==null?void 0:u.find(l=>l.type==="function"&&l.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:r,arguments:a.function.arguments,parsed_arguments:wo(c)?c.$parseRaw(a.function.arguments):c!=null&&c.function.strict?JSON.parse(a.function.arguments):null})}else a.type},Td=function(n){var s,a;const r=nt(this,yt,"m",iu).call(this,n);if(n.message.content&&!r.content_done){r.content_done=!0;const i=nt(this,yt,"m",Sd).call(this);this._emit("content.done",{content:n.message.content,parsed:i?i.$parseRaw(n.message.content):null})}n.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:n.message.refusal})),(s=n.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:n.logprobs.content})),(a=n.logprobs)!=null&&a.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:n.logprobs.refusal}))},ou=function(){if(this.ended)throw new Fe("stream has ended, this shouldn't happen");const n=nt(this,Fr,"f");if(!n)throw new Fe("request ended without sending any chunks");return Hs(this,Fr,void 0,"f"),Hs(this,$s,[],"f"),z6(n,nt(this,Er,"f"))},Sd=function(){var r;const n=(r=nt(this,Er,"f"))==null?void 0:r.response_format;return yE(n)?n:null},v0=function(n){var r,s,a,i;let o=nt(this,Fr,"f");const{choices:u,...c}=n;o?Object.assign(o,c):o=Hs(this,Fr,{...c,choices:[]},"f");for(const{delta:l,finish_reason:d,index:m,logprobs:p=null,...h}of n.choices){let g=o.choices[m];if(g||(g=o.choices[m]={finish_reason:d,index:m,message:{},logprobs:p,...h}),p)if(!g.logprobs)g.logprobs=Object.assign({},p);else{const{content:R,refusal:v,...j}=p;Object.assign(g.logprobs,j),R&&((r=g.logprobs).content??(r.content=[]),g.logprobs.content.push(...R)),v&&((s=g.logprobs).refusal??(s.refusal=[]),g.logprobs.refusal.push(...v))}if(d&&(g.finish_reason=d,nt(this,Er,"f")&&EE(nt(this,Er,"f")))){if(d==="length")throw new eE;if(d==="content_filter")throw new tE}if(Object.assign(g,h),!l)continue;const{content:b,refusal:_,function_call:y,role:E,tool_calls:I,...w}=l;if(Object.assign(g.message,w),_&&(g.message.refusal=(g.message.refusal||"")+_),E&&(g.message.role=E),y&&(g.message.function_call?(y.name&&(g.message.function_call.name=y.name),y.arguments&&((a=g.message.function_call).arguments??(a.arguments=""),g.message.function_call.arguments+=y.arguments)):g.message.function_call=y),b&&(g.message.content=(g.message.content||"")+b,!g.message.refusal&&nt(this,yt,"m",Sd).call(this)&&(g.message.parsed=C0(g.message.content))),I){g.message.tool_calls||(g.message.tool_calls=[]);for(const{index:R,id:v,type:j,function:F,...x}of I){const H=(i=g.message.tool_calls)[R]??(i[R]={});Object.assign(H,x),v&&(H.id=v),j&&(H.type=j),F&&(H.function??(H.function={name:F.name??"",arguments:""})),F!=null&&F.name&&(H.function.name=F.name),F!=null&&F.arguments&&(H.function.arguments+=F.arguments,F6(nt(this,Er,"f"),H)&&(H.function.parsed_arguments=C0(H.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("chunk",s=>{const a=n.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>n.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new dr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function z6(t,e){const{id:n,choices:r,created:s,model:a,system_fingerprint:i,...o}=t,u={...o,id:n,choices:r.map(({message:c,finish_reason:l,index:d,logprobs:m,...p})=>{if(!l)throw new Fe(`missing finish_reason for choice ${d}`);const{content:h=null,function_call:g,tool_calls:b,..._}=c,y=c.role;if(!y)throw new Fe(`missing role for choice ${d}`);if(g){const{arguments:E,name:I}=g;if(E==null)throw new Fe(`missing function_call.arguments for choice ${d}`);if(!I)throw new Fe(`missing function_call.name for choice ${d}`);return{...p,message:{content:h,function_call:{arguments:E,name:I},role:y,refusal:c.refusal??null},finish_reason:l,index:d,logprobs:m}}return b?{...p,index:d,finish_reason:l,logprobs:m,message:{..._,role:y,content:h,refusal:c.refusal??null,tool_calls:b.map((E,I)=>{const{function:w,type:R,id:v,...j}=E,{arguments:F,name:x,...H}=w||{};if(v==null)throw new Fe(`missing choices[${d}].tool_calls[${I}].id
${uu(t)}`);if(R==null)throw new Fe(`missing choices[${d}].tool_calls[${I}].type
${uu(t)}`);if(x==null)throw new Fe(`missing choices[${d}].tool_calls[${I}].function.name
${uu(t)}`);if(F==null)throw new Fe(`missing choices[${d}].tool_calls[${I}].function.arguments
${uu(t)}`);return{...j,id:v,type:R,function:{...H,name:x,arguments:F}}})}}:{...p,message:{..._,content:h,role:y,refusal:c.refusal??null},finish_reason:l,index:d,logprobs:m}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return D6(u,e)}function uu(t){return JSON.stringify(t)}class ua extends Yi{static fromReadableStream(e){const n=new ua(null);return n._run(()=>n._fromReadableStream(e)),n}static runFunctions(e,n,r){const s=new ua(null),a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,n,a)),s}static runTools(e,n,r){const s=new ua(n),a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,n,a)),s}}let ME=class extends Ge{parse(e,n){return U6(e.tools),this._client.chat.completions.create(e,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>Zf(r,e))}runFunctions(e,n){return e.stream?ua.runFunctions(this._client,e,n):Ki.runFunctions(this._client,e,n)}runTools(e,n){return e.stream?ua.runTools(this._client,e,n):Ki.runTools(this._client,e,n)}stream(e,n){return Yi.createChatCompletion(this._client,e,n)}},BE=class extends Ge{constructor(){super(...arguments),this.completions=new ME(this._client)}};(function(t){t.Completions=ME})(BE);class FE extends Ge{create(e,n){return this._client.post("/realtime/sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Jf extends Ge{constructor(){super(...arguments),this.sessions=new FE(this._client)}}Jf.Sessions=FE;var fe=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},on=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},Lt,Fh,sr,Ou,Mn,fs,ea,as,dc,cn,ku,Iu,_i,oi,ui,O0,k0,I0,N0,R0,P0,x0;class Un extends _E{constructor(){super(...arguments),Lt.add(this),Fh.set(this,[]),sr.set(this,{}),Ou.set(this,{}),Mn.set(this,void 0),fs.set(this,void 0),ea.set(this,void 0),as.set(this,void 0),dc.set(this,void 0),cn.set(this,void 0),ku.set(this,void 0),Iu.set(this,void 0),_i.set(this,void 0)}[(Fh=new WeakMap,sr=new WeakMap,Ou=new WeakMap,Mn=new WeakMap,fs=new WeakMap,ea=new WeakMap,as=new WeakMap,dc=new WeakMap,cn=new WeakMap,ku=new WeakMap,Iu=new WeakMap,_i=new WeakMap,Lt=new WeakSet,Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("event",s=>{const a=n.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>n.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const n=new Un;return n._run(()=>n._fromReadableStream(e)),n}async _fromReadableStream(e,n){var a;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=dr.fromReadableStream(e,this.controller);for await(const i of s)fe(this,Lt,"m",oi).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new On;return this._addRun(fe(this,Lt,"m",ui).call(this))}toReadableStream(){return new dr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,n,r,s,a){const i=new Un;return i._run(()=>i._runToolAssistantStream(e,n,r,s,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,n,r,s,a){var c;const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},u=await e.submitToolOutputs(n,r,o,{...a,signal:this.controller.signal});this._connected();for await(const l of u)fe(this,Lt,"m",oi).call(this,l);if((c=u.controller.signal)!=null&&c.aborted)throw new On;return this._addRun(fe(this,Lt,"m",ui).call(this))}static createThreadAssistantStream(e,n,r){const s=new Un;return s._run(()=>s._threadAssistantStream(e,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,n,r,s){const a=new Un;return a._run(()=>a._runAssistantStream(e,n,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return fe(this,ku,"f")}currentRun(){return fe(this,Iu,"f")}currentMessageSnapshot(){return fe(this,Mn,"f")}currentRunStepSnapshot(){return fe(this,_i,"f")}async finalRunSteps(){return await this.done(),Object.values(fe(this,sr,"f"))}async finalMessages(){return await this.done(),Object.values(fe(this,Ou,"f"))}async finalRun(){if(await this.done(),!fe(this,fs,"f"))throw Error("Final run was not received.");return fe(this,fs,"f")}async _createThreadAssistantStream(e,n,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...n,stream:!0},i=await e.createAndRun(a,{...r,signal:this.controller.signal});this._connected();for await(const u of i)fe(this,Lt,"m",oi).call(this,u);if((o=i.controller.signal)!=null&&o.aborted)throw new On;return this._addRun(fe(this,Lt,"m",ui).call(this))}async _createAssistantStream(e,n,r,s){var u;const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...r,stream:!0},o=await e.create(n,i,{...s,signal:this.controller.signal});this._connected();for await(const c of o)fe(this,Lt,"m",oi).call(this,c);if((u=o.controller.signal)!=null&&u.aborted)throw new On;return this._addRun(fe(this,Lt,"m",ui).call(this))}static accumulateDelta(e,n){for(const[r,s]of Object.entries(n)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let a=e[r];if(a==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if(_d(a)&&_d(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}for(const i of s){if(!_d(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const u=a[o];u==null?a.push(i):a[o]=this.accumulateDelta(u,i)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${a}`);e[r]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,n,r){return await this._createThreadAssistantStream(n,e,r)}async _runAssistantStream(e,n,r,s){return await this._createAssistantStream(n,e,r,s)}async _runToolAssistantStream(e,n,r,s,a){return await this._createToolAssistantStream(r,e,n,s,a)}}oi=function(e){if(!this.ended)switch(on(this,ku,e,"f"),fe(this,Lt,"m",I0).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":fe(this,Lt,"m",x0).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":fe(this,Lt,"m",k0).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":fe(this,Lt,"m",O0).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},ui=function(){if(this.ended)throw new Fe("stream has ended, this shouldn't happen");if(!fe(this,fs,"f"))throw Error("Final run has not been received");return fe(this,fs,"f")},O0=function(e){const[n,r]=fe(this,Lt,"m",R0).call(this,e,fe(this,Mn,"f"));on(this,Mn,n,"f"),fe(this,Ou,"f")[n.id]=n;for(const s of r){const a=n.content[s.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,n),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=n.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=fe(this,ea,"f")){if(fe(this,as,"f"))switch(fe(this,as,"f").type){case"text":this._emit("textDone",fe(this,as,"f").text,fe(this,Mn,"f"));break;case"image_file":this._emit("imageFileDone",fe(this,as,"f").image_file,fe(this,Mn,"f"));break}on(this,ea,s.index,"f")}on(this,as,n.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(fe(this,ea,"f")!==void 0){const s=e.data.content[fe(this,ea,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,fe(this,Mn,"f"));break;case"text":this._emit("textDone",s.text,fe(this,Mn,"f"));break}}fe(this,Mn,"f")&&this._emit("messageDone",e.data),on(this,Mn,void 0,"f")}},k0=function(e){const n=fe(this,Lt,"m",N0).call(this,e);switch(on(this,_i,n,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&n.step_details.type=="tool_calls")for(const a of r.step_details.tool_calls)a.index==fe(this,dc,"f")?this._emit("toolCallDelta",a,n.step_details.tool_calls[a.index]):(fe(this,cn,"f")&&this._emit("toolCallDone",fe(this,cn,"f")),on(this,dc,a.index,"f"),on(this,cn,n.step_details.tool_calls[a.index],"f"),fe(this,cn,"f")&&this._emit("toolCallCreated",fe(this,cn,"f")));this._emit("runStepDelta",e.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":on(this,_i,void 0,"f"),e.data.step_details.type=="tool_calls"&&fe(this,cn,"f")&&(this._emit("toolCallDone",fe(this,cn,"f")),on(this,cn,void 0,"f")),this._emit("runStepDone",e.data,n);break}},I0=function(e){fe(this,Fh,"f").push(e),this._emit("event",e)},N0=function(e){switch(e.event){case"thread.run.step.created":return fe(this,sr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let n=fe(this,sr,"f")[e.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=Un.accumulateDelta(n,r.delta);fe(this,sr,"f")[e.data.id]=s}return fe(this,sr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":fe(this,sr,"f")[e.data.id]=e.data;break}if(fe(this,sr,"f")[e.data.id])return fe(this,sr,"f")[e.data.id];throw new Error("No snapshot available")},R0=function(e,n){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const a of s.delta.content)if(a.index in n.content){let i=n.content[a.index];n.content[a.index]=fe(this,Lt,"m",P0).call(this,a,i)}else n.content[a.index]=a,r.push(a);return[n,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},P0=function(e,n){return Un.accumulateDelta(n,e)},x0=function(e){switch(on(this,Iu,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":on(this,fs,e.data,"f"),fe(this,cn,"f")&&(this._emit("toolCallDone",fe(this,cn,"f")),on(this,cn,void 0,"f"));break}};class Xf extends Ge{create(e,n,r){return this._client.post(`/threads/${e}/messages`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,n,r){return this._client.get(`/threads/${e}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,n,r,s){return this._client.post(`/threads/${e}/messages/${n}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,n={},r){return an(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/messages`,Qf,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,n,r){return this._client.delete(`/threads/${e}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class Qf extends Zn{}Xf.MessagesPage=Qf;class em extends Ge{retrieve(e,n,r,s={},a){return an(s)?this.retrieve(e,n,r,{},s):this._client.get(`/threads/${e}/runs/${n}/steps/${r}`,{query:s,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,n,r={},s){return an(r)?this.list(e,n,{},r):this._client.getAPIList(`/threads/${e}/runs/${n}/steps`,tm,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class tm extends Zn{}em.RunStepsPage=tm;class To extends Ge{constructor(){super(...arguments),this.steps=new em(this._client)}create(e,n,r){const{include:s,...a}=n;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:a,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:n.stream??!1})}retrieve(e,n,r){return this._client.get(`/threads/${e}/runs/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,n,r,s){return this._client.post(`/threads/${e}/runs/${n}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,n={},r){return an(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/runs`,nm,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,n,r){return this._client.post(`/threads/${e}/runs/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,n,r){const s=await this.create(e,n,r);return await this.poll(e,s.id,r)}createAndStream(e,n,r){return Un.createAssistantStream(e,this._client.beta.threads.runs,n,r)}async poll(e,n,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,n,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=i.headers.get("openai-poll-after-ms");if(u){const c=parseInt(u);isNaN(c)||(o=c)}}await yo(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,n,r){return Un.createAssistantStream(e,this._client.beta.threads.runs,n,r)}submitToolOutputs(e,n,r,s){return this._client.post(`/threads/${e}/runs/${n}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,n,r,s){const a=await this.submitToolOutputs(e,n,r,s);return await this.poll(e,a.id,s)}submitToolOutputsStream(e,n,r,s){return Un.createToolAssistantStream(e,n,this._client.beta.threads.runs,r,s)}}class nm extends Zn{}To.RunsPage=nm;To.Steps=em;To.RunStepsPage=tm;class Ia extends Ge{constructor(){super(...arguments),this.runs=new To(this._client),this.messages=new Xf(this._client)}create(e={},n){return an(e)?this.create({},e):this._client.post("/threads",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,r){return this._client.post(`/threads/${e}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,n){return this._client.delete(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}createAndRun(e,n){return this._client.post("/threads/runs",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:e.stream??!1})}async createAndRunPoll(e,n){const r=await this.createAndRun(e,n);return await this.runs.poll(r.thread_id,r.id,n)}createAndRunStream(e,n){return Un.createThreadAssistantStream(e,this._client.beta.threads,n)}}Ia.Runs=To;Ia.RunsPage=nm;Ia.Messages=Xf;Ia.MessagesPage=Qf;const W6=async t=>{const e=await Promise.allSettled(t),n=e.filter(s=>s.status==="rejected");if(n.length){for(const s of n)console.error(s.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};let rm=class extends Ge{create(e,n,r){return this._client.post(`/vector_stores/${e}/files`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,n,r){return this._client.get(`/vector_stores/${e}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,n={},r){return an(n)?this.list(e,{},n):this._client.getAPIList(`/vector_stores/${e}/files`,ul,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,n,r){return this._client.delete(`/vector_stores/${e}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,n,r){const s=await this.create(e,n,r);return await this.poll(e,s.id,r)}async poll(e,n,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const a=await this.retrieve(e,n,{...r,headers:s}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=a.response.headers.get("openai-poll-after-ms");if(u){const c=parseInt(u);isNaN(c)||(o=c)}}await yo(o);break;case"failed":case"completed":return i}}}async upload(e,n,r){const s=await this._client.files.create({file:n,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,n,r){const s=await this.upload(e,n,r);return await this.poll(e,s.id,r)}};class ul extends Zn{}rm.VectorStoreFilesPage=ul;class UE extends Ge{create(e,n,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,n,r){return this._client.get(`/vector_stores/${e}/file_batches/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,n,r){return this._client.post(`/vector_stores/${e}/file_batches/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,n,r){const s=await this.create(e,n);return await this.poll(e,s.id,r)}listFiles(e,n,r={},s){return an(r)?this.listFiles(e,n,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${n}/files`,ul,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,n,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,n,{...r,headers:s}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=i.headers.get("openai-poll-after-ms");if(u){const c=parseInt(u);isNaN(c)||(o=c)}}await yo(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:n,fileIds:r=[]},s){if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(s==null?void 0:s.maxConcurrency)??5,i=Math.min(a,n.length),o=this._client,u=n.values(),c=[...r];async function l(m){for(let p of m){const h=await o.files.create({file:p,purpose:"assistants"},s);c.push(h.id)}}const d=Array(i).fill(u).map(l);return await W6(d),await this.createAndPoll(e,{file_ids:c})}}class Na extends Ge{constructor(){super(...arguments),this.files=new rm(this._client),this.fileBatches=new UE(this._client)}create(e,n){return this._client.post("/vector_stores",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,r){return this._client.post(`/vector_stores/${e}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},n){return an(e)?this.list({},e):this._client.getAPIList("/vector_stores",sm,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class sm extends Zn{}Na.VectorStoresPage=sm;Na.Files=rm;Na.VectorStoreFilesPage=ul;Na.FileBatches=UE;class es extends Ge{constructor(){super(...arguments),this.realtime=new Jf(this._client),this.vectorStores=new Na(this._client),this.chat=new BE(this._client),this.assistants=new Kf(this._client),this.threads=new Ia(this._client)}}es.Realtime=Jf;es.VectorStores=Na;es.VectorStoresPage=sm;es.Assistants=Kf;es.AssistantsPage=Yf;es.Threads=Ia;class jE extends Ge{create(e,n){return this._client.post("/completions",{body:e,...n,stream:e.stream??!1})}}class HE extends Ge{create(e,n){return this._client.post("/embeddings",{body:e,...n})}}class am extends Ge{create(e,n){return this._client.post("/files",ga({body:e,...n}))}retrieve(e,n){return this._client.get(`/files/${e}`,n)}list(e={},n){return an(e)?this.list({},e):this._client.getAPIList("/files",im,{query:e,...n})}del(e,n){return this._client.delete(`/files/${e}`,n)}content(e,n){return this._client.get(`/files/${e}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}retrieveContent(e,n){return this._client.get(`/files/${e}/content`,n)}async waitForProcessing(e,{pollInterval:n=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await yo(n),i=await this.retrieve(e),Date.now()-a>r)throw new al({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return i}}class im extends Zn{}am.FileObjectsPage=im;class om extends Ge{list(e,n={},r){return an(n)?this.list(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,um,{query:n,...r})}}class um extends Zn{}om.FineTuningJobCheckpointsPage=um;class Ra extends Ge{constructor(){super(...arguments),this.checkpoints=new om(this._client)}create(e,n){return this._client.post("/fine_tuning/jobs",{body:e,...n})}retrieve(e,n){return this._client.get(`/fine_tuning/jobs/${e}`,n)}list(e={},n){return an(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",cm,{query:e,...n})}cancel(e,n){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,n)}listEvents(e,n={},r){return an(n)?this.listEvents(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,lm,{query:n,...r})}}class cm extends Zn{}class lm extends Zn{}Ra.FineTuningJobsPage=cm;Ra.FineTuningJobEventsPage=lm;Ra.Checkpoints=om;Ra.FineTuningJobCheckpointsPage=um;class So extends Ge{constructor(){super(...arguments),this.jobs=new Ra(this._client)}}So.Jobs=Ra;So.FineTuningJobsPage=cm;So.FineTuningJobEventsPage=lm;class $E extends Ge{createVariation(e,n){return this._client.post("/images/variations",ga({body:e,...n}))}edit(e,n){return this._client.post("/images/edits",ga({body:e,...n}))}generate(e,n){return this._client.post("/images/generations",{body:e,...n})}}class dm extends Ge{retrieve(e,n){return this._client.get(`/models/${e}`,n)}list(e){return this._client.getAPIList("/models",hm,e)}del(e,n){return this._client.delete(`/models/${e}`,n)}}class hm extends P6{}dm.ModelsPage=hm;class qE extends Ge{create(e,n){return this._client.post("/moderations",{body:e,...n})}}class VE extends Ge{create(e,n,r){return this._client.post(`/uploads/${e}/parts`,ga({body:n,...r}))}}class fm extends Ge{constructor(){super(...arguments),this.parts=new VE(this._client)}create(e,n){return this._client.post("/uploads",{body:e,...n})}cancel(e,n){return this._client.post(`/uploads/${e}/cancel`,n)}complete(e,n,r){return this._client.post(`/uploads/${e}/complete`,{body:n,...r})}}fm.Parts=VE;var zE;let je=class extends y6{constructor({baseURL:e=su("OPENAI_BASE_URL"),apiKey:n=su("OPENAI_API_KEY"),organization:r=su("OPENAI_ORG_ID")??null,project:s=su("OPENAI_PROJECT_ID")??null,...a}={}){if(n===void 0)throw new Fe("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:n,organization:r,project:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&N6())throw new Fe(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new jE(this),this.chat=new zf(this),this.embeddings=new HE(this),this.files=new am(this),this.images=new $E(this),this.audio=new Eo(this),this.moderations=new qE(this),this.models=new dm(this),this.fineTuning=new So(this),this.beta=new es(this),this.batches=new Wf(this),this.uploads=new fm(this),this._options=i,this.apiKey=n,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return n6(e,{arrayFormat:"brackets"})}};zE=je;je.OpenAI=zE;je.DEFAULT_TIMEOUT=6e5;je.OpenAIError=Fe;je.APIError=Dt;je.APIConnectionError=sl;je.APIConnectionTimeoutError=al;je.APIUserAbortError=On;je.NotFoundError=Y1;je.ConflictError=Z1;je.RateLimitError=X1;je.BadRequestError=W1;je.AuthenticationError=G1;je.InternalServerError=Q1;je.PermissionDeniedError=K1;je.UnprocessableEntityError=J1;je.toFile=aE;je.fileFromPath=V1;je.Completions=jE;je.Chat=zf;je.Embeddings=HE;je.Files=am;je.FileObjectsPage=im;je.Images=$E;je.Audio=Eo;je.Moderations=qE;je.Models=dm;je.ModelsPage=hm;je.FineTuning=So;je.Beta=es;je.Batches=Wf;je.BatchesPage=Gf;je.Uploads=fm;function WE(t,e){if(t.function===void 0)return;let n;if(e!=null&&e.partial)try{n=Of(t.function.arguments??"{}")}catch{return}else try{n=JSON.parse(t.function.arguments)}catch(s){throw new Gi([`Function "${t.function.name}" arguments:`,"",t.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const r={name:t.function.name,args:n,type:"tool_call"};return e!=null&&e.returnId&&(r.id=t.id),r}function G6(t){if(t.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:t.id,type:"function",function:{name:t.name,arguments:JSON.stringify(t.args)}}}function K6(t,e){var n,r;return{name:(n=t.function)==null?void 0:n.name,args:(r=t.function)==null?void 0:r.arguments,id:t.id,error:e,type:"invalid_tool_call"}}class Y6 extends L1{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,n=!0){var i;const r=e[0].message;let s;if(ho(r)&&((i=r.tool_calls)!=null&&i.length)?s=r.tool_calls.map(o=>{const{id:u,...c}=o;return this.returnId?{id:u,...c}:c}):r.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(r.additional_kwargs.tool_calls)).map(u=>WE(u,{returnId:this.returnId,partial:n}))),!s)return[];const a=[];for(const o of s)if(o!==void 0){const u={type:o.name,args:o.args,id:o.id};a.push(u)}return a}}class L0 extends Y6{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const n=await this.zodSchema.safeParseAsync(e);if(n.success)return n.data;throw new Gi(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(n.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const r=(await super.parsePartialResult(e)).filter(a=>a.type===this.keyName);let s=r;if(r.length)return this.returnId||(s=r.map(a=>a.args)),this.returnSingle?s[0]:s}async parseResult(e){const r=(await super.parsePartialResult(e,!1)).filter(i=>i.type===this.keyName);let s=r;return r.length?(this.returnId||(s=r.map(i=>i.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(i=>this._validateResult(i)))):void 0}}const Z6=Symbol("Let zodToJsonSchema decide on which parser to use"),D0={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},J6=t=>typeof t=="string"?{...D0,basePath:["#"],definitions:{},name:t}:{...D0,basePath:["#"],definitions:{},...t},Uh=t=>"_def"in t?t._def:t;function X6(t){if(!t)return!0;for(const e in t)return!1;return!0}const Q6=t=>{const e=J6(t),n=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:n,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[Uh(s),{def:Uh(s),path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function GE(t,e,n,r){r!=null&&r.errorMessages&&n&&(t.errorMessage={...t.errorMessage,[e]:n})}function Xe(t,e,n,r,s){t[e]=n,GE(t,e,r,s)}function e4(){return{}}function t4(t,e){var r,s;const n={type:"array"};return((s=(r=t.type)==null?void 0:r._def)==null?void 0:s.typeName)!==z.ZodAny&&(n.items=Ve(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&Xe(n,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&Xe(n,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(Xe(n,"minItems",t.exactLength.value,t.exactLength.message,e),Xe(n,"maxItems",t.exactLength.value,t.exactLength.message,e)),n}function n4(t,e){const n={type:"integer",format:"int64"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Xe(n,"minimum",r.value,r.message,e):Xe(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),Xe(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Xe(n,"maximum",r.value,r.message,e):Xe(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),Xe(n,"maximum",r.value,r.message,e));break;case"multipleOf":Xe(n,"multipleOf",r.value,r.message,e);break}return n}function r4(){return{type:"boolean"}}function s4(t,e){return Ve(t.type._def,e)}const a4=(t,e)=>Ve(t.innerType._def,e);function KE(t,e,n){const r=n??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,a)=>KE(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return i4(t,e)}}const i4=(t,e)=>{const n={type:"integer",format:"unix-time"};if(e.target==="openApi3")return n;for(const r of t.checks)switch(r.kind){case"min":Xe(n,"minimum",r.value,r.message,e);break;case"max":Xe(n,"maximum",r.value,r.message,e);break}return n};function o4(t,e){return{...Ve(t.innerType._def,e),default:t.defaultValue()}}function u4(t,e,n){return e.effectStrategy==="input"?Ve(t.schema._def,e,n):{}}function c4(t){return{type:"string",enum:[...t.values]}}const l4=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function d4(t,e){const n=[Ve(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Ve(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return n.forEach(a=>{if(l4(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...u}=a;i=u}else r=void 0;s.push(i)}}),s.length?{allOf:s,...r}:void 0}function h4(t,e){const n=typeof t.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[t.value]}:{type:n==="bigint"?"integer":n,const:t.value}}let Ad;const rs={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Ad===void 0&&(Ad=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ad),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function YE(t,e){const n={type:"string"};function r(s){return e.patternStrategy==="escape"?f4(s):s}if(t.checks)for(const s of t.checks)switch(s.kind){case"min":Xe(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,s.value):s.value,s.message,e);break;case"max":Xe(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":xn(n,"email",s.message,e);break;case"format:idn-email":xn(n,"idn-email",s.message,e);break;case"pattern:zod":Ln(n,rs.email,s.message,e);break}break;case"url":xn(n,"uri",s.message,e);break;case"uuid":xn(n,"uuid",s.message,e);break;case"regex":Ln(n,s.regex,s.message,e);break;case"cuid":Ln(n,rs.cuid,s.message,e);break;case"cuid2":Ln(n,rs.cuid2,s.message,e);break;case"startsWith":Ln(n,RegExp(`^${r(s.value)}`),s.message,e);break;case"endsWith":Ln(n,RegExp(`${r(s.value)}$`),s.message,e);break;case"datetime":xn(n,"date-time",s.message,e);break;case"date":xn(n,"date",s.message,e);break;case"time":xn(n,"time",s.message,e);break;case"duration":xn(n,"duration",s.message,e);break;case"length":Xe(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,s.value):s.value,s.message,e),Xe(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,s.value):s.value,s.message,e);break;case"includes":{Ln(n,RegExp(r(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&xn(n,"ipv4",s.message,e),s.version!=="v4"&&xn(n,"ipv6",s.message,e);break}case"emoji":Ln(n,rs.emoji,s.message,e);break;case"ulid":{Ln(n,rs.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{xn(n,"binary",s.message,e);break}case"contentEncoding:base64":{Xe(n,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{Ln(n,rs.base64,s.message,e);break}}break}case"nanoid":Ln(n,rs.nanoid,s.message,e)}return n}const f4=t=>Array.from(t).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),xn=(t,e,n,r)=>{var s;t.format||(s=t.anyOf)!=null&&s.some(a=>a.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&r.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Xe(t,"format",e,n,r)},Ln=(t,e,n,r)=>{var s;t.pattern||(s=t.allOf)!=null&&s.some(a=>a.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&r.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:M0(e,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Xe(t,"pattern",M0(e,r),n,r)},M0=(t,e)=>{var c;const n=typeof t=="function"?t():t;if(!e.applyRegexFlags||!n.flags)return n.source;const r={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},s=r.i?n.source.toLowerCase():n.source;let a="",i=!1,o=!1,u=!1;for(let l=0;l<s.length;l++){if(i){a+=s[l],i=!1;continue}if(r.i){if(o){if(s[l].match(/[a-z]/)){u?(a+=s[l],a+=`${s[l-2]}-${s[l]}`.toUpperCase(),u=!1):s[l+1]==="-"&&((c=s[l+2])!=null&&c.match(/[a-z]/))?(a+=s[l],u=!0):a+=`${s[l]}${s[l].toUpperCase()}`;continue}}else if(s[l].match(/[a-z]/)){a+=`[${s[l]}${s[l].toUpperCase()}]`;continue}}if(r.m){if(s[l]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(s[l]==="$"){a+=`($|(?=[\r
]))`;continue}}if(r.s&&s[l]==="."){a+=o?`${s[l]}\r
`:`[${s[l]}\r
]`;continue}a+=s[l],s[l]==="\\"?i=!0:o&&s[l]==="]"?o=!1:!o&&s[l]==="["&&(o=!0)}try{const l=new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return a};function ZE(t,e){var r,s,a,i;if(e.target==="openApi3"&&((r=t.keyType)==null?void 0:r._def.typeName)===z.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((o,u)=>({...o,[u]:Ve(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",u]})??{}}),{}),additionalProperties:!1};const n={type:"object",additionalProperties:Ve(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return n;if(((s=t.keyType)==null?void 0:s._def.typeName)===z.ZodString&&((a=t.keyType._def.checks)!=null&&a.length)){const o=Object.entries(YE(t.keyType._def,e)).reduce((u,[c,l])=>c==="type"?u:{...u,[c]:l},{});return{...n,propertyNames:o}}else if(((i=t.keyType)==null?void 0:i._def.typeName)===z.ZodEnum)return{...n,propertyNames:{enum:t.keyType._def.values}};return n}function m4(t,e){if(e.mapStrategy==="record")return ZE(t,e);const n=Ve(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=Ve(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function p4(t){const e=t.values,r=Object.keys(t.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(r.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function g4(){return{not:{}}}function b4(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const hc={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function _4(t,e){if(e.target==="openApi3")return B0(t,e);const n=t.options instanceof Map?Array.from(t.options.values()):t.options;if(n.every(r=>r._def.typeName in hc&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((s,a)=>{const i=hc[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===n.length){const s=r.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:n.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,s)=>[...r,...s._def.values.filter(a=>!r.includes(a))],[])};return B0(t,e)}const B0=(t,e)=>{const n=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>Ve(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function y4(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:hc[t.innerType._def.typeName],nullable:!0}:{type:[hc[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=Ve(t.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=Ve(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function E4(t,e){const n={type:"number"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"int":n.type="integer",GE(n,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Xe(n,"minimum",r.value,r.message,e):Xe(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),Xe(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Xe(n,"maximum",r.value,r.message,e):Xe(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),Xe(n,"maximum",r.value,r.message,e));break;case"multipleOf":Xe(n,"multipleOf",r.value,r.message,e);break}return n}function w4(t,e){return e.removeAdditionalStrategy==="strict"?t.catchall._def.typeName==="ZodNever"?t.unknownKeys!=="strict":Ve(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:t.catchall._def.typeName==="ZodNever"?t.unknownKeys==="passthrough":Ve(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function T4(t,e){const n={type:"object",...Object.entries(t.shape()).reduce((r,[s,a])=>{if(a===void 0||a._def===void 0)return r;const i=Ve(a._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return i===void 0?r:{properties:{...r.properties,[s]:i},required:a.isOptional()&&!e.openaiStrictMode?r.required:[...r.required,s]}},{properties:{},required:[]}),additionalProperties:w4(t,e)};return n.required.length||delete n.required,n}const S4=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return Ve(t.innerType._def,e);const n=Ve(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}},A4=(t,e)=>{if(e.pipeStrategy==="input")return Ve(t.in._def,e);if(e.pipeStrategy==="output")return Ve(t.out._def,e);const n=Ve(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=Ve(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(s=>s!==void 0)}};function C4(t,e){return Ve(t.type._def,e)}function v4(t,e){const r={type:"array",uniqueItems:!0,items:Ve(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&Xe(r,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&Xe(r,"maxItems",t.maxSize.value,t.maxSize.message,e),r}function O4(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((n,r)=>Ve(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:Ve(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((n,r)=>Ve(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function k4(){return{not:{}}}function I4(){return{}}const N4=(t,e)=>Ve(t.innerType._def,e);function Ve(t,e,n=!1){var i;const r=e.seen.get(t);if(e.override){const o=(i=e.override)==null?void 0:i.call(e,t,e,r,n);if(o!==Z6)return o}if(r&&!n){const o=R4(r,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);const a=x4(t,t.typeName,e,n);return a&&L4(t,e,a),s.jsonSchema=a,a}const R4=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"extract-to-root":const n=t.path.slice(e.basePath.length+1).join("_");return n!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[n]=t.def),{$ref:[...e.basePath,e.definitionPath,n].join("/")};case"relative":return{$ref:P4(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,s)=>e.currentPath[s]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},P4=(t,e)=>{let n=0;for(;n<t.length&&n<e.length&&t[n]===e[n];n++);return[(t.length-n).toString(),...e.slice(n)].join("/")},x4=(t,e,n,r)=>{switch(e){case z.ZodString:return YE(t,n);case z.ZodNumber:return E4(t,n);case z.ZodObject:return T4(t,n);case z.ZodBigInt:return n4(t,n);case z.ZodBoolean:return r4();case z.ZodDate:return KE(t,n);case z.ZodUndefined:return k4();case z.ZodNull:return b4(n);case z.ZodArray:return t4(t,n);case z.ZodUnion:case z.ZodDiscriminatedUnion:return _4(t,n);case z.ZodIntersection:return d4(t,n);case z.ZodTuple:return O4(t,n);case z.ZodRecord:return ZE(t,n);case z.ZodLiteral:return h4(t,n);case z.ZodEnum:return c4(t);case z.ZodNativeEnum:return p4(t);case z.ZodNullable:return y4(t,n);case z.ZodOptional:return S4(t,n);case z.ZodMap:return m4(t,n);case z.ZodSet:return v4(t,n);case z.ZodLazy:return Ve(t.getter()._def,n);case z.ZodPromise:return C4(t,n);case z.ZodNaN:case z.ZodNever:return g4();case z.ZodEffects:return u4(t,n,r);case z.ZodAny:return e4();case z.ZodUnknown:return I4();case z.ZodDefault:return o4(t,n);case z.ZodBranded:return s4(t,n);case z.ZodReadonly:return N4(t,n);case z.ZodCatch:return a4(t,n);case z.ZodPipeline:return A4(t,n);case z.ZodFunction:case z.ZodVoid:case z.ZodSymbol:return;default:return(s=>{})()}},L4=(t,e,n)=>(t.description&&(n.description=t.description,e.markdownDescription&&(n.markdownDescription=t.description)),n),D4=(t,e)=>{const n=Q6(e),r=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=Ve(t._def,r===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,r]},!1)??{},a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(s.title=a);const i=(()=>{if(X6(n.definitions))return;const u={},c=new Set;for(let l=0;l<500;l++){const d=Object.entries(n.definitions).filter(([m])=>!c.has(m));if(d.length===0)break;for(const[m,p]of d)u[m]=Ve(Uh(p),{...n,currentPath:[...n.basePath,n.definitionPath,m]},!0)??{},c.add(m)}return u})(),o=r===void 0?i?{...s,[n.definitionPath]:i}:s:n.nameStrategy==="duplicate-ref"?{...s,...i||n.seenRefs.size?{[n.definitionPath]:{...i,...n.seenRefs.size?{[r]:s}:void 0}}:void 0}:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,r].join("/"),[n.definitionPath]:{...i,[r]:s}};return n.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":n.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function JE(t,e){return D4(t,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function M4(t,e,n){return x6({type:"json_schema",json_schema:{...n,name:e,strict:!0,schema:JE(t,{name:e})}},r=>t.parse(JSON.parse(r)))}function B4(t){return L6({type:"function",function:{name:t.name,parameters:JE(t.parameters,{name:t.name}),strict:!0,...t.description?{description:t.description}:void 0}},{callback:t.function,parser:e=>t.parameters.parse(JSON.parse(e))})}function F4(t){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:n,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:a,azureADTokenProvider:i,azureOpenAIEndpoint:o}=t;if((r||i)&&s&&e)return`${s}/${e}`;if((r||i)&&o&&e)return`${o}/openai/deployments/${e}`;if(r||i){if(!n)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${n}.openai.azure.com/openai/deployments/${e}`}return a}function cu(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,t}function F0(t){let e;return t.constructor.name===al.name?(e=new Error(t.message),e.name="TimeoutError"):t.constructor.name===On.name?(e=new Error(t.message),e.name="AbortError"):t.status===400&&t.message.includes("tool_calls")?e=cu(t,"INVALID_TOOL_RESULTS"):t.status===401?e=cu(t,"MODEL_AUTHENTICATION"):t.status===429?e=cu(t,"MODEL_RATE_LIMIT"):t.status===404?e=cu(t,"MODEL_NOT_FOUND"):e=t,e}function U4(t){if(t)return t==="any"||t==="required"?"required":t==="auto"?"auto":t==="none"?"none":typeof t=="string"?{type:"function",function:{name:t}}:t}function j4(t){return t.anyOf!==void 0&&Array.isArray(t.anyOf)}function H4(t){const e=["namespace functions {",""];for(const n of t)n.description&&e.push(`// ${n.description}`),Object.keys(n.parameters.properties??{}).length>0?(e.push(`type ${n.name} = (_: {`),e.push(XE(n.parameters,0)),e.push("}) => any;")):e.push(`type ${n.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function XE(t,e){var r;const n=[];for(const[s,a]of Object.entries(t.properties??{}))a.description&&e<2&&n.push(`// ${a.description}`),(r=t.required)!=null&&r.includes(s)?n.push(`${s}: ${fc(a,e)},`):n.push(`${s}?: ${fc(a,e)},`);return n.map(s=>" ".repeat(e)+s).join(`
`)}function fc(t,e){if(j4(t))return t.anyOf.map(n=>fc(n,e)).join(" | ");switch(t.type){case"string":return t.enum?t.enum.map(n=>`"${n}"`).join(" | "):"string";case"number":return t.enum?t.enum.map(n=>`${n}`).join(" | "):"number";case"integer":return t.enum?t.enum.map(n=>`${n}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",XE(t,e+2),"}"].join(`
`);case"array":return t.items?`${fc(t.items,e)}[]`:"any[]";default:return""}}function $4(t,e){let n;if(R1(t)){const r=B4({name:t.name,parameters:t.schema,description:t.description});r.function.parameters?n={type:r.type,function:{name:r.function.name,description:r.function.description,parameters:r.function.parameters,...(e==null?void 0:e.strict)!==void 0?{strict:e.strict}:{}}}:n={type:"function",function:PL(t,e)}}else n=t;return(e==null?void 0:e.strict)!==void 0&&(n.function.strict=e.strict),n}function q4(t){return t.role!=="system"&&t.role!=="developer"&&t.role!=="assistant"&&t.role!=="user"&&t.role!=="function"&&t.role!=="tool"&&console.warn(`Unknown message role: ${t.role}`),t.role}function QE(t){const e=t._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!fo.isInstance(t))throw new Error("Invalid generic chat message");return q4(t)}default:throw new Error(`Unknown message type: ${e}`)}}function U0(t,e){return t.flatMap(n=>{var a;let r=QE(n);r==="system"&&(e!=null&&e.startsWith("o1"))&&(r="developer");const s={role:r,content:n.content};if(n.name!=null&&(s.name=n.name),n.additional_kwargs.function_call!=null&&(s.function_call=n.additional_kwargs.function_call,s.content=null),ho(n)&&((a=n.tool_calls)!=null&&a.length)?(s.tool_calls=n.tool_calls.map(G6),s.content=null):(n.additional_kwargs.tool_calls!=null&&(s.tool_calls=n.additional_kwargs.tool_calls),n.tool_call_id!=null&&(s.tool_call_id=n.tool_call_id)),n.additional_kwargs.audio&&typeof n.additional_kwargs.audio=="object"&&"id"in n.additional_kwargs.audio){const i={role:"assistant",audio:{id:n.additional_kwargs.audio.id}};return[s,i]}return s})}function j0(t,e){return I1(t)?(e==null?void 0:e.strict)!==void 0?{...t,function:{...t.function,strict:e.strict}}:t:$4(t,e)}class jh extends vr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}constructor(e){var n,r;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((n=e==null?void 0:e.configuration)==null?void 0:n.apiKey)??gn("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??gn("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this==null?void 0:this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const n=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:n.temperature??void 0,ls_max_tokens:n.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,n){let r;return(n==null?void 0:n.strict)!==void 0?r=n.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>j0(s,{strict:r})),...n})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&lu(e.json_schema.schema)?M4(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,n){var o;let r;(e==null?void 0:e.strict)!==void 0?r=e.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling);let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||n!=null&&n.streaming)&&(s={stream_options:{include_usage:!0}});const a={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(u=>j0(u,{strict:r})):void 0,tool_choice:U4(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(a.prediction=e.prediction);const i=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return i!==void 0&&(a.reasoning_effort=i),a}_convertOpenAIChatCompletionMessageToBaseMessage(e,n){const r=e.tool_calls;switch(e.role){case"assistant":{const s=[],a=[];for(const u of r??[])try{s.push(WE(u,{returnId:!0}))}catch(c){a.push(K6(u,c.message))}const i={function_call:e.function_call,tool_calls:r};this.__includeRawResponse!==void 0&&(i.__raw_response=n);const o={model_name:n.model,...n.system_fingerprint?{usage:{...n.usage},system_fingerprint:n.system_fingerprint}:{}};return e.audio&&(i.audio=e.audio),new As({content:e.content||"",tool_calls:s,invalid_tool_calls:a,additional_kwargs:i,response_metadata:o,id:n.id})}default:return new fo(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,n,r){var u,c;const s=e.role??r,a=e.content??"";let i;e.function_call?i={function_call:e.function_call}:e.tool_calls?i={tool_calls:e.tool_calls}:i={},this.__includeRawResponse&&(i.__raw_response=n),e.audio&&(i.audio={...e.audio,index:n.choices[0].index});const o={usage:{...n.usage}};if(s==="user")return new qc({content:a,response_metadata:o});if(s==="assistant"){const l=[];if(Array.isArray(e.tool_calls))for(const d of e.tool_calls)l.push({name:(u=d.function)==null?void 0:u.name,args:(c=d.function)==null?void 0:c.arguments,id:d.id,index:d.index,type:"tool_call_chunk"});return new en({content:a,tool_call_chunks:l,additional_kwargs:i,id:n.id,response_metadata:o})}else return s==="system"?new Hi({content:a,response_metadata:o}):s==="developer"?new Hi({content:a,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new $c({content:a,additional_kwargs:i,name:e.name,response_metadata:o}):s==="tool"?new kf({content:a,additional_kwargs:i,tool_call_id:e.tool_call_id,response_metadata:o}):new Hc({content:a,role:s,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,n,r){var c,l,d,m,p,h,g,b,_,y;const s=U0(e,this.model),a={...this.invocationParams(n,{streaming:!0}),messages:s,stream:!0};let i;const o=await this.completionWithRetry(a,n);let u;for await(const E of o){const I=(c=E==null?void 0:E.choices)==null?void 0:c[0];if(E.usage&&(u=E.usage),!I)continue;const{delta:w}=I;if(!w)continue;const R=this._convertOpenAIDeltaToBaseMessageChunk(w,E,i);i=w.role??i;const v={prompt:n.promptIndex??0,completion:I.index??0};if(typeof R.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const j={...v};I.finish_reason!=null&&(j.finish_reason=I.finish_reason,j.system_fingerprint=E.system_fingerprint,j.model_name=E.model),this.logprobs&&(j.logprobs=I.logprobs);const F=new Cs({message:R,text:R.content,generationInfo:j});yield F,await(r==null?void 0:r.handleLLMNewToken(F.text??"",v,void 0,void 0,void 0,{chunk:F}))}if(u){const E={...((l=u.prompt_tokens_details)==null?void 0:l.audio_tokens)!==null&&{audio:(d=u.prompt_tokens_details)==null?void 0:d.audio_tokens},...((m=u.prompt_tokens_details)==null?void 0:m.cached_tokens)!==null&&{cache_read:(p=u.prompt_tokens_details)==null?void 0:p.cached_tokens}},I={...((h=u.completion_tokens_details)==null?void 0:h.audio_tokens)!==null&&{audio:(g=u.completion_tokens_details)==null?void 0:g.audio_tokens},...((b=u.completion_tokens_details)==null?void 0:b.reasoning_tokens)!==null&&{reasoning:(_=u.completion_tokens_details)==null?void 0:_.reasoning_tokens}};yield new Cs({message:new en({content:"",response_metadata:{usage:{...u}},usage_metadata:{input_tokens:u.prompt_tokens,output_tokens:u.completion_tokens,total_tokens:u.total_tokens,...Object.keys(E).length>0&&{input_token_details:E},...Object.keys(I).length>0&&{output_token_details:I}}}),text:""})}if((y=n.signal)!=null&&y.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,n,r){var o,u;const s={},a=this.invocationParams(n),i=U0(e,this.model);if(a.stream){const c=this._streamResponseChunks(e,n,r),l={};for await(const b of c){b.message.response_metadata={...b.generationInfo,...b.message.response_metadata};const _=((o=b.generationInfo)==null?void 0:o.completion)??0;l[_]===void 0?l[_]=b:l[_]=l[_].concat(b)}const d=Object.entries(l).sort(([b],[_])=>parseInt(b,10)-parseInt(_,10)).map(([b,_])=>_),{functions:m,function_call:p}=this.invocationParams(n),h=await this.getEstimatedTokenCountFromPrompt(e,m,p),g=await this.getNumTokensFromGenerations(d);return s.input_tokens=h,s.output_tokens=g,s.total_tokens=h+g,{generations:d,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let c;n.response_format&&n.response_format.type==="json_schema"?c=await this.betaParsedCompletionWithRetry({...a,stream:!1,messages:i},{signal:n==null?void 0:n.signal,...n==null?void 0:n.options}):c=await this.completionWithRetry({...a,stream:!1,messages:i},{signal:n==null?void 0:n.signal,...n==null?void 0:n.options});const{completion_tokens:l,prompt_tokens:d,total_tokens:m,prompt_tokens_details:p,completion_tokens_details:h}=(c==null?void 0:c.usage)??{};l&&(s.output_tokens=(s.output_tokens??0)+l),d&&(s.input_tokens=(s.input_tokens??0)+d),m&&(s.total_tokens=(s.total_tokens??0)+m),((p==null?void 0:p.audio_tokens)!==null||(p==null?void 0:p.cached_tokens)!==null)&&(s.input_token_details={...(p==null?void 0:p.audio_tokens)!==null&&{audio:p==null?void 0:p.audio_tokens},...(p==null?void 0:p.cached_tokens)!==null&&{cache_read:p==null?void 0:p.cached_tokens}}),((h==null?void 0:h.audio_tokens)!==null||(h==null?void 0:h.reasoning_tokens)!==null)&&(s.output_token_details={...(h==null?void 0:h.audio_tokens)!==null&&{audio:h==null?void 0:h.audio_tokens},...(h==null?void 0:h.reasoning_tokens)!==null&&{reasoning:h==null?void 0:h.reasoning_tokens}});const g=[];for(const b of(c==null?void 0:c.choices)??[]){const y={text:((u=b.message)==null?void 0:u.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(b.message??{role:"assistant"},c)};y.generationInfo={...b.finish_reason?{finish_reason:b.finish_reason}:{},...b.logprobs?{logprobs:b.logprobs}:{}},ho(y.message)&&(y.message.usage_metadata=s),y.message=new As(Object.fromEntries(Object.entries(y.message).filter(([E])=>!E.startsWith("lc_")))),g.push(y)}return{generations:g,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,n,r){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(n&&r!=="auto"){const a=H4(n);s+=await this.getNumTokens(a),s+=9}return n&&e.find(a=>a._getType()==="system")&&(s-=4),r==="none"?s+=1:typeof r=="object"&&(s+=await this.getNumTokens(r.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>{var s;return(s=r.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)}))).reduce((r,s)=>r+s,0)}async getNumTokensFromMessages(e){let n=0,r=0,s=0;this.model==="gpt-3.5-turbo-0301"?(r=4,s=-1):(r=3,s=1);const a=await Promise.all(e.map(async i=>{var m,p,h,g,b,_;const o=await this.getNumTokens(i.content),u=await this.getNumTokens(QE(i)),c=i.name!==void 0?s+await this.getNumTokens(i.name):0;let l=o+r+u+c;const d=i;if(d._getType()==="function"&&(l-=2),(m=d.additional_kwargs)!=null&&m.function_call&&(l+=3),(p=d==null?void 0:d.additional_kwargs.function_call)!=null&&p.name&&(l+=await this.getNumTokens((h=d.additional_kwargs.function_call)==null?void 0:h.name)),(g=d.additional_kwargs.function_call)!=null&&g.arguments)try{l+=await this.getNumTokens(JSON.stringify(JSON.parse((b=d.additional_kwargs.function_call)==null?void 0:b.arguments)))}catch(y){console.error("Error parsing function arguments",y,JSON.stringify(d.additional_kwargs.function_call)),l+=await this.getNumTokens((_=d.additional_kwargs.function_call)==null?void 0:_.arguments)}return n+=l,l}));return n+=3,{totalCount:n,countPerMessage:a}}async completionWithRetry(e,n){const r=this._getClientOptions(n);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(s){throw F0(s)}})}async betaParsedCompletionWithRetry(e,n){const r=this._getClientOptions(n);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,r)}catch(s){throw F0(s)}})}_getClientOptions(e){if(!this.client){const r={baseURL:this.clientConfig.baseURL},s=F4(r),a={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};a.baseURL||delete a.baseURL,this.client=new je(a)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((n,r)=>(r&&r.tokenUsage&&(n.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,n.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,n.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),n),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,n){let r,s,a,i;V4(e)?(r=e.schema,s=e.name,a=e.method,i=e.includeRaw):(r=e,s=n==null?void 0:n.name,a=n==null?void 0:n.method,i=n==null?void 0:n.includeRaw);let o,u;if((n==null?void 0:n.strict)!==void 0&&a==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?a===void 0&&(a="jsonSchema"):a==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),a==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),lu(r)?u=u0.fromZodSchema(r):u=new c0;else if(a==="jsonSchema")o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:r.description,schema:r,strict:n==null?void 0:n.strict}}}),lu(r)?u=u0.fromZodSchema(r):u=new c0;else{let m=s??"extract";if(lu(r)){const p=vs(r);o=this.bind({tools:[{type:"function",function:{name:m,description:p.description,parameters:p}}],tool_choice:{type:"function",function:{name:m}},...(n==null?void 0:n.strict)!==void 0?{strict:n.strict}:{}}),u=new L0({returnSingle:!0,keyName:m,zodSchema:r})}else{let p;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(p=r,m=r.name):(m=r.title??m,p={name:m,description:r.description??"",parameters:r}),o=this.bind({tools:[{type:"function",function:p}],tool_choice:{type:"function",function:{name:m}},...(n==null?void 0:n.strict)!==void 0?{strict:n.strict}:{}}),u=new L0({returnSingle:!0,keyName:m})}}if(!i)return o.pipe(u);const c=pa.assign({parsed:(m,p)=>u.invoke(m.raw,p)}),l=pa.assign({parsed:()=>null}),d=c.withFallbacks({fallbacks:[l]});return lr.from([{raw:o},d])}}function lu(t){return typeof(t==null?void 0:t.parse)=="function"}function V4(t){return t!==void 0&&typeof t.schema=="object"}class z4 extends N1{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=(e==null?void 0:e.verboseParsingErrors)??this.verboseParsingErrors,this.responseFormat=(e==null?void 0:e.responseFormat)??this.responseFormat}async invoke(e,n){let r,s,a=$e(n);return vf(e)?(r=e.id,s=e.args,a={...a,toolCall:e,configurable:{...a.configurable,tool_call_id:r}}):s=e,this.call(s,a)}async call(e,n,r){let s;try{s=await this.schema.parseAsync(e)}catch(p){let h="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(h=`${h}
Details: ${p.message}`),new my(h,JSON.stringify(e))}const a=_y(n),i=Ut.configure(a.callbacks,this.callbacks,a.tags||r,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),o=await(i==null?void 0:i.handleToolStart(this.toJSON(),typeof s=="string"?s:JSON.stringify(s),a.runId,void 0,void 0,void 0,a.runName));delete a.runId;let u;try{u=await this._call(s,o,a)}catch(p){throw await(o==null?void 0:o.handleToolError(p)),p}let c,l;if(this.responseFormat==="content_and_artifact")if(Array.isArray(u)&&u.length===2)[c,l]=u;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(u)}`);else c=u;let d;a&&"configurable"in a&&(d=a.configurable.tool_call_id);const m=G4({content:c,artifact:l,toolCallId:d,name:this.name});return await(o==null?void 0:o.handleToolEnd(m)),m}}class W4 extends z4{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:Or.object({input:Or.string().optional()}).transform(n=>n.input)})}call(e,n){return super.call(typeof e=="string"||!e?{input:e}:e,n)}}function G4(t){const{content:e,artifact:n,toolCallId:r}=t;return r&&!bN(e)?typeof e=="string"||Array.isArray(e)&&e.every(s=>typeof s=="object")?new ch({content:e,artifact:n,tool_call_id:r,name:t.name}):new ch({content:K4(e),artifact:n,tool_call_id:r,name:t.name}):e}function K4(t){try{return JSON.stringify(t,null,2)}catch{return`${t}`}}class Y4 extends W4{static lc_name(){return"SearxngSearch"}get lc_secrets(){return{apiBase:"SEARXNG_API_BASE"}}constructor({apiBase:e,params:n,headers:r}){if(super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"searxng-search"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A meta search engine. Useful for when you need to answer questions about current events. Input should be a search query. Output is a JSON array of the query results"}),Object.defineProperty(this,"apiBase",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:{numResults:10,pageNumber:1,format:"json",imageProxy:!0,safesearch:0}}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.apiBase=gn("SEARXNG_API_BASE")||e,this.headers={"content-type":"application/json",...r},!this.apiBase)throw new Error('SEARXNG_API_BASE not set. You can set it as "SEARXNG_API_BASE" in your environment variables.');n&&(this.params={...this.params,...n})}buildUrl(e,n,r){const s=Object.entries(n).filter(([i,o])=>o!==void 0).map(([i,o])=>[i,o.toString()]),a=new URLSearchParams(s);return`${r}/${e}?${a}`}async _call(e){var i,o;const n={q:e,...this.params},r=this.buildUrl("search",n,this.apiBase),s=await fetch(r,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(5*1e3)});if(!s.ok)throw new Error(s.statusText);const a=await s.json();if(!a.results.length&&!a.answers.length&&!a.infoboxes.length&&!a.suggestions.length)return"No good results found.";if(a.results.length){const u=[];return a.results.forEach(c=>{u.push(JSON.stringify({title:c.title||"",link:c.url||"",snippet:c.content||""}))}),u.slice(0,(i=this.params)==null?void 0:i.numResults).toString()}else{if(a.answers.length)return a.answers[0];if(a.infoboxes.length)return(o=a.infoboxes[0])==null?void 0:o.content.replaceAll(/<[^>]+>/gi,"");if(a.suggestions.length){let u="Suggestions: ";return a.suggestions.forEach(c=>{u+=`${c}, `}),u}else return"No good results found."}}}var We;(function(t){t.Root="root",t.Text="text",t.Directive="directive",t.Comment="comment",t.Script="script",t.Style="style",t.Tag="tag",t.CDATA="cdata",t.Doctype="doctype"})(We||(We={}));function Z4(t){return t.type===We.Tag||t.type===We.Script||t.type===We.Style}const J4=We.Root,X4=We.Text,Q4=We.Directive,eD=We.Comment,tD=We.Script,nD=We.Style,rD=We.Tag,sD=We.CDATA,aD=We.Doctype;class ew{constructor(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}get parentNode(){return this.parent}set parentNode(e){this.parent=e}get previousSibling(){return this.prev}set previousSibling(e){this.prev=e}get nextSibling(){return this.next}set nextSibling(e){this.next=e}cloneNode(e=!1){return Ji(this,e)}}class mm extends ew{constructor(e){super(),this.data=e}get nodeValue(){return this.data}set nodeValue(e){this.data=e}}class Zi extends mm{constructor(){super(...arguments),this.type=We.Text}get nodeType(){return 3}}class pm extends mm{constructor(){super(...arguments),this.type=We.Comment}get nodeType(){return 8}}class gm extends mm{constructor(e,n){super(n),this.name=e,this.type=We.Directive}get nodeType(){return 1}}class bm extends ew{constructor(e){super(),this.children=e}get firstChild(){var e;return(e=this.children[0])!==null&&e!==void 0?e:null}get lastChild(){return this.children.length>0?this.children[this.children.length-1]:null}get childNodes(){return this.children}set childNodes(e){this.children=e}}class tw extends bm{constructor(){super(...arguments),this.type=We.CDATA}get nodeType(){return 4}}class Is extends bm{constructor(){super(...arguments),this.type=We.Root}get nodeType(){return 9}}class _m extends bm{constructor(e,n,r=[],s=e==="script"?We.Script:e==="style"?We.Style:We.Tag){super(r),this.name=e,this.attribs=n,this.type=s}get nodeType(){return 1}get tagName(){return this.name}set tagName(e){this.name=e}get attributes(){return Object.keys(this.attribs).map(e=>{var n,r;return{name:e,value:this.attribs[e],namespace:(n=this["x-attribsNamespace"])===null||n===void 0?void 0:n[e],prefix:(r=this["x-attribsPrefix"])===null||r===void 0?void 0:r[e]}})}}function Ee(t){return Z4(t)}function cl(t){return t.type===We.CDATA}function mr(t){return t.type===We.Text}function ll(t){return t.type===We.Comment}function Hh(t){return t.type===We.Directive}function ts(t){return t.type===We.Root}function ft(t){return Object.prototype.hasOwnProperty.call(t,"children")}function Ji(t,e=!1){let n;if(mr(t))n=new Zi(t.data);else if(ll(t))n=new pm(t.data);else if(Ee(t)){const r=e?Cd(t.children):[],s=new _m(t.name,{...t.attribs},r);r.forEach(a=>a.parent=s),t.namespace!=null&&(s.namespace=t.namespace),t["x-attribsNamespace"]&&(s["x-attribsNamespace"]={...t["x-attribsNamespace"]}),t["x-attribsPrefix"]&&(s["x-attribsPrefix"]={...t["x-attribsPrefix"]}),n=s}else if(cl(t)){const r=e?Cd(t.children):[],s=new tw(r);r.forEach(a=>a.parent=s),n=s}else if(ts(t)){const r=e?Cd(t.children):[],s=new Is(r);r.forEach(a=>a.parent=s),t["x-mode"]&&(s["x-mode"]=t["x-mode"]),n=s}else if(Hh(t)){const r=new gm(t.name,t.data);t["x-name"]!=null&&(r["x-name"]=t["x-name"],r["x-publicId"]=t["x-publicId"],r["x-systemId"]=t["x-systemId"]),n=r}else throw new Error(`Not implemented yet: ${t.type}`);return n.startIndex=t.startIndex,n.endIndex=t.endIndex,t.sourceCodeLocation!=null&&(n.sourceCodeLocation=t.sourceCodeLocation),n}function Cd(t){const e=t.map(n=>Ji(n,!0));for(let n=1;n<e.length;n++)e[n].prev=e[n-1],e[n-1].next=e[n];return e}const H0={withStartIndices:!1,withEndIndices:!1,xmlMode:!1};class iD{constructor(e,n,r){this.dom=[],this.root=new Is(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof n=="function"&&(r=n,n=H0),typeof e=="object"&&(n=e,e=void 0),this.callback=e??null,this.options=n??H0,this.elementCB=r??null}onparserinit(e){this.parser=e}onreset(){this.dom=[],this.root=new Is(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null}onend(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))}onerror(e){this.handleCallback(e)}onclosetag(){this.lastNode=null;const e=this.tagStack.pop();this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(e)}onopentag(e,n){const r=this.options.xmlMode?We.Tag:void 0,s=new _m(e,n,void 0,r);this.addNode(s),this.tagStack.push(s)}ontext(e){const{lastNode:n}=this;if(n&&n.type===We.Text)n.data+=e,this.options.withEndIndices&&(n.endIndex=this.parser.endIndex);else{const r=new Zi(e);this.addNode(r),this.lastNode=r}}oncomment(e){if(this.lastNode&&this.lastNode.type===We.Comment){this.lastNode.data+=e;return}const n=new pm(e);this.addNode(n),this.lastNode=n}oncommentend(){this.lastNode=null}oncdatastart(){const e=new Zi(""),n=new tw([e]);this.addNode(n),e.parent=n,this.lastNode=e}oncdataend(){this.lastNode=null}onprocessinginstruction(e,n){const r=new gm(e,n);this.addNode(r)}handleCallback(e){if(typeof this.callback=="function")this.callback(e,this.dom);else if(e)throw e}addNode(e){const n=this.tagStack[this.tagStack.length-1],r=n.children[n.children.length-1];this.options.withStartIndices&&(e.startIndex=this.parser.startIndex),this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),n.children.push(e),r&&(e.prev=r,r.next=e),e.parent=n,this.lastNode=null}}const ym=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(t=>t.charCodeAt(0))),nw=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(t=>t.charCodeAt(0)));var vd;const oD=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),$h=(vd=String.fromCodePoint)!==null&&vd!==void 0?vd:function(t){let e="";return t>65535&&(t-=65536,e+=String.fromCharCode(t>>>10&1023|55296),t=56320|t&1023),e+=String.fromCharCode(t),e};function uD(t){var e;return t>=55296&&t<=57343||t>1114111?65533:(e=oD.get(t))!==null&&e!==void 0?e:t}var Nt;(function(t){t[t.NUM=35]="NUM",t[t.SEMI=59]="SEMI",t[t.EQUALS=61]="EQUALS",t[t.ZERO=48]="ZERO",t[t.NINE=57]="NINE",t[t.LOWER_A=97]="LOWER_A",t[t.LOWER_F=102]="LOWER_F",t[t.LOWER_X=120]="LOWER_X",t[t.LOWER_Z=122]="LOWER_Z",t[t.UPPER_A=65]="UPPER_A",t[t.UPPER_F=70]="UPPER_F",t[t.UPPER_Z=90]="UPPER_Z"})(Nt||(Nt={}));const cD=32;var qr;(function(t){t[t.VALUE_LENGTH=49152]="VALUE_LENGTH",t[t.BRANCH_LENGTH=16256]="BRANCH_LENGTH",t[t.JUMP_TABLE=127]="JUMP_TABLE"})(qr||(qr={}));function qh(t){return t>=Nt.ZERO&&t<=Nt.NINE}function lD(t){return t>=Nt.UPPER_A&&t<=Nt.UPPER_F||t>=Nt.LOWER_A&&t<=Nt.LOWER_F}function dD(t){return t>=Nt.UPPER_A&&t<=Nt.UPPER_Z||t>=Nt.LOWER_A&&t<=Nt.LOWER_Z||qh(t)}function hD(t){return t===Nt.EQUALS||dD(t)}var Ot;(function(t){t[t.EntityStart=0]="EntityStart",t[t.NumericStart=1]="NumericStart",t[t.NumericDecimal=2]="NumericDecimal",t[t.NumericHex=3]="NumericHex",t[t.NamedEntity=4]="NamedEntity"})(Ot||(Ot={}));var vn;(function(t){t[t.Legacy=0]="Legacy",t[t.Strict=1]="Strict",t[t.Attribute=2]="Attribute"})(vn||(vn={}));class Em{constructor(e,n,r){this.decodeTree=e,this.emitCodePoint=n,this.errors=r,this.state=Ot.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=vn.Strict}startEntity(e){this.decodeMode=e,this.state=Ot.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(e,n){switch(this.state){case Ot.EntityStart:return e.charCodeAt(n)===Nt.NUM?(this.state=Ot.NumericStart,this.consumed+=1,this.stateNumericStart(e,n+1)):(this.state=Ot.NamedEntity,this.stateNamedEntity(e,n));case Ot.NumericStart:return this.stateNumericStart(e,n);case Ot.NumericDecimal:return this.stateNumericDecimal(e,n);case Ot.NumericHex:return this.stateNumericHex(e,n);case Ot.NamedEntity:return this.stateNamedEntity(e,n)}}stateNumericStart(e,n){return n>=e.length?-1:(e.charCodeAt(n)|cD)===Nt.LOWER_X?(this.state=Ot.NumericHex,this.consumed+=1,this.stateNumericHex(e,n+1)):(this.state=Ot.NumericDecimal,this.stateNumericDecimal(e,n))}addToNumericResult(e,n,r,s){if(n!==r){const a=r-n;this.result=this.result*Math.pow(s,a)+parseInt(e.substr(n,a),s),this.consumed+=a}}stateNumericHex(e,n){const r=n;for(;n<e.length;){const s=e.charCodeAt(n);if(qh(s)||lD(s))n+=1;else return this.addToNumericResult(e,r,n,16),this.emitNumericEntity(s,3)}return this.addToNumericResult(e,r,n,16),-1}stateNumericDecimal(e,n){const r=n;for(;n<e.length;){const s=e.charCodeAt(n);if(qh(s))n+=1;else return this.addToNumericResult(e,r,n,10),this.emitNumericEntity(s,2)}return this.addToNumericResult(e,r,n,10),-1}emitNumericEntity(e,n){var r;if(this.consumed<=n)return(r=this.errors)===null||r===void 0||r.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===Nt.SEMI)this.consumed+=1;else if(this.decodeMode===vn.Strict)return 0;return this.emitCodePoint(uD(this.result),this.consumed),this.errors&&(e!==Nt.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(e,n){const{decodeTree:r}=this;let s=r[this.treeIndex],a=(s&qr.VALUE_LENGTH)>>14;for(;n<e.length;n++,this.excess++){const i=e.charCodeAt(n);if(this.treeIndex=fD(r,s,this.treeIndex+Math.max(1,a),i),this.treeIndex<0)return this.result===0||this.decodeMode===vn.Attribute&&(a===0||hD(i))?0:this.emitNotTerminatedNamedEntity();if(s=r[this.treeIndex],a=(s&qr.VALUE_LENGTH)>>14,a!==0){if(i===Nt.SEMI)return this.emitNamedEntityData(this.treeIndex,a,this.consumed+this.excess);this.decodeMode!==vn.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var e;const{result:n,decodeTree:r}=this,s=(r[n]&qr.VALUE_LENGTH)>>14;return this.emitNamedEntityData(n,s,this.consumed),(e=this.errors)===null||e===void 0||e.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(e,n,r){const{decodeTree:s}=this;return this.emitCodePoint(n===1?s[e]&~qr.VALUE_LENGTH:s[e+1],r),n===3&&this.emitCodePoint(s[e+2],r),r}end(){var e;switch(this.state){case Ot.NamedEntity:return this.result!==0&&(this.decodeMode!==vn.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case Ot.NumericDecimal:return this.emitNumericEntity(0,2);case Ot.NumericHex:return this.emitNumericEntity(0,3);case Ot.NumericStart:return(e=this.errors)===null||e===void 0||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case Ot.EntityStart:return 0}}}function rw(t){let e="";const n=new Em(t,r=>e+=$h(r));return function(s,a){let i=0,o=0;for(;(o=s.indexOf("&",o))>=0;){e+=s.slice(i,o),n.startEntity(a);const c=n.write(s,o+1);if(c<0){i=o+n.end();break}i=o+c,o=c===0?i+1:i}const u=e+s.slice(i);return e="",u}}function fD(t,e,n,r){const s=(e&qr.BRANCH_LENGTH)>>7,a=e&qr.JUMP_TABLE;if(s===0)return a!==0&&r===a?n:-1;if(a){const u=r-a;return u<0||u>=s?-1:t[n+u]-1}let i=n,o=i+s-1;for(;i<=o;){const u=i+o>>>1,c=t[u];if(c<r)i=u+1;else if(c>r)o=u-1;else return t[u+s]}return-1}rw(ym);rw(nw);const $0=/["&'<>$\x80-\uFFFF]/g,mD=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]),pD=String.prototype.codePointAt!=null?(t,e)=>t.codePointAt(e):(t,e)=>(t.charCodeAt(e)&64512)===55296?(t.charCodeAt(e)-55296)*1024+t.charCodeAt(e+1)-56320+65536:t.charCodeAt(e);function sw(t){let e="",n=0,r;for(;(r=$0.exec(t))!==null;){const s=r.index,a=t.charCodeAt(s),i=mD.get(a);i!==void 0?(e+=t.substring(n,s)+i,n=s+1):(e+=`${t.substring(n,s)}&#x${pD(t,s).toString(16)};`,n=$0.lastIndex+=+((a&64512)===55296))}return e+t.substr(n)}function aw(t,e){return function(r){let s,a=0,i="";for(;s=t.exec(r);)a!==s.index&&(i+=r.substring(a,s.index)),i+=e.get(s[0].charCodeAt(0)),a=s.index+1;return i+r.substring(a)}}const iw=aw(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),ow=aw(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]])),gD=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(t=>[t.toLowerCase(),t])),bD=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(t=>[t.toLowerCase(),t])),_D=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function yD(t){return t.replace(/"/g,"&quot;")}function ED(t,e){var n;if(!t)return;const r=((n=e.encodeEntities)!==null&&n!==void 0?n:e.decodeEntities)===!1?yD:e.xmlMode||e.encodeEntities!=="utf8"?sw:iw;return Object.keys(t).map(s=>{var a,i;const o=(a=t[s])!==null&&a!==void 0?a:"";return e.xmlMode==="foreign"&&(s=(i=bD.get(s))!==null&&i!==void 0?i:s),!e.emptyAttrs&&!e.xmlMode&&o===""?s:`${s}="${r(o)}"`}).join(" ")}const q0=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function dl(t,e={}){const n="length"in t?t:[t];let r="";for(let s=0;s<n.length;s++)r+=wD(n[s],e);return r}function wD(t,e){switch(t.type){case J4:return dl(t.children,e);case aD:case Q4:return CD(t);case eD:return kD(t);case sD:return OD(t);case tD:case nD:case rD:return AD(t,e);case X4:return vD(t,e)}}const TD=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),SD=new Set(["svg","math"]);function AD(t,e){var n;e.xmlMode==="foreign"&&(t.name=(n=gD.get(t.name))!==null&&n!==void 0?n:t.name,t.parent&&TD.has(t.parent.name)&&(e={...e,xmlMode:!1})),!e.xmlMode&&SD.has(t.name)&&(e={...e,xmlMode:"foreign"});let r=`<${t.name}`;const s=ED(t.attribs,e);return s&&(r+=` ${s}`),t.children.length===0&&(e.xmlMode?e.selfClosingTags!==!1:e.selfClosingTags&&q0.has(t.name))?(e.xmlMode||(r+=" "),r+="/>"):(r+=">",t.children.length>0&&(r+=dl(t.children,e)),(e.xmlMode||!q0.has(t.name))&&(r+=`</${t.name}>`)),r}function CD(t){return`<${t.data}>`}function vD(t,e){var n;let r=t.data||"";return((n=e.encodeEntities)!==null&&n!==void 0?n:e.decodeEntities)!==!1&&!(!e.xmlMode&&t.parent&&_D.has(t.parent.name))&&(r=e.xmlMode||e.encodeEntities!=="utf8"?sw(r):ow(r)),r}function OD(t){return`<![CDATA[${t.children[0].data}]]>`}function kD(t){return`<!--${t.data}-->`}function uw(t,e){return dl(t,e)}function ID(t,e){return ft(t)?t.children.map(n=>uw(n,e)).join(""):""}function Nu(t){return Array.isArray(t)?t.map(Nu).join(""):Ee(t)?t.name==="br"?`
`:Nu(t.children):cl(t)?Nu(t.children):mr(t)?t.data:""}function ba(t){return Array.isArray(t)?t.map(ba).join(""):ft(t)&&!ll(t)?ba(t.children):mr(t)?t.data:""}function mc(t){return Array.isArray(t)?t.map(mc).join(""):ft(t)&&(t.type===We.Tag||cl(t))?mc(t.children):mr(t)?t.data:""}function hl(t){return ft(t)?t.children:[]}function cw(t){return t.parent||null}function lw(t){const e=cw(t);if(e!=null)return hl(e);const n=[t];let{prev:r,next:s}=t;for(;r!=null;)n.unshift(r),{prev:r}=r;for(;s!=null;)n.push(s),{next:s}=s;return n}function ND(t,e){var n;return(n=t.attribs)===null||n===void 0?void 0:n[e]}function RD(t,e){return t.attribs!=null&&Object.prototype.hasOwnProperty.call(t.attribs,e)&&t.attribs[e]!=null}function PD(t){return t.name}function wm(t){let{next:e}=t;for(;e!==null&&!Ee(e);)({next:e}=e);return e}function Tm(t){let{prev:e}=t;for(;e!==null&&!Ee(e);)({prev:e}=e);return e}function xs(t){if(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.parent){const e=t.parent.children,n=e.lastIndexOf(t);n>=0&&e.splice(n,1)}t.next=null,t.prev=null,t.parent=null}function xD(t,e){const n=e.prev=t.prev;n&&(n.next=e);const r=e.next=t.next;r&&(r.prev=e);const s=e.parent=t.parent;if(s){const a=s.children;a[a.lastIndexOf(t)]=e,t.parent=null}}function LD(t,e){if(xs(e),e.next=null,e.parent=t,t.children.push(e)>1){const n=t.children[t.children.length-2];n.next=e,e.prev=n}else e.prev=null}function DD(t,e){xs(e);const{parent:n}=t,r=t.next;if(e.next=r,e.prev=t,t.next=e,e.parent=n,r){if(r.prev=e,n){const s=n.children;s.splice(s.lastIndexOf(r),0,e)}}else n&&n.children.push(e)}function MD(t,e){if(xs(e),e.parent=t,e.prev=null,t.children.unshift(e)!==1){const n=t.children[1];n.prev=e,e.next=n}else e.next=null}function BD(t,e){xs(e);const{parent:n}=t;if(n){const r=n.children;r.splice(r.indexOf(t),0,e)}t.prev&&(t.prev.next=e),e.parent=n,e.prev=t.prev,e.next=t,t.prev=e}function Ao(t,e,n=!0,r=1/0){return Sm(t,Array.isArray(e)?e:[e],n,r)}function Sm(t,e,n,r){const s=[],a=[Array.isArray(e)?e:[e]],i=[0];for(;;){if(i[0]>=a[0].length){if(i.length===1)return s;a.shift(),i.shift();continue}const o=a[0][i[0]++];if(t(o)&&(s.push(o),--r<=0))return s;n&&ft(o)&&o.children.length>0&&(i.unshift(0),a.unshift(o.children))}}function FD(t,e){return e.find(t)}function Am(t,e,n=!0){const r=Array.isArray(e)?e:[e];for(let s=0;s<r.length;s++){const a=r[s];if(Ee(a)&&t(a))return a;if(n&&ft(a)&&a.children.length>0){const i=Am(t,a.children,!0);if(i)return i}}return null}function dw(t,e){return(Array.isArray(e)?e:[e]).some(n=>Ee(n)&&t(n)||ft(n)&&dw(t,n.children))}function UD(t,e){const n=[],r=[Array.isArray(e)?e:[e]],s=[0];for(;;){if(s[0]>=r[0].length){if(r.length===1)return n;r.shift(),s.shift();continue}const a=r[0][s[0]++];Ee(a)&&t(a)&&n.push(a),ft(a)&&a.children.length>0&&(s.unshift(0),r.unshift(a.children))}}const pc={tag_name(t){return typeof t=="function"?e=>Ee(e)&&t(e.name):t==="*"?Ee:e=>Ee(e)&&e.name===t},tag_type(t){return typeof t=="function"?e=>t(e.type):e=>e.type===t},tag_contains(t){return typeof t=="function"?e=>mr(e)&&t(e.data):e=>mr(e)&&e.data===t}};function Cm(t,e){return typeof e=="function"?n=>Ee(n)&&e(n.attribs[t]):n=>Ee(n)&&n.attribs[t]===e}function jD(t,e){return n=>t(n)||e(n)}function hw(t){const e=Object.keys(t).map(n=>{const r=t[n];return Object.prototype.hasOwnProperty.call(pc,n)?pc[n](r):Cm(n,r)});return e.length===0?null:e.reduce(jD)}function HD(t,e){const n=hw(t);return n?n(e):!0}function $D(t,e,n,r=1/0){const s=hw(t);return s?Ao(s,e,n,r):[]}function qD(t,e,n=!0){return Array.isArray(e)||(e=[e]),Am(Cm("id",t),e,n)}function Pa(t,e,n=!0,r=1/0){return Ao(pc.tag_name(t),e,n,r)}function VD(t,e,n=!0,r=1/0){return Ao(Cm("class",t),e,n,r)}function zD(t,e,n=!0,r=1/0){return Ao(pc.tag_type(t),e,n,r)}function WD(t){let e=t.length;for(;--e>=0;){const n=t[e];if(e>0&&t.lastIndexOf(n,e-1)>=0){t.splice(e,1);continue}for(let r=n.parent;r;r=r.parent)if(t.includes(r)){t.splice(e,1);break}}return t}var Cn;(function(t){t[t.DISCONNECTED=1]="DISCONNECTED",t[t.PRECEDING=2]="PRECEDING",t[t.FOLLOWING=4]="FOLLOWING",t[t.CONTAINS=8]="CONTAINS",t[t.CONTAINED_BY=16]="CONTAINED_BY"})(Cn||(Cn={}));function fw(t,e){const n=[],r=[];if(t===e)return 0;let s=ft(t)?t:t.parent;for(;s;)n.unshift(s),s=s.parent;for(s=ft(e)?e:e.parent;s;)r.unshift(s),s=s.parent;const a=Math.min(n.length,r.length);let i=0;for(;i<a&&n[i]===r[i];)i++;if(i===0)return Cn.DISCONNECTED;const o=n[i-1],u=o.children,c=n[i],l=r[i];return u.indexOf(c)>u.indexOf(l)?o===e?Cn.FOLLOWING|Cn.CONTAINED_BY:Cn.FOLLOWING:o===t?Cn.PRECEDING|Cn.CONTAINS:Cn.PRECEDING}function xa(t){return t=t.filter((e,n,r)=>!r.includes(e,n+1)),t.sort((e,n)=>{const r=fw(e,n);return r&Cn.PRECEDING?-1:r&Cn.FOLLOWING?1:0}),t}function GD(t){const e=gc(XD,t);return e?e.name==="feed"?KD(e):YD(e):null}function KD(t){var e;const n=t.children,r={type:"atom",items:Pa("entry",n).map(i=>{var o;const{children:u}=i,c={media:mw(u)};Xt(c,"id","id",u),Xt(c,"title","title",u);const l=(o=gc("link",u))===null||o===void 0?void 0:o.attribs.href;l&&(c.link=l);const d=Vr("summary",u)||Vr("content",u);d&&(c.description=d);const m=Vr("updated",u);return m&&(c.pubDate=new Date(m)),c})};Xt(r,"id","id",n),Xt(r,"title","title",n);const s=(e=gc("link",n))===null||e===void 0?void 0:e.attribs.href;s&&(r.link=s),Xt(r,"description","subtitle",n);const a=Vr("updated",n);return a&&(r.updated=new Date(a)),Xt(r,"author","email",n,!0),r}function YD(t){var e,n;const r=(n=(e=gc("channel",t.children))===null||e===void 0?void 0:e.children)!==null&&n!==void 0?n:[],s={type:t.name.substr(0,3),id:"",items:Pa("item",t.children).map(i=>{const{children:o}=i,u={media:mw(o)};Xt(u,"id","guid",o),Xt(u,"title","title",o),Xt(u,"link","link",o),Xt(u,"description","description",o);const c=Vr("pubDate",o)||Vr("dc:date",o);return c&&(u.pubDate=new Date(c)),u})};Xt(s,"title","title",r),Xt(s,"link","link",r),Xt(s,"description","description",r);const a=Vr("lastBuildDate",r);return a&&(s.updated=new Date(a)),Xt(s,"author","managingEditor",r,!0),s}const ZD=["url","type","lang"],JD=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function mw(t){return Pa("media:content",t).map(e=>{const{attribs:n}=e,r={medium:n.medium,isDefault:!!n.isDefault};for(const s of ZD)n[s]&&(r[s]=n[s]);for(const s of JD)n[s]&&(r[s]=parseInt(n[s],10));return n.expression&&(r.expression=n.expression),r})}function gc(t,e){return Pa(t,e,!0,1)[0]}function Vr(t,e,n=!1){return ba(Pa(t,e,n,1)).trim()}function Xt(t,e,n,r,s=!1){const a=Vr(n,r,s);a&&(t[e]=a)}function XD(t){return t==="rss"||t==="feed"||t==="rdf:RDF"}const fl=Object.freeze(Object.defineProperty({__proto__:null,get DocumentPosition(){return Cn},append:DD,appendChild:LD,compareDocumentPosition:fw,existsOne:dw,filter:Ao,find:Sm,findAll:UD,findOne:Am,findOneChild:FD,getAttributeValue:ND,getChildren:hl,getElementById:qD,getElements:$D,getElementsByClassName:VD,getElementsByTagName:Pa,getElementsByTagType:zD,getFeed:GD,getInnerHTML:ID,getName:PD,getOuterHTML:uw,getParent:cw,getSiblings:lw,getText:Nu,hasAttrib:RD,hasChildren:ft,innerText:mc,isCDATA:cl,isComment:ll,isDocument:ts,isTag:Ee,isText:mr,nextElementSibling:wm,prepend:BD,prependChild:MD,prevElementSibling:Tm,removeElement:xs,removeSubsets:WD,replaceElement:xD,testElement:HD,textContent:ba,uniqueSort:xa},Symbol.toStringTag,{value:"Module"})),QD={_useHtmlParser2:!1};function Vh(t,e){if(!t)return e??QD;const n={_useHtmlParser2:!!t.xmlMode,...e,...t};return t.xml?(n._useHtmlParser2=!0,n.xmlMode=!0,t.xml!==!0&&Object.assign(n,t.xml)):t.xmlMode&&(n._useHtmlParser2=!0),n}function pw(t,e,n){return t?t(e??t._root.children,null,void 0,n).toString():""}function eM(t,e){return typeof t=="object"&&t!=null&&!("length"in t)&&!("type"in t)}function tM(t,e){const n=eM(t)?(e=t,void 0):t,r={...this===null||this===void 0?void 0:this._options,...Vh(e)};return pw(this,n,r)}function nM(t){const e={...this._options,xmlMode:!0};return pw(this,t,e)}function Xi(t){const e=t??(this?this.root():[]);let n="";for(let r=0;r<e.length;r++)n+=ba(e[r]);return n}function rM(t,e,n=typeof e=="boolean"?e:!1){if(!t||typeof t!="string")return null;typeof e=="boolean"&&(n=e);const r=this.load(t,this._options,!1);return n||r("script").remove(),[...r.root()[0].children]}function sM(){return this(this._root)}function gw(t,e){if(e===t)return!1;let n=e;for(;n&&n!==n.parent;)if(n=n.parent,n===t)return!0;return!1}function aM(t){return this.root().extract(t)}function iM(t,e){if(!V0(t)||!V0(e))return;let n=t.length;const r=+e.length;for(let s=0;s<r;s++)t[n++]=e[s];return t.length=n,t}function V0(t){if(Array.isArray(t))return!0;if(typeof t!="object"||t===null||!("length"in t)||typeof t.length!="number"||t.length<0)return!1;for(let e=0;e<t.length;e++)if(!(e in t))return!1;return!0}const oM=Object.freeze(Object.defineProperty({__proto__:null,contains:gw,extract:aM,html:tM,merge:iM,parseHTML:rM,root:sM,text:Xi,xml:nM},Symbol.toStringTag,{value:"Module"}));function Ir(t){return t.cheerio!=null}function uM(t){return t.replace(/[._-](\w|$)/g,(e,n)=>n.toUpperCase())}function cM(t){return t.replace(/[A-Z]/g,"-$&").toLowerCase()}function ct(t,e){const n=t.length;for(let r=0;r<n;r++)e(t[r],r);return t}var is;(function(t){t[t.LowerA=97]="LowerA",t[t.LowerZ=122]="LowerZ",t[t.UpperA=65]="UpperA",t[t.UpperZ=90]="UpperZ",t[t.Exclamation=33]="Exclamation"})(is||(is={}));function zh(t){const e=t.indexOf("<");if(e<0||e>t.length-3)return!1;const n=t.charCodeAt(e+1);return(n>=is.LowerA&&n<=is.LowerZ||n>=is.UpperA&&n<=is.UpperZ||n===is.Exclamation)&&t.includes(">",e+2)}const Qi=Object.prototype.hasOwnProperty,eo=/\s+/,Wh="data-",vm=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,lM=/^{[^]*}$|^\[[^]*]$/;function bc(t,e,n){var r;if(!(!t||!Ee(t))){if((r=t.attribs)!==null&&r!==void 0||(t.attribs={}),!e)return t.attribs;if(Qi.call(t.attribs,e))return!n&&vm.test(e)?e:t.attribs[e];if(t.name==="option"&&e==="value")return Xi(t.children);if(t.name==="input"&&(t.attribs.type==="radio"||t.attribs.type==="checkbox")&&e==="value")return"on"}}function ca(t,e,n){n===null?_w(t,e):t.attribs[e]=`${n}`}function dM(t,e){if(typeof t=="object"||e!==void 0){if(typeof e=="function"){if(typeof t!="string")throw new Error("Bad combination of arguments.");return ct(this,(n,r)=>{Ee(n)&&ca(n,t,e.call(n,r,n.attribs[t]))})}return ct(this,n=>{if(Ee(n))if(typeof t=="object")for(const r of Object.keys(t)){const s=t[r];ca(n,r,s)}else ca(n,t,e)})}return arguments.length>1?this:bc(this[0],t,this.options.xmlMode)}function z0(t,e,n){return e in t?t[e]:!n&&vm.test(e)?bc(t,e,!1)!==void 0:bc(t,e,n)}function Od(t,e,n,r){e in t?t[e]=n:ca(t,e,!r&&vm.test(e)?n?"":null:`${n}`)}function hM(t,e){var n;if(typeof t=="string"&&e===void 0){const r=this[0];if(!r||!Ee(r))return;switch(t){case"style":{const s=this.css(),a=Object.keys(s);for(let i=0;i<a.length;i++)s[i]=a[i];return s.length=a.length,s}case"tagName":case"nodeName":return r.name.toUpperCase();case"href":case"src":{const s=(n=r.attribs)===null||n===void 0?void 0:n[t];return typeof URL<"u"&&(t==="href"&&(r.tagName==="a"||r.tagName==="link")||t==="src"&&(r.tagName==="img"||r.tagName==="iframe"||r.tagName==="audio"||r.tagName==="video"||r.tagName==="source"))&&s!==void 0&&this.options.baseURI?new URL(s,this.options.baseURI).href:s}case"innerText":return mc(r);case"textContent":return ba(r);case"outerHTML":return this.clone().wrap("<container />").parent().html();case"innerHTML":return this.html();default:return z0(r,t,this.options.xmlMode)}}if(typeof t=="object"||e!==void 0){if(typeof e=="function"){if(typeof t=="object")throw new TypeError("Bad combination of arguments.");return ct(this,(r,s)=>{Ee(r)&&Od(r,t,e.call(r,s,z0(r,t,this.options.xmlMode)),this.options.xmlMode)})}return ct(this,r=>{if(Ee(r))if(typeof t=="object")for(const s of Object.keys(t)){const a=t[s];Od(r,s,a,this.options.xmlMode)}else Od(r,t,e,this.options.xmlMode)})}}function W0(t,e,n){var r;(r=t.data)!==null&&r!==void 0||(t.data={}),typeof e=="object"?Object.assign(t.data,e):typeof e=="string"&&n!==void 0&&(t.data[e]=n)}function fM(t){for(const e of Object.keys(t.attribs)){if(!e.startsWith(Wh))continue;const n=uM(e.slice(Wh.length));Qi.call(t.data,n)||(t.data[n]=bw(t.attribs[e]))}return t.data}function mM(t,e){const n=Wh+cM(e),r=t.data;if(Qi.call(r,e))return r[e];if(Qi.call(t.attribs,n))return r[e]=bw(t.attribs[n])}function bw(t){if(t==="null")return null;if(t==="true")return!0;if(t==="false")return!1;const e=Number(t);if(t===String(e))return e;if(lM.test(t))try{return JSON.parse(t)}catch{}return t}function pM(t,e){var n;const r=this[0];if(!r||!Ee(r))return;const s=r;return(n=s.data)!==null&&n!==void 0||(s.data={}),t==null?fM(s):typeof t=="object"||e!==void 0?(ct(this,a=>{Ee(a)&&(typeof t=="object"?W0(a,t):W0(a,t,e))}),this):mM(s,t)}function gM(t){const e=arguments.length===0,n=this[0];if(!n||!Ee(n))return e?void 0:this;switch(n.name){case"textarea":return this.text(t);case"select":{const r=this.find("option:selected");if(!e){if(this.attr("multiple")==null&&typeof t=="object")return this;this.find("option").removeAttr("selected");const s=typeof t=="object"?t:[t];for(const a of s)this.find(`option[value="${a}"]`).attr("selected","");return this}return this.attr("multiple")?r.toArray().map(s=>Xi(s.children)):r.attr("value")}case"input":case"option":return e?this.attr("value"):this.attr("value",t)}}function _w(t,e){!t.attribs||!Qi.call(t.attribs,e)||delete t.attribs[e]}function _c(t){return t?t.trim().split(eo):[]}function bM(t){const e=_c(t);for(const n of e)ct(this,r=>{Ee(r)&&_w(r,n)});return this}function _M(t){return this.toArray().some(e=>{const n=Ee(e)&&e.attribs.class;let r=-1;if(n&&t.length>0)for(;(r=n.indexOf(t,r+1))>-1;){const s=r+t.length;if((r===0||eo.test(n[r-1]))&&(s===n.length||eo.test(n[s])))return!0}return!1})}function yw(t){if(typeof t=="function")return ct(this,(r,s)=>{if(Ee(r)){const a=r.attribs.class||"";yw.call([r],t.call(r,s,a))}});if(!t||typeof t!="string")return this;const e=t.split(eo),n=this.length;for(let r=0;r<n;r++){const s=this[r];if(!Ee(s))continue;const a=bc(s,"class",!1);if(a){let i=` ${a} `;for(const o of e){const u=`${o} `;i.includes(` ${u}`)||(i+=u)}ca(s,"class",i.trim())}else ca(s,"class",e.join(" ").trim())}return this}function Ew(t){if(typeof t=="function")return ct(this,(s,a)=>{Ee(s)&&Ew.call([s],t.call(s,a,s.attribs.class||""))});const e=_c(t),n=e.length,r=arguments.length===0;return ct(this,s=>{if(Ee(s))if(r)s.attribs.class="";else{const a=_c(s.attribs.class);let i=!1;for(let o=0;o<n;o++){const u=a.indexOf(e[o]);u>=0&&(a.splice(u,1),i=!0,o--)}i&&(s.attribs.class=a.join(" "))}})}function ww(t,e){if(typeof t=="function")return ct(this,(i,o)=>{Ee(i)&&ww.call([i],t.call(i,o,i.attribs.class||"",e),e)});if(!t||typeof t!="string")return this;const n=t.split(eo),r=n.length,s=typeof e=="boolean"?e?1:-1:0,a=this.length;for(let i=0;i<a;i++){const o=this[i];if(!Ee(o))continue;const u=_c(o.attribs.class);for(let c=0;c<r;c++){const l=u.indexOf(n[c]);s>=0&&l<0?u.push(n[c]):s<=0&&l>=0&&u.splice(l,1)}o.attribs.class=u.join(" ")}return this}const yM=Object.freeze(Object.defineProperty({__proto__:null,addClass:yw,attr:dM,data:pM,hasClass:_M,prop:hM,removeAttr:bM,removeClass:Ew,toggleClass:ww,val:gM},Symbol.toStringTag,{value:"Module"}));var ge;(function(t){t.Attribute="attribute",t.Pseudo="pseudo",t.PseudoElement="pseudo-element",t.Tag="tag",t.Universal="universal",t.Adjacent="adjacent",t.Child="child",t.Descendant="descendant",t.Parent="parent",t.Sibling="sibling",t.ColumnCombinator="column-combinator"})(ge||(ge={}));var Tt;(function(t){t.Any="any",t.Element="element",t.End="end",t.Equals="equals",t.Exists="exists",t.Hyphen="hyphen",t.Not="not",t.Start="start"})(Tt||(Tt={}));const G0=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,EM=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,wM=new Map([[126,Tt.Element],[94,Tt.Start],[36,Tt.End],[42,Tt.Any],[33,Tt.Not],[124,Tt.Hyphen]]),TM=new Set(["has","not","matches","is","where","host","host-context"]);function yi(t){switch(t.type){case ge.Adjacent:case ge.Child:case ge.Descendant:case ge.Parent:case ge.Sibling:case ge.ColumnCombinator:return!0;default:return!1}}const SM=new Set(["contains","icontains"]);function AM(t,e,n){const r=parseInt(e,16)-65536;return r!==r||n?e:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,r&1023|56320)}function Ya(t){return t.replace(EM,AM)}function kd(t){return t===39||t===34}function K0(t){return t===32||t===9||t===10||t===12||t===13}function ml(t){const e=[],n=Tw(e,`${t}`,0);if(n<t.length)throw new Error(`Unmatched selector: ${t.slice(n)}`);return e}function Tw(t,e,n){let r=[];function s(m){const p=e.slice(n+m).match(G0);if(!p)throw new Error(`Expected name, found ${e.slice(n)}`);const[h]=p;return n+=m+h.length,Ya(h)}function a(m){for(n+=m;n<e.length&&K0(e.charCodeAt(n));)n++}function i(){n+=1;const m=n;let p=1;for(;p>0&&n<e.length;n++)e.charCodeAt(n)===40&&!o(n)?p++:e.charCodeAt(n)===41&&!o(n)&&p--;if(p)throw new Error("Parenthesis not matched");return Ya(e.slice(m,n-1))}function o(m){let p=0;for(;e.charCodeAt(--m)===92;)p++;return(p&1)===1}function u(){if(r.length>0&&yi(r[r.length-1]))throw new Error("Did not expect successive traversals.")}function c(m){if(r.length>0&&r[r.length-1].type===ge.Descendant){r[r.length-1].type=m;return}u(),r.push({type:m})}function l(m,p){r.push({type:ge.Attribute,name:m,action:p,value:s(1),namespace:null,ignoreCase:"quirks"})}function d(){if(r.length&&r[r.length-1].type===ge.Descendant&&r.pop(),r.length===0)throw new Error("Empty sub-selector");t.push(r)}if(a(0),e.length===n)return n;e:for(;n<e.length;){const m=e.charCodeAt(n);switch(m){case 32:case 9:case 10:case 12:case 13:{(r.length===0||r[0].type!==ge.Descendant)&&(u(),r.push({type:ge.Descendant})),a(1);break}case 62:{c(ge.Child),a(1);break}case 60:{c(ge.Parent),a(1);break}case 126:{c(ge.Sibling),a(1);break}case 43:{c(ge.Adjacent),a(1);break}case 46:{l("class",Tt.Element);break}case 35:{l("id",Tt.Equals);break}case 91:{a(1);let p,h=null;e.charCodeAt(n)===124?p=s(1):e.startsWith("*|",n)?(h="*",p=s(2)):(p=s(0),e.charCodeAt(n)===124&&e.charCodeAt(n+1)!==61&&(h=p,p=s(1))),a(0);let g=Tt.Exists;const b=wM.get(e.charCodeAt(n));if(b){if(g=b,e.charCodeAt(n+1)!==61)throw new Error("Expected `=`");a(2)}else e.charCodeAt(n)===61&&(g=Tt.Equals,a(1));let _="",y=null;if(g!=="exists"){if(kd(e.charCodeAt(n))){const w=e.charCodeAt(n);let R=n+1;for(;R<e.length&&(e.charCodeAt(R)!==w||o(R));)R+=1;if(e.charCodeAt(R)!==w)throw new Error("Attribute value didn't end");_=Ya(e.slice(n+1,R)),n=R+1}else{const w=n;for(;n<e.length&&(!K0(e.charCodeAt(n))&&e.charCodeAt(n)!==93||o(n));)n+=1;_=Ya(e.slice(w,n))}a(0);const I=e.charCodeAt(n)|32;I===115?(y=!1,a(1)):I===105&&(y=!0,a(1))}if(e.charCodeAt(n)!==93)throw new Error("Attribute selector didn't terminate");n+=1;const E={type:ge.Attribute,name:p,action:g,value:_,namespace:h,ignoreCase:y};r.push(E);break}case 58:{if(e.charCodeAt(n+1)===58){r.push({type:ge.PseudoElement,name:s(2).toLowerCase(),data:e.charCodeAt(n)===40?i():null});continue}const p=s(1).toLowerCase();let h=null;if(e.charCodeAt(n)===40)if(TM.has(p)){if(kd(e.charCodeAt(n+1)))throw new Error(`Pseudo-selector ${p} cannot be quoted`);if(h=[],n=Tw(h,e,n+1),e.charCodeAt(n)!==41)throw new Error(`Missing closing parenthesis in :${p} (${e})`);n+=1}else{if(h=i(),SM.has(p)){const g=h.charCodeAt(0);g===h.charCodeAt(h.length-1)&&kd(g)&&(h=h.slice(1,-1))}h=Ya(h)}r.push({type:ge.Pseudo,name:p,data:h});break}case 44:{d(),r=[],a(1);break}default:{if(e.startsWith("/*",n)){const g=e.indexOf("*/",n+2);if(g<0)throw new Error("Comment was not terminated");n=g+2,r.length===0&&a(0);break}let p=null,h;if(m===42)n+=1,h="*";else if(m===124){if(h="",e.charCodeAt(n+1)===124){c(ge.ColumnCombinator),a(2);break}}else if(G0.test(e.slice(n)))h=s(0);else break e;e.charCodeAt(n)===124&&e.charCodeAt(n+1)!==124&&(p=h,e.charCodeAt(n+1)===42?(h="*",n+=2):h=s(1)),r.push(h==="*"?{type:ge.Universal,namespace:p}:{type:ge.Tag,name:h,namespace:p})}}}return d(),n}var yc={trueFunc:function(){return!0},falseFunc:function(){return!1}};const Re=io(yc),Sw=new Map([[ge.Universal,50],[ge.Tag,30],[ge.Attribute,1],[ge.Pseudo,0]]);function Om(t){return!Sw.has(t.type)}const CM=new Map([[Tt.Exists,10],[Tt.Equals,8],[Tt.Not,7],[Tt.Start,6],[Tt.End,6],[Tt.Any,5]]);function vM(t){const e=t.map(Aw);for(let n=1;n<t.length;n++){const r=e[n];if(!(r<0))for(let s=n-1;s>=0&&r<e[s];s--){const a=t[s+1];t[s+1]=t[s],t[s]=a,e[s+1]=e[s],e[s]=r}}}function Aw(t){var e,n;let r=(e=Sw.get(t.type))!==null&&e!==void 0?e:-1;return t.type===ge.Attribute?(r=(n=CM.get(t.action))!==null&&n!==void 0?n:4,t.action===Tt.Equals&&t.name==="id"&&(r=9),t.ignoreCase&&(r>>=1)):t.type===ge.Pseudo&&(t.data?t.name==="has"||t.name==="contains"?r=0:Array.isArray(t.data)?(r=Math.min(...t.data.map(s=>Math.min(...s.map(Aw)))),r<0&&(r=0)):r=2:r=3),r}const OM=/[-[\]{}()*+?.,\\^$|#\s]/g;function Y0(t){return t.replace(OM,"\\$&")}const kM=new Set(["accept","accept-charset","align","alink","axis","bgcolor","charset","checked","clear","codetype","color","compact","declare","defer","dir","direction","disabled","enctype","face","frame","hreflang","http-equiv","lang","language","link","media","method","multiple","nohref","noresize","noshade","nowrap","readonly","rel","rev","rules","scope","scrolling","selected","shape","target","text","type","valign","valuetype","vlink"]);function ss(t,e){return typeof t.ignoreCase=="boolean"?t.ignoreCase:t.ignoreCase==="quirks"?!!e.quirksMode:!e.xmlMode&&kM.has(t.name)}const IM={equals(t,e,n){const{adapter:r}=n,{name:s}=e;let{value:a}=e;return ss(e,n)?(a=a.toLowerCase(),i=>{const o=r.getAttributeValue(i,s);return o!=null&&o.length===a.length&&o.toLowerCase()===a&&t(i)}):i=>r.getAttributeValue(i,s)===a&&t(i)},hyphen(t,e,n){const{adapter:r}=n,{name:s}=e;let{value:a}=e;const i=a.length;return ss(e,n)?(a=a.toLowerCase(),function(u){const c=r.getAttributeValue(u,s);return c!=null&&(c.length===i||c.charAt(i)==="-")&&c.substr(0,i).toLowerCase()===a&&t(u)}):function(u){const c=r.getAttributeValue(u,s);return c!=null&&(c.length===i||c.charAt(i)==="-")&&c.substr(0,i)===a&&t(u)}},element(t,e,n){const{adapter:r}=n,{name:s,value:a}=e;if(/\s/.test(a))return Re.falseFunc;const i=new RegExp(`(?:^|\\s)${Y0(a)}(?:$|\\s)`,ss(e,n)?"i":"");return function(u){const c=r.getAttributeValue(u,s);return c!=null&&c.length>=a.length&&i.test(c)&&t(u)}},exists(t,{name:e},{adapter:n}){return r=>n.hasAttrib(r,e)&&t(r)},start(t,e,n){const{adapter:r}=n,{name:s}=e;let{value:a}=e;const i=a.length;return i===0?Re.falseFunc:ss(e,n)?(a=a.toLowerCase(),o=>{const u=r.getAttributeValue(o,s);return u!=null&&u.length>=i&&u.substr(0,i).toLowerCase()===a&&t(o)}):o=>{var u;return!!(!((u=r.getAttributeValue(o,s))===null||u===void 0)&&u.startsWith(a))&&t(o)}},end(t,e,n){const{adapter:r}=n,{name:s}=e;let{value:a}=e;const i=-a.length;return i===0?Re.falseFunc:ss(e,n)?(a=a.toLowerCase(),o=>{var u;return((u=r.getAttributeValue(o,s))===null||u===void 0?void 0:u.substr(i).toLowerCase())===a&&t(o)}):o=>{var u;return!!(!((u=r.getAttributeValue(o,s))===null||u===void 0)&&u.endsWith(a))&&t(o)}},any(t,e,n){const{adapter:r}=n,{name:s,value:a}=e;if(a==="")return Re.falseFunc;if(ss(e,n)){const i=new RegExp(Y0(a),"i");return function(u){const c=r.getAttributeValue(u,s);return c!=null&&c.length>=a.length&&i.test(c)&&t(u)}}return i=>{var o;return!!(!((o=r.getAttributeValue(i,s))===null||o===void 0)&&o.includes(a))&&t(i)}},not(t,e,n){const{adapter:r}=n,{name:s}=e;let{value:a}=e;return a===""?i=>!!r.getAttributeValue(i,s)&&t(i):ss(e,n)?(a=a.toLowerCase(),i=>{const o=r.getAttributeValue(i,s);return(o==null||o.length!==a.length||o.toLowerCase()!==a)&&t(i)}):i=>r.getAttributeValue(i,s)!==a&&t(i)}},NM=new Set([9,10,12,13,32]),Z0=48,RM=57;function PM(t){if(t=t.trim().toLowerCase(),t==="even")return[2,0];if(t==="odd")return[2,1];let e=0,n=0,r=a(),s=i();if(e<t.length&&t.charAt(e)==="n"&&(e++,n=r*(s??1),o(),e<t.length?(r=a(),o(),s=i()):r=s=0),s===null||e<t.length)throw new Error(`n-th rule couldn't be parsed ('${t}')`);return[n,r*s];function a(){return t.charAt(e)==="-"?(e++,-1):(t.charAt(e)==="+"&&e++,1)}function i(){const u=e;let c=0;for(;e<t.length&&t.charCodeAt(e)>=Z0&&t.charCodeAt(e)<=RM;)c=c*10+(t.charCodeAt(e)-Z0),e++;return e===u?null:c}function o(){for(;e<t.length&&NM.has(t.charCodeAt(e));)e++}}function xM(t){const e=t[0],n=t[1]-1;if(n<0&&e<=0)return Re.falseFunc;if(e===-1)return a=>a<=n;if(e===0)return a=>a===n;if(e===1)return n<0?Re.trueFunc:a=>a>=n;const r=Math.abs(e),s=(n%r+r)%r;return e>1?a=>a>=n&&a%r===s:a=>a<=n&&a%r===s}function du(t){return xM(PM(t))}function hu(t,e){return n=>{const r=e.getParent(n);return r!=null&&e.isTag(r)&&t(n)}}const Gh={contains(t,e,{adapter:n}){return function(s){return t(s)&&n.getText(s).includes(e)}},icontains(t,e,{adapter:n}){const r=e.toLowerCase();return function(a){return t(a)&&n.getText(a).toLowerCase().includes(r)}},"nth-child"(t,e,{adapter:n,equals:r}){const s=du(e);return s===Re.falseFunc?Re.falseFunc:s===Re.trueFunc?hu(t,n):function(i){const o=n.getSiblings(i);let u=0;for(let c=0;c<o.length&&!r(i,o[c]);c++)n.isTag(o[c])&&u++;return s(u)&&t(i)}},"nth-last-child"(t,e,{adapter:n,equals:r}){const s=du(e);return s===Re.falseFunc?Re.falseFunc:s===Re.trueFunc?hu(t,n):function(i){const o=n.getSiblings(i);let u=0;for(let c=o.length-1;c>=0&&!r(i,o[c]);c--)n.isTag(o[c])&&u++;return s(u)&&t(i)}},"nth-of-type"(t,e,{adapter:n,equals:r}){const s=du(e);return s===Re.falseFunc?Re.falseFunc:s===Re.trueFunc?hu(t,n):function(i){const o=n.getSiblings(i);let u=0;for(let c=0;c<o.length;c++){const l=o[c];if(r(i,l))break;n.isTag(l)&&n.getName(l)===n.getName(i)&&u++}return s(u)&&t(i)}},"nth-last-of-type"(t,e,{adapter:n,equals:r}){const s=du(e);return s===Re.falseFunc?Re.falseFunc:s===Re.trueFunc?hu(t,n):function(i){const o=n.getSiblings(i);let u=0;for(let c=o.length-1;c>=0;c--){const l=o[c];if(r(i,l))break;n.isTag(l)&&n.getName(l)===n.getName(i)&&u++}return s(u)&&t(i)}},root(t,e,{adapter:n}){return r=>{const s=n.getParent(r);return(s==null||!n.isTag(s))&&t(r)}},scope(t,e,n,r){const{equals:s}=n;return!r||r.length===0?Gh.root(t,e,n):r.length===1?a=>s(r[0],a)&&t(a):a=>r.includes(a)&&t(a)},hover:Id("isHovered"),visited:Id("isVisited"),active:Id("isActive")};function Id(t){return function(n,r,{adapter:s}){const a=s[t];return typeof a!="function"?Re.falseFunc:function(o){return a(o)&&n(o)}}}const J0={empty(t,{adapter:e}){return!e.getChildren(t).some(n=>e.isTag(n)||e.getText(n)!=="")},"first-child"(t,{adapter:e,equals:n}){if(e.prevElementSibling)return e.prevElementSibling(t)==null;const r=e.getSiblings(t).find(s=>e.isTag(s));return r!=null&&n(t,r)},"last-child"(t,{adapter:e,equals:n}){const r=e.getSiblings(t);for(let s=r.length-1;s>=0;s--){if(n(t,r[s]))return!0;if(e.isTag(r[s]))break}return!1},"first-of-type"(t,{adapter:e,equals:n}){const r=e.getSiblings(t),s=e.getName(t);for(let a=0;a<r.length;a++){const i=r[a];if(n(t,i))return!0;if(e.isTag(i)&&e.getName(i)===s)break}return!1},"last-of-type"(t,{adapter:e,equals:n}){const r=e.getSiblings(t),s=e.getName(t);for(let a=r.length-1;a>=0;a--){const i=r[a];if(n(t,i))return!0;if(e.isTag(i)&&e.getName(i)===s)break}return!1},"only-of-type"(t,{adapter:e,equals:n}){const r=e.getName(t);return e.getSiblings(t).every(s=>n(t,s)||!e.isTag(s)||e.getName(s)!==r)},"only-child"(t,{adapter:e,equals:n}){return e.getSiblings(t).every(r=>n(t,r)||!e.isTag(r))}};function X0(t,e,n,r){if(n===null){if(t.length>r)throw new Error(`Pseudo-class :${e} requires an argument`)}else if(t.length===r)throw new Error(`Pseudo-class :${e} doesn't have any arguments`)}const LM={"any-link":":is(a, area, link)[href]",link:":any-link:not(:visited)",disabled:`:is(
        :is(button, input, select, textarea, optgroup, option)[disabled],
        optgroup[disabled] > option,
        fieldset[disabled]:not(fieldset[disabled] legend:first-of-type *)
    )`,enabled:":not(:disabled)",checked:":is(:is(input[type=radio], input[type=checkbox])[checked], option:selected)",required:":is(input, select, textarea)[required]",optional:":is(input, select, textarea):not([required])",selected:"option:is([selected], select:not([multiple]):not(:has(> option[selected])) > :first-of-type)",checkbox:"[type=checkbox]",file:"[type=file]",password:"[type=password]",radio:"[type=radio]",reset:"[type=reset]",image:"[type=image]",submit:"[type=submit]",parent:":not(:empty)",header:":is(h1, h2, h3, h4, h5, h6)",button:":is(button, input[type=button])",input:":is(input, textarea, select, button)",text:"input:is(:not([type!='']), [type=text])"},Cw={};function DM(t,e){return t===Re.falseFunc?Re.falseFunc:n=>e.isTag(n)&&t(n)}function vw(t,e){const n=e.getSiblings(t);if(n.length<=1)return[];const r=n.indexOf(t);return r<0||r===n.length-1?[]:n.slice(r+1).filter(e.isTag)}function Kh(t){return{xmlMode:!!t.xmlMode,lowerCaseAttributeNames:!!t.lowerCaseAttributeNames,lowerCaseTags:!!t.lowerCaseTags,quirksMode:!!t.quirksMode,cacheResults:!!t.cacheResults,pseudos:t.pseudos,adapter:t.adapter,equals:t.equals}}const Nd=(t,e,n,r,s)=>{const a=s(e,Kh(n),r);return a===Re.trueFunc?t:a===Re.falseFunc?Re.falseFunc:i=>a(i)&&t(i)},Rd={is:Nd,matches:Nd,where:Nd,not(t,e,n,r,s){const a=s(e,Kh(n),r);return a===Re.falseFunc?t:a===Re.trueFunc?Re.falseFunc:i=>!a(i)&&t(i)},has(t,e,n,r,s){const{adapter:a}=n,i=Kh(n);i.relativeSelector=!0;const o=e.some(l=>l.some(Om))?[Cw]:void 0,u=s(e,i,o);if(u===Re.falseFunc)return Re.falseFunc;const c=DM(u,a);if(o&&u!==Re.trueFunc){const{shouldTestNextSiblings:l=!1}=u;return d=>{if(!t(d))return!1;o[0]=d;const m=a.getChildren(d),p=l?[...m,...vw(d,a)]:m;return a.existsOne(c,p)}}return l=>t(l)&&a.existsOne(c,a.getChildren(l))}};function MM(t,e,n,r,s){var a;const{name:i,data:o}=e;if(Array.isArray(o)){if(!(i in Rd))throw new Error(`Unknown pseudo-class :${i}(${o})`);return Rd[i](t,o,n,r,s)}const u=(a=n.pseudos)===null||a===void 0?void 0:a[i],c=typeof u=="string"?u:LM[i];if(typeof c=="string"){if(o!=null)throw new Error(`Pseudo ${i} doesn't have any arguments`);const l=ml(c);return Rd.is(t,l,n,r,s)}if(typeof u=="function")return X0(u,i,o,1),l=>u(l,o)&&t(l);if(i in Gh)return Gh[i](t,o,n,r);if(i in J0){const l=J0[i];return X0(l,i,o,2),d=>l(d,n,o)&&t(d)}throw new Error(`Unknown pseudo-class :${i}`)}function Pd(t,e){const n=e.getParent(t);return n&&e.isTag(n)?n:null}function BM(t,e,n,r,s){const{adapter:a,equals:i}=n;switch(e.type){case ge.PseudoElement:throw new Error("Pseudo-elements are not supported by css-select");case ge.ColumnCombinator:throw new Error("Column combinators are not yet supported by css-select");case ge.Attribute:{if(e.namespace!=null)throw new Error("Namespaced attributes are not yet supported by css-select");return(!n.xmlMode||n.lowerCaseAttributeNames)&&(e.name=e.name.toLowerCase()),IM[e.action](t,e,n)}case ge.Pseudo:return MM(t,e,n,r,s);case ge.Tag:{if(e.namespace!=null)throw new Error("Namespaced tag names are not yet supported by css-select");let{name:o}=e;return(!n.xmlMode||n.lowerCaseTags)&&(o=o.toLowerCase()),function(c){return a.getName(c)===o&&t(c)}}case ge.Descendant:{if(n.cacheResults===!1||typeof WeakSet>"u")return function(c){let l=c;for(;l=Pd(l,a);)if(t(l))return!0;return!1};const o=new WeakSet;return function(c){let l=c;for(;l=Pd(l,a);)if(!o.has(l)){if(a.isTag(l)&&t(l))return!0;o.add(l)}return!1}}case"_flexibleDescendant":return function(u){let c=u;do if(t(c))return!0;while(c=Pd(c,a));return!1};case ge.Parent:return function(u){return a.getChildren(u).some(c=>a.isTag(c)&&t(c))};case ge.Child:return function(u){const c=a.getParent(u);return c!=null&&a.isTag(c)&&t(c)};case ge.Sibling:return function(u){const c=a.getSiblings(u);for(let l=0;l<c.length;l++){const d=c[l];if(i(u,d))break;if(a.isTag(d)&&t(d))return!0}return!1};case ge.Adjacent:return a.prevElementSibling?function(u){const c=a.prevElementSibling(u);return c!=null&&t(c)}:function(u){const c=a.getSiblings(u);let l;for(let d=0;d<c.length;d++){const m=c[d];if(i(u,m))break;a.isTag(m)&&(l=m)}return!!l&&t(l)};case ge.Universal:{if(e.namespace!=null&&e.namespace!=="*")throw new Error("Namespaced universal selectors are not yet supported by css-select");return t}}}function Ow(t){return t.type===ge.Pseudo&&(t.name==="scope"||Array.isArray(t.data)&&t.data.some(e=>e.some(Ow)))}const FM={type:ge.Descendant},UM={type:"_flexibleDescendant"},jM={type:ge.Pseudo,name:"scope",data:null};function HM(t,{adapter:e},n){const r=!!(n!=null&&n.every(s=>{const a=e.isTag(s)&&e.getParent(s);return s===Cw||a&&e.isTag(a)}));for(const s of t){if(!(s.length>0&&Om(s[0])&&s[0].type!==ge.Descendant))if(r&&!s.some(Ow))s.unshift(FM);else continue;s.unshift(jM)}}function kw(t,e,n){var r;t.forEach(vM),n=(r=e.context)!==null&&r!==void 0?r:n;const s=Array.isArray(n),a=n&&(Array.isArray(n)?n:[n]);if(e.relativeSelector!==!1)HM(t,e,a);else if(t.some(u=>u.length>0&&Om(u[0])))throw new Error("Relative selectors are not allowed when the `relativeSelector` option is disabled");let i=!1;const o=t.map(u=>{if(u.length>=2){const[c,l]=u;c.type!==ge.Pseudo||c.name!=="scope"||(s&&l.type===ge.Descendant?u[1]=UM:(l.type===ge.Adjacent||l.type===ge.Sibling)&&(i=!0))}return $M(u,e,a)}).reduce(qM,Re.falseFunc);return o.shouldTestNextSiblings=i,o}function $M(t,e,n){var r;return t.reduce((s,a)=>s===Re.falseFunc?Re.falseFunc:BM(s,a,e,n,kw),(r=e.rootFunc)!==null&&r!==void 0?r:Re.trueFunc)}function qM(t,e){return e===Re.falseFunc||t===Re.trueFunc?t:t===Re.falseFunc||e===Re.trueFunc?e:function(r){return t(r)||e(r)}}const Iw=(t,e)=>t===e,VM={adapter:fl,equals:Iw};function zM(t){var e,n,r,s;const a=t??VM;return(e=a.adapter)!==null&&e!==void 0||(a.adapter=fl),(n=a.equals)!==null&&n!==void 0||(a.equals=(s=(r=a.adapter)===null||r===void 0?void 0:r.equals)!==null&&s!==void 0?s:Iw),a}function WM(t){return function(n,r,s){const a=zM(r);return t(n,a,s)}}const km=WM(kw);function Nw(t,e,n=!1){return n&&(t=GM(t,e)),Array.isArray(t)?e.removeSubsets(t):e.getChildren(t)}function GM(t,e){const n=Array.isArray(t)?t.slice(0):[t],r=n.length;for(let s=0;s<r;s++){const a=vw(n[s],e);n.push(...a)}return n}const KM=new Set(["first","last","eq","gt","nth","lt","even","odd"]);function Ec(t){return t.type!=="pseudo"?!1:KM.has(t.name)?!0:t.name==="not"&&Array.isArray(t.data)?t.data.some(e=>e.some(Ec)):!1}function YM(t,e,n){const r=e!=null?parseInt(e,10):NaN;switch(t){case"first":return 1;case"nth":case"eq":return isFinite(r)?r>=0?r+1:1/0:0;case"lt":return isFinite(r)?r>=0?Math.min(r,n):1/0:0;case"gt":return isFinite(r)?1/0:0;case"odd":return 2*n;case"even":return 2*n-1;case"last":case"not":return 1/0}}function ZM(t){for(;t.parent;)t=t.parent;return t}function Im(t){const e=[],n=[];for(const r of t)r.some(Ec)?e.push(r):n.push(r);return[n,e]}const JM={type:ge.Universal,namespace:null},XM={type:ge.Pseudo,name:"scope",data:null};function Rw(t,e,n={}){return Pw([t],e,n)}function Pw(t,e,n={}){if(typeof e=="function")return t.some(e);const[r,s]=Im(ml(e));return r.length>0&&t.some(km(r,n))||s.some(a=>Dw(a,t,n).length>0)}function QM(t,e,n,r){const s=typeof n=="string"?parseInt(n,10):NaN;switch(t){case"first":case"lt":return e;case"last":return e.length>0?[e[e.length-1]]:e;case"nth":case"eq":return isFinite(s)&&Math.abs(s)<e.length?[s<0?e[e.length+s]:e[s]]:[];case"gt":return isFinite(s)?e.slice(s+1):[];case"even":return e.filter((a,i)=>i%2===0);case"odd":return e.filter((a,i)=>i%2===1);case"not":{const a=new Set(Lw(n,e,r));return e.filter(i=>!a.has(i))}}}function xw(t,e,n={}){return Lw(ml(t),e,n)}function Lw(t,e,n){if(e.length===0)return[];const[r,s]=Im(t);let a;if(r.length){const i=Zh(e,r,n);if(s.length===0)return i;i.length&&(a=new Set(i))}for(let i=0;i<s.length&&(a==null?void 0:a.size)!==e.length;i++){const o=s[i];if((a?e.filter(l=>Ee(l)&&!a.has(l)):e).length===0)break;const c=Dw(o,e,n);if(c.length)if(a)c.forEach(l=>a.add(l));else{if(i===s.length-1)return c;a=new Set(c)}}return typeof a<"u"?a.size===e.length?e:e.filter(i=>a.has(i)):[]}function Dw(t,e,n){var r;if(t.some(yi)){const s=(r=n.root)!==null&&r!==void 0?r:ZM(e[0]),a={...n,context:e,relativeSelector:!1};return t.push(XM),wc(s,t,a,!0,e.length)}return wc(e,t,n,!1,e.length)}function e5(t,e,n={},r=1/0){if(typeof t=="function")return Mw(e,t);const[s,a]=Im(ml(t)),i=a.map(o=>wc(e,o,n,!0,r));return s.length&&i.push(Yh(e,s,n,r)),i.length===0?[]:i.length===1?i[0]:xa(i.reduce((o,u)=>[...o,...u]))}function wc(t,e,n,r,s){const a=e.findIndex(Ec),i=e.slice(0,a),o=e[a],u=e.length-1===a?s:1/0,c=YM(o.name,o.data,u);if(c===0)return[];const d=(i.length===0&&!Array.isArray(t)?hl(t).filter(Ee):i.length===0?(Array.isArray(t)?t:[t]).filter(Ee):r||i.some(yi)?Yh(t,[i],n,c):Zh(t,[i],n)).slice(0,c);let m=QM(o.name,d,o.data,n);if(m.length===0||e.length===a+1)return m;const p=e.slice(a+1),h=p.some(yi);if(h){if(yi(p[0])){const{type:g}=p[0];(g===ge.Sibling||g===ge.Adjacent)&&(m=Nw(m,fl,!0)),p.unshift(JM)}n={...n,relativeSelector:!1,rootFunc:g=>m.includes(g)}}else n.rootFunc&&n.rootFunc!==yc.trueFunc&&(n={...n,rootFunc:yc.trueFunc});return p.some(Ec)?wc(m,p,n,!1,s):h?Yh(m,[p],n,s):Zh(m,[p],n)}function Yh(t,e,n,r){const s=km(e,n,t);return Mw(t,s,r)}function Mw(t,e,n=1/0){const r=Nw(t,fl,e.shouldTestNextSiblings);return Sm(s=>Ee(s)&&e(s),r,!0,n)}function Zh(t,e,n){const r=(Array.isArray(t)?t:[t]).filter(Ee);if(r.length===0)return r;const s=km(e,n);return s===yc.trueFunc?r:r.filter(s)}const t5=/^\s*[+~]/;function n5(t){if(!t)return this._make([]);if(typeof t!="string"){const e=Ir(t)?t.toArray():[t],n=this.toArray();return this._make(e.filter(r=>n.some(s=>gw(s,r))))}return this._findBySelector(t,Number.POSITIVE_INFINITY)}function r5(t,e){var n;const r=this.toArray(),s=t5.test(t)?r:this.children().toArray(),a={context:r,root:(n=this._root)===null||n===void 0?void 0:n[0],xmlMode:this.options.xmlMode,lowerCaseTags:this.options.lowerCaseTags,lowerCaseAttributeNames:this.options.lowerCaseAttributeNames,pseudos:this.options.pseudos,quirksMode:this.options.quirksMode};return this._make(e5(t,s,a,e))}function Nm(t){return function(e,...n){return function(r){var s;let a=t(e,this);return r&&(a=xm(a,r,this.options.xmlMode,(s=this._root)===null||s===void 0?void 0:s[0])),this._make(this.length>1&&a.length>1?n.reduce((i,o)=>o(i),a):a)}}}const Co=Nm((t,e)=>{let n=[];for(let r=0;r<e.length;r++){const s=t(e[r]);s.length>0&&(n=n.concat(s))}return n}),Rm=Nm((t,e)=>{const n=[];for(let r=0;r<e.length;r++){const s=t(e[r]);s!==null&&n.push(s)}return n});function Pm(t,...e){let n=null;const r=Nm((s,a)=>{const i=[];return ct(a,o=>{for(let u;(u=s(o))&&!(n!=null&&n(u,i.length));o=u)i.push(u)}),i})(t,...e);return function(s,a){n=typeof s=="string"?o=>Rw(o,s,this.options):s?vo(s):null;const i=r.call(this,a);return n=null,i}}function La(t){return t.length>1?Array.from(new Set(t)):t}const s5=Rm(({parent:t})=>t&&!ts(t)?t:null,La),a5=Co(t=>{const e=[];for(;t.parent&&!ts(t.parent);)e.push(t.parent),t=t.parent;return e},xa,t=>t.reverse()),i5=Pm(({parent:t})=>t&&!ts(t)?t:null,xa,t=>t.reverse());function o5(t){var e;const n=[];if(!t)return this._make(n);const r={xmlMode:this.options.xmlMode,root:(e=this._root)===null||e===void 0?void 0:e[0]},s=typeof t=="string"?a=>Rw(a,t,r):vo(t);return ct(this,a=>{for(a&&!ts(a)&&!Ee(a)&&(a=a.parent);a&&Ee(a);){if(s(a,0)){n.includes(a)||n.push(a);break}a=a.parent}}),this._make(n)}const u5=Rm(t=>wm(t)),c5=Co(t=>{const e=[];for(;t.next;)t=t.next,Ee(t)&&e.push(t);return e},La),l5=Pm(t=>wm(t),La),d5=Rm(t=>Tm(t)),h5=Co(t=>{const e=[];for(;t.prev;)t=t.prev,Ee(t)&&e.push(t);return e},La),f5=Pm(t=>Tm(t),La),m5=Co(t=>lw(t).filter(e=>Ee(e)&&e!==t),xa),p5=Co(t=>hl(t).filter(Ee),La);function g5(){const t=this.toArray().reduce((e,n)=>ft(n)?e.concat(n.children):e,[]);return this._make(t)}function b5(t){let e=0;const n=this.length;for(;e<n&&t.call(this[e],e,this[e])!==!1;)++e;return this}function _5(t){let e=[];for(let n=0;n<this.length;n++){const r=this[n],s=t.call(r,n,r);s!=null&&(e=e.concat(s))}return this._make(e)}function vo(t){return typeof t=="function"?(e,n)=>t.call(e,n,e):Ir(t)?e=>Array.prototype.includes.call(t,e):function(e){return t===e}}function y5(t){var e;return this._make(xm(this.toArray(),t,this.options.xmlMode,(e=this._root)===null||e===void 0?void 0:e[0]))}function xm(t,e,n,r){return typeof e=="string"?xw(e,t,{xmlMode:n,root:r}):t.filter(vo(e))}function E5(t){const e=this.toArray();return typeof t=="string"?Pw(e.filter(Ee),t,this.options):t?e.some(vo(t)):!1}function w5(t){let e=this.toArray();if(typeof t=="string"){const n=new Set(xw(t,e,this.options));e=e.filter(r=>!n.has(r))}else{const n=vo(t);e=e.filter((r,s)=>!n(r,s))}return this._make(e)}function T5(t){return this.filter(typeof t=="string"?`:has(${t})`:(e,n)=>this._make(n).find(t).length>0)}function S5(){return this.length>1?this._make(this[0]):this}function A5(){return this.length>0?this._make(this[this.length-1]):this}function C5(t){var e;return t=+t,t===0&&this.length<=1?this:(t<0&&(t=this.length+t),this._make((e=this[t])!==null&&e!==void 0?e:[]))}function v5(t){return t==null?this.toArray():this[t<0?this.length+t:t]}function O5(){return Array.prototype.slice.call(this)}function k5(t){let e,n;return t==null?(e=this.parent().children(),n=this[0]):typeof t=="string"?(e=this._make(t),n=this[0]):(e=this,n=Ir(t)?t[0]:t),Array.prototype.indexOf.call(e,n)}function I5(t,e){return this._make(Array.prototype.slice.call(this,t,e))}function N5(){var t;return(t=this.prevObject)!==null&&t!==void 0?t:this._make([])}function R5(t,e){const n=this._make(t,e),r=xa([...this.get(),...n.get()]);return this._make(r)}function P5(t){return this.prevObject?this.add(t?this.prevObject.filter(t):this.prevObject):this}const x5=Object.freeze(Object.defineProperty({__proto__:null,_findBySelector:r5,add:R5,addBack:P5,children:p5,closest:o5,contents:g5,each:b5,end:N5,eq:C5,filter:y5,filterArray:xm,find:n5,first:S5,get:v5,has:T5,index:k5,is:E5,last:A5,map:_5,next:u5,nextAll:c5,nextUntil:l5,not:w5,parent:s5,parents:a5,parentsUntil:i5,prev:d5,prevAll:h5,prevUntil:f5,siblings:m5,slice:I5,toArray:O5},Symbol.toStringTag,{value:"Module"}));function L5(t){return function(n,r,s,a){if(typeof Buffer<"u"&&Buffer.isBuffer(n)&&(n=n.toString()),typeof n=="string")return t(n,r,s,a);const i=n;if(!Array.isArray(i)&&ts(i))return i;const o=new Is([]);return Ns(i,o),o}}function Ns(t,e){const n=Array.isArray(t)?t:[t];e?e.children=n:e=null;for(let r=0;r<n.length;r++){const s=n[r];s.parent&&s.parent.children!==n&&xs(s),e?(s.prev=n[r-1]||null,s.next=n[r+1]||null):s.prev=s.next=null,s.parent=e}return e}function D5(t,e){if(t==null)return[];if(typeof t=="string")return this._parse(t,this.options,!1,null).children.slice(0);if("length"in t){if(t.length===1)return this._makeDomArray(t[0],e);const n=[];for(let r=0;r<t.length;r++){const s=t[r];if(typeof s=="object"){if(s==null)continue;if(!("length"in s)){n.push(e?Ji(s,!0):s);continue}}n.push(...this._makeDomArray(s,e))}return n}return[e?Ji(t,!0):t]}function Bw(t){return function(...e){const n=this.length-1;return ct(this,(r,s)=>{if(!ft(r))return;const a=typeof e[0]=="function"?e[0].call(r,s,this._render(r.children)):e,i=this._makeDomArray(a,s<n);t(i,r.children,r)})}}function ns(t,e,n,r,s){var a,i;const o=[e,n,...r],u=e===0?null:t[e-1],c=e+n>=t.length?null:t[e+n];for(let l=0;l<r.length;++l){const d=r[l],m=d.parent;if(m){const h=m.children.indexOf(d);h>-1&&(m.children.splice(h,1),s===m&&e>h&&o[0]--)}d.parent=s,d.prev&&(d.prev.next=(a=d.next)!==null&&a!==void 0?a:null),d.next&&(d.next.prev=(i=d.prev)!==null&&i!==void 0?i:null),d.prev=l===0?u:r[l-1],d.next=l===r.length-1?c:r[l+1]}return u&&(u.next=r[0]),c&&(c.prev=r[r.length-1]),t.splice(...o)}function M5(t){return(Ir(t)?t:this._make(t)).append(this),this}function B5(t){return(Ir(t)?t:this._make(t)).prepend(this),this}const F5=Bw((t,e,n)=>{ns(e,e.length,0,t,n)}),U5=Bw((t,e,n)=>{ns(e,0,0,t,n)});function Fw(t){return function(e){const n=this.length-1,r=this.parents().last();for(let s=0;s<this.length;s++){const a=this[s],i=typeof e=="function"?e.call(a,s,a):typeof e=="string"&&!zh(e)?r.find(e).clone():e,[o]=this._makeDomArray(i,s<n);if(!o||!ft(o))continue;let u=o,c=0;for(;c<u.children.length;){const l=u.children[c];Ee(l)?(u=l,c=0):c++}t(a,u,[o])}return this}}const j5=Fw((t,e,n)=>{const{parent:r}=t;if(!r)return;const s=r.children,a=s.indexOf(t);Ns([t],e),ns(s,a,0,n,r)}),H5=Fw((t,e,n)=>{ft(t)&&(Ns(t.children,e),Ns(n,t))});function $5(t){return this.parent(t).not("body").each((e,n)=>{this._make(n).replaceWith(n.children)}),this}function q5(t){const e=this[0];if(e){const n=this._make(typeof t=="function"?t.call(e,0,e):t).insertBefore(e);let r;for(let a=0;a<n.length;a++)n[a].type==="tag"&&(r=n[a]);let s=0;for(;r&&s<r.children.length;){const a=r.children[s];a.type==="tag"?(r=a,s=0):s++}r&&this._make(r).append(this)}return this}function V5(...t){const e=this.length-1;return ct(this,(n,r)=>{if(!ft(n)||!n.parent)return;const s=n.parent.children,a=s.indexOf(n);if(a<0)return;const i=typeof t[0]=="function"?t[0].call(n,r,this._render(n.children)):t,o=this._makeDomArray(i,r<e);ns(s,a+1,0,o,n.parent)})}function z5(t){typeof t=="string"&&(t=this._make(t)),this.remove();const e=[];for(const n of this._makeDomArray(t)){const r=this.clone().toArray(),{parent:s}=n;if(!s)continue;const a=s.children,i=a.indexOf(n);i<0||(ns(a,i+1,0,r,s),e.push(...r))}return this._make(e)}function W5(...t){const e=this.length-1;return ct(this,(n,r)=>{if(!ft(n)||!n.parent)return;const s=n.parent.children,a=s.indexOf(n);if(a<0)return;const i=typeof t[0]=="function"?t[0].call(n,r,this._render(n.children)):t,o=this._makeDomArray(i,r<e);ns(s,a,0,o,n.parent)})}function G5(t){const e=this._make(t);this.remove();const n=[];return ct(e,r=>{const s=this.clone().toArray(),{parent:a}=r;if(!a)return;const i=a.children,o=i.indexOf(r);o<0||(ns(i,o,0,s,a),n.push(...s))}),this._make(n)}function K5(t){const e=t?this.filter(t):this;return ct(e,n=>{xs(n),n.prev=n.next=n.parent=null}),this}function Y5(t){return ct(this,(e,n)=>{const{parent:r}=e;if(!r)return;const s=r.children,a=typeof t=="function"?t.call(e,n,e):t,i=this._makeDomArray(a);Ns(i,null);const o=s.indexOf(e);ns(s,o,1,i,r),i.includes(e)||(e.parent=e.prev=e.next=null)})}function Z5(){return ct(this,t=>{if(ft(t)){for(const e of t.children)e.next=e.prev=e.parent=null;t.children.length=0}})}function J5(t){if(t===void 0){const e=this[0];return!e||!ft(e)?null:this._render(e.children)}return ct(this,e=>{if(!ft(e))return;for(const r of e.children)r.next=r.prev=r.parent=null;const n=Ir(t)?t.toArray():this._parse(`${t}`,this.options,!1,e).children;Ns(n,e)})}function X5(){return this._render(this)}function Q5(t){return t===void 0?Xi(this):typeof t=="function"?ct(this,(e,n)=>this._make(e).text(t.call(e,n,Xi([e])))):ct(this,e=>{if(!ft(e))return;for(const r of e.children)r.next=r.prev=r.parent=null;const n=new Zi(`${t}`);Ns(n,e)})}function e8(){const t=Array.prototype.map.call(this.get(),n=>Ji(n,!0)),e=new Is(t);for(const n of t)n.parent=e;return this._make(t)}const t8=Object.freeze(Object.defineProperty({__proto__:null,_makeDomArray:D5,after:V5,append:F5,appendTo:M5,before:W5,clone:e8,empty:Z5,html:J5,insertAfter:z5,insertBefore:G5,prepend:U5,prependTo:B5,remove:K5,replaceWith:Y5,text:Q5,toString:X5,unwrap:$5,wrap:j5,wrapAll:q5,wrapInner:H5},Symbol.toStringTag,{value:"Module"}));function n8(t,e){if(t!=null&&e!=null||typeof t=="object"&&!Array.isArray(t))return ct(this,(n,r)=>{Ee(n)&&Uw(n,t,e,r)});if(this.length!==0)return jw(this[0],t)}function Uw(t,e,n,r){if(typeof e=="string"){const s=jw(t),a=typeof n=="function"?n.call(t,r,s[e]):n;a===""?delete s[e]:a!=null&&(s[e]=a),t.attribs.style=r8(s)}else if(typeof e=="object"){const s=Object.keys(e);for(let a=0;a<s.length;a++){const i=s[a];Uw(t,i,e[i],a)}}}function jw(t,e){if(!t||!Ee(t))return;const n=s8(t.attribs.style);if(typeof e=="string")return n[e];if(Array.isArray(e)){const r={};for(const s of e)n[s]!=null&&(r[s]=n[s]);return r}return n}function r8(t){return Object.keys(t).reduce((e,n)=>`${e}${e?" ":""}${n}: ${t[n]};`,"")}function s8(t){if(t=(t||"").trim(),!t)return{};const e={};let n;for(const r of t.split(";")){const s=r.indexOf(":");if(s<1||s===r.length-1){const a=r.trimEnd();a.length>0&&n!==void 0&&(e[n]+=`;${a}`)}else n=r.slice(0,s).trim(),e[n]=r.slice(s+1).trim()}return e}const a8=Object.freeze(Object.defineProperty({__proto__:null,css:n8},Symbol.toStringTag,{value:"Module"})),Q0="input,select,textarea,keygen",i8=/%20/g,eb=/\r?\n/g;function o8(){return this.serializeArray().map(n=>`${encodeURIComponent(n.name)}=${encodeURIComponent(n.value)}`).join("&").replace(i8,"+")}function u8(){return this.map((t,e)=>{const n=this._make(e);return Ee(e)&&e.name==="form"?n.find(Q0).toArray():n.filter(Q0).toArray()}).filter('[name!=""]:enabled:not(:submit, :button, :image, :reset, :file):matches([checked], :not(:checkbox, :radio))').map((t,e)=>{var n;const r=this._make(e),s=r.attr("name"),a=(n=r.val())!==null&&n!==void 0?n:"";return Array.isArray(a)?a.map(i=>({name:s,value:i.replace(eb,`\r
`)})):{name:s,value:a.replace(eb,`\r
`)}}).toArray()}const c8=Object.freeze(Object.defineProperty({__proto__:null,serialize:o8,serializeArray:u8},Symbol.toStringTag,{value:"Module"}));function l8(t){var e;return typeof t=="string"?{selector:t,value:"textContent"}:{selector:t.selector,value:(e=t.value)!==null&&e!==void 0?e:"textContent"}}function d8(t){const e={};for(const n in t){const r=t[n],s=Array.isArray(r),{selector:a,value:i}=l8(s?r[0]:r),o=typeof i=="function"?i:typeof i=="string"?u=>this._make(u).prop(i):u=>this._make(u).extract(i);if(s)e[n]=this._findBySelector(a,Number.POSITIVE_INFINITY).map((u,c)=>o(c,n,e)).get();else{const u=this._findBySelector(a,1);e[n]=u.length>0?o(u[0],n,e):void 0}}return e}const h8=Object.freeze(Object.defineProperty({__proto__:null,extract:d8},Symbol.toStringTag,{value:"Module"}));class Oo{constructor(e,n,r){if(this.length=0,this.options=r,this._root=n,e){for(let s=0;s<e.length;s++)this[s]=e[s];this.length=e.length}}}Oo.prototype.cheerio="[cheerio object]";Oo.prototype.splice=Array.prototype.splice;Oo.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator];Object.assign(Oo.prototype,yM,x5,t8,a8,c8,h8);function f8(t,e){return function n(r,s,a=!0){if(r==null)throw new Error("cheerio.load() expects a string");const i=Vh(s),o=t(r,i,a,null);class u extends Oo{_make(d,m){const p=c(d,m);return p.prevObject=this,p}_parse(d,m,p,h){return t(d,m,p,h)}_render(d){return e(d,this.options)}}function c(l,d,m=o,p){if(l&&Ir(l))return l;const h=Vh(p,i),g=typeof m=="string"?[t(m,h,!1,null)]:"length"in m?m:[m],b=Ir(g)?g:new u(g,null,h);if(b._root=b,!l)return new u(void 0,b,h);const _=typeof l=="string"&&zh(l)?t(l,h,!1,null).children:m8(l)?[l]:Array.isArray(l)?l:void 0,y=new u(_,b,h);if(_)return y;if(typeof l!="string")throw new TypeError("Unexpected type of selector");let E=l;const I=d?typeof d=="string"?zh(d)?new u([t(d,h,!1,null)],b,h):(E=`${d} ${E}`,b):Ir(d)?d:new u(Array.isArray(d)?d:[d],b,h):b;return I?I.find(E):y}return Object.assign(c,oM,{load:n,_root:o,_options:i,fn:u.prototype,prototype:u.prototype}),c}}function m8(t){return!!t.name||t.type==="root"||t.type==="text"||t.type==="comment"}const p8=new Set([65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111]),at="";var A;(function(t){t[t.EOF=-1]="EOF",t[t.NULL=0]="NULL",t[t.TABULATION=9]="TABULATION",t[t.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",t[t.LINE_FEED=10]="LINE_FEED",t[t.FORM_FEED=12]="FORM_FEED",t[t.SPACE=32]="SPACE",t[t.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",t[t.QUOTATION_MARK=34]="QUOTATION_MARK",t[t.AMPERSAND=38]="AMPERSAND",t[t.APOSTROPHE=39]="APOSTROPHE",t[t.HYPHEN_MINUS=45]="HYPHEN_MINUS",t[t.SOLIDUS=47]="SOLIDUS",t[t.DIGIT_0=48]="DIGIT_0",t[t.DIGIT_9=57]="DIGIT_9",t[t.SEMICOLON=59]="SEMICOLON",t[t.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",t[t.EQUALS_SIGN=61]="EQUALS_SIGN",t[t.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",t[t.QUESTION_MARK=63]="QUESTION_MARK",t[t.LATIN_CAPITAL_A=65]="LATIN_CAPITAL_A",t[t.LATIN_CAPITAL_Z=90]="LATIN_CAPITAL_Z",t[t.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",t[t.GRAVE_ACCENT=96]="GRAVE_ACCENT",t[t.LATIN_SMALL_A=97]="LATIN_SMALL_A",t[t.LATIN_SMALL_Z=122]="LATIN_SMALL_Z"})(A||(A={}));const Zt={DASH_DASH:"--",CDATA_START:"[CDATA[",DOCTYPE:"doctype",SCRIPT:"script",PUBLIC:"public",SYSTEM:"system"};function Hw(t){return t>=55296&&t<=57343}function g8(t){return t>=56320&&t<=57343}function b8(t,e){return(t-55296)*1024+9216+e}function $w(t){return t!==32&&t!==10&&t!==13&&t!==9&&t!==12&&t>=1&&t<=31||t>=127&&t<=159}function qw(t){return t>=64976&&t<=65007||p8.has(t)}var $;(function(t){t.controlCharacterInInputStream="control-character-in-input-stream",t.noncharacterInInputStream="noncharacter-in-input-stream",t.surrogateInInputStream="surrogate-in-input-stream",t.nonVoidHtmlElementStartTagWithTrailingSolidus="non-void-html-element-start-tag-with-trailing-solidus",t.endTagWithAttributes="end-tag-with-attributes",t.endTagWithTrailingSolidus="end-tag-with-trailing-solidus",t.unexpectedSolidusInTag="unexpected-solidus-in-tag",t.unexpectedNullCharacter="unexpected-null-character",t.unexpectedQuestionMarkInsteadOfTagName="unexpected-question-mark-instead-of-tag-name",t.invalidFirstCharacterOfTagName="invalid-first-character-of-tag-name",t.unexpectedEqualsSignBeforeAttributeName="unexpected-equals-sign-before-attribute-name",t.missingEndTagName="missing-end-tag-name",t.unexpectedCharacterInAttributeName="unexpected-character-in-attribute-name",t.unknownNamedCharacterReference="unknown-named-character-reference",t.missingSemicolonAfterCharacterReference="missing-semicolon-after-character-reference",t.unexpectedCharacterAfterDoctypeSystemIdentifier="unexpected-character-after-doctype-system-identifier",t.unexpectedCharacterInUnquotedAttributeValue="unexpected-character-in-unquoted-attribute-value",t.eofBeforeTagName="eof-before-tag-name",t.eofInTag="eof-in-tag",t.missingAttributeValue="missing-attribute-value",t.missingWhitespaceBetweenAttributes="missing-whitespace-between-attributes",t.missingWhitespaceAfterDoctypePublicKeyword="missing-whitespace-after-doctype-public-keyword",t.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers="missing-whitespace-between-doctype-public-and-system-identifiers",t.missingWhitespaceAfterDoctypeSystemKeyword="missing-whitespace-after-doctype-system-keyword",t.missingQuoteBeforeDoctypePublicIdentifier="missing-quote-before-doctype-public-identifier",t.missingQuoteBeforeDoctypeSystemIdentifier="missing-quote-before-doctype-system-identifier",t.missingDoctypePublicIdentifier="missing-doctype-public-identifier",t.missingDoctypeSystemIdentifier="missing-doctype-system-identifier",t.abruptDoctypePublicIdentifier="abrupt-doctype-public-identifier",t.abruptDoctypeSystemIdentifier="abrupt-doctype-system-identifier",t.cdataInHtmlContent="cdata-in-html-content",t.incorrectlyOpenedComment="incorrectly-opened-comment",t.eofInScriptHtmlCommentLikeText="eof-in-script-html-comment-like-text",t.eofInDoctype="eof-in-doctype",t.nestedComment="nested-comment",t.abruptClosingOfEmptyComment="abrupt-closing-of-empty-comment",t.eofInComment="eof-in-comment",t.incorrectlyClosedComment="incorrectly-closed-comment",t.eofInCdata="eof-in-cdata",t.absenceOfDigitsInNumericCharacterReference="absence-of-digits-in-numeric-character-reference",t.nullCharacterReference="null-character-reference",t.surrogateCharacterReference="surrogate-character-reference",t.characterReferenceOutsideUnicodeRange="character-reference-outside-unicode-range",t.controlCharacterReference="control-character-reference",t.noncharacterCharacterReference="noncharacter-character-reference",t.missingWhitespaceBeforeDoctypeName="missing-whitespace-before-doctype-name",t.missingDoctypeName="missing-doctype-name",t.invalidCharacterSequenceAfterDoctypeName="invalid-character-sequence-after-doctype-name",t.duplicateAttribute="duplicate-attribute",t.nonConformingDoctype="non-conforming-doctype",t.missingDoctype="missing-doctype",t.misplacedDoctype="misplaced-doctype",t.endTagWithoutMatchingOpenElement="end-tag-without-matching-open-element",t.closingOfElementWithOpenChildElements="closing-of-element-with-open-child-elements",t.disallowedContentInNoscriptInHead="disallowed-content-in-noscript-in-head",t.openElementsLeftAfterEof="open-elements-left-after-eof",t.abandonedHeadElementChild="abandoned-head-element-child",t.misplacedStartTagForHeadElement="misplaced-start-tag-for-head-element",t.nestedNoscriptInHead="nested-noscript-in-head",t.eofInElementThatCanContainOnlyText="eof-in-element-that-can-contain-only-text"})($||($={}));const _8=65536;class y8{constructor(e){this.handler=e,this.html="",this.pos=-1,this.lastGapPos=-2,this.gapStack=[],this.skipNextNewLine=!1,this.lastChunkWritten=!1,this.endOfChunkHit=!1,this.bufferWaterline=_8,this.isEol=!1,this.lineStartPos=0,this.droppedBufferSize=0,this.line=1,this.lastErrOffset=-1}get col(){return this.pos-this.lineStartPos+ +(this.lastGapPos!==this.pos)}get offset(){return this.droppedBufferSize+this.pos}getError(e,n){const{line:r,col:s,offset:a}=this,i=s+n,o=a+n;return{code:e,startLine:r,endLine:r,startCol:i,endCol:i,startOffset:o,endOffset:o}}_err(e){this.handler.onParseError&&this.lastErrOffset!==this.offset&&(this.lastErrOffset=this.offset,this.handler.onParseError(this.getError(e,0)))}_addGap(){this.gapStack.push(this.lastGapPos),this.lastGapPos=this.pos}_processSurrogate(e){if(this.pos!==this.html.length-1){const n=this.html.charCodeAt(this.pos+1);if(g8(n))return this.pos++,this._addGap(),b8(e,n)}else if(!this.lastChunkWritten)return this.endOfChunkHit=!0,A.EOF;return this._err($.surrogateInInputStream),e}willDropParsedChunk(){return this.pos>this.bufferWaterline}dropParsedChunk(){this.willDropParsedChunk()&&(this.html=this.html.substring(this.pos),this.lineStartPos-=this.pos,this.droppedBufferSize+=this.pos,this.pos=0,this.lastGapPos=-2,this.gapStack.length=0)}write(e,n){this.html.length>0?this.html+=e:this.html=e,this.endOfChunkHit=!1,this.lastChunkWritten=n}insertHtmlAtCurrentPos(e){this.html=this.html.substring(0,this.pos+1)+e+this.html.substring(this.pos+1),this.endOfChunkHit=!1}startsWith(e,n){if(this.pos+e.length>this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,!1;if(n)return this.html.startsWith(e,this.pos);for(let r=0;r<e.length;r++)if((this.html.charCodeAt(this.pos+r)|32)!==e.charCodeAt(r))return!1;return!0}peek(e){const n=this.pos+e;if(n>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,A.EOF;const r=this.html.charCodeAt(n);return r===A.CARRIAGE_RETURN?A.LINE_FEED:r}advance(){if(this.pos++,this.isEol&&(this.isEol=!1,this.line++,this.lineStartPos=this.pos),this.pos>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,A.EOF;let e=this.html.charCodeAt(this.pos);return e===A.CARRIAGE_RETURN?(this.isEol=!0,this.skipNextNewLine=!0,A.LINE_FEED):e===A.LINE_FEED&&(this.isEol=!0,this.skipNextNewLine)?(this.line--,this.skipNextNewLine=!1,this._addGap(),this.advance()):(this.skipNextNewLine=!1,Hw(e)&&(e=this._processSurrogate(e)),this.handler.onParseError===null||e>31&&e<127||e===A.LINE_FEED||e===A.CARRIAGE_RETURN||e>159&&e<64976||this._checkForProblematicCharacters(e),e)}_checkForProblematicCharacters(e){$w(e)?this._err($.controlCharacterInInputStream):qw(e)&&this._err($.noncharacterInInputStream)}retreat(e){for(this.pos-=e;this.pos<this.lastGapPos;)this.lastGapPos=this.gapStack.pop(),this.pos--;this.isEol=!1}}var He;(function(t){t[t.CHARACTER=0]="CHARACTER",t[t.NULL_CHARACTER=1]="NULL_CHARACTER",t[t.WHITESPACE_CHARACTER=2]="WHITESPACE_CHARACTER",t[t.START_TAG=3]="START_TAG",t[t.END_TAG=4]="END_TAG",t[t.COMMENT=5]="COMMENT",t[t.DOCTYPE=6]="DOCTYPE",t[t.EOF=7]="EOF",t[t.HIBERNATION=8]="HIBERNATION"})(He||(He={}));function Vw(t,e){for(let n=t.attrs.length-1;n>=0;n--)if(t.attrs[n].name===e)return t.attrs[n].value;return null}var Y;(function(t){t.HTML="http://www.w3.org/1999/xhtml",t.MATHML="http://www.w3.org/1998/Math/MathML",t.SVG="http://www.w3.org/2000/svg",t.XLINK="http://www.w3.org/1999/xlink",t.XML="http://www.w3.org/XML/1998/namespace",t.XMLNS="http://www.w3.org/2000/xmlns/"})(Y||(Y={}));var ys;(function(t){t.TYPE="type",t.ACTION="action",t.ENCODING="encoding",t.PROMPT="prompt",t.NAME="name",t.COLOR="color",t.FACE="face",t.SIZE="size"})(ys||(ys={}));var fn;(function(t){t.NO_QUIRKS="no-quirks",t.QUIRKS="quirks",t.LIMITED_QUIRKS="limited-quirks"})(fn||(fn={}));var L;(function(t){t.A="a",t.ADDRESS="address",t.ANNOTATION_XML="annotation-xml",t.APPLET="applet",t.AREA="area",t.ARTICLE="article",t.ASIDE="aside",t.B="b",t.BASE="base",t.BASEFONT="basefont",t.BGSOUND="bgsound",t.BIG="big",t.BLOCKQUOTE="blockquote",t.BODY="body",t.BR="br",t.BUTTON="button",t.CAPTION="caption",t.CENTER="center",t.CODE="code",t.COL="col",t.COLGROUP="colgroup",t.DD="dd",t.DESC="desc",t.DETAILS="details",t.DIALOG="dialog",t.DIR="dir",t.DIV="div",t.DL="dl",t.DT="dt",t.EM="em",t.EMBED="embed",t.FIELDSET="fieldset",t.FIGCAPTION="figcaption",t.FIGURE="figure",t.FONT="font",t.FOOTER="footer",t.FOREIGN_OBJECT="foreignObject",t.FORM="form",t.FRAME="frame",t.FRAMESET="frameset",t.H1="h1",t.H2="h2",t.H3="h3",t.H4="h4",t.H5="h5",t.H6="h6",t.HEAD="head",t.HEADER="header",t.HGROUP="hgroup",t.HR="hr",t.HTML="html",t.I="i",t.IMG="img",t.IMAGE="image",t.INPUT="input",t.IFRAME="iframe",t.KEYGEN="keygen",t.LABEL="label",t.LI="li",t.LINK="link",t.LISTING="listing",t.MAIN="main",t.MALIGNMARK="malignmark",t.MARQUEE="marquee",t.MATH="math",t.MENU="menu",t.META="meta",t.MGLYPH="mglyph",t.MI="mi",t.MO="mo",t.MN="mn",t.MS="ms",t.MTEXT="mtext",t.NAV="nav",t.NOBR="nobr",t.NOFRAMES="noframes",t.NOEMBED="noembed",t.NOSCRIPT="noscript",t.OBJECT="object",t.OL="ol",t.OPTGROUP="optgroup",t.OPTION="option",t.P="p",t.PARAM="param",t.PLAINTEXT="plaintext",t.PRE="pre",t.RB="rb",t.RP="rp",t.RT="rt",t.RTC="rtc",t.RUBY="ruby",t.S="s",t.SCRIPT="script",t.SEARCH="search",t.SECTION="section",t.SELECT="select",t.SOURCE="source",t.SMALL="small",t.SPAN="span",t.STRIKE="strike",t.STRONG="strong",t.STYLE="style",t.SUB="sub",t.SUMMARY="summary",t.SUP="sup",t.TABLE="table",t.TBODY="tbody",t.TEMPLATE="template",t.TEXTAREA="textarea",t.TFOOT="tfoot",t.TD="td",t.TH="th",t.THEAD="thead",t.TITLE="title",t.TR="tr",t.TRACK="track",t.TT="tt",t.U="u",t.UL="ul",t.SVG="svg",t.VAR="var",t.WBR="wbr",t.XMP="xmp"})(L||(L={}));var f;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.A=1]="A",t[t.ADDRESS=2]="ADDRESS",t[t.ANNOTATION_XML=3]="ANNOTATION_XML",t[t.APPLET=4]="APPLET",t[t.AREA=5]="AREA",t[t.ARTICLE=6]="ARTICLE",t[t.ASIDE=7]="ASIDE",t[t.B=8]="B",t[t.BASE=9]="BASE",t[t.BASEFONT=10]="BASEFONT",t[t.BGSOUND=11]="BGSOUND",t[t.BIG=12]="BIG",t[t.BLOCKQUOTE=13]="BLOCKQUOTE",t[t.BODY=14]="BODY",t[t.BR=15]="BR",t[t.BUTTON=16]="BUTTON",t[t.CAPTION=17]="CAPTION",t[t.CENTER=18]="CENTER",t[t.CODE=19]="CODE",t[t.COL=20]="COL",t[t.COLGROUP=21]="COLGROUP",t[t.DD=22]="DD",t[t.DESC=23]="DESC",t[t.DETAILS=24]="DETAILS",t[t.DIALOG=25]="DIALOG",t[t.DIR=26]="DIR",t[t.DIV=27]="DIV",t[t.DL=28]="DL",t[t.DT=29]="DT",t[t.EM=30]="EM",t[t.EMBED=31]="EMBED",t[t.FIELDSET=32]="FIELDSET",t[t.FIGCAPTION=33]="FIGCAPTION",t[t.FIGURE=34]="FIGURE",t[t.FONT=35]="FONT",t[t.FOOTER=36]="FOOTER",t[t.FOREIGN_OBJECT=37]="FOREIGN_OBJECT",t[t.FORM=38]="FORM",t[t.FRAME=39]="FRAME",t[t.FRAMESET=40]="FRAMESET",t[t.H1=41]="H1",t[t.H2=42]="H2",t[t.H3=43]="H3",t[t.H4=44]="H4",t[t.H5=45]="H5",t[t.H6=46]="H6",t[t.HEAD=47]="HEAD",t[t.HEADER=48]="HEADER",t[t.HGROUP=49]="HGROUP",t[t.HR=50]="HR",t[t.HTML=51]="HTML",t[t.I=52]="I",t[t.IMG=53]="IMG",t[t.IMAGE=54]="IMAGE",t[t.INPUT=55]="INPUT",t[t.IFRAME=56]="IFRAME",t[t.KEYGEN=57]="KEYGEN",t[t.LABEL=58]="LABEL",t[t.LI=59]="LI",t[t.LINK=60]="LINK",t[t.LISTING=61]="LISTING",t[t.MAIN=62]="MAIN",t[t.MALIGNMARK=63]="MALIGNMARK",t[t.MARQUEE=64]="MARQUEE",t[t.MATH=65]="MATH",t[t.MENU=66]="MENU",t[t.META=67]="META",t[t.MGLYPH=68]="MGLYPH",t[t.MI=69]="MI",t[t.MO=70]="MO",t[t.MN=71]="MN",t[t.MS=72]="MS",t[t.MTEXT=73]="MTEXT",t[t.NAV=74]="NAV",t[t.NOBR=75]="NOBR",t[t.NOFRAMES=76]="NOFRAMES",t[t.NOEMBED=77]="NOEMBED",t[t.NOSCRIPT=78]="NOSCRIPT",t[t.OBJECT=79]="OBJECT",t[t.OL=80]="OL",t[t.OPTGROUP=81]="OPTGROUP",t[t.OPTION=82]="OPTION",t[t.P=83]="P",t[t.PARAM=84]="PARAM",t[t.PLAINTEXT=85]="PLAINTEXT",t[t.PRE=86]="PRE",t[t.RB=87]="RB",t[t.RP=88]="RP",t[t.RT=89]="RT",t[t.RTC=90]="RTC",t[t.RUBY=91]="RUBY",t[t.S=92]="S",t[t.SCRIPT=93]="SCRIPT",t[t.SEARCH=94]="SEARCH",t[t.SECTION=95]="SECTION",t[t.SELECT=96]="SELECT",t[t.SOURCE=97]="SOURCE",t[t.SMALL=98]="SMALL",t[t.SPAN=99]="SPAN",t[t.STRIKE=100]="STRIKE",t[t.STRONG=101]="STRONG",t[t.STYLE=102]="STYLE",t[t.SUB=103]="SUB",t[t.SUMMARY=104]="SUMMARY",t[t.SUP=105]="SUP",t[t.TABLE=106]="TABLE",t[t.TBODY=107]="TBODY",t[t.TEMPLATE=108]="TEMPLATE",t[t.TEXTAREA=109]="TEXTAREA",t[t.TFOOT=110]="TFOOT",t[t.TD=111]="TD",t[t.TH=112]="TH",t[t.THEAD=113]="THEAD",t[t.TITLE=114]="TITLE",t[t.TR=115]="TR",t[t.TRACK=116]="TRACK",t[t.TT=117]="TT",t[t.U=118]="U",t[t.UL=119]="UL",t[t.SVG=120]="SVG",t[t.VAR=121]="VAR",t[t.WBR=122]="WBR",t[t.XMP=123]="XMP"})(f||(f={}));const E8=new Map([[L.A,f.A],[L.ADDRESS,f.ADDRESS],[L.ANNOTATION_XML,f.ANNOTATION_XML],[L.APPLET,f.APPLET],[L.AREA,f.AREA],[L.ARTICLE,f.ARTICLE],[L.ASIDE,f.ASIDE],[L.B,f.B],[L.BASE,f.BASE],[L.BASEFONT,f.BASEFONT],[L.BGSOUND,f.BGSOUND],[L.BIG,f.BIG],[L.BLOCKQUOTE,f.BLOCKQUOTE],[L.BODY,f.BODY],[L.BR,f.BR],[L.BUTTON,f.BUTTON],[L.CAPTION,f.CAPTION],[L.CENTER,f.CENTER],[L.CODE,f.CODE],[L.COL,f.COL],[L.COLGROUP,f.COLGROUP],[L.DD,f.DD],[L.DESC,f.DESC],[L.DETAILS,f.DETAILS],[L.DIALOG,f.DIALOG],[L.DIR,f.DIR],[L.DIV,f.DIV],[L.DL,f.DL],[L.DT,f.DT],[L.EM,f.EM],[L.EMBED,f.EMBED],[L.FIELDSET,f.FIELDSET],[L.FIGCAPTION,f.FIGCAPTION],[L.FIGURE,f.FIGURE],[L.FONT,f.FONT],[L.FOOTER,f.FOOTER],[L.FOREIGN_OBJECT,f.FOREIGN_OBJECT],[L.FORM,f.FORM],[L.FRAME,f.FRAME],[L.FRAMESET,f.FRAMESET],[L.H1,f.H1],[L.H2,f.H2],[L.H3,f.H3],[L.H4,f.H4],[L.H5,f.H5],[L.H6,f.H6],[L.HEAD,f.HEAD],[L.HEADER,f.HEADER],[L.HGROUP,f.HGROUP],[L.HR,f.HR],[L.HTML,f.HTML],[L.I,f.I],[L.IMG,f.IMG],[L.IMAGE,f.IMAGE],[L.INPUT,f.INPUT],[L.IFRAME,f.IFRAME],[L.KEYGEN,f.KEYGEN],[L.LABEL,f.LABEL],[L.LI,f.LI],[L.LINK,f.LINK],[L.LISTING,f.LISTING],[L.MAIN,f.MAIN],[L.MALIGNMARK,f.MALIGNMARK],[L.MARQUEE,f.MARQUEE],[L.MATH,f.MATH],[L.MENU,f.MENU],[L.META,f.META],[L.MGLYPH,f.MGLYPH],[L.MI,f.MI],[L.MO,f.MO],[L.MN,f.MN],[L.MS,f.MS],[L.MTEXT,f.MTEXT],[L.NAV,f.NAV],[L.NOBR,f.NOBR],[L.NOFRAMES,f.NOFRAMES],[L.NOEMBED,f.NOEMBED],[L.NOSCRIPT,f.NOSCRIPT],[L.OBJECT,f.OBJECT],[L.OL,f.OL],[L.OPTGROUP,f.OPTGROUP],[L.OPTION,f.OPTION],[L.P,f.P],[L.PARAM,f.PARAM],[L.PLAINTEXT,f.PLAINTEXT],[L.PRE,f.PRE],[L.RB,f.RB],[L.RP,f.RP],[L.RT,f.RT],[L.RTC,f.RTC],[L.RUBY,f.RUBY],[L.S,f.S],[L.SCRIPT,f.SCRIPT],[L.SEARCH,f.SEARCH],[L.SECTION,f.SECTION],[L.SELECT,f.SELECT],[L.SOURCE,f.SOURCE],[L.SMALL,f.SMALL],[L.SPAN,f.SPAN],[L.STRIKE,f.STRIKE],[L.STRONG,f.STRONG],[L.STYLE,f.STYLE],[L.SUB,f.SUB],[L.SUMMARY,f.SUMMARY],[L.SUP,f.SUP],[L.TABLE,f.TABLE],[L.TBODY,f.TBODY],[L.TEMPLATE,f.TEMPLATE],[L.TEXTAREA,f.TEXTAREA],[L.TFOOT,f.TFOOT],[L.TD,f.TD],[L.TH,f.TH],[L.THEAD,f.THEAD],[L.TITLE,f.TITLE],[L.TR,f.TR],[L.TRACK,f.TRACK],[L.TT,f.TT],[L.U,f.U],[L.UL,f.UL],[L.SVG,f.SVG],[L.VAR,f.VAR],[L.WBR,f.WBR],[L.XMP,f.XMP]]);function pl(t){var e;return(e=E8.get(t))!==null&&e!==void 0?e:f.UNKNOWN}const X=f,w8={[Y.HTML]:new Set([X.ADDRESS,X.APPLET,X.AREA,X.ARTICLE,X.ASIDE,X.BASE,X.BASEFONT,X.BGSOUND,X.BLOCKQUOTE,X.BODY,X.BR,X.BUTTON,X.CAPTION,X.CENTER,X.COL,X.COLGROUP,X.DD,X.DETAILS,X.DIR,X.DIV,X.DL,X.DT,X.EMBED,X.FIELDSET,X.FIGCAPTION,X.FIGURE,X.FOOTER,X.FORM,X.FRAME,X.FRAMESET,X.H1,X.H2,X.H3,X.H4,X.H5,X.H6,X.HEAD,X.HEADER,X.HGROUP,X.HR,X.HTML,X.IFRAME,X.IMG,X.INPUT,X.LI,X.LINK,X.LISTING,X.MAIN,X.MARQUEE,X.MENU,X.META,X.NAV,X.NOEMBED,X.NOFRAMES,X.NOSCRIPT,X.OBJECT,X.OL,X.P,X.PARAM,X.PLAINTEXT,X.PRE,X.SCRIPT,X.SECTION,X.SELECT,X.SOURCE,X.STYLE,X.SUMMARY,X.TABLE,X.TBODY,X.TD,X.TEMPLATE,X.TEXTAREA,X.TFOOT,X.TH,X.THEAD,X.TITLE,X.TR,X.TRACK,X.UL,X.WBR,X.XMP]),[Y.MATHML]:new Set([X.MI,X.MO,X.MN,X.MS,X.MTEXT,X.ANNOTATION_XML]),[Y.SVG]:new Set([X.TITLE,X.FOREIGN_OBJECT,X.DESC]),[Y.XLINK]:new Set,[Y.XML]:new Set,[Y.XMLNS]:new Set},Jh=new Set([X.H1,X.H2,X.H3,X.H4,X.H5,X.H6]),T8=new Set([L.STYLE,L.SCRIPT,L.XMP,L.IFRAME,L.NOEMBED,L.NOFRAMES,L.PLAINTEXT]);function S8(t,e){return T8.has(t)||e&&t===L.NOSCRIPT}var C;(function(t){t[t.DATA=0]="DATA",t[t.RCDATA=1]="RCDATA",t[t.RAWTEXT=2]="RAWTEXT",t[t.SCRIPT_DATA=3]="SCRIPT_DATA",t[t.PLAINTEXT=4]="PLAINTEXT",t[t.TAG_OPEN=5]="TAG_OPEN",t[t.END_TAG_OPEN=6]="END_TAG_OPEN",t[t.TAG_NAME=7]="TAG_NAME",t[t.RCDATA_LESS_THAN_SIGN=8]="RCDATA_LESS_THAN_SIGN",t[t.RCDATA_END_TAG_OPEN=9]="RCDATA_END_TAG_OPEN",t[t.RCDATA_END_TAG_NAME=10]="RCDATA_END_TAG_NAME",t[t.RAWTEXT_LESS_THAN_SIGN=11]="RAWTEXT_LESS_THAN_SIGN",t[t.RAWTEXT_END_TAG_OPEN=12]="RAWTEXT_END_TAG_OPEN",t[t.RAWTEXT_END_TAG_NAME=13]="RAWTEXT_END_TAG_NAME",t[t.SCRIPT_DATA_LESS_THAN_SIGN=14]="SCRIPT_DATA_LESS_THAN_SIGN",t[t.SCRIPT_DATA_END_TAG_OPEN=15]="SCRIPT_DATA_END_TAG_OPEN",t[t.SCRIPT_DATA_END_TAG_NAME=16]="SCRIPT_DATA_END_TAG_NAME",t[t.SCRIPT_DATA_ESCAPE_START=17]="SCRIPT_DATA_ESCAPE_START",t[t.SCRIPT_DATA_ESCAPE_START_DASH=18]="SCRIPT_DATA_ESCAPE_START_DASH",t[t.SCRIPT_DATA_ESCAPED=19]="SCRIPT_DATA_ESCAPED",t[t.SCRIPT_DATA_ESCAPED_DASH=20]="SCRIPT_DATA_ESCAPED_DASH",t[t.SCRIPT_DATA_ESCAPED_DASH_DASH=21]="SCRIPT_DATA_ESCAPED_DASH_DASH",t[t.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN=22]="SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN",t[t.SCRIPT_DATA_ESCAPED_END_TAG_OPEN=23]="SCRIPT_DATA_ESCAPED_END_TAG_OPEN",t[t.SCRIPT_DATA_ESCAPED_END_TAG_NAME=24]="SCRIPT_DATA_ESCAPED_END_TAG_NAME",t[t.SCRIPT_DATA_DOUBLE_ESCAPE_START=25]="SCRIPT_DATA_DOUBLE_ESCAPE_START",t[t.SCRIPT_DATA_DOUBLE_ESCAPED=26]="SCRIPT_DATA_DOUBLE_ESCAPED",t[t.SCRIPT_DATA_DOUBLE_ESCAPED_DASH=27]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH",t[t.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH=28]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH",t[t.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN=29]="SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN",t[t.SCRIPT_DATA_DOUBLE_ESCAPE_END=30]="SCRIPT_DATA_DOUBLE_ESCAPE_END",t[t.BEFORE_ATTRIBUTE_NAME=31]="BEFORE_ATTRIBUTE_NAME",t[t.ATTRIBUTE_NAME=32]="ATTRIBUTE_NAME",t[t.AFTER_ATTRIBUTE_NAME=33]="AFTER_ATTRIBUTE_NAME",t[t.BEFORE_ATTRIBUTE_VALUE=34]="BEFORE_ATTRIBUTE_VALUE",t[t.ATTRIBUTE_VALUE_DOUBLE_QUOTED=35]="ATTRIBUTE_VALUE_DOUBLE_QUOTED",t[t.ATTRIBUTE_VALUE_SINGLE_QUOTED=36]="ATTRIBUTE_VALUE_SINGLE_QUOTED",t[t.ATTRIBUTE_VALUE_UNQUOTED=37]="ATTRIBUTE_VALUE_UNQUOTED",t[t.AFTER_ATTRIBUTE_VALUE_QUOTED=38]="AFTER_ATTRIBUTE_VALUE_QUOTED",t[t.SELF_CLOSING_START_TAG=39]="SELF_CLOSING_START_TAG",t[t.BOGUS_COMMENT=40]="BOGUS_COMMENT",t[t.MARKUP_DECLARATION_OPEN=41]="MARKUP_DECLARATION_OPEN",t[t.COMMENT_START=42]="COMMENT_START",t[t.COMMENT_START_DASH=43]="COMMENT_START_DASH",t[t.COMMENT=44]="COMMENT",t[t.COMMENT_LESS_THAN_SIGN=45]="COMMENT_LESS_THAN_SIGN",t[t.COMMENT_LESS_THAN_SIGN_BANG=46]="COMMENT_LESS_THAN_SIGN_BANG",t[t.COMMENT_LESS_THAN_SIGN_BANG_DASH=47]="COMMENT_LESS_THAN_SIGN_BANG_DASH",t[t.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH=48]="COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH",t[t.COMMENT_END_DASH=49]="COMMENT_END_DASH",t[t.COMMENT_END=50]="COMMENT_END",t[t.COMMENT_END_BANG=51]="COMMENT_END_BANG",t[t.DOCTYPE=52]="DOCTYPE",t[t.BEFORE_DOCTYPE_NAME=53]="BEFORE_DOCTYPE_NAME",t[t.DOCTYPE_NAME=54]="DOCTYPE_NAME",t[t.AFTER_DOCTYPE_NAME=55]="AFTER_DOCTYPE_NAME",t[t.AFTER_DOCTYPE_PUBLIC_KEYWORD=56]="AFTER_DOCTYPE_PUBLIC_KEYWORD",t[t.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER=57]="BEFORE_DOCTYPE_PUBLIC_IDENTIFIER",t[t.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED=58]="DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED",t[t.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED=59]="DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED",t[t.AFTER_DOCTYPE_PUBLIC_IDENTIFIER=60]="AFTER_DOCTYPE_PUBLIC_IDENTIFIER",t[t.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS=61]="BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS",t[t.AFTER_DOCTYPE_SYSTEM_KEYWORD=62]="AFTER_DOCTYPE_SYSTEM_KEYWORD",t[t.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER=63]="BEFORE_DOCTYPE_SYSTEM_IDENTIFIER",t[t.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED=64]="DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED",t[t.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED=65]="DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED",t[t.AFTER_DOCTYPE_SYSTEM_IDENTIFIER=66]="AFTER_DOCTYPE_SYSTEM_IDENTIFIER",t[t.BOGUS_DOCTYPE=67]="BOGUS_DOCTYPE",t[t.CDATA_SECTION=68]="CDATA_SECTION",t[t.CDATA_SECTION_BRACKET=69]="CDATA_SECTION_BRACKET",t[t.CDATA_SECTION_END=70]="CDATA_SECTION_END",t[t.CHARACTER_REFERENCE=71]="CHARACTER_REFERENCE",t[t.AMBIGUOUS_AMPERSAND=72]="AMBIGUOUS_AMPERSAND"})(C||(C={}));const tn={DATA:C.DATA,RCDATA:C.RCDATA,RAWTEXT:C.RAWTEXT,SCRIPT_DATA:C.SCRIPT_DATA,PLAINTEXT:C.PLAINTEXT,CDATA_SECTION:C.CDATA_SECTION};function A8(t){return t>=A.DIGIT_0&&t<=A.DIGIT_9}function ci(t){return t>=A.LATIN_CAPITAL_A&&t<=A.LATIN_CAPITAL_Z}function C8(t){return t>=A.LATIN_SMALL_A&&t<=A.LATIN_SMALL_Z}function Ur(t){return C8(t)||ci(t)}function tb(t){return Ur(t)||A8(t)}function fu(t){return t+32}function zw(t){return t===A.SPACE||t===A.LINE_FEED||t===A.TABULATION||t===A.FORM_FEED}function nb(t){return zw(t)||t===A.SOLIDUS||t===A.GREATER_THAN_SIGN}function v8(t){return t===A.NULL?$.nullCharacterReference:t>1114111?$.characterReferenceOutsideUnicodeRange:Hw(t)?$.surrogateCharacterReference:qw(t)?$.noncharacterCharacterReference:$w(t)||t===A.CARRIAGE_RETURN?$.controlCharacterReference:null}let O8=class{constructor(e,n){this.options=e,this.handler=n,this.paused=!1,this.inLoop=!1,this.inForeignNode=!1,this.lastStartTagName="",this.active=!1,this.state=C.DATA,this.returnState=C.DATA,this.entityStartPos=0,this.consumedAfterSnapshot=-1,this.currentCharacterToken=null,this.currentToken=null,this.currentAttr={name:"",value:""},this.preprocessor=new y8(n),this.currentLocation=this.getCurrentLocation(-1),this.entityDecoder=new Em(ym,(r,s)=>{this.preprocessor.pos=this.entityStartPos+s-1,this._flushCodePointConsumedAsCharacterReference(r)},n.onParseError?{missingSemicolonAfterCharacterReference:()=>{this._err($.missingSemicolonAfterCharacterReference,1)},absenceOfDigitsInNumericCharacterReference:r=>{this._err($.absenceOfDigitsInNumericCharacterReference,this.entityStartPos-this.preprocessor.pos+r)},validateNumericCharacterReference:r=>{const s=v8(r);s&&this._err(s,1)}}:void 0)}_err(e,n=0){var r,s;(s=(r=this.handler).onParseError)===null||s===void 0||s.call(r,this.preprocessor.getError(e,n))}getCurrentLocation(e){return this.options.sourceCodeLocationInfo?{startLine:this.preprocessor.line,startCol:this.preprocessor.col-e,startOffset:this.preprocessor.offset-e,endLine:-1,endCol:-1,endOffset:-1}:null}_runParsingLoop(){if(!this.inLoop){for(this.inLoop=!0;this.active&&!this.paused;){this.consumedAfterSnapshot=0;const e=this._consume();this._ensureHibernation()||this._callState(e)}this.inLoop=!1}}pause(){this.paused=!0}resume(e){if(!this.paused)throw new Error("Parser was already resumed");this.paused=!1,!this.inLoop&&(this._runParsingLoop(),this.paused||e==null||e())}write(e,n,r){this.active=!0,this.preprocessor.write(e,n),this._runParsingLoop(),this.paused||r==null||r()}insertHtmlAtCurrentPos(e){this.active=!0,this.preprocessor.insertHtmlAtCurrentPos(e),this._runParsingLoop()}_ensureHibernation(){return this.preprocessor.endOfChunkHit?(this.preprocessor.retreat(this.consumedAfterSnapshot),this.consumedAfterSnapshot=0,this.active=!1,!0):!1}_consume(){return this.consumedAfterSnapshot++,this.preprocessor.advance()}_advanceBy(e){this.consumedAfterSnapshot+=e;for(let n=0;n<e;n++)this.preprocessor.advance()}_consumeSequenceIfMatch(e,n){return this.preprocessor.startsWith(e,n)?(this._advanceBy(e.length-1),!0):!1}_createStartTagToken(){this.currentToken={type:He.START_TAG,tagName:"",tagID:f.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(1)}}_createEndTagToken(){this.currentToken={type:He.END_TAG,tagName:"",tagID:f.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(2)}}_createCommentToken(e){this.currentToken={type:He.COMMENT,data:"",location:this.getCurrentLocation(e)}}_createDoctypeToken(e){this.currentToken={type:He.DOCTYPE,name:e,forceQuirks:!1,publicId:null,systemId:null,location:this.currentLocation}}_createCharacterToken(e,n){this.currentCharacterToken={type:e,chars:n,location:this.currentLocation}}_createAttr(e){this.currentAttr={name:e,value:""},this.currentLocation=this.getCurrentLocation(0)}_leaveAttrName(){var e,n;const r=this.currentToken;if(Vw(r,this.currentAttr.name)===null){if(r.attrs.push(this.currentAttr),r.location&&this.currentLocation){const s=(e=(n=r.location).attrs)!==null&&e!==void 0?e:n.attrs=Object.create(null);s[this.currentAttr.name]=this.currentLocation,this._leaveAttrValue()}}else this._err($.duplicateAttribute)}_leaveAttrValue(){this.currentLocation&&(this.currentLocation.endLine=this.preprocessor.line,this.currentLocation.endCol=this.preprocessor.col,this.currentLocation.endOffset=this.preprocessor.offset)}prepareToken(e){this._emitCurrentCharacterToken(e.location),this.currentToken=null,e.location&&(e.location.endLine=this.preprocessor.line,e.location.endCol=this.preprocessor.col+1,e.location.endOffset=this.preprocessor.offset+1),this.currentLocation=this.getCurrentLocation(-1)}emitCurrentTagToken(){const e=this.currentToken;this.prepareToken(e),e.tagID=pl(e.tagName),e.type===He.START_TAG?(this.lastStartTagName=e.tagName,this.handler.onStartTag(e)):(e.attrs.length>0&&this._err($.endTagWithAttributes),e.selfClosing&&this._err($.endTagWithTrailingSolidus),this.handler.onEndTag(e)),this.preprocessor.dropParsedChunk()}emitCurrentComment(e){this.prepareToken(e),this.handler.onComment(e),this.preprocessor.dropParsedChunk()}emitCurrentDoctype(e){this.prepareToken(e),this.handler.onDoctype(e),this.preprocessor.dropParsedChunk()}_emitCurrentCharacterToken(e){if(this.currentCharacterToken){switch(e&&this.currentCharacterToken.location&&(this.currentCharacterToken.location.endLine=e.startLine,this.currentCharacterToken.location.endCol=e.startCol,this.currentCharacterToken.location.endOffset=e.startOffset),this.currentCharacterToken.type){case He.CHARACTER:{this.handler.onCharacter(this.currentCharacterToken);break}case He.NULL_CHARACTER:{this.handler.onNullCharacter(this.currentCharacterToken);break}case He.WHITESPACE_CHARACTER:{this.handler.onWhitespaceCharacter(this.currentCharacterToken);break}}this.currentCharacterToken=null}}_emitEOFToken(){const e=this.getCurrentLocation(0);e&&(e.endLine=e.startLine,e.endCol=e.startCol,e.endOffset=e.startOffset),this._emitCurrentCharacterToken(e),this.handler.onEof({type:He.EOF,location:e}),this.active=!1}_appendCharToCurrentCharacterToken(e,n){if(this.currentCharacterToken)if(this.currentCharacterToken.type===e){this.currentCharacterToken.chars+=n;return}else this.currentLocation=this.getCurrentLocation(0),this._emitCurrentCharacterToken(this.currentLocation),this.preprocessor.dropParsedChunk();this._createCharacterToken(e,n)}_emitCodePoint(e){const n=zw(e)?He.WHITESPACE_CHARACTER:e===A.NULL?He.NULL_CHARACTER:He.CHARACTER;this._appendCharToCurrentCharacterToken(n,String.fromCodePoint(e))}_emitChars(e){this._appendCharToCurrentCharacterToken(He.CHARACTER,e)}_startCharacterReference(){this.returnState=this.state,this.state=C.CHARACTER_REFERENCE,this.entityStartPos=this.preprocessor.pos,this.entityDecoder.startEntity(this._isCharacterReferenceInAttribute()?vn.Attribute:vn.Legacy)}_isCharacterReferenceInAttribute(){return this.returnState===C.ATTRIBUTE_VALUE_DOUBLE_QUOTED||this.returnState===C.ATTRIBUTE_VALUE_SINGLE_QUOTED||this.returnState===C.ATTRIBUTE_VALUE_UNQUOTED}_flushCodePointConsumedAsCharacterReference(e){this._isCharacterReferenceInAttribute()?this.currentAttr.value+=String.fromCodePoint(e):this._emitCodePoint(e)}_callState(e){switch(this.state){case C.DATA:{this._stateData(e);break}case C.RCDATA:{this._stateRcdata(e);break}case C.RAWTEXT:{this._stateRawtext(e);break}case C.SCRIPT_DATA:{this._stateScriptData(e);break}case C.PLAINTEXT:{this._statePlaintext(e);break}case C.TAG_OPEN:{this._stateTagOpen(e);break}case C.END_TAG_OPEN:{this._stateEndTagOpen(e);break}case C.TAG_NAME:{this._stateTagName(e);break}case C.RCDATA_LESS_THAN_SIGN:{this._stateRcdataLessThanSign(e);break}case C.RCDATA_END_TAG_OPEN:{this._stateRcdataEndTagOpen(e);break}case C.RCDATA_END_TAG_NAME:{this._stateRcdataEndTagName(e);break}case C.RAWTEXT_LESS_THAN_SIGN:{this._stateRawtextLessThanSign(e);break}case C.RAWTEXT_END_TAG_OPEN:{this._stateRawtextEndTagOpen(e);break}case C.RAWTEXT_END_TAG_NAME:{this._stateRawtextEndTagName(e);break}case C.SCRIPT_DATA_LESS_THAN_SIGN:{this._stateScriptDataLessThanSign(e);break}case C.SCRIPT_DATA_END_TAG_OPEN:{this._stateScriptDataEndTagOpen(e);break}case C.SCRIPT_DATA_END_TAG_NAME:{this._stateScriptDataEndTagName(e);break}case C.SCRIPT_DATA_ESCAPE_START:{this._stateScriptDataEscapeStart(e);break}case C.SCRIPT_DATA_ESCAPE_START_DASH:{this._stateScriptDataEscapeStartDash(e);break}case C.SCRIPT_DATA_ESCAPED:{this._stateScriptDataEscaped(e);break}case C.SCRIPT_DATA_ESCAPED_DASH:{this._stateScriptDataEscapedDash(e);break}case C.SCRIPT_DATA_ESCAPED_DASH_DASH:{this._stateScriptDataEscapedDashDash(e);break}case C.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataEscapedLessThanSign(e);break}case C.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:{this._stateScriptDataEscapedEndTagOpen(e);break}case C.SCRIPT_DATA_ESCAPED_END_TAG_NAME:{this._stateScriptDataEscapedEndTagName(e);break}case C.SCRIPT_DATA_DOUBLE_ESCAPE_START:{this._stateScriptDataDoubleEscapeStart(e);break}case C.SCRIPT_DATA_DOUBLE_ESCAPED:{this._stateScriptDataDoubleEscaped(e);break}case C.SCRIPT_DATA_DOUBLE_ESCAPED_DASH:{this._stateScriptDataDoubleEscapedDash(e);break}case C.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH:{this._stateScriptDataDoubleEscapedDashDash(e);break}case C.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataDoubleEscapedLessThanSign(e);break}case C.SCRIPT_DATA_DOUBLE_ESCAPE_END:{this._stateScriptDataDoubleEscapeEnd(e);break}case C.BEFORE_ATTRIBUTE_NAME:{this._stateBeforeAttributeName(e);break}case C.ATTRIBUTE_NAME:{this._stateAttributeName(e);break}case C.AFTER_ATTRIBUTE_NAME:{this._stateAfterAttributeName(e);break}case C.BEFORE_ATTRIBUTE_VALUE:{this._stateBeforeAttributeValue(e);break}case C.ATTRIBUTE_VALUE_DOUBLE_QUOTED:{this._stateAttributeValueDoubleQuoted(e);break}case C.ATTRIBUTE_VALUE_SINGLE_QUOTED:{this._stateAttributeValueSingleQuoted(e);break}case C.ATTRIBUTE_VALUE_UNQUOTED:{this._stateAttributeValueUnquoted(e);break}case C.AFTER_ATTRIBUTE_VALUE_QUOTED:{this._stateAfterAttributeValueQuoted(e);break}case C.SELF_CLOSING_START_TAG:{this._stateSelfClosingStartTag(e);break}case C.BOGUS_COMMENT:{this._stateBogusComment(e);break}case C.MARKUP_DECLARATION_OPEN:{this._stateMarkupDeclarationOpen(e);break}case C.COMMENT_START:{this._stateCommentStart(e);break}case C.COMMENT_START_DASH:{this._stateCommentStartDash(e);break}case C.COMMENT:{this._stateComment(e);break}case C.COMMENT_LESS_THAN_SIGN:{this._stateCommentLessThanSign(e);break}case C.COMMENT_LESS_THAN_SIGN_BANG:{this._stateCommentLessThanSignBang(e);break}case C.COMMENT_LESS_THAN_SIGN_BANG_DASH:{this._stateCommentLessThanSignBangDash(e);break}case C.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:{this._stateCommentLessThanSignBangDashDash(e);break}case C.COMMENT_END_DASH:{this._stateCommentEndDash(e);break}case C.COMMENT_END:{this._stateCommentEnd(e);break}case C.COMMENT_END_BANG:{this._stateCommentEndBang(e);break}case C.DOCTYPE:{this._stateDoctype(e);break}case C.BEFORE_DOCTYPE_NAME:{this._stateBeforeDoctypeName(e);break}case C.DOCTYPE_NAME:{this._stateDoctypeName(e);break}case C.AFTER_DOCTYPE_NAME:{this._stateAfterDoctypeName(e);break}case C.AFTER_DOCTYPE_PUBLIC_KEYWORD:{this._stateAfterDoctypePublicKeyword(e);break}case C.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateBeforeDoctypePublicIdentifier(e);break}case C.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypePublicIdentifierDoubleQuoted(e);break}case C.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypePublicIdentifierSingleQuoted(e);break}case C.AFTER_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateAfterDoctypePublicIdentifier(e);break}case C.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS:{this._stateBetweenDoctypePublicAndSystemIdentifiers(e);break}case C.AFTER_DOCTYPE_SYSTEM_KEYWORD:{this._stateAfterDoctypeSystemKeyword(e);break}case C.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateBeforeDoctypeSystemIdentifier(e);break}case C.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypeSystemIdentifierDoubleQuoted(e);break}case C.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypeSystemIdentifierSingleQuoted(e);break}case C.AFTER_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateAfterDoctypeSystemIdentifier(e);break}case C.BOGUS_DOCTYPE:{this._stateBogusDoctype(e);break}case C.CDATA_SECTION:{this._stateCdataSection(e);break}case C.CDATA_SECTION_BRACKET:{this._stateCdataSectionBracket(e);break}case C.CDATA_SECTION_END:{this._stateCdataSectionEnd(e);break}case C.CHARACTER_REFERENCE:{this._stateCharacterReference();break}case C.AMBIGUOUS_AMPERSAND:{this._stateAmbiguousAmpersand(e);break}default:throw new Error("Unknown state")}}_stateData(e){switch(e){case A.LESS_THAN_SIGN:{this.state=C.TAG_OPEN;break}case A.AMPERSAND:{this._startCharacterReference();break}case A.NULL:{this._err($.unexpectedNullCharacter),this._emitCodePoint(e);break}case A.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateRcdata(e){switch(e){case A.AMPERSAND:{this._startCharacterReference();break}case A.LESS_THAN_SIGN:{this.state=C.RCDATA_LESS_THAN_SIGN;break}case A.NULL:{this._err($.unexpectedNullCharacter),this._emitChars(at);break}case A.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateRawtext(e){switch(e){case A.LESS_THAN_SIGN:{this.state=C.RAWTEXT_LESS_THAN_SIGN;break}case A.NULL:{this._err($.unexpectedNullCharacter),this._emitChars(at);break}case A.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptData(e){switch(e){case A.LESS_THAN_SIGN:{this.state=C.SCRIPT_DATA_LESS_THAN_SIGN;break}case A.NULL:{this._err($.unexpectedNullCharacter),this._emitChars(at);break}case A.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_statePlaintext(e){switch(e){case A.NULL:{this._err($.unexpectedNullCharacter),this._emitChars(at);break}case A.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateTagOpen(e){if(Ur(e))this._createStartTagToken(),this.state=C.TAG_NAME,this._stateTagName(e);else switch(e){case A.EXCLAMATION_MARK:{this.state=C.MARKUP_DECLARATION_OPEN;break}case A.SOLIDUS:{this.state=C.END_TAG_OPEN;break}case A.QUESTION_MARK:{this._err($.unexpectedQuestionMarkInsteadOfTagName),this._createCommentToken(1),this.state=C.BOGUS_COMMENT,this._stateBogusComment(e);break}case A.EOF:{this._err($.eofBeforeTagName),this._emitChars("<"),this._emitEOFToken();break}default:this._err($.invalidFirstCharacterOfTagName),this._emitChars("<"),this.state=C.DATA,this._stateData(e)}}_stateEndTagOpen(e){if(Ur(e))this._createEndTagToken(),this.state=C.TAG_NAME,this._stateTagName(e);else switch(e){case A.GREATER_THAN_SIGN:{this._err($.missingEndTagName),this.state=C.DATA;break}case A.EOF:{this._err($.eofBeforeTagName),this._emitChars("</"),this._emitEOFToken();break}default:this._err($.invalidFirstCharacterOfTagName),this._createCommentToken(2),this.state=C.BOGUS_COMMENT,this._stateBogusComment(e)}}_stateTagName(e){const n=this.currentToken;switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:{this.state=C.BEFORE_ATTRIBUTE_NAME;break}case A.SOLIDUS:{this.state=C.SELF_CLOSING_START_TAG;break}case A.GREATER_THAN_SIGN:{this.state=C.DATA,this.emitCurrentTagToken();break}case A.NULL:{this._err($.unexpectedNullCharacter),n.tagName+=at;break}case A.EOF:{this._err($.eofInTag),this._emitEOFToken();break}default:n.tagName+=String.fromCodePoint(ci(e)?fu(e):e)}}_stateRcdataLessThanSign(e){e===A.SOLIDUS?this.state=C.RCDATA_END_TAG_OPEN:(this._emitChars("<"),this.state=C.RCDATA,this._stateRcdata(e))}_stateRcdataEndTagOpen(e){Ur(e)?(this.state=C.RCDATA_END_TAG_NAME,this._stateRcdataEndTagName(e)):(this._emitChars("</"),this.state=C.RCDATA,this._stateRcdata(e))}handleSpecialEndTag(e){if(!this.preprocessor.startsWith(this.lastStartTagName,!1))return!this._ensureHibernation();this._createEndTagToken();const n=this.currentToken;switch(n.tagName=this.lastStartTagName,this.preprocessor.peek(this.lastStartTagName.length)){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:return this._advanceBy(this.lastStartTagName.length),this.state=C.BEFORE_ATTRIBUTE_NAME,!1;case A.SOLIDUS:return this._advanceBy(this.lastStartTagName.length),this.state=C.SELF_CLOSING_START_TAG,!1;case A.GREATER_THAN_SIGN:return this._advanceBy(this.lastStartTagName.length),this.emitCurrentTagToken(),this.state=C.DATA,!1;default:return!this._ensureHibernation()}}_stateRcdataEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=C.RCDATA,this._stateRcdata(e))}_stateRawtextLessThanSign(e){e===A.SOLIDUS?this.state=C.RAWTEXT_END_TAG_OPEN:(this._emitChars("<"),this.state=C.RAWTEXT,this._stateRawtext(e))}_stateRawtextEndTagOpen(e){Ur(e)?(this.state=C.RAWTEXT_END_TAG_NAME,this._stateRawtextEndTagName(e)):(this._emitChars("</"),this.state=C.RAWTEXT,this._stateRawtext(e))}_stateRawtextEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=C.RAWTEXT,this._stateRawtext(e))}_stateScriptDataLessThanSign(e){switch(e){case A.SOLIDUS:{this.state=C.SCRIPT_DATA_END_TAG_OPEN;break}case A.EXCLAMATION_MARK:{this.state=C.SCRIPT_DATA_ESCAPE_START,this._emitChars("<!");break}default:this._emitChars("<"),this.state=C.SCRIPT_DATA,this._stateScriptData(e)}}_stateScriptDataEndTagOpen(e){Ur(e)?(this.state=C.SCRIPT_DATA_END_TAG_NAME,this._stateScriptDataEndTagName(e)):(this._emitChars("</"),this.state=C.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=C.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscapeStart(e){e===A.HYPHEN_MINUS?(this.state=C.SCRIPT_DATA_ESCAPE_START_DASH,this._emitChars("-")):(this.state=C.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscapeStartDash(e){e===A.HYPHEN_MINUS?(this.state=C.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-")):(this.state=C.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscaped(e){switch(e){case A.HYPHEN_MINUS:{this.state=C.SCRIPT_DATA_ESCAPED_DASH,this._emitChars("-");break}case A.LESS_THAN_SIGN:{this.state=C.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case A.NULL:{this._err($.unexpectedNullCharacter),this._emitChars(at);break}case A.EOF:{this._err($.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptDataEscapedDash(e){switch(e){case A.HYPHEN_MINUS:{this.state=C.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-");break}case A.LESS_THAN_SIGN:{this.state=C.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case A.NULL:{this._err($.unexpectedNullCharacter),this.state=C.SCRIPT_DATA_ESCAPED,this._emitChars(at);break}case A.EOF:{this._err($.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=C.SCRIPT_DATA_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataEscapedDashDash(e){switch(e){case A.HYPHEN_MINUS:{this._emitChars("-");break}case A.LESS_THAN_SIGN:{this.state=C.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case A.GREATER_THAN_SIGN:{this.state=C.SCRIPT_DATA,this._emitChars(">");break}case A.NULL:{this._err($.unexpectedNullCharacter),this.state=C.SCRIPT_DATA_ESCAPED,this._emitChars(at);break}case A.EOF:{this._err($.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=C.SCRIPT_DATA_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataEscapedLessThanSign(e){e===A.SOLIDUS?this.state=C.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:Ur(e)?(this._emitChars("<"),this.state=C.SCRIPT_DATA_DOUBLE_ESCAPE_START,this._stateScriptDataDoubleEscapeStart(e)):(this._emitChars("<"),this.state=C.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataEscapedEndTagOpen(e){Ur(e)?(this.state=C.SCRIPT_DATA_ESCAPED_END_TAG_NAME,this._stateScriptDataEscapedEndTagName(e)):(this._emitChars("</"),this.state=C.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataEscapedEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=C.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataDoubleEscapeStart(e){if(this.preprocessor.startsWith(Zt.SCRIPT,!1)&&nb(this.preprocessor.peek(Zt.SCRIPT.length))){this._emitCodePoint(e);for(let n=0;n<Zt.SCRIPT.length;n++)this._emitCodePoint(this._consume());this.state=C.SCRIPT_DATA_DOUBLE_ESCAPED}else this._ensureHibernation()||(this.state=C.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataDoubleEscaped(e){switch(e){case A.HYPHEN_MINUS:{this.state=C.SCRIPT_DATA_DOUBLE_ESCAPED_DASH,this._emitChars("-");break}case A.LESS_THAN_SIGN:{this.state=C.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case A.NULL:{this._err($.unexpectedNullCharacter),this._emitChars(at);break}case A.EOF:{this._err($.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedDash(e){switch(e){case A.HYPHEN_MINUS:{this.state=C.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH,this._emitChars("-");break}case A.LESS_THAN_SIGN:{this.state=C.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case A.NULL:{this._err($.unexpectedNullCharacter),this.state=C.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(at);break}case A.EOF:{this._err($.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=C.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedDashDash(e){switch(e){case A.HYPHEN_MINUS:{this._emitChars("-");break}case A.LESS_THAN_SIGN:{this.state=C.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case A.GREATER_THAN_SIGN:{this.state=C.SCRIPT_DATA,this._emitChars(">");break}case A.NULL:{this._err($.unexpectedNullCharacter),this.state=C.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(at);break}case A.EOF:{this._err($.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=C.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedLessThanSign(e){e===A.SOLIDUS?(this.state=C.SCRIPT_DATA_DOUBLE_ESCAPE_END,this._emitChars("/")):(this.state=C.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(e))}_stateScriptDataDoubleEscapeEnd(e){if(this.preprocessor.startsWith(Zt.SCRIPT,!1)&&nb(this.preprocessor.peek(Zt.SCRIPT.length))){this._emitCodePoint(e);for(let n=0;n<Zt.SCRIPT.length;n++)this._emitCodePoint(this._consume());this.state=C.SCRIPT_DATA_ESCAPED}else this._ensureHibernation()||(this.state=C.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(e))}_stateBeforeAttributeName(e){switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:break;case A.SOLIDUS:case A.GREATER_THAN_SIGN:case A.EOF:{this.state=C.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(e);break}case A.EQUALS_SIGN:{this._err($.unexpectedEqualsSignBeforeAttributeName),this._createAttr("="),this.state=C.ATTRIBUTE_NAME;break}default:this._createAttr(""),this.state=C.ATTRIBUTE_NAME,this._stateAttributeName(e)}}_stateAttributeName(e){switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:case A.SOLIDUS:case A.GREATER_THAN_SIGN:case A.EOF:{this._leaveAttrName(),this.state=C.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(e);break}case A.EQUALS_SIGN:{this._leaveAttrName(),this.state=C.BEFORE_ATTRIBUTE_VALUE;break}case A.QUOTATION_MARK:case A.APOSTROPHE:case A.LESS_THAN_SIGN:{this._err($.unexpectedCharacterInAttributeName),this.currentAttr.name+=String.fromCodePoint(e);break}case A.NULL:{this._err($.unexpectedNullCharacter),this.currentAttr.name+=at;break}default:this.currentAttr.name+=String.fromCodePoint(ci(e)?fu(e):e)}}_stateAfterAttributeName(e){switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:break;case A.SOLIDUS:{this.state=C.SELF_CLOSING_START_TAG;break}case A.EQUALS_SIGN:{this.state=C.BEFORE_ATTRIBUTE_VALUE;break}case A.GREATER_THAN_SIGN:{this.state=C.DATA,this.emitCurrentTagToken();break}case A.EOF:{this._err($.eofInTag),this._emitEOFToken();break}default:this._createAttr(""),this.state=C.ATTRIBUTE_NAME,this._stateAttributeName(e)}}_stateBeforeAttributeValue(e){switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:break;case A.QUOTATION_MARK:{this.state=C.ATTRIBUTE_VALUE_DOUBLE_QUOTED;break}case A.APOSTROPHE:{this.state=C.ATTRIBUTE_VALUE_SINGLE_QUOTED;break}case A.GREATER_THAN_SIGN:{this._err($.missingAttributeValue),this.state=C.DATA,this.emitCurrentTagToken();break}default:this.state=C.ATTRIBUTE_VALUE_UNQUOTED,this._stateAttributeValueUnquoted(e)}}_stateAttributeValueDoubleQuoted(e){switch(e){case A.QUOTATION_MARK:{this.state=C.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case A.AMPERSAND:{this._startCharacterReference();break}case A.NULL:{this._err($.unexpectedNullCharacter),this.currentAttr.value+=at;break}case A.EOF:{this._err($.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAttributeValueSingleQuoted(e){switch(e){case A.APOSTROPHE:{this.state=C.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case A.AMPERSAND:{this._startCharacterReference();break}case A.NULL:{this._err($.unexpectedNullCharacter),this.currentAttr.value+=at;break}case A.EOF:{this._err($.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAttributeValueUnquoted(e){switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:{this._leaveAttrValue(),this.state=C.BEFORE_ATTRIBUTE_NAME;break}case A.AMPERSAND:{this._startCharacterReference();break}case A.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=C.DATA,this.emitCurrentTagToken();break}case A.NULL:{this._err($.unexpectedNullCharacter),this.currentAttr.value+=at;break}case A.QUOTATION_MARK:case A.APOSTROPHE:case A.LESS_THAN_SIGN:case A.EQUALS_SIGN:case A.GRAVE_ACCENT:{this._err($.unexpectedCharacterInUnquotedAttributeValue),this.currentAttr.value+=String.fromCodePoint(e);break}case A.EOF:{this._err($.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAfterAttributeValueQuoted(e){switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:{this._leaveAttrValue(),this.state=C.BEFORE_ATTRIBUTE_NAME;break}case A.SOLIDUS:{this._leaveAttrValue(),this.state=C.SELF_CLOSING_START_TAG;break}case A.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=C.DATA,this.emitCurrentTagToken();break}case A.EOF:{this._err($.eofInTag),this._emitEOFToken();break}default:this._err($.missingWhitespaceBetweenAttributes),this.state=C.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(e)}}_stateSelfClosingStartTag(e){switch(e){case A.GREATER_THAN_SIGN:{const n=this.currentToken;n.selfClosing=!0,this.state=C.DATA,this.emitCurrentTagToken();break}case A.EOF:{this._err($.eofInTag),this._emitEOFToken();break}default:this._err($.unexpectedSolidusInTag),this.state=C.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(e)}}_stateBogusComment(e){const n=this.currentToken;switch(e){case A.GREATER_THAN_SIGN:{this.state=C.DATA,this.emitCurrentComment(n);break}case A.EOF:{this.emitCurrentComment(n),this._emitEOFToken();break}case A.NULL:{this._err($.unexpectedNullCharacter),n.data+=at;break}default:n.data+=String.fromCodePoint(e)}}_stateMarkupDeclarationOpen(e){this._consumeSequenceIfMatch(Zt.DASH_DASH,!0)?(this._createCommentToken(Zt.DASH_DASH.length+1),this.state=C.COMMENT_START):this._consumeSequenceIfMatch(Zt.DOCTYPE,!1)?(this.currentLocation=this.getCurrentLocation(Zt.DOCTYPE.length+1),this.state=C.DOCTYPE):this._consumeSequenceIfMatch(Zt.CDATA_START,!0)?this.inForeignNode?this.state=C.CDATA_SECTION:(this._err($.cdataInHtmlContent),this._createCommentToken(Zt.CDATA_START.length+1),this.currentToken.data="[CDATA[",this.state=C.BOGUS_COMMENT):this._ensureHibernation()||(this._err($.incorrectlyOpenedComment),this._createCommentToken(2),this.state=C.BOGUS_COMMENT,this._stateBogusComment(e))}_stateCommentStart(e){switch(e){case A.HYPHEN_MINUS:{this.state=C.COMMENT_START_DASH;break}case A.GREATER_THAN_SIGN:{this._err($.abruptClosingOfEmptyComment),this.state=C.DATA;const n=this.currentToken;this.emitCurrentComment(n);break}default:this.state=C.COMMENT,this._stateComment(e)}}_stateCommentStartDash(e){const n=this.currentToken;switch(e){case A.HYPHEN_MINUS:{this.state=C.COMMENT_END;break}case A.GREATER_THAN_SIGN:{this._err($.abruptClosingOfEmptyComment),this.state=C.DATA,this.emitCurrentComment(n);break}case A.EOF:{this._err($.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="-",this.state=C.COMMENT,this._stateComment(e)}}_stateComment(e){const n=this.currentToken;switch(e){case A.HYPHEN_MINUS:{this.state=C.COMMENT_END_DASH;break}case A.LESS_THAN_SIGN:{n.data+="<",this.state=C.COMMENT_LESS_THAN_SIGN;break}case A.NULL:{this._err($.unexpectedNullCharacter),n.data+=at;break}case A.EOF:{this._err($.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+=String.fromCodePoint(e)}}_stateCommentLessThanSign(e){const n=this.currentToken;switch(e){case A.EXCLAMATION_MARK:{n.data+="!",this.state=C.COMMENT_LESS_THAN_SIGN_BANG;break}case A.LESS_THAN_SIGN:{n.data+="<";break}default:this.state=C.COMMENT,this._stateComment(e)}}_stateCommentLessThanSignBang(e){e===A.HYPHEN_MINUS?this.state=C.COMMENT_LESS_THAN_SIGN_BANG_DASH:(this.state=C.COMMENT,this._stateComment(e))}_stateCommentLessThanSignBangDash(e){e===A.HYPHEN_MINUS?this.state=C.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:(this.state=C.COMMENT_END_DASH,this._stateCommentEndDash(e))}_stateCommentLessThanSignBangDashDash(e){e!==A.GREATER_THAN_SIGN&&e!==A.EOF&&this._err($.nestedComment),this.state=C.COMMENT_END,this._stateCommentEnd(e)}_stateCommentEndDash(e){const n=this.currentToken;switch(e){case A.HYPHEN_MINUS:{this.state=C.COMMENT_END;break}case A.EOF:{this._err($.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="-",this.state=C.COMMENT,this._stateComment(e)}}_stateCommentEnd(e){const n=this.currentToken;switch(e){case A.GREATER_THAN_SIGN:{this.state=C.DATA,this.emitCurrentComment(n);break}case A.EXCLAMATION_MARK:{this.state=C.COMMENT_END_BANG;break}case A.HYPHEN_MINUS:{n.data+="-";break}case A.EOF:{this._err($.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="--",this.state=C.COMMENT,this._stateComment(e)}}_stateCommentEndBang(e){const n=this.currentToken;switch(e){case A.HYPHEN_MINUS:{n.data+="--!",this.state=C.COMMENT_END_DASH;break}case A.GREATER_THAN_SIGN:{this._err($.incorrectlyClosedComment),this.state=C.DATA,this.emitCurrentComment(n);break}case A.EOF:{this._err($.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="--!",this.state=C.COMMENT,this._stateComment(e)}}_stateDoctype(e){switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:{this.state=C.BEFORE_DOCTYPE_NAME;break}case A.GREATER_THAN_SIGN:{this.state=C.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(e);break}case A.EOF:{this._err($.eofInDoctype),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err($.missingWhitespaceBeforeDoctypeName),this.state=C.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(e)}}_stateBeforeDoctypeName(e){if(ci(e))this._createDoctypeToken(String.fromCharCode(fu(e))),this.state=C.DOCTYPE_NAME;else switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:break;case A.NULL:{this._err($.unexpectedNullCharacter),this._createDoctypeToken(at),this.state=C.DOCTYPE_NAME;break}case A.GREATER_THAN_SIGN:{this._err($.missingDoctypeName),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=C.DATA;break}case A.EOF:{this._err($.eofInDoctype),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._createDoctypeToken(String.fromCodePoint(e)),this.state=C.DOCTYPE_NAME}}_stateDoctypeName(e){const n=this.currentToken;switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:{this.state=C.AFTER_DOCTYPE_NAME;break}case A.GREATER_THAN_SIGN:{this.state=C.DATA,this.emitCurrentDoctype(n);break}case A.NULL:{this._err($.unexpectedNullCharacter),n.name+=at;break}case A.EOF:{this._err($.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.name+=String.fromCodePoint(ci(e)?fu(e):e)}}_stateAfterDoctypeName(e){const n=this.currentToken;switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:break;case A.GREATER_THAN_SIGN:{this.state=C.DATA,this.emitCurrentDoctype(n);break}case A.EOF:{this._err($.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._consumeSequenceIfMatch(Zt.PUBLIC,!1)?this.state=C.AFTER_DOCTYPE_PUBLIC_KEYWORD:this._consumeSequenceIfMatch(Zt.SYSTEM,!1)?this.state=C.AFTER_DOCTYPE_SYSTEM_KEYWORD:this._ensureHibernation()||(this._err($.invalidCharacterSequenceAfterDoctypeName),n.forceQuirks=!0,this.state=C.BOGUS_DOCTYPE,this._stateBogusDoctype(e))}}_stateAfterDoctypePublicKeyword(e){const n=this.currentToken;switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:{this.state=C.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER;break}case A.QUOTATION_MARK:{this._err($.missingWhitespaceAfterDoctypePublicKeyword),n.publicId="",this.state=C.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case A.APOSTROPHE:{this._err($.missingWhitespaceAfterDoctypePublicKeyword),n.publicId="",this.state=C.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case A.GREATER_THAN_SIGN:{this._err($.missingDoctypePublicIdentifier),n.forceQuirks=!0,this.state=C.DATA,this.emitCurrentDoctype(n);break}case A.EOF:{this._err($.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err($.missingQuoteBeforeDoctypePublicIdentifier),n.forceQuirks=!0,this.state=C.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBeforeDoctypePublicIdentifier(e){const n=this.currentToken;switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:break;case A.QUOTATION_MARK:{n.publicId="",this.state=C.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case A.APOSTROPHE:{n.publicId="",this.state=C.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case A.GREATER_THAN_SIGN:{this._err($.missingDoctypePublicIdentifier),n.forceQuirks=!0,this.state=C.DATA,this.emitCurrentDoctype(n);break}case A.EOF:{this._err($.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err($.missingQuoteBeforeDoctypePublicIdentifier),n.forceQuirks=!0,this.state=C.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateDoctypePublicIdentifierDoubleQuoted(e){const n=this.currentToken;switch(e){case A.QUOTATION_MARK:{this.state=C.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case A.NULL:{this._err($.unexpectedNullCharacter),n.publicId+=at;break}case A.GREATER_THAN_SIGN:{this._err($.abruptDoctypePublicIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=C.DATA;break}case A.EOF:{this._err($.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.publicId+=String.fromCodePoint(e)}}_stateDoctypePublicIdentifierSingleQuoted(e){const n=this.currentToken;switch(e){case A.APOSTROPHE:{this.state=C.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case A.NULL:{this._err($.unexpectedNullCharacter),n.publicId+=at;break}case A.GREATER_THAN_SIGN:{this._err($.abruptDoctypePublicIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=C.DATA;break}case A.EOF:{this._err($.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.publicId+=String.fromCodePoint(e)}}_stateAfterDoctypePublicIdentifier(e){const n=this.currentToken;switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:{this.state=C.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS;break}case A.GREATER_THAN_SIGN:{this.state=C.DATA,this.emitCurrentDoctype(n);break}case A.QUOTATION_MARK:{this._err($.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),n.systemId="",this.state=C.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case A.APOSTROPHE:{this._err($.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),n.systemId="",this.state=C.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case A.EOF:{this._err($.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err($.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=C.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBetweenDoctypePublicAndSystemIdentifiers(e){const n=this.currentToken;switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:break;case A.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=C.DATA;break}case A.QUOTATION_MARK:{n.systemId="",this.state=C.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case A.APOSTROPHE:{n.systemId="",this.state=C.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case A.EOF:{this._err($.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err($.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=C.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateAfterDoctypeSystemKeyword(e){const n=this.currentToken;switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:{this.state=C.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER;break}case A.QUOTATION_MARK:{this._err($.missingWhitespaceAfterDoctypeSystemKeyword),n.systemId="",this.state=C.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case A.APOSTROPHE:{this._err($.missingWhitespaceAfterDoctypeSystemKeyword),n.systemId="",this.state=C.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case A.GREATER_THAN_SIGN:{this._err($.missingDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=C.DATA,this.emitCurrentDoctype(n);break}case A.EOF:{this._err($.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err($.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=C.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBeforeDoctypeSystemIdentifier(e){const n=this.currentToken;switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:break;case A.QUOTATION_MARK:{n.systemId="",this.state=C.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case A.APOSTROPHE:{n.systemId="",this.state=C.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case A.GREATER_THAN_SIGN:{this._err($.missingDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=C.DATA,this.emitCurrentDoctype(n);break}case A.EOF:{this._err($.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err($.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=C.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateDoctypeSystemIdentifierDoubleQuoted(e){const n=this.currentToken;switch(e){case A.QUOTATION_MARK:{this.state=C.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case A.NULL:{this._err($.unexpectedNullCharacter),n.systemId+=at;break}case A.GREATER_THAN_SIGN:{this._err($.abruptDoctypeSystemIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=C.DATA;break}case A.EOF:{this._err($.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.systemId+=String.fromCodePoint(e)}}_stateDoctypeSystemIdentifierSingleQuoted(e){const n=this.currentToken;switch(e){case A.APOSTROPHE:{this.state=C.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case A.NULL:{this._err($.unexpectedNullCharacter),n.systemId+=at;break}case A.GREATER_THAN_SIGN:{this._err($.abruptDoctypeSystemIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=C.DATA;break}case A.EOF:{this._err($.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.systemId+=String.fromCodePoint(e)}}_stateAfterDoctypeSystemIdentifier(e){const n=this.currentToken;switch(e){case A.SPACE:case A.LINE_FEED:case A.TABULATION:case A.FORM_FEED:break;case A.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=C.DATA;break}case A.EOF:{this._err($.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err($.unexpectedCharacterAfterDoctypeSystemIdentifier),this.state=C.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBogusDoctype(e){const n=this.currentToken;switch(e){case A.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=C.DATA;break}case A.NULL:{this._err($.unexpectedNullCharacter);break}case A.EOF:{this.emitCurrentDoctype(n),this._emitEOFToken();break}}}_stateCdataSection(e){switch(e){case A.RIGHT_SQUARE_BRACKET:{this.state=C.CDATA_SECTION_BRACKET;break}case A.EOF:{this._err($.eofInCdata),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateCdataSectionBracket(e){e===A.RIGHT_SQUARE_BRACKET?this.state=C.CDATA_SECTION_END:(this._emitChars("]"),this.state=C.CDATA_SECTION,this._stateCdataSection(e))}_stateCdataSectionEnd(e){switch(e){case A.GREATER_THAN_SIGN:{this.state=C.DATA;break}case A.RIGHT_SQUARE_BRACKET:{this._emitChars("]");break}default:this._emitChars("]]"),this.state=C.CDATA_SECTION,this._stateCdataSection(e)}}_stateCharacterReference(){let e=this.entityDecoder.write(this.preprocessor.html,this.preprocessor.pos);if(e<0)if(this.preprocessor.lastChunkWritten)e=this.entityDecoder.end();else{this.active=!1,this.preprocessor.pos=this.preprocessor.html.length-1,this.consumedAfterSnapshot=0,this.preprocessor.endOfChunkHit=!0;return}e===0?(this.preprocessor.pos=this.entityStartPos,this._flushCodePointConsumedAsCharacterReference(A.AMPERSAND),this.state=!this._isCharacterReferenceInAttribute()&&tb(this.preprocessor.peek(1))?C.AMBIGUOUS_AMPERSAND:this.returnState):this.state=this.returnState}_stateAmbiguousAmpersand(e){tb(e)?this._flushCodePointConsumedAsCharacterReference(e):(e===A.SEMICOLON&&this._err($.unknownNamedCharacterReference),this.state=this.returnState,this._callState(e))}};const Ww=new Set([f.DD,f.DT,f.LI,f.OPTGROUP,f.OPTION,f.P,f.RB,f.RP,f.RT,f.RTC]),rb=new Set([...Ww,f.CAPTION,f.COLGROUP,f.TBODY,f.TD,f.TFOOT,f.TH,f.THEAD,f.TR]),Tc=new Set([f.APPLET,f.CAPTION,f.HTML,f.MARQUEE,f.OBJECT,f.TABLE,f.TD,f.TEMPLATE,f.TH]),k8=new Set([...Tc,f.OL,f.UL]),I8=new Set([...Tc,f.BUTTON]),sb=new Set([f.ANNOTATION_XML,f.MI,f.MN,f.MO,f.MS,f.MTEXT]),ab=new Set([f.DESC,f.FOREIGN_OBJECT,f.TITLE]),N8=new Set([f.TR,f.TEMPLATE,f.HTML]),R8=new Set([f.TBODY,f.TFOOT,f.THEAD,f.TEMPLATE,f.HTML]),P8=new Set([f.TABLE,f.TEMPLATE,f.HTML]),x8=new Set([f.TD,f.TH]);class L8{get currentTmplContentOrNode(){return this._isInTemplate()?this.treeAdapter.getTemplateContent(this.current):this.current}constructor(e,n,r){this.treeAdapter=n,this.handler=r,this.items=[],this.tagIDs=[],this.stackTop=-1,this.tmplCount=0,this.currentTagId=f.UNKNOWN,this.current=e}_indexOf(e){return this.items.lastIndexOf(e,this.stackTop)}_isInTemplate(){return this.currentTagId===f.TEMPLATE&&this.treeAdapter.getNamespaceURI(this.current)===Y.HTML}_updateCurrentElement(){this.current=this.items[this.stackTop],this.currentTagId=this.tagIDs[this.stackTop]}push(e,n){this.stackTop++,this.items[this.stackTop]=e,this.current=e,this.tagIDs[this.stackTop]=n,this.currentTagId=n,this._isInTemplate()&&this.tmplCount++,this.handler.onItemPush(e,n,!0)}pop(){const e=this.current;this.tmplCount>0&&this._isInTemplate()&&this.tmplCount--,this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(e,!0)}replace(e,n){const r=this._indexOf(e);this.items[r]=n,r===this.stackTop&&(this.current=n)}insertAfter(e,n,r){const s=this._indexOf(e)+1;this.items.splice(s,0,n),this.tagIDs.splice(s,0,r),this.stackTop++,s===this.stackTop&&this._updateCurrentElement(),this.handler.onItemPush(this.current,this.currentTagId,s===this.stackTop)}popUntilTagNamePopped(e){let n=this.stackTop+1;do n=this.tagIDs.lastIndexOf(e,n-1);while(n>0&&this.treeAdapter.getNamespaceURI(this.items[n])!==Y.HTML);this.shortenToLength(n<0?0:n)}shortenToLength(e){for(;this.stackTop>=e;){const n=this.current;this.tmplCount>0&&this._isInTemplate()&&(this.tmplCount-=1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(n,this.stackTop<e)}}popUntilElementPopped(e){const n=this._indexOf(e);this.shortenToLength(n<0?0:n)}popUntilPopped(e,n){const r=this._indexOfTagNames(e,n);this.shortenToLength(r<0?0:r)}popUntilNumberedHeaderPopped(){this.popUntilPopped(Jh,Y.HTML)}popUntilTableCellPopped(){this.popUntilPopped(x8,Y.HTML)}popAllUpToHtmlElement(){this.tmplCount=0,this.shortenToLength(1)}_indexOfTagNames(e,n){for(let r=this.stackTop;r>=0;r--)if(e.has(this.tagIDs[r])&&this.treeAdapter.getNamespaceURI(this.items[r])===n)return r;return-1}clearBackTo(e,n){const r=this._indexOfTagNames(e,n);this.shortenToLength(r+1)}clearBackToTableContext(){this.clearBackTo(P8,Y.HTML)}clearBackToTableBodyContext(){this.clearBackTo(R8,Y.HTML)}clearBackToTableRowContext(){this.clearBackTo(N8,Y.HTML)}remove(e){const n=this._indexOf(e);n>=0&&(n===this.stackTop?this.pop():(this.items.splice(n,1),this.tagIDs.splice(n,1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(e,!1)))}tryPeekProperlyNestedBodyElement(){return this.stackTop>=1&&this.tagIDs[1]===f.BODY?this.items[1]:null}contains(e){return this._indexOf(e)>-1}getCommonAncestor(e){const n=this._indexOf(e)-1;return n>=0?this.items[n]:null}isRootHtmlElementCurrent(){return this.stackTop===0&&this.tagIDs[0]===f.HTML}hasInDynamicScope(e,n){for(let r=this.stackTop;r>=0;r--){const s=this.tagIDs[r];switch(this.treeAdapter.getNamespaceURI(this.items[r])){case Y.HTML:{if(s===e)return!0;if(n.has(s))return!1;break}case Y.SVG:{if(ab.has(s))return!1;break}case Y.MATHML:{if(sb.has(s))return!1;break}}}return!0}hasInScope(e){return this.hasInDynamicScope(e,Tc)}hasInListItemScope(e){return this.hasInDynamicScope(e,k8)}hasInButtonScope(e){return this.hasInDynamicScope(e,I8)}hasNumberedHeaderInScope(){for(let e=this.stackTop;e>=0;e--){const n=this.tagIDs[e];switch(this.treeAdapter.getNamespaceURI(this.items[e])){case Y.HTML:{if(Jh.has(n))return!0;if(Tc.has(n))return!1;break}case Y.SVG:{if(ab.has(n))return!1;break}case Y.MATHML:{if(sb.has(n))return!1;break}}}return!0}hasInTableScope(e){for(let n=this.stackTop;n>=0;n--)if(this.treeAdapter.getNamespaceURI(this.items[n])===Y.HTML)switch(this.tagIDs[n]){case e:return!0;case f.TABLE:case f.HTML:return!1}return!0}hasTableBodyContextInTableScope(){for(let e=this.stackTop;e>=0;e--)if(this.treeAdapter.getNamespaceURI(this.items[e])===Y.HTML)switch(this.tagIDs[e]){case f.TBODY:case f.THEAD:case f.TFOOT:return!0;case f.TABLE:case f.HTML:return!1}return!0}hasInSelectScope(e){for(let n=this.stackTop;n>=0;n--)if(this.treeAdapter.getNamespaceURI(this.items[n])===Y.HTML)switch(this.tagIDs[n]){case e:return!0;case f.OPTION:case f.OPTGROUP:break;default:return!1}return!0}generateImpliedEndTags(){for(;Ww.has(this.currentTagId);)this.pop()}generateImpliedEndTagsThoroughly(){for(;rb.has(this.currentTagId);)this.pop()}generateImpliedEndTagsWithExclusion(e){for(;this.currentTagId!==e&&rb.has(this.currentTagId);)this.pop()}}const xd=3;var ar;(function(t){t[t.Marker=0]="Marker",t[t.Element=1]="Element"})(ar||(ar={}));const ib={type:ar.Marker};class D8{constructor(e){this.treeAdapter=e,this.entries=[],this.bookmark=null}_getNoahArkConditionCandidates(e,n){const r=[],s=n.length,a=this.treeAdapter.getTagName(e),i=this.treeAdapter.getNamespaceURI(e);for(let o=0;o<this.entries.length;o++){const u=this.entries[o];if(u.type===ar.Marker)break;const{element:c}=u;if(this.treeAdapter.getTagName(c)===a&&this.treeAdapter.getNamespaceURI(c)===i){const l=this.treeAdapter.getAttrList(c);l.length===s&&r.push({idx:o,attrs:l})}}return r}_ensureNoahArkCondition(e){if(this.entries.length<xd)return;const n=this.treeAdapter.getAttrList(e),r=this._getNoahArkConditionCandidates(e,n);if(r.length<xd)return;const s=new Map(n.map(i=>[i.name,i.value]));let a=0;for(let i=0;i<r.length;i++){const o=r[i];o.attrs.every(u=>s.get(u.name)===u.value)&&(a+=1,a>=xd&&this.entries.splice(o.idx,1))}}insertMarker(){this.entries.unshift(ib)}pushElement(e,n){this._ensureNoahArkCondition(e),this.entries.unshift({type:ar.Element,element:e,token:n})}insertElementAfterBookmark(e,n){const r=this.entries.indexOf(this.bookmark);this.entries.splice(r,0,{type:ar.Element,element:e,token:n})}removeEntry(e){const n=this.entries.indexOf(e);n>=0&&this.entries.splice(n,1)}clearToLastMarker(){const e=this.entries.indexOf(ib);e>=0?this.entries.splice(0,e+1):this.entries.length=0}getElementEntryInScopeWithTagName(e){const n=this.entries.find(r=>r.type===ar.Marker||this.treeAdapter.getTagName(r.element)===e);return n&&n.type===ar.Element?n:null}getElementEntry(e){return this.entries.find(n=>n.type===ar.Element&&n.element===e)}}const Ar={createDocument(){return{nodeName:"#document",mode:fn.NO_QUIRKS,childNodes:[]}},createDocumentFragment(){return{nodeName:"#document-fragment",childNodes:[]}},createElement(t,e,n){return{nodeName:t,tagName:t,attrs:n,namespaceURI:e,childNodes:[],parentNode:null}},createCommentNode(t){return{nodeName:"#comment",data:t,parentNode:null}},createTextNode(t){return{nodeName:"#text",value:t,parentNode:null}},appendChild(t,e){t.childNodes.push(e),e.parentNode=t},insertBefore(t,e,n){const r=t.childNodes.indexOf(n);t.childNodes.splice(r,0,e),e.parentNode=t},setTemplateContent(t,e){t.content=e},getTemplateContent(t){return t.content},setDocumentType(t,e,n,r){const s=t.childNodes.find(a=>a.nodeName==="#documentType");if(s)s.name=e,s.publicId=n,s.systemId=r;else{const a={nodeName:"#documentType",name:e,publicId:n,systemId:r,parentNode:null};Ar.appendChild(t,a)}},setDocumentMode(t,e){t.mode=e},getDocumentMode(t){return t.mode},detachNode(t){if(t.parentNode){const e=t.parentNode.childNodes.indexOf(t);t.parentNode.childNodes.splice(e,1),t.parentNode=null}},insertText(t,e){if(t.childNodes.length>0){const n=t.childNodes[t.childNodes.length-1];if(Ar.isTextNode(n)){n.value+=e;return}}Ar.appendChild(t,Ar.createTextNode(e))},insertTextBefore(t,e,n){const r=t.childNodes[t.childNodes.indexOf(n)-1];r&&Ar.isTextNode(r)?r.value+=e:Ar.insertBefore(t,Ar.createTextNode(e),n)},adoptAttributes(t,e){const n=new Set(t.attrs.map(r=>r.name));for(let r=0;r<e.length;r++)n.has(e[r].name)||t.attrs.push(e[r])},getFirstChild(t){return t.childNodes[0]},getChildNodes(t){return t.childNodes},getParentNode(t){return t.parentNode},getAttrList(t){return t.attrs},getTagName(t){return t.tagName},getNamespaceURI(t){return t.namespaceURI},getTextNodeContent(t){return t.value},getCommentNodeContent(t){return t.data},getDocumentTypeNodeName(t){return t.name},getDocumentTypeNodePublicId(t){return t.publicId},getDocumentTypeNodeSystemId(t){return t.systemId},isTextNode(t){return t.nodeName==="#text"},isCommentNode(t){return t.nodeName==="#comment"},isDocumentTypeNode(t){return t.nodeName==="#documentType"},isElementNode(t){return Object.prototype.hasOwnProperty.call(t,"tagName")},setNodeSourceCodeLocation(t,e){t.sourceCodeLocation=e},getNodeSourceCodeLocation(t){return t.sourceCodeLocation},updateNodeSourceCodeLocation(t,e){t.sourceCodeLocation={...t.sourceCodeLocation,...e}}},Gw="html",M8="about:legacy-compat",B8="http://www.ibm.com/data/dtd/v11/ibmxhtml1-transitional.dtd",Kw=["+//silmaril//dtd html pro v0r11 19970101//","-//as//dtd html 3.0 aswedit + extensions//","-//advasoft ltd//dtd html 3.0 aswedit + extensions//","-//ietf//dtd html 2.0 level 1//","-//ietf//dtd html 2.0 level 2//","-//ietf//dtd html 2.0 strict level 1//","-//ietf//dtd html 2.0 strict level 2//","-//ietf//dtd html 2.0 strict//","-//ietf//dtd html 2.0//","-//ietf//dtd html 2.1e//","-//ietf//dtd html 3.0//","-//ietf//dtd html 3.2 final//","-//ietf//dtd html 3.2//","-//ietf//dtd html 3//","-//ietf//dtd html level 0//","-//ietf//dtd html level 1//","-//ietf//dtd html level 2//","-//ietf//dtd html level 3//","-//ietf//dtd html strict level 0//","-//ietf//dtd html strict level 1//","-//ietf//dtd html strict level 2//","-//ietf//dtd html strict level 3//","-//ietf//dtd html strict//","-//ietf//dtd html//","-//metrius//dtd metrius presentational//","-//microsoft//dtd internet explorer 2.0 html strict//","-//microsoft//dtd internet explorer 2.0 html//","-//microsoft//dtd internet explorer 2.0 tables//","-//microsoft//dtd internet explorer 3.0 html strict//","-//microsoft//dtd internet explorer 3.0 html//","-//microsoft//dtd internet explorer 3.0 tables//","-//netscape comm. corp.//dtd html//","-//netscape comm. corp.//dtd strict html//","-//o'reilly and associates//dtd html 2.0//","-//o'reilly and associates//dtd html extended 1.0//","-//o'reilly and associates//dtd html extended relaxed 1.0//","-//sq//dtd html 2.0 hotmetal + extensions//","-//softquad software//dtd hotmetal pro 6.0::19990601::extensions to html 4.0//","-//softquad//dtd hotmetal pro 4.0::19971010::extensions to html 4.0//","-//spyglass//dtd html 2.0 extended//","-//sun microsystems corp.//dtd hotjava html//","-//sun microsystems corp.//dtd hotjava strict html//","-//w3c//dtd html 3 1995-03-24//","-//w3c//dtd html 3.2 draft//","-//w3c//dtd html 3.2 final//","-//w3c//dtd html 3.2//","-//w3c//dtd html 3.2s draft//","-//w3c//dtd html 4.0 frameset//","-//w3c//dtd html 4.0 transitional//","-//w3c//dtd html experimental 19960712//","-//w3c//dtd html experimental 970421//","-//w3c//dtd w3 html//","-//w3o//dtd w3 html 3.0//","-//webtechs//dtd mozilla html 2.0//","-//webtechs//dtd mozilla html//"],F8=[...Kw,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"],U8=new Set(["-//w3o//dtd w3 html strict 3.0//en//","-/w3c/dtd html 4.0 transitional/en","html"]),Yw=["-//w3c//dtd xhtml 1.0 frameset//","-//w3c//dtd xhtml 1.0 transitional//"],j8=[...Yw,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"];function ob(t,e){return e.some(n=>t.startsWith(n))}function H8(t){return t.name===Gw&&t.publicId===null&&(t.systemId===null||t.systemId===M8)}function $8(t){if(t.name!==Gw)return fn.QUIRKS;const{systemId:e}=t;if(e&&e.toLowerCase()===B8)return fn.QUIRKS;let{publicId:n}=t;if(n!==null){if(n=n.toLowerCase(),U8.has(n))return fn.QUIRKS;let r=e===null?F8:Kw;if(ob(n,r))return fn.QUIRKS;if(r=e===null?Yw:j8,ob(n,r))return fn.LIMITED_QUIRKS}return fn.NO_QUIRKS}const ub={TEXT_HTML:"text/html",APPLICATION_XML:"application/xhtml+xml"},q8="definitionurl",V8="definitionURL",z8=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(t=>[t.toLowerCase(),t])),W8=new Map([["xlink:actuate",{prefix:"xlink",name:"actuate",namespace:Y.XLINK}],["xlink:arcrole",{prefix:"xlink",name:"arcrole",namespace:Y.XLINK}],["xlink:href",{prefix:"xlink",name:"href",namespace:Y.XLINK}],["xlink:role",{prefix:"xlink",name:"role",namespace:Y.XLINK}],["xlink:show",{prefix:"xlink",name:"show",namespace:Y.XLINK}],["xlink:title",{prefix:"xlink",name:"title",namespace:Y.XLINK}],["xlink:type",{prefix:"xlink",name:"type",namespace:Y.XLINK}],["xml:lang",{prefix:"xml",name:"lang",namespace:Y.XML}],["xml:space",{prefix:"xml",name:"space",namespace:Y.XML}],["xmlns",{prefix:"",name:"xmlns",namespace:Y.XMLNS}],["xmlns:xlink",{prefix:"xmlns",name:"xlink",namespace:Y.XMLNS}]]),G8=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(t=>[t.toLowerCase(),t])),K8=new Set([f.B,f.BIG,f.BLOCKQUOTE,f.BODY,f.BR,f.CENTER,f.CODE,f.DD,f.DIV,f.DL,f.DT,f.EM,f.EMBED,f.H1,f.H2,f.H3,f.H4,f.H5,f.H6,f.HEAD,f.HR,f.I,f.IMG,f.LI,f.LISTING,f.MENU,f.META,f.NOBR,f.OL,f.P,f.PRE,f.RUBY,f.S,f.SMALL,f.SPAN,f.STRONG,f.STRIKE,f.SUB,f.SUP,f.TABLE,f.TT,f.U,f.UL,f.VAR]);function Y8(t){const e=t.tagID;return e===f.FONT&&t.attrs.some(({name:r})=>r===ys.COLOR||r===ys.SIZE||r===ys.FACE)||K8.has(e)}function Zw(t){for(let e=0;e<t.attrs.length;e++)if(t.attrs[e].name===q8){t.attrs[e].name=V8;break}}function Jw(t){for(let e=0;e<t.attrs.length;e++){const n=z8.get(t.attrs[e].name);n!=null&&(t.attrs[e].name=n)}}function Lm(t){for(let e=0;e<t.attrs.length;e++){const n=W8.get(t.attrs[e].name);n&&(t.attrs[e].prefix=n.prefix,t.attrs[e].name=n.name,t.attrs[e].namespace=n.namespace)}}function Z8(t){const e=G8.get(t.tagName);e!=null&&(t.tagName=e,t.tagID=pl(t.tagName))}function J8(t,e){return e===Y.MATHML&&(t===f.MI||t===f.MO||t===f.MN||t===f.MS||t===f.MTEXT)}function X8(t,e,n){if(e===Y.MATHML&&t===f.ANNOTATION_XML){for(let r=0;r<n.length;r++)if(n[r].name===ys.ENCODING){const s=n[r].value.toLowerCase();return s===ub.TEXT_HTML||s===ub.APPLICATION_XML}}return e===Y.SVG&&(t===f.FOREIGN_OBJECT||t===f.DESC||t===f.TITLE)}function Q8(t,e,n,r){return(!r||r===Y.HTML)&&X8(t,e,n)||(!r||r===Y.MATHML)&&J8(t,e)}const eB="hidden",tB=8,nB=3;var k;(function(t){t[t.INITIAL=0]="INITIAL",t[t.BEFORE_HTML=1]="BEFORE_HTML",t[t.BEFORE_HEAD=2]="BEFORE_HEAD",t[t.IN_HEAD=3]="IN_HEAD",t[t.IN_HEAD_NO_SCRIPT=4]="IN_HEAD_NO_SCRIPT",t[t.AFTER_HEAD=5]="AFTER_HEAD",t[t.IN_BODY=6]="IN_BODY",t[t.TEXT=7]="TEXT",t[t.IN_TABLE=8]="IN_TABLE",t[t.IN_TABLE_TEXT=9]="IN_TABLE_TEXT",t[t.IN_CAPTION=10]="IN_CAPTION",t[t.IN_COLUMN_GROUP=11]="IN_COLUMN_GROUP",t[t.IN_TABLE_BODY=12]="IN_TABLE_BODY",t[t.IN_ROW=13]="IN_ROW",t[t.IN_CELL=14]="IN_CELL",t[t.IN_SELECT=15]="IN_SELECT",t[t.IN_SELECT_IN_TABLE=16]="IN_SELECT_IN_TABLE",t[t.IN_TEMPLATE=17]="IN_TEMPLATE",t[t.AFTER_BODY=18]="AFTER_BODY",t[t.IN_FRAMESET=19]="IN_FRAMESET",t[t.AFTER_FRAMESET=20]="AFTER_FRAMESET",t[t.AFTER_AFTER_BODY=21]="AFTER_AFTER_BODY",t[t.AFTER_AFTER_FRAMESET=22]="AFTER_AFTER_FRAMESET"})(k||(k={}));const rB={startLine:-1,startCol:-1,startOffset:-1,endLine:-1,endCol:-1,endOffset:-1},Xw=new Set([f.TABLE,f.TBODY,f.TFOOT,f.THEAD,f.TR]),cb={scriptingEnabled:!0,sourceCodeLocationInfo:!1,treeAdapter:Ar,onParseError:null};let Qw=class{constructor(e,n,r=null,s=null){this.fragmentContext=r,this.scriptHandler=s,this.currentToken=null,this.stopped=!1,this.insertionMode=k.INITIAL,this.originalInsertionMode=k.INITIAL,this.headElement=null,this.formElement=null,this.currentNotInHTML=!1,this.tmplInsertionModeStack=[],this.pendingCharacterTokens=[],this.hasNonWhitespacePendingCharacterToken=!1,this.framesetOk=!0,this.skipNextNewLine=!1,this.fosterParentingEnabled=!1,this.options={...cb,...e},this.treeAdapter=this.options.treeAdapter,this.onParseError=this.options.onParseError,this.onParseError&&(this.options.sourceCodeLocationInfo=!0),this.document=n??this.treeAdapter.createDocument(),this.tokenizer=new O8(this.options,this),this.activeFormattingElements=new D8(this.treeAdapter),this.fragmentContextID=r?pl(this.treeAdapter.getTagName(r)):f.UNKNOWN,this._setContextModes(r??this.document,this.fragmentContextID),this.openElements=new L8(this.document,this.treeAdapter,this)}static parse(e,n){const r=new this(n);return r.tokenizer.write(e,!0),r.document}static getFragmentParser(e,n){const r={...cb,...n};e??(e=r.treeAdapter.createElement(L.TEMPLATE,Y.HTML,[]));const s=r.treeAdapter.createElement("documentmock",Y.HTML,[]),a=new this(r,s,e);return a.fragmentContextID===f.TEMPLATE&&a.tmplInsertionModeStack.unshift(k.IN_TEMPLATE),a._initTokenizerForFragmentParsing(),a._insertFakeRootElement(),a._resetInsertionMode(),a._findFormInFragmentContext(),a}getFragment(){const e=this.treeAdapter.getFirstChild(this.document),n=this.treeAdapter.createDocumentFragment();return this._adoptNodes(e,n),n}_err(e,n,r){var s;if(!this.onParseError)return;const a=(s=e.location)!==null&&s!==void 0?s:rB,i={code:n,startLine:a.startLine,startCol:a.startCol,startOffset:a.startOffset,endLine:r?a.startLine:a.endLine,endCol:r?a.startCol:a.endCol,endOffset:r?a.startOffset:a.endOffset};this.onParseError(i)}onItemPush(e,n,r){var s,a;(a=(s=this.treeAdapter).onItemPush)===null||a===void 0||a.call(s,e),r&&this.openElements.stackTop>0&&this._setContextModes(e,n)}onItemPop(e,n){var r,s;if(this.options.sourceCodeLocationInfo&&this._setEndLocation(e,this.currentToken),(s=(r=this.treeAdapter).onItemPop)===null||s===void 0||s.call(r,e,this.openElements.current),n){let a,i;this.openElements.stackTop===0&&this.fragmentContext?(a=this.fragmentContext,i=this.fragmentContextID):{current:a,currentTagId:i}=this.openElements,this._setContextModes(a,i)}}_setContextModes(e,n){const r=e===this.document||this.treeAdapter.getNamespaceURI(e)===Y.HTML;this.currentNotInHTML=!r,this.tokenizer.inForeignNode=!r&&!this._isIntegrationPoint(n,e)}_switchToTextParsing(e,n){this._insertElement(e,Y.HTML),this.tokenizer.state=n,this.originalInsertionMode=this.insertionMode,this.insertionMode=k.TEXT}switchToPlaintextParsing(){this.insertionMode=k.TEXT,this.originalInsertionMode=k.IN_BODY,this.tokenizer.state=tn.PLAINTEXT}_getAdjustedCurrentElement(){return this.openElements.stackTop===0&&this.fragmentContext?this.fragmentContext:this.openElements.current}_findFormInFragmentContext(){let e=this.fragmentContext;for(;e;){if(this.treeAdapter.getTagName(e)===L.FORM){this.formElement=e;break}e=this.treeAdapter.getParentNode(e)}}_initTokenizerForFragmentParsing(){if(!(!this.fragmentContext||this.treeAdapter.getNamespaceURI(this.fragmentContext)!==Y.HTML))switch(this.fragmentContextID){case f.TITLE:case f.TEXTAREA:{this.tokenizer.state=tn.RCDATA;break}case f.STYLE:case f.XMP:case f.IFRAME:case f.NOEMBED:case f.NOFRAMES:case f.NOSCRIPT:{this.tokenizer.state=tn.RAWTEXT;break}case f.SCRIPT:{this.tokenizer.state=tn.SCRIPT_DATA;break}case f.PLAINTEXT:{this.tokenizer.state=tn.PLAINTEXT;break}}}_setDocumentType(e){const n=e.name||"",r=e.publicId||"",s=e.systemId||"";if(this.treeAdapter.setDocumentType(this.document,n,r,s),e.location){const i=this.treeAdapter.getChildNodes(this.document).find(o=>this.treeAdapter.isDocumentTypeNode(o));i&&this.treeAdapter.setNodeSourceCodeLocation(i,e.location)}}_attachElementToTree(e,n){if(this.options.sourceCodeLocationInfo){const r=n&&{...n,startTag:n};this.treeAdapter.setNodeSourceCodeLocation(e,r)}if(this._shouldFosterParentOnInsertion())this._fosterParentElement(e);else{const r=this.openElements.currentTmplContentOrNode;this.treeAdapter.appendChild(r,e)}}_appendElement(e,n){const r=this.treeAdapter.createElement(e.tagName,n,e.attrs);this._attachElementToTree(r,e.location)}_insertElement(e,n){const r=this.treeAdapter.createElement(e.tagName,n,e.attrs);this._attachElementToTree(r,e.location),this.openElements.push(r,e.tagID)}_insertFakeElement(e,n){const r=this.treeAdapter.createElement(e,Y.HTML,[]);this._attachElementToTree(r,null),this.openElements.push(r,n)}_insertTemplate(e){const n=this.treeAdapter.createElement(e.tagName,Y.HTML,e.attrs),r=this.treeAdapter.createDocumentFragment();this.treeAdapter.setTemplateContent(n,r),this._attachElementToTree(n,e.location),this.openElements.push(n,e.tagID),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(r,null)}_insertFakeRootElement(){const e=this.treeAdapter.createElement(L.HTML,Y.HTML,[]);this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(e,null),this.treeAdapter.appendChild(this.openElements.current,e),this.openElements.push(e,f.HTML)}_appendCommentNode(e,n){const r=this.treeAdapter.createCommentNode(e.data);this.treeAdapter.appendChild(n,r),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(r,e.location)}_insertCharacters(e){let n,r;if(this._shouldFosterParentOnInsertion()?({parent:n,beforeElement:r}=this._findFosterParentingLocation(),r?this.treeAdapter.insertTextBefore(n,e.chars,r):this.treeAdapter.insertText(n,e.chars)):(n=this.openElements.currentTmplContentOrNode,this.treeAdapter.insertText(n,e.chars)),!e.location)return;const s=this.treeAdapter.getChildNodes(n),a=r?s.lastIndexOf(r):s.length,i=s[a-1];if(this.treeAdapter.getNodeSourceCodeLocation(i)){const{endLine:u,endCol:c,endOffset:l}=e.location;this.treeAdapter.updateNodeSourceCodeLocation(i,{endLine:u,endCol:c,endOffset:l})}else this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(i,e.location)}_adoptNodes(e,n){for(let r=this.treeAdapter.getFirstChild(e);r;r=this.treeAdapter.getFirstChild(e))this.treeAdapter.detachNode(r),this.treeAdapter.appendChild(n,r)}_setEndLocation(e,n){if(this.treeAdapter.getNodeSourceCodeLocation(e)&&n.location){const r=n.location,s=this.treeAdapter.getTagName(e),a=n.type===He.END_TAG&&s===n.tagName?{endTag:{...r},endLine:r.endLine,endCol:r.endCol,endOffset:r.endOffset}:{endLine:r.startLine,endCol:r.startCol,endOffset:r.startOffset};this.treeAdapter.updateNodeSourceCodeLocation(e,a)}}shouldProcessStartTagTokenInForeignContent(e){if(!this.currentNotInHTML)return!1;let n,r;return this.openElements.stackTop===0&&this.fragmentContext?(n=this.fragmentContext,r=this.fragmentContextID):{current:n,currentTagId:r}=this.openElements,e.tagID===f.SVG&&this.treeAdapter.getTagName(n)===L.ANNOTATION_XML&&this.treeAdapter.getNamespaceURI(n)===Y.MATHML?!1:this.tokenizer.inForeignNode||(e.tagID===f.MGLYPH||e.tagID===f.MALIGNMARK)&&!this._isIntegrationPoint(r,n,Y.HTML)}_processToken(e){switch(e.type){case He.CHARACTER:{this.onCharacter(e);break}case He.NULL_CHARACTER:{this.onNullCharacter(e);break}case He.COMMENT:{this.onComment(e);break}case He.DOCTYPE:{this.onDoctype(e);break}case He.START_TAG:{this._processStartTag(e);break}case He.END_TAG:{this.onEndTag(e);break}case He.EOF:{this.onEof(e);break}case He.WHITESPACE_CHARACTER:{this.onWhitespaceCharacter(e);break}}}_isIntegrationPoint(e,n,r){const s=this.treeAdapter.getNamespaceURI(n),a=this.treeAdapter.getAttrList(n);return Q8(e,s,a,r)}_reconstructActiveFormattingElements(){const e=this.activeFormattingElements.entries.length;if(e){const n=this.activeFormattingElements.entries.findIndex(s=>s.type===ar.Marker||this.openElements.contains(s.element)),r=n<0?e-1:n-1;for(let s=r;s>=0;s--){const a=this.activeFormattingElements.entries[s];this._insertElement(a.token,this.treeAdapter.getNamespaceURI(a.element)),a.element=this.openElements.current}}}_closeTableCell(){this.openElements.generateImpliedEndTags(),this.openElements.popUntilTableCellPopped(),this.activeFormattingElements.clearToLastMarker(),this.insertionMode=k.IN_ROW}_closePElement(){this.openElements.generateImpliedEndTagsWithExclusion(f.P),this.openElements.popUntilTagNamePopped(f.P)}_resetInsertionMode(){for(let e=this.openElements.stackTop;e>=0;e--)switch(e===0&&this.fragmentContext?this.fragmentContextID:this.openElements.tagIDs[e]){case f.TR:{this.insertionMode=k.IN_ROW;return}case f.TBODY:case f.THEAD:case f.TFOOT:{this.insertionMode=k.IN_TABLE_BODY;return}case f.CAPTION:{this.insertionMode=k.IN_CAPTION;return}case f.COLGROUP:{this.insertionMode=k.IN_COLUMN_GROUP;return}case f.TABLE:{this.insertionMode=k.IN_TABLE;return}case f.BODY:{this.insertionMode=k.IN_BODY;return}case f.FRAMESET:{this.insertionMode=k.IN_FRAMESET;return}case f.SELECT:{this._resetInsertionModeForSelect(e);return}case f.TEMPLATE:{this.insertionMode=this.tmplInsertionModeStack[0];return}case f.HTML:{this.insertionMode=this.headElement?k.AFTER_HEAD:k.BEFORE_HEAD;return}case f.TD:case f.TH:{if(e>0){this.insertionMode=k.IN_CELL;return}break}case f.HEAD:{if(e>0){this.insertionMode=k.IN_HEAD;return}break}}this.insertionMode=k.IN_BODY}_resetInsertionModeForSelect(e){if(e>0)for(let n=e-1;n>0;n--){const r=this.openElements.tagIDs[n];if(r===f.TEMPLATE)break;if(r===f.TABLE){this.insertionMode=k.IN_SELECT_IN_TABLE;return}}this.insertionMode=k.IN_SELECT}_isElementCausesFosterParenting(e){return Xw.has(e)}_shouldFosterParentOnInsertion(){return this.fosterParentingEnabled&&this._isElementCausesFosterParenting(this.openElements.currentTagId)}_findFosterParentingLocation(){for(let e=this.openElements.stackTop;e>=0;e--){const n=this.openElements.items[e];switch(this.openElements.tagIDs[e]){case f.TEMPLATE:{if(this.treeAdapter.getNamespaceURI(n)===Y.HTML)return{parent:this.treeAdapter.getTemplateContent(n),beforeElement:null};break}case f.TABLE:{const r=this.treeAdapter.getParentNode(n);return r?{parent:r,beforeElement:n}:{parent:this.openElements.items[e-1],beforeElement:null}}}}return{parent:this.openElements.items[0],beforeElement:null}}_fosterParentElement(e){const n=this._findFosterParentingLocation();n.beforeElement?this.treeAdapter.insertBefore(n.parent,e,n.beforeElement):this.treeAdapter.appendChild(n.parent,e)}_isSpecialElement(e,n){const r=this.treeAdapter.getNamespaceURI(e);return w8[r].has(n)}onCharacter(e){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){x9(this,e);return}switch(this.insertionMode){case k.INITIAL:{Za(this,e);break}case k.BEFORE_HTML:{Ei(this,e);break}case k.BEFORE_HEAD:{wi(this,e);break}case k.IN_HEAD:{Ti(this,e);break}case k.IN_HEAD_NO_SCRIPT:{Si(this,e);break}case k.AFTER_HEAD:{Ai(this,e);break}case k.IN_BODY:case k.IN_CAPTION:case k.IN_CELL:case k.IN_TEMPLATE:{tT(this,e);break}case k.TEXT:case k.IN_SELECT:case k.IN_SELECT_IN_TABLE:{this._insertCharacters(e);break}case k.IN_TABLE:case k.IN_TABLE_BODY:case k.IN_ROW:{Ld(this,e);break}case k.IN_TABLE_TEXT:{oT(this,e);break}case k.IN_COLUMN_GROUP:{Sc(this,e);break}case k.AFTER_BODY:{Ac(this,e);break}case k.AFTER_AFTER_BODY:{Ru(this,e);break}}}onNullCharacter(e){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){P9(this,e);return}switch(this.insertionMode){case k.INITIAL:{Za(this,e);break}case k.BEFORE_HTML:{Ei(this,e);break}case k.BEFORE_HEAD:{wi(this,e);break}case k.IN_HEAD:{Ti(this,e);break}case k.IN_HEAD_NO_SCRIPT:{Si(this,e);break}case k.AFTER_HEAD:{Ai(this,e);break}case k.TEXT:{this._insertCharacters(e);break}case k.IN_TABLE:case k.IN_TABLE_BODY:case k.IN_ROW:{Ld(this,e);break}case k.IN_COLUMN_GROUP:{Sc(this,e);break}case k.AFTER_BODY:{Ac(this,e);break}case k.AFTER_AFTER_BODY:{Ru(this,e);break}}}onComment(e){if(this.skipNextNewLine=!1,this.currentNotInHTML){Xh(this,e);return}switch(this.insertionMode){case k.INITIAL:case k.BEFORE_HTML:case k.BEFORE_HEAD:case k.IN_HEAD:case k.IN_HEAD_NO_SCRIPT:case k.AFTER_HEAD:case k.IN_BODY:case k.IN_TABLE:case k.IN_CAPTION:case k.IN_COLUMN_GROUP:case k.IN_TABLE_BODY:case k.IN_ROW:case k.IN_CELL:case k.IN_SELECT:case k.IN_SELECT_IN_TABLE:case k.IN_TEMPLATE:case k.IN_FRAMESET:case k.AFTER_FRAMESET:{Xh(this,e);break}case k.IN_TABLE_TEXT:{Ja(this,e);break}case k.AFTER_BODY:{lB(this,e);break}case k.AFTER_AFTER_BODY:case k.AFTER_AFTER_FRAMESET:{dB(this,e);break}}}onDoctype(e){switch(this.skipNextNewLine=!1,this.insertionMode){case k.INITIAL:{hB(this,e);break}case k.BEFORE_HEAD:case k.IN_HEAD:case k.IN_HEAD_NO_SCRIPT:case k.AFTER_HEAD:{this._err(e,$.misplacedDoctype);break}case k.IN_TABLE_TEXT:{Ja(this,e);break}}}onStartTag(e){this.skipNextNewLine=!1,this.currentToken=e,this._processStartTag(e),e.selfClosing&&!e.ackSelfClosing&&this._err(e,$.nonVoidHtmlElementStartTagWithTrailingSolidus)}_processStartTag(e){this.shouldProcessStartTagTokenInForeignContent(e)?L9(this,e):this._startTagOutsideForeignContent(e)}_startTagOutsideForeignContent(e){switch(this.insertionMode){case k.INITIAL:{Za(this,e);break}case k.BEFORE_HTML:{fB(this,e);break}case k.BEFORE_HEAD:{pB(this,e);break}case k.IN_HEAD:{Jn(this,e);break}case k.IN_HEAD_NO_SCRIPT:{_B(this,e);break}case k.AFTER_HEAD:{EB(this,e);break}case k.IN_BODY:{Ht(this,e);break}case k.IN_TABLE:{_a(this,e);break}case k.IN_TABLE_TEXT:{Ja(this,e);break}case k.IN_CAPTION:{g9(this,e);break}case k.IN_COLUMN_GROUP:{Bm(this,e);break}case k.IN_TABLE_BODY:{_l(this,e);break}case k.IN_ROW:{yl(this,e);break}case k.IN_CELL:{y9(this,e);break}case k.IN_SELECT:{lT(this,e);break}case k.IN_SELECT_IN_TABLE:{w9(this,e);break}case k.IN_TEMPLATE:{S9(this,e);break}case k.AFTER_BODY:{C9(this,e);break}case k.IN_FRAMESET:{v9(this,e);break}case k.AFTER_FRAMESET:{k9(this,e);break}case k.AFTER_AFTER_BODY:{N9(this,e);break}case k.AFTER_AFTER_FRAMESET:{R9(this,e);break}}}onEndTag(e){this.skipNextNewLine=!1,this.currentToken=e,this.currentNotInHTML?D9(this,e):this._endTagOutsideForeignContent(e)}_endTagOutsideForeignContent(e){switch(this.insertionMode){case k.INITIAL:{Za(this,e);break}case k.BEFORE_HTML:{mB(this,e);break}case k.BEFORE_HEAD:{gB(this,e);break}case k.IN_HEAD:{bB(this,e);break}case k.IN_HEAD_NO_SCRIPT:{yB(this,e);break}case k.AFTER_HEAD:{wB(this,e);break}case k.IN_BODY:{bl(this,e);break}case k.TEXT:{i9(this,e);break}case k.IN_TABLE:{to(this,e);break}case k.IN_TABLE_TEXT:{Ja(this,e);break}case k.IN_CAPTION:{b9(this,e);break}case k.IN_COLUMN_GROUP:{_9(this,e);break}case k.IN_TABLE_BODY:{Qh(this,e);break}case k.IN_ROW:{cT(this,e);break}case k.IN_CELL:{E9(this,e);break}case k.IN_SELECT:{dT(this,e);break}case k.IN_SELECT_IN_TABLE:{T9(this,e);break}case k.IN_TEMPLATE:{A9(this,e);break}case k.AFTER_BODY:{fT(this,e);break}case k.IN_FRAMESET:{O9(this,e);break}case k.AFTER_FRAMESET:{I9(this,e);break}case k.AFTER_AFTER_BODY:{Ru(this,e);break}}}onEof(e){switch(this.insertionMode){case k.INITIAL:{Za(this,e);break}case k.BEFORE_HTML:{Ei(this,e);break}case k.BEFORE_HEAD:{wi(this,e);break}case k.IN_HEAD:{Ti(this,e);break}case k.IN_HEAD_NO_SCRIPT:{Si(this,e);break}case k.AFTER_HEAD:{Ai(this,e);break}case k.IN_BODY:case k.IN_TABLE:case k.IN_CAPTION:case k.IN_COLUMN_GROUP:case k.IN_TABLE_BODY:case k.IN_ROW:case k.IN_CELL:case k.IN_SELECT:case k.IN_SELECT_IN_TABLE:{aT(this,e);break}case k.TEXT:{o9(this,e);break}case k.IN_TABLE_TEXT:{Ja(this,e);break}case k.IN_TEMPLATE:{hT(this,e);break}case k.AFTER_BODY:case k.IN_FRAMESET:case k.AFTER_FRAMESET:case k.AFTER_AFTER_BODY:case k.AFTER_AFTER_FRAMESET:{Mm(this,e);break}}}onWhitespaceCharacter(e){if(this.skipNextNewLine&&(this.skipNextNewLine=!1,e.chars.charCodeAt(0)===A.LINE_FEED)){if(e.chars.length===1)return;e.chars=e.chars.substr(1)}if(this.tokenizer.inForeignNode){this._insertCharacters(e);return}switch(this.insertionMode){case k.IN_HEAD:case k.IN_HEAD_NO_SCRIPT:case k.AFTER_HEAD:case k.TEXT:case k.IN_COLUMN_GROUP:case k.IN_SELECT:case k.IN_SELECT_IN_TABLE:case k.IN_FRAMESET:case k.AFTER_FRAMESET:{this._insertCharacters(e);break}case k.IN_BODY:case k.IN_CAPTION:case k.IN_CELL:case k.IN_TEMPLATE:case k.AFTER_BODY:case k.AFTER_AFTER_BODY:case k.AFTER_AFTER_FRAMESET:{eT(this,e);break}case k.IN_TABLE:case k.IN_TABLE_BODY:case k.IN_ROW:{Ld(this,e);break}case k.IN_TABLE_TEXT:{iT(this,e);break}}}};function sB(t,e){let n=t.activeFormattingElements.getElementEntryInScopeWithTagName(e.tagName);return n?t.openElements.contains(n.element)?t.openElements.hasInScope(e.tagID)||(n=null):(t.activeFormattingElements.removeEntry(n),n=null):sT(t,e),n}function aB(t,e){let n=null,r=t.openElements.stackTop;for(;r>=0;r--){const s=t.openElements.items[r];if(s===e.element)break;t._isSpecialElement(s,t.openElements.tagIDs[r])&&(n=s)}return n||(t.openElements.shortenToLength(r<0?0:r),t.activeFormattingElements.removeEntry(e)),n}function iB(t,e,n){let r=e,s=t.openElements.getCommonAncestor(e);for(let a=0,i=s;i!==n;a++,i=s){s=t.openElements.getCommonAncestor(i);const o=t.activeFormattingElements.getElementEntry(i),u=o&&a>=nB;!o||u?(u&&t.activeFormattingElements.removeEntry(o),t.openElements.remove(i)):(i=oB(t,o),r===e&&(t.activeFormattingElements.bookmark=o),t.treeAdapter.detachNode(r),t.treeAdapter.appendChild(i,r),r=i)}return r}function oB(t,e){const n=t.treeAdapter.getNamespaceURI(e.element),r=t.treeAdapter.createElement(e.token.tagName,n,e.token.attrs);return t.openElements.replace(e.element,r),e.element=r,r}function uB(t,e,n){const r=t.treeAdapter.getTagName(e),s=pl(r);if(t._isElementCausesFosterParenting(s))t._fosterParentElement(n);else{const a=t.treeAdapter.getNamespaceURI(e);s===f.TEMPLATE&&a===Y.HTML&&(e=t.treeAdapter.getTemplateContent(e)),t.treeAdapter.appendChild(e,n)}}function cB(t,e,n){const r=t.treeAdapter.getNamespaceURI(n.element),{token:s}=n,a=t.treeAdapter.createElement(s.tagName,r,s.attrs);t._adoptNodes(e,a),t.treeAdapter.appendChild(e,a),t.activeFormattingElements.insertElementAfterBookmark(a,s),t.activeFormattingElements.removeEntry(n),t.openElements.remove(n.element),t.openElements.insertAfter(e,a,s.tagID)}function Dm(t,e){for(let n=0;n<tB;n++){const r=sB(t,e);if(!r)break;const s=aB(t,r);if(!s)break;t.activeFormattingElements.bookmark=r;const a=iB(t,s,r.element),i=t.openElements.getCommonAncestor(r.element);t.treeAdapter.detachNode(a),i&&uB(t,i,a),cB(t,s,r)}}function Xh(t,e){t._appendCommentNode(e,t.openElements.currentTmplContentOrNode)}function lB(t,e){t._appendCommentNode(e,t.openElements.items[0])}function dB(t,e){t._appendCommentNode(e,t.document)}function Mm(t,e){if(t.stopped=!0,e.location){const n=t.fragmentContext?0:2;for(let r=t.openElements.stackTop;r>=n;r--)t._setEndLocation(t.openElements.items[r],e);if(!t.fragmentContext&&t.openElements.stackTop>=0){const r=t.openElements.items[0],s=t.treeAdapter.getNodeSourceCodeLocation(r);if(s&&!s.endTag&&(t._setEndLocation(r,e),t.openElements.stackTop>=1)){const a=t.openElements.items[1],i=t.treeAdapter.getNodeSourceCodeLocation(a);i&&!i.endTag&&t._setEndLocation(a,e)}}}}function hB(t,e){t._setDocumentType(e);const n=e.forceQuirks?fn.QUIRKS:$8(e);H8(e)||t._err(e,$.nonConformingDoctype),t.treeAdapter.setDocumentMode(t.document,n),t.insertionMode=k.BEFORE_HTML}function Za(t,e){t._err(e,$.missingDoctype,!0),t.treeAdapter.setDocumentMode(t.document,fn.QUIRKS),t.insertionMode=k.BEFORE_HTML,t._processToken(e)}function fB(t,e){e.tagID===f.HTML?(t._insertElement(e,Y.HTML),t.insertionMode=k.BEFORE_HEAD):Ei(t,e)}function mB(t,e){const n=e.tagID;(n===f.HTML||n===f.HEAD||n===f.BODY||n===f.BR)&&Ei(t,e)}function Ei(t,e){t._insertFakeRootElement(),t.insertionMode=k.BEFORE_HEAD,t._processToken(e)}function pB(t,e){switch(e.tagID){case f.HTML:{Ht(t,e);break}case f.HEAD:{t._insertElement(e,Y.HTML),t.headElement=t.openElements.current,t.insertionMode=k.IN_HEAD;break}default:wi(t,e)}}function gB(t,e){const n=e.tagID;n===f.HEAD||n===f.BODY||n===f.HTML||n===f.BR?wi(t,e):t._err(e,$.endTagWithoutMatchingOpenElement)}function wi(t,e){t._insertFakeElement(L.HEAD,f.HEAD),t.headElement=t.openElements.current,t.insertionMode=k.IN_HEAD,t._processToken(e)}function Jn(t,e){switch(e.tagID){case f.HTML:{Ht(t,e);break}case f.BASE:case f.BASEFONT:case f.BGSOUND:case f.LINK:case f.META:{t._appendElement(e,Y.HTML),e.ackSelfClosing=!0;break}case f.TITLE:{t._switchToTextParsing(e,tn.RCDATA);break}case f.NOSCRIPT:{t.options.scriptingEnabled?t._switchToTextParsing(e,tn.RAWTEXT):(t._insertElement(e,Y.HTML),t.insertionMode=k.IN_HEAD_NO_SCRIPT);break}case f.NOFRAMES:case f.STYLE:{t._switchToTextParsing(e,tn.RAWTEXT);break}case f.SCRIPT:{t._switchToTextParsing(e,tn.SCRIPT_DATA);break}case f.TEMPLATE:{t._insertTemplate(e),t.activeFormattingElements.insertMarker(),t.framesetOk=!1,t.insertionMode=k.IN_TEMPLATE,t.tmplInsertionModeStack.unshift(k.IN_TEMPLATE);break}case f.HEAD:{t._err(e,$.misplacedStartTagForHeadElement);break}default:Ti(t,e)}}function bB(t,e){switch(e.tagID){case f.HEAD:{t.openElements.pop(),t.insertionMode=k.AFTER_HEAD;break}case f.BODY:case f.BR:case f.HTML:{Ti(t,e);break}case f.TEMPLATE:{Ls(t,e);break}default:t._err(e,$.endTagWithoutMatchingOpenElement)}}function Ls(t,e){t.openElements.tmplCount>0?(t.openElements.generateImpliedEndTagsThoroughly(),t.openElements.currentTagId!==f.TEMPLATE&&t._err(e,$.closingOfElementWithOpenChildElements),t.openElements.popUntilTagNamePopped(f.TEMPLATE),t.activeFormattingElements.clearToLastMarker(),t.tmplInsertionModeStack.shift(),t._resetInsertionMode()):t._err(e,$.endTagWithoutMatchingOpenElement)}function Ti(t,e){t.openElements.pop(),t.insertionMode=k.AFTER_HEAD,t._processToken(e)}function _B(t,e){switch(e.tagID){case f.HTML:{Ht(t,e);break}case f.BASEFONT:case f.BGSOUND:case f.HEAD:case f.LINK:case f.META:case f.NOFRAMES:case f.STYLE:{Jn(t,e);break}case f.NOSCRIPT:{t._err(e,$.nestedNoscriptInHead);break}default:Si(t,e)}}function yB(t,e){switch(e.tagID){case f.NOSCRIPT:{t.openElements.pop(),t.insertionMode=k.IN_HEAD;break}case f.BR:{Si(t,e);break}default:t._err(e,$.endTagWithoutMatchingOpenElement)}}function Si(t,e){const n=e.type===He.EOF?$.openElementsLeftAfterEof:$.disallowedContentInNoscriptInHead;t._err(e,n),t.openElements.pop(),t.insertionMode=k.IN_HEAD,t._processToken(e)}function EB(t,e){switch(e.tagID){case f.HTML:{Ht(t,e);break}case f.BODY:{t._insertElement(e,Y.HTML),t.framesetOk=!1,t.insertionMode=k.IN_BODY;break}case f.FRAMESET:{t._insertElement(e,Y.HTML),t.insertionMode=k.IN_FRAMESET;break}case f.BASE:case f.BASEFONT:case f.BGSOUND:case f.LINK:case f.META:case f.NOFRAMES:case f.SCRIPT:case f.STYLE:case f.TEMPLATE:case f.TITLE:{t._err(e,$.abandonedHeadElementChild),t.openElements.push(t.headElement,f.HEAD),Jn(t,e),t.openElements.remove(t.headElement);break}case f.HEAD:{t._err(e,$.misplacedStartTagForHeadElement);break}default:Ai(t,e)}}function wB(t,e){switch(e.tagID){case f.BODY:case f.HTML:case f.BR:{Ai(t,e);break}case f.TEMPLATE:{Ls(t,e);break}default:t._err(e,$.endTagWithoutMatchingOpenElement)}}function Ai(t,e){t._insertFakeElement(L.BODY,f.BODY),t.insertionMode=k.IN_BODY,gl(t,e)}function gl(t,e){switch(e.type){case He.CHARACTER:{tT(t,e);break}case He.WHITESPACE_CHARACTER:{eT(t,e);break}case He.COMMENT:{Xh(t,e);break}case He.START_TAG:{Ht(t,e);break}case He.END_TAG:{bl(t,e);break}case He.EOF:{aT(t,e);break}}}function eT(t,e){t._reconstructActiveFormattingElements(),t._insertCharacters(e)}function tT(t,e){t._reconstructActiveFormattingElements(),t._insertCharacters(e),t.framesetOk=!1}function TB(t,e){t.openElements.tmplCount===0&&t.treeAdapter.adoptAttributes(t.openElements.items[0],e.attrs)}function SB(t,e){const n=t.openElements.tryPeekProperlyNestedBodyElement();n&&t.openElements.tmplCount===0&&(t.framesetOk=!1,t.treeAdapter.adoptAttributes(n,e.attrs))}function AB(t,e){const n=t.openElements.tryPeekProperlyNestedBodyElement();t.framesetOk&&n&&(t.treeAdapter.detachNode(n),t.openElements.popAllUpToHtmlElement(),t._insertElement(e,Y.HTML),t.insertionMode=k.IN_FRAMESET)}function CB(t,e){t.openElements.hasInButtonScope(f.P)&&t._closePElement(),t._insertElement(e,Y.HTML)}function vB(t,e){t.openElements.hasInButtonScope(f.P)&&t._closePElement(),Jh.has(t.openElements.currentTagId)&&t.openElements.pop(),t._insertElement(e,Y.HTML)}function OB(t,e){t.openElements.hasInButtonScope(f.P)&&t._closePElement(),t._insertElement(e,Y.HTML),t.skipNextNewLine=!0,t.framesetOk=!1}function kB(t,e){const n=t.openElements.tmplCount>0;(!t.formElement||n)&&(t.openElements.hasInButtonScope(f.P)&&t._closePElement(),t._insertElement(e,Y.HTML),n||(t.formElement=t.openElements.current))}function IB(t,e){t.framesetOk=!1;const n=e.tagID;for(let r=t.openElements.stackTop;r>=0;r--){const s=t.openElements.tagIDs[r];if(n===f.LI&&s===f.LI||(n===f.DD||n===f.DT)&&(s===f.DD||s===f.DT)){t.openElements.generateImpliedEndTagsWithExclusion(s),t.openElements.popUntilTagNamePopped(s);break}if(s!==f.ADDRESS&&s!==f.DIV&&s!==f.P&&t._isSpecialElement(t.openElements.items[r],s))break}t.openElements.hasInButtonScope(f.P)&&t._closePElement(),t._insertElement(e,Y.HTML)}function NB(t,e){t.openElements.hasInButtonScope(f.P)&&t._closePElement(),t._insertElement(e,Y.HTML),t.tokenizer.state=tn.PLAINTEXT}function RB(t,e){t.openElements.hasInScope(f.BUTTON)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(f.BUTTON)),t._reconstructActiveFormattingElements(),t._insertElement(e,Y.HTML),t.framesetOk=!1}function PB(t,e){const n=t.activeFormattingElements.getElementEntryInScopeWithTagName(L.A);n&&(Dm(t,e),t.openElements.remove(n.element),t.activeFormattingElements.removeEntry(n)),t._reconstructActiveFormattingElements(),t._insertElement(e,Y.HTML),t.activeFormattingElements.pushElement(t.openElements.current,e)}function xB(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,Y.HTML),t.activeFormattingElements.pushElement(t.openElements.current,e)}function LB(t,e){t._reconstructActiveFormattingElements(),t.openElements.hasInScope(f.NOBR)&&(Dm(t,e),t._reconstructActiveFormattingElements()),t._insertElement(e,Y.HTML),t.activeFormattingElements.pushElement(t.openElements.current,e)}function DB(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,Y.HTML),t.activeFormattingElements.insertMarker(),t.framesetOk=!1}function MB(t,e){t.treeAdapter.getDocumentMode(t.document)!==fn.QUIRKS&&t.openElements.hasInButtonScope(f.P)&&t._closePElement(),t._insertElement(e,Y.HTML),t.framesetOk=!1,t.insertionMode=k.IN_TABLE}function nT(t,e){t._reconstructActiveFormattingElements(),t._appendElement(e,Y.HTML),t.framesetOk=!1,e.ackSelfClosing=!0}function rT(t){const e=Vw(t,ys.TYPE);return e!=null&&e.toLowerCase()===eB}function BB(t,e){t._reconstructActiveFormattingElements(),t._appendElement(e,Y.HTML),rT(e)||(t.framesetOk=!1),e.ackSelfClosing=!0}function FB(t,e){t._appendElement(e,Y.HTML),e.ackSelfClosing=!0}function UB(t,e){t.openElements.hasInButtonScope(f.P)&&t._closePElement(),t._appendElement(e,Y.HTML),t.framesetOk=!1,e.ackSelfClosing=!0}function jB(t,e){e.tagName=L.IMG,e.tagID=f.IMG,nT(t,e)}function HB(t,e){t._insertElement(e,Y.HTML),t.skipNextNewLine=!0,t.tokenizer.state=tn.RCDATA,t.originalInsertionMode=t.insertionMode,t.framesetOk=!1,t.insertionMode=k.TEXT}function $B(t,e){t.openElements.hasInButtonScope(f.P)&&t._closePElement(),t._reconstructActiveFormattingElements(),t.framesetOk=!1,t._switchToTextParsing(e,tn.RAWTEXT)}function qB(t,e){t.framesetOk=!1,t._switchToTextParsing(e,tn.RAWTEXT)}function lb(t,e){t._switchToTextParsing(e,tn.RAWTEXT)}function VB(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,Y.HTML),t.framesetOk=!1,t.insertionMode=t.insertionMode===k.IN_TABLE||t.insertionMode===k.IN_CAPTION||t.insertionMode===k.IN_TABLE_BODY||t.insertionMode===k.IN_ROW||t.insertionMode===k.IN_CELL?k.IN_SELECT_IN_TABLE:k.IN_SELECT}function zB(t,e){t.openElements.currentTagId===f.OPTION&&t.openElements.pop(),t._reconstructActiveFormattingElements(),t._insertElement(e,Y.HTML)}function WB(t,e){t.openElements.hasInScope(f.RUBY)&&t.openElements.generateImpliedEndTags(),t._insertElement(e,Y.HTML)}function GB(t,e){t.openElements.hasInScope(f.RUBY)&&t.openElements.generateImpliedEndTagsWithExclusion(f.RTC),t._insertElement(e,Y.HTML)}function KB(t,e){t._reconstructActiveFormattingElements(),Zw(e),Lm(e),e.selfClosing?t._appendElement(e,Y.MATHML):t._insertElement(e,Y.MATHML),e.ackSelfClosing=!0}function YB(t,e){t._reconstructActiveFormattingElements(),Jw(e),Lm(e),e.selfClosing?t._appendElement(e,Y.SVG):t._insertElement(e,Y.SVG),e.ackSelfClosing=!0}function db(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,Y.HTML)}function Ht(t,e){switch(e.tagID){case f.I:case f.S:case f.B:case f.U:case f.EM:case f.TT:case f.BIG:case f.CODE:case f.FONT:case f.SMALL:case f.STRIKE:case f.STRONG:{xB(t,e);break}case f.A:{PB(t,e);break}case f.H1:case f.H2:case f.H3:case f.H4:case f.H5:case f.H6:{vB(t,e);break}case f.P:case f.DL:case f.OL:case f.UL:case f.DIV:case f.DIR:case f.NAV:case f.MAIN:case f.MENU:case f.ASIDE:case f.CENTER:case f.FIGURE:case f.FOOTER:case f.HEADER:case f.HGROUP:case f.DIALOG:case f.DETAILS:case f.ADDRESS:case f.ARTICLE:case f.SEARCH:case f.SECTION:case f.SUMMARY:case f.FIELDSET:case f.BLOCKQUOTE:case f.FIGCAPTION:{CB(t,e);break}case f.LI:case f.DD:case f.DT:{IB(t,e);break}case f.BR:case f.IMG:case f.WBR:case f.AREA:case f.EMBED:case f.KEYGEN:{nT(t,e);break}case f.HR:{UB(t,e);break}case f.RB:case f.RTC:{WB(t,e);break}case f.RT:case f.RP:{GB(t,e);break}case f.PRE:case f.LISTING:{OB(t,e);break}case f.XMP:{$B(t,e);break}case f.SVG:{YB(t,e);break}case f.HTML:{TB(t,e);break}case f.BASE:case f.LINK:case f.META:case f.STYLE:case f.TITLE:case f.SCRIPT:case f.BGSOUND:case f.BASEFONT:case f.TEMPLATE:{Jn(t,e);break}case f.BODY:{SB(t,e);break}case f.FORM:{kB(t,e);break}case f.NOBR:{LB(t,e);break}case f.MATH:{KB(t,e);break}case f.TABLE:{MB(t,e);break}case f.INPUT:{BB(t,e);break}case f.PARAM:case f.TRACK:case f.SOURCE:{FB(t,e);break}case f.IMAGE:{jB(t,e);break}case f.BUTTON:{RB(t,e);break}case f.APPLET:case f.OBJECT:case f.MARQUEE:{DB(t,e);break}case f.IFRAME:{qB(t,e);break}case f.SELECT:{VB(t,e);break}case f.OPTION:case f.OPTGROUP:{zB(t,e);break}case f.NOEMBED:case f.NOFRAMES:{lb(t,e);break}case f.FRAMESET:{AB(t,e);break}case f.TEXTAREA:{HB(t,e);break}case f.NOSCRIPT:{t.options.scriptingEnabled?lb(t,e):db(t,e);break}case f.PLAINTEXT:{NB(t,e);break}case f.COL:case f.TH:case f.TD:case f.TR:case f.HEAD:case f.FRAME:case f.TBODY:case f.TFOOT:case f.THEAD:case f.CAPTION:case f.COLGROUP:break;default:db(t,e)}}function ZB(t,e){if(t.openElements.hasInScope(f.BODY)&&(t.insertionMode=k.AFTER_BODY,t.options.sourceCodeLocationInfo)){const n=t.openElements.tryPeekProperlyNestedBodyElement();n&&t._setEndLocation(n,e)}}function JB(t,e){t.openElements.hasInScope(f.BODY)&&(t.insertionMode=k.AFTER_BODY,fT(t,e))}function XB(t,e){const n=e.tagID;t.openElements.hasInScope(n)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(n))}function QB(t){const e=t.openElements.tmplCount>0,{formElement:n}=t;e||(t.formElement=null),(n||e)&&t.openElements.hasInScope(f.FORM)&&(t.openElements.generateImpliedEndTags(),e?t.openElements.popUntilTagNamePopped(f.FORM):n&&t.openElements.remove(n))}function e9(t){t.openElements.hasInButtonScope(f.P)||t._insertFakeElement(L.P,f.P),t._closePElement()}function t9(t){t.openElements.hasInListItemScope(f.LI)&&(t.openElements.generateImpliedEndTagsWithExclusion(f.LI),t.openElements.popUntilTagNamePopped(f.LI))}function n9(t,e){const n=e.tagID;t.openElements.hasInScope(n)&&(t.openElements.generateImpliedEndTagsWithExclusion(n),t.openElements.popUntilTagNamePopped(n))}function r9(t){t.openElements.hasNumberedHeaderInScope()&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilNumberedHeaderPopped())}function s9(t,e){const n=e.tagID;t.openElements.hasInScope(n)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(n),t.activeFormattingElements.clearToLastMarker())}function a9(t){t._reconstructActiveFormattingElements(),t._insertFakeElement(L.BR,f.BR),t.openElements.pop(),t.framesetOk=!1}function sT(t,e){const n=e.tagName,r=e.tagID;for(let s=t.openElements.stackTop;s>0;s--){const a=t.openElements.items[s],i=t.openElements.tagIDs[s];if(r===i&&(r!==f.UNKNOWN||t.treeAdapter.getTagName(a)===n)){t.openElements.generateImpliedEndTagsWithExclusion(r),t.openElements.stackTop>=s&&t.openElements.shortenToLength(s);break}if(t._isSpecialElement(a,i))break}}function bl(t,e){switch(e.tagID){case f.A:case f.B:case f.I:case f.S:case f.U:case f.EM:case f.TT:case f.BIG:case f.CODE:case f.FONT:case f.NOBR:case f.SMALL:case f.STRIKE:case f.STRONG:{Dm(t,e);break}case f.P:{e9(t);break}case f.DL:case f.UL:case f.OL:case f.DIR:case f.DIV:case f.NAV:case f.PRE:case f.MAIN:case f.MENU:case f.ASIDE:case f.BUTTON:case f.CENTER:case f.FIGURE:case f.FOOTER:case f.HEADER:case f.HGROUP:case f.DIALOG:case f.ADDRESS:case f.ARTICLE:case f.DETAILS:case f.SEARCH:case f.SECTION:case f.SUMMARY:case f.LISTING:case f.FIELDSET:case f.BLOCKQUOTE:case f.FIGCAPTION:{XB(t,e);break}case f.LI:{t9(t);break}case f.DD:case f.DT:{n9(t,e);break}case f.H1:case f.H2:case f.H3:case f.H4:case f.H5:case f.H6:{r9(t);break}case f.BR:{a9(t);break}case f.BODY:{ZB(t,e);break}case f.HTML:{JB(t,e);break}case f.FORM:{QB(t);break}case f.APPLET:case f.OBJECT:case f.MARQUEE:{s9(t,e);break}case f.TEMPLATE:{Ls(t,e);break}default:sT(t,e)}}function aT(t,e){t.tmplInsertionModeStack.length>0?hT(t,e):Mm(t,e)}function i9(t,e){var n;e.tagID===f.SCRIPT&&((n=t.scriptHandler)===null||n===void 0||n.call(t,t.openElements.current)),t.openElements.pop(),t.insertionMode=t.originalInsertionMode}function o9(t,e){t._err(e,$.eofInElementThatCanContainOnlyText),t.openElements.pop(),t.insertionMode=t.originalInsertionMode,t.onEof(e)}function Ld(t,e){if(Xw.has(t.openElements.currentTagId))switch(t.pendingCharacterTokens.length=0,t.hasNonWhitespacePendingCharacterToken=!1,t.originalInsertionMode=t.insertionMode,t.insertionMode=k.IN_TABLE_TEXT,e.type){case He.CHARACTER:{oT(t,e);break}case He.WHITESPACE_CHARACTER:{iT(t,e);break}}else ko(t,e)}function u9(t,e){t.openElements.clearBackToTableContext(),t.activeFormattingElements.insertMarker(),t._insertElement(e,Y.HTML),t.insertionMode=k.IN_CAPTION}function c9(t,e){t.openElements.clearBackToTableContext(),t._insertElement(e,Y.HTML),t.insertionMode=k.IN_COLUMN_GROUP}function l9(t,e){t.openElements.clearBackToTableContext(),t._insertFakeElement(L.COLGROUP,f.COLGROUP),t.insertionMode=k.IN_COLUMN_GROUP,Bm(t,e)}function d9(t,e){t.openElements.clearBackToTableContext(),t._insertElement(e,Y.HTML),t.insertionMode=k.IN_TABLE_BODY}function h9(t,e){t.openElements.clearBackToTableContext(),t._insertFakeElement(L.TBODY,f.TBODY),t.insertionMode=k.IN_TABLE_BODY,_l(t,e)}function f9(t,e){t.openElements.hasInTableScope(f.TABLE)&&(t.openElements.popUntilTagNamePopped(f.TABLE),t._resetInsertionMode(),t._processStartTag(e))}function m9(t,e){rT(e)?t._appendElement(e,Y.HTML):ko(t,e),e.ackSelfClosing=!0}function p9(t,e){!t.formElement&&t.openElements.tmplCount===0&&(t._insertElement(e,Y.HTML),t.formElement=t.openElements.current,t.openElements.pop())}function _a(t,e){switch(e.tagID){case f.TD:case f.TH:case f.TR:{h9(t,e);break}case f.STYLE:case f.SCRIPT:case f.TEMPLATE:{Jn(t,e);break}case f.COL:{l9(t,e);break}case f.FORM:{p9(t,e);break}case f.TABLE:{f9(t,e);break}case f.TBODY:case f.TFOOT:case f.THEAD:{d9(t,e);break}case f.INPUT:{m9(t,e);break}case f.CAPTION:{u9(t,e);break}case f.COLGROUP:{c9(t,e);break}default:ko(t,e)}}function to(t,e){switch(e.tagID){case f.TABLE:{t.openElements.hasInTableScope(f.TABLE)&&(t.openElements.popUntilTagNamePopped(f.TABLE),t._resetInsertionMode());break}case f.TEMPLATE:{Ls(t,e);break}case f.BODY:case f.CAPTION:case f.COL:case f.COLGROUP:case f.HTML:case f.TBODY:case f.TD:case f.TFOOT:case f.TH:case f.THEAD:case f.TR:break;default:ko(t,e)}}function ko(t,e){const n=t.fosterParentingEnabled;t.fosterParentingEnabled=!0,gl(t,e),t.fosterParentingEnabled=n}function iT(t,e){t.pendingCharacterTokens.push(e)}function oT(t,e){t.pendingCharacterTokens.push(e),t.hasNonWhitespacePendingCharacterToken=!0}function Ja(t,e){let n=0;if(t.hasNonWhitespacePendingCharacterToken)for(;n<t.pendingCharacterTokens.length;n++)ko(t,t.pendingCharacterTokens[n]);else for(;n<t.pendingCharacterTokens.length;n++)t._insertCharacters(t.pendingCharacterTokens[n]);t.insertionMode=t.originalInsertionMode,t._processToken(e)}const uT=new Set([f.CAPTION,f.COL,f.COLGROUP,f.TBODY,f.TD,f.TFOOT,f.TH,f.THEAD,f.TR]);function g9(t,e){const n=e.tagID;uT.has(n)?t.openElements.hasInTableScope(f.CAPTION)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(f.CAPTION),t.activeFormattingElements.clearToLastMarker(),t.insertionMode=k.IN_TABLE,_a(t,e)):Ht(t,e)}function b9(t,e){const n=e.tagID;switch(n){case f.CAPTION:case f.TABLE:{t.openElements.hasInTableScope(f.CAPTION)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(f.CAPTION),t.activeFormattingElements.clearToLastMarker(),t.insertionMode=k.IN_TABLE,n===f.TABLE&&to(t,e));break}case f.BODY:case f.COL:case f.COLGROUP:case f.HTML:case f.TBODY:case f.TD:case f.TFOOT:case f.TH:case f.THEAD:case f.TR:break;default:bl(t,e)}}function Bm(t,e){switch(e.tagID){case f.HTML:{Ht(t,e);break}case f.COL:{t._appendElement(e,Y.HTML),e.ackSelfClosing=!0;break}case f.TEMPLATE:{Jn(t,e);break}default:Sc(t,e)}}function _9(t,e){switch(e.tagID){case f.COLGROUP:{t.openElements.currentTagId===f.COLGROUP&&(t.openElements.pop(),t.insertionMode=k.IN_TABLE);break}case f.TEMPLATE:{Ls(t,e);break}case f.COL:break;default:Sc(t,e)}}function Sc(t,e){t.openElements.currentTagId===f.COLGROUP&&(t.openElements.pop(),t.insertionMode=k.IN_TABLE,t._processToken(e))}function _l(t,e){switch(e.tagID){case f.TR:{t.openElements.clearBackToTableBodyContext(),t._insertElement(e,Y.HTML),t.insertionMode=k.IN_ROW;break}case f.TH:case f.TD:{t.openElements.clearBackToTableBodyContext(),t._insertFakeElement(L.TR,f.TR),t.insertionMode=k.IN_ROW,yl(t,e);break}case f.CAPTION:case f.COL:case f.COLGROUP:case f.TBODY:case f.TFOOT:case f.THEAD:{t.openElements.hasTableBodyContextInTableScope()&&(t.openElements.clearBackToTableBodyContext(),t.openElements.pop(),t.insertionMode=k.IN_TABLE,_a(t,e));break}default:_a(t,e)}}function Qh(t,e){const n=e.tagID;switch(e.tagID){case f.TBODY:case f.TFOOT:case f.THEAD:{t.openElements.hasInTableScope(n)&&(t.openElements.clearBackToTableBodyContext(),t.openElements.pop(),t.insertionMode=k.IN_TABLE);break}case f.TABLE:{t.openElements.hasTableBodyContextInTableScope()&&(t.openElements.clearBackToTableBodyContext(),t.openElements.pop(),t.insertionMode=k.IN_TABLE,to(t,e));break}case f.BODY:case f.CAPTION:case f.COL:case f.COLGROUP:case f.HTML:case f.TD:case f.TH:case f.TR:break;default:to(t,e)}}function yl(t,e){switch(e.tagID){case f.TH:case f.TD:{t.openElements.clearBackToTableRowContext(),t._insertElement(e,Y.HTML),t.insertionMode=k.IN_CELL,t.activeFormattingElements.insertMarker();break}case f.CAPTION:case f.COL:case f.COLGROUP:case f.TBODY:case f.TFOOT:case f.THEAD:case f.TR:{t.openElements.hasInTableScope(f.TR)&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=k.IN_TABLE_BODY,_l(t,e));break}default:_a(t,e)}}function cT(t,e){switch(e.tagID){case f.TR:{t.openElements.hasInTableScope(f.TR)&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=k.IN_TABLE_BODY);break}case f.TABLE:{t.openElements.hasInTableScope(f.TR)&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=k.IN_TABLE_BODY,Qh(t,e));break}case f.TBODY:case f.TFOOT:case f.THEAD:{(t.openElements.hasInTableScope(e.tagID)||t.openElements.hasInTableScope(f.TR))&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=k.IN_TABLE_BODY,Qh(t,e));break}case f.BODY:case f.CAPTION:case f.COL:case f.COLGROUP:case f.HTML:case f.TD:case f.TH:break;default:to(t,e)}}function y9(t,e){const n=e.tagID;uT.has(n)?(t.openElements.hasInTableScope(f.TD)||t.openElements.hasInTableScope(f.TH))&&(t._closeTableCell(),yl(t,e)):Ht(t,e)}function E9(t,e){const n=e.tagID;switch(n){case f.TD:case f.TH:{t.openElements.hasInTableScope(n)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(n),t.activeFormattingElements.clearToLastMarker(),t.insertionMode=k.IN_ROW);break}case f.TABLE:case f.TBODY:case f.TFOOT:case f.THEAD:case f.TR:{t.openElements.hasInTableScope(n)&&(t._closeTableCell(),cT(t,e));break}case f.BODY:case f.CAPTION:case f.COL:case f.COLGROUP:case f.HTML:break;default:bl(t,e)}}function lT(t,e){switch(e.tagID){case f.HTML:{Ht(t,e);break}case f.OPTION:{t.openElements.currentTagId===f.OPTION&&t.openElements.pop(),t._insertElement(e,Y.HTML);break}case f.OPTGROUP:{t.openElements.currentTagId===f.OPTION&&t.openElements.pop(),t.openElements.currentTagId===f.OPTGROUP&&t.openElements.pop(),t._insertElement(e,Y.HTML);break}case f.HR:{t.openElements.currentTagId===f.OPTION&&t.openElements.pop(),t.openElements.currentTagId===f.OPTGROUP&&t.openElements.pop(),t._appendElement(e,Y.HTML),e.ackSelfClosing=!0;break}case f.INPUT:case f.KEYGEN:case f.TEXTAREA:case f.SELECT:{t.openElements.hasInSelectScope(f.SELECT)&&(t.openElements.popUntilTagNamePopped(f.SELECT),t._resetInsertionMode(),e.tagID!==f.SELECT&&t._processStartTag(e));break}case f.SCRIPT:case f.TEMPLATE:{Jn(t,e);break}}}function dT(t,e){switch(e.tagID){case f.OPTGROUP:{t.openElements.stackTop>0&&t.openElements.currentTagId===f.OPTION&&t.openElements.tagIDs[t.openElements.stackTop-1]===f.OPTGROUP&&t.openElements.pop(),t.openElements.currentTagId===f.OPTGROUP&&t.openElements.pop();break}case f.OPTION:{t.openElements.currentTagId===f.OPTION&&t.openElements.pop();break}case f.SELECT:{t.openElements.hasInSelectScope(f.SELECT)&&(t.openElements.popUntilTagNamePopped(f.SELECT),t._resetInsertionMode());break}case f.TEMPLATE:{Ls(t,e);break}}}function w9(t,e){const n=e.tagID;n===f.CAPTION||n===f.TABLE||n===f.TBODY||n===f.TFOOT||n===f.THEAD||n===f.TR||n===f.TD||n===f.TH?(t.openElements.popUntilTagNamePopped(f.SELECT),t._resetInsertionMode(),t._processStartTag(e)):lT(t,e)}function T9(t,e){const n=e.tagID;n===f.CAPTION||n===f.TABLE||n===f.TBODY||n===f.TFOOT||n===f.THEAD||n===f.TR||n===f.TD||n===f.TH?t.openElements.hasInTableScope(n)&&(t.openElements.popUntilTagNamePopped(f.SELECT),t._resetInsertionMode(),t.onEndTag(e)):dT(t,e)}function S9(t,e){switch(e.tagID){case f.BASE:case f.BASEFONT:case f.BGSOUND:case f.LINK:case f.META:case f.NOFRAMES:case f.SCRIPT:case f.STYLE:case f.TEMPLATE:case f.TITLE:{Jn(t,e);break}case f.CAPTION:case f.COLGROUP:case f.TBODY:case f.TFOOT:case f.THEAD:{t.tmplInsertionModeStack[0]=k.IN_TABLE,t.insertionMode=k.IN_TABLE,_a(t,e);break}case f.COL:{t.tmplInsertionModeStack[0]=k.IN_COLUMN_GROUP,t.insertionMode=k.IN_COLUMN_GROUP,Bm(t,e);break}case f.TR:{t.tmplInsertionModeStack[0]=k.IN_TABLE_BODY,t.insertionMode=k.IN_TABLE_BODY,_l(t,e);break}case f.TD:case f.TH:{t.tmplInsertionModeStack[0]=k.IN_ROW,t.insertionMode=k.IN_ROW,yl(t,e);break}default:t.tmplInsertionModeStack[0]=k.IN_BODY,t.insertionMode=k.IN_BODY,Ht(t,e)}}function A9(t,e){e.tagID===f.TEMPLATE&&Ls(t,e)}function hT(t,e){t.openElements.tmplCount>0?(t.openElements.popUntilTagNamePopped(f.TEMPLATE),t.activeFormattingElements.clearToLastMarker(),t.tmplInsertionModeStack.shift(),t._resetInsertionMode(),t.onEof(e)):Mm(t,e)}function C9(t,e){e.tagID===f.HTML?Ht(t,e):Ac(t,e)}function fT(t,e){var n;if(e.tagID===f.HTML){if(t.fragmentContext||(t.insertionMode=k.AFTER_AFTER_BODY),t.options.sourceCodeLocationInfo&&t.openElements.tagIDs[0]===f.HTML){t._setEndLocation(t.openElements.items[0],e);const r=t.openElements.items[1];r&&!(!((n=t.treeAdapter.getNodeSourceCodeLocation(r))===null||n===void 0)&&n.endTag)&&t._setEndLocation(r,e)}}else Ac(t,e)}function Ac(t,e){t.insertionMode=k.IN_BODY,gl(t,e)}function v9(t,e){switch(e.tagID){case f.HTML:{Ht(t,e);break}case f.FRAMESET:{t._insertElement(e,Y.HTML);break}case f.FRAME:{t._appendElement(e,Y.HTML),e.ackSelfClosing=!0;break}case f.NOFRAMES:{Jn(t,e);break}}}function O9(t,e){e.tagID===f.FRAMESET&&!t.openElements.isRootHtmlElementCurrent()&&(t.openElements.pop(),!t.fragmentContext&&t.openElements.currentTagId!==f.FRAMESET&&(t.insertionMode=k.AFTER_FRAMESET))}function k9(t,e){switch(e.tagID){case f.HTML:{Ht(t,e);break}case f.NOFRAMES:{Jn(t,e);break}}}function I9(t,e){e.tagID===f.HTML&&(t.insertionMode=k.AFTER_AFTER_FRAMESET)}function N9(t,e){e.tagID===f.HTML?Ht(t,e):Ru(t,e)}function Ru(t,e){t.insertionMode=k.IN_BODY,gl(t,e)}function R9(t,e){switch(e.tagID){case f.HTML:{Ht(t,e);break}case f.NOFRAMES:{Jn(t,e);break}}}function P9(t,e){e.chars=at,t._insertCharacters(e)}function x9(t,e){t._insertCharacters(e),t.framesetOk=!1}function mT(t){for(;t.treeAdapter.getNamespaceURI(t.openElements.current)!==Y.HTML&&!t._isIntegrationPoint(t.openElements.currentTagId,t.openElements.current);)t.openElements.pop()}function L9(t,e){if(Y8(e))mT(t),t._startTagOutsideForeignContent(e);else{const n=t._getAdjustedCurrentElement(),r=t.treeAdapter.getNamespaceURI(n);r===Y.MATHML?Zw(e):r===Y.SVG&&(Z8(e),Jw(e)),Lm(e),e.selfClosing?t._appendElement(e,r):t._insertElement(e,r),e.ackSelfClosing=!0}}function D9(t,e){if(e.tagID===f.P||e.tagID===f.BR){mT(t),t._endTagOutsideForeignContent(e);return}for(let n=t.openElements.stackTop;n>0;n--){const r=t.openElements.items[n];if(t.treeAdapter.getNamespaceURI(r)===Y.HTML){t._endTagOutsideForeignContent(e);break}const s=t.treeAdapter.getTagName(r);if(s.toLowerCase()===e.tagName){e.tagName=s,t.openElements.shortenToLength(n);break}}}const M9=new Set([L.AREA,L.BASE,L.BASEFONT,L.BGSOUND,L.BR,L.COL,L.EMBED,L.FRAME,L.HR,L.IMG,L.INPUT,L.KEYGEN,L.LINK,L.META,L.PARAM,L.SOURCE,L.TRACK,L.WBR]);function B9(t,e){return e.treeAdapter.isElementNode(t)&&e.treeAdapter.getNamespaceURI(t)===Y.HTML&&M9.has(e.treeAdapter.getTagName(t))}const F9={treeAdapter:Ar,scriptingEnabled:!0};function U9(t,e){const n={...F9,...e};return pT(t,n)}function j9(t,e){let n="";const r=e.treeAdapter.isElementNode(t)&&e.treeAdapter.getTagName(t)===L.TEMPLATE&&e.treeAdapter.getNamespaceURI(t)===Y.HTML?e.treeAdapter.getTemplateContent(t):t,s=e.treeAdapter.getChildNodes(r);if(s)for(const a of s)n+=pT(a,e);return n}function pT(t,e){return e.treeAdapter.isElementNode(t)?H9(t,e):e.treeAdapter.isTextNode(t)?q9(t,e):e.treeAdapter.isCommentNode(t)?V9(t,e):e.treeAdapter.isDocumentTypeNode(t)?z9(t,e):""}function H9(t,e){const n=e.treeAdapter.getTagName(t);return`<${n}${$9(t,e)}>${B9(t,e)?"":`${j9(t,e)}</${n}>`}`}function $9(t,{treeAdapter:e}){let n="";for(const r of e.getAttrList(t)){if(n+=" ",r.namespace)switch(r.namespace){case Y.XML:{n+=`xml:${r.name}`;break}case Y.XMLNS:{r.name!=="xmlns"&&(n+="xmlns:"),n+=r.name;break}case Y.XLINK:{n+=`xlink:${r.name}`;break}default:n+=`${r.prefix}:${r.name}`}else n+=r.name;n+=`="${iw(r.value)}"`}return n}function q9(t,e){const{treeAdapter:n}=e,r=n.getTextNodeContent(t),s=n.getParentNode(t),a=s&&n.isElementNode(s)&&n.getTagName(s);return a&&n.getNamespaceURI(s)===Y.HTML&&S8(a,e.scriptingEnabled)?r:ow(r)}function V9(t,{treeAdapter:e}){return`<!--${e.getCommentNodeContent(t)}-->`}function z9(t,{treeAdapter:e}){return`<!DOCTYPE ${e.getDocumentTypeNodeName(t)}>`}function W9(t,e){return Qw.parse(t,e)}function G9(t,e,n){typeof t=="string"&&(n=e,e=t,t=null);const r=Qw.getFragmentParser(t,n);return r.tokenizer.write(e,!0),r.getFragment()}function hb(t){const e=t.includes('"')?"'":'"';return e+t+e}function K9(t,e,n){let r="!DOCTYPE ";return t&&(r+=t),e?r+=` PUBLIC ${hb(e)}`:n&&(r+=" SYSTEM"),n&&(r+=` ${hb(n)}`),r}const Hr={isCommentNode:ll,isElementNode:Ee,isTextNode:mr,createDocument(){const t=new Is([]);return t["x-mode"]=fn.NO_QUIRKS,t},createDocumentFragment(){return new Is([])},createElement(t,e,n){const r=Object.create(null),s=Object.create(null),a=Object.create(null);for(let o=0;o<n.length;o++){const u=n[o].name;r[u]=n[o].value,s[u]=n[o].namespace,a[u]=n[o].prefix}const i=new _m(t,r,[]);return i.namespace=e,i["x-attribsNamespace"]=s,i["x-attribsPrefix"]=a,i},createCommentNode(t){return new pm(t)},createTextNode(t){return new Zi(t)},appendChild(t,e){const n=t.children[t.children.length-1];n&&(n.next=e,e.prev=n),t.children.push(e),e.parent=t},insertBefore(t,e,n){const r=t.children.indexOf(n),{prev:s}=n;s&&(s.next=e,e.prev=s),n.prev=e,e.next=n,t.children.splice(r,0,e),e.parent=t},setTemplateContent(t,e){Hr.appendChild(t,e)},getTemplateContent(t){return t.children[0]},setDocumentType(t,e,n,r){const s=K9(e,n,r);let a=t.children.find(i=>Hh(i)&&i.name==="!doctype");a?a.data=s??null:(a=new gm("!doctype",s),Hr.appendChild(t,a)),a["x-name"]=e,a["x-publicId"]=n,a["x-systemId"]=r},setDocumentMode(t,e){t["x-mode"]=e},getDocumentMode(t){return t["x-mode"]},detachNode(t){if(t.parent){const e=t.parent.children.indexOf(t),{prev:n,next:r}=t;t.prev=null,t.next=null,n&&(n.next=r),r&&(r.prev=n),t.parent.children.splice(e,1),t.parent=null}},insertText(t,e){const n=t.children[t.children.length-1];n&&mr(n)?n.data+=e:Hr.appendChild(t,Hr.createTextNode(e))},insertTextBefore(t,e,n){const r=t.children[t.children.indexOf(n)-1];r&&mr(r)?r.data+=e:Hr.insertBefore(t,Hr.createTextNode(e),n)},adoptAttributes(t,e){for(let n=0;n<e.length;n++){const r=e[n].name;t.attribs[r]===void 0&&(t.attribs[r]=e[n].value,t["x-attribsNamespace"][r]=e[n].namespace,t["x-attribsPrefix"][r]=e[n].prefix)}},getFirstChild(t){return t.children[0]},getChildNodes(t){return t.children},getParentNode(t){return t.parent},getAttrList(t){return t.attributes},getTagName(t){return t.name},getNamespaceURI(t){return t.namespace},getTextNodeContent(t){return t.data},getCommentNodeContent(t){return t.data},getDocumentTypeNodeName(t){var e;return(e=t["x-name"])!==null&&e!==void 0?e:""},getDocumentTypeNodePublicId(t){var e;return(e=t["x-publicId"])!==null&&e!==void 0?e:""},getDocumentTypeNodeSystemId(t){var e;return(e=t["x-systemId"])!==null&&e!==void 0?e:""},isDocumentTypeNode(t){return Hh(t)&&t.name==="!doctype"},setNodeSourceCodeLocation(t,e){e&&(t.startIndex=e.startOffset,t.endIndex=e.endOffset),t.sourceCodeLocation=e},getNodeSourceCodeLocation(t){return t.sourceCodeLocation},updateNodeSourceCodeLocation(t,e){e.endOffset!=null&&(t.endIndex=e.endOffset),t.sourceCodeLocation={...t.sourceCodeLocation,...e}}};function Y9(t,e,n,r){var s;return(s=e.treeAdapter)!==null&&s!==void 0||(e.treeAdapter=Hr),e.scriptingEnabled!==!1&&(e.scriptingEnabled=!0),n?W9(t,e):G9(r,t,e)}const Z9={treeAdapter:Hr};function J9(t){const e="length"in t?t:[t];for(let r=0;r<e.length;r+=1){const s=e[r];ts(s)&&Array.prototype.splice.call(e,r,1,...s.children)}let n="";for(let r=0;r<e.length;r+=1){const s=e[r];n+=U9(s,Z9)}return n}var be;(function(t){t[t.Tab=9]="Tab",t[t.NewLine=10]="NewLine",t[t.FormFeed=12]="FormFeed",t[t.CarriageReturn=13]="CarriageReturn",t[t.Space=32]="Space",t[t.ExclamationMark=33]="ExclamationMark",t[t.Number=35]="Number",t[t.Amp=38]="Amp",t[t.SingleQuote=39]="SingleQuote",t[t.DoubleQuote=34]="DoubleQuote",t[t.Dash=45]="Dash",t[t.Slash=47]="Slash",t[t.Zero=48]="Zero",t[t.Nine=57]="Nine",t[t.Semi=59]="Semi",t[t.Lt=60]="Lt",t[t.Eq=61]="Eq",t[t.Gt=62]="Gt",t[t.Questionmark=63]="Questionmark",t[t.UpperA=65]="UpperA",t[t.LowerA=97]="LowerA",t[t.UpperF=70]="UpperF",t[t.LowerF=102]="LowerF",t[t.UpperZ=90]="UpperZ",t[t.LowerZ=122]="LowerZ",t[t.LowerX=120]="LowerX",t[t.OpeningSquareBracket=91]="OpeningSquareBracket"})(be||(be={}));var J;(function(t){t[t.Text=1]="Text",t[t.BeforeTagName=2]="BeforeTagName",t[t.InTagName=3]="InTagName",t[t.InSelfClosingTag=4]="InSelfClosingTag",t[t.BeforeClosingTagName=5]="BeforeClosingTagName",t[t.InClosingTagName=6]="InClosingTagName",t[t.AfterClosingTagName=7]="AfterClosingTagName",t[t.BeforeAttributeName=8]="BeforeAttributeName",t[t.InAttributeName=9]="InAttributeName",t[t.AfterAttributeName=10]="AfterAttributeName",t[t.BeforeAttributeValue=11]="BeforeAttributeValue",t[t.InAttributeValueDq=12]="InAttributeValueDq",t[t.InAttributeValueSq=13]="InAttributeValueSq",t[t.InAttributeValueNq=14]="InAttributeValueNq",t[t.BeforeDeclaration=15]="BeforeDeclaration",t[t.InDeclaration=16]="InDeclaration",t[t.InProcessingInstruction=17]="InProcessingInstruction",t[t.BeforeComment=18]="BeforeComment",t[t.CDATASequence=19]="CDATASequence",t[t.InSpecialComment=20]="InSpecialComment",t[t.InCommentLike=21]="InCommentLike",t[t.BeforeSpecialS=22]="BeforeSpecialS",t[t.BeforeSpecialT=23]="BeforeSpecialT",t[t.SpecialStartSequence=24]="SpecialStartSequence",t[t.InSpecialTag=25]="InSpecialTag",t[t.InEntity=26]="InEntity"})(J||(J={}));function Sr(t){return t===be.Space||t===be.NewLine||t===be.Tab||t===be.FormFeed||t===be.CarriageReturn}function mu(t){return t===be.Slash||t===be.Gt||Sr(t)}function X9(t){return t>=be.LowerA&&t<=be.LowerZ||t>=be.UpperA&&t<=be.UpperZ}var or;(function(t){t[t.NoValue=0]="NoValue",t[t.Unquoted=1]="Unquoted",t[t.Single=2]="Single",t[t.Double=3]="Double"})(or||(or={}));const Pt={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101]),TextareaEnd:new Uint8Array([60,47,116,101,120,116,97,114,101,97])};class Q9{constructor({xmlMode:e=!1,decodeEntities:n=!0},r){this.cbs=r,this.state=J.Text,this.buffer="",this.sectionStart=0,this.index=0,this.entityStart=0,this.baseState=J.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.xmlMode=e,this.decodeEntities=n,this.entityDecoder=new Em(e?nw:ym,(s,a)=>this.emitCodePoint(s,a))}reset(){this.state=J.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=J.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(e){this.offset+=this.buffer.length,this.buffer=e,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}stateText(e){e===be.Lt||!this.decodeEntities&&this.fastForwardTo(be.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=J.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&e===be.Amp&&this.startEntity()}stateSpecialStartSequence(e){const n=this.sequenceIndex===this.currentSequence.length;if(!(n?mu(e):(e|32)===this.currentSequence[this.sequenceIndex]))this.isSpecial=!1;else if(!n){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=J.InTagName,this.stateInTagName(e)}stateInSpecialTag(e){if(this.sequenceIndex===this.currentSequence.length){if(e===be.Gt||Sr(e)){const n=this.index-this.currentSequence.length;if(this.sectionStart<n){const r=this.index;this.index=n,this.cbs.ontext(this.sectionStart,n),this.index=r}this.isSpecial=!1,this.sectionStart=n+2,this.stateInClosingTagName(e);return}this.sequenceIndex=0}(e|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===Pt.TitleEnd?this.decodeEntities&&e===be.Amp&&this.startEntity():this.fastForwardTo(be.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(e===be.Lt)}stateCDATASequence(e){e===Pt.Cdata[this.sequenceIndex]?++this.sequenceIndex===Pt.Cdata.length&&(this.state=J.InCommentLike,this.currentSequence=Pt.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=J.InDeclaration,this.stateInDeclaration(e))}fastForwardTo(e){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===e)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(e){e===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===Pt.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=J.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):e!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(e){return this.xmlMode?!mu(e):X9(e)}startSpecial(e,n){this.isSpecial=!0,this.currentSequence=e,this.sequenceIndex=n,this.state=J.SpecialStartSequence}stateBeforeTagName(e){if(e===be.ExclamationMark)this.state=J.BeforeDeclaration,this.sectionStart=this.index+1;else if(e===be.Questionmark)this.state=J.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(e)){const n=e|32;this.sectionStart=this.index,this.xmlMode?this.state=J.InTagName:n===Pt.ScriptEnd[2]?this.state=J.BeforeSpecialS:n===Pt.TitleEnd[2]?this.state=J.BeforeSpecialT:this.state=J.InTagName}else e===be.Slash?this.state=J.BeforeClosingTagName:(this.state=J.Text,this.stateText(e))}stateInTagName(e){mu(e)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=J.BeforeAttributeName,this.stateBeforeAttributeName(e))}stateBeforeClosingTagName(e){Sr(e)||(e===be.Gt?this.state=J.Text:(this.state=this.isTagStartChar(e)?J.InClosingTagName:J.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(e){(e===be.Gt||Sr(e))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=J.AfterClosingTagName,this.stateAfterClosingTagName(e))}stateAfterClosingTagName(e){(e===be.Gt||this.fastForwardTo(be.Gt))&&(this.state=J.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(e){e===be.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=J.InSpecialTag,this.sequenceIndex=0):this.state=J.Text,this.sectionStart=this.index+1):e===be.Slash?this.state=J.InSelfClosingTag:Sr(e)||(this.state=J.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(e){e===be.Gt?(this.cbs.onselfclosingtag(this.index),this.state=J.Text,this.sectionStart=this.index+1,this.isSpecial=!1):Sr(e)||(this.state=J.BeforeAttributeName,this.stateBeforeAttributeName(e))}stateInAttributeName(e){(e===be.Eq||mu(e))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=this.index,this.state=J.AfterAttributeName,this.stateAfterAttributeName(e))}stateAfterAttributeName(e){e===be.Eq?this.state=J.BeforeAttributeValue:e===be.Slash||e===be.Gt?(this.cbs.onattribend(or.NoValue,this.sectionStart),this.sectionStart=-1,this.state=J.BeforeAttributeName,this.stateBeforeAttributeName(e)):Sr(e)||(this.cbs.onattribend(or.NoValue,this.sectionStart),this.state=J.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(e){e===be.DoubleQuote?(this.state=J.InAttributeValueDq,this.sectionStart=this.index+1):e===be.SingleQuote?(this.state=J.InAttributeValueSq,this.sectionStart=this.index+1):Sr(e)||(this.sectionStart=this.index,this.state=J.InAttributeValueNq,this.stateInAttributeValueNoQuotes(e))}handleInAttributeValue(e,n){e===n||!this.decodeEntities&&this.fastForwardTo(n)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(n===be.DoubleQuote?or.Double:or.Single,this.index+1),this.state=J.BeforeAttributeName):this.decodeEntities&&e===be.Amp&&this.startEntity()}stateInAttributeValueDoubleQuotes(e){this.handleInAttributeValue(e,be.DoubleQuote)}stateInAttributeValueSingleQuotes(e){this.handleInAttributeValue(e,be.SingleQuote)}stateInAttributeValueNoQuotes(e){Sr(e)||e===be.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(or.Unquoted,this.index),this.state=J.BeforeAttributeName,this.stateBeforeAttributeName(e)):this.decodeEntities&&e===be.Amp&&this.startEntity()}stateBeforeDeclaration(e){e===be.OpeningSquareBracket?(this.state=J.CDATASequence,this.sequenceIndex=0):this.state=e===be.Dash?J.BeforeComment:J.InDeclaration}stateInDeclaration(e){(e===be.Gt||this.fastForwardTo(be.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=J.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(e){(e===be.Gt||this.fastForwardTo(be.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=J.Text,this.sectionStart=this.index+1)}stateBeforeComment(e){e===be.Dash?(this.state=J.InCommentLike,this.currentSequence=Pt.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=J.InDeclaration}stateInSpecialComment(e){(e===be.Gt||this.fastForwardTo(be.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=J.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(e){const n=e|32;n===Pt.ScriptEnd[3]?this.startSpecial(Pt.ScriptEnd,4):n===Pt.StyleEnd[3]?this.startSpecial(Pt.StyleEnd,4):(this.state=J.InTagName,this.stateInTagName(e))}stateBeforeSpecialT(e){const n=e|32;n===Pt.TitleEnd[3]?this.startSpecial(Pt.TitleEnd,4):n===Pt.TextareaEnd[3]?this.startSpecial(Pt.TextareaEnd,4):(this.state=J.InTagName,this.stateInTagName(e))}startEntity(){this.baseState=this.state,this.state=J.InEntity,this.entityStart=this.index,this.entityDecoder.startEntity(this.xmlMode?vn.Strict:this.baseState===J.Text||this.baseState===J.InSpecialTag?vn.Legacy:vn.Attribute)}stateInEntity(){const e=this.entityDecoder.write(this.buffer,this.index-this.offset);e>=0?(this.state=this.baseState,e===0&&(this.index=this.entityStart)):this.index=this.offset+this.buffer.length-1}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===J.Text||this.state===J.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===J.InAttributeValueDq||this.state===J.InAttributeValueSq||this.state===J.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const e=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case J.Text:{this.stateText(e);break}case J.SpecialStartSequence:{this.stateSpecialStartSequence(e);break}case J.InSpecialTag:{this.stateInSpecialTag(e);break}case J.CDATASequence:{this.stateCDATASequence(e);break}case J.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(e);break}case J.InAttributeName:{this.stateInAttributeName(e);break}case J.InCommentLike:{this.stateInCommentLike(e);break}case J.InSpecialComment:{this.stateInSpecialComment(e);break}case J.BeforeAttributeName:{this.stateBeforeAttributeName(e);break}case J.InTagName:{this.stateInTagName(e);break}case J.InClosingTagName:{this.stateInClosingTagName(e);break}case J.BeforeTagName:{this.stateBeforeTagName(e);break}case J.AfterAttributeName:{this.stateAfterAttributeName(e);break}case J.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(e);break}case J.BeforeAttributeValue:{this.stateBeforeAttributeValue(e);break}case J.BeforeClosingTagName:{this.stateBeforeClosingTagName(e);break}case J.AfterClosingTagName:{this.stateAfterClosingTagName(e);break}case J.BeforeSpecialS:{this.stateBeforeSpecialS(e);break}case J.BeforeSpecialT:{this.stateBeforeSpecialT(e);break}case J.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(e);break}case J.InSelfClosingTag:{this.stateInSelfClosingTag(e);break}case J.InDeclaration:{this.stateInDeclaration(e);break}case J.BeforeDeclaration:{this.stateBeforeDeclaration(e);break}case J.BeforeComment:{this.stateBeforeComment(e);break}case J.InProcessingInstruction:{this.stateInProcessingInstruction(e);break}case J.InEntity:{this.stateInEntity();break}}this.index++}this.cleanup()}finish(){this.state===J.InEntity&&(this.entityDecoder.end(),this.state=this.baseState),this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const e=this.buffer.length+this.offset;this.sectionStart>=e||(this.state===J.InCommentLike?this.currentSequence===Pt.CdataEnd?this.cbs.oncdata(this.sectionStart,e,0):this.cbs.oncomment(this.sectionStart,e,0):this.state===J.InTagName||this.state===J.BeforeAttributeName||this.state===J.BeforeAttributeValue||this.state===J.AfterAttributeName||this.state===J.InAttributeName||this.state===J.InAttributeValueSq||this.state===J.InAttributeValueDq||this.state===J.InAttributeValueNq||this.state===J.InClosingTagName||this.cbs.ontext(this.sectionStart,e))}emitCodePoint(e,n){this.baseState!==J.Text&&this.baseState!==J.InSpecialTag?(this.sectionStart<this.entityStart&&this.cbs.onattribdata(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+n,this.index=this.sectionStart-1,this.cbs.onattribentity(e)):(this.sectionStart<this.entityStart&&this.cbs.ontext(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+n,this.index=this.sectionStart-1,this.cbs.ontextentity(e,this.sectionStart))}}const qs=new Set(["input","option","optgroup","select","button","datalist","textarea"]),rt=new Set(["p"]),fb=new Set(["thead","tbody"]),mb=new Set(["dd","dt"]),pb=new Set(["rt","rp"]),eF=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",rt],["h1",rt],["h2",rt],["h3",rt],["h4",rt],["h5",rt],["h6",rt],["select",qs],["input",qs],["output",qs],["button",qs],["datalist",qs],["textarea",qs],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",mb],["dt",mb],["address",rt],["article",rt],["aside",rt],["blockquote",rt],["details",rt],["div",rt],["dl",rt],["fieldset",rt],["figcaption",rt],["figure",rt],["footer",rt],["form",rt],["header",rt],["hr",rt],["main",rt],["nav",rt],["ol",rt],["pre",rt],["section",rt],["table",rt],["ul",rt],["rt",pb],["rp",pb],["tbody",fb],["tfoot",fb]]),tF=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),gb=new Set(["math","svg"]),bb=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),nF=/\s|\//;class rF{constructor(e,n={}){var r,s,a,i,o,u;this.options=n,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=e??{},this.htmlMode=!this.options.xmlMode,this.lowerCaseTagNames=(r=n.lowerCaseTags)!==null&&r!==void 0?r:this.htmlMode,this.lowerCaseAttributeNames=(s=n.lowerCaseAttributeNames)!==null&&s!==void 0?s:this.htmlMode,this.recognizeSelfClosing=(a=n.recognizeSelfClosing)!==null&&a!==void 0?a:!this.htmlMode,this.tokenizer=new((i=n.Tokenizer)!==null&&i!==void 0?i:Q9)(this.options,this),this.foreignContext=[!this.htmlMode],(u=(o=this.cbs).onparserinit)===null||u===void 0||u.call(o,this)}ontext(e,n){var r,s;const a=this.getSlice(e,n);this.endIndex=n-1,(s=(r=this.cbs).ontext)===null||s===void 0||s.call(r,a),this.startIndex=n}ontextentity(e,n){var r,s;this.endIndex=n-1,(s=(r=this.cbs).ontext)===null||s===void 0||s.call(r,$h(e)),this.startIndex=n}isVoidElement(e){return this.htmlMode&&tF.has(e)}onopentagname(e,n){this.endIndex=n;let r=this.getSlice(e,n);this.lowerCaseTagNames&&(r=r.toLowerCase()),this.emitOpenTag(r)}emitOpenTag(e){var n,r,s,a;this.openTagStart=this.startIndex,this.tagname=e;const i=this.htmlMode&&eF.get(e);if(i)for(;this.stack.length>0&&i.has(this.stack[0]);){const o=this.stack.shift();(r=(n=this.cbs).onclosetag)===null||r===void 0||r.call(n,o,!0)}this.isVoidElement(e)||(this.stack.unshift(e),this.htmlMode&&(gb.has(e)?this.foreignContext.unshift(!0):bb.has(e)&&this.foreignContext.unshift(!1))),(a=(s=this.cbs).onopentagname)===null||a===void 0||a.call(s,e),this.cbs.onopentag&&(this.attribs={})}endOpenTag(e){var n,r;this.startIndex=this.openTagStart,this.attribs&&((r=(n=this.cbs).onopentag)===null||r===void 0||r.call(n,this.tagname,this.attribs,e),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(e){this.endIndex=e,this.endOpenTag(!1),this.startIndex=e+1}onclosetag(e,n){var r,s,a,i,o,u,c,l;this.endIndex=n;let d=this.getSlice(e,n);if(this.lowerCaseTagNames&&(d=d.toLowerCase()),this.htmlMode&&(gb.has(d)||bb.has(d))&&this.foreignContext.shift(),this.isVoidElement(d))this.htmlMode&&d==="br"&&((i=(a=this.cbs).onopentagname)===null||i===void 0||i.call(a,"br"),(u=(o=this.cbs).onopentag)===null||u===void 0||u.call(o,"br",{},!0),(l=(c=this.cbs).onclosetag)===null||l===void 0||l.call(c,"br",!1));else{const m=this.stack.indexOf(d);if(m!==-1)for(let p=0;p<=m;p++){const h=this.stack.shift();(s=(r=this.cbs).onclosetag)===null||s===void 0||s.call(r,h,p!==m)}else this.htmlMode&&d==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=n+1}onselfclosingtag(e){this.endIndex=e,this.recognizeSelfClosing||this.foreignContext[0]?(this.closeCurrentTag(!1),this.startIndex=e+1):this.onopentagend(e)}closeCurrentTag(e){var n,r;const s=this.tagname;this.endOpenTag(e),this.stack[0]===s&&((r=(n=this.cbs).onclosetag)===null||r===void 0||r.call(n,s,!e),this.stack.shift())}onattribname(e,n){this.startIndex=e;const r=this.getSlice(e,n);this.attribname=this.lowerCaseAttributeNames?r.toLowerCase():r}onattribdata(e,n){this.attribvalue+=this.getSlice(e,n)}onattribentity(e){this.attribvalue+=$h(e)}onattribend(e,n){var r,s;this.endIndex=n,(s=(r=this.cbs).onattribute)===null||s===void 0||s.call(r,this.attribname,this.attribvalue,e===or.Double?'"':e===or.Single?"'":e===or.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(e){const n=e.search(nF);let r=n<0?e:e.substr(0,n);return this.lowerCaseTagNames&&(r=r.toLowerCase()),r}ondeclaration(e,n){this.endIndex=n;const r=this.getSlice(e,n);if(this.cbs.onprocessinginstruction){const s=this.getInstructionName(r);this.cbs.onprocessinginstruction(`!${s}`,`!${r}`)}this.startIndex=n+1}onprocessinginstruction(e,n){this.endIndex=n;const r=this.getSlice(e,n);if(this.cbs.onprocessinginstruction){const s=this.getInstructionName(r);this.cbs.onprocessinginstruction(`?${s}`,`?${r}`)}this.startIndex=n+1}oncomment(e,n,r){var s,a,i,o;this.endIndex=n,(a=(s=this.cbs).oncomment)===null||a===void 0||a.call(s,this.getSlice(e,n-r)),(o=(i=this.cbs).oncommentend)===null||o===void 0||o.call(i),this.startIndex=n+1}oncdata(e,n,r){var s,a,i,o,u,c,l,d,m,p;this.endIndex=n;const h=this.getSlice(e,n-r);!this.htmlMode||this.options.recognizeCDATA?((a=(s=this.cbs).oncdatastart)===null||a===void 0||a.call(s),(o=(i=this.cbs).ontext)===null||o===void 0||o.call(i,h),(c=(u=this.cbs).oncdataend)===null||c===void 0||c.call(u)):((d=(l=this.cbs).oncomment)===null||d===void 0||d.call(l,`[CDATA[${h}]]`),(p=(m=this.cbs).oncommentend)===null||p===void 0||p.call(m)),this.startIndex=n+1}onend(){var e,n;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let r=0;r<this.stack.length;r++)this.cbs.onclosetag(this.stack[r],!0)}(n=(e=this.cbs).onend)===null||n===void 0||n.call(e)}reset(){var e,n,r,s;(n=(e=this.cbs).onreset)===null||n===void 0||n.call(e),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(s=(r=this.cbs).onparserinit)===null||s===void 0||s.call(r,this),this.buffers.length=0,this.foreignContext.length=0,this.foreignContext.unshift(!this.htmlMode),this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(e){this.reset(),this.end(e)}getSlice(e,n){for(;e-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let r=this.buffers[0].slice(e-this.bufferOffset,n-this.bufferOffset);for(;n-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),r+=this.buffers[0].slice(0,n-this.bufferOffset);return r}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(e){var n,r;if(this.ended){(r=(n=this.cbs).onerror)===null||r===void 0||r.call(n,new Error(".write() after done!"));return}this.buffers.push(e),this.tokenizer.running&&(this.tokenizer.write(e),this.writeIndex++)}end(e){var n,r;if(this.ended){(r=(n=this.cbs).onerror)===null||r===void 0||r.call(n,new Error(".end() after done!"));return}e&&this.write(e),this.ended=!0,this.tokenizer.end()}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(e){this.write(e)}done(e){this.end(e)}}function sF(t,e){const n=new iD(void 0,e);return new rF(n,e).end(t),n.root}const aF=L5((t,e,n,r)=>e._useHtmlParser2?sF(t,e):Y9(t,e,n,r)),iF=f8(aF,(t,e)=>e._useHtmlParser2?dl(t,e):J9(t));async function oF(t,e){try{const n=await t.invoke(e),r=typeof n=="string"?JSON.parse(`[${n}]`):n;return r.length===0?(so(""),[]):r}catch(n){console.error(":",n)}return[]}async function uF(t){let e="";try{const n=await Ye.get(t),r=iF(n.data);r("script").remove(),r("style").remove(),r("noscript").remove(),r("iframe").remove(),r("nav").remove(),r("footer").remove(),e=r("body").text().replace(/&nbsp;/g," ").trim()}catch(n){console.error(`Error crawling ${t}:`,n)}return e}class cF extends jh{static lc_name(){return"ChatDeepSeek"}_llmType(){return"deepseek"}get lc_secrets(){return{apiKey:"DEEPSEEK_API_KEY"}}constructor(e){const n=(e==null?void 0:e.apiKey)||gn("DEEPSEEK_API_KEY");if(!n)throw new Error('Deepseek API key not found. Please set the DEEPSEEK_API_KEY environment variable or pass the key into "apiKey" field.');super({...e,apiKey:n,configuration:{baseURL:"https://api.deepseek.com",...e==null?void 0:e.configuration}}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","deepseek"]})}_convertOpenAIDeltaToBaseMessageChunk(e,n,r){const s=super._convertOpenAIDeltaToBaseMessageChunk(e,n,r);return s.additional_kwargs.reasoning_content=e.reasoning_content,s}_convertOpenAIChatCompletionMessageToBaseMessage(e,n){const r=super._convertOpenAIChatCompletionMessageToBaseMessage(e,n);return r.additional_kwargs.reasoning_content=e.reasoning_content,r}withStructuredOutput(e,n){const r={...n};return(r==null?void 0:r.method)===void 0&&(r.method="functionCalling"),super.withStructuredOutput(e,r)}}async function lF(t,e,n){const r=await o2(e),s=r-n,a=r+n,i=await b_(t);let o=[];for(let[u,c]of i.entries())u<s||u>a||o.push({link:`siyuan://blocks/${c.id}`,content:c.markdown});return o}let hn;function El(t){hn=t}async function dF(t){try{await navigator.clipboard.writeText(t)}catch{const n=document.createElement("textarea");n.value=t,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}}function hF(t,e){let n=[],r="";for(let[s,a]of t.entries())switch(s===t.length-1&&e.length>0?r=`${hn.searchResults}${JSON.stringify(e)}

${hn.answerBasedOnSearch}${a.content};`:r=a.content,!0){case a.role==="system":n.push(new lh(r));break;case a.role==="assistant":n.push(new As(r));break;case a.role==="user":a.image?n.push(new cr({content:[{type:"text",text:r},{type:"image_url",image_url:{url:a.image}}]})):a.fileContent?n.push(new cr(`${a.fileContent}

${r}`)):n.push(new cr(r));break;case a.role==="image":break;default:n.push(new cr(r));break}return n}async function pu(t,e){var l;let n=[],r=[],s=[],a="",i=e.isReason?`${hn.thinking}

`:"",o=!1;if(e.isSearch){let d=e.messages[e.messages.length-1].content;d||(d=e.messages[e.messages.length-2].content);const m=new Y4({apiBase:R2,params:{format:"json",engines:"google,bing",numResults:3},headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"}}),p=await oF(m,d);for(let[h,g]of p.entries()){if(g.link.includes("zhihu"))continue;h===0&&(a+=`${hn.relatedWebPages}:

`);const b=await uF(g.link);let _=b.length>1024?await fF(b.replace(`
`,""),e.apiKey):b;n.push(_),a+=`${hn.webLink}: ${g.link}
`,e.callback(a),a+=`${hn.title}:${g.title}
`,e.callback(a),a+=`${hn.summary}: ${g.snippet}

`,e.callback(a)}a+=`

---------------------------------------
`}if(e.isKnowledge){const d=e.messages[e.messages.length-1].content,m=await e.knowledgeCallback(d);let p=new Set;for(let h of m){if(p.has(h.metadata.blockId))continue;p.add(h.metadata.blockId);const g=await lF(h.metadata.docId,h.metadata.blockId,3);r.push(JSON.stringify(g))}s=[...e.messages.splice(0,-1),{role:"user",content:hn.knowledgeBasePrompt},{role:"assistant",content:`${hn.retrievedContent}:
${r}`},{role:"user",content:e.messages[e.messages.length-1].content}],e.messages=s}let u=hF(e.messages,n);if(e.isStream){const d=await t.stream(u,{timeout:e.timeout*1e3});try{for await(const m of d)(l=m.additional_kwargs)!=null&&l.reasoning_content&&(i+=m.additional_kwargs.reasoning_content.toString()),m.content&&(e.isReason&&!o&&(i+=`

--------- 
`),o=!0,a+=m.content.toString()),e.callback(`${e.isSearch?a+i:i+a}`,!0)}catch{throw new Error("User interrupted")}finally{e.callback(i+a,!1)}return a}const c=await t.invoke(u,{timeout:e.timeout*1e3});return c.additional_kwargs.reasoning_content?(i+=c.additional_kwargs.reasoning_content.toString(),i+=`

--------- 
`,a+=c.content.toString(),e.callback(`${i}${a}`),a):(a+=c.content.toString(),e.callback(a),a)}async function Da(t){let e="",n;try{switch(!0){case t.model.includes("claude"):n=new WL({model:t.model,apiKey:t.apiKey,anthropicApiUrl:`${xo}/claude`,maxTokens:t.maxTokens,temperature:t.temperature}),e=await pu(n,t);break;case t.model.includes("deepseek-reasoner"):n=new cF({model:t.model,apiKey:t.apiKey,maxTokens:t.maxTokens,temperature:t.temperature,configuration:{baseURL:`${xo}/v1`}}),t.isReason=!0,e=await pu(n,t);break;case t.model.includes("o3-mini"):n=new jh({openAIApiKey:t.apiKey,modelName:t.model,configuration:{baseURL:`${xo}/v1`}}),e=await pu(n,t);break;default:n=new jh({openAIApiKey:t.apiKey,modelName:t.model,maxTokens:t.maxTokens,temperature:t.temperature,configuration:{baseURL:`${xo}/v1`,timeout:t.timeout*1e3}}),e=await pu(n,t);break}e=e.replace(/https:\/\/(siyuan:\/\/blocks\/[^\s]+)/g,"$1"),t.isClipboard&&(document.body.focus(),await dF(e),ta(hn.contentCopied))}catch(r){return console.error(hn.generateAnswerError,r),e}finally{return e}}async function Fm(t,e){return await Da({apiKey:e,model:"glm-4-flash",maxTokens:100,temperature:.5,timeout:90,isSearch:!1,isStream:!1,isClipboard:!1,callback:()=>{},messages:t})}async function fF(t,e){return await Da({apiKey:e,model:"glm-4-flash",maxTokens:4e3,temperature:.5,timeout:90,isSearch:!1,isStream:!1,isClipboard:!1,callback:()=>{},messages:[{role:"system",content:""},{role:"user",content:t}]})}async function mF(t){const e=N2+"/v1/images/generations",n=t.messages[t.messages.length-1].imageParam,r={"Content-Type":"application/json",Authorization:`Bearer ${t.apiKey}`},s={model:t.model,prompt:t.messages[t.messages.length-1].content,image_size:n.size,num_inference_steps:n.steps,guidance_scale:n.guidance,negative_prompt:n.negativePrompt,seed:n.seed,prompt_enhancement:!0},a=await Ye.post(e,s,{headers:r});return a.status===200?a.data.data[0].url:""}async function pF(t){let e="";try{e=await mF(t)}catch(n){return console.error(hn.generateAnswerError,n),e}finally{return e}}function gF(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,h,g;n=new EP({props:{currentChat:t[0],lute:t[9]}}),n.$on("edit",t[13]),n.$on("delete",t[14]);function b(x){t[17](x)}function _(x){t[18](x)}function y(x){t[19](x)}function E(x){t[20](x)}function I(x){t[21](x)}function w(x){t[22](x)}function R(x){t[23](x)}let v={settingStorage:t[8],isGenerating:t[11]};t[12]!==void 0&&(v.isInterrupted=t[12]),t[2]!==void 0&&(v.selectedModel=t[2]),t[3]!==void 0&&(v.isSearchEnabled=t[3]),t[4]!==void 0&&(v.isKnowledgeEnabled=t[4]),t[5]!==void 0&&(v.imageUrl=t[5]),t[6]!==void 0&&(v.fileContent=t[6]),t[1]!==void 0&&(v.documentVectorStorage=t[1]),s=new Ix({props:v}),ue.push(()=>pe(s,"isInterrupted",b)),ue.push(()=>pe(s,"selectedModel",_)),ue.push(()=>pe(s,"isSearchEnabled",y)),ue.push(()=>pe(s,"isKnowledgeEnabled",E)),ue.push(()=>pe(s,"imageUrl",I)),ue.push(()=>pe(s,"fileContent",w)),ue.push(()=>pe(s,"documentVectorStorage",R));function j(x){t[24](x)}let F={promptStorage:t[7],isGenerating:t[11]};return t[10]!==void 0&&(F.draftMessage=t[10]),p=new jx({props:F}),ue.push(()=>pe(p,"draftMessage",j)),p.$on("sendMessage",t[25]),{c(){e=M("div"),De(n.$$.fragment),r=ee(),De(s.$$.fragment),m=ee(),De(p.$$.fragment),T(e,"class","chat svelte-1cp6ff8")},m(x,H){ce(x,e,H),Pe(n,e,null),O(e,r),Pe(s,e,null),O(e,m),Pe(p,e,null),g=!0},p(x,[H]){const te={};H&1&&(te.currentChat=x[0]),H&512&&(te.lute=x[9]),n.$set(te);const Z={};H&256&&(Z.settingStorage=x[8]),H&2048&&(Z.isGenerating=x[11]),!a&&H&4096&&(a=!0,Z.isInterrupted=x[12],me(()=>a=!1)),!i&&H&4&&(i=!0,Z.selectedModel=x[2],me(()=>i=!1)),!o&&H&8&&(o=!0,Z.isSearchEnabled=x[3],me(()=>o=!1)),!u&&H&16&&(u=!0,Z.isKnowledgeEnabled=x[4],me(()=>u=!1)),!c&&H&32&&(c=!0,Z.imageUrl=x[5],me(()=>c=!1)),!l&&H&64&&(l=!0,Z.fileContent=x[6],me(()=>l=!1)),!d&&H&2&&(d=!0,Z.documentVectorStorage=x[1],me(()=>d=!1)),s.$set(Z);const N={};H&128&&(N.promptStorage=x[7]),H&2048&&(N.isGenerating=x[11]),!h&&H&1024&&(h=!0,N.draftMessage=x[10],me(()=>h=!1)),p.$set(N)},i(x){g||(ie(n.$$.fragment,x),ie(s.$$.fragment,x),ie(p.$$.fragment,x),g=!0)},o(x){de(n.$$.fragment,x),de(s.$$.fragment,x),de(p.$$.fragment,x),g=!1},d(x){x&&oe(e),xe(n),xe(s),xe(p)}}}function bF(t,e,n){let{currentChat:r}=e,{chatHistoryStorage:s}=e,{promptStorage:a}=e,{settingStorage:i}=e,{documentVectorStorage:o}=e,{selectedModel:u}=e,{isSearchEnabled:c}=e,{isKnowledgeEnabled:l}=e,{imageUrl:d}=e,{fileContent:m}=e,{lute:p}=e,h=!1,g=!1,b=r.draft;Rr(()=>{n(10,b=r.draft)}),El(i.i18n);function _(N){const{message:S}=N.detail,P=r.messages.findIndex(U=>U.id===S.id);P!==-1&&(n(0,r.messages=r.messages.slice(0,P),r),n(0,r.messages=[...r.messages,{id:Date.now(),role:"user",content:S.content,image:S.image||"",model:u,fileContent:S.fileContent||""}],r),n(0,r.messages=[...r.messages,{id:Date.now(),role:"assistant",content:"",model:u}],r),s.update(r),E())}function y(N){const{message:S}=N.detail,P=r.messages.findIndex(U=>U.id===S.id);P>0&&(n(0,r.messages=r.messages.slice(0,P),r),s.update(r))}async function E(){Da({apiKey:i.getValue("apiKey"),phone:i.getValue("phone"),model:r.model?r.model:u,maxTokens:i.getValue("maxOutputLengthChat"),temperature:i.getValue("temperatureChat"),timeout:i.getValue("responseTimeoutChat"),isSearch:c,isStream:!0,isClipboard:!0,isKnowledge:l,callback:(N,S)=>{if(g)throw n(11,h=!1),new Error("User interrupted");n(0,r.messages[r.messages.length-1].content=N,r),n(0,r.messages[r.messages.length-1].model=u,r),s.update(r),n(11,h=S)},knowledgeCallback:async N=>{const S=await o.similaritySearchWithScore(N,i.getValue("knowledgeBaseRecallNumChat"));let P=[];for(const U of S)U[1]<.7||P.push(U[0]);return P},messages:r.messages.slice(0,-1)})}async function I(N){if(!(h||!N.trim()))try{d&&n(0,r.model=Math.random()<.7?ra[0]:ra[Math.floor(Math.random()*(ra.length-1))+1],r),n(0,r.messages=[...r.messages,{id:Date.now(),role:"user",content:N,image:d,model:u,fileContent:m}],r),s.update(r),n(0,r.messages=[...r.messages,{id:Date.now(),role:"assistant",content:"",model:u}],r);try{d.length>0&&(n(0,r.title="",r),s.update(r)),await E(),r.messages.length>3&&r.messages.length<=5&&d.length==0&&Fm([...r.messages,{role:"user",content:s.i18n.summaryPrompt}],i.getValue("apiKey")).then(S=>{n(0,r.title=S,r),s.update(r),n(16,s)})}catch(S){console.error("AI :",S),n(0,r.messages=r.messages.slice(0,-1),r)}}finally{s.update(r),n(16,s),n(11,h=!1),n(12,g=!1),n(5,d=""),n(0,r.draft="",r),n(10,b="")}}function w(N){g=N,n(12,g)}function R(N){u=N,n(2,u)}function v(N){c=N,n(3,c)}function j(N){l=N,n(4,l)}function F(N){d=N,n(5,d)}function x(N){m=N,n(6,m)}function H(N){o=N,n(1,o)}function te(N){b=N,n(10,b)}const Z=async({detail:N})=>await I(N);return t.$$set=N=>{"currentChat"in N&&n(0,r=N.currentChat),"chatHistoryStorage"in N&&n(16,s=N.chatHistoryStorage),"promptStorage"in N&&n(7,a=N.promptStorage),"settingStorage"in N&&n(8,i=N.settingStorage),"documentVectorStorage"in N&&n(1,o=N.documentVectorStorage),"selectedModel"in N&&n(2,u=N.selectedModel),"isSearchEnabled"in N&&n(3,c=N.isSearchEnabled),"isKnowledgeEnabled"in N&&n(4,l=N.isKnowledgeEnabled),"imageUrl"in N&&n(5,d=N.imageUrl),"fileContent"in N&&n(6,m=N.fileContent),"lute"in N&&n(9,p=N.lute)},t.$$.update=()=>{t.$$.dirty&66561&&b!==r.draft&&(n(0,r.draft=b,r),s.update(r))},[r,o,u,c,l,d,m,a,i,p,b,h,g,_,y,I,s,w,R,v,j,F,x,H,te,Z]}let _F=class extends tt{constructor(e){super(),et(this,e,bF,gF,Qe,{currentChat:0,chatHistoryStorage:16,promptStorage:7,settingStorage:8,documentVectorStorage:1,selectedModel:2,isSearchEnabled:3,isKnowledgeEnabled:4,imageUrl:5,fileContent:6,lute:9})}};function yF(t){let e,n,r,s,a,i,o,u,c,l;function d(y){t[12](y)}let m={};t[0]!==void 0&&(m.chatHistoryStorage=t[0]),n=new pP({props:m}),ue.push(()=>pe(n,"chatHistoryStorage",d)),n.$on("selectChat",t[13]);function p(y){t[14](y)}function h(y){t[15](y)}function g(y){t[16](y)}function b(y){t[17](y)}let _={currentChat:t[5],promptStorage:t[3],settingStorage:t[2],selectedModel:t[8],isSearchEnabled:t[9],isKnowledgeEnabled:t[10],lute:t[4]};return t[0]!==void 0&&(_.chatHistoryStorage=t[0]),t[1]!==void 0&&(_.documentVectorStorage=t[1]),t[6]!==void 0&&(_.imageUrl=t[6]),t[7]!==void 0&&(_.fileContent=t[7]),a=new _F({props:_}),ue.push(()=>pe(a,"chatHistoryStorage",p)),ue.push(()=>pe(a,"documentVectorStorage",h)),ue.push(()=>pe(a,"imageUrl",g)),ue.push(()=>pe(a,"fileContent",b)),a.$on("messageUpdate",t[11]),a.$on("titleUpdate",t[11]),{c(){e=M("div"),De(n.$$.fragment),s=ee(),De(a.$$.fragment),T(e,"class","chat-container svelte-wqoale")},m(y,E){ce(y,e,E),Pe(n,e,null),O(e,s),Pe(a,e,null),l=!0},p(y,[E]){const I={};!r&&E&1&&(r=!0,I.chatHistoryStorage=y[0],me(()=>r=!1)),n.$set(I);const w={};E&32&&(w.currentChat=y[5]),E&8&&(w.promptStorage=y[3]),E&4&&(w.settingStorage=y[2]),E&16&&(w.lute=y[4]),!i&&E&1&&(i=!0,w.chatHistoryStorage=y[0],me(()=>i=!1)),!o&&E&2&&(o=!0,w.documentVectorStorage=y[1],me(()=>o=!1)),!u&&E&64&&(u=!0,w.imageUrl=y[6],me(()=>u=!1)),!c&&E&128&&(c=!0,w.fileContent=y[7],me(()=>c=!1)),a.$set(w)},i(y){l||(ie(n.$$.fragment,y),ie(a.$$.fragment,y),l=!0)},o(y){de(n.$$.fragment,y),de(a.$$.fragment,y),l=!1},d(y){y&&oe(e),xe(n),xe(a)}}}function EF(t,e,n){let{settingStorage:r}=e,{chatHistoryStorage:s}=e,{promptStorage:a}=e,{documentVectorStorage:i}=e,{lute:o}=e,u=r.getValue("modelSelections"),c=s.dump()[0],l=r.getValue("isSearchChat"),d=r.getValue("isisKnowledgeBaseChat"),m="",p="";function h(){let w=s.dump();n(5,c=w.find(R=>R.id===c.id)||w[0])}function g(w){s=w,n(0,s)}const b=w=>n(5,c=w.detail);function _(w){s=w,n(0,s)}function y(w){i=w,n(1,i)}function E(w){m=w,n(6,m)}function I(w){p=w,n(7,p)}return t.$$set=w=>{"settingStorage"in w&&n(2,r=w.settingStorage),"chatHistoryStorage"in w&&n(0,s=w.chatHistoryStorage),"promptStorage"in w&&n(3,a=w.promptStorage),"documentVectorStorage"in w&&n(1,i=w.documentVectorStorage),"lute"in w&&n(4,o=w.lute)},[s,i,r,a,o,c,m,p,u,l,d,h,g,b,_,y,E,I]}class wF extends tt{constructor(e){super(),et(this,e,EF,yF,Qe,{settingStorage:2,chatHistoryStorage:0,promptStorage:3,documentVectorStorage:1,lute:4})}}function TF(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,h,g,b,_,y,E,I,w,R,v,j,F,x,H;function te(N){t[21](N)}let Z={type:"select",key:"modelSelections",style:"font-size: 12px; border-radius: 4px; border: none ;outline: none;background: transparent; align-self: center;",fnSize:!1,options:t[5].get("modelSelections").options};return t[2]!==void 0&&(Z.value=t[2]),v=new Xr({props:Z}),ue.push(()=>pe(v,"value",te)),v.$on("changed",t[22]),{c(){e=M("div"),n=M("div"),r=M("textarea"),a=ee(),i=M("div"),o=M("div"),u=M("button"),c=pt("svg"),l=pt("path"),d=ee(),m=M("button"),p=pt("svg"),h=pt("path"),b=ee(),_=M("button"),y=pt("svg"),E=pt("path"),w=ee(),R=M("div"),De(v.$$.fragment),T(r,"placeholder",s=t[7].instructionInputPlaceholder),T(r,"class","svelte-1jmq1d6"),T(n,"class","input svelte-1jmq1d6"),T(l,"d","M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"),T(c,"viewBox","0 0 24 24"),T(c,"class","tools-icon svelte-1jmq1d6"),_e(c,"active",t[3]),T(u,"type","button"),T(u,"class","tools-button svelte-1jmq1d6"),T(h,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"),T(p,"viewBox","0 0 24 24"),T(p,"class","tools-icon svelte-1jmq1d6"),_e(p,"active",t[8]),T(m,"title",g=t[7].onlineSearch),T(m,"type","button"),T(m,"class","tools-button svelte-1jmq1d6"),_e(m,"active",t[8]),T(E,"d","M21 5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5zm-2 14H5V5h14v14zM7 15h10v2H7v-2zm0-4h10v2H7v-2zm0-4h10v2H7V7z"),T(y,"viewBox","0 0 24 24"),T(y,"class","tools-icon svelte-1jmq1d6"),_e(y,"active",t[9]),T(_,"title",I=t[7].knowledgeBase),T(_,"type","button"),T(_,"class","tools-button svelte-1jmq1d6"),_e(_,"active",t[9]),T(o,"class","tools svelte-1jmq1d6"),T(R,"class","models svelte-1jmq1d6"),T(i,"class","tools-group svelte-1jmq1d6"),T(e,"class","input-container svelte-1jmq1d6")},m(N,S){ce(N,e,S),O(e,n),O(n,r),t[13](r),bt(r,t[0]),O(e,a),O(e,i),O(i,o),O(o,u),O(u,c),O(c,l),O(o,d),O(o,m),O(m,p),O(p,h),O(o,b),O(o,_),O(_,y),O(y,E),O(i,w),O(i,R),Pe(v,R,null),F=!0,x||(H=[ne(r,"input",t[14]),ne(r,"keydown",t[15]),ne(r,"focus",t[16]),ne(r,"blur",t[17]),ne(u,"click",t[18]),ne(m,"click",t[19]),ne(_,"click",t[20])],x=!0)},p(N,[S]){(!F||S&128&&s!==(s=N[7].instructionInputPlaceholder))&&T(r,"placeholder",s),S&1&&bt(r,N[0]),(!F||S&8)&&_e(c,"active",N[3]),(!F||S&256)&&_e(p,"active",N[8]),(!F||S&128&&g!==(g=N[7].onlineSearch))&&T(m,"title",g),(!F||S&256)&&_e(m,"active",N[8]),(!F||S&512)&&_e(y,"active",N[9]),(!F||S&128&&I!==(I=N[7].knowledgeBase))&&T(_,"title",I),(!F||S&512)&&_e(_,"active",N[9]);const P={};S&32&&(P.options=N[5].get("modelSelections").options),!j&&S&4&&(j=!0,P.value=N[2],me(()=>j=!1)),v.$set(P)},i(N){F||(ie(v.$$.fragment,N),F=!0)},o(N){de(v.$$.fragment,N),F=!1},d(N){N&&oe(e),t[13](null),xe(v),x=!1,st(H)}}}function SF(t,e,n){let{inputValue:r}=e,{inputElement:s}=e,{selectedModel:a}=e,{settingStorage:i}=e,{documentVectorStorage:o}=e,{showParams:u}=e,{handleSubmit:c}=e,{i18n:l}=e,{isFocused:d=!0}=e,m=i.getValue("isSearchInstruction"),p=i.getValue("isKnowledgeBaseInstruction");function h(){n(8,m=!m),i.setValue("isSearchInstruction",m),i.save()}async function g(){n(9,p=!p),i.setValue("isKnowledgeBaseInstruction",p),i.save(),p?await o.load():(await o.save(),await o.release())}function b(x){ue[x?"unshift":"push"](()=>{s=x,n(1,s)})}function _(){r=this.value,n(0,r)}const y=x=>{x.key==="Enter"&&!x.shiftKey&&!x.isComposing&&(x.preventDefault(),c())},E=()=>{n(4,d=!0)},I=()=>{n(4,d=!1)},w=()=>{n(3,u=!u),u||i.save()},R=()=>{h()},v=()=>{g()};function j(x){a=x,n(2,a)}const F=({detail:x})=>{i.setValue(x.key,x.value),i.save()};return t.$$set=x=>{"inputValue"in x&&n(0,r=x.inputValue),"inputElement"in x&&n(1,s=x.inputElement),"selectedModel"in x&&n(2,a=x.selectedModel),"settingStorage"in x&&n(5,i=x.settingStorage),"documentVectorStorage"in x&&n(12,o=x.documentVectorStorage),"showParams"in x&&n(3,u=x.showParams),"handleSubmit"in x&&n(6,c=x.handleSubmit),"i18n"in x&&n(7,l=x.i18n),"isFocused"in x&&n(4,d=x.isFocused)},[r,s,a,u,d,i,c,l,m,p,h,g,o,b,_,y,E,I,w,R,v,j,F]}class AF extends tt{constructor(e){super(),et(this,e,SF,TF,Qe,{inputValue:0,inputElement:1,selectedModel:2,settingStorage:5,documentVectorStorage:12,showParams:3,handleSubmit:6,i18n:7,isFocused:4})}}function _b(t){let e,n,r=t[4]?"":"...",s,a,i,o;return{c(){e=M("div"),n=M("button"),s=Ke(r),T(n,"type","button"),T(n,"class","generation-text svelte-1t9569r"),T(n,"aria-label",a=t[4]?"":"..."),T(e,"class","generating svelte-1t9569r")},m(u,c){ce(u,e,c),O(e,n),O(n,s),i||(o=[ne(n,"mouseenter",t[8]),ne(n,"mouseleave",t[9]),ne(n,"click",t[5]),ne(n,"keydown",t[10])],i=!0)},p(u,c){c&16&&r!==(r=u[4]?"":"...")&&lt(s,r),c&16&&a!==(a=u[4]?"":"...")&&T(n,"aria-label",a)},d(u){u&&oe(e),i=!1,st(o)}}}function CF(t){let e,n,r=t[3].Md2HTML(t[1])+"",s,a=t[2]&&_b(t);return{c(){e=M("div"),n=M("div"),s=ee(),a&&a.c(),T(n,"class","output svelte-1t9569r"),T(e,"class","output-container svelte-1t9569r")},m(i,o){ce(i,e,o),O(e,n),n.innerHTML=r,t[7](n),O(e,s),a&&a.m(e,null)},p(i,[o]){o&10&&r!==(r=i[3].Md2HTML(i[1])+"")&&(n.innerHTML=r),i[2]?a?a.p(i,o):(a=_b(i),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:Ze,o:Ze,d(i){i&&oe(e),t[7](null),a&&a.d()}}}function vF(t,e,n){let{outputContent:r}=e,{isGenerating:s}=e,{outputContainer:a}=e,{lute:i}=e,{isInterrupted:o}=e,u=!1;function c(){n(6,o=!0)}function l(h){ue[h?"unshift":"push"](()=>{a=h,n(0,a)})}const d=()=>n(4,u=!0),m=()=>n(4,u=!1),p=h=>h.key==="Enter"&&c();return t.$$set=h=>{"outputContent"in h&&n(1,r=h.outputContent),"isGenerating"in h&&n(2,s=h.isGenerating),"outputContainer"in h&&n(0,a=h.outputContainer),"lute"in h&&n(3,i=h.lute),"isInterrupted"in h&&n(6,o=h.isInterrupted)},[a,r,s,i,u,c,o,l,d,m,p]}class gT extends tt{constructor(e){super(),et(this,e,vF,CF,Qe,{outputContent:1,isGenerating:2,outputContainer:0,lute:3,isInterrupted:6})}}function yb(t){let e,n,r,s,a;function i(l){t[18](l)}function o(l){t[19](l)}function u(l){t[20](l)}let c={outputContent:t[10],lute:t[3]};return t[12]!==void 0&&(c.isInterrupted=t[12]),t[11]!==void 0&&(c.isGenerating=t[11]),t[6]!==void 0&&(c.outputContainer=t[6]),e=new gT({props:c}),ue.push(()=>pe(e,"isInterrupted",i)),ue.push(()=>pe(e,"isGenerating",o)),ue.push(()=>pe(e,"outputContainer",u)),{c(){De(e.$$.fragment)},m(l,d){Pe(e,l,d),a=!0},p(l,d){const m={};d[0]&1024&&(m.outputContent=l[10]),d[0]&8&&(m.lute=l[3]),!n&&d[0]&4096&&(n=!0,m.isInterrupted=l[12],me(()=>n=!1)),!r&&d[0]&2048&&(r=!0,m.isGenerating=l[11],me(()=>r=!1)),!s&&d[0]&64&&(s=!0,m.outputContainer=l[6],me(()=>s=!1)),e.$set(m)},i(l){a||(ie(e.$$.fragment,l),a=!0)},o(l){de(e.$$.fragment,l),a=!1},d(l){xe(e,l)}}}function Eb(t){let e,n,r;function s(i){t[27](i)}let a={group:"instruction"};return t[0]!==void 0&&(a.settingStorage=t[0]),e=new Mf({props:a}),ue.push(()=>pe(e,"settingStorage",s)),{c(){De(e.$$.fragment)},m(i,o){Pe(e,i,o),r=!0},p(i,o){const u={};!n&&o[0]&1&&(n=!0,u.settingStorage=i[0],me(()=>n=!1)),e.$set(u)},i(i){r||(ie(e.$$.fragment,i),r=!0)},o(i){de(e.$$.fragment,i),r=!1},d(i){xe(e,i)}}}function wb(t){let e,n,r,s,a;function i(l){t[28](l)}function o(l){t[29](l)}function u(l){t[30](l)}let c={isCommand:!1};return t[7]!==void 0&&(c.inputAreaComponent=t[7]),t[4]!==void 0&&(c.searchText=t[4]),t[1]!==void 0&&(c.promptStorage=t[1]),e=new Qc({props:c}),ue.push(()=>pe(e,"inputAreaComponent",i)),ue.push(()=>pe(e,"searchText",o)),ue.push(()=>pe(e,"promptStorage",u)),{c(){De(e.$$.fragment)},m(l,d){Pe(e,l,d),a=!0},p(l,d){const m={};!n&&d[0]&128&&(n=!0,m.inputAreaComponent=l[7],me(()=>n=!1)),!r&&d[0]&16&&(r=!0,m.searchText=l[4],me(()=>r=!1)),!s&&d[0]&2&&(s=!0,m.promptStorage=l[1],me(()=>s=!1)),e.$set(m)},i(l){a||(ie(e.$$.fragment,l),a=!0)},o(l){de(e.$$.fragment,l),a=!1},d(l){xe(e,l)}}}function OF(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,h=t[9]&&yb(t);function g(j){t[21](j)}function b(j){t[22](j)}function _(j){t[23](j)}function y(j){t[24](j)}function E(j){t[25](j)}function I(j){t[26](j)}let w={handleSubmit:t[15],i18n:t[14]};t[4]!==void 0&&(w.inputValue=t[4]),t[7]!==void 0&&(w.inputElement=t[7]),t[8]!==void 0&&(w.selectedModel=t[8]),t[0]!==void 0&&(w.settingStorage=t[0]),t[2]!==void 0&&(w.documentVectorStorage=t[2]),t[5]!==void 0&&(w.showParams=t[5]),r=new AF({props:w}),ue.push(()=>pe(r,"inputValue",g)),ue.push(()=>pe(r,"inputElement",b)),ue.push(()=>pe(r,"selectedModel",_)),ue.push(()=>pe(r,"settingStorage",y)),ue.push(()=>pe(r,"documentVectorStorage",E)),ue.push(()=>pe(r,"showParams",I));let R=t[5]&&Eb(t),v=t[13]&&wb(t);return{c(){e=M("div"),h&&h.c(),n=ee(),De(r.$$.fragment),l=ee(),d=M("div"),R&&R.c(),m=ee(),v&&v.c(),St(d,"width","100%"),T(e,"class","instruction-container svelte-1dkyoze")},m(j,F){ce(j,e,F),h&&h.m(e,null),O(e,n),Pe(r,e,null),O(e,l),O(e,d),R&&R.m(d,null),O(d,m),v&&v.m(d,null),p=!0},p(j,F){j[9]?h?(h.p(j,F),F[0]&512&&ie(h,1)):(h=yb(j),h.c(),ie(h,1),h.m(e,n)):h&&(hr(),de(h,1,1,()=>{h=null}),fr());const x={};!s&&F[0]&16&&(s=!0,x.inputValue=j[4],me(()=>s=!1)),!a&&F[0]&128&&(a=!0,x.inputElement=j[7],me(()=>a=!1)),!i&&F[0]&256&&(i=!0,x.selectedModel=j[8],me(()=>i=!1)),!o&&F[0]&1&&(o=!0,x.settingStorage=j[0],me(()=>o=!1)),!u&&F[0]&4&&(u=!0,x.documentVectorStorage=j[2],me(()=>u=!1)),!c&&F[0]&32&&(c=!0,x.showParams=j[5],me(()=>c=!1)),r.$set(x),j[5]?R?(R.p(j,F),F[0]&32&&ie(R,1)):(R=Eb(j),R.c(),ie(R,1),R.m(d,m)):R&&(hr(),de(R,1,1,()=>{R=null}),fr()),j[13]?v?(v.p(j,F),F[0]&8192&&ie(v,1)):(v=wb(j),v.c(),ie(v,1),v.m(d,null)):v&&(hr(),de(v,1,1,()=>{v=null}),fr())},i(j){p||(ie(h),ie(r.$$.fragment,j),ie(R),ie(v),p=!0)},o(j){de(h),de(r.$$.fragment,j),de(R),de(v),p=!1},d(j){j&&oe(e),h&&h.d(),xe(r),R&&R.d(),v&&v.d()}}}function kF(t,e,n){let r,{settingStorage:s}=e,{promptStorage:a}=e,{documentVectorStorage:i}=e,{lute:o}=e,{selectedText:u}=e,{pageContent:c}=e;El(s.i18n);let l=s.i18n,d,m="",p=!1,h=s.getValue("modelSelections"),g=!1,b="",_=!1,y=!1,E;async function I(){n(9,g=!0),n(11,_=!0),n(10,b="");let G=m.startsWith("/")?m.slice(1):m,se=[];u.trim().length>0?se.push({role:"user",content:`${u}

${G}`}):s.getValue("isPageContent")?se.push({role:"user",content:`${c.title}

${c.content}

${G}`}):se.push({role:"user",content:`${G}`});try{await Da({apiKey:s.getValue("apiKey"),phone:s.getValue("phone"),model:h,maxTokens:s.getValue("maxOutputLengthInstruction"),temperature:s.getValue("temperatureInstruction"),timeout:s.getValue("responseTimeoutInstruction"),isSearch:s.getValue("isSearchInstruction"),isStream:!0,isClipboard:!0,isKnowledge:s.getValue("isKnowledgeBaseInstruction"),callback:(Le,ke)=>{if(y)throw new Error("User interrupted");n(10,b=Le),E&&!w&&n(6,E.scrollTop=E.scrollHeight,E)},knowledgeCallback:async Le=>{const ke=await i.similaritySearchWithScore(Le,s.getValue("knowledgeBaseRecallNumInstruction"));let At=[];for(const Rt of ke)Rt[1]<.7||At.push(Rt[0]);return At},messages:se})}finally{n(11,_=!1)}}let w=!1,R=0;function v(G){G&&G.addEventListener("scroll",()=>{G.scrollTop<R&&(w=!0),R=G.scrollTop,G.scrollHeight-G.scrollTop-G.clientHeight<50&&(w=!1)})}Rr(()=>{d.focus()});function j(G){y=G,n(12,y)}function F(G){_=G,n(11,_)}function x(G){E=G,n(6,E)}function H(G){m=G,n(4,m)}function te(G){d=G,n(7,d)}function Z(G){h=G,n(8,h)}function N(G){s=G,n(0,s)}function S(G){i=G,n(2,i)}function P(G){p=G,n(5,p)}function U(G){s=G,n(0,s)}function D(G){d=G,n(7,d)}function W(G){m=G,n(4,m)}function K(G){a=G,n(1,a)}return t.$$set=G=>{"settingStorage"in G&&n(0,s=G.settingStorage),"promptStorage"in G&&n(1,a=G.promptStorage),"documentVectorStorage"in G&&n(2,i=G.documentVectorStorage),"lute"in G&&n(3,o=G.lute),"selectedText"in G&&n(16,u=G.selectedText),"pageContent"in G&&n(17,c=G.pageContent)},t.$$.update=()=>{t.$$.dirty[0]&48&&n(13,r=m.trim().startsWith("/")&&!p),t.$$.dirty[0]&64&&E&&v(E)},[s,a,i,o,m,p,E,d,h,g,b,_,y,r,l,I,u,c,j,F,x,H,te,Z,N,S,P,U,D,W,K]}class IF extends tt{constructor(e){super(),et(this,e,kF,OF,Qe,{settingStorage:0,promptStorage:1,documentVectorStorage:2,lute:3,selectedText:16,pageContent:17},null,[-1,-1])}}function Tb(t,e,n){const r=t.slice();return r[6]=e[n],r}function Sb(t){let e,n,r,s=t[6].title+"",a,i,o,u=t[6].time+"",c,l,d,m,p,h;function g(){return t[4](t[6])}function b(){return t[5](t[6])}return{c(){e=M("div"),n=M("button"),r=M("span"),a=Ke(s),i=ee(),o=M("div"),c=Ke(u),l=ee(),d=M("button"),d.innerHTML='<svg viewBox="0 0 24 24" width="1rem" height="1rem" stroke="currentColor" stroke-width="2" fill="none" class="svelte-x3noak"><path d="M18 6L6 18M6 6l12 12"></path></svg>',m=ee(),T(r,"class","svelte-x3noak"),T(o,"class","time svelte-x3noak"),T(n,"class","item-content svelte-x3noak"),T(d,"class","delete-btn svelte-x3noak"),T(d,"title",""),T(e,"class","list-item svelte-x3noak")},m(_,y){ce(_,e,y),O(e,n),O(n,r),O(r,a),O(n,i),O(n,o),O(o,c),O(e,l),O(e,d),O(e,m),p||(h=[ne(n,"click",g),ne(d,"click",S_(b))],p=!0)},p(_,y){t=_,y&1&&s!==(s=t[6].title+"")&&lt(a,s),y&1&&u!==(u=t[6].time+"")&&lt(c,u)},d(_){_&&oe(e),p=!1,st(h)}}}function NF(t){let e,n,r,s,a,i,o,u=t[0].i18n.newChat+"",c,l,d,m,p=_t(t[0].dump()),h=[];for(let g=0;g<p.length;g+=1)h[g]=Sb(Tb(t,p,g));return{c(){e=M("div"),n=M("div"),n.innerHTML='<h3 class="svelte-x3noak">SiYuan AI</h3>',r=ee(),s=M("div"),a=M("button"),i=M("span"),o=Ke("+ "),c=Ke(u),l=ee();for(let g=0;g<h.length;g+=1)h[g].c();T(n,"class","history-header svelte-x3noak"),T(i,"class","svelte-x3noak"),T(a,"class","new-chat-btn svelte-x3noak"),T(s,"class","list svelte-x3noak"),T(e,"class","history svelte-x3noak")},m(g,b){ce(g,e,b),O(e,n),O(e,r),O(e,s),O(s,a),O(a,i),O(i,o),O(i,c),O(s,l);for(let _=0;_<h.length;_+=1)h[_]&&h[_].m(s,null);d||(m=ne(a,"click",t[2]),d=!0)},p(g,[b]){if(b&1&&u!==(u=g[0].i18n.newChat+"")&&lt(c,u),b&11){p=_t(g[0].dump());let _;for(_=0;_<p.length;_+=1){const y=Tb(g,p,_);h[_]?h[_].p(y,b):(h[_]=Sb(y),h[_].c(),h[_].m(s,null))}for(;_<h.length;_+=1)h[_].d(1);h.length=p.length}},i:Ze,o:Ze,d(g){g&&oe(e),Qr(h,g),d=!1,m()}}}function RF(t,e,n){let{chatHistoryStorage:r}=e;const s=yn();function a(){const c={id:Date.now(),title:r.i18n.newChat,time:Bu().format("YYYY/M/D HH:mm:ss"),messages:[]};r.add(c),n(0,r),s("selectChat",c)}function i(c){r.delete(c),r.data.length===0&&a(),n(0,r),s("selectChat",r.dump()[0])}const o=c=>s("selectChat",c),u=c=>i(c.id);return t.$$set=c=>{"chatHistoryStorage"in c&&n(0,r=c.chatHistoryStorage)},[r,s,a,i,o,u]}class PF extends tt{constructor(e){super(),et(this,e,RF,NF,Qe,{chatHistoryStorage:0})}}function Ab(t,e,n){const r=t.slice();return r[16]=e[n],r}function Cb(t){let e,n,r=t[2].Md2HTML(t[16].content)+"",s,a,i,o,u;function c(...l){return t[9](t[16],...l)}return{c(){e=M("div"),n=M("div"),s=ee(),T(n,"class","message-content"),T(e,"class",a="message "+(t[16].role==="user"?"user":"ai")+" svelte-1qgyyzz"),T(e,"role","button"),T(e,"aria-label",i=t[16].role==="user"?"":"AI "),T(e,"tabindex","0")},m(l,d){ce(l,e,d),O(e,n),n.innerHTML=r,O(e,s),o||(u=ne(e,"contextmenu",c),o=!0)},p(l,d){t=l,d&6&&r!==(r=t[2].Md2HTML(t[16].content)+"")&&(n.innerHTML=r),d&2&&a!==(a="message "+(t[16].role==="user"?"user":"ai")+" svelte-1qgyyzz")&&T(e,"class",a),d&2&&i!==(i=t[16].role==="user"?"":"AI ")&&T(e,"aria-label",i)},d(l){l&&oe(e),o=!1,u()}}}function xF(t){let e,n,r,s,a,i,o,u,c=_t(t[1].messages),l=[];for(let d=0;d<c.length;d+=1)l[d]=Cb(Ab(t,c,d));return{c(){e=M("div"),n=M("div"),r=M("div");for(let d=0;d<l.length;d+=1)l[d].c();s=ee(),a=M("div"),i=M("textarea"),T(r,"class","messages-wrapper svelte-1qgyyzz"),T(n,"class","message-container svelte-1qgyyzz"),T(i,"placeholder","/Enter Shift + Enter "),i.disabled=t[0],T(i,"class","svelte-1qgyyzz"),T(a,"class","input-container svelte-1qgyyzz"),T(e,"class","image-container svelte-1qgyyzz")},m(d,m){ce(d,e,m),O(e,n),O(n,r);for(let p=0;p<l.length;p+=1)l[p]&&l[p].m(r,null);t[10](n),O(e,s),O(e,a),O(a,i),t[11](i),bt(i,t[3]),o||(u=[ne(i,"input",t[12]),ne(i,"input",t[6]),ne(i,"keydown",t[7])],o=!0)},p(d,[m]){if(m&6){c=_t(d[1].messages);let p;for(p=0;p<c.length;p+=1){const h=Ab(d,c,p);l[p]?l[p].p(h,m):(l[p]=Cb(h),l[p].c(),l[p].m(r,null))}for(;p<l.length;p+=1)l[p].d(1);l.length=c.length}m&1&&(i.disabled=d[0]),m&8&&bt(i,d[3])},i:Ze,o:Ze,d(d){d&&oe(e),Qr(l,d),t[10](null),t[11](null),o=!1,st(u)}}}async function LF(t,e){if(e.role!=="assistant")return;const n=e.content.match(/!\[.*?\]\((.*?)\)/);if(!n)return;t.preventDefault();const r=n[1];try{const s=document.createElement("a");s.href=r;const a=r.split("/").pop()||`image-${Date.now()}.png`;s.download=a,document.body.appendChild(s),s.click(),document.body.removeChild(s)}catch(s){console.error(":",s)}}function DF(t,e,n){let{promptStorage:r}=e,{isGenerating:s}=e,{currentChat:a}=e,{lute:i}=e,o="",u,c;const l=yn();function d(){if(c){const E=c.scrollHeight,I=c.clientHeight,w=E-I;c.scrollTo({top:w,behavior:"smooth"})}}function m(E){const I=E.target;I.value==="/"&&I.selectionStart===1&&h()}function p(E){E.key==="Enter"&&!E.shiftKey&&!E.isComposing&&(E.preventDefault(),l("sendMessage",o),n(3,o=""))}function h(){const E=new dt.Dialog({title:"",content:'<div id="chat-prompts-panel" style="height: 100%; margin:0px; padding:0px;"></div>',width:"40%",hideCloseIcon:!0});new Qc({target:E.element.querySelector("#chat-prompts-panel"),props:{inputAreaComponent:u,promptStorage:r,searchText:o,isCommand:!1}}).$on("searchTextChange",w=>{n(3,o=w.detail),n(4,u.style.height="auto",u),n(4,u.style.height=`${u.scrollHeight}px`,u)})}Rr(()=>{u.focus()});const g=(E,I)=>LF(I,E);function b(E){ue[E?"unshift":"push"](()=>{c=E,n(5,c)})}function _(E){ue[E?"unshift":"push"](()=>{u=E,n(4,u)})}function y(){o=this.value,n(3,o)}return t.$$set=E=>{"promptStorage"in E&&n(8,r=E.promptStorage),"isGenerating"in E&&n(0,s=E.isGenerating),"currentChat"in E&&n(1,a=E.currentChat),"lute"in E&&n(2,i=E.lute)},t.$$.update=()=>{if(t.$$.dirty&2&&a!=null&&a.messages){const E=a.messages[a.messages.length-1];E&&(E==null?void 0:E.role)!=="user"&&E.content&&d()}},[s,a,i,o,u,c,m,p,r,g,b,_,y]}class MF extends tt{constructor(e){super(),et(this,e,DF,xF,Qe,{promptStorage:8,isGenerating:0,currentChat:1,lute:2})}}function vb(t,e,n){const r=t.slice();return r[3]=e[n],r}function Ob(t){let e,n,r,s;return r=new Xr({props:{type:t[3].type,key:t[3].key,value:t[3].value,options:t[3].options,style:"width=90%;"}}),r.$on("changed",t[2]),{c(){e=M("span"),e.textContent=`${t[3].title}`,n=ee(),De(r.$$.fragment),T(e,"class","title svelte-duw9im")},m(a,i){ce(a,e,i),ce(a,n,i),Pe(r,a,i),s=!0},p:Ze,i(a){s||(ie(r.$$.fragment,a),s=!0)},o(a){de(r.$$.fragment,a),s=!1},d(a){a&&(oe(e),oe(n)),xe(r,a)}}}function BF(t){let e,n,r,s=_t(t[1]),a=[];for(let o=0;o<s.length;o+=1)a[o]=Ob(vb(t,s,o));const i=o=>de(a[o],1,1,()=>{a[o]=null});return{c(){e=M("div"),n=M("div");for(let o=0;o<a.length;o+=1)a[o].c();T(n,"class","param-group svelte-duw9im"),T(e,"class","params-container svelte-duw9im")},m(o,u){ce(o,e,u),O(e,n);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(n,null);r=!0},p(o,[u]){if(u&3){s=_t(o[1]);let c;for(c=0;c<s.length;c+=1){const l=vb(o,s,c);a[c]?(a[c].p(l,u),ie(a[c],1)):(a[c]=Ob(l),a[c].c(),ie(a[c],1),a[c].m(n,null))}for(hr(),c=s.length;c<a.length;c+=1)i(c);fr()}},i(o){if(!r){for(let u=0;u<s.length;u+=1)ie(a[u]);r=!0}},o(o){a=a.filter(Boolean);for(let u=0;u<a.length;u+=1)de(a[u]);r=!1},d(o){o&&oe(e),Qr(a,o)}}}function FF(t,e,n){let{settingStorage:r}=e,s=r.getSettingItems("image");const a=({detail:i})=>{r.setValue(i.key,i.value),r.save()};return t.$$set=i=>{"settingStorage"in i&&n(0,r=i.settingStorage)},[r,s,a]}class UF extends tt{constructor(e){super(),et(this,e,FF,BF,Qe,{settingStorage:0})}}async function jF(t,e,n){let r="";try{r=await pF({apiKey:t.getValue("apiKey"),model:e.model,messages:n});const s=df+"/uploadImage",a={Authorization:t.getValue("apiKey")},i=await Ye.post(s,{image_url:r},{headers:a});return i.status==200&&(r=i.data.url),r}catch(s){if(console.error(":",s),r)return r;throw s}}function HF(t){let e,n,r,s,a,i,o,u,c,l,d,m;function p(w){t[8](w)}let h={};t[1]!==void 0&&(h.chatHistoryStorage=t[1]),n=new PF({props:h}),ue.push(()=>pe(n,"chatHistoryStorage",p)),n.$on("selectChat",t[9]);function g(w){t[10](w)}function b(w){t[11](w)}function _(w){t[12](w)}let y={lute:t[3]};t[2]!==void 0&&(y.promptStorage=t[2]),t[5]!==void 0&&(y.isGenerating=t[5]),t[4]!==void 0&&(y.currentChat=t[4]),a=new MF({props:y}),ue.push(()=>pe(a,"promptStorage",g)),ue.push(()=>pe(a,"isGenerating",b)),ue.push(()=>pe(a,"currentChat",_)),a.$on("messageUpdate",t[6]),a.$on("sendMessage",t[13]);function E(w){t[14](w)}let I={};return t[0]!==void 0&&(I.settingStorage=t[0]),l=new UF({props:I}),ue.push(()=>pe(l,"settingStorage",E)),{c(){e=M("div"),De(n.$$.fragment),s=ee(),De(a.$$.fragment),c=ee(),De(l.$$.fragment),T(e,"class","image-container-box svelte-1pbyj0v")},m(w,R){ce(w,e,R),Pe(n,e,null),O(e,s),Pe(a,e,null),O(e,c),Pe(l,e,null),m=!0},p(w,[R]){const v={};!r&&R&2&&(r=!0,v.chatHistoryStorage=w[1],me(()=>r=!1)),n.$set(v);const j={};R&8&&(j.lute=w[3]),!i&&R&4&&(i=!0,j.promptStorage=w[2],me(()=>i=!1)),!o&&R&32&&(o=!0,j.isGenerating=w[5],me(()=>o=!1)),!u&&R&16&&(u=!0,j.currentChat=w[4],me(()=>u=!1)),a.$set(j);const F={};!d&&R&1&&(d=!0,F.settingStorage=w[0],me(()=>d=!1)),l.$set(F)},i(w){m||(ie(n.$$.fragment,w),ie(a.$$.fragment,w),ie(l.$$.fragment,w),m=!0)},o(w){de(n.$$.fragment,w),de(a.$$.fragment,w),de(l.$$.fragment,w),m=!1},d(w){w&&oe(e),xe(n),xe(a),xe(l)}}}function $F(t,e,n){let{settingStorage:r}=e,{chatHistoryStorage:s}=e,{promptStorage:a}=e,{lute:i}=e,o=s.dump()[0],u=!1;function c(){let y=s.dump();n(4,o=y.find(E=>E.id===o.id)||y[0])}async function l(y){if(!(u||!y.trim()))try{const E={model:r.getValue("modelImage"),size:r.getValue("sizeImage"),seed:r.getValue("seedImage"),steps:r.getValue("stepsImage"),guidance:r.getValue("guidanceImage"),negativePrompt:r.getValue("negativePromptImage")};n(4,o.messages=[...o.messages,{id:Date.now(),role:"user",content:y,imageParam:E}],o),s.update(o);try{const I=await jF(r,E,o.messages);n(4,o.messages=[...o.messages,{id:Date.now(),role:"assistant",content:`![](${I})`}],o),Fm([{role:"user",content:`5${y}`}],r.getValue("apiKey")).then(w=>{n(4,o.title=w,o),s.update(o),n(1,s)})}catch(I){console.error("AI :",I),n(4,o.messages=o.messages.slice(0,-1),o)}}finally{s.update(o),n(5,u=!1)}}function d(y){s=y,n(1,s)}const m=y=>n(4,o=y.detail);function p(y){a=y,n(2,a)}function h(y){u=y,n(5,u)}function g(y){o=y,n(4,o)}const b=async({detail:y})=>await l(y);function _(y){r=y,n(0,r)}return t.$$set=y=>{"settingStorage"in y&&n(0,r=y.settingStorage),"chatHistoryStorage"in y&&n(1,s=y.chatHistoryStorage),"promptStorage"in y&&n(2,a=y.promptStorage),"lute"in y&&n(3,i=y.lute)},[r,s,a,i,o,u,c,l,d,m,p,h,g,b,_]}class qF extends tt{constructor(e){super(),et(this,e,$F,HF,Qe,{settingStorage:0,chatHistoryStorage:1,promptStorage:2,lute:3})}}function kb(t){let e,n,r;return{c(){e=M("button"),e.innerHTML="<span></span>",T(e,"class","clear-btn svelte-5yxkd9")},m(s,a){ce(s,e,a),n||(r=ne(e,"click",t[15]),n=!0)},p:Ze,d(s){s&&oe(e),n=!1,r()}}}function Ib(t){let e,n,r,s;function a(u){t[22](u)}function i(u){t[23](u)}let o={};return t[4]!==void 0&&(o.showEditPanel=t[4]),t[5]!==void 0&&(o.currentPrompt=t[5]),e=new r1({props:o}),ue.push(()=>pe(e,"showEditPanel",a)),ue.push(()=>pe(e,"currentPrompt",i)),e.$on("save",t[10]),{c(){De(e.$$.fragment)},m(u,c){Pe(e,u,c),s=!0},p(u,c){const l={};!n&&c&16&&(n=!0,l.showEditPanel=u[4],me(()=>n=!1)),!r&&c&32&&(r=!0,l.currentPrompt=u[5],me(()=>r=!1)),e.$set(l)},i(u){s||(ie(e.$$.fragment,u),s=!0)},o(u){de(e.$$.fragment,u),s=!1},d(u){xe(e,u)}}}function VF(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,h,g,b,_,y=t[1]&&kb(t);function E(R){t[17](R)}let I={type:"select",key:"modelSelections",style:"font-size: 12px; transition: all 0.2s ease; margin: 5px 0;  border-radius: 8px; border: 1px solid var(--b3-theme-surface-lighter); background: var(--b3-theme-surface);",fnSize:!1,options:t[0].get("modelSelections").options};t[3]!==void 0&&(I.value=t[3]),l=new Xr({props:I}),ue.push(()=>pe(l,"value",E)),l.$on("changed",t[18]),p=new s1({props:{inputAreaComponent:t[2],prompts:t[6]}}),p.$on("edit",t[19]),p.$on("delete",t[20]),p.$on("use",t[21]);let w=t[4]&&Ib(t);return{c(){e=M("div"),n=M("div"),r=M("textarea"),s=ee(),y&&y.c(),a=ee(),i=M("div"),o=M("button"),o.innerHTML='<span class="add-icon svelte-5yxkd9">+</span> <span class="btn-text svelte-5yxkd9"> Prompt</span>',u=ee(),c=M("div"),De(l.$$.fragment),m=ee(),De(p.$$.fragment),h=ee(),w&&w.c(),T(r,"class","search-input svelte-5yxkd9"),T(r,"placeholder"," Prompt..."),T(n,"class","search-container svelte-5yxkd9"),T(o,"class","add-prompt-btn svelte-5yxkd9"),T(c,"class","models"),T(i,"class","tools svelte-5yxkd9"),T(e,"class","prompts-panel svelte-5yxkd9")},m(R,v){ce(R,e,v),O(e,n),O(n,r),t[13](r),bt(r,t[1]),O(n,s),y&&y.m(n,null),O(e,a),O(e,i),O(i,o),O(i,u),O(i,c),Pe(l,c,null),O(e,m),Pe(p,e,null),O(e,h),w&&w.m(e,null),g=!0,b||(_=[ne(r,"input",t[14]),ne(o,"click",t[16])],b=!0)},p(R,[v]){v&2&&bt(r,R[1]),R[1]?y?y.p(R,v):(y=kb(R),y.c(),y.m(n,null)):y&&(y.d(1),y=null);const j={};v&1&&(j.options=R[0].get("modelSelections").options),!d&&v&8&&(d=!0,j.value=R[3],me(()=>d=!1)),l.$set(j);const F={};v&4&&(F.inputAreaComponent=R[2]),v&64&&(F.prompts=R[6]),p.$set(F),R[4]?w?(w.p(R,v),v&16&&ie(w,1)):(w=Ib(R),w.c(),ie(w,1),w.m(e,null)):w&&(hr(),de(w,1,1,()=>{w=null}),fr())},i(R){g||(ie(l.$$.fragment,R),ie(p.$$.fragment,R),ie(w),g=!0)},o(R){de(l.$$.fragment,R),de(p.$$.fragment,R),de(w),g=!1},d(R){R&&oe(e),t[13](null),y&&y.d(),xe(l),xe(p),w&&w.d(),b=!1,st(_)}}}function zF(t,e,n){let r,s,{promptStorage:a}=e,{settingStorage:i}=e,o,u,c=i.getValue("modelSelections"),l=!1,d;const m=()=>({id:Date.now(),title:"",content:""}),p=yn();function h(Z){a.deletePrompt(Z),n(12,r=a.data)}function g(Z){n(5,d=Z?{...Z}:m()),n(4,l=!0)}function b(Z){n(1,o=Z.content),p("use",Z)}function _(){r.some(N=>N.id===d.id)?a.updatePrompt(d):a.addPrompt(d),n(4,l=!1),n(12,r=a.data)}function y(Z){ue[Z?"unshift":"push"](()=>{u=Z,n(2,u)})}function E(){o=this.value,n(1,o)}const I=()=>n(1,o=""),w=()=>g();function R(Z){c=Z,n(3,c)}const v=({detail:Z})=>{i.setValue(Z.key,Z.value),i.save()},j=Z=>g(Z.detail),F=Z=>h(Z.detail),x=Z=>b(Z.detail);function H(Z){l=Z,n(4,l)}function te(Z){d=Z,n(5,d)}return t.$$set=Z=>{"promptStorage"in Z&&n(11,a=Z.promptStorage),"settingStorage"in Z&&n(0,i=Z.settingStorage)},t.$$.update=()=>{t.$$.dirty&2048&&n(12,r=a.data),t.$$.dirty&4098&&n(6,s=(o==null?void 0:o.length)>1?r.filter(Z=>{const N=o.slice(1).toLowerCase();return Z.title.toLowerCase().includes(N)||Z.content.toLowerCase().includes(N)}):r)},[i,o,u,c,l,d,s,h,g,b,_,a,r,y,E,I,w,R,v,j,F,x,H,te]}class WF extends tt{constructor(e){super(),et(this,e,zF,VF,Qe,{promptStorage:11,settingStorage:0})}}function Nb(t){let e,n,r,s,a;function i(l){t[12](l)}function o(l){t[13](l)}function u(l){t[14](l)}let c={outputContent:t[5],lute:t[2]};return t[7]!==void 0&&(c.isInterrupted=t[7]),t[6]!==void 0&&(c.isGenerating=t[6]),t[3]!==void 0&&(c.outputContainer=t[3]),e=new gT({props:c}),ue.push(()=>pe(e,"isInterrupted",i)),ue.push(()=>pe(e,"isGenerating",o)),ue.push(()=>pe(e,"outputContainer",u)),{c(){De(e.$$.fragment)},m(l,d){Pe(e,l,d),a=!0},p(l,d){const m={};d&32&&(m.outputContent=l[5]),d&4&&(m.lute=l[2]),!n&&d&128&&(n=!0,m.isInterrupted=l[7],me(()=>n=!1)),!r&&d&64&&(r=!0,m.isGenerating=l[6],me(()=>r=!1)),!s&&d&8&&(s=!0,m.outputContainer=l[3],me(()=>s=!1)),e.$set(m)},i(l){a||(ie(e.$$.fragment,l),a=!0)},o(l){de(e.$$.fragment,l),a=!1},d(l){xe(e,l)}}}function GF(t){let e,n,r,s,a,i=t[4]&&Nb(t);function o(c){t[15](c)}let u={settingStorage:t[1]};return t[0]!==void 0&&(u.promptStorage=t[0]),r=new WF({props:u}),ue.push(()=>pe(r,"promptStorage",o)),r.$on("use",t[16]),{c(){e=M("div"),i&&i.c(),n=ee(),De(r.$$.fragment),T(e,"class","prompt-container svelte-1utspvn")},m(c,l){ce(c,e,l),i&&i.m(e,null),O(e,n),Pe(r,e,null),a=!0},p(c,[l]){c[4]?i?(i.p(c,l),l&16&&ie(i,1)):(i=Nb(c),i.c(),ie(i,1),i.m(e,n)):i&&(hr(),de(i,1,1,()=>{i=null}),fr());const d={};l&2&&(d.settingStorage=c[1]),!s&&l&1&&(s=!0,d.promptStorage=c[0],me(()=>s=!1)),r.$set(d)},i(c){a||(ie(i),ie(r.$$.fragment,c),a=!0)},o(c){de(i),de(r.$$.fragment,c),a=!1},d(c){c&&oe(e),i&&i.d(),xe(r)}}}function KF(t,e,n){let{settingStorage:r}=e,{promptStorage:s}=e,{selectedText:a}=e,{pageContent:i}=e,{lute:o}=e,u=!1,c="",l=!1,d=!1,m,p="",h=!1,g=0;El(r.i18n);async function b(){n(4,u=!0),n(6,l=!0),n(5,c="");let v=[];a.trim().length>0?v.push({role:"user",content:`${a}

${p}`}):r.getValue("isPageContent")?v.push({role:"user",content:`${i.title}

${i.content}

${p}`}):v.push({role:"user",content:`${p}`});try{await Da({apiKey:r.getValue("apiKey"),phone:r.getValue("phone"),model:r.getValue("modelSelections"),maxTokens:r.getValue("maxOutputLengthInstruction"),temperature:r.getValue("temperatureInstruction"),timeout:r.getValue("responseTimeoutInstruction"),isSearch:r.getValue("isSearchInstruction"),isStream:!0,isClipboard:!0,isKnowledge:!1,callback:(F,x)=>{if(d)throw new Error("User interrupted");n(5,c=F),m&&!h&&n(3,m.scrollTop=m.scrollHeight,m)},knowledgeCallback:()=>{},messages:v})}finally{n(6,l=!1)}}function _(v){v&&v.addEventListener("scroll",()=>{v.scrollTop<g&&(h=!0),g=v.scrollTop,v.scrollHeight-v.scrollTop-v.clientHeight<50&&(h=!1)})}function y(v){d=v,n(7,d)}function E(v){l=v,n(6,l)}function I(v){m=v,n(3,m)}function w(v){s=v,n(0,s)}const R=async({detail:v})=>{n(8,p=v.content),await b()};return t.$$set=v=>{"settingStorage"in v&&n(1,r=v.settingStorage),"promptStorage"in v&&n(0,s=v.promptStorage),"selectedText"in v&&n(10,a=v.selectedText),"pageContent"in v&&n(11,i=v.pageContent),"lute"in v&&n(2,o=v.lute)},t.$$.update=()=>{t.$$.dirty&8&&m&&_(m)},[s,r,o,m,u,c,l,d,p,b,a,i,y,E,I,w,R]}class YF extends tt{constructor(e){super(),et(this,e,KF,GF,Qe,{settingStorage:1,promptStorage:0,selectedText:10,pageContent:11,lute:2})}}function Rb(t,e,n){const r=new dt.Dialog({title:"",content:'<div id="ai-instruction"></div>',width:"40%",hideCloseIcon:!0}),s=__(),a=y_();t.getValue("apiKey").trim().length<=0&&so("API Key"),new IF({target:r.element.querySelector("#ai-instruction"),props:{settingStorage:t,promptStorage:e,documentVectorStorage:n,selectedText:s,pageContent:a,lute:window.Lute.New()}})}function Pb(t,e,n,r){const s=new dt.Dialog({title:"",content:'<div id="ai-chat" style="height: 100%; margin: 0; padding: 0; overflow: hidden; display:flex;min-height: 0;"></div>',width:"50%",height:"60%",hideCloseIcon:!0});new wF({target:s.element.querySelector("#ai-chat"),props:{settingStorage:t,chatHistoryStorage:e,promptStorage:n,documentVectorStorage:r,lute:window.Lute.New()}})}function ZF(t,e){const n=new dt.Dialog({title:"",content:'<div id="ai-prompt"></div>',width:"30%",hideCloseIcon:!0}),r=__(),s=y_();t.getValue("apiKey").trim().length<=0&&so("API Key"),new YF({target:n.element.querySelector("#ai-prompt"),props:{settingStorage:t,promptStorage:e,selectedText:r,pageContent:s,lute:window.Lute.New()}})}function JF(t,e,n){const r=new dt.Dialog({title:"",content:'<div id="ai-image" style="height: 100%; margin: 0; padding: 0; overflow: hidden; display:flex;min-height: 0;"></div>',width:"60%",height:"70%",hideCloseIcon:!0});new qF({target:r.element.querySelector("#ai-image"),props:{settingStorage:t,chatHistoryStorage:e,promptStorage:n,lute:window.Lute.New()}})}function xb(t,e,n){const r=t.slice();return r[8]=e[n],r}function Lb(t){let e,n,r=t[0].i18n.settingGroup+"",s,a,i,o;function u(){return t[4](t[8])}return{c(){e=M("li"),n=M("span"),s=Ke(r),a=ee(),T(n,"class","b3-list-item__text"),T(e,"data-name","editor"),T(e,"class","b3-list-item"),_e(e,"b3-list-item--focus",t[8]===t[2])},m(c,l){ce(c,e,l),O(e,n),O(n,s),O(e,a),i||(o=[ne(e,"click",u),ne(e,"keydown",QF)],i=!0)},p(c,l){t=c,l&1&&r!==(r=t[0].i18n.settingGroup+"")&&lt(s,r),l&12&&_e(e,"b3-list-item--focus",t[8]===t[2])},d(c){c&&oe(e),i=!1,st(o)}}}function XF(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,h,g=_t(t[3]),b=[];for(let _=0;_<g.length;_+=1)b[_]=Lb(xb(t,g,_));return a=new t1({props:{group:t[3][0],settingStorage:t[0],display:t[2]===t[3][0]}}),a.$on("changed",t[5]),u=new sc({props:{label:t[0].i18n.cancel,text:!0,outline:!0}}),u.$on("click",t[6]),m=new sc({props:{label:t[0].i18n.confirm,text:!1,outline:!1}}),m.$on("click",t[7]),{c(){e=M("div"),n=M("ul");for(let _=0;_<b.length;_+=1)b[_].c();r=ee(),s=M("div"),De(a.$$.fragment),i=ee(),o=M("div"),De(u.$$.fragment),c=ee(),l=M("div"),d=ee(),De(m.$$.fragment),T(n,"class","b3-tab-bar b3-list b3-list--background"),T(l,"class","fn__space"),T(o,"class",p="b3-dialog__action "+(t[2]==t[3][0]?"":"fn__none")),T(s,"class","config__tab-wrap"),T(e,"class","fn__flex-1 fn__flex config__panel")},m(_,y){ce(_,e,y),O(e,n);for(let E=0;E<b.length;E+=1)b[E]&&b[E].m(n,null);O(e,r),O(e,s),Pe(a,s,null),O(s,i),O(s,o),Pe(u,o,null),O(o,c),O(o,l),O(o,d),Pe(m,o,null),h=!0},p(_,[y]){if(y&13){g=_t(_[3]);let R;for(R=0;R<g.length;R+=1){const v=xb(_,g,R);b[R]?b[R].p(v,y):(b[R]=Lb(v),b[R].c(),b[R].m(n,null))}for(;R<b.length;R+=1)b[R].d(1);b.length=g.length}const E={};y&1&&(E.settingStorage=_[0]),y&4&&(E.display=_[2]===_[3][0]),a.$set(E);const I={};y&1&&(I.label=_[0].i18n.cancel),u.$set(I);const w={};y&1&&(w.label=_[0].i18n.confirm),m.$set(w),(!h||y&4&&p!==(p="b3-dialog__action "+(_[2]==_[3][0]?"":"fn__none")))&&T(o,"class",p)},i(_){h||(ie(a.$$.fragment,_),ie(u.$$.fragment,_),ie(m.$$.fragment,_),h=!0)},o(_){de(a.$$.fragment,_),de(u.$$.fragment,_),de(m.$$.fragment,_),h=!1},d(_){_&&oe(e),Qr(b,_),xe(a),xe(u),xe(m)}}}const QF=()=>{};function eU(t,e,n){let r=[" "],s=r[0],{settingStorage:a}=e,{dialog:i}=e;const o=d=>{n(2,s=d)},u=({detail:d})=>{a.setValue(d.key,d.value)},c=()=>{a.load(),i.destroy()},l=()=>{a.save(),i.destroy()};return t.$$set=d=>{"settingStorage"in d&&n(0,a=d.settingStorage),"dialog"in d&&n(1,i=d.dialog)},[a,i,s,r,o,u,c,l]}class tU extends tt{constructor(e){super(),et(this,e,eU,XF,Qe,{settingStorage:0,dialog:1})}}function nU(t){let e,n,r,s;return{c(){e=M("div"),n=M("textarea"),T(n,"placeholder","/Enter Shift + Enter "),n.disabled=t[0],T(n,"class","svelte-1orbocj"),T(e,"class","input-container svelte-1orbocj")},m(a,i){ce(a,e,i),O(e,n),t[7](n),bt(n,t[1]),r||(s=[ne(n,"input",t[8]),ne(n,"input",t[3]),ne(n,"keydown",t[4])],r=!0)},p(a,[i]){i&1&&(n.disabled=a[0]),i&2&&bt(n,a[1])},i:Ze,o:Ze,d(a){a&&oe(e),t[7](null),r=!1,st(s)}}}function rU(t,e,n){let{promptStorage:r}=e,{isGenerating:s}=e,{draftMessage:a=""}=e,i=a,o;const u=yn();function c(h){const g=h.target;g.value==="/"&&g.selectionStart===1&&d()}function l(h){h.key==="Enter"&&!h.shiftKey&&!h.isComposing&&(h.preventDefault(),u("sendMessage",i),n(1,i=""),n(5,a=""))}function d(){const h=new dt.Dialog({title:"",content:'<div id="chat-prompts-panel" style="height: 100%; margin:0px; padding:0px;"></div>',width:"40%",hideCloseIcon:!0});new Qc({target:h.element.querySelector("#chat-prompts-panel"),props:{inputAreaComponent:o,promptStorage:r,searchText:i,isCommand:!1}}).$on("searchTextChange",b=>{n(1,i=b.detail),n(2,o.style.height="auto",o),n(2,o.style.height=`${o.scrollHeight}px`,o)})}Rr(()=>{o.focus()});function m(h){ue[h?"unshift":"push"](()=>{o=h,n(2,o)})}function p(){i=this.value,n(1,i)}return t.$$set=h=>{"promptStorage"in h&&n(6,r=h.promptStorage),"isGenerating"in h&&n(0,s=h.isGenerating),"draftMessage"in h&&n(5,a=h.draftMessage)},t.$$.update=()=>{t.$$.dirty&2&&n(5,a=i)},[s,i,o,c,l,a,r,m,p]}class sU extends tt{constructor(e){super(),et(this,e,rU,nU,Qe,{promptStorage:6,isGenerating:0,draftMessage:5})}}function Db(t,e,n){const r=t.slice();return r[11]=e[n],r}function aU(t){var b;let e,n,r,s=t[1].Md2HTML(t[11].content)+"",a,i,o,u,c,l,d,m,p=((b=t[11])==null?void 0:b.fileContent)&&Mb(),h=t[11].role==="user"&&Bb(t);function g(){return t[7](t[11])}return{c(){e=M("div"),p&&p.c(),n=ee(),r=M("div"),a=ee(),i=M("div"),h&&h.c(),o=ee(),u=M("button"),u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1xmj80i"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',c=ee(),T(r,"class","message-content svelte-1xmj80i"),T(u,"class","action-btn svelte-1xmj80i"),T(i,"class","message-actions svelte-1xmj80i"),T(e,"class",l="message "+(t[11].role==="user"?"user":"ai")+" svelte-1xmj80i")},m(_,y){ce(_,e,y),p&&p.m(e,null),O(e,n),O(e,r),r.innerHTML=s,O(e,a),O(e,i),h&&h.m(i,null),O(i,o),O(i,u),O(e,c),d||(m=ne(u,"click",g),d=!0)},p(_,y){var E;t=_,(E=t[11])!=null&&E.fileContent?p||(p=Mb(),p.c(),p.m(e,n)):p&&(p.d(1),p=null),y&3&&s!==(s=t[1].Md2HTML(t[11].content)+"")&&(r.innerHTML=s),t[11].role==="user"?h?h.p(t,y):(h=Bb(t),h.c(),h.m(i,o)):h&&(h.d(1),h=null),y&1&&l!==(l="message "+(t[11].role==="user"?"user":"ai")+" svelte-1xmj80i")&&T(e,"class",l)},d(_){_&&oe(e),p&&p.d(),h&&h.d(),d=!1,m()}}}function iU(t){let e,n,r=t[1].Md2HTML(`![User uploaded image](${t[11].image})

${t[11].content}`)+"",s,a,i,o,u,c,l,d,m=t[11].role==="user"&&Fb(t);function p(){return t[5](t[11])}return{c(){e=M("div"),n=M("div"),s=ee(),a=M("div"),m&&m.c(),i=ee(),o=M("button"),o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1xmj80i"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',u=ee(),T(n,"class","message-content svelte-1xmj80i"),T(o,"class","action-btn svelte-1xmj80i"),T(a,"class","message-actions svelte-1xmj80i"),T(e,"class",c="message "+(t[11].role==="user"?"user":"ai")+" svelte-1xmj80i")},m(h,g){ce(h,e,g),O(e,n),n.innerHTML=r,O(e,s),O(e,a),m&&m.m(a,null),O(a,i),O(a,o),O(e,u),l||(d=ne(o,"click",p),l=!0)},p(h,g){t=h,g&3&&r!==(r=t[1].Md2HTML(`![User uploaded image](${t[11].image})

${t[11].content}`)+"")&&(n.innerHTML=r),t[11].role==="user"?m?m.p(t,g):(m=Fb(t),m.c(),m.m(a,i)):m&&(m.d(1),m=null),g&1&&c!==(c="message "+(t[11].role==="user"?"user":"ai")+" svelte-1xmj80i")&&T(e,"class",c)},d(h){h&&oe(e),m&&m.d(),l=!1,d()}}}function Mb(t){let e;return{c(){e=M("span"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>',T(e,"class","file-icon svelte-1xmj80i")},m(n,r){ce(n,e,r)},d(n){n&&oe(e)}}}function Bb(t){let e,n,r;function s(){return t[6](t[11])}return{c(){e=M("button"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1xmj80i"><path d="M23 4v6h-6M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>',T(e,"class","action-btn svelte-1xmj80i")},m(a,i){ce(a,e,i),n||(r=ne(e,"click",s),n=!0)},p(a,i){t=a},d(a){a&&oe(e),n=!1,r()}}}function Fb(t){let e,n,r;function s(){return t[4](t[11])}return{c(){e=M("button"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1xmj80i"><path d="M23 4v6h-6M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>',T(e,"class","action-btn svelte-1xmj80i")},m(a,i){ce(a,e,i),n||(r=ne(e,"click",s),n=!0)},p(a,i){t=a},d(a){a&&oe(e),n=!1,r()}}}function Ub(t){let e;function n(a,i){var o,u;return((u=(o=a[11])==null?void 0:o.image)==null?void 0:u.length)>0?iU:aU}let r=n(t),s=r(t);return{c(){s.c(),e=ao()},m(a,i){s.m(a,i),ce(a,e,i)},p(a,i){r===(r=n(a))&&s?s.p(a,i):(s.d(1),s=r(a),s&&(s.c(),s.m(e.parentNode,e)))},d(a){a&&oe(e),s.d(a)}}}function oU(t){let e,n,r=_t(t[0].messages),s=[];for(let a=0;a<r.length;a+=1)s[a]=Ub(Db(t,r,a));return{c(){e=M("div"),n=M("div");for(let a=0;a<s.length;a+=1)s[a].c();T(n,"class","messages-wrapper svelte-1xmj80i"),T(e,"class","message-container svelte-1xmj80i")},m(a,i){ce(a,e,i),O(e,n);for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(n,null)},p(a,[i]){if(i&15){r=_t(a[0].messages);let o;for(o=0;o<r.length;o+=1){const u=Db(a,r,o);s[o]?s[o].p(u,i):(s[o]=Ub(u),s[o].c(),s[o].m(n,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=r.length}},i:Ze,o:Ze,d(a){a&&oe(e),Qr(s,a)}}}function uU(t,e,n){let{currentChat:r}=e,{lute:s}=e;const a=yn();function i(){}function o(p){a("edit",{message:p})}function u(p){a("delete",{message:p})}A_(()=>{var p;if(((p=r==null?void 0:r.messages)==null?void 0:p.length)>0){const h=r.messages[r.messages.length-1];(h==null?void 0:h.role)==="assistant"&&setTimeout(i,50)}}),Rr(i);const c=p=>o(p),l=p=>u(p),d=p=>o(p),m=p=>u(p);return t.$$set=p=>{"currentChat"in p&&n(0,r=p.currentChat),"lute"in p&&n(1,s=p.lute)},t.$$.update=()=>{if(t.$$.dirty&1&&r!=null&&r.messages){const p=r.messages[r.messages.length-1];(p==null?void 0:p.role)!=="user"&&p.content}},[r,s,o,u,c,l,d,m]}class cU extends tt{constructor(e){super(),et(this,e,uU,oU,Qe,{currentChat:0,lute:1})}}function jb(t){let e,n=t[7]?"":"...",r,s,a,i;return{c(){e=M("button"),r=Ke(n),T(e,"type","button"),T(e,"class","generation-text svelte-rsvq7v"),T(e,"aria-label",s=t[7]?"":"...")},m(o,u){ce(o,e,u),O(e,r),a||(i=[ne(e,"mouseenter",t[19]),ne(e,"mouseleave",t[20]),ne(e,"click",t[9]),ne(e,"keydown",t[21])],a=!0)},p(o,u){u&128&&n!==(n=o[7]?"":"...")&&lt(r,n),u&128&&s!==(s=o[7]?"":"...")&&T(e,"aria-label",s)},d(o){o&&oe(e),a=!1,st(i)}}}function lU(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,h,g,b,_,y,E,I,w,R,v,j,F,x,H,te,Z,N,S,P,U=t[6]&&jb(t);function D(K){t[22](K)}let W={type:"select",key:"modelSelections",fnSize:!1,options:t[5].get("modelSelections").options,style:"margin-right: 6px; font-size: 12px; padding: 2px 4px; border-radius: 4px; border: none ;outline: none; height: 2em; background: transparent; align-self: center;margin-left: auto;"};return t[0]!==void 0&&(W.value=t[0]),te=new Xr({props:W}),ue.push(()=>pe(te,"value",D)),te.$on("changed",t[23]),{c(){e=M("div"),n=M("button"),r=pt("svg"),s=pt("path"),a=pt("path"),i=ee(),o=M("button"),u=pt("svg"),c=pt("path"),l=ee(),d=M("button"),m=pt("svg"),p=pt("path"),h=ee(),g=M("button"),b=M("input"),_=ee(),y=M("label"),y.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" class="svelte-rsvq7v"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><path d="M13 2v7h7"></path></svg>',E=ee(),I=M("button"),w=M("input"),R=ee(),v=M("label"),v.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" class="svelte-rsvq7v"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><path d="m21 15-5-5L5 21"></path></svg>',j=ee(),F=M("button"),F.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" class="svelte-rsvq7v"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',x=ee(),U&&U.c(),H=ee(),De(te.$$.fragment),T(s,"d","M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"),T(a,"d","M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c.26.604.852.997 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1Z"),T(r,"viewBox","0 0 24 24"),T(r,"width","16"),T(r,"height","16"),T(r,"stroke","currentColor"),T(r,"stroke-width","2"),T(r,"fill","none"),T(r,"class","svelte-rsvq7v"),T(n,"title",t[8].settings),T(n,"class","svelte-rsvq7v"),T(c,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"),T(u,"viewBox","0 0 24 24"),T(u,"width","16"),T(u,"height","16"),T(u,"stroke","currentColor"),T(u,"stroke-width","2"),T(u,"fill","none"),T(u,"class","svelte-rsvq7v"),T(o,"title",t[8].onlineSearch),T(o,"class","svelte-rsvq7v"),_e(o,"active",t[1]),T(p,"d","M21 5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5zm-2 14H5V5h14v14zM7 15h10v2H7v-2zm0-4h10v2H7v-2zm0-4h10v2H7V7z"),T(m,"viewBox","0 0 24 24"),T(m,"width","16"),T(m,"height","16"),T(m,"stroke","currentColor"),T(m,"stroke-width","2"),T(m,"fill","none"),T(m,"class","svelte-rsvq7v"),T(d,"title",t[8].knowledgeBase),T(d,"class","svelte-rsvq7v"),_e(d,"active",t[2]),T(b,"type","file"),T(b,"accept",".pdf,.docx,.md,.txt"),St(b,"display","none"),T(b,"id","file-upload"),T(y,"for","file-upload"),St(y,"cursor","pointer"),T(g,"title",t[8].file),T(g,"class","svelte-rsvq7v"),_e(g,"active",t[4].length>0),T(w,"type","file"),T(w,"accept","image/*"),St(w,"display","none"),T(w,"id","image-upload"),T(v,"for","image-upload"),St(v,"cursor","pointer"),T(I,"title",t[8].image),T(I,"class","svelte-rsvq7v"),_e(I,"active",t[3].length>0),T(F,"title",""),T(F,"class","svelte-rsvq7v"),T(e,"class","tools-container svelte-rsvq7v")},m(K,G){ce(K,e,G),O(e,n),O(n,r),O(r,s),O(r,a),O(e,i),O(e,o),O(o,u),O(u,c),O(e,l),O(e,d),O(d,m),O(m,p),O(e,h),O(e,g),O(g,b),O(g,_),O(g,y),O(e,E),O(e,I),O(I,w),O(I,R),O(I,v),O(e,j),O(e,F),O(e,x),U&&U.m(e,null),O(e,H),Pe(te,e,null),N=!0,S||(P=[ne(n,"click",t[14]),ne(o,"click",t[12]),ne(d,"click",t[13]),ne(b,"change",t[11]),ne(w,"change",t[15]),ne(F,"click",t[10])],S=!0)},p(K,[G]){(!N||G&2)&&_e(o,"active",K[1]),(!N||G&4)&&_e(d,"active",K[2]),(!N||G&16)&&_e(g,"active",K[4].length>0),(!N||G&8)&&_e(I,"active",K[3].length>0),K[6]?U?U.p(K,G):(U=jb(K),U.c(),U.m(e,H)):U&&(U.d(1),U=null);const se={};G&32&&(se.options=K[5].get("modelSelections").options),!Z&&G&1&&(Z=!0,se.value=K[0],me(()=>Z=!1)),te.$set(se)},i(K){N||(ie(te.$$.fragment,K),N=!0)},o(K){de(te.$$.fragment,K),N=!1},d(K){K&&oe(e),U&&U.d(),xe(te),S=!1,st(P)}}}function dU(t,e,n){let{currentChat:r}=e,{settingStorage:s}=e,{documentVectorStorage:a}=e,{selectedModel:i}=e,{isSearchEnabled:o}=e,{isKnowledgeEnabled:u}=e,{imageUrl:c=""}=e,{fileContent:l=""}=e,{isInterrupted:d=!1}=e,{isGenerating:m=!1}=e,p=s.i18n,h=!1;function g(){n(17,d=!0)}function b(){n(16,r.messages=[r.messages[0]],r)}async function _(H){var te,Z;try{const N=H.target,S=(te=N.files)==null?void 0:te[0];if(!S)return;switch((Z=S.name.split(".").pop())==null?void 0:Z.toLowerCase()){case"txt":case"csv":case"md":const U=new FileReader;U.onload=D=>{var W;(W=D.target)!=null&&W.result&&(n(4,l=D.target.result),console.debug(l))},U.readAsText(S);break;case"pdf":n(4,l=await rc(S,s.getValue("apiKey")));break;default:n(4,l=await rc(S,s.getValue("apiKey")))}N.value=""}catch(N){console.error(p.fileProcessingFailed,N),n(4,l="")}}function y(){n(1,o=!o),s.setValue("isSearchChat",o),s.save()}async function E(){n(2,u=!u),s.setValue("isKnowledgeBaseChat",u),s.save(),u?await a.load():(await a.save(),await a.release())}function I(){const H=new dt.Dialog({title:"",content:'<div id="chat-params-panel" style="height: 100%; margin:0px; padding:0px;"></div>',width:"40%",height:"40%",hideCloseIcon:!0});new Mf({target:H.element.querySelector("#chat-params-panel"),props:{settingStorage:s,group:"chat"}})}async function w(H){var N;const Z=(N=H.target.files)==null?void 0:N[0];if(Z)try{const S=new FileReader;S.onload=P=>{var U;(U=P.target)!=null&&U.result&&n(3,c=P.target.result)},console.debug(c),S.readAsDataURL(Z)}catch(S){console.error(p.imageProcessingFailed,S)}}const R=()=>n(7,h=!0),v=()=>n(7,h=!1),j=H=>H.key==="Enter"&&g();function F(H){i=H,n(0,i)}const x=({detail:H})=>{s.setValue(H.key,H.value),s.save()};return t.$$set=H=>{"currentChat"in H&&n(16,r=H.currentChat),"settingStorage"in H&&n(5,s=H.settingStorage),"documentVectorStorage"in H&&n(18,a=H.documentVectorStorage),"selectedModel"in H&&n(0,i=H.selectedModel),"isSearchEnabled"in H&&n(1,o=H.isSearchEnabled),"isKnowledgeEnabled"in H&&n(2,u=H.isKnowledgeEnabled),"imageUrl"in H&&n(3,c=H.imageUrl),"fileContent"in H&&n(4,l=H.fileContent),"isInterrupted"in H&&n(17,d=H.isInterrupted),"isGenerating"in H&&n(6,m=H.isGenerating)},[i,o,u,c,l,s,m,h,p,g,b,_,y,E,I,w,r,d,a,R,v,j,F,x]}class hU extends tt{constructor(e){super(),et(this,e,dU,lU,Qe,{currentChat:16,settingStorage:5,documentVectorStorage:18,selectedModel:0,isSearchEnabled:1,isKnowledgeEnabled:2,imageUrl:3,fileContent:4,isInterrupted:17,isGenerating:6})}}function fU(t){let e,n,r,s,a,i,o,u,c,l,d,m,p,h,g,b,_;function y(S){t[16](S)}let E={lute:t[2]};t[0]!==void 0&&(E.currentChat=t[0]),n=new cU({props:E}),ue.push(()=>pe(n,"currentChat",y)),n.$on("edit",t[13]),n.$on("delete",t[14]);function I(S){t[17](S)}function w(S){t[18](S)}function R(S){t[19](S)}function v(S){t[20](S)}function j(S){t[21](S)}function F(S){t[22](S)}function x(S){t[23](S)}function H(S){t[24](S)}let te={settingStorage:t[4],isGenerating:t[6]};t[7]!==void 0&&(te.isInterrupted=t[7]),t[8]!==void 0&&(te.selectedModel=t[8]),t[9]!==void 0&&(te.isSearchEnabled=t[9]),t[10]!==void 0&&(te.isKnowledgeEnabled=t[10]),t[11]!==void 0&&(te.imageUrl=t[11]),t[12]!==void 0&&(te.fileContent=t[12]),t[1]!==void 0&&(te.documentVectorStorage=t[1]),t[0]!==void 0&&(te.currentChat=t[0]),a=new hU({props:te}),ue.push(()=>pe(a,"isInterrupted",I)),ue.push(()=>pe(a,"selectedModel",w)),ue.push(()=>pe(a,"isSearchEnabled",R)),ue.push(()=>pe(a,"isKnowledgeEnabled",v)),ue.push(()=>pe(a,"imageUrl",j)),ue.push(()=>pe(a,"fileContent",F)),ue.push(()=>pe(a,"documentVectorStorage",x)),ue.push(()=>pe(a,"currentChat",H));function Z(S){t[25](S)}let N={promptStorage:t[3],isGenerating:t[6]};return t[5]!==void 0&&(N.draftMessage=t[5]),g=new sU({props:N}),ue.push(()=>pe(g,"draftMessage",Z)),g.$on("sendMessage",t[26]),{c(){e=M("div"),De(n.$$.fragment),s=ee(),De(a.$$.fragment),h=ee(),De(g.$$.fragment),T(e,"class","dock-chat svelte-dl4ify")},m(S,P){ce(S,e,P),Pe(n,e,null),O(e,s),Pe(a,e,null),O(e,h),Pe(g,e,null),_=!0},p(S,[P]){const U={};P&4&&(U.lute=S[2]),!r&&P&1&&(r=!0,U.currentChat=S[0],me(()=>r=!1)),n.$set(U);const D={};P&16&&(D.settingStorage=S[4]),P&64&&(D.isGenerating=S[6]),!i&&P&128&&(i=!0,D.isInterrupted=S[7],me(()=>i=!1)),!o&&P&256&&(o=!0,D.selectedModel=S[8],me(()=>o=!1)),!u&&P&512&&(u=!0,D.isSearchEnabled=S[9],me(()=>u=!1)),!c&&P&1024&&(c=!0,D.isKnowledgeEnabled=S[10],me(()=>c=!1)),!l&&P&2048&&(l=!0,D.imageUrl=S[11],me(()=>l=!1)),!d&&P&4096&&(d=!0,D.fileContent=S[12],me(()=>d=!1)),!m&&P&2&&(m=!0,D.documentVectorStorage=S[1],me(()=>m=!1)),!p&&P&1&&(p=!0,D.currentChat=S[0],me(()=>p=!1)),a.$set(D);const W={};P&8&&(W.promptStorage=S[3]),P&64&&(W.isGenerating=S[6]),!b&&P&32&&(b=!0,W.draftMessage=S[5],me(()=>b=!1)),g.$set(W)},i(S){_||(ie(n.$$.fragment,S),ie(a.$$.fragment,S),ie(g.$$.fragment,S),_=!0)},o(S){de(n.$$.fragment,S),de(a.$$.fragment,S),de(g.$$.fragment,S),_=!1},d(S){S&&oe(e),xe(n),xe(a),xe(g)}}}function mU(t,e,n){let{lute:r}=e,{promptStorage:s}=e,{settingStorage:a}=e,{documentVectorStorage:i}=e,{currentChat:o}=e,u=!1,c=!1,l=a.getValue("modelSelections"),d=a.getValue("isSearchChat"),m=a.getValue("isisKnowledgeBaseChat"),p="",h="",g=o.draft;Rr(()=>{n(5,g=o.draft)});function b(S){const{message:P}=S.detail,U=o.messages.findIndex(D=>D.id===P.id);U!==-1&&(n(0,o.messages=o.messages.slice(0,U),o),n(0,o.messages=[...o.messages,{id:Date.now(),role:"user",content:P.content,image:P.image||"",model:l,fileContent:P.fileContent||""}],o),n(0,o.messages=[...o.messages,{id:Date.now(),role:"assistant",content:"",model:l}],o),y())}function _(S){const{message:P}=S.detail,U=o.messages.findIndex(D=>D.id===P.id);U>0&&n(0,o.messages=o.messages.slice(0,U),o)}El(a.i18n);async function y(){Da({apiKey:a.getValue("apiKey"),phone:a.getValue("phone"),model:o.model?o.model:l,maxTokens:a.getValue("maxOutputLengthChat"),temperature:a.getValue("temperatureChat"),timeout:a.getValue("responseTimeoutChat"),isSearch:d,isStream:!0,isClipboard:!0,isKnowledge:m,callback:(S,P)=>{if(c)throw n(6,u=!1),new Error("User interrupted");n(0,o.messages[o.messages.length-1].content=S,o),n(0,o.messages[o.messages.length-1].model=l,o),n(6,u=P)},knowledgeCallback:async S=>{const P=await i.similaritySearchWithScore(S,a.getValue("knowledgeBaseRecallNumChat"));let U=[];for(const D of P)D[1]<.7||U.push(D[0]);return U},messages:o.messages.slice(0,-1)})}async function E(S){if(!(u||!S.trim()))try{p&&n(0,o.model=Math.random()<.7?ra[0]:ra[Math.floor(Math.random()*(ra.length-1))+1],o),n(0,o.messages=[...o.messages,{id:Date.now(),role:"user",content:S,image:p,model:l,fileContent:h}],o),n(0,o.messages=[...o.messages,{id:Date.now(),role:"assistant",content:"",model:l}],o);try{p.length>0&&n(0,o.title="",o),await y(),o.messages.length>3&&o.messages.length<=5&&p.length==0&&Fm([...o.messages,{role:"user",content:a.i18n.summaryPrompt}],a.getValue("apiKey")).then(P=>{n(0,o.title=P,o)})}catch(P){console.error("AI :",P),n(0,o.messages=o.messages.slice(0,-1),o)}}finally{n(6,u=!1),n(7,c=!1),n(11,p=""),n(0,o.draft="",o),n(5,g="")}}function I(S){o=S,n(0,o),n(5,g)}function w(S){c=S,n(7,c)}function R(S){l=S,n(8,l)}function v(S){d=S,n(9,d)}function j(S){m=S,n(10,m)}function F(S){p=S,n(11,p)}function x(S){h=S,n(12,h)}function H(S){i=S,n(1,i)}function te(S){o=S,n(0,o),n(5,g)}function Z(S){g=S,n(5,g)}const N=async({detail:S})=>await E(S);return t.$$set=S=>{"lute"in S&&n(2,r=S.lute),"promptStorage"in S&&n(3,s=S.promptStorage),"settingStorage"in S&&n(4,a=S.settingStorage),"documentVectorStorage"in S&&n(1,i=S.documentVectorStorage),"currentChat"in S&&n(0,o=S.currentChat)},t.$$.update=()=>{t.$$.dirty&33&&g!==o.draft&&n(0,o.draft=g,o)},[o,i,r,s,a,g,u,c,l,d,m,p,h,b,_,E,I,w,R,v,j,F,x,H,te,Z,N]}class pU extends tt{constructor(e){super(),et(this,e,mU,fU,Qe,{lute:2,promptStorage:3,settingStorage:4,documentVectorStorage:1,currentChat:0})}}class gU extends dt.Plugin{constructor(n){super(n);Te(this,"_isMobile");Te(this,"_settingStorage");Te(this,"_promptStorage");Te(this,"_chatHistoryStorage");Te(this,"_imageHistoryStorage");Te(this,"_documentVectorStorage");Te(this,"_blockStorage");Te(this,"_machineId");Te(this,"_apiClient");this._apiClient=new a2,this._settingStorage=new hP(this,Gd),this._promptStorage=new dP(this,Yd),this._chatHistoryStorage=new Iy(this,Kd),this._imageHistoryStorage=new lP(this,I2),this._promptStorage.load(),this._chatHistoryStorage.load(),this._settingStorage.load(),this._imageHistoryStorage.load(),this._isMobile=dt.getFrontend()==="mobile"||dt.getFrontend()==="browser-mobile"}async onload(){console.debug("onload...."),this.addDock({config:{position:"BottomRight",size:{width:0,height:0},icon:"iconUsers",title:"AI",hotkey:"W"},data:{},type:"dock_tab",resize:()=>{const c={id:Date.now(),title:this._chatHistoryStorage.i18n.newChat,time:Bu().format("YYYY/M/D HH:mm:ss"),messages:[{id:Date.now(),role:"system",content:"You are a helpful assistant. You can help me by answering my questions. You can also ask me questions."}]};this._chatHistoryStorage.add(c)},init:c=>{const l={id:Date.now(),title:this._chatHistoryStorage.i18n.newChat,time:Bu().format("YYYY/M/D HH:mm:ss"),messages:[{id:Date.now(),role:"system",content:"You are a helpful assistant. You can help me by answering my questions. You can also ask me questions."}]};this._isMobile||(c.element.innerHTML='<div id="siyuan-ai-chat" style="height: 100%; margin: 0; padding: 0; overflow: hidden; display:flex;min-height: 0;"></div>',new pU({target:c.element.querySelector("#siyuan-ai-chat"),props:{currentChat:l,promptStorage:this._promptStorage,settingStorage:this._settingStorage,documentVectorStorage:this._documentVectorStorage,lute:window.Lute.New()}}))}}),await this._settingStorage.load(),this.addTopBar({icon:"iconSparkles",title:this.i18n.instructionMode,position:"right",callback:()=>Rb(this._settingStorage,this._promptStorage,this._documentVectorStorage)}),this.addTopBar({icon:"iconUsers",title:"",position:"right",callback:()=>Pb(this._settingStorage,this._chatHistoryStorage,this._promptStorage,this._documentVectorStorage)});let n=this._settingStorage.getValue("isVectorOnline"),r=this._settingStorage.getValue("phoneNumber"),s=this._settingStorage.getValue("apiKey"),a=this._settingStorage.getValue("includeKnowledgeBook"),i=this._settingStorage.getValue("excludeKnowledgeBook"),o=this._settingStorage.getValue("isKnowledge");const u=await zi(s);u.money<=0&&ta(this.i18n.balanceInsufficientMsg.replace("${balance}",String(Math.round(u.money*10)/10))),u.expiredTime<Math.floor(Date.now()/1e3)&&ta(this.i18n.apiKeyExpiredMsg),n&&r?this._documentVectorStorage=new vx(this,Zd,s,r):this._documentVectorStorage=new Cx(this,Zd,s,r),this._machineId=await this.getMachineId(),this._blockStorage=new cP(this,k_,s,this._documentVectorStorage,a,i),zi(s).then(c=>{c.money>0&&c.expiredTime>Math.floor(Date.now()/1e3)&&(console.debug("apiKey "),o&&this._blockStorage.load())}),this.addCommand({langKey:"",hotkey:"K",callback:()=>Rb(this._settingStorage,this._promptStorage,this._documentVectorStorage)}),this.addCommand({langKey:"",hotkey:"L",callback:()=>Pb(this._settingStorage,this._chatHistoryStorage,this._promptStorage,this._documentVectorStorage)}),this.addCommand({langKey:"",hotkey:"S",callback:()=>ZF(this._settingStorage,this._promptStorage)}),this.addCommand({langKey:"",hotkey:"I",callback:()=>{JF(this._settingStorage,this._imageHistoryStorage,this._promptStorage)}}),console.debug("onload....end")}onLayoutReady(){}uninstall(){this.removeData(Gd),this.removeData(Yd),this.removeData(Kd),so("AI")}openSetting(){if(!this._settingStorage)return;if(this._isMobile){ta("");return}let n=new dt.Dialog({title:"AI",width:"70%",height:"60%",content:'<div class="b3-dialog__content" id="AISettingPanel" ></div>'});new tU({target:n.element.querySelector("#AISettingPanel"),props:{settingStorage:this._settingStorage,dialog:n}})}getMachineId(){try{const n=window.navigator,r=window.screen,a=[n.userAgent,r.colorDepth,r.width,r.height,r.availWidth,r.availHeight,Intl.DateTimeFormat().resolvedOptions().timeZone].join("###");return btoa(a).replace(/[^a-zA-Z0-9]/g,"")}catch(n){return console.error(":",n),""}}}module.exports=gU;
