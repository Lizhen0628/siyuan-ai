"use strict";var Ul=Object.defineProperty;var jl=(n,e,t)=>e in n?Ul(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var be=(n,e,t)=>jl(n,typeof e!="symbol"?e+"":e,t);const yt=require("siyuan");async function rn(n,e){let t=await yt.fetchSyncPost(n,e);return t.code===0?t.data:null}async function ql(n,e,t,r,s){return rn("/api/block/insertBlock",{dataType:n,data:e,nextID:t,previousID:r,parentID:s})}async function Hl(n,e,t){return rn("/api/block/appendBlock",{dataType:n,data:e,parentID:t})}async function ui(n){return rn("/api/block/deleteBlock",{id:n})}async function Ea(n,e=7e3){return rn("/api/notification/pushMsg",{msg:n,timeout:e})}async function Wl(n,e=7e3){return rn("/api/notification/pushErrMsg",{msg:n,timeout:e})}function ie(){}const Aa=n=>n;function Bn(n,e){for(const t in e)n[t]=e[t];return n}function Pa(n){return n()}function fi(){return Object.create(null)}function ce(n){n.forEach(Pa)}function bt(n){return typeof n=="function"}function fe(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let mn;function Vl(n,e){return n===e?!0:(mn||(mn=document.createElement("a")),mn.href=e,n===mn.href)}function Jl(n){return Object.keys(n).length===0}function _s(n,e,t,r){if(n){const s=Ra(n,e,t,r);return n[0](s)}}function Ra(n,e,t,r){return n[1]&&r?Bn(t.ctx.slice(),n[1](r(e))):t.ctx}function ys(n,e,t,r){if(n[2]&&r){const s=n[2](r(t));if(e.dirty===void 0)return s;if(typeof s=="object"){const i=[],a=Math.max(e.dirty.length,s.length);for(let o=0;o<a;o+=1)i[o]=e.dirty[o]|s[o];return i}return e.dirty|s}return e.dirty}function ws(n,e,t,r,s,i){if(s){const a=Ra(e,t,r,i);n.p(a,s)}}function bs(n){if(n.ctx.length>32){const e=[],t=n.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function di(n){const e={};for(const t in n)t[0]!=="$"&&(e[t]=n[t]);return e}const Xl=["",!0,1,"true","contenteditable"],ka=typeof window<"u";let zl=ka?()=>window.performance.now():()=>Date.now(),Ss=ka?n=>requestAnimationFrame(n):ie;const St=new Set;function Ca(n){St.forEach(e=>{e.c(n)||(St.delete(e),e.f())}),St.size!==0&&Ss(Ca)}function Kl(n){let e;return St.size===0&&Ss(Ca),{promise:new Promise(t=>{St.add(e={c:n,f:t})}),abort(){St.delete(e)}}}function y(n,e){n.appendChild(e)}function xa(n){if(!n)return document;const e=n.getRootNode?n.getRootNode():n.ownerDocument;return e&&e.host?e:n.ownerDocument}function Gl(n){const e=R("style");return e.textContent="/* empty */",Ql(xa(n),e),e.sheet}function Ql(n,e){return y(n.head||n,e),e.sheet}function H(n,e,t){n.insertBefore(e,t||null)}function j(n){n.parentNode&&n.parentNode.removeChild(n)}function va(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function R(n){return document.createElement(n)}function ue(n){return document.createTextNode(n)}function T(){return ue(" ")}function Es(){return ue("")}function V(n,e,t,r){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}function A(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}const Yl=["width","height"];function hi(n,e){const t=Object.getOwnPropertyDescriptors(n.__proto__);for(const r in e)e[r]==null?n.removeAttribute(r):r==="style"?n.style.cssText=e[r]:r==="__value"?n.value=n[r]=e[r]:t[r]&&t[r].set&&Yl.indexOf(r)===-1?n[r]=e[r]:A(n,r,e[r])}function Wr(n){return n===""?null:+n}function Zl(n){return Array.from(n.childNodes)}function De(n,e){e=""+e,n.data!==e&&(n.data=e)}function ec(n,e){e=""+e,n.wholeText!==e&&(n.data=e)}function tc(n,e,t){~Xl.indexOf(t)?ec(n,e):De(n,e)}function Ce(n,e){n.value=e??""}function v(n,e,t,r){t==null?n.style.removeProperty(e):n.style.setProperty(e,t,"")}function mi(n,e,t){for(let r=0;r<n.options.length;r+=1){const s=n.options[r];if(s.__value===e){s.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function nc(n){const e=n.querySelector(":checked");return e&&e.__value}function K(n,e,t){n.classList.toggle(e,!!t)}function Oa(n,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:r})}const Ln=new Map;let Dn=0;function rc(n){let e=5381,t=n.length;for(;t--;)e=(e<<5)-e^n.charCodeAt(t);return e>>>0}function sc(n,e){const t={stylesheet:Gl(e),rules:{}};return Ln.set(n,t),t}function pi(n,e,t,r,s,i,a,o=0){const l=16.666/r;let c=`{
`;for(let g=0;g<=1;g+=l){const P=e+(t-e)*i(g);c+=g*100+`%{${a(P,1-P)}}
`}const f=c+`100% {${a(t,1-t)}}
}`,u=`__svelte_${rc(f)}_${o}`,h=xa(n),{stylesheet:m,rules:d}=Ln.get(h)||sc(h,n);d[u]||(d[u]=!0,m.insertRule(`@keyframes ${u} ${f}`,m.cssRules.length));const _=n.style.animation||"";return n.style.animation=`${_?`${_}, `:""}${u} ${r}ms linear ${s}ms 1 both`,Dn+=1,u}function ic(n,e){const t=(n.style.animation||"").split(", "),r=t.filter(e?i=>i.indexOf(e)<0:i=>i.indexOf("__svelte")===-1),s=t.length-r.length;s&&(n.style.animation=r.join(", "),Dn-=s,Dn||ac())}function ac(){Ss(()=>{Dn||(Ln.forEach(n=>{const{ownerNode:e}=n.stylesheet;e&&j(e)}),Ln.clear())})}let Yt;function zt(n){Yt=n}function Ta(){if(!Yt)throw new Error("Function called outside component initialization");return Yt}function Ma(n){Ta().$$.on_mount.push(n)}function Yn(){const n=Ta();return(e,t,{cancelable:r=!1}={})=>{const s=n.$$.callbacks[e];if(s){const i=Oa(e,t,{cancelable:r});return s.slice().forEach(a=>{a.call(n,i)}),!i.defaultPrevented}return!0}}function oc(n,e){const t=n.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}const ht=[],se=[];let Et=[];const Vr=[],lc=Promise.resolve();let Jr=!1;function cc(){Jr||(Jr=!0,lc.then(Ia))}function at(n){Et.push(n)}function Ae(n){Vr.push(n)}const br=new Set;let ct=0;function Ia(){if(ct!==0)return;const n=Yt;do{try{for(;ct<ht.length;){const e=ht[ct];ct++,zt(e),uc(e.$$)}}catch(e){throw ht.length=0,ct=0,e}for(zt(null),ht.length=0,ct=0;se.length;)se.pop()();for(let e=0;e<Et.length;e+=1){const t=Et[e];br.has(t)||(br.add(t),t())}Et.length=0}while(ht.length);for(;Vr.length;)Vr.pop()();Jr=!1,br.clear(),zt(n)}function uc(n){if(n.fragment!==null){n.update(),ce(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(at)}}function fc(n){const e=[],t=[];Et.forEach(r=>n.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),Et=e}let Ft;function dc(){return Ft||(Ft=Promise.resolve(),Ft.then(()=>{Ft=null})),Ft}function Sr(n,e,t){n.dispatchEvent(Oa(`${e?"intro":"outro"}${t}`))}const kn=new Set;let qe;function rt(){qe={r:0,c:[],p:qe}}function st(){qe.r||ce(qe.c),qe=qe.p}function F(n,e){n&&n.i&&(kn.delete(n),n.i(e))}function L(n,e,t,r){if(n&&n.o){if(kn.has(n))return;kn.add(n),qe.c.push(()=>{kn.delete(n),r&&(t&&n.d(1),r())}),n.o(e)}else r&&r()}const hc={duration:0};function $n(n,e,t,r){let i=e(n,t,{direction:"both"}),a=r?0:1,o=null,l=null,c=null,f;function u(){c&&ic(n,c)}function h(d,_){const g=d.b-a;return _*=Math.abs(g),{a,b:d.b,d:g,duration:_,start:d.start,end:d.start+_,group:d.group}}function m(d){const{delay:_=0,duration:g=300,easing:P=Aa,tick:p=ie,css:E}=i||hc,b={start:zl()+_,b:d};d||(b.group=qe,qe.r+=1),"inert"in n&&(d?f!==void 0&&(n.inert=f):(f=n.inert,n.inert=!0)),o||l?l=b:(E&&(u(),c=pi(n,a,d,g,_,P,E)),d&&p(0,1),o=h(b,g),at(()=>Sr(n,d,"start")),Kl(S=>{if(l&&S>l.start&&(o=h(l,g),l=null,Sr(n,o.b,"start"),E&&(u(),c=pi(n,a,o.b,o.duration,0,P,i.css))),o){if(S>=o.end)p(a=o.b,1-a),Sr(n,o.b,"end"),l||(o.b?u():--o.group.r||ce(o.group.c)),o=null;else if(S>=o.start){const C=S-o.start;a=o.a+o.d*P(C/o.duration),p(a,1-a)}}return!!(o||l)}))}return{run(d){bt(i)?dc().then(()=>{i=i({direction:d?"in":"out"}),m(d)}):m(d)},end(){u(),o=l=null}}}function Xe(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function mc(n,e){n.d(1),e.delete(n.key)}function pc(n,e){L(n,1,1,()=>{e.delete(n.key)})}function Na(n,e,t,r,s,i,a,o,l,c,f,u){let h=n.length,m=i.length,d=h;const _={};for(;d--;)_[n[d].key]=d;const g=[],P=new Map,p=new Map,E=[];for(d=m;d--;){const k=u(s,i,d),O=t(k);let I=a.get(O);I?E.push(()=>I.p(k,e)):(I=c(O,k),I.c()),P.set(O,g[d]=I),O in _&&p.set(O,Math.abs(d-_[O]))}const b=new Set,S=new Set;function C(k){F(k,1),k.m(o,f),a.set(k.key,k),f=k.first,m--}for(;h&&m;){const k=g[m-1],O=n[h-1],I=k.key,N=O.key;k===O?(f=k.first,h--,m--):P.has(N)?!a.has(I)||b.has(I)?C(k):S.has(N)?h--:p.get(I)>p.get(N)?(S.add(I),C(k)):(b.add(N),h--):(l(O,a),h--)}for(;h--;){const k=n[h];P.has(k.key)||l(k,a)}for(;m;)C(g[m-1]);return ce(E),g}function gc(n,e){const t={},r={},s={$$scope:1};let i=n.length;for(;i--;){const a=n[i],o=e[i];if(o){for(const l in a)l in o||(r[l]=1);for(const l in o)s[l]||(t[l]=o[l],s[l]=1);n[i]=o}else for(const l in a)s[l]=1}for(const a in r)a in t||(t[a]=void 0);return t}function Pe(n,e,t){const r=n.$$.props[e];r!==void 0&&(n.$$.bound[r]=t,t(n.$$.ctx[r]))}function Y(n){n&&n.c()}function G(n,e,t){const{fragment:r,after_update:s}=n.$$;r&&r.m(e,t),at(()=>{const i=n.$$.on_mount.map(Pa).filter(bt);n.$$.on_destroy?n.$$.on_destroy.push(...i):ce(i),n.$$.on_mount=[]}),s.forEach(at)}function Q(n,e){const t=n.$$;t.fragment!==null&&(fc(t.after_update),ce(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function _c(n,e){n.$$.dirty[0]===-1&&(ht.push(n),cc(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function de(n,e,t,r,s,i,a=null,o=[-1]){const l=Yt;zt(n);const c=n.$$={fragment:null,ctx:[],props:i,update:ie,not_equal:s,bound:fi(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:fi(),dirty:o,skip_bound:!1,root:e.target||l.$$.root};a&&a(c.root);let f=!1;if(c.ctx=t?t(n,e.props||{},(u,h,...m)=>{const d=m.length?m[0]:h;return c.ctx&&s(c.ctx[u],c.ctx[u]=d)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](d),f&&_c(n,u)),h}):[],c.update(),f=!0,ce(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const u=Zl(e.target);c.fragment&&c.fragment.l(u),u.forEach(j)}else c.fragment&&c.fragment.c();e.intro&&F(n.$$.fragment),G(n,e.target,e.anchor),Ia()}zt(l)}class he{constructor(){be(this,"$$");be(this,"$$set")}$destroy(){Q(this,1),this.$destroy=ie}$on(e,t){if(!bt(t))return ie;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!Jl(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const yc="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(yc);const Xr="RFC3986",zr={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},wc="RFC1738",bc=Array.isArray,Ne=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),Er=1024,Sc=(n,e,t,r,s)=>{if(n.length===0)return n;let i=n;if(typeof n=="symbol"?i=Symbol.prototype.toString.call(n):typeof n!="string"&&(i=String(n)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=Er){const l=i.length>=Er?i.slice(o,o+Er):i,c=[];for(let f=0;f<l.length;++f){let u=l.charCodeAt(f);if(u===45||u===46||u===95||u===126||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||s===wc&&(u===40||u===41)){c[c.length]=l.charAt(f);continue}if(u<128){c[c.length]=Ne[u];continue}if(u<2048){c[c.length]=Ne[192|u>>6]+Ne[128|u&63];continue}if(u<55296||u>=57344){c[c.length]=Ne[224|u>>12]+Ne[128|u>>6&63]+Ne[128|u&63];continue}f+=1,u=65536+((u&1023)<<10|l.charCodeAt(f)&1023),c[c.length]=Ne[240|u>>18]+Ne[128|u>>12&63]+Ne[128|u>>6&63]+Ne[128|u&63]}a+=c.join("")}return a};function Ec(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function gi(n,e){if(bc(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const Ac=Object.prototype.hasOwnProperty,Fa={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},Be=Array.isArray,Pc=Array.prototype.push,Ba=function(n,e){Pc.apply(n,Be(e)?e:[e])},Rc=Date.prototype.toISOString,te={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Sc,encodeValuesOnly:!1,format:Xr,formatter:zr[Xr],indices:!1,serializeDate(n){return Rc.call(n)},skipNulls:!1,strictNullHandling:!1};function kc(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const Ar={};function La(n,e,t,r,s,i,a,o,l,c,f,u,h,m,d,_,g,P){let p=n,E=P,b=0,S=!1;for(;(E=E.get(Ar))!==void 0&&!S;){const N=E.get(n);if(b+=1,typeof N<"u"){if(N===b)throw new RangeError("Cyclic object value");S=!0}typeof E.get(Ar)>"u"&&(b=0)}if(typeof c=="function"?p=c(e,p):p instanceof Date?p=h==null?void 0:h(p):t==="comma"&&Be(p)&&(p=gi(p,function(N){return N instanceof Date?h==null?void 0:h(N):N})),p===null){if(i)return l&&!_?l(e,te.encoder,g,"key",m):e;p=""}if(kc(p)||Ec(p)){if(l){const N=_?e:l(e,te.encoder,g,"key",m);return[(d==null?void 0:d(N))+"="+(d==null?void 0:d(l(p,te.encoder,g,"value",m)))]}return[(d==null?void 0:d(e))+"="+(d==null?void 0:d(String(p)))]}const C=[];if(typeof p>"u")return C;let k;if(t==="comma"&&Be(p))_&&l&&(p=gi(p,l)),k=[{value:p.length>0?p.join(",")||null:void 0}];else if(Be(c))k=c;else{const N=Object.keys(p);k=f?N.sort(f):N}const O=o?String(e).replace(/\./g,"%2E"):String(e),I=r&&Be(p)&&p.length===1?O+"[]":O;if(s&&Be(p)&&p.length===0)return I+"[]";for(let N=0;N<k.length;++N){const x=k[N],we=typeof x=="object"&&typeof x.value<"u"?x.value:p[x];if(a&&we===null)continue;const He=u&&o?x.replace(/\./g,"%2E"):x,lt=Be(p)?typeof t=="function"?t(I,He):I:I+(u?"."+He:"["+He+"]");P.set(n,b);const It=new WeakMap;It.set(Ar,P),Ba(C,La(we,lt,t,r,s,i,a,o,t==="comma"&&_&&Be(p)?null:l,c,f,u,h,m,d,_,g,It))}return C}function Cc(n=te){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||te.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Xr;if(typeof n.format<"u"){if(!Ac.call(zr,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=zr[t];let s=te.filter;(typeof n.filter=="function"||Be(n.filter))&&(s=n.filter);let i;if(n.arrayFormat&&n.arrayFormat in Fa?i=n.arrayFormat:"indices"in n?i=n.indices?"indices":"repeat":i=te.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:te.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:te.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:te.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:te.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?te.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:te.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:te.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:te.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:te.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:te.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:te.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:te.strictNullHandling}}function xc(n,e={}){let t=n;const r=Cc(e);let s,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):Be(r.filter)&&(i=r.filter,s=i);const a=[];if(typeof t!="object"||t===null)return"";const o=Fa[r.arrayFormat],l=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);const c=new WeakMap;for(let h=0;h<s.length;++h){const m=s[h];r.skipNulls&&t[m]===null||Ba(a,La(t[m],m,o,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}const f=a.join(r.delimiter);let u=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),f.length>0?u+f:""}const mt="4.78.1";let _i=!1,Kt,Da,$a,Kr,Ua,ja,qa,Ha,Wa;function vc(n,e={auto:!1}){if(_i)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(Kt)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${Kt}'\``);_i=e.auto,Kt=n.kind,Da=n.fetch,$a=n.FormData,Kr=n.File,Ua=n.ReadableStream,ja=n.getMultipartRequestOptions,qa=n.getDefaultAgent,Ha=n.fileFromPath,Wa=n.isFsReadStream}let Oc=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Tc({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new Oc(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}Kt||vc(Tc(),{auto:!0});class $ extends Error{}let _e=class Gr extends ${constructor(e,t,r,s){super(`${Gr.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new Zn({message:r,cause:Zr(t)});const i=t==null?void 0:t.error;return e===400?new Va(e,i,r,s):e===401?new Ja(e,i,r,s):e===403?new Xa(e,i,r,s):e===404?new za(e,i,r,s):e===409?new Ka(e,i,r,s):e===422?new Ga(e,i,r,s):e===429?new Qa(e,i,r,s):e>=500?new Ya(e,i,r,s):new Gr(e,i,r,s)}},Oe=class extends _e{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Zn=class extends _e{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},As=class extends Zn{constructor({message:e}={}){super({message:e??"Request timed out."})}},Va=class extends _e{},Ja=class extends _e{},Xa=class extends _e{},za=class extends _e{},Ka=class extends _e{},Ga=class extends _e{},Qa=class extends _e{},Ya=class extends _e{};class Za extends ${constructor(){super("Could not parse response content as the length limit was reached")}}class eo extends ${constructor(){super("Could not parse response content as the request was rejected by the content filter")}}let er=class Qr{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=Qr.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(Qr.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new $(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new $(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new $("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};er.NEWLINE_CHARS=new Set([`
`,"\r"]);er.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let Zt=class jt{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of Mc(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null){let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(o&&o.error)throw new _e(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(a.event=="error")throw new _e(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new jt(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new er,o=to(e);for await(const l of o)for(const c of a.decode(l))yield c;for(const l of a.flush())yield l}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new jt(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new jt(()=>s(e),this.controller),new jt(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new Ua({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}};async function*Mc(n,e){if(!n.body)throw e.abort(),new $("Attempted to iterate over a response with no body");const t=new Fc,r=new er,s=to(n.body);for await(const i of Ic(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*Ic(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=Nc(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function Nc(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}let Fc=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=Bc(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function Bc(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function to(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const no=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",ro=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&tr(n),tr=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Lc=n=>ro(n)||no(n)||Wa(n);async function so(n,e,t){var s;if(n=await n,ro(n))return n;if(no(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=tr(i)?[await i.arrayBuffer()]:[i];return new Kr(a,e,t)}const r=await Dc(n);if(e||(e=Uc(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new Kr(r,e,t)}async function Dc(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(tr(n))e.push(await n.arrayBuffer());else if(jc(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${$c(n)}`);return e}function $c(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Uc(n){var e;return Pr(n.name)||Pr(n.filename)||((e=Pr(n.path))==null?void 0:e.split(/[\\/]/).pop())}const Pr=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},jc=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",yi=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",Ct=async n=>{const e=await qc(n.body);return ja(e,n)},qc=async n=>{const e=new $a;return await Promise.all(Object.entries(n||{}).map(([t,r])=>Yr(e,t,r))),e},Yr=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(Lc(t)){const r=await so(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>Yr(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>Yr(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Hc=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Wc=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},pn;async function io(n){const{response:e}=n;if(n.options.stream)return At("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Zt.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return At("response",e.status,e.url,e.headers,i),ao(i,e)}const s=await e.text();return At("response",e.status,e.url,e.headers,s),s}function ao(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}let oo=class lo extends Promise{constructor(e,t=io){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new lo(this.responsePromise,async t=>ao(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Vc=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Rr("maxRetries",t),this.timeout=Rr("timeout",r),this.httpAgent=s,this.fetch=i??Da}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Qc(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${tu()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&tr(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var _;const{method:r,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:yi(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),c=this.buildURL(s,i);"timeout"in e&&Rr("timeout",e.timeout);const f=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??qa(c),h=f+1e3;typeof((_=u==null?void 0:u.options)==null?void 0:_.timeout)=="number"&&h>(u.options.timeout??0)&&(u.options.timeout=h),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const m=this.buildHeaders({options:e,headers:a,contentLength:l,retryCount:t});return{req:{method:r,...o&&{body:o},headers:m,...u&&{agent:u},signal:e.signal??null},url:c,timeout:f}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const a=this.defaultHeaders(e);return Ei(i,a),Ei(i,t),yi(e.body)&&Kt!=="node"&&delete i["content-type"],Ai(a,"x-stainless-retry-count")===void 0&&Ai(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return _e.generate(e,t,r,s)}request(e,t=null){return new oo(this.makeRequest(e,t))}async makeRequest(e,t){var u,h;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),At("request",a,r,i.headers),(u=r.signal)!=null&&u.aborted)throw new Oe;const l=new AbortController,c=await this.fetchWithTimeout(a,i,o,l).catch(Zr);if(c instanceof Error){if((h=r.signal)!=null&&h.aborted)throw new Oe;if(t)return this.retryRequest(r,t);throw c.name==="AbortError"?new As:new Zn({cause:c})}const f=Xc(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const p=`retrying, ${t} attempts remaining`;return At(`response (error; ${p})`,c.status,a,f),this.retryRequest(r,t,f)}const m=await c.text().catch(p=>Zr(p).message),d=Yc(m),_=d?void 0:m;throw At(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,f,_),this.makeStatusError(c.status,d,_,f)}return{response:c,options:r,controller:l}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new Jc(this,r,e)}buildURL(e,t){const r=eu(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return uo(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new $(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r),l={signal:s.signal,...a};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await sn(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${mt}`}},co=class{constructor(e,t,r,s){pn.set(this,void 0),Hc(this,pn,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new $("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await Wc(this,pn,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(pn=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},Jc=class extends oo{constructor(e,t,r){super(t,async s=>new r(e,s.response,await io(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}};const Xc=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),zc={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ye=n=>typeof n=="object"&&n!==null&&!uo(n)&&Object.keys(n).every(e=>fo(zc,e)),Kc=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":mt,"X-Stainless-OS":bi(Deno.build.os),"X-Stainless-Arch":wi(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":mt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":mt,"X-Stainless-OS":bi(process.platform),"X-Stainless-Arch":wi(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=Gc();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":mt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":mt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Gc(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const wi=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",bi=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Si;const Qc=()=>Si??(Si=Kc()),Yc=n=>{try{return JSON.parse(n)}catch{return}},Zc=/^[a-z][a-z0-9+.-]*:/i,eu=n=>Zc.test(n),sn=n=>new Promise(e=>setTimeout(e,n)),Rr=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new $(`${n} must be an integer`);if(e<0)throw new $(`${n} must be a positive integer`);return e},Zr=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)},gn=n=>{var e,t,r,s,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,n))==null?void 0:i.trim()};function uo(n){if(!n)return!0;for(const e in n)return!1;return!0}function fo(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ei(n,e){for(const t in e){if(!fo(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function At(n,...e){var t;typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const tu=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),nu=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",ru=n=>typeof(n==null?void 0:n.get)=="function",Ai=(n,e)=>{var r;const t=e.toLowerCase();if(ru(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=n.get(i);if(a)return a}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};function kr(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}let su=class extends co{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}};class Me extends co{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}}let q=class{constructor(e){this._client=e}},ho=class extends q{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},Ps=class extends q{constructor(){super(...arguments),this.completions=new ho(this._client)}};Ps.Completions=ho;class mo extends q{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class po extends q{create(e,t){return this._client.post("/audio/transcriptions",Ct({body:e,...t}))}}class go extends q{create(e,t){return this._client.post("/audio/translations",Ct({body:e,...t}))}}class an extends q{constructor(){super(...arguments),this.transcriptions=new po(this._client),this.translations=new go(this._client),this.speech=new mo(this._client)}}an.Transcriptions=po;an.Translations=go;an.Speech=mo;let Rs=class extends q{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return ye(e)?this.list({},e):this._client.getAPIList("/batches",ks,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}};class ks extends Me{}Rs.BatchesPage=ks;class Cs extends q{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return ye(e)?this.list({},e):this._client.getAPIList("/assistants",xs,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class xs extends Me{}Cs.AssistantsPage=xs;function Pi(n){return typeof n.parse=="function"}const Pt=n=>(n==null?void 0:n.role)==="assistant",_o=n=>(n==null?void 0:n.role)==="function",yo=n=>(n==null?void 0:n.role)==="tool";var xe=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},z=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},es,Cn,xn,qt,Ht,vn,Wt,je,Vt,Un,jn,pt,wo;class bo{constructor(){es.add(this),this.controller=new AbortController,Cn.set(this,void 0),xn.set(this,()=>{}),qt.set(this,()=>{}),Ht.set(this,void 0),vn.set(this,()=>{}),Wt.set(this,()=>{}),je.set(this,{}),Vt.set(this,!1),Un.set(this,!1),jn.set(this,!1),pt.set(this,!1),xe(this,Cn,new Promise((e,t)=>{xe(this,xn,e,"f"),xe(this,qt,t,"f")}),"f"),xe(this,Ht,new Promise((e,t)=>{xe(this,vn,e,"f"),xe(this,Wt,t,"f")}),"f"),z(this,Cn,"f").catch(()=>{}),z(this,Ht,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},z(this,es,"m",wo).bind(this))},0)}_connected(){this.ended||(z(this,xn,"f").call(this),this._emit("connect"))}get ended(){return z(this,Vt,"f")}get errored(){return z(this,Un,"f")}get aborted(){return z(this,jn,"f")}abort(){this.controller.abort()}on(e,t){return(z(this,je,"f")[e]||(z(this,je,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=z(this,je,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(z(this,je,"f")[e]||(z(this,je,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{xe(this,pt,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){xe(this,pt,!0,"f"),await z(this,Ht,"f")}_emit(e,...t){if(z(this,Vt,"f"))return;e==="end"&&(xe(this,Vt,!0,"f"),z(this,vn,"f").call(this));const r=z(this,je,"f")[e];if(r&&(z(this,je,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!z(this,pt,"f")&&!(r!=null&&r.length)&&Promise.reject(s),z(this,qt,"f").call(this,s),z(this,Wt,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!z(this,pt,"f")&&!(r!=null&&r.length)&&Promise.reject(s),z(this,qt,"f").call(this,s),z(this,Wt,"f").call(this,s),this._emit("end")}}_emitFinal(){}}Cn=new WeakMap,xn=new WeakMap,qt=new WeakMap,Ht=new WeakMap,vn=new WeakMap,Wt=new WeakMap,je=new WeakMap,Vt=new WeakMap,Un=new WeakMap,jn=new WeakMap,pt=new WeakMap,es=new WeakSet,wo=function(e){if(xe(this,Un,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Oe),e instanceof Oe)return xe(this,jn,!0,"f"),this._emit("abort",e);if(e instanceof $)return this._emit("error",e);if(e instanceof Error){const t=new $(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new $(String(e)))};function So(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function on(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function iu(n,e){return!e||!Eo(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:vs(n,e)}function vs(n,e){const t=n.choices.map(r=>{var s;if(r.finish_reason==="length")throw new Za;if(r.finish_reason==="content_filter")throw new eo;return{...r,message:{...r.message,tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(i=>ou(e,i)))??[],parsed:r.message.content&&!r.message.refusal?au(e,r.message.content):null}}});return{...n,choices:t}}function au(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function ou(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:on(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function lu(n,e){var r;if(!n)return!1;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return on(t)||(t==null?void 0:t.function.strict)||!1}function Eo(n){var e;return So(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>on(t)||t.type==="function"&&t.function.strict===!0))??!1}function cu(n){for(const e of n??[]){if(e.type!=="function")throw new $(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new $(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var pe=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ae,ts,qn,ns,rs,ss,Ao,is;const Ri=10;class Po extends bo{constructor(){super(...arguments),ae.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(_o(e)||yo(e))&&e.content)this._emit("functionCallResult",e.content);else if(Pt(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Pt(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new $("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),pe(this,ae,"m",ts).call(this)}async finalMessage(){return await this.done(),pe(this,ae,"m",qn).call(this)}async finalFunctionCall(){return await this.done(),pe(this,ae,"m",ns).call(this)}async finalFunctionCallResult(){return await this.done(),pe(this,ae,"m",rs).call(this)}async totalUsage(){return await this.done(),pe(this,ae,"m",ss).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=pe(this,ae,"m",qn).call(this);t&&this._emit("finalMessage",t);const r=pe(this,ae,"m",ts).call(this);r&&this._emit("finalContent",r);const s=pe(this,ae,"m",ns).call(this);s&&this._emit("finalFunctionCall",s);const i=pe(this,ae,"m",rs).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",pe(this,ae,"m",ss).call(this))}async _createChatCompletion(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),pe(this,ae,"m",Ao).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(vs(i,t))}async _runChatCompletion(e,t,r){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var h;const s="function",{function_call:i="auto",stream:a,...o}=t,l=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:c=Ri}=r||{},f={};for(const m of t.functions)f[m.name||m.function.name]=m;const u=t.functions.map(m=>({name:m.name||m.function.name,parameters:m.parameters,description:m.description}));for(const m of t.messages)this._addMessage(m,!1);for(let m=0;m<c;++m){const _=(h=(await this._createChatCompletion(e,{...o,function_call:i,functions:u,messages:[...this.messages]},r)).choices[0])==null?void 0:h.message;if(!_)throw new $("missing message in ChatCompletion response");if(!_.function_call)return;const{name:g,arguments:P}=_.function_call,p=f[g];if(p){if(l&&l!==g){const C=`Invalid function_call: ${JSON.stringify(g)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:g,content:C});continue}}else{const C=`Invalid function_call: ${JSON.stringify(g)}. Available options are: ${u.map(k=>JSON.stringify(k.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:g,content:C});continue}let E;try{E=Pi(p)?await p.parse(P):P}catch(C){this._addMessage({role:s,name:g,content:C instanceof Error?C.message:String(C)});continue}const b=await p.function(E,this),S=pe(this,ae,"m",is).call(this,b);if(this._addMessage({role:s,name:g,content:S}),l)return}}async _runTools(e,t,r){var m,d,_;const s="tool",{tool_choice:i="auto",stream:a,...o}=t,l=typeof i!="string"&&((m=i==null?void 0:i.function)==null?void 0:m.name),{maxChatCompletions:c=Ri}=r||{},f=t.tools.map(g=>{if(on(g)){if(!g.$callback)throw new $("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:g.$callback,name:g.function.name,description:g.function.description||"",parameters:g.function.parameters,parse:g.$parseRaw,strict:!0}}}return g}),u={};for(const g of f)g.type==="function"&&(u[g.function.name||g.function.function.name]=g.function);const h="tools"in t?f.map(g=>g.type==="function"?{type:"function",function:{name:g.function.name||g.function.function.name,parameters:g.function.parameters,description:g.function.description,strict:g.function.strict}}:g):void 0;for(const g of t.messages)this._addMessage(g,!1);for(let g=0;g<c;++g){const p=(d=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:h,messages:[...this.messages]},r)).choices[0])==null?void 0:d.message;if(!p)throw new $("missing message in ChatCompletion response");if(!((_=p.tool_calls)!=null&&_.length))return;for(const E of p.tool_calls){if(E.type!=="function")continue;const b=E.id,{name:S,arguments:C}=E.function,k=u[S];if(k){if(l&&l!==S){const x=`Invalid tool_call: ${JSON.stringify(S)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:b,content:x});continue}}else{const x=`Invalid tool_call: ${JSON.stringify(S)}. Available options are: ${Object.keys(u).map(we=>JSON.stringify(we)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:b,content:x});continue}let O;try{O=Pi(k)?await k.parse(C):C}catch(x){const we=x instanceof Error?x.message:String(x);this._addMessage({role:s,tool_call_id:b,content:we});continue}const I=await k.function(O,this),N=pe(this,ae,"m",is).call(this,I);if(this._addMessage({role:s,tool_call_id:b,content:N}),l)return}}}}ae=new WeakSet,ts=function(){return pe(this,ae,"m",qn).call(this).content??null},qn=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Pt(t)){const{function_call:r,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return r&&(i.function_call=r),i}}throw new $("stream ended without producing a ChatCompletionMessage with role=assistant")},ns=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(Pt(s)&&(s!=null&&s.function_call))return s.function_call;if(Pt(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},rs=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(_o(t)&&t.content!=null||yo(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},ss=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Ao=function(e){if(e.n!=null&&e.n>1)throw new $("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},is=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class en extends Po{static runFunctions(e,t,r){const s=new en,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new en,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),Pt(e)&&e.content&&this._emit("content",e.content)}}const Ro=1,ko=2,Co=4,xo=8,vo=16,Oo=32,To=64,Mo=128,Io=256,No=Mo|Io,Fo=vo|Oo|No|To,Bo=Ro|ko|Fo,Lo=Co|xo,uu=Bo|Lo,ne={STR:Ro,NUM:ko,ARR:Co,OBJ:xo,NULL:vo,BOOL:Oo,NAN:To,INFINITY:Mo,MINUS_INFINITY:Io,INF:No,SPECIAL:Fo,ATOM:Bo,COLLECTION:Lo,ALL:uu};class fu extends Error{}class du extends Error{}function hu(n,e=ne.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return mu(n.trim(),e)}const mu=(n,e)=>{const t=n.length;let r=0;const s=h=>{throw new fu(`${h} at position ${r}`)},i=h=>{throw new du(`${h} at position ${r}`)},a=()=>(u(),r>=t&&s("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?l():n[r]==="["?c():n.substring(r,r+4)==="null"||ne.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||ne.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||ne.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||ne.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||ne.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||ne.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):f()),o=()=>{const h=r;let m=!1;for(r++;r<t&&(n[r]!=='"'||m&&n[r-1]==="\\");)m=n[r]==="\\"?!m:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(h,++r-Number(m)))}catch(d){i(String(d))}else if(ne.STR&e)try{return JSON.parse(n.substring(h,r-Number(m))+'"')}catch{return JSON.parse(n.substring(h,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{r++,u();const h={};try{for(;n[r]!=="}";){if(u(),r>=t&&ne.OBJ&e)return h;const m=o();u(),r++;try{const d=a();Object.defineProperty(h,m,{value:d,writable:!0,enumerable:!0,configurable:!0})}catch(d){if(ne.OBJ&e)return h;throw d}u(),n[r]===","&&r++}}catch{if(ne.OBJ&e)return h;s("Expected '}' at end of object")}return r++,h},c=()=>{r++;const h=[];try{for(;n[r]!=="]";)h.push(a()),u(),n[r]===","&&r++}catch{if(ne.ARR&e)return h;s("Expected ']' at end of array")}return r++,h},f=()=>{if(r===0){n==="-"&&ne.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(m){if(ne.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}i(String(m))}}const h=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(ne.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(h,r))}catch{n.substring(h,r)==="-"&&ne.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(h,n.lastIndexOf("e")))}catch(d){i(String(d))}}},u=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return a()},ki=n=>hu(n,ne.ALL^ne.NUM);var ut=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},W=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ee,$e,ft,We,Cr,_n,xr,vr,Or,yn,Tr,Ci;class tn extends Po{constructor(e){super(),ee.add(this),$e.set(this,void 0),ft.set(this,void 0),We.set(this,void 0),ut(this,$e,e,"f"),ut(this,ft,[],"f")}get currentChatCompletionSnapshot(){return W(this,We,"f")}static fromReadableStream(e){const t=new tn(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const s=new tn(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var a;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),W(this,ee,"m",Cr).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)W(this,ee,"m",xr).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new Oe;return this._addChatCompletion(W(this,ee,"m",yn).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),W(this,ee,"m",Cr).call(this),this._connected();const s=Zt.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(W(this,ee,"m",yn).call(this)),W(this,ee,"m",xr).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new Oe;return this._addChatCompletion(W(this,ee,"m",yn).call(this))}[($e=new WeakMap,ft=new WeakMap,We=new WeakMap,ee=new WeakSet,Cr=function(){this.ended||ut(this,We,void 0,"f")},_n=function(t){let r=W(this,ft,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},W(this,ft,"f")[t.index]=r,r)},xr=function(t){var s,i,a,o,l,c,f,u,h,m,d,_,g,P,p;if(this.ended)return;const r=W(this,ee,"m",Ci).call(this,t);this._emit("chunk",t,r);for(const E of t.choices){const b=r.choices[E.index];E.delta.content!=null&&((s=b.message)==null?void 0:s.role)==="assistant"&&((i=b.message)!=null&&i.content)&&(this._emit("content",E.delta.content,b.message.content),this._emit("content.delta",{delta:E.delta.content,snapshot:b.message.content,parsed:b.message.parsed})),E.delta.refusal!=null&&((a=b.message)==null?void 0:a.role)==="assistant"&&((o=b.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:E.delta.refusal,snapshot:b.message.refusal}),((l=E.logprobs)==null?void 0:l.content)!=null&&((c=b.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(f=E.logprobs)==null?void 0:f.content,snapshot:((u=b.logprobs)==null?void 0:u.content)??[]}),((h=E.logprobs)==null?void 0:h.refusal)!=null&&((m=b.message)==null?void 0:m.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(d=E.logprobs)==null?void 0:d.refusal,snapshot:((_=b.logprobs)==null?void 0:_.refusal)??[]});const S=W(this,ee,"m",_n).call(this,b);b.finish_reason&&(W(this,ee,"m",Or).call(this,b),S.current_tool_call_index!=null&&W(this,ee,"m",vr).call(this,b,S.current_tool_call_index));for(const C of E.delta.tool_calls??[])S.current_tool_call_index!==C.index&&(W(this,ee,"m",Or).call(this,b),S.current_tool_call_index!=null&&W(this,ee,"m",vr).call(this,b,S.current_tool_call_index)),S.current_tool_call_index=C.index;for(const C of E.delta.tool_calls??[]){const k=(g=b.message.tool_calls)==null?void 0:g[C.index];k!=null&&k.type&&((k==null?void 0:k.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(P=k.function)==null?void 0:P.name,index:C.index,arguments:k.function.arguments,parsed_arguments:k.function.parsed_arguments,arguments_delta:((p=C.function)==null?void 0:p.arguments)??""}):(k==null||k.type,void 0))}}},vr=function(t,r){var a,o,l;if(W(this,ee,"m",_n).call(this,t).done_tool_calls.has(r))return;const i=(a=t.message.tool_calls)==null?void 0:a[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const c=(l=(o=W(this,$e,"f"))==null?void 0:o.tools)==null?void 0:l.find(f=>f.type==="function"&&f.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:on(c)?c.$parseRaw(i.function.arguments):c!=null&&c.function.strict?JSON.parse(i.function.arguments):null})}else i.type},Or=function(t){var s,i;const r=W(this,ee,"m",_n).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const a=W(this,ee,"m",Tr).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},yn=function(){if(this.ended)throw new $("stream has ended, this shouldn't happen");const t=W(this,We,"f");if(!t)throw new $("request ended without sending any chunks");return ut(this,We,void 0,"f"),ut(this,ft,[],"f"),pu(t,W(this,$e,"f"))},Tr=function(){var r;const t=(r=W(this,$e,"f"))==null?void 0:r.response_format;return So(t)?t:null},Ci=function(t){var r,s,i,a;let o=W(this,We,"f");const{choices:l,...c}=t;o?Object.assign(o,c):o=ut(this,We,{...c,choices:[]},"f");for(const{delta:f,finish_reason:u,index:h,logprobs:m=null,...d}of t.choices){let _=o.choices[h];if(_||(_=o.choices[h]={finish_reason:u,index:h,message:{},logprobs:m,...d}),m)if(!_.logprobs)_.logprobs=Object.assign({},m);else{const{content:C,refusal:k,...O}=m;Object.assign(_.logprobs,O),C&&((r=_.logprobs).content??(r.content=[]),_.logprobs.content.push(...C)),k&&((s=_.logprobs).refusal??(s.refusal=[]),_.logprobs.refusal.push(...k))}if(u&&(_.finish_reason=u,W(this,$e,"f")&&Eo(W(this,$e,"f")))){if(u==="length")throw new Za;if(u==="content_filter")throw new eo}if(Object.assign(_,d),!f)continue;const{content:g,refusal:P,function_call:p,role:E,tool_calls:b,...S}=f;if(Object.assign(_.message,S),P&&(_.message.refusal=(_.message.refusal||"")+P),E&&(_.message.role=E),p&&(_.message.function_call?(p.name&&(_.message.function_call.name=p.name),p.arguments&&((i=_.message.function_call).arguments??(i.arguments=""),_.message.function_call.arguments+=p.arguments)):_.message.function_call=p),g&&(_.message.content=(_.message.content||"")+g,!_.message.refusal&&W(this,ee,"m",Tr).call(this)&&(_.message.parsed=ki(_.message.content))),b){_.message.tool_calls||(_.message.tool_calls=[]);for(const{index:C,id:k,type:O,function:I,...N}of b){const x=(a=_.message.tool_calls)[C]??(a[C]={});Object.assign(x,N),k&&(x.id=k),O&&(x.type=O),I&&(x.function??(x.function={name:I.name??"",arguments:""})),I!=null&&I.name&&(x.function.name=I.name),I!=null&&I.arguments&&(x.function.arguments+=I.arguments,lu(W(this,$e,"f"),x)&&(x.function.parsed_arguments=ki(x.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Zt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function pu(n,e){const{id:t,choices:r,created:s,model:i,system_fingerprint:a,...o}=n,l={...o,id:t,choices:r.map(({message:c,finish_reason:f,index:u,logprobs:h,...m})=>{if(!f)throw new $(`missing finish_reason for choice ${u}`);const{content:d=null,function_call:_,tool_calls:g,...P}=c,p=c.role;if(!p)throw new $(`missing role for choice ${u}`);if(_){const{arguments:E,name:b}=_;if(E==null)throw new $(`missing function_call.arguments for choice ${u}`);if(!b)throw new $(`missing function_call.name for choice ${u}`);return{...m,message:{content:d,function_call:{arguments:E,name:b},role:p,refusal:c.refusal??null},finish_reason:f,index:u,logprobs:h}}return g?{...m,index:u,finish_reason:f,logprobs:h,message:{...P,role:p,content:d,refusal:c.refusal??null,tool_calls:g.map((E,b)=>{const{function:S,type:C,id:k,...O}=E,{arguments:I,name:N,...x}=S||{};if(k==null)throw new $(`missing choices[${u}].tool_calls[${b}].id
${wn(n)}`);if(C==null)throw new $(`missing choices[${u}].tool_calls[${b}].type
${wn(n)}`);if(N==null)throw new $(`missing choices[${u}].tool_calls[${b}].function.name
${wn(n)}`);if(I==null)throw new $(`missing choices[${u}].tool_calls[${b}].function.arguments
${wn(n)}`);return{...O,id:k,type:C,function:{...x,name:N,arguments:I}}})}}:{...m,message:{...P,content:d,role:p,refusal:c.refusal??null},finish_reason:f,index:u,logprobs:h}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return iu(l,e)}function wn(n){return JSON.stringify(n)}class Rt extends tn{static fromReadableStream(e){const t=new Rt(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const s=new Rt(null),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new Rt(t),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}let Do=class extends q{parse(e,t){return cu(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>vs(r,e))}runFunctions(e,t){return e.stream?Rt.runFunctions(this._client,e,t):en.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Rt.runTools(this._client,e,t):en.runTools(this._client,e,t)}stream(e,t){return tn.createChatCompletion(this._client,e,t)}};class $o extends q{constructor(){super(...arguments),this.completions=new Do(this._client)}}(function(n){n.Completions=Do})($o);class Uo extends q{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Os extends q{constructor(){super(...arguments),this.sessions=new Uo(this._client)}}Os.Sessions=Uo;var M=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Se=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},re,as,Le,On,ve,Ze,wt,Ye,Hn,Ee,Tn,Mn,Gt,Jt,Xt,xi,vi,Oi,Ti,Mi,Ii,Ni;class Te extends bo{constructor(){super(...arguments),re.add(this),as.set(this,[]),Le.set(this,{}),On.set(this,{}),ve.set(this,void 0),Ze.set(this,void 0),wt.set(this,void 0),Ye.set(this,void 0),Hn.set(this,void 0),Ee.set(this,void 0),Tn.set(this,void 0),Mn.set(this,void 0),Gt.set(this,void 0)}[(as=new WeakMap,Le=new WeakMap,On=new WeakMap,ve=new WeakMap,Ze=new WeakMap,wt=new WeakMap,Ye=new WeakMap,Hn=new WeakMap,Ee=new WeakMap,Tn=new WeakMap,Mn=new WeakMap,Gt=new WeakMap,re=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Te;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=Zt.fromReadableStream(e,this.controller);for await(const a of s)M(this,re,"m",Jt).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new Oe;return this._addRun(M(this,re,"m",Xt).call(this))}toReadableStream(){return new Zt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,i){const a=new Te;return a._run(()=>a._runToolAssistantStream(e,t,r,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,r,s,i){var c;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},l=await e.submitToolOutputs(t,r,o,{...i,signal:this.controller.signal});this._connected();for await(const f of l)M(this,re,"m",Jt).call(this,f);if((c=l.controller.signal)!=null&&c.aborted)throw new Oe;return this._addRun(M(this,re,"m",Xt).call(this))}static createThreadAssistantStream(e,t,r){const s=new Te;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){const i=new Te;return i._run(()=>i._runAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return M(this,Tn,"f")}currentRun(){return M(this,Mn,"f")}currentMessageSnapshot(){return M(this,ve,"f")}currentRunStepSnapshot(){return M(this,Gt,"f")}async finalRunSteps(){return await this.done(),Object.values(M(this,Le,"f"))}async finalMessages(){return await this.done(),Object.values(M(this,On,"f"))}async finalRun(){if(await this.done(),!M(this,Ze,"f"))throw Error("Final run was not received.");return M(this,Ze,"f")}async _createThreadAssistantStream(e,t,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const l of a)M(this,re,"m",Jt).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new Oe;return this._addRun(M(this,re,"m",Xt).call(this))}async _createAssistantStream(e,t,r,s){var l;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const c of o)M(this,re,"m",Jt).call(this,c);if((l=o.controller.signal)!=null&&l.aborted)throw new Oe;return this._addRun(M(this,re,"m",Xt).call(this))}static accumulateDelta(e,t){for(const[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(kr(i)&&kr(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(const a of s){if(!kr(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=i[o];l==null?i.push(a):i[o]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,i){return await this._createToolAssistantStream(r,e,t,s,i)}}Jt=function(e){if(!this.ended)switch(Se(this,Tn,e,"f"),M(this,re,"m",Oi).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":M(this,re,"m",Ni).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":M(this,re,"m",vi).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":M(this,re,"m",xi).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Xt=function(){if(this.ended)throw new $("stream has ended, this shouldn't happen");if(!M(this,Ze,"f"))throw Error("Final run has not been received");return M(this,Ze,"f")},xi=function(e){const[t,r]=M(this,re,"m",Mi).call(this,e,M(this,ve,"f"));Se(this,ve,t,"f"),M(this,On,"f")[t.id]=t;for(const s of r){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=M(this,wt,"f")){if(M(this,Ye,"f"))switch(M(this,Ye,"f").type){case"text":this._emit("textDone",M(this,Ye,"f").text,M(this,ve,"f"));break;case"image_file":this._emit("imageFileDone",M(this,Ye,"f").image_file,M(this,ve,"f"));break}Se(this,wt,s.index,"f")}Se(this,Ye,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(M(this,wt,"f")!==void 0){const s=e.data.content[M(this,wt,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,M(this,ve,"f"));break;case"text":this._emit("textDone",s.text,M(this,ve,"f"));break}}M(this,ve,"f")&&this._emit("messageDone",e.data),Se(this,ve,void 0,"f")}},vi=function(e){const t=M(this,re,"m",Ti).call(this,e);switch(Se(this,Gt,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==M(this,Hn,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(M(this,Ee,"f")&&this._emit("toolCallDone",M(this,Ee,"f")),Se(this,Hn,i.index,"f"),Se(this,Ee,t.step_details.tool_calls[i.index],"f"),M(this,Ee,"f")&&this._emit("toolCallCreated",M(this,Ee,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Se(this,Gt,void 0,"f"),e.data.step_details.type=="tool_calls"&&M(this,Ee,"f")&&(this._emit("toolCallDone",M(this,Ee,"f")),Se(this,Ee,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Oi=function(e){M(this,as,"f").push(e),this._emit("event",e)},Ti=function(e){switch(e.event){case"thread.run.step.created":return M(this,Le,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=M(this,Le,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=Te.accumulateDelta(t,r.delta);M(this,Le,"f")[e.data.id]=s}return M(this,Le,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":M(this,Le,"f")[e.data.id]=e.data;break}if(M(this,Le,"f")[e.data.id])return M(this,Le,"f")[e.data.id];throw new Error("No snapshot available")},Mi=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=M(this,re,"m",Ii).call(this,i,a)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Ii=function(e,t){return Te.accumulateDelta(t,e)},Ni=function(e){switch(Se(this,Mn,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Se(this,Ze,e.data,"f"),M(this,Ee,"f")&&(this._emit("toolCallDone",M(this,Ee,"f")),Se(this,Ee,void 0,"f"));break}};let Ts=class extends q{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return ye(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Ms,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}};class Ms extends Me{}Ts.MessagesPage=Ms;class Is extends q{retrieve(e,t,r,s={},i){return ye(s)?this.retrieve(e,t,r,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,r={},s){return ye(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Ns,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Ns extends Me{}Is.RunStepsPage=Ns;class ln extends q{constructor(){super(...arguments),this.steps=new Is(this._client)}create(e,t,r){const{include:s,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return ye(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Fs,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return Te.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await sn(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return Te.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,s){const i=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,r,s){return Te.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}}class Fs extends Me{}ln.RunsPage=Fs;ln.Steps=Is;ln.RunStepsPage=Ns;class xt extends q{constructor(){super(...arguments),this.runs=new ln(this._client),this.messages=new Ts(this._client)}create(e={},t){return ye(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return Te.createThreadAssistantStream(e,this._client.beta.threads,t)}}xt.Runs=ln;xt.RunsPage=Fs;xt.Messages=Ts;xt.MessagesPage=Ms;const gu=async n=>{const e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};let Bs=class extends q{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},r){return ye(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,nr,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...r,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=i.response.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await sn(o);break;case"failed":case"completed":return a}}}async upload(e,t,r){const s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){const s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}};class nr extends Me{}Bs.VectorStoreFilesPage=nr;class jo extends q{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r={},s){return ye(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,nr,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await sn(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,t.length),o=this._client,l=t.values(),c=[...r];async function f(h){for(let m of h){const d=await o.files.create({file:m,purpose:"assistants"},s);c.push(d.id)}}const u=Array(a).fill(l).map(f);return await gu(u),await this.createAndPoll(e,{file_ids:c})}}class vt extends q{constructor(){super(...arguments),this.files=new Bs(this._client),this.fileBatches=new jo(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return ye(e)?this.list({},e):this._client.getAPIList("/vector_stores",Ls,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Ls extends Me{}vt.VectorStoresPage=Ls;vt.Files=Bs;vt.VectorStoreFilesPage=nr;vt.FileBatches=jo;let Ke=class extends q{constructor(){super(...arguments),this.realtime=new Os(this._client),this.vectorStores=new vt(this._client),this.chat=new $o(this._client),this.assistants=new Cs(this._client),this.threads=new xt(this._client)}};Ke.Realtime=Os;Ke.VectorStores=vt;Ke.VectorStoresPage=Ls;Ke.Assistants=Cs;Ke.AssistantsPage=xs;Ke.Threads=xt;let qo=class extends q{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};class Ho extends q{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class Ds extends q{create(e,t){return this._client.post("/files",Ct({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return ye(e)?this.list({},e):this._client.getAPIList("/files",$s,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await sn(t),a=await this.retrieve(e),Date.now()-i>r)throw new As({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class $s extends Me{}Ds.FileObjectsPage=$s;class Us extends q{list(e,t={},r){return ye(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,js,{query:t,...r})}}class js extends Me{}Us.FineTuningJobCheckpointsPage=js;class Ot extends q{constructor(){super(...arguments),this.checkpoints=new Us(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return ye(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",qs,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return ye(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Hs,{query:t,...r})}}class qs extends Me{}class Hs extends Me{}Ot.FineTuningJobsPage=qs;Ot.FineTuningJobEventsPage=Hs;Ot.Checkpoints=Us;Ot.FineTuningJobCheckpointsPage=js;class cn extends q{constructor(){super(...arguments),this.jobs=new Ot(this._client)}}cn.Jobs=Ot;cn.FineTuningJobsPage=qs;cn.FineTuningJobEventsPage=Hs;class Wo extends q{createVariation(e,t){return this._client.post("/images/variations",Ct({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Ct({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}let Ws=class extends q{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Vs,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}};class Vs extends su{}Ws.ModelsPage=Vs;class Vo extends q{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class Jo extends q{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,Ct({body:t,...r}))}}class Js extends q{constructor(){super(...arguments),this.parts=new Jo(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}}Js.Parts=Jo;var Xo;class U extends Vc{constructor({baseURL:e=gn("OPENAI_BASE_URL"),apiKey:t=gn("OPENAI_API_KEY"),organization:r=gn("OPENAI_ORG_ID")??null,project:s=gn("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new $("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:r,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&nu())throw new $(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new qo(this),this.chat=new Ps(this),this.embeddings=new Ho(this),this.files=new Ds(this),this.images=new Wo(this),this.audio=new an(this),this.moderations=new Vo(this),this.models=new Ws(this),this.fineTuning=new cn(this),this.beta=new Ke(this),this.batches=new Rs(this),this.uploads=new Js(this),this._options=a,this.apiKey=t,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return xc(e,{arrayFormat:"brackets"})}}Xo=U;U.OpenAI=Xo;U.DEFAULT_TIMEOUT=6e5;U.OpenAIError=$;U.APIError=_e;U.APIConnectionError=Zn;U.APIConnectionTimeoutError=As;U.APIUserAbortError=Oe;U.NotFoundError=za;U.ConflictError=Ka;U.RateLimitError=Qa;U.BadRequestError=Va;U.AuthenticationError=Ja;U.InternalServerError=Ya;U.PermissionDeniedError=Xa;U.UnprocessableEntityError=Ga;U.toFile=so;U.fileFromPath=Ha;U.Completions=qo;U.Chat=Ps;U.Embeddings=Ho;U.Files=Ds;U.FileObjectsPage=$s;U.Images=Wo;U.Audio=an;U.Moderations=Vo;U.Models=Ws;U.ModelsPage=Vs;U.FineTuning=cn;U.Beta=Ke;U.Batches=Rs;U.BatchesPage=ks;U.Uploads=Js;const gt="0.33.1";let Fi=!1,Qt,zo,os,Ko,Go,Qo;function _u(n,e={auto:!1}){if(Fi)throw new Error(`you must \`import '@anthropic-ai/sdk/shims/${n.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(Qt)throw new Error(`can't \`import '@anthropic-ai/sdk/shims/${n.kind}'\` after \`import '@anthropic-ai/sdk/shims/${Qt}'\``);Fi=e.auto,Qt=n.kind,zo=n.fetch,os=n.File,Ko=n.ReadableStream,Go=n.getDefaultAgent,Qo=n.fileFromPath}class yu{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function wu({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from '@anthropic-ai/sdk'`:\n- `import '@anthropic-ai/sdk/shims/node'` (if you're running on Node)\n- `import '@anthropic-ai/sdk/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new yu(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:a=>!1}}Qt||_u(wu(),{auto:!0});class X extends Error{}class le extends X{constructor(e,t,r,s){super(`${le.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["request-id"],this.error=t}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new rr({message:r,cause:ls(t)});const i=t;return e===400?new Zo(e,i,r,s):e===401?new el(e,i,r,s):e===403?new tl(e,i,r,s):e===404?new nl(e,i,r,s):e===409?new rl(e,i,r,s):e===422?new sl(e,i,r,s):e===429?new il(e,i,r,s):e>=500?new al(e,i,r,s):new le(e,i,r,s)}}class et extends le{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class rr extends le{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class Yo extends rr{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Zo extends le{}class el extends le{}class tl extends le{}class nl extends le{}class rl extends le{}class sl extends le{}class il extends le{}class al extends le{}class ze{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=ze.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(ze.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new X(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new X(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new X("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}ze.NEWLINE_CHARS=new Set([`
`,"\r"]);ze.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class Je{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of bu(e,t)){if(a.event==="completion")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event==="message_start"||a.event==="message_delta"||a.event==="message_stop"||a.event==="content_block_start"||a.event==="content_block_delta"||a.event==="content_block_stop")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event!=="ping"&&a.event==="error")throw le.generate(void 0,`SSE Error: ${a.data}`,a.data,cl(e.headers))}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Je(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new ze,o=Xs(e);for await(const l of o)for(const c of a.decode(l))yield c;for(const l of a.flush())yield l}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Je(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new Je(()=>s(e),this.controller),new Je(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new Ko({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*bu(n,e){if(!n.body)throw e.abort(),new X("Attempted to iterate over a response with no body");const t=new Au,r=new ze,s=Xs(n.body);for await(const i of Su(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*Su(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=Eu(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function Eu(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}class Au{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=Pu(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function Pu(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function Xs(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Ru=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",ku=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&sr(n),sr=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function";async function Cu(n,e,t){var s;if(n=await n,ku(n))return n;if(Ru(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=sr(i)?[await i.arrayBuffer()]:[i];return new os(a,e,t)}const r=await xu(n);if(e||(e=Ou(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new os(r,e,t)}async function xu(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(sr(n))e.push(await n.arrayBuffer());else if(Tu(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${vu(n)}`);return e}function vu(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Ou(n){var e;return Mr(n.name)||Mr(n.filename)||((e=Mr(n.path))==null?void 0:e.split(/[\\/]/).pop())}const Mr=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Tu=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Bi=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var Mu=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Iu=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},bn;async function ol(n){const{response:e}=n;if(n.options.stream)return kt("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Je.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return kt("response",e.status,e.url,e.headers,i),ll(i,e)}const s=await e.text();return kt("response",e.status,e.url,e.headers,s),s}function ll(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}class ir extends Promise{constructor(e,t=ol){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new ir(this.responsePromise,async t=>ll(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Nu{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Ir("maxRetries",t),this.timeout=Ir("timeout",r),this.httpAgent=s,this.fetch=i??zo}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Uu(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Vu()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&sr(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var _;const{method:r,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:Bi(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),c=this.buildURL(s,i);"timeout"in e&&Ir("timeout",e.timeout);const f=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??Go(c),h=f+1e3;typeof((_=u==null?void 0:u.options)==null?void 0:_.timeout)=="number"&&h>(u.options.timeout??0)&&(u.options.timeout=h),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const m=this.buildHeaders({options:e,headers:a,contentLength:l,retryCount:t});return{req:{method:r,...o&&{body:o},headers:m,...u&&{agent:u},signal:e.signal??null},url:c,timeout:f}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const a=this.defaultHeaders(e);return Ui(i,a),Ui(i,t),Bi(e.body)&&Qt!=="node"&&delete i["content-type"],ji(a,"x-stainless-retry-count")===void 0&&ji(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return le.generate(e,t,r,s)}request(e,t=null){return new ir(this.makeRequest(e,t))}async makeRequest(e,t){var u,h;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),kt("request",a,r,i.headers),(u=r.signal)!=null&&u.aborted)throw new et;const l=new AbortController,c=await this.fetchWithTimeout(a,i,o,l).catch(ls);if(c instanceof Error){if((h=r.signal)!=null&&h.aborted)throw new et;if(t)return this.retryRequest(r,t);throw c.name==="AbortError"?new Yo:new rr({cause:c})}const f=cl(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const p=`retrying, ${t} attempts remaining`;return kt(`response (error; ${p})`,c.status,a,f),this.retryRequest(r,t,f)}const m=await c.text().catch(p=>ls(p).message),d=ju(m),_=d?void 0:m;throw kt(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,f,_),this.makeStatusError(c.status,d,_,f)}return{response:c,options:r,controller:l}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new Bu(this,r,e)}buildURL(e,t){const r=Hu(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Wn(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new X(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r);return this.fetch.call(void 0,e,{signal:s.signal,...a}).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Wu(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${gt}`}}class Fu{constructor(e,t,r,s){bn.set(this,void 0),Mu(this,bn,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new X("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await Iu(this,bn,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(bn=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Bu extends ir{constructor(e,t,r){super(t,async s=>new r(e,s.response,await ol(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const cl=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),Lu={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},tt=n=>typeof n=="object"&&n!==null&&!Wn(n)&&Object.keys(n).every(e=>ul(Lu,e)),Du=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":gt,"X-Stainless-OS":Di(Deno.build.os),"X-Stainless-Arch":Li(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":gt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":gt,"X-Stainless-OS":Di(process.platform),"X-Stainless-Arch":Li(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=$u();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":gt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":gt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function $u(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const Li=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Di=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let $i;const Uu=()=>$i??($i=Du()),ju=n=>{try{return JSON.parse(n)}catch{return}},qu=/^[a-z][a-z0-9+.-]*:/i,Hu=n=>qu.test(n),Wu=n=>new Promise(e=>setTimeout(e,n)),Ir=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new X(`${n} must be an integer`);if(e<0)throw new X(`${n} must be a positive integer`);return e},ls=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(String(n))},Nr=n=>{var e,t,r,s,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,n))==null?void 0:i.trim()};function Wn(n){if(!n)return!0;for(const e in n)return!1;return!0}function ul(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ui(n,e){for(const t in e){if(!ul(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function kt(n,...e){var t;typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"&&console.log(`Anthropic:DEBUG:${n}`,...e)}const Vu=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),Ju=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Xu=n=>typeof(n==null?void 0:n.get)=="function",ji=(n,e)=>{var r;const t=e.toLowerCase();if(Xu(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=n.get(i);if(a)return a}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};class ar extends Fu{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.first_id=r.first_id||null,this.last_id=r.last_id||null}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var t;if((t=this.options.query)!=null&&t.before_id){const r=this.first_id;return r?{params:{before_id:r}}:null}const e=this.last_id;return e?{params:{after_id:e}}:null}}class Ge{constructor(e){this._client=e}}let zs=class extends Ge{retrieve(e,t){return this._client.get(`/v1/models/${e}?beta=true`,t)}list(e={},t){return tt(e)?this.list({},e):this._client.getAPIList("/v1/models?beta=true",Ks,{query:e,...t})}};class Ks extends ar{}zs.BetaModelInfosPage=Ks;class or{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new ze;for await(const t of this.iterator)for(const r of e.decode(t))yield JSON.parse(r);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),new X("Attempted to iterate over a response with no body");return new or(Xs(e.body),t)}}let Gs=class extends Ge{create(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages/batches?beta=true",{body:s,...t,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}retrieve(e,t={},r){if(tt(t))return this.retrieve(e,{},t);const{betas:s}=t;return this._client.get(`/v1/messages/batches/${e}?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}list(e={},t){if(tt(e))return this.list({},e);const{betas:r,...s}=e;return this._client.getAPIList("/v1/messages/batches?beta=true",Qs,{query:s,...t,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}cancel(e,t={},r){if(tt(t))return this.cancel(e,{},t);const{betas:s}=t;return this._client.post(`/v1/messages/batches/${e}/cancel?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}async results(e,t={},r){if(tt(t))return this.results(e,{},t);const s=await this.retrieve(e);if(!s.results_url)throw new X(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);const{betas:i}=t;return this._client.get(s.results_url,{...r,headers:{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers},__binaryResponse:!0})._thenUnwrap((a,o)=>or.fromResponse(o.response,o.controller))}};class Qs extends ar{}Gs.BetaMessageBatchesPage=Qs;let lr=class extends Ge{constructor(){super(...arguments),this.batches=new Gs(this._client)}create(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages?beta=true",{body:s,timeout:this._client._options.timeout??6e5,...t,headers:{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0,...t==null?void 0:t.headers},stream:e.stream??!1})}countTokens(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:s,...t,headers:{"anthropic-beta":[...r??[],"token-counting-2024-11-01"].toString(),...t==null?void 0:t.headers}})}};lr.Batches=Gs;lr.BetaMessageBatchesPage=Qs;class un extends Ge{constructor(){super(...arguments),this.models=new zs(this._client),this.messages=new lr(this._client)}}un.Models=zs;un.BetaModelInfosPage=Ks;un.Messages=lr;class fl extends Ge{create(e,t){return this._client.post("/v1/complete",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}}class Ys extends Ge{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/v1/messages/batches/${e}`,t)}list(e={},t){return tt(e)?this.list({},e):this._client.getAPIList("/v1/messages/batches",Zs,{query:e,...t})}cancel(e,t){return this._client.post(`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const r=await this.retrieve(e);if(!r.results_url)throw new X(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);return this._client.get(r.results_url,{...t,__binaryResponse:!0})._thenUnwrap((s,i)=>or.fromResponse(i.response,i.controller))}}class Zs extends ar{}Ys.MessageBatchesPage=Zs;const zu=n=>{let e=0,t=[];for(;e<n.length;){let r=n[e];if(r==="\\"){e++;continue}if(r==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(r==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(r==="["){t.push({type:"paren",value:"["}),e++;continue}if(r==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(r===":"){t.push({type:"separator",value:":"}),e++;continue}if(r===","){t.push({type:"delimiter",value:","}),e++;continue}if(r==='"'){let o="",l=!1;for(r=n[++e];r!=='"';){if(e===n.length){l=!0;break}if(r==="\\"){if(e++,e===n.length){l=!0;break}o+=r+n[e],r=n[++e]}else o+=r,r=n[++e]}r=n[++e],l||t.push({type:"string",value:o});continue}if(r&&/\s/.test(r)){e++;continue}let i=/[0-9]/;if(r&&i.test(r)||r==="-"||r==="."){let o="";for(r==="-"&&(o+=r,r=n[++e]);r&&i.test(r)||r===".";)o+=r,r=n[++e];t.push({type:"number",value:o});continue}let a=/[a-z]/i;if(r&&a.test(r)){let o="";for(;r&&a.test(r)&&e!==n.length;)o+=r,r=n[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},_t=n=>{if(n.length===0)return n;let e=n[n.length-1];switch(e.type){case"separator":return n=n.slice(0,n.length-1),_t(n);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return n=n.slice(0,n.length-1),_t(n);case"string":let r=n[n.length-2];if((r==null?void 0:r.type)==="delimiter")return n=n.slice(0,n.length-1),_t(n);if((r==null?void 0:r.type)==="brace"&&r.value==="{")return n=n.slice(0,n.length-1),_t(n);break;case"delimiter":return n=n.slice(0,n.length-1),_t(n)}return n},Ku=n=>{let e=[];return n.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?n.push({type:"brace",value:"}"}):t==="]"&&n.push({type:"paren",value:"]"})}),n},Gu=n=>{let e="";return n.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},Qu=n=>JSON.parse(Gu(Ku(_t(zu(n)))));var me=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},D=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ke,Ve,Sn,En,Bt,Lt,An,Dt,Ue,$t,Pn,Rn,dt,Fr,qi,Br,Lr,Dr,$r,Hi;const Wi="__json_buf";class Vn{constructor(){ke.add(this),this.messages=[],this.receivedMessages=[],Ve.set(this,void 0),this.controller=new AbortController,Sn.set(this,void 0),En.set(this,()=>{}),Bt.set(this,()=>{}),Lt.set(this,void 0),An.set(this,()=>{}),Dt.set(this,()=>{}),Ue.set(this,{}),$t.set(this,!1),Pn.set(this,!1),Rn.set(this,!1),dt.set(this,!1),Br.set(this,e=>{if(me(this,Pn,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new et),e instanceof et)return me(this,Rn,!0,"f"),this._emit("abort",e);if(e instanceof X)return this._emit("error",e);if(e instanceof Error){const t=new X(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new X(String(e)))}),me(this,Sn,new Promise((e,t)=>{me(this,En,e,"f"),me(this,Bt,t,"f")}),"f"),me(this,Lt,new Promise((e,t)=>{me(this,An,e,"f"),me(this,Dt,t,"f")}),"f"),D(this,Sn,"f").catch(()=>{}),D(this,Lt,"f").catch(()=>{})}static fromReadableStream(e){const t=new Vn;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){const s=new Vn;for(const i of t.messages)s._addMessageParam(i);return s._run(()=>s._createMessage(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},D(this,Br,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){var a;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),D(this,ke,"m",Lr).call(this);const i=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)D(this,ke,"m",Dr).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new et;D(this,ke,"m",$r).call(this)}_connected(){this.ended||(D(this,En,"f").call(this),this._emit("connect"))}get ended(){return D(this,$t,"f")}get errored(){return D(this,Pn,"f")}get aborted(){return D(this,Rn,"f")}abort(){this.controller.abort()}on(e,t){return(D(this,Ue,"f")[e]||(D(this,Ue,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=D(this,Ue,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(D(this,Ue,"f")[e]||(D(this,Ue,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{me(this,dt,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){me(this,dt,!0,"f"),await D(this,Lt,"f")}get currentMessage(){return D(this,Ve,"f")}async finalMessage(){return await this.done(),D(this,ke,"m",Fr).call(this)}async finalText(){return await this.done(),D(this,ke,"m",qi).call(this)}_emit(e,...t){if(D(this,$t,"f"))return;e==="end"&&(me(this,$t,!0,"f"),D(this,An,"f").call(this));const r=D(this,Ue,"f")[e];if(r&&(D(this,Ue,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!D(this,dt,"f")&&!(r!=null&&r.length)&&Promise.reject(s),D(this,Bt,"f").call(this,s),D(this,Dt,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!D(this,dt,"f")&&!(r!=null&&r.length)&&Promise.reject(s),D(this,Bt,"f").call(this,s),D(this,Dt,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",D(this,ke,"m",Fr).call(this))}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),D(this,ke,"m",Lr).call(this),this._connected();const s=Je.fromReadableStream(e,this.controller);for await(const a of s)D(this,ke,"m",Dr).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new et;D(this,ke,"m",$r).call(this)}[(Ve=new WeakMap,Sn=new WeakMap,En=new WeakMap,Bt=new WeakMap,Lt=new WeakMap,An=new WeakMap,Dt=new WeakMap,Ue=new WeakMap,$t=new WeakMap,Pn=new WeakMap,Rn=new WeakMap,dt=new WeakMap,Br=new WeakMap,ke=new WeakSet,Fr=function(){if(this.receivedMessages.length===0)throw new X("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},qi=function(){if(this.receivedMessages.length===0)throw new X("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new X("stream ended without producing a content block with type=text");return t.join(" ")},Lr=function(){this.ended||me(this,Ve,void 0,"f")},Dr=function(t){if(this.ended)return;const r=D(this,ke,"m",Hi).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{const s=r.content.at(-1);t.delta.type==="text_delta"&&s.type==="text"?this._emit("text",t.delta.text,s.text||""):t.delta.type==="input_json_delta"&&s.type==="tool_use"&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{me(this,Ve,r,"f");break}}},$r=function(){if(this.ended)throw new X("stream has ended, this shouldn't happen");const t=D(this,Ve,"f");if(!t)throw new X("request ended without sending any chunks");return me(this,Ve,void 0,"f"),t},Hi=function(t){let r=D(this,Ve,"f");if(t.type==="message_start"){if(r)throw new X(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new X(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{const s=r.content.at(t.index);if((s==null?void 0:s.type)==="text"&&t.delta.type==="text_delta")s.text+=t.delta.text;else if((s==null?void 0:s.type)==="tool_use"&&t.delta.type==="input_json_delta"){let i=s[Wi]||"";i+=t.delta.partial_json,Object.defineProperty(s,Wi,{value:i,enumerable:!1,writable:!0}),i&&(s.input=Qu(i))}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("streamEvent",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Je(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class cr extends Ge{constructor(){super(...arguments),this.batches=new Ys(this._client)}create(e,t){return e.model in Vi&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${Vi[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}stream(e,t){return Vn.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}const Vi={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024"};cr.Batches=Ys;cr.MessageBatchesPage=Zs;class ei extends Ge{retrieve(e,t){return this._client.get(`/v1/models/${e}`,t)}list(e={},t){return tt(e)?this.list({},e):this._client.getAPIList("/v1/models",ti,{query:e,...t})}}class ti extends ar{}ei.ModelInfosPage=ti;var dl;class J extends Nu{constructor({baseURL:e=Nr("ANTHROPIC_BASE_URL"),apiKey:t=Nr("ANTHROPIC_API_KEY")??null,authToken:r=Nr("ANTHROPIC_AUTH_TOKEN")??null,...s}={}){const i={apiKey:t,authToken:r,...s,baseURL:e||"https://api.anthropic.com"};if(!i.dangerouslyAllowBrowser&&Ju())throw new X(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new fl(this),this.messages=new cr(this),this.models=new ei(this),this.beta=new un(this),this._options=i,this.apiKey=t,this.authToken=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(e,t){if(!(this.apiKey&&e["x-api-key"])&&t["x-api-key"]!==null&&!(this.authToken&&e.authorization)&&t.authorization!==null)throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){const t=this.apiKeyAuth(e),r=this.bearerAuth(e);return t!=null&&!Wn(t)?t:r!=null&&!Wn(r)?r:{}}apiKeyAuth(e){return this.apiKey==null?{}:{"X-Api-Key":this.apiKey}}bearerAuth(e){return this.authToken==null?{}:{Authorization:`Bearer ${this.authToken}`}}}dl=J;J.Anthropic=dl;J.HUMAN_PROMPT=`

Human:`;J.AI_PROMPT=`

Assistant:`;J.DEFAULT_TIMEOUT=6e5;J.AnthropicError=X;J.APIError=le;J.APIConnectionError=rr;J.APIConnectionTimeoutError=Yo;J.APIUserAbortError=et;J.NotFoundError=nl;J.ConflictError=rl;J.RateLimitError=il;J.BadRequestError=Zo;J.AuthenticationError=el;J.InternalServerError=al;J.PermissionDeniedError=tl;J.UnprocessableEntityError=sl;J.toFile=Cu;J.fileFromPath=Qo;J.Completions=fl;J.Messages=cr;J.Models=ei;J.ModelInfosPage=ti;J.Beta=un;const cs="siyuan-ai-plugin-setting",us="siyuan-ai-plugin-prompts",Ji=atob("aHR0cHM6Ly9vbmVhcGkuZ2Vla3NwaGVyZS5vbmxpbmU=");class hl{constructor(e,t){be(this,"plugin");be(this,"name");be(this,"file");this.name=t,this.plugin=e}}class Yu extends hl{constructor(t,r){super(t,r);be(this,"prompts",[]);this.name=r??us,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this._defaultSettings()}async load(){let t=await this.plugin.loadData(this.file);return console.debug("Load Prompt Data:",t),t&&(this.prompts=t),this.plugin.data[this.name]=t,t}async save(t){return t=t??this.dump(),await this.plugin.saveData(this.file,t),this.plugin.data[this.name]=t,console.debug("Save Prompt Data:",t),t}addPrompt(t){this.prompts.push(t),this.save()}updatePrompt(t){this.prompts=this.prompts.map(r=>r.title===t.title?t:r),this.save()}deletePrompt(t){this.prompts=this.prompts.filter(r=>r.title!==t),this.save()}get(t){return this.prompts.find(r=>r.title===t)}set(t,r){this.prompts.push({title:t,content:r}),this.save()}dump(){return this.prompts}_defaultSettings(){this.prompts=[{title:"翻译、拼写纠正、改进",content:"请对以上内容进行翻译。要求：我希望你用更优美优雅的高级英语单词和句子替换我简化的 A0 级单词和句子。保持相同的意思，但使它们更文艺。你只需要翻译该内容，不必对内容中提出的问题和要求做解释，不要回答文本中的问题而是翻译它。"},{title:"提取标题",content:"请为上面这篇文章生成简洁且完整概括的标题。"},{title:"提取摘要",content:"请为上面这篇文章生成简明扼要的摘要。"},{title:"提取标签",content:"请为上面这篇文章生成标签，单个标签不超过6个字符，多个标签用英文逗号分隔，最多返回5个标签。"},{title:"提取标题1",content:"请为上面这篇文章生成简洁且完整概括的标题。"},{title:"提取摘要1",content:"请为上面这篇文章生成简明扼要的摘要。"},{title:"提取标签1",content:"请为上面这篇文章生成标签，单个标签不超过6个字符，多个标签用英文逗号分隔，最多返回5个标签。"}],this.load()}}class Zu extends hl{constructor(t,r){super(t,r);be(this,"settings",new Map);this.name=r??cs,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this._defaultSettings()}async load(){let t=await this.plugin.loadData(this.file);if(console.debug("Load Setting Config:",t),t)for(let[r,s]of this.settings)s.value=(t==null?void 0:t[r])??s.value;return this.plugin.data[this.name]=t,t}async save(t){return t=t??this.dump(),await this.plugin.saveData(this.file,t),console.debug("Save Setting Config:",t),t}get(t){return this.settings.get(t)}getValue(t){var r;return(r=this.settings.get(t))==null?void 0:r.value}getSettingItems(t){let r=[];for(let[s,i]of this.settings)t&&i.group!==t||r.push(i);return r}set(t,r){this.settings.set(t,r)}setValue(t,r){let s=this.settings.get(t);s.value=r}dump(){let t={};for(let[r,s]of this.settings)t[r]=s.value;return t}_defaultSettings(){const t={group:"🌈 设置",title:"密钥",description:'<a href="https://item.taobao.com/item.htm?ft=t&id=877591591207&spm=a21dvs.23580594.0.0.621e2c1bjqRPCl&skuId=5719376381355">密钥购买链接</a>, 售后QQ群: 710607849',type:"textinput",key:"apiKey",value:"",placeholder:"Enter your Key"};this.settings.set(t.key,t);const r={group:"🌈 设置",title:"是否使用指令面板",description:"当开启时，会在输入框下方显示保存的指令，默认为 否。",type:"checkbox",key:"isShowPrompts",value:!1};this.settings.set(r.key,r);const s={group:"custom",title:"是否替换选中文本",description:"当选中文本时，是否使用生成的内容替换选中文本。默认为 否。",type:"checkbox",key:"isReplaceSelected",value:!1};this.settings.set(s.key,s);const i={group:"custom",title:"是否获取页面文本",description:"当未选中文本使用指令模式时，是否获取当前页面的全部文本作为大模型的输入。默认为 否。",type:"checkbox",key:"isPageContent",value:!1};this.settings.set(i.key,i);const a={group:"custom",title:"温度",description:"温度值越小，模型生成的内容越准确。温度值越高，模型生成内容越多样。默认为 1.0。",type:"slider",key:"temperature",slider:{min:0,max:2,step:.1},value:1};this.settings.set(a.key,a);const o={group:"custom",title:"最大长度",description:"输出文本的最大长度,默认为 4k。",type:"number",key:"maxOutputLength",value:4e3};this.settings.set(o.key,o);const l={group:"custom",title:"请求超时时间",description:"发起请求的超时时间，超过该时间，取消请求，单位：秒。默认为 90 秒。",type:"number",key:"responseTimeout",value:90};this.settings.set(l.key,l);const c={group:"model",title:"模型",description:"选择模型",type:"select",key:"modelSelections",value:"deepseek-chat",options:{"deepseek-chat":"DeepSeek Chat","deepseek-reasoner":"DeepSeek Reasoner","qwen-turbo-latest":"Qwen Turbo","qwen-plus-latest":"Qwen Plus","qwen-max-latest":"Qwen Max","gpt-4o":"GPT 4o","gpt-4o-mini":"GPT 4o mini","gpt-4-turbo":"GPT 4 Turbo","claude-3-5-haiku-20241022":"Claude 3.5 Haiku","claude-3-5-sonnet-latest":"Claude 3.5 Sonnet","claude-3-opus-latest":"Claude 3 Opus"}};this.settings.set(c.key,c),this.load()}}function Jn(n,{delay:e=0,duration:t=400,easing:r=Aa}={}){const s=+getComputedStyle(n).opacity;return{delay:e,duration:t,easing:r,css:i=>`opacity: ${i*s}`}}function Xi(n){let e;return{c(){e=R("div"),e.innerHTML='<span style="color: var(--b3-theme-primary);">生成中...</span>',v(e,"width","100%"),v(e,"text-align","center"),v(e,"border-top","1px solid var(--b3-border-color)")},m(t,r){H(t,e,r)},d(t){t&&j(e)}}}function ef(n){let e,t,r,s,i,a,o=n[2]&&Xi();return{c(){e=R("div"),t=R("div"),r=ue(n[1]),s=T(),o&&o.c(),v(t,"max-height","250px"),v(t,"overflow-y","auto"),v(t,"margin-top","10px"),v(t,"white-space","pre-wrap"),v(t,"line-height","1.3"),v(t,"scrollbar-width","thin"),v(e,"width","94%"),v(e,"padding","3%"),v(e,"align-self","center"),v(e,"background","var(--b3-card-background)")},m(l,c){H(l,e,c),y(e,t),y(t,r),n[3](t),y(e,s),o&&o.m(e,null),a=!0},p(l,[c]){(!a||c&2)&&De(r,l[1]),l[2]?o||(o=Xi(),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i(l){a||(l&&at(()=>{a&&(i||(i=$n(e,Jn,{duration:200},!0)),i.run(1))}),a=!0)},o(l){l&&(i||(i=$n(e,Jn,{duration:200},!1)),i.run(0)),a=!1},d(l){l&&j(e),n[3](null),o&&o.d(),l&&i&&i.end()}}}function tf(n,e,t){let{outputContent:r}=e,{isGenerating:s}=e,{outputContainer:i}=e;function a(o){se[o?"unshift":"push"](()=>{i=o,t(0,i)})}return n.$$set=o=>{"outputContent"in o&&t(1,r=o.outputContent),"isGenerating"in o&&t(2,s=o.isGenerating),"outputContainer"in o&&t(0,i=o.outputContainer)},[i,r,s,a]}class nf extends he{constructor(e){super(),de(this,e,tf,ef,fe,{outputContent:1,isGenerating:2,outputContainer:0})}}function zi(n,e,t){const r=n.slice();return r[0]=e[t][0],r[18]=e[t][1],r}function rf(n){let e,t,r,s,i,a,o;return{c(){e=R("div"),t=R("input"),A(t,"id","fontSize"),A(t,"min",r=n[5].min),A(t,"max",s=n[5].max),A(t,"step",i=n[5].step),A(t,"type","range"),A(t,"style",n[8]),K(t,"b3-slider",!0),K(t,"fn__size200",n[7]),A(e,"class","b3-tooltips b3-tooltips__n"),A(e,"aria-label",n[0])},m(l,c){H(l,e,c),y(e,t),Ce(t,n[0]),a||(o=[V(t,"change",n[16]),V(t,"input",n[16]),V(t,"change",n[10])],a=!0)},p(l,c){c&32&&r!==(r=l[5].min)&&A(t,"min",r),c&32&&s!==(s=l[5].max)&&A(t,"max",s),c&32&&i!==(i=l[5].step)&&A(t,"step",i),c&256&&A(t,"style",l[8]),c&17&&Ce(t,l[0]),c&128&&K(t,"fn__size200",l[7]),c&17&&A(e,"aria-label",l[0])},d(l){l&&j(e),a=!1,ce(o)}}}function sf(n){let e,t,r,s=Xe(Object.entries(n[4])),i=[];for(let a=0;a<s.length;a+=1)i[a]=Ki(zi(n,s,a));return{c(){e=R("select");for(let a=0;a<i.length;a+=1)i[a].c();A(e,"id","iconPosition"),A(e,"style",n[8]),n[0]===void 0&&at(()=>n[15].call(e)),K(e,"b3-select",!0),K(e,"fn__flex-center",!0),K(e,"fn__size200",n[7])},m(a,o){H(a,e,o);for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(e,null);mi(e,n[0],!0),t||(r=[V(e,"change",n[15]),V(e,"change",n[10])],t=!0)},p(a,o){if(o&16){s=Xe(Object.entries(a[4]));let l;for(l=0;l<s.length;l+=1){const c=zi(a,s,l);i[l]?i[l].p(c,o):(i[l]=Ki(c),i[l].c(),i[l].m(e,null))}for(;l<i.length;l+=1)i[l].d(1);i.length=s.length}o&256&&A(e,"style",a[8]),o&17&&mi(e,a[0]),o&128&&K(e,"fn__size200",a[7])},d(a){a&&j(e),va(i,a),t=!1,ce(r)}}}function af(n){let e,t=n[6].label+"",r,s,i;return{c(){e=R("button"),r=ue(t),A(e,"id",n[2]),A(e,"style",n[8]),K(e,"b3-button",!0),K(e,"b3-button--outline",!0),K(e,"fn__flex-center",!0),K(e,"fn__size200",n[7])},m(a,o){H(a,e,o),y(e,r),s||(i=V(e,"click",n[9]),s=!0)},p(a,o){o&64&&t!==(t=a[6].label+"")&&De(r,t),o&4&&A(e,"id",a[2]),o&256&&A(e,"style",a[8]),o&128&&K(e,"fn__size200",a[7])},d(a){a&&j(e),s=!1,i()}}}function of(n){let e,t,r;return{c(){e=R("input"),A(e,"id",n[2]),A(e,"type","number"),A(e,"style",n[8]),K(e,"b3-text-field",!0),K(e,"fn__flex-center",!0),K(e,"fn__size200",n[7])},m(s,i){H(s,e,i),Ce(e,n[0]),t||(r=[V(e,"input",n[14]),V(e,"change",n[10])],t=!0)},p(s,i){i&4&&A(e,"id",s[2]),i&256&&A(e,"style",s[8]),i&17&&Wr(e.value)!==s[0]&&Ce(e,s[0]),i&128&&K(e,"fn__size200",s[7])},d(s){s&&j(e),t=!1,ce(r)}}}function lf(n){let e,t,r,s;return{c(){e=R("textarea"),A(e,"class","b3-text-field fn__block"),A(e,"style",t=`resize: vertical; height: 10em; white-space: nowrap; ${n[8]}`)},m(i,a){H(i,e,a),Ce(e,n[0]),r||(s=[V(e,"input",n[13]),V(e,"change",n[10])],r=!0)},p(i,a){a&256&&t!==(t=`resize: vertical; height: 10em; white-space: nowrap; ${i[8]}`)&&A(e,"style",t),a&17&&Ce(e,i[0])},d(i){i&&j(e),r=!1,ce(s)}}}function cf(n){let e,t,r;return{c(){e=R("input"),A(e,"id",n[2]),A(e,"placeholder",n[3]),A(e,"style",n[8]),K(e,"b3-text-field",!0),K(e,"fn__flex-center",!0),K(e,"fn__size200",n[7])},m(s,i){H(s,e,i),Ce(e,n[0]),t||(r=[V(e,"input",n[12]),V(e,"change",n[10])],t=!0)},p(s,i){i&4&&A(e,"id",s[2]),i&8&&A(e,"placeholder",s[3]),i&256&&A(e,"style",s[8]),i&17&&e.value!==s[0]&&Ce(e,s[0]),i&128&&K(e,"fn__size200",s[7])},d(s){s&&j(e),t=!1,ce(r)}}}function uf(n){let e,t,r;return{c(){e=R("input"),A(e,"class","b3-switch fn__flex-center"),A(e,"id",n[2]),A(e,"type","checkbox"),A(e,"style",n[8])},m(s,i){H(s,e,i),e.checked=n[0],t||(r=[V(e,"change",n[11]),V(e,"change",n[10])],t=!0)},p(s,i){i&4&&A(e,"id",s[2]),i&256&&A(e,"style",s[8]),i&17&&(e.checked=s[0])},d(s){s&&j(e),t=!1,ce(r)}}}function Ki(n){let e,t=n[18]+"",r,s;return{c(){e=R("option"),r=ue(t),e.__value=s=n[0],Ce(e,e.__value)},m(i,a){H(i,e,a),y(e,r)},p(i,a){a&16&&t!==(t=i[18]+"")&&De(r,t),a&16&&s!==(s=i[0])&&(e.__value=s,Ce(e,e.__value))},d(i){i&&j(e)}}}function ff(n){let e;function t(i,a){if(i[1]==="checkbox")return uf;if(i[1]==="textinput")return cf;if(i[1]==="textarea")return lf;if(i[1]==="number")return of;if(i[1]==="button")return af;if(i[1]==="select")return sf;if(i[1]=="slider")return rf}let r=t(n),s=r&&r(n);return{c(){s&&s.c(),e=Es()},m(i,a){s&&s.m(i,a),H(i,e,a)},p(i,[a]){r===(r=t(i))&&s?s.p(i,a):(s&&s.d(1),s=r&&r(i),s&&(s.c(),s.m(e.parentNode,e)))},i:ie,o:ie,d(i){i&&j(e),s&&s.d(i)}}}function df(n,e,t){let{type:r}=e,{key:s}=e,{value:i}=e,{placeholder:a=""}=e,{options:o={}}=e,{slider:l={min:0,max:100,step:1}}=e,{button:c={label:i,callback:()=>{}}}=e,{fnSize:f=!0}=e,{style:u=""}=e;const h=Yn();function m(){c==null||c.callback(),h("click",{key:s})}function d(){h("changed",{key:s,value:i})}function _(){i=this.checked,t(0,i),t(4,o)}function g(){i=this.value,t(0,i),t(4,o)}function P(){i=this.value,t(0,i),t(4,o)}function p(){i=Wr(this.value),t(0,i),t(4,o)}function E(){i=nc(this),t(0,i),t(4,o)}function b(){i=Wr(this.value),t(0,i),t(4,o)}return n.$$set=S=>{"type"in S&&t(1,r=S.type),"key"in S&&t(2,s=S.key),"value"in S&&t(0,i=S.value),"placeholder"in S&&t(3,a=S.placeholder),"options"in S&&t(4,o=S.options),"slider"in S&&t(5,l=S.slider),"button"in S&&t(6,c=S.button),"fnSize"in S&&t(7,f=S.fnSize),"style"in S&&t(8,u=S.style)},[i,r,s,a,o,l,c,f,u,m,d,_,g,P,p,E,b]}class Xn extends he{constructor(e){super(),de(this,e,df,ff,fe,{type:1,key:2,value:0,placeholder:3,options:4,slider:5,button:6,fnSize:7,style:8})}}function hf(n){let e,t,r,s,i,a,o,l,c,f,u,h,m;function d(g){n[12](g)}let _={type:"select",key:"modelSelections",fnSize:!1,options:n[4].get("modelSelections").options,style:"margin-right: 5px;font-size: 12px; padding: 2px 4px; border-radius: 4px; border: 1px solid #ddd; height: 2em; background: transparent;"};return n[2]!==void 0&&(_.value=n[2]),s=new Xn({props:_}),se.push(()=>Pe(s,"value",d)),s.$on("changed",n[13]),{c(){e=R("div"),t=R("input"),r=T(),Y(s.$$.fragment),a=T(),o=R("button"),o.textContent="超参数",l=T(),c=R("button"),c.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" class="svelte-1x8hi4t"></path></svg>',A(t,"type","text"),A(t,"placeholder","输入 AI 指令... "),A(t,"class",".b3-text-field fn__block fn__flex-center"),v(t,"width","calc(100% - 120px)"),v(t,"height","3em"),v(t,"white-space","normal"),v(t,"background","transparent"),v(t,"border","0"),v(t,"outline","none"),v(t,"margin-left","0.5em"),A(o,"type","button"),A(o,"class","ai-instruction-params-button svelte-1x8hi4t"),v(o,"font-size","12px"),v(o,"color","#666"),v(o,"text-decoration","none"),v(o,"background","none"),v(o,"border","none"),v(o,"padding","0"),v(o,"cursor","pointer"),v(o,"margin-right","35px"),v(o,"white-space","nowrap"),A(c,"type","button"),A(c,"class","ai-instruction-submit-button svelte-1x8hi4t"),v(c,"position","absolute"),v(c,"right","10px"),v(c,"top","50%"),v(c,"transform","translateY(-50%)"),v(c,"opacity","0.6"),v(c,"cursor","pointer"),v(c,"background","none"),v(c,"border","none"),v(c,"padding","0"),v(e,"width","100%"),v(e,"height","100%"),v(e,"display","flex"),v(e,"position","relative"),v(e,"align-items","center")},m(g,P){H(g,e,P),y(e,t),n[8](t),Ce(t,n[0]),y(e,r),G(s,e,null),y(e,a),y(e,o),y(e,l),y(e,c),u=!0,h||(m=[V(t,"input",n[9]),V(t,"keydown",function(){bt(n[6])&&n[6].apply(this,arguments)}),V(t,"focus",n[10]),V(t,"blur",n[11]),V(o,"click",n[14]),V(c,"click",function(){bt(n[5])&&n[5].apply(this,arguments)}),V(c,"keydown",function(){bt(n[6])&&n[6].apply(this,arguments)})],h=!0)},p(g,[P]){n=g,P&1&&t.value!==n[0]&&Ce(t,n[0]);const p={};P&16&&(p.options=n[4].get("modelSelections").options),!i&&P&4&&(i=!0,p.value=n[2],Ae(()=>i=!1)),s.$set(p)},i(g){u||(F(s.$$.fragment,g),g&&at(()=>{u&&(f||(f=$n(e,Jn,{duration:200},!0)),f.run(1))}),u=!0)},o(g){L(s.$$.fragment,g),g&&(f||(f=$n(e,Jn,{duration:200},!1)),f.run(0)),u=!1},d(g){g&&j(e),n[8](null),Q(s),g&&f&&f.end(),h=!1,ce(m)}}}function mf(n,e,t){let{inputValue:r}=e,{inputElement:s}=e,{selectedModel:i}=e,{settingStorage:a}=e,{showParams:o}=e,{handleSubmit:l}=e,{handleKeydown:c}=e,f=!1;function u(p){se[p?"unshift":"push"](()=>{s=p,t(1,s)})}function h(){r=this.value,t(0,r)}const m=()=>t(7,f=!0),d=()=>t(7,f=!1);function _(p){i=p,t(2,i)}const g=({detail:p})=>{a.setValue(p.key,p.value),a.save()},P=()=>{t(3,o=!o),o||a.save()};return n.$$set=p=>{"inputValue"in p&&t(0,r=p.inputValue),"inputElement"in p&&t(1,s=p.inputElement),"selectedModel"in p&&t(2,i=p.selectedModel),"settingStorage"in p&&t(4,a=p.settingStorage),"showParams"in p&&t(3,o=p.showParams),"handleSubmit"in p&&t(5,l=p.handleSubmit),"handleKeydown"in p&&t(6,c=p.handleKeydown)},[r,s,i,o,a,l,c,f,u,h,m,d,_,g,P]}class pf extends he{constructor(e){super(),de(this,e,mf,hf,fe,{inputValue:0,inputElement:1,selectedModel:2,settingStorage:4,showParams:3,handleSubmit:5,handleKeydown:6})}}function gf(n){let e,t,r,s,i,a,o=zn(n[1],n[3])+"",l,c,f,u;const h=n[5].default,m=_s(h,n,n[4],null);return{c(){e=R("div"),t=R("div"),r=R("span"),s=ue(n[0]),i=T(),a=R("div"),l=T(),c=R("span"),f=T(),m&&m.c(),A(r,"class","title svelte-ikiu6h"),A(a,"class","b3-label__text"),A(t,"class","fn__flex-1"),A(c,"class","fn__space"),A(e,"class","item-wrap fn__flex b3-label config__item svelte-ikiu6h")},m(d,_){H(d,e,_),y(e,t),y(t,r),y(r,s),y(t,i),y(t,a),a.innerHTML=o,y(e,l),y(e,c),y(e,f),m&&m.m(e,null),u=!0},p(d,_){(!u||_&1)&&De(s,d[0]),(!u||_&10)&&o!==(o=zn(d[1],d[3])+"")&&(a.innerHTML=o),m&&m.p&&(!u||_&16)&&ws(m,h,d,d[4],u?ys(h,d[4],_,null):bs(d[4]),null)},i(d){u||(F(m,d),u=!0)},o(d){L(m,d),u=!1},d(d){d&&j(e),m&&m.d(d)}}}function _f(n){let e,t,r,s,i,a,o=zn(n[1],n[3])+"",l,c,f,u,h;const m=n[5].default,d=_s(m,n,n[4],null);return{c(){e=R("div"),t=R("div"),r=R("span"),s=ue(n[0]),i=T(),a=R("div"),l=T(),c=R("div"),f=T(),u=R("div"),d&&d.c(),A(r,"class","title svelte-ikiu6h"),A(a,"class","b3-label__text"),A(c,"class","fn__hr"),v(u,"display","flex"),v(u,"flex-direction","column"),v(u,"gap","5px"),v(u,"position","relative"),A(t,"class","fn__block"),A(e,"class","item-wrap b3-label svelte-ikiu6h"),A(e,"data-key","CustomCSS")},m(_,g){H(_,e,g),y(e,t),y(t,r),y(r,s),y(t,i),y(t,a),a.innerHTML=o,y(t,l),y(t,c),y(t,f),y(t,u),d&&d.m(u,null),h=!0},p(_,g){(!h||g&1)&&De(s,_[0]),(!h||g&10)&&o!==(o=zn(_[1],_[3])+"")&&(a.innerHTML=o),d&&d.p&&(!h||g&16)&&ws(d,m,_,_[4],h?ys(m,_[4],g,null):bs(_[4]),null)},i(_){h||(F(d,_),h=!0)},o(_){L(d,_),h=!1},d(_){_&&j(e),d&&d.d(_)}}}function yf(n){let e,t,r,s;const i=[_f,gf],a=[];function o(l,c){return l[2]==="row"?0:1}return e=o(n),t=a[e]=i[e](n),{c(){t.c(),r=Es()},m(l,c){a[e].m(l,c),H(l,r,c),s=!0},p(l,[c]){let f=e;e=o(l),e===f?a[e].p(l,c):(rt(),L(a[f],1,1,()=>{a[f]=null}),st(),t=a[e],t?t.p(l,c):(t=a[e]=i[e](l),t.c()),F(t,1),t.m(r.parentNode,r))},i(l){s||(F(t),s=!0)},o(l){L(t),s=!1},d(l){l&&j(r),a[e].d(l)}}}function zn(n,e=!1){return e&&n.length>20?n.slice(0,20)+"...":n}function wf(n,e,t){let{$$slots:r={},$$scope:s}=e,{title:i}=e,{description:a}=e,{direction:o="column"}=e,{isSimple:l=!1}=e;return n.$$set=c=>{"title"in c&&t(0,i=c.title),"description"in c&&t(1,a=c.description),"direction"in c&&t(2,o=c.direction),"isSimple"in c&&t(3,l=c.isSimple),"$$scope"in c&&t(4,s=c.$$scope)},[i,a,o,l,s,r]}class bf extends he{constructor(e){super(),de(this,e,wf,yf,fe,{title:0,description:1,direction:2,isSimple:3})}}const ml={Wrap:bf,Input:Xn};function pl(n,e){return function(){return n.apply(e,arguments)}}const{toString:Sf}=Object.prototype,{getPrototypeOf:ni}=Object,ur=(n=>e=>{const t=Sf.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Ie=n=>(n=n.toLowerCase(),e=>ur(e)===n),fr=n=>e=>typeof e===n,{isArray:Tt}=Array,nn=fr("undefined");function Ef(n){return n!==null&&!nn(n)&&n.constructor!==null&&!nn(n.constructor)&&Re(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const gl=Ie("ArrayBuffer");function Af(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&gl(n.buffer),e}const Pf=fr("string"),Re=fr("function"),_l=fr("number"),dr=n=>n!==null&&typeof n=="object",Rf=n=>n===!0||n===!1,In=n=>{if(ur(n)!=="object")return!1;const e=ni(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},kf=Ie("Date"),Cf=Ie("File"),xf=Ie("Blob"),vf=Ie("FileList"),Of=n=>dr(n)&&Re(n.pipe),Tf=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Re(n.append)&&((e=ur(n))==="formdata"||e==="object"&&Re(n.toString)&&n.toString()==="[object FormData]"))},Mf=Ie("URLSearchParams"),[If,Nf,Ff,Bf]=["ReadableStream","Request","Response","Headers"].map(Ie),Lf=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function fn(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,s;if(typeof n!="object"&&(n=[n]),Tt(n))for(r=0,s=n.length;r<s;r++)e.call(null,n[r],r,n);else{const i=t?Object.getOwnPropertyNames(n):Object.keys(n),a=i.length;let o;for(r=0;r<a;r++)o=i[r],e.call(null,n[o],o,n)}}function yl(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,s;for(;r-- >0;)if(s=t[r],e===s.toLowerCase())return s;return null}const nt=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,wl=n=>!nn(n)&&n!==nt;function fs(){const{caseless:n}=wl(this)&&this||{},e={},t=(r,s)=>{const i=n&&yl(e,s)||s;In(e[i])&&In(r)?e[i]=fs(e[i],r):In(r)?e[i]=fs({},r):Tt(r)?e[i]=r.slice():e[i]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&fn(arguments[r],t);return e}const Df=(n,e,t,{allOwnKeys:r}={})=>(fn(e,(s,i)=>{t&&Re(s)?n[i]=pl(s,t):n[i]=s},{allOwnKeys:r}),n),$f=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Uf=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},jf=(n,e,t,r)=>{let s,i,a;const o={};if(e=e||{},n==null)return e;do{for(s=Object.getOwnPropertyNames(n),i=s.length;i-- >0;)a=s[i],(!r||r(a,n,e))&&!o[a]&&(e[a]=n[a],o[a]=!0);n=t!==!1&&ni(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},qf=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},Hf=n=>{if(!n)return null;if(Tt(n))return n;let e=n.length;if(!_l(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},Wf=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&ni(Uint8Array)),Vf=(n,e)=>{const r=(n&&n[Symbol.iterator]).call(n);let s;for(;(s=r.next())&&!s.done;){const i=s.value;e.call(n,i[0],i[1])}},Jf=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},Xf=Ie("HTMLFormElement"),zf=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,s){return r.toUpperCase()+s}),Gi=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),Kf=Ie("RegExp"),bl=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};fn(t,(s,i)=>{let a;(a=e(s,i,n))!==!1&&(r[i]=a||s)}),Object.defineProperties(n,r)},Gf=n=>{bl(n,(e,t)=>{if(Re(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(Re(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Qf=(n,e)=>{const t={},r=s=>{s.forEach(i=>{t[i]=!0})};return Tt(n)?r(n):r(String(n).split(e)),t},Yf=()=>{},Zf=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e,Ur="abcdefghijklmnopqrstuvwxyz",Qi="0123456789",Sl={DIGIT:Qi,ALPHA:Ur,ALPHA_DIGIT:Ur+Ur.toUpperCase()+Qi},ed=(n=16,e=Sl.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function td(n){return!!(n&&Re(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const nd=n=>{const e=new Array(10),t=(r,s)=>{if(dr(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const i=Tt(r)?[]:{};return fn(r,(a,o)=>{const l=t(a,s+1);!nn(l)&&(i[o]=l)}),e[s]=void 0,i}}return r};return t(n,0)},rd=Ie("AsyncFunction"),sd=n=>n&&(dr(n)||Re(n))&&Re(n.then)&&Re(n.catch),El=((n,e)=>n?setImmediate:e?((t,r)=>(nt.addEventListener("message",({source:s,data:i})=>{s===nt&&i===t&&r.length&&r.shift()()},!1),s=>{r.push(s),nt.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Re(nt.postMessage)),id=typeof queueMicrotask<"u"?queueMicrotask.bind(nt):typeof process<"u"&&process.nextTick||El,w={isArray:Tt,isArrayBuffer:gl,isBuffer:Ef,isFormData:Tf,isArrayBufferView:Af,isString:Pf,isNumber:_l,isBoolean:Rf,isObject:dr,isPlainObject:In,isReadableStream:If,isRequest:Nf,isResponse:Ff,isHeaders:Bf,isUndefined:nn,isDate:kf,isFile:Cf,isBlob:xf,isRegExp:Kf,isFunction:Re,isStream:Of,isURLSearchParams:Mf,isTypedArray:Wf,isFileList:vf,forEach:fn,merge:fs,extend:Df,trim:Lf,stripBOM:$f,inherits:Uf,toFlatObject:jf,kindOf:ur,kindOfTest:Ie,endsWith:qf,toArray:Hf,forEachEntry:Vf,matchAll:Jf,isHTMLForm:Xf,hasOwnProperty:Gi,hasOwnProp:Gi,reduceDescriptors:bl,freezeMethods:Gf,toObjectSet:Qf,toCamelCase:zf,noop:Yf,toFiniteNumber:Zf,findKey:yl,global:nt,isContextDefined:wl,ALPHABET:Sl,generateString:ed,isSpecCompliantForm:td,toJSONObject:nd,isAsyncFn:rd,isThenable:sd,setImmediate:El,asap:id};function B(n,e,t,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}w.inherits(B,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:w.toJSONObject(this.config),code:this.code,status:this.status}}});const Al=B.prototype,Pl={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Pl[n]={value:n}});Object.defineProperties(B,Pl);Object.defineProperty(Al,"isAxiosError",{value:!0});B.from=(n,e,t,r,s,i)=>{const a=Object.create(Al);return w.toFlatObject(n,a,function(l){return l!==Error.prototype},o=>o!=="isAxiosError"),B.call(a,n.message,e,t,r,s),a.cause=n,a.name=n.name,i&&Object.assign(a,i),a};const ad=null;function ds(n){return w.isPlainObject(n)||w.isArray(n)}function Rl(n){return w.endsWith(n,"[]")?n.slice(0,-2):n}function Yi(n,e,t){return n?n.concat(e).map(function(s,i){return s=Rl(s),!t&&i?"["+s+"]":s}).join(t?".":""):e}function od(n){return w.isArray(n)&&!n.some(ds)}const ld=w.toFlatObject(w,{},null,function(e){return/^is[A-Z]/.test(e)});function hr(n,e,t){if(!w.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=w.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_,g){return!w.isUndefined(g[_])});const r=t.metaTokens,s=t.visitor||f,i=t.dots,a=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&w.isSpecCompliantForm(e);if(!w.isFunction(s))throw new TypeError("visitor must be a function");function c(d){if(d===null)return"";if(w.isDate(d))return d.toISOString();if(!l&&w.isBlob(d))throw new B("Blob is not supported. Use a Buffer instead.");return w.isArrayBuffer(d)||w.isTypedArray(d)?l&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function f(d,_,g){let P=d;if(d&&!g&&typeof d=="object"){if(w.endsWith(_,"{}"))_=r?_:_.slice(0,-2),d=JSON.stringify(d);else if(w.isArray(d)&&od(d)||(w.isFileList(d)||w.endsWith(_,"[]"))&&(P=w.toArray(d)))return _=Rl(_),P.forEach(function(E,b){!(w.isUndefined(E)||E===null)&&e.append(a===!0?Yi([_],b,i):a===null?_:_+"[]",c(E))}),!1}return ds(d)?!0:(e.append(Yi(g,_,i),c(d)),!1)}const u=[],h=Object.assign(ld,{defaultVisitor:f,convertValue:c,isVisitable:ds});function m(d,_){if(!w.isUndefined(d)){if(u.indexOf(d)!==-1)throw Error("Circular reference detected in "+_.join("."));u.push(d),w.forEach(d,function(P,p){(!(w.isUndefined(P)||P===null)&&s.call(e,P,w.isString(p)?p.trim():p,_,h))===!0&&m(P,_?_.concat(p):[p])}),u.pop()}}if(!w.isObject(n))throw new TypeError("data must be an object");return m(n),e}function Zi(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function ri(n,e){this._pairs=[],n&&hr(n,this,e)}const kl=ri.prototype;kl.append=function(e,t){this._pairs.push([e,t])};kl.toString=function(e){const t=e?function(r){return e.call(this,r,Zi)}:Zi;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};function cd(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Cl(n,e,t){if(!e)return n;const r=t&&t.encode||cd;w.isFunction(t)&&(t={serialize:t});const s=t&&t.serialize;let i;if(s?i=s(e,t):i=w.isURLSearchParams(e)?e.toString():new ri(e,t).toString(r),i){const a=n.indexOf("#");a!==-1&&(n=n.slice(0,a)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n}class ea{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){w.forEach(this.handlers,function(r){r!==null&&e(r)})}}const xl={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ud=typeof URLSearchParams<"u"?URLSearchParams:ri,fd=typeof FormData<"u"?FormData:null,dd=typeof Blob<"u"?Blob:null,hd={isBrowser:!0,classes:{URLSearchParams:ud,FormData:fd,Blob:dd},protocols:["http","https","file","blob","url","data"]},si=typeof window<"u"&&typeof document<"u",hs=typeof navigator=="object"&&navigator||void 0,md=si&&(!hs||["ReactNative","NativeScript","NS"].indexOf(hs.product)<0),pd=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",gd=si&&window.location.href||"http://localhost",_d=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:si,hasStandardBrowserEnv:md,hasStandardBrowserWebWorkerEnv:pd,navigator:hs,origin:gd},Symbol.toStringTag,{value:"Module"})),oe={..._d,...hd};function yd(n,e){return hr(n,new oe.classes.URLSearchParams,Object.assign({visitor:function(t,r,s,i){return oe.isNode&&w.isBuffer(t)?(this.append(r,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function wd(n){return w.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function bd(n){const e={},t=Object.keys(n);let r;const s=t.length;let i;for(r=0;r<s;r++)i=t[r],e[i]=n[i];return e}function vl(n){function e(t,r,s,i){let a=t[i++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),l=i>=t.length;return a=!a&&w.isArray(s)?s.length:a,l?(w.hasOwnProp(s,a)?s[a]=[s[a],r]:s[a]=r,!o):((!s[a]||!w.isObject(s[a]))&&(s[a]=[]),e(t,r,s[a],i)&&w.isArray(s[a])&&(s[a]=bd(s[a])),!o)}if(w.isFormData(n)&&w.isFunction(n.entries)){const t={};return w.forEachEntry(n,(r,s)=>{e(wd(r),s,t,0)}),t}return null}function Sd(n,e,t){if(w.isString(n))try{return(e||JSON.parse)(n),w.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(0,JSON.stringify)(n)}const dn={transitional:xl,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",s=r.indexOf("application/json")>-1,i=w.isObject(e);if(i&&w.isHTMLForm(e)&&(e=new FormData(e)),w.isFormData(e))return s?JSON.stringify(vl(e)):e;if(w.isArrayBuffer(e)||w.isBuffer(e)||w.isStream(e)||w.isFile(e)||w.isBlob(e)||w.isReadableStream(e))return e;if(w.isArrayBufferView(e))return e.buffer;if(w.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return yd(e,this.formSerializer).toString();if((o=w.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return hr(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return i||s?(t.setContentType("application/json",!1),Sd(e)):e}],transformResponse:[function(e){const t=this.transitional||dn.transitional,r=t&&t.forcedJSONParsing,s=this.responseType==="json";if(w.isResponse(e)||w.isReadableStream(e))return e;if(e&&w.isString(e)&&(r&&!this.responseType||s)){const a=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?B.from(o,B.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:oe.classes.FormData,Blob:oe.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};w.forEach(["delete","get","head","post","put","patch"],n=>{dn.headers[n]={}});const Ed=w.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ad=n=>{const e={};let t,r,s;return n&&n.split(`
`).forEach(function(a){s=a.indexOf(":"),t=a.substring(0,s).trim().toLowerCase(),r=a.substring(s+1).trim(),!(!t||e[t]&&Ed[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},ta=Symbol("internals");function Ut(n){return n&&String(n).trim().toLowerCase()}function Nn(n){return n===!1||n==null?n:w.isArray(n)?n.map(Nn):String(n)}function Pd(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const Rd=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function jr(n,e,t,r,s){if(w.isFunction(r))return r.call(this,e,t);if(s&&(e=t),!!w.isString(e)){if(w.isString(r))return e.indexOf(r)!==-1;if(w.isRegExp(r))return r.test(e)}}function kd(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function Cd(n,e){const t=w.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(s,i,a){return this[r].call(this,e,s,i,a)},configurable:!0})})}class ge{constructor(e){e&&this.set(e)}set(e,t,r){const s=this;function i(o,l,c){const f=Ut(l);if(!f)throw new Error("header name must be a non-empty string");const u=w.findKey(s,f);(!u||s[u]===void 0||c===!0||c===void 0&&s[u]!==!1)&&(s[u||l]=Nn(o))}const a=(o,l)=>w.forEach(o,(c,f)=>i(c,f,l));if(w.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(w.isString(e)&&(e=e.trim())&&!Rd(e))a(Ad(e),t);else if(w.isHeaders(e))for(const[o,l]of e.entries())i(l,o,r);else e!=null&&i(t,e,r);return this}get(e,t){if(e=Ut(e),e){const r=w.findKey(this,e);if(r){const s=this[r];if(!t)return s;if(t===!0)return Pd(s);if(w.isFunction(t))return t.call(this,s,r);if(w.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ut(e),e){const r=w.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||jr(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let s=!1;function i(a){if(a=Ut(a),a){const o=w.findKey(r,a);o&&(!t||jr(r,r[o],o,t))&&(delete r[o],s=!0)}}return w.isArray(e)?e.forEach(i):i(e),s}clear(e){const t=Object.keys(this);let r=t.length,s=!1;for(;r--;){const i=t[r];(!e||jr(this,this[i],i,e,!0))&&(delete this[i],s=!0)}return s}normalize(e){const t=this,r={};return w.forEach(this,(s,i)=>{const a=w.findKey(r,i);if(a){t[a]=Nn(s),delete t[i];return}const o=e?kd(i):String(i).trim();o!==i&&delete t[i],t[o]=Nn(s),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return w.forEach(this,(r,s)=>{r!=null&&r!==!1&&(t[s]=e&&w.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[ta]=this[ta]={accessors:{}}).accessors,s=this.prototype;function i(a){const o=Ut(a);r[o]||(Cd(s,a),r[o]=!0)}return w.isArray(e)?e.forEach(i):i(e),this}}ge.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);w.reduceDescriptors(ge.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});w.freezeMethods(ge);function qr(n,e){const t=this||dn,r=e||t,s=ge.from(r.headers);let i=r.data;return w.forEach(n,function(o){i=o.call(t,i,s.normalize(),e?e.status:void 0)}),s.normalize(),i}function Ol(n){return!!(n&&n.__CANCEL__)}function Mt(n,e,t){B.call(this,n??"canceled",B.ERR_CANCELED,e,t),this.name="CanceledError"}w.inherits(Mt,B,{__CANCEL__:!0});function Tl(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new B("Request failed with status code "+t.status,[B.ERR_BAD_REQUEST,B.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function xd(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function vd(n,e){n=n||10;const t=new Array(n),r=new Array(n);let s=0,i=0,a;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),f=r[i];a||(a=c),t[s]=l,r[s]=c;let u=i,h=0;for(;u!==s;)h+=t[u++],u=u%n;if(s=(s+1)%n,s===i&&(i=(i+1)%n),c-a<e)return;const m=f&&c-f;return m?Math.round(h*1e3/m):void 0}}function Od(n,e){let t=0,r=1e3/e,s,i;const a=(c,f=Date.now())=>{t=f,s=null,i&&(clearTimeout(i),i=null),n.apply(null,c)};return[(...c)=>{const f=Date.now(),u=f-t;u>=r?a(c,f):(s=c,i||(i=setTimeout(()=>{i=null,a(s)},r-u)))},()=>s&&a(s)]}const Kn=(n,e,t=3)=>{let r=0;const s=vd(50,250);return Od(i=>{const a=i.loaded,o=i.lengthComputable?i.total:void 0,l=a-r,c=s(l),f=a<=o;r=a;const u={loaded:a,total:o,progress:o?a/o:void 0,bytes:l,rate:c||void 0,estimated:c&&o&&f?(o-a)/c:void 0,event:i,lengthComputable:o!=null,[e?"download":"upload"]:!0};n(u)},t)},na=(n,e)=>{const t=n!=null;return[r=>e[0]({lengthComputable:t,total:n,loaded:r}),e[1]]},ra=n=>(...e)=>w.asap(()=>n(...e)),Td=oe.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,oe.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(oe.origin),oe.navigator&&/(msie|trident)/i.test(oe.navigator.userAgent)):()=>!0,Md=oe.hasStandardBrowserEnv?{write(n,e,t,r,s,i){const a=[n+"="+encodeURIComponent(e)];w.isNumber(t)&&a.push("expires="+new Date(t).toGMTString()),w.isString(r)&&a.push("path="+r),w.isString(s)&&a.push("domain="+s),i===!0&&a.push("secure"),document.cookie=a.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Id(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Nd(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Ml(n,e){return n&&!Id(e)?Nd(n,e):e}const sa=n=>n instanceof ge?{...n}:n;function ot(n,e){e=e||{};const t={};function r(c,f,u,h){return w.isPlainObject(c)&&w.isPlainObject(f)?w.merge.call({caseless:h},c,f):w.isPlainObject(f)?w.merge({},f):w.isArray(f)?f.slice():f}function s(c,f,u,h){if(w.isUndefined(f)){if(!w.isUndefined(c))return r(void 0,c,u,h)}else return r(c,f,u,h)}function i(c,f){if(!w.isUndefined(f))return r(void 0,f)}function a(c,f){if(w.isUndefined(f)){if(!w.isUndefined(c))return r(void 0,c)}else return r(void 0,f)}function o(c,f,u){if(u in e)return r(c,f);if(u in n)return r(void 0,c)}const l={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(c,f,u)=>s(sa(c),sa(f),u,!0)};return w.forEach(Object.keys(Object.assign({},n,e)),function(f){const u=l[f]||s,h=u(n[f],e[f],f);w.isUndefined(h)&&u!==o||(t[f]=h)}),t}const Il=n=>{const e=ot({},n);let{data:t,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:i,headers:a,auth:o}=e;e.headers=a=ge.from(a),e.url=Cl(Ml(e.baseURL,e.url),n.params,n.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let l;if(w.isFormData(t)){if(oe.hasStandardBrowserEnv||oe.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((l=a.getContentType())!==!1){const[c,...f]=l?l.split(";").map(u=>u.trim()).filter(Boolean):[];a.setContentType([c||"multipart/form-data",...f].join("; "))}}if(oe.hasStandardBrowserEnv&&(r&&w.isFunction(r)&&(r=r(e)),r||r!==!1&&Td(e.url))){const c=s&&i&&Md.read(i);c&&a.set(s,c)}return e},Fd=typeof XMLHttpRequest<"u",Bd=Fd&&function(n){return new Promise(function(t,r){const s=Il(n);let i=s.data;const a=ge.from(s.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:c}=s,f,u,h,m,d;function _(){m&&m(),d&&d(),s.cancelToken&&s.cancelToken.unsubscribe(f),s.signal&&s.signal.removeEventListener("abort",f)}let g=new XMLHttpRequest;g.open(s.method.toUpperCase(),s.url,!0),g.timeout=s.timeout;function P(){if(!g)return;const E=ge.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),S={data:!o||o==="text"||o==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:E,config:n,request:g};Tl(function(k){t(k),_()},function(k){r(k),_()},S),g=null}"onloadend"in g?g.onloadend=P:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(P)},g.onabort=function(){g&&(r(new B("Request aborted",B.ECONNABORTED,n,g)),g=null)},g.onerror=function(){r(new B("Network Error",B.ERR_NETWORK,n,g)),g=null},g.ontimeout=function(){let b=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const S=s.transitional||xl;s.timeoutErrorMessage&&(b=s.timeoutErrorMessage),r(new B(b,S.clarifyTimeoutError?B.ETIMEDOUT:B.ECONNABORTED,n,g)),g=null},i===void 0&&a.setContentType(null),"setRequestHeader"in g&&w.forEach(a.toJSON(),function(b,S){g.setRequestHeader(S,b)}),w.isUndefined(s.withCredentials)||(g.withCredentials=!!s.withCredentials),o&&o!=="json"&&(g.responseType=s.responseType),c&&([h,d]=Kn(c,!0),g.addEventListener("progress",h)),l&&g.upload&&([u,m]=Kn(l),g.upload.addEventListener("progress",u),g.upload.addEventListener("loadend",m)),(s.cancelToken||s.signal)&&(f=E=>{g&&(r(!E||E.type?new Mt(null,n,g):E),g.abort(),g=null)},s.cancelToken&&s.cancelToken.subscribe(f),s.signal&&(s.signal.aborted?f():s.signal.addEventListener("abort",f)));const p=xd(s.url);if(p&&oe.protocols.indexOf(p)===-1){r(new B("Unsupported protocol "+p+":",B.ERR_BAD_REQUEST,n));return}g.send(i||null)})},Ld=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let r=new AbortController,s;const i=function(c){if(!s){s=!0,o();const f=c instanceof Error?c:this.reason;r.abort(f instanceof B?f:new Mt(f instanceof Error?f.message:f))}};let a=e&&setTimeout(()=>{a=null,i(new B(`timeout ${e} of ms exceeded`,B.ETIMEDOUT))},e);const o=()=>{n&&(a&&clearTimeout(a),a=null,n.forEach(c=>{c.unsubscribe?c.unsubscribe(i):c.removeEventListener("abort",i)}),n=null)};n.forEach(c=>c.addEventListener("abort",i));const{signal:l}=r;return l.unsubscribe=()=>w.asap(o),l}},Dd=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let r=0,s;for(;r<t;)s=r+e,yield n.slice(r,s),r=s},$d=async function*(n,e){for await(const t of Ud(n))yield*Dd(t,e)},Ud=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},ia=(n,e,t,r)=>{const s=$d(n,e);let i=0,a,o=l=>{a||(a=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:c,value:f}=await s.next();if(c){o(),l.close();return}let u=f.byteLength;if(t){let h=i+=u;t(h)}l.enqueue(new Uint8Array(f))}catch(c){throw o(c),c}},cancel(l){return o(l),s.return()}},{highWaterMark:2})},mr=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Nl=mr&&typeof ReadableStream=="function",jd=mr&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),Fl=(n,...e)=>{try{return!!n(...e)}catch{return!1}},qd=Nl&&Fl(()=>{let n=!1;const e=new Request(oe.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),aa=64*1024,ms=Nl&&Fl(()=>w.isReadableStream(new Response("").body)),Gn={stream:ms&&(n=>n.body)};mr&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Gn[e]&&(Gn[e]=w.isFunction(n[e])?t=>t[e]():(t,r)=>{throw new B(`Response type '${e}' is not supported`,B.ERR_NOT_SUPPORT,r)})})})(new Response);const Hd=async n=>{if(n==null)return 0;if(w.isBlob(n))return n.size;if(w.isSpecCompliantForm(n))return(await new Request(oe.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(w.isArrayBufferView(n)||w.isArrayBuffer(n))return n.byteLength;if(w.isURLSearchParams(n)&&(n=n+""),w.isString(n))return(await jd(n)).byteLength},Wd=async(n,e)=>{const t=w.toFiniteNumber(n.getContentLength());return t??Hd(e)},Vd=mr&&(async n=>{let{url:e,method:t,data:r,signal:s,cancelToken:i,timeout:a,onDownloadProgress:o,onUploadProgress:l,responseType:c,headers:f,withCredentials:u="same-origin",fetchOptions:h}=Il(n);c=c?(c+"").toLowerCase():"text";let m=Ld([s,i&&i.toAbortSignal()],a),d;const _=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(l&&qd&&t!=="get"&&t!=="head"&&(g=await Wd(f,r))!==0){let S=new Request(e,{method:"POST",body:r,duplex:"half"}),C;if(w.isFormData(r)&&(C=S.headers.get("content-type"))&&f.setContentType(C),S.body){const[k,O]=na(g,Kn(ra(l)));r=ia(S.body,aa,k,O)}}w.isString(u)||(u=u?"include":"omit");const P="credentials"in Request.prototype;d=new Request(e,{...h,signal:m,method:t.toUpperCase(),headers:f.normalize().toJSON(),body:r,duplex:"half",credentials:P?u:void 0});let p=await fetch(d);const E=ms&&(c==="stream"||c==="response");if(ms&&(o||E&&_)){const S={};["status","statusText","headers"].forEach(I=>{S[I]=p[I]});const C=w.toFiniteNumber(p.headers.get("content-length")),[k,O]=o&&na(C,Kn(ra(o),!0))||[];p=new Response(ia(p.body,aa,k,()=>{O&&O(),_&&_()}),S)}c=c||"text";let b=await Gn[w.findKey(Gn,c)||"text"](p,n);return!E&&_&&_(),await new Promise((S,C)=>{Tl(S,C,{data:b,headers:ge.from(p.headers),status:p.status,statusText:p.statusText,config:n,request:d})})}catch(P){throw _&&_(),P&&P.name==="TypeError"&&/fetch/i.test(P.message)?Object.assign(new B("Network Error",B.ERR_NETWORK,n,d),{cause:P.cause||P}):B.from(P,P&&P.code,n,d)}}),ps={http:ad,xhr:Bd,fetch:Vd};w.forEach(ps,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const oa=n=>`- ${n}`,Jd=n=>w.isFunction(n)||n===null||n===!1,Bl={getAdapter:n=>{n=w.isArray(n)?n:[n];const{length:e}=n;let t,r;const s={};for(let i=0;i<e;i++){t=n[i];let a;if(r=t,!Jd(t)&&(r=ps[(a=String(t)).toLowerCase()],r===void 0))throw new B(`Unknown adapter '${a}'`);if(r)break;s[a||"#"+i]=r}if(!r){const i=Object.entries(s).map(([o,l])=>`adapter ${o} `+(l===!1?"is not supported by the environment":"is not available in the build"));let a=e?i.length>1?`since :
`+i.map(oa).join(`
`):" "+oa(i[0]):"as no adapter specified";throw new B("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return r},adapters:ps};function Hr(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Mt(null,n)}function la(n){return Hr(n),n.headers=ge.from(n.headers),n.data=qr.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Bl.getAdapter(n.adapter||dn.adapter)(n).then(function(r){return Hr(n),r.data=qr.call(n,n.transformResponse,r),r.headers=ge.from(r.headers),r},function(r){return Ol(r)||(Hr(n),r&&r.response&&(r.response.data=qr.call(n,n.transformResponse,r.response),r.response.headers=ge.from(r.response.headers))),Promise.reject(r)})}const Ll="1.7.9",pr={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{pr[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const ca={};pr.transitional=function(e,t,r){function s(i,a){return"[Axios v"+Ll+"] Transitional option '"+i+"'"+a+(r?". "+r:"")}return(i,a,o)=>{if(e===!1)throw new B(s(a," has been removed"+(t?" in "+t:"")),B.ERR_DEPRECATED);return t&&!ca[a]&&(ca[a]=!0,console.warn(s(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,a,o):!0}};pr.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function Xd(n,e,t){if(typeof n!="object")throw new B("options must be an object",B.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let s=r.length;for(;s-- >0;){const i=r[s],a=e[i];if(a){const o=n[i],l=o===void 0||a(o,i,n);if(l!==!0)throw new B("option "+i+" must be "+l,B.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new B("Unknown option "+i,B.ERR_BAD_OPTION)}}const Fn={assertOptions:Xd,validators:pr},Fe=Fn.validators;class it{constructor(e){this.defaults=e,this.interceptors={request:new ea,response:new ea}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=ot(this.defaults,t);const{transitional:r,paramsSerializer:s,headers:i}=t;r!==void 0&&Fn.assertOptions(r,{silentJSONParsing:Fe.transitional(Fe.boolean),forcedJSONParsing:Fe.transitional(Fe.boolean),clarifyTimeoutError:Fe.transitional(Fe.boolean)},!1),s!=null&&(w.isFunction(s)?t.paramsSerializer={serialize:s}:Fn.assertOptions(s,{encode:Fe.function,serialize:Fe.function},!0)),Fn.assertOptions(t,{baseUrl:Fe.spelling("baseURL"),withXsrfToken:Fe.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&w.merge(i.common,i[t.method]);i&&w.forEach(["delete","get","head","post","put","patch","common"],d=>{delete i[d]}),t.headers=ge.concat(a,i);const o=[];let l=!0;this.interceptors.request.forEach(function(_){typeof _.runWhen=="function"&&_.runWhen(t)===!1||(l=l&&_.synchronous,o.unshift(_.fulfilled,_.rejected))});const c=[];this.interceptors.response.forEach(function(_){c.push(_.fulfilled,_.rejected)});let f,u=0,h;if(!l){const d=[la.bind(this),void 0];for(d.unshift.apply(d,o),d.push.apply(d,c),h=d.length,f=Promise.resolve(t);u<h;)f=f.then(d[u++],d[u++]);return f}h=o.length;let m=t;for(u=0;u<h;){const d=o[u++],_=o[u++];try{m=d(m)}catch(g){_.call(this,g);break}}try{f=la.call(this,m)}catch(d){return Promise.reject(d)}for(u=0,h=c.length;u<h;)f=f.then(c[u++],c[u++]);return f}getUri(e){e=ot(this.defaults,e);const t=Ml(e.baseURL,e.url);return Cl(t,e.params,e.paramsSerializer)}}w.forEach(["delete","get","head","options"],function(e){it.prototype[e]=function(t,r){return this.request(ot(r||{},{method:e,url:t,data:(r||{}).data}))}});w.forEach(["post","put","patch"],function(e){function t(r){return function(i,a,o){return this.request(ot(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}it.prototype[e]=t(),it.prototype[e+"Form"]=t(!0)});class ii{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(s=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](s);r._listeners=null}),this.promise.then=s=>{let i;const a=new Promise(o=>{r.subscribe(o),i=o}).then(s);return a.cancel=function(){r.unsubscribe(i)},a},e(function(i,a,o){r.reason||(r.reason=new Mt(i,a,o),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new ii(function(s){e=s}),cancel:e}}}function zd(n){return function(t){return n.apply(null,t)}}function Kd(n){return w.isObject(n)&&n.isAxiosError===!0}const gs={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(gs).forEach(([n,e])=>{gs[e]=n});function Dl(n){const e=new it(n),t=pl(it.prototype.request,e);return w.extend(t,it.prototype,e,{allOwnKeys:!0}),w.extend(t,e,null,{allOwnKeys:!0}),t.create=function(s){return Dl(ot(n,s))},t}const Z=Dl(dn);Z.Axios=it;Z.CanceledError=Mt;Z.CancelToken=ii;Z.isCancel=Ol;Z.VERSION=Ll;Z.toFormData=hr;Z.AxiosError=B;Z.Cancel=Z.CanceledError;Z.all=function(e){return Promise.all(e)};Z.spread=zd;Z.isAxiosError=Kd;Z.mergeConfig=ot;Z.AxiosHeaders=ge;Z.formToJSON=n=>vl(w.isHTMLForm(n)?new FormData(n):n);Z.getAdapter=Bl.getAdapter;Z.HttpStatusCode=gs;Z.default=Z;async function ua(n){if(!n||n.length==0)return[0,0];const e={method:"POST",url:atob("aHR0cHM6Ly9hcGkuZ2Vla3NwaGVyZS5vbmxpbmUvYWRtaW4tYXBpL2FpZ2MvYmFsYW5jZS90b2tlbg=="),headers:{"content-type":"application/json"},data:{apikey:n.replace("sk-","")}};let t=await Z.request(e);return!t||t.status!=200?[0,0]:t.data.data}function Gd(n){let e,t,r,s,i,a,o,l,c,f,u=new Date(n[2]).toLocaleString()+"",h,m,d,_,g,P,p;return{c(){e=R("label"),t=R("div"),r=R("span"),r.textContent="余额查询",s=T(),i=R("div"),a=ue("账 户 余 额 : "),o=ue(n[1]),l=ue(` ¥
            `),c=R("br"),f=ue(` 
            有 效 期 : `),h=ue(u),m=T(),d=R("span"),_=T(),g=R("button"),g.textContent="刷新",A(r,"class","title"),A(i,"class","b3-label__text"),A(t,"class","fn__flex-1"),A(d,"class","fn__space"),A(g,"class","b3-button b3-button--outline fn__flex-center fn__size200"),A(e,"class","item-wrap fn__flex b3-label config__item")},m(E,b){H(E,e,b),y(e,t),y(t,r),y(t,s),y(t,i),y(i,a),y(i,o),y(i,l),y(i,c),y(i,f),y(i,h),y(e,m),y(e,d),y(e,_),y(e,g),P||(p=V(g,"click",n[3]),P=!0)},p(E,[b]){b&2&&De(o,E[1]),b&4&&u!==(u=new Date(E[2]).toLocaleString()+"")&&De(h,u)},i:ie,o:ie,d(E){E&&j(e),P=!1,p()}}}function Qd(n,e,t){let{apiKey:r}=e,s=0,i=0;Ma(()=>{ua(r).then(o=>{t(1,s=Math.round(o.money*10)/10),t(2,i=o.expiredTime*1e3)})});const a=async()=>{ua(r).then(o=>{t(2,i=o.expiredTime*1e3),t(1,s=Math.round(o.money*10)/10)})};return n.$$set=o=>{"apiKey"in o&&t(0,r=o.apiKey)},[r,s,i,a]}let Yd=class extends he{constructor(e){super(),de(this,e,Qd,Gd,fe,{apiKey:0})}};function fa(n,e,t){const r=n.slice();return r[11]=e[t],r[12]=e,r[13]=t,r}function Zd(n){var a,o,l,c;let e,t,r;function s(f){n[8](f,n[11])}let i={type:n[11].type,key:n[11].key,placeholder:(a=n[11])==null?void 0:a.placeholder,options:(o=n[11])==null?void 0:o.options,slider:(l=n[11])==null?void 0:l.slider,button:(c=n[11])==null?void 0:c.button};return n[11].value!==void 0&&(i.value=n[11].value),e=new ml.Input({props:i}),se.push(()=>Pe(e,"value",s)),e.$on("click",n[4]),e.$on("changed",n[5]),{c(){Y(e.$$.fragment)},m(f,u){G(e,f,u),r=!0},p(f,u){var m,d,_,g;n=f;const h={};u&4&&(h.type=n[11].type),u&4&&(h.key=n[11].key),u&4&&(h.placeholder=(m=n[11])==null?void 0:m.placeholder),u&4&&(h.options=(d=n[11])==null?void 0:d.options),u&4&&(h.slider=(_=n[11])==null?void 0:_.slider),u&4&&(h.button=(g=n[11])==null?void 0:g.button),!t&&u&4&&(t=!0,h.value=n[11].value,Ae(()=>t=!1)),e.$set(h)},i(f){r||(F(e.$$.fragment,f),r=!0)},o(f){L(e.$$.fragment,f),r=!1},d(f){Q(e,f)}}}function da(n,e){var i;let t,r,s;return r=new ml.Wrap({props:{title:e[11].title,description:e[11].description,direction:(i=e[11])==null?void 0:i.direction,$$slots:{default:[Zd]},$$scope:{ctx:e}}}),{key:n,first:null,c(){t=Es(),Y(r.$$.fragment),this.first=t},m(a,o){H(a,t,o),G(r,a,o),s=!0},p(a,o){var c;e=a;const l={};o&4&&(l.title=e[11].title),o&4&&(l.description=e[11].description),o&4&&(l.direction=(c=e[11])==null?void 0:c.direction),o&516&&(l.$$scope={dirty:o,ctx:e}),r.$set(l)},i(a){s||(F(r.$$.fragment,a),s=!0)},o(a){L(r.$$.fragment,a),s=!1},d(a){a&&j(t),Q(r,a)}}}function ha(n){let e,t;return e=new Yd({props:{apiKey:n[1].getValue("apiKey")}}),{c(){Y(e.$$.fragment)},m(r,s){G(e,r,s),t=!0},p(r,s){const i={};s&2&&(i.apiKey=r[1].getValue("apiKey")),e.$set(i)},i(r){t||(F(e.$$.fragment,r),t=!0)},o(r){L(e.$$.fragment,r),t=!1},d(r){Q(e,r)}}}function eh(n){let e,t,r=[],s=new Map,i,a,o;const l=n[7].default,c=_s(l,n,n[9],null);let f=Xe(n[2]);const u=m=>m[11].key;for(let m=0;m<f.length;m+=1){let d=fa(n,f,m),_=u(d);s.set(_,r[m]=da(_,d))}let h=n[0]==="🌈 设置"&&ha(n);return{c(){e=R("div"),c&&c.c(),t=T();for(let m=0;m<r.length;m+=1)r[m].c();i=T(),h&&h.c(),A(e,"class",a="config__tab-container "+n[3]),A(e,"data-name",n[0])},m(m,d){H(m,e,d),c&&c.m(e,null),y(e,t);for(let _=0;_<r.length;_+=1)r[_]&&r[_].m(e,null);y(e,i),h&&h.m(e,null),o=!0},p(m,[d]){c&&c.p&&(!o||d&512)&&ws(c,l,m,m[9],o?ys(l,m[9],d,null):bs(m[9]),null),d&52&&(f=Xe(m[2]),rt(),r=Na(r,d,u,1,m,f,s,e,pc,da,i,fa),st()),m[0]==="🌈 设置"?h?(h.p(m,d),d&1&&F(h,1)):(h=ha(m),h.c(),F(h,1),h.m(e,null)):h&&(rt(),L(h,1,1,()=>{h=null}),st()),(!o||d&8&&a!==(a="config__tab-container "+m[3]))&&A(e,"class",a),(!o||d&1)&&A(e,"data-name",m[0])},i(m){if(!o){F(c,m);for(let d=0;d<f.length;d+=1)F(r[d]);F(h),o=!0}},o(m){L(c,m);for(let d=0;d<r.length;d+=1)L(r[d]);L(h),o=!1},d(m){m&&j(e),c&&c.d(m);for(let d=0;d<r.length;d+=1)r[d].d();h&&h.d()}}}function th(n,e,t){let r,{$$slots:s={},$$scope:i}=e,{group:a}=e,{settingStorage:o}=e,{display:l=!0}=e,c=o.getSettingItems(a);const f=Yn();function u({detail:d}){f("click",{key:d.key})}function h({detail:d}){f("changed",{group:a,...d})}function m(d,_){n.$$.not_equal(_.value,d)&&(_.value=d,t(2,c))}return n.$$set=d=>{"group"in d&&t(0,a=d.group),"settingStorage"in d&&t(1,o=d.settingStorage),"display"in d&&t(6,l=d.display),"$$scope"in d&&t(9,i=d.$$scope)},n.$$.update=()=>{n.$$.dirty&64&&t(3,r=l?"":"fn__none")},[a,o,c,r,u,h,l,s,m,i]}class $l extends he{constructor(e){super(),de(this,e,th,eh,fe,{group:0,settingStorage:1,display:6})}}function nh(n){let e,t,r;return t=new $l({props:{group:"custom",settingStorage:n[0],display:!0}}),t.$on("changed",n[1]),{c(){e=R("div"),Y(t.$$.fragment),v(e,"margin-top","10px"),v(e,"padding","10px"),v(e,"background","none"),v(e,"border-radius","4px"),v(e,"border","1px solid var(--b3-border-color)")},m(s,i){H(s,e,i),G(t,e,null),r=!0},p(s,[i]){const a={};i&1&&(a.settingStorage=s[0]),t.$set(a)},i(s){r||(F(t.$$.fragment,s),r=!0)},o(s){L(t.$$.fragment,s),r=!1},d(s){s&&j(e),Q(t)}}}function rh(n,e,t){let{settingStorage:r}=e;const s=({detail:i})=>{r.setValue(i.key,i.value),r.save()};return n.$$set=i=>{"settingStorage"in i&&t(0,r=i.settingStorage)},[r,s]}class sh extends he{constructor(e){super(),de(this,e,rh,nh,fe,{settingStorage:0})}}function ih(){var t;let n=((t=window.getSelection())==null?void 0:t.toString())||"";return n||(document.querySelectorAll(".protyle-wysiwyg--select").forEach(r=>{const s=r.textContent;n+=`
`+s}),n)}function ah(){let n="",e="";return n=document.getElementsByClassName("protyle-title__input")[0].textContent,document.querySelectorAll("[data-node-index]").forEach(r=>{e+=r.textContent+`
`}),{title:n,content:e}}async function oh(n){const e=document.querySelectorAll(".protyle-wysiwyg--select");if(e.length===0){console.warn("没有选中的内容");return}let r=e[e.length-1].getAttribute("data-node-id");if(!r){console.warn("无法获取节点ID");return}const s=await ql("markdown","",r);for(const i of e)await ui(i.getAttribute("data-node-id"));await Hl("markdown",n,s[0].doOperations[0].id),await ui(s[0].doOperations[0].id)}async function lh(n,e,t,r,s){let i="";const a=await n.messages.stream({model:e,max_tokens:t,messages:r});for await(const o of a)if(o.type==="content_block_delta"){const l="text"in o.delta?o.delta.text:o.delta.toString();i+=l,s(i)}return i}async function ch(n,e,t,r,s,i){var l,c,f;let a="";const o=await n.chat.completions.create({model:e,max_tokens:t,temperature:r,stream:!0,messages:s});for await(const u of o)if((f=(c=(l=u.choices)==null?void 0:l[0])==null?void 0:c.delta)!=null&&f.content){const h=u.choices[0].delta.content;a+=h,i(a)}return a}async function uh(n,e=!1,t=!1){if(window.focus(),await navigator.clipboard.writeText(n),e&&t){oh(n);return}Ea("生成内容已自动复制到剪贴板")}async function fh(n,e,t,r,s,i,a){var l,c;let o="";try{const f=(l=r.get("maxOutputLength"))==null?void 0:l.value;switch(!0){case t.includes("claude"):o=await lh(e,t,f,s,a);break;default:const u=(c=r.get("temperature"))==null?void 0:c.value;o=await ch(n,t,f,u,s,a);break}return o}catch(f){console.error("生成回答时出错:",f);const u=`
生成回答时出错: `+f.message;return o+=u,a(o),o}finally{await uh(o,i,r.getValue("isReplaceSelected"))}}function dh(n){let e,t,r,s,i,a=[{type:"button"},n[4],{class:r=["b3-button",n[3],n[2]].join(" ")},{style:n[1]}],o={};for(let l=0;l<a.length;l+=1)o=Bn(o,a[l]);return{c(){e=R("button"),t=ue(n[0]),hi(e,o)},m(l,c){H(l,e,c),y(e,t),e.autofocus&&e.focus(),s||(i=V(e,"click",n[8]),s=!0)},p(l,[c]){c&1&&tc(t,l[0],o.contenteditable),hi(e,o=gc(a,[{type:"button"},c&16&&l[4],c&12&&r!==(r=["b3-button",l[3],l[2]].join(" "))&&{class:r},c&2&&{style:l[1]}]))},i:ie,o:ie,d(l){l&&j(e),s=!1,i()}}}function hh(n,e,t){let r,s,i,{text:a=!1}=e,{outline:o=!1}=e,{backgroundColor:l=void 0}=e,{label:c=""}=e;function f(u){oc.call(this,n,u)}return n.$$set=u=>{t(4,e=Bn(Bn({},e),di(u))),"text"in u&&t(5,a=u.text),"outline"in u&&t(6,o=u.outline),"backgroundColor"in u&&t(7,l=u.backgroundColor),"label"in u&&t(0,c=u.label)},n.$$.update=()=>{n.$$.dirty&64&&t(3,r=o?"b3-button--outline":""),n.$$.dirty&32&&t(2,s=a?"b3-button--text":""),n.$$.dirty&128&&t(1,i=l?`background-color: ${l}`:"")},e=di(e),[c,i,s,r,e,a,o,l,f]}class Qn extends he{constructor(e){super(),de(this,e,hh,dh,fe,{text:5,outline:6,backgroundColor:7,label:0})}}function mh(n){let e,t,r,s=n[1].title?"编辑提示词":"新增提示词",i,a,o,l,c,f,u,h,m,d,_,g,P,p,E;function b(O){n[3](O)}let S={type:"textinput",placeholder:"标题",key:"title",style:"width: 100%; margin-bottom: 10px;"};n[1].title!==void 0&&(S.value=n[1].title),o=new Xn({props:S}),se.push(()=>Pe(o,"value",b));function C(O){n[4](O)}let k={type:"textarea",placeholder:"内容",key:"content",style:"width: 100%; white-space: pre-wrap; word-wrap: break-word;"};return n[1].content!==void 0&&(k.value=n[1].content),f=new Xn({props:k}),se.push(()=>Pe(f,"value",C)),d=new Qn({props:{label:"取消",text:!0,outline:!0}}),d.$on("click",n[5]),p=new Qn({props:{label:"确认",text:!1,outline:!1}}),p.$on("click",n[6]),{c(){e=R("div"),t=R("div"),r=R("h3"),i=ue(s),a=T(),Y(o.$$.fragment),c=T(),Y(f.$$.fragment),h=T(),m=R("div"),Y(d.$$.fragment),_=T(),g=R("div"),P=T(),Y(p.$$.fragment),A(r,"class","b3-label"),A(g,"class","fn__space"),A(m,"class","b3-dialog__action"),A(t,"class","edit-content svelte-mbkoek"),A(e,"class","edit-panel svelte-mbkoek")},m(O,I){H(O,e,I),y(e,t),y(t,r),y(r,i),y(t,a),G(o,t,null),y(t,c),G(f,t,null),y(t,h),y(t,m),G(d,m,null),y(m,_),y(m,g),y(m,P),G(p,m,null),E=!0},p(O,[I]){(!E||I&2)&&s!==(s=O[1].title?"编辑提示词":"新增提示词")&&De(i,s);const N={};!l&&I&2&&(l=!0,N.value=O[1].title,Ae(()=>l=!1)),o.$set(N);const x={};!u&&I&2&&(u=!0,x.value=O[1].content,Ae(()=>u=!1)),f.$set(x)},i(O){E||(F(o.$$.fragment,O),F(f.$$.fragment,O),F(d.$$.fragment,O),F(p.$$.fragment,O),E=!0)},o(O){L(o.$$.fragment,O),L(f.$$.fragment,O),L(d.$$.fragment,O),L(p.$$.fragment,O),E=!1},d(O){O&&j(e),Q(o),Q(f),Q(d),Q(p)}}}function ph(n,e,t){let{showEditPanel:r=!1}=e,{currentPrompt:s}=e;const i=Yn();function a(f){n.$$.not_equal(s.title,f)&&(s.title=f,t(1,s))}function o(f){n.$$.not_equal(s.content,f)&&(s.content=f,t(1,s))}const l=()=>t(0,r=!1),c=()=>i("save");return n.$$set=f=>{"showEditPanel"in f&&t(0,r=f.showEditPanel),"currentPrompt"in f&&t(1,s=f.currentPrompt)},[r,s,i,a,o,l,c]}class gh extends he{constructor(e){super(),de(this,e,ph,mh,fe,{showEditPanel:0,currentPrompt:1})}}function ma(n,e,t){const r=n.slice();return r[5]=e[t],r}function pa(n,e){let t,r,s,i=e[5].title+"",a,o,l,c,f,u,h,m,d,_,g;function P(){return e[2](e[5])}function p(){return e[3](e[5])}function E(){return e[4](e[5])}return{key:n,first:null,c(){t=R("div"),r=R("div"),s=R("span"),a=ue(i),o=T(),l=R("div"),c=R("button"),c.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconTrashcan"></use></svg>',f=T(),u=R("button"),u.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconEdit"></use></svg>',h=T(),m=R("button"),m.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconPlay"></use></svg>',d=T(),A(s,"class","title"),A(r,"class","fn__flex-1"),A(c,"class","b3-list-item"),A(c,"title","删除"),A(u,"class","b3-list-item"),A(u,"title","编辑"),A(m,"class","b3-list-item"),A(m,"title","使用"),A(l,"class","fn__flex"),A(t,"class","item-wrap fn__flex b3-label config__item"),v(t,"height","1.5em"),this.first=t},m(b,S){H(b,t,S),y(t,r),y(r,s),y(s,a),y(t,o),y(t,l),y(l,c),y(l,f),y(l,u),y(l,h),y(l,m),y(t,d),_||(g=[V(c,"click",P),V(u,"click",p),V(m,"click",E)],_=!0)},p(b,S){e=b,S&1&&i!==(i=e[5].title+"")&&De(a,i)},d(b){b&&j(t),_=!1,ce(g)}}}function _h(n){let e,t=[],r=new Map,s=Xe(n[0]);const i=a=>a[5].title;for(let a=0;a<s.length;a+=1){let o=ma(n,s,a),l=i(o);r.set(l,t[a]=pa(l,o))}return{c(){e=R("div");for(let a=0;a<t.length;a+=1)t[a].c();A(e,"class","b3-tab-bar b3-list b3-list--background")},m(a,o){H(a,e,o);for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(e,null)},p(a,[o]){o&3&&(s=Xe(a[0]),t=Na(t,o,i,1,a,s,r,e,mc,pa,null,ma))},i:ie,o:ie,d(a){a&&j(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function yh(n,e,t){const r=Yn();let{prompts:s}=e;const i=l=>r("delete",l.title),a=l=>r("edit",l),o=l=>r("use",l);return n.$$set=l=>{"prompts"in l&&t(0,s=l.prompts)},[s,r,i,a,o]}class wh extends he{constructor(e){super(),de(this,e,yh,_h,fe,{prompts:0})}}function ga(n){let e,t,r,s;function i(l){n[13](l)}function a(l){n[14](l)}let o={};return n[0]!==void 0&&(o.showEditPanel=n[0]),n[1]!==void 0&&(o.currentPrompt=n[1]),e=new gh({props:o}),se.push(()=>Pe(e,"showEditPanel",i)),se.push(()=>Pe(e,"currentPrompt",a)),e.$on("save",n[6]),{c(){Y(e.$$.fragment)},m(l,c){G(e,l,c),s=!0},p(l,c){const f={};!t&&c&1&&(t=!0,f.showEditPanel=l[0],Ae(()=>t=!1)),!r&&c&2&&(r=!0,f.currentPrompt=l[1],Ae(()=>r=!1)),e.$set(f)},i(l){s||(F(e.$$.fragment,l),s=!0)},o(l){L(e.$$.fragment,l),s=!1},d(l){Q(e,l)}}}function bh(n){let e,t,r,s;t=new wh({props:{prompts:n[2]}}),t.$on("edit",n[10]),t.$on("delete",n[11]),t.$on("use",n[12]);let i=n[0]&&ga(n);return{c(){e=R("div"),Y(t.$$.fragment),r=T(),i&&i.c(),v(e,"background","none"),v(e,"border-radius","4px"),v(e,"max-height","300px"),v(e,"overflow-y","auto")},m(a,o){H(a,e,o),G(t,e,null),y(e,r),i&&i.m(e,null),s=!0},p(a,[o]){const l={};o&4&&(l.prompts=a[2]),t.$set(l),a[0]?i?(i.p(a,o),o&1&&F(i,1)):(i=ga(a),i.c(),F(i,1),i.m(e,null)):i&&(rt(),L(i,1,1,()=>{i=null}),st())},i(a){s||(F(t.$$.fragment,a),F(i),s=!0)},o(a){L(t.$$.fragment,a),L(i),s=!1},d(a){a&&j(e),Q(t),i&&i.d()}}}function Sh(n,e,t){let r,{promptStorage:s}=e,{searchText:i}=e,a=!1,o={title:"",content:""},l=s.prompts;function c(p){s.deletePrompt(p),t(9,l=s.prompts)}function f(p){p?t(1,o={...p}):t(1,o={title:"",content:""}),t(0,a=!0)}function u(p){t(7,i=p.content)}function h(){const p=l.findIndex(E=>E.title===o.title);p===-1?t(9,l=[...l,o]):(t(9,l[p]=o,l),t(9,l=[...l])),s.save(l),t(0,a=!1),t(9,l=s.prompts)}const m=p=>f(p.detail),d=p=>c(p.detail),_=p=>u(p.detail);function g(p){a=p,t(0,a)}function P(p){o=p,t(1,o)}return n.$$set=p=>{"promptStorage"in p&&t(8,s=p.promptStorage),"searchText"in p&&t(7,i=p.searchText)},n.$$.update=()=>{n.$$.dirty&640&&t(2,r=l.filter(p=>p.title.toLowerCase().includes(i.toLowerCase())||p.content.toLowerCase().includes(i.toLowerCase())))},[a,o,r,c,f,u,h,i,s,l,m,d,_,g,P]}class Eh extends he{constructor(e){super(),de(this,e,Sh,bh,fe,{promptStorage:8,searchText:7})}}function _a(n){let e,t,r;function s(a){n[17](a)}let i={outputContent:n[7],isGenerating:n[8]};return n[9]!==void 0&&(i.outputContainer=n[9]),e=new nf({props:i}),se.push(()=>Pe(e,"outputContainer",s)),{c(){Y(e.$$.fragment)},m(a,o){G(e,a,o),r=!0},p(a,o){const l={};o&128&&(l.outputContent=a[7]),o&256&&(l.isGenerating=a[8]),!t&&o&512&&(t=!0,l.outputContainer=a[9],Ae(()=>t=!1)),e.$set(l)},i(a){r||(F(e.$$.fragment,a),r=!0)},o(a){L(e.$$.fragment,a),r=!1},d(a){Q(e,a)}}}function ya(n){let e,t;return e=new sh({props:{settingStorage:n[1]}}),{c(){Y(e.$$.fragment)},m(r,s){G(e,r,s),t=!0},p(r,s){const i={};s&2&&(i.settingStorage=r[1]),e.$set(i)},i(r){t||(F(e.$$.fragment,r),t=!0)},o(r){L(e.$$.fragment,r),t=!1},d(r){Q(e,r)}}}function wa(n){let e,t,r,s;function i(l){n[22](l)}function a(l){n[23](l)}let o={};return n[3]!==void 0&&(o.searchText=n[3]),n[0]!==void 0&&(o.promptStorage=n[0]),e=new Eh({props:o}),se.push(()=>Pe(e,"searchText",i)),se.push(()=>Pe(e,"promptStorage",a)),{c(){Y(e.$$.fragment)},m(l,c){G(e,l,c),s=!0},p(l,c){const f={};!t&&c&8&&(t=!0,f.searchText=l[3],Ae(()=>t=!1)),!r&&c&1&&(r=!0,f.promptStorage=l[0],Ae(()=>r=!1)),e.$set(f)},i(l){s||(F(e.$$.fragment,l),s=!0)},o(l){L(e.$$.fragment,l),s=!1},d(l){Q(e,l)}}}function Ah(n){let e,t,r,s,i,a,o,l,c,f,u,h=n[6]&&_a(n);function m(b){n[18](b)}function d(b){n[19](b)}function _(b){n[20](b)}function g(b){n[21](b)}let P={settingStorage:n[1],handleSubmit:n[11],handleKeydown:n[12]};n[3]!==void 0&&(P.inputValue=n[3]),n[4]!==void 0&&(P.inputElement=n[4]),n[5]!==void 0&&(P.selectedModel=n[5]),n[2]!==void 0&&(P.showParams=n[2]),r=new pf({props:P}),se.push(()=>Pe(r,"inputValue",m)),se.push(()=>Pe(r,"inputElement",d)),se.push(()=>Pe(r,"selectedModel",_)),se.push(()=>Pe(r,"showParams",g));let p=n[2]&&ya(n),E=n[10]&&wa(n);return{c(){e=R("div"),h&&h.c(),t=T(),Y(r.$$.fragment),l=T(),c=R("div"),p&&p.c(),f=T(),E&&E.c(),v(c,"width","100%"),v(e,"width","100%")},m(b,S){H(b,e,S),h&&h.m(e,null),y(e,t),G(r,e,null),y(e,l),y(e,c),p&&p.m(c,null),y(c,f),E&&E.m(c,null),u=!0},p(b,[S]){b[6]?h?(h.p(b,S),S&64&&F(h,1)):(h=_a(b),h.c(),F(h,1),h.m(e,t)):h&&(rt(),L(h,1,1,()=>{h=null}),st());const C={};S&2&&(C.settingStorage=b[1]),!s&&S&8&&(s=!0,C.inputValue=b[3],Ae(()=>s=!1)),!i&&S&16&&(i=!0,C.inputElement=b[4],Ae(()=>i=!1)),!a&&S&32&&(a=!0,C.selectedModel=b[5],Ae(()=>a=!1)),!o&&S&4&&(o=!0,C.showParams=b[2],Ae(()=>o=!1)),r.$set(C),b[2]?p?(p.p(b,S),S&4&&F(p,1)):(p=ya(b),p.c(),F(p,1),p.m(c,f)):p&&(rt(),L(p,1,1,()=>{p=null}),st()),b[10]?E?(E.p(b,S),S&1024&&F(E,1)):(E=wa(b),E.c(),F(E,1),E.m(c,null)):E&&(rt(),L(E,1,1,()=>{E=null}),st())},i(b){u||(F(h),F(r.$$.fragment,b),F(p),F(E),u=!0)},o(b){L(h),L(r.$$.fragment,b),L(p),L(E),u=!1},d(b){b&&j(e),h&&h.d(),Q(r),p&&p.d(),E&&E.d()}}}function Ph(n,e,t){let r,{openai:s}=e,{claude:i}=e,{settingStorage:a}=e,{promptStorage:o}=e,{selectedText:l}=e,{pageContent:c}=e,f="",u,h=!1,m=a.getValue("modelSelections"),d=!1,_="",g=!1,P;async function p(){t(6,d=!0),t(8,g=!0),t(7,_="");let x=[];const we=l.trim().length>0;we?x.push({role:"user",content:`文本:${l}

指令:${f}`}):a.getValue("isPageContent")?x.push({role:"user",content:`标题:${c.title}

内容:${c.content}

指令:${f}`}):x.push({role:"user",content:`指令:${f}`});try{await fh(s,i,m,a,x,we,He=>{t(7,_=He),P&&t(9,P.scrollTop=P.scrollHeight,P)})}finally{t(8,g=!1)}}function E(x){x.key==="Enter"?p():x.key==="Escape"&&console.debug("ai指令取消")}Ma(()=>{u.focus()});function b(x){P=x,t(9,P)}function S(x){f=x,t(3,f)}function C(x){u=x,t(4,u)}function k(x){m=x,t(5,m)}function O(x){h=x,t(2,h)}function I(x){f=x,t(3,f)}function N(x){o=x,t(0,o)}return n.$$set=x=>{"openai"in x&&t(13,s=x.openai),"claude"in x&&t(14,i=x.claude),"settingStorage"in x&&t(1,a=x.settingStorage),"promptStorage"in x&&t(0,o=x.promptStorage),"selectedText"in x&&t(15,l=x.selectedText),"pageContent"in x&&t(16,c=x.pageContent)},n.$$.update=()=>{n.$$.dirty&6&&t(10,r=a.getValue("isShowPrompts")&&!h)},[o,a,h,f,u,m,d,_,g,P,r,p,E,s,i,l,c,b,S,C,k,O,I,N]}class Rh extends he{constructor(e){super(),de(this,e,Ph,Ah,fe,{openai:13,claude:14,settingStorage:1,promptStorage:0,selectedText:15,pageContent:16})}}function kh(n,e,t,r){const s=new yt.Dialog({title:"",content:'<div id="ai-instruction""></div>',width:"40%",hideCloseIcon:!0}),i=ih(),a=ah();new Rh({target:s.element.querySelector("#ai-instruction"),props:{openai:e,claude:t,settingStorage:n,promptStorage:r,selectedText:i,pageContent:a}})}function Ch(n){let e,t,r,s,i,a,o,l,c,f,u,h,m,d,_,g,P,p,E,b,S,C,k;return{c(){e=R("div"),t=R("h2"),t.textContent="token",r=T(),s=R("p"),s.textContent=`token
        是模型用来表示自然语言文本的基本单位，可以直观的理解为“字”或“词”；通常 1
        个中文词语、1 个英文单词、1 个数字或 1 个符号计为 1 个 token。`,i=T(),a=R("h2"),a.textContent="Temperature 设置",o=T(),l=R("p"),l.innerHTML=`​<span data-type="code">temperature</span>​ 参数默认为
        1.0。建议您根据如下表格，按使用场景设置
        <span data-type="code">temperature</span>​。`,c=T(),f=R("table"),f.innerHTML="<thead><tr><th>场景</th> <th>温度</th></tr></thead> <tbody><tr><td>代码生成/数学解题</td> <td>0.0</td></tr> <tr><td>数据抽取/分析</td> <td>1.0</td></tr> <tr><td>通用对话</td> <td>1.3</td></tr> <tr><td>翻译</td> <td>1.3</td></tr> <tr><td>创意类写作/诗歌创作</td> <td>1.5</td></tr></tbody>",u=T(),h=R("h2"),h.textContent="model",m=T(),d=R("p"),d.textContent="扣减费用 = token 消耗量 × 模型单价，对应的费用将直接余额中进行扣减。",_=T(),g=R("table"),g.innerHTML='<thead><tr><th>模型</th> <th>上下文长度</th> <th>最大输出长度</th> <th>输入价格<br/></th> <th>输出价格</th></tr></thead> <tbody><tr><td><span data-type="strong">deepseek-chat</span></td> <td>64K</td> <td>8K</td> <td>1元/百万tokens</td> <td>2元/百万tokens</td></tr> <tr><td>qwen-max</td> <td>32,768</td> <td>8,192</td> <td>20元/百万tokens</td> <td>60元/百万tokens</td></tr> <tr><td>qwen-plus</td> <td>129,024</td> <td>8,192</td> <td>0.8元/百万tokens</td> <td>2元/百万tokens</td></tr> <tr><td>qwen-turbo</td> <td>1,000,000</td> <td>8,192</td> <td>0.3元/百万tokens</td> <td>0.6元/百万tokens</td></tr> <tr><td>qwen-long</td> <td>10,000,000</td> <td>6,000</td> <td>0.25元/百万tokens</td> <td>1元/百万tokens</td></tr> <tr><td><span data-type="s">gpt-3.5-turbo</span></td> <td></td> <td></td> <td><span data-type="s">6元/百万tokens</span></td> <td><span data-type="s">18元/百万tokens</span></td></tr> <tr><td>gpt-4o-mini</td> <td></td> <td></td> <td>1.8元/百万tokens</td> <td>7.2元/百万tokens</td></tr> <tr><td>gpt-4o</td> <td></td> <td></td> <td>30元/百万tokens</td> <td>120元/百万tokens</td></tr> <tr><td><span data-type="strong text" style="color: var(--b3-font-color8);">gpt-4-turbo</span></td> <td></td> <td></td> <td>120元/百万tokens</td> <td>360元/百万tokens</td></tr> <tr><td>claude-3-5-haiku</td> <td></td> <td></td> <td>12元/百万tokens</td> <td>60元/百万tokens</td></tr> <tr><td>claude-3-5-sonnet</td> <td></td> <td></td> <td>36元/百万tokens</td> <td>180元/百万tokens</td></tr> <tr><td><span data-type="strong text" style="color: var(--b3-font-color8);">claude-3-opus</span></td> <td></td> <td></td> <td>180元/百万tokens</td> <td>900元/百万tokens</td></tr> <tr><td>gemini-1.5-flash</td> <td></td> <td></td> <td>0.896元/百万tokens</td> <td>3.6元/百万tokens</td></tr> <tr><td>gemini-1.5-pro</td> <td></td> <td></td> <td>15元/百万tokens</td> <td>60元/百万tokens</td></tr></tbody>',P=T(),p=R("h3"),p.textContent="排行榜",E=T(),b=R("p"),b.innerHTML='<a href="https://www.datalearner.com/ai-models/leaderboard/datalearner-llm-leaderboard">大模型综合能力排行榜</a>',S=T(),C=R("p"),C.innerHTML='<a href="https://www.datalearner.com/ai-models/leaderboard/datalearner-llm-coding-leaderboard#google_vignette">大模型编程能力排行榜</a>',A(e,"class",k="b3-typography "+n[0]),v(e,"margin","10px auto"),v(e,"max-height","80vh"),v(e,"overflow-y","auto"),v(e,"width","95%"),v(e,"max-width","1200px")},m(O,I){H(O,e,I),y(e,t),y(e,r),y(e,s),y(e,i),y(e,a),y(e,o),y(e,l),y(e,c),y(e,f),y(e,u),y(e,h),y(e,m),y(e,d),y(e,_),y(e,g),y(e,P),y(e,p),y(e,E),y(e,b),y(e,S),y(e,C)},p(O,[I]){I&1&&k!==(k="b3-typography "+O[0])&&A(e,"class",k)},i:ie,o:ie,d(O){O&&j(e)}}}function xh(n,e,t){let r,{display:s=!0}=e;return n.$$set=i=>{"display"in i&&t(1,s=i.display)},n.$$.update=()=>{n.$$.dirty&2&&t(0,r=s?"":"fn__none")},[r,s]}let vh=class extends he{constructor(e){super(),de(this,e,xh,Ch,fe,{display:1})}};function Oh(n){let e,t,r,s,i,a,o,l,c,f,u,h,m,d,_,g,P,p,E,b,S,C,k,O,I,N,x,we,He,lt,It,gr,ai,_r,oi,yr,li,Qe,ci,hn;return{c(){e=R("div"),t=R("h1"),t.textContent="功能介绍",r=T(),s=R("h2"),s.textContent="指令模式",i=T(),a=R("p"),a.textContent="快捷键：option + command + k",o=T(),l=R("div"),l.innerHTML='<img src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/yyy.jpg" alt=""/>',c=T(),f=R("h3"),f.textContent="设置超参数",u=T(),h=R("div"),h.innerHTML='<img src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/xx.jpg" alt=""/>',m=T(),d=R("h3"),d.textContent="选择模型",_=T(),g=R("div"),g.innerHTML='<img src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/WechatIMG252.jpg" alt=""/>',P=T(),p=R("h3"),p.textContent="无中生有",E=T(),b=R("p"),b.textContent="当前文档中没有写入任何内容，直接通过指令让大模型帮助生成内容。",S=T(),C=R("div"),C.innerHTML=`<video controls="" src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/%E6%97%A0%E4%B8%AD%E7%94%9F%E6%9C%89.mp4" data-src=""><track kind="captions" label="中文字幕" src="" default=""/>
            不支持视频播放。</video>`,k=T(),O=R("h3"),O.textContent="修改润色",I=T(),N=R("div"),N.innerHTML=`<video controls="" src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3.mp4" data-src=""><track kind="captions" label="中文字幕" src="" default=""/>
            不支持视频播放。</video>`,x=T(),we=R("h3"),we.textContent="扩写",He=T(),lt=R("div"),lt.innerHTML=`<video controls="" src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/%E6%89%A9%E5%86%99.mp4" data-src=""><track kind="captions" label="中文字幕" src="" default=""/>
            不支持视频播放。</video>`,It=T(),gr=R("h2"),gr.textContent="聊天模式",ai=T(),_r=R("p"),_r.textContent="开发中...",oi=T(),yr=R("h2"),yr.textContent="来提意见",li=T(),Qe=R("img"),A(a,"id","20250116161508-2ifhw0n"),A(l,"class","iframe"),A(h,"class","iframe"),A(g,"class","iframe"),A(C,"class","iframe"),A(N,"class","iframe"),A(lt,"class","iframe"),Vl(Qe.src,ci="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/WechatIMG6765.jpg")||A(Qe,"src",ci),A(Qe,"alt",""),v(Qe,"width","50%"),v(Qe,"height","auto"),A(e,"class",hn="b3-typography "+n[0]),v(e,"max-width","800px"),v(e,"margin","0 auto")},m(Nt,wr){H(Nt,e,wr),y(e,t),y(e,r),y(e,s),y(e,i),y(e,a),y(e,o),y(e,l),y(e,c),y(e,f),y(e,u),y(e,h),y(e,m),y(e,d),y(e,_),y(e,g),y(e,P),y(e,p),y(e,E),y(e,b),y(e,S),y(e,C),y(e,k),y(e,O),y(e,I),y(e,N),y(e,x),y(e,we),y(e,He),y(e,lt),y(e,It),y(e,gr),y(e,ai),y(e,_r),y(e,oi),y(e,yr),y(e,li),y(e,Qe)},p(Nt,[wr]){wr&1&&hn!==(hn="b3-typography "+Nt[0])&&A(e,"class",hn)},i:ie,o:ie,d(Nt){Nt&&j(e)}}}function Th(n,e,t){let r,{display:s=!0}=e;return n.$$set=i=>{"display"in i&&t(1,s=i.display)},n.$$.update=()=>{n.$$.dirty&2&&t(0,r=s?"":"fn__none")},[r,s]}let Mh=class extends he{constructor(e){super(),de(this,e,Th,Oh,fe,{display:1})}};function ba(n,e,t){const r=n.slice();return r[8]=e[t],r}function Sa(n){let e,t,r,s,i;function a(){return n[4](n[8])}return{c(){e=R("li"),t=R("span"),t.textContent=`${n[8]}`,r=T(),A(t,"class","b3-list-item__text"),A(e,"data-name","editor"),A(e,"class","b3-list-item"),K(e,"b3-list-item--focus",n[8]===n[2])},m(o,l){H(o,e,l),y(e,t),y(e,r),s||(i=[V(e,"click",a),V(e,"keydown",Nh)],s=!0)},p(o,l){n=o,l&12&&K(e,"b3-list-item--focus",n[8]===n[2])},d(o){o&&j(e),s=!1,ce(i)}}}function Ih(n){let e,t,r,s,i,a,o,l,c,f,u,h,m,d,_,g,P,p,E=Xe(n[3]),b=[];for(let S=0;S<E.length;S+=1)b[S]=Sa(ba(n,E,S));return i=new $l({props:{group:n[3][0],settingStorage:n[0],display:n[2]===n[3][0]}}),i.$on("changed",n[5]),o=new vh({props:{display:n[2]===n[3][2]}}),c=new Mh({props:{display:n[2]===n[3][3]}}),h=new Qn({props:{label:"取消",text:!0,outline:!0}}),h.$on("click",n[6]),g=new Qn({props:{label:"确认",text:!1,outline:!1}}),g.$on("click",n[7]),{c(){e=R("div"),t=R("ul");for(let S=0;S<b.length;S+=1)b[S].c();r=T(),s=R("div"),Y(i.$$.fragment),a=T(),Y(o.$$.fragment),l=T(),Y(c.$$.fragment),f=T(),u=R("div"),Y(h.$$.fragment),m=T(),d=R("div"),_=T(),Y(g.$$.fragment),A(t,"class","b3-tab-bar b3-list b3-list--background"),A(d,"class","fn__space"),A(u,"class",P="b3-dialog__action "+(n[2]==n[3][0]?"":"fn__none")),A(s,"class","config__tab-wrap"),A(e,"class","fn__flex-1 fn__flex config__panel")},m(S,C){H(S,e,C),y(e,t);for(let k=0;k<b.length;k+=1)b[k]&&b[k].m(t,null);y(e,r),y(e,s),G(i,s,null),y(s,a),G(o,s,null),y(s,l),G(c,s,null),y(s,f),y(s,u),G(h,u,null),y(u,m),y(u,d),y(u,_),G(g,u,null),p=!0},p(S,[C]){if(C&12){E=Xe(S[3]);let N;for(N=0;N<E.length;N+=1){const x=ba(S,E,N);b[N]?b[N].p(x,C):(b[N]=Sa(x),b[N].c(),b[N].m(t,null))}for(;N<b.length;N+=1)b[N].d(1);b.length=E.length}const k={};C&1&&(k.settingStorage=S[0]),C&4&&(k.display=S[2]===S[3][0]),i.$set(k);const O={};C&4&&(O.display=S[2]===S[3][2]),o.$set(O);const I={};C&4&&(I.display=S[2]===S[3][3]),c.$set(I),(!p||C&4&&P!==(P="b3-dialog__action "+(S[2]==S[3][0]?"":"fn__none")))&&A(u,"class",P)},i(S){p||(F(i.$$.fragment,S),F(o.$$.fragment,S),F(c.$$.fragment,S),F(h.$$.fragment,S),F(g.$$.fragment,S),p=!0)},o(S){L(i.$$.fragment,S),L(o.$$.fragment,S),L(c.$$.fragment,S),L(h.$$.fragment,S),L(g.$$.fragment,S),p=!1},d(S){S&&j(e),va(b,S),Q(i),Q(o),Q(c),Q(h),Q(g)}}}const Nh=()=>{};function Fh(n,e,t){let r=["🌈 设置","💬 公告","✨ 功能"],s=r[0],{settingStorage:i}=e,{dialog:a}=e;const o=u=>{t(2,s=u)},l=({detail:u})=>{i.setValue(u.key,u.value)},c=()=>{i.load(),a.destroy()},f=()=>{i.save(),a.destroy()};return n.$$set=u=>{"settingStorage"in u&&t(0,i=u.settingStorage),"dialog"in u&&t(1,a=u.dialog)},[i,a,s,r,o,l,c,f]}class Bh extends he{constructor(e){super(),de(this,e,Fh,Ih,fe,{settingStorage:0,dialog:1})}}const Lh=`<symbol id="iconFace" viewBox="0 0 32 32">
<path d="M13.667 17.333c0 0.92-0.747 1.667-1.667 1.667s-1.667-0.747-1.667-1.667 0.747-1.667 1.667-1.667 1.667 0.747 1.667 1.667zM20 15.667c-0.92 0-1.667 0.747-1.667 1.667s0.747 1.667 1.667 1.667 1.667-0.747 1.667-1.667-0.747-1.667-1.667-1.667zM29.333 16c0 7.36-5.973 13.333-13.333 13.333s-13.333-5.973-13.333-13.333 5.973-13.333 13.333-13.333 13.333 5.973 13.333 13.333zM14.213 5.493c1.867 3.093 5.253 5.173 9.12 5.173 0.613 0 1.213-0.067 1.787-0.16-1.867-3.093-5.253-5.173-9.12-5.173-0.613 0-1.213 0.067-1.787 0.16zM5.893 12.627c2.28-1.293 4.040-3.4 4.88-5.92-2.28 1.293-4.040 3.4-4.88 5.92zM26.667 16c0-1.040-0.16-2.040-0.44-2.987-0.933 0.2-1.893 0.32-2.893 0.32-4.173 0-7.893-1.92-10.347-4.92-1.4 3.413-4.187 6.093-7.653 7.4 0.013 0.053 0 0.12 0 0.187 0 5.88 4.787 10.667 10.667 10.667s10.667-4.787 10.667-10.667z"></path>
</symbol>`,Dh=`<symbol id="iconSaving" viewBox="0 0 32 32">
<path d="M20 13.333c0-0.733 0.6-1.333 1.333-1.333s1.333 0.6 1.333 1.333c0 0.733-0.6 1.333-1.333 1.333s-1.333-0.6-1.333-1.333zM10.667 12h6.667v-2.667h-6.667v2.667zM29.333 10v9.293l-3.76 1.253-2.24 7.453h-7.333v-2.667h-2.667v2.667h-7.333c0 0-3.333-11.28-3.333-15.333s3.28-7.333 7.333-7.333h6.667c1.213-1.613 3.147-2.667 5.333-2.667 1.107 0 2 0.893 2 2 0 0.28-0.053 0.533-0.16 0.773-0.187 0.453-0.347 0.973-0.427 1.533l3.027 3.027h2.893zM26.667 12.667h-1.333l-4.667-4.667c0-0.867 0.12-1.72 0.347-2.547-1.293 0.333-2.347 1.293-2.787 2.547h-8.227c-2.573 0-4.667 2.093-4.667 4.667 0 2.507 1.627 8.867 2.68 12.667h2.653v-2.667h8v2.667h2.68l2.067-6.867 3.253-1.093v-4.707z"></path>
</symbol>`;class $h extends yt.Plugin{constructor(t){super(t);be(this,"_isMobile");be(this,"_settingStorage");be(this,"_promptStorage");be(this,"_openai");be(this,"_claude");this._settingStorage=new Zu(this,cs),this._promptStorage=new Yu(this,us),this._isMobile=yt.getFrontend()==="mobile"||yt.getFrontend()==="browser-mobile"}async onload(){console.log("onload...."),this._settingStorage.load().then(()=>{const t=this._settingStorage.getValue("apiKey");this._openai=new U({baseURL:`${Ji}/v1`,apiKey:t,dangerouslyAllowBrowser:!0}),this._claude=new J({baseURL:`${Ji}/claude`,apiKey:t,dangerouslyAllowBrowser:!0})}),this._promptStorage.load(),this.addIcons(Lh),this.addIcons(Dh),this.addCommand({langKey:"getSelectedText",hotkey:"⌥⌘K",callback:()=>kh(this._settingStorage,this._openai,this._claude,this._promptStorage)}),console.log("onload....end")}onLayoutReady(){}uninstall(){this.removeData(cs),this.removeData(us),Wl("数据已清除，思源AI插件卸载成功！")}openSetting(){if(!this._settingStorage)return;if(this._isMobile){Ea("请在桌面端使用");return}let t=new yt.Dialog({title:"思源AI设置",width:"70%",height:"60%",content:'<div class="b3-dialog__content" id="AISettingPanel" ></div>'});new Bh({target:t.element.querySelector("#AISettingPanel"),props:{settingStorage:this._settingStorage,dialog:t}})}}module.exports=$h;
