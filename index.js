"use strict";var Vl=Object.defineProperty;var Jl=(n,e,t)=>e in n?Vl(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var pe=(n,e,t)=>Jl(n,typeof e!="symbol"?e+"":e,t);const et=require("siyuan");async function rn(n,e){let t=await et.fetchSyncPost(n,e);return t.code===0?t.data:null}async function Xl(n,e,t,r,s){return rn("/api/block/insertBlock",{dataType:n,data:e,nextID:t,previousID:r,parentID:s})}async function Kl(n,e,t){return rn("/api/block/appendBlock",{dataType:n,data:e,parentID:t})}async function zl(n){return rn("/api/block/deleteBlock",{id:n})}async function va(n,e=7e3){return rn("/api/notification/pushMsg",{msg:n,timeout:e})}async function xa(n,e=7e3){return rn("/api/notification/pushErrMsg",{msg:n,timeout:e})}function ne(){}const Oa=n=>n;function Bn(n,e){for(const t in e)n[t]=e[t];return n}function Ta(n){return n()}function hi(){return Object.create(null)}function oe(n){n.forEach(Ta)}function Qt(n){return typeof n=="function"}function fe(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let mn;function Gl(n,e){return n===e?!0:(mn||(mn=document.createElement("a")),mn.href=e,n===mn.href)}function Ql(n){return Object.keys(n).length===0}function ys(n,e,t,r){if(n){const s=Ma(n,e,t,r);return n[0](s)}}function Ma(n,e,t,r){return n[1]&&r?Bn(t.ctx.slice(),n[1](r(e))):t.ctx}function ws(n,e,t,r){if(n[2]&&r){const s=n[2](r(t));if(e.dirty===void 0)return s;if(typeof s=="object"){const i=[],a=Math.max(e.dirty.length,s.length);for(let o=0;o<a;o+=1)i[o]=e.dirty[o]|s[o];return i}return e.dirty|s}return e.dirty}function bs(n,e,t,r,s,i){if(s){const a=Ma(e,t,r,i);n.p(a,s)}}function Ss(n){if(n.ctx.length>32){const e=[],t=n.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function mi(n){const e={};for(const t in n)t[0]!=="$"&&(e[t]=n[t]);return e}const Yl=["",!0,1,"true","contenteditable"],Ia=typeof window<"u";let Zl=Ia?()=>window.performance.now():()=>Date.now(),Es=Ia?n=>requestAnimationFrame(n):ne;const bt=new Set;function Na(n){bt.forEach(e=>{e.c(n)||(bt.delete(e),e.f())}),bt.size!==0&&Es(Na)}function ec(n){let e;return bt.size===0&&Es(Na),{promise:new Promise(t=>{bt.add(e={c:n,f:t})}),abort(){bt.delete(e)}}}function y(n,e){n.appendChild(e)}function Fa(n){if(!n)return document;const e=n.getRootNode?n.getRootNode():n.ownerDocument;return e&&e.host?e:n.ownerDocument}function tc(n){const e=k("style");return e.textContent="/* empty */",nc(Fa(n),e),e.sheet}function nc(n,e){return y(n.head||n,e),e.sheet}function H(n,e,t){n.insertBefore(e,t||null)}function U(n){n.parentNode&&n.parentNode.removeChild(n)}function Ln(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function k(n){return document.createElement(n)}function se(n){return document.createTextNode(n)}function O(){return se(" ")}function As(){return se("")}function j(n,e,t,r){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}function rc(n){return function(e){return e.stopPropagation(),n.call(this,e)}}function A(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}const sc=["width","height"];function pi(n,e){const t=Object.getOwnPropertyDescriptors(n.__proto__);for(const r in e)e[r]==null?n.removeAttribute(r):r==="style"?n.style.cssText=e[r]:r==="__value"?n.value=n[r]=e[r]:t[r]&&t[r].set&&sc.indexOf(r)===-1?n[r]=e[r]:A(n,r,e[r])}function Vr(n){return n===""?null:+n}function ic(n){return Array.from(n.childNodes)}function Ce(n,e){e=""+e,n.data!==e&&(n.data=e)}function ac(n,e){e=""+e,n.wholeText!==e&&(n.data=e)}function oc(n,e,t){~Yl.indexOf(t)?ac(n,e):Ce(n,e)}function we(n,e){n.value=e??""}function x(n,e,t,r){t==null?n.style.removeProperty(e):n.style.setProperty(e,t,"")}function gi(n,e,t){for(let r=0;r<n.options.length;r+=1){const s=n.options[r];if(s.__value===e){s.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function lc(n){const e=n.querySelector(":checked");return e&&e.__value}function z(n,e,t){n.classList.toggle(e,!!t)}function Ba(n,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:r})}const Dn=new Map;let qn=0;function cc(n){let e=5381,t=n.length;for(;t--;)e=(e<<5)-e^n.charCodeAt(t);return e>>>0}function uc(n,e){const t={stylesheet:tc(e),rules:{}};return Dn.set(n,t),t}function _i(n,e,t,r,s,i,a,o=0){const l=16.666/r;let c=`{
`;for(let g=0;g<=1;g+=l){const P=e+(t-e)*i(g);c+=g*100+`%{${a(P,1-P)}}
`}const f=c+`100% {${a(t,1-t)}}
}`,u=`__svelte_${cc(f)}_${o}`,h=Fa(n),{stylesheet:p,rules:d}=Dn.get(h)||uc(h,n);d[u]||(d[u]=!0,p.insertRule(`@keyframes ${u} ${f}`,p.cssRules.length));const m=n.style.animation||"";return n.style.animation=`${m?`${m}, `:""}${u} ${r}ms linear ${s}ms 1 both`,qn+=1,u}function fc(n,e){const t=(n.style.animation||"").split(", "),r=t.filter(e?i=>i.indexOf(e)<0:i=>i.indexOf("__svelte")===-1),s=t.length-r.length;s&&(n.style.animation=r.join(", "),qn-=s,qn||dc())}function dc(){Es(()=>{qn||(Dn.forEach(n=>{const{ownerNode:e}=n.stylesheet;e&&U(e)}),Dn.clear())})}let Yt;function Xt(n){Yt=n}function ks(){if(!Yt)throw new Error("Function called outside component initialization");return Yt}function La(n){ks().$$.on_mount.push(n)}function hc(n){ks().$$.after_update.push(n)}function Zn(){const n=ks();return(e,t,{cancelable:r=!1}={})=>{const s=n.$$.callbacks[e];if(s){const i=Ba(e,t,{cancelable:r});return s.slice().forEach(a=>{a.call(n,i)}),!i.defaultPrevented}return!0}}function mc(n,e){const t=n.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}const mt=[],ie=[];let St=[];const Jr=[],pc=Promise.resolve();let Xr=!1;function gc(){Xr||(Xr=!0,pc.then(Da))}function lt(n){St.push(n)}function ke(n){Jr.push(n)}const Sr=new Set;let ut=0;function Da(){if(ut!==0)return;const n=Yt;do{try{for(;ut<mt.length;){const e=mt[ut];ut++,Xt(e),_c(e.$$)}}catch(e){throw mt.length=0,ut=0,e}for(Xt(null),mt.length=0,ut=0;ie.length;)ie.pop()();for(let e=0;e<St.length;e+=1){const t=St[e];Sr.has(t)||(Sr.add(t),t())}St.length=0}while(mt.length);for(;Jr.length;)Jr.pop()();Xr=!1,Sr.clear(),Xt(n)}function _c(n){if(n.fragment!==null){n.update(),oe(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(lt)}}function yc(n){const e=[],t=[];St.forEach(r=>n.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),St=e}let Nt;function wc(){return Nt||(Nt=Promise.resolve(),Nt.then(()=>{Nt=null})),Nt}function Er(n,e,t){n.dispatchEvent(Ba(`${e?"intro":"outro"}${t}`))}const Rn=new Set;let We;function it(){We={r:0,c:[],p:We}}function at(){We.r||oe(We.c),We=We.p}function F(n,e){n&&n.i&&(Rn.delete(n),n.i(e))}function L(n,e,t,r){if(n&&n.o){if(Rn.has(n))return;Rn.add(n),We.c.push(()=>{Rn.delete(n),r&&(t&&n.d(1),r())}),n.o(e)}else r&&r()}const bc={duration:0};function Un(n,e,t,r){let i=e(n,t,{direction:"both"}),a=r?0:1,o=null,l=null,c=null,f;function u(){c&&fc(n,c)}function h(d,m){const g=d.b-a;return m*=Math.abs(g),{a,b:d.b,d:g,duration:m,start:d.start,end:d.start+m,group:d.group}}function p(d){const{delay:m=0,duration:g=300,easing:P=Oa,tick:w=ne,css:_}=i||bc,S={start:Zl()+m,b:d};d||(S.group=We,We.r+=1),"inert"in n&&(d?f!==void 0&&(n.inert=f):(f=n.inert,n.inert=!0)),o||l?l=S:(_&&(u(),c=_i(n,a,d,g,m,P,_)),d&&w(0,1),o=h(S,g),lt(()=>Er(n,d,"start")),ec(b=>{if(l&&b>l.start&&(o=h(l,g),l=null,Er(n,o.b,"start"),_&&(u(),c=_i(n,a,o.b,o.duration,0,P,i.css))),o){if(b>=o.end)w(a=o.b,1-a),Er(n,o.b,"end"),l||(o.b?u():--o.group.r||oe(o.group.c)),o=null;else if(b>=o.start){const R=b-o.start;a=o.a+o.d*P(R/o.duration),w(a,1-a)}}return!!(o||l)}))}return{run(d){Qt(i)?wc().then(()=>{i=i({direction:d?"in":"out"}),p(d)}):p(d)},end(){u(),o=l=null}}}function xe(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function Sc(n,e){n.d(1),e.delete(n.key)}function Ec(n,e){L(n,1,1,()=>{e.delete(n.key)})}function qa(n,e,t,r,s,i,a,o,l,c,f,u){let h=n.length,p=i.length,d=h;const m={};for(;d--;)m[n[d].key]=d;const g=[],P=new Map,w=new Map,_=[];for(d=p;d--;){const v=u(s,i,d),C=t(v);let M=a.get(C);M?_.push(()=>M.p(v,e)):(M=c(C,v),M.c()),P.set(C,g[d]=M),C in m&&w.set(C,Math.abs(d-m[C]))}const S=new Set,b=new Set;function R(v){F(v,1),v.m(o,f),a.set(v.key,v),f=v.first,p--}for(;h&&p;){const v=g[p-1],C=n[h-1],M=v.key,N=C.key;v===C?(f=v.first,h--,p--):P.has(N)?!a.has(M)||S.has(M)?R(v):b.has(N)?h--:w.get(M)>w.get(N)?(b.add(M),R(v)):(S.add(N),h--):(l(C,a),h--)}for(;h--;){const v=n[h];P.has(v.key)||l(v,a)}for(;p;)R(g[p-1]);return oe(_),g}function Ac(n,e){const t={},r={},s={$$scope:1};let i=n.length;for(;i--;){const a=n[i],o=e[i];if(o){for(const l in a)l in o||(r[l]=1);for(const l in o)s[l]||(t[l]=o[l],s[l]=1);n[i]=o}else for(const l in a)s[l]=1}for(const a in r)a in t||(t[a]=void 0);return t}function Pe(n,e,t){const r=n.$$.props[e];r!==void 0&&(n.$$.bound[r]=t,t(n.$$.ctx[r]))}function Y(n){n&&n.c()}function G(n,e,t){const{fragment:r,after_update:s}=n.$$;r&&r.m(e,t),lt(()=>{const i=n.$$.on_mount.map(Ta).filter(Qt);n.$$.on_destroy?n.$$.on_destroy.push(...i):oe(i),n.$$.on_mount=[]}),s.forEach(lt)}function Q(n,e){const t=n.$$;t.fragment!==null&&(yc(t.after_update),oe(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function kc(n,e){n.$$.dirty[0]===-1&&(mt.push(n),gc(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function de(n,e,t,r,s,i,a=null,o=[-1]){const l=Yt;Xt(n);const c=n.$$={fragment:null,ctx:[],props:i,update:ne,not_equal:s,bound:hi(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:hi(),dirty:o,skip_bound:!1,root:e.target||l.$$.root};a&&a(c.root);let f=!1;if(c.ctx=t?t(n,e.props||{},(u,h,...p)=>{const d=p.length?p[0]:h;return c.ctx&&s(c.ctx[u],c.ctx[u]=d)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](d),f&&kc(n,u)),h}):[],c.update(),f=!0,oe(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const u=ic(e.target);c.fragment&&c.fragment.l(u),u.forEach(U)}else c.fragment&&c.fragment.c();e.intro&&F(n.$$.fragment),G(n,e.target,e.anchor),Da()}Xt(l)}class he{constructor(){pe(this,"$$");pe(this,"$$set")}$destroy(){Q(this,1),this.$destroy=ne}$on(e,t){if(!Qt(t))return ne;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!Ql(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Pc="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Pc);const Kr="RFC3986",zr={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},Rc="RFC1738",Cc=Array.isArray,Be=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),Ar=1024,vc=(n,e,t,r,s)=>{if(n.length===0)return n;let i=n;if(typeof n=="symbol"?i=Symbol.prototype.toString.call(n):typeof n!="string"&&(i=String(n)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=Ar){const l=i.length>=Ar?i.slice(o,o+Ar):i,c=[];for(let f=0;f<l.length;++f){let u=l.charCodeAt(f);if(u===45||u===46||u===95||u===126||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||s===Rc&&(u===40||u===41)){c[c.length]=l.charAt(f);continue}if(u<128){c[c.length]=Be[u];continue}if(u<2048){c[c.length]=Be[192|u>>6]+Be[128|u&63];continue}if(u<55296||u>=57344){c[c.length]=Be[224|u>>12]+Be[128|u>>6&63]+Be[128|u&63];continue}f+=1,u=65536+((u&1023)<<10|l.charCodeAt(f)&1023),c[c.length]=Be[240|u>>18]+Be[128|u>>12&63]+Be[128|u>>6&63]+Be[128|u&63]}a+=c.join("")}return a};function xc(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function yi(n,e){if(Cc(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const Oc=Object.prototype.hasOwnProperty,Ua={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},De=Array.isArray,Tc=Array.prototype.push,$a=function(n,e){Tc.apply(n,De(e)?e:[e])},Mc=Date.prototype.toISOString,te={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:vc,encodeValuesOnly:!1,format:Kr,formatter:zr[Kr],indices:!1,serializeDate(n){return Mc.call(n)},skipNulls:!1,strictNullHandling:!1};function Ic(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const kr={};function ja(n,e,t,r,s,i,a,o,l,c,f,u,h,p,d,m,g,P){let w=n,_=P,S=0,b=!1;for(;(_=_.get(kr))!==void 0&&!b;){const N=_.get(n);if(S+=1,typeof N<"u"){if(N===S)throw new RangeError("Cyclic object value");b=!0}typeof _.get(kr)>"u"&&(S=0)}if(typeof c=="function"?w=c(e,w):w instanceof Date?w=h==null?void 0:h(w):t==="comma"&&De(w)&&(w=yi(w,function(N){return N instanceof Date?h==null?void 0:h(N):N})),w===null){if(i)return l&&!m?l(e,te.encoder,g,"key",p):e;w=""}if(Ic(w)||xc(w)){if(l){const N=m?e:l(e,te.encoder,g,"key",p);return[(d==null?void 0:d(N))+"="+(d==null?void 0:d(l(w,te.encoder,g,"value",p)))]}return[(d==null?void 0:d(e))+"="+(d==null?void 0:d(String(w)))]}const R=[];if(typeof w>"u")return R;let v;if(t==="comma"&&De(w))m&&l&&(w=yi(w,l)),v=[{value:w.length>0?w.join(",")||null:void 0}];else if(De(c))v=c;else{const N=Object.keys(w);v=f?N.sort(f):N}const C=o?String(e).replace(/\./g,"%2E"):String(e),M=r&&De(w)&&w.length===1?C+"[]":C;if(s&&De(w)&&w.length===0)return M+"[]";for(let N=0;N<v.length;++N){const T=v[N],me=typeof T=="object"&&typeof T.value<"u"?T.value:w[T];if(a&&me===null)continue;const Ue=u&&o?T.replace(/\./g,"%2E"):T,Ve=De(w)?typeof t=="function"?t(M,Ue):M:M+(u?"."+Ue:"["+Ue+"]");P.set(n,S);const Mt=new WeakMap;Mt.set(kr,P),$a(R,ja(me,Ve,t,r,s,i,a,o,t==="comma"&&m&&De(w)?null:l,c,f,u,h,p,d,m,g,Mt))}return R}function Nc(n=te){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||te.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Kr;if(typeof n.format<"u"){if(!Oc.call(zr,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=zr[t];let s=te.filter;(typeof n.filter=="function"||De(n.filter))&&(s=n.filter);let i;if(n.arrayFormat&&n.arrayFormat in Ua?i=n.arrayFormat:"indices"in n?i=n.indices?"indices":"repeat":i=te.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:te.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:te.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:te.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:te.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?te.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:te.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:te.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:te.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:te.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:te.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:te.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:te.strictNullHandling}}function Fc(n,e={}){let t=n;const r=Nc(e);let s,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):De(r.filter)&&(i=r.filter,s=i);const a=[];if(typeof t!="object"||t===null)return"";const o=Ua[r.arrayFormat],l=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);const c=new WeakMap;for(let h=0;h<s.length;++h){const p=s[h];r.skipNulls&&t[p]===null||$a(a,ja(t[p],p,o,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}const f=a.join(r.delimiter);let u=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),f.length>0?u+f:""}const pt="4.78.1";let wi=!1,Kt,Ha,Wa,Gr,Va,Ja,Xa,Ka,za;function Bc(n,e={auto:!1}){if(wi)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(Kt)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${Kt}'\``);wi=e.auto,Kt=n.kind,Ha=n.fetch,Wa=n.FormData,Gr=n.File,Va=n.ReadableStream,Ja=n.getMultipartRequestOptions,Xa=n.getDefaultAgent,Ka=n.fileFromPath,za=n.isFsReadStream}let Lc=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Dc({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new Lc(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}Kt||Bc(Dc(),{auto:!0});class q extends Error{}let be=class Qr extends q{constructor(e,t,r,s){super(`${Qr.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new er({message:r,cause:es(t)});const i=t==null?void 0:t.error;return e===400?new Ga(e,i,r,s):e===401?new Qa(e,i,r,s):e===403?new Ya(e,i,r,s):e===404?new Za(e,i,r,s):e===409?new eo(e,i,r,s):e===422?new to(e,i,r,s):e===429?new no(e,i,r,s):e>=500?new ro(e,i,r,s):new Qr(e,i,r,s)}},Me=class extends be{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},er=class extends be{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Ps=class extends er{constructor({message:e}={}){super({message:e??"Request timed out."})}},Ga=class extends be{},Qa=class extends be{},Ya=class extends be{},Za=class extends be{},eo=class extends be{},to=class extends be{},no=class extends be{},ro=class extends be{};class so extends q{constructor(){super("Could not parse response content as the length limit was reached")}}class io extends q{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}let tr=class Yr{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=Yr.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(Yr.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new q(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new q(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new q("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};tr.NEWLINE_CHARS=new Set([`
`,"\r"]);tr.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let Zt=class Ut{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of qc(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null){let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(o&&o.error)throw new be(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(a.event=="error")throw new be(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Ut(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new tr,o=ao(e);for await(const l of o)for(const c of a.decode(l))yield c;for(const l of a.flush())yield l}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Ut(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new Ut(()=>s(e),this.controller),new Ut(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new Va({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}};async function*qc(n,e){if(!n.body)throw e.abort(),new q("Attempted to iterate over a response with no body");const t=new jc,r=new tr,s=ao(n.body);for await(const i of Uc(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*Uc(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=$c(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function $c(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}let jc=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=Hc(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function Hc(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function ao(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const oo=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",lo=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&nr(n),nr=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Wc=n=>lo(n)||oo(n)||za(n);async function co(n,e,t){var s;if(n=await n,lo(n))return n;if(oo(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=nr(i)?[await i.arrayBuffer()]:[i];return new Gr(a,e,t)}const r=await Vc(n);if(e||(e=Xc(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new Gr(r,e,t)}async function Vc(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(nr(n))e.push(await n.arrayBuffer());else if(Kc(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${Jc(n)}`);return e}function Jc(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Xc(n){var e;return Pr(n.name)||Pr(n.filename)||((e=Pr(n.path))==null?void 0:e.split(/[\\/]/).pop())}const Pr=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Kc=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",bi=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",Rt=async n=>{const e=await zc(n.body);return Ja(e,n)},zc=async n=>{const e=new Wa;return await Promise.all(Object.entries(n||{}).map(([t,r])=>Zr(e,t,r))),e},Zr=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(Wc(t)){const r=await co(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>Zr(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>Zr(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Gc=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Qc=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},pn;async function uo(n){const{response:e}=n;if(n.options.stream)return Et("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Zt.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return Et("response",e.status,e.url,e.headers,i),fo(i,e)}const s=await e.text();return Et("response",e.status,e.url,e.headers,s),s}function fo(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}let ho=class mo extends Promise{constructor(e,t=uo){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new mo(this.responsePromise,async t=>fo(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Yc=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Rr("maxRetries",t),this.timeout=Rr("timeout",r),this.httpAgent=s,this.fetch=i??Ha}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...su(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${lu()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&nr(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var m;const{method:r,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:bi(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),c=this.buildURL(s,i);"timeout"in e&&Rr("timeout",e.timeout);const f=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??Xa(c),h=f+1e3;typeof((m=u==null?void 0:u.options)==null?void 0:m.timeout)=="number"&&h>(u.options.timeout??0)&&(u.options.timeout=h),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const p=this.buildHeaders({options:e,headers:a,contentLength:l,retryCount:t});return{req:{method:r,...o&&{body:o},headers:p,...u&&{agent:u},signal:e.signal??null},url:c,timeout:f}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const a=this.defaultHeaders(e);return ki(i,a),ki(i,t),bi(e.body)&&Kt!=="node"&&delete i["content-type"],Pi(a,"x-stainless-retry-count")===void 0&&Pi(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return be.generate(e,t,r,s)}request(e,t=null){return new ho(this.makeRequest(e,t))}async makeRequest(e,t){var u,h;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),Et("request",a,r,i.headers),(u=r.signal)!=null&&u.aborted)throw new Me;const l=new AbortController,c=await this.fetchWithTimeout(a,i,o,l).catch(es);if(c instanceof Error){if((h=r.signal)!=null&&h.aborted)throw new Me;if(t)return this.retryRequest(r,t);throw c.name==="AbortError"?new Ps:new er({cause:c})}const f=eu(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const w=`retrying, ${t} attempts remaining`;return Et(`response (error; ${w})`,c.status,a,f),this.retryRequest(r,t,f)}const p=await c.text().catch(w=>es(w).message),d=iu(p),m=d?void 0:p;throw Et(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,f,m),this.makeStatusError(c.status,d,m,f)}return{response:c,options:r,controller:l}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new Zc(this,r,e)}buildURL(e,t){const r=ou(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return go(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new q(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r),l={signal:s.signal,...a};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await sn(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${pt}`}},po=class{constructor(e,t,r,s){pn.set(this,void 0),Gc(this,pn,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new q("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await Qc(this,pn,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(pn=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},Zc=class extends ho{constructor(e,t,r){super(t,async s=>new r(e,s.response,await uo(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}};const eu=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),tu={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Se=n=>typeof n=="object"&&n!==null&&!go(n)&&Object.keys(n).every(e=>_o(tu,e)),nu=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pt,"X-Stainless-OS":Ei(Deno.build.os),"X-Stainless-Arch":Si(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pt,"X-Stainless-OS":Ei(process.platform),"X-Stainless-Arch":Si(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=ru();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function ru(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const Si=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Ei=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Ai;const su=()=>Ai??(Ai=nu()),iu=n=>{try{return JSON.parse(n)}catch{return}},au=/^[a-z][a-z0-9+.-]*:/i,ou=n=>au.test(n),sn=n=>new Promise(e=>setTimeout(e,n)),Rr=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new q(`${n} must be an integer`);if(e<0)throw new q(`${n} must be a positive integer`);return e},es=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)},gn=n=>{var e,t,r,s,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,n))==null?void 0:i.trim()};function go(n){if(!n)return!0;for(const e in n)return!1;return!0}function _o(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function ki(n,e){for(const t in e){if(!_o(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function Et(n,...e){var t;typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const lu=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),cu=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",uu=n=>typeof(n==null?void 0:n.get)=="function",Pi=(n,e)=>{var r;const t=e.toLowerCase();if(uu(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=n.get(i);if(a)return a}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};function Cr(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}let fu=class extends po{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}};class Ne extends po{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}}let W=class{constructor(e){this._client=e}},yo=class extends W{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},Rs=class extends W{constructor(){super(...arguments),this.completions=new yo(this._client)}};Rs.Completions=yo;class wo extends W{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class bo extends W{create(e,t){return this._client.post("/audio/transcriptions",Rt({body:e,...t}))}}class So extends W{create(e,t){return this._client.post("/audio/translations",Rt({body:e,...t}))}}class an extends W{constructor(){super(...arguments),this.transcriptions=new bo(this._client),this.translations=new So(this._client),this.speech=new wo(this._client)}}an.Transcriptions=bo;an.Translations=So;an.Speech=wo;let Cs=class extends W{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Se(e)?this.list({},e):this._client.getAPIList("/batches",vs,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}};class vs extends Ne{}Cs.BatchesPage=vs;class xs extends W{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return Se(e)?this.list({},e):this._client.getAPIList("/assistants",Os,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Os extends Ne{}xs.AssistantsPage=Os;function Ri(n){return typeof n.parse=="function"}const At=n=>(n==null?void 0:n.role)==="assistant",Eo=n=>(n==null?void 0:n.role)==="function",Ao=n=>(n==null?void 0:n.role)==="tool";var Oe=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},K=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ts,Cn,vn,$t,jt,xn,Ht,He,Wt,$n,jn,gt,ko;class Po{constructor(){ts.add(this),this.controller=new AbortController,Cn.set(this,void 0),vn.set(this,()=>{}),$t.set(this,()=>{}),jt.set(this,void 0),xn.set(this,()=>{}),Ht.set(this,()=>{}),He.set(this,{}),Wt.set(this,!1),$n.set(this,!1),jn.set(this,!1),gt.set(this,!1),Oe(this,Cn,new Promise((e,t)=>{Oe(this,vn,e,"f"),Oe(this,$t,t,"f")}),"f"),Oe(this,jt,new Promise((e,t)=>{Oe(this,xn,e,"f"),Oe(this,Ht,t,"f")}),"f"),K(this,Cn,"f").catch(()=>{}),K(this,jt,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},K(this,ts,"m",ko).bind(this))},0)}_connected(){this.ended||(K(this,vn,"f").call(this),this._emit("connect"))}get ended(){return K(this,Wt,"f")}get errored(){return K(this,$n,"f")}get aborted(){return K(this,jn,"f")}abort(){this.controller.abort()}on(e,t){return(K(this,He,"f")[e]||(K(this,He,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=K(this,He,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(K(this,He,"f")[e]||(K(this,He,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Oe(this,gt,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Oe(this,gt,!0,"f"),await K(this,jt,"f")}_emit(e,...t){if(K(this,Wt,"f"))return;e==="end"&&(Oe(this,Wt,!0,"f"),K(this,xn,"f").call(this));const r=K(this,He,"f")[e];if(r&&(K(this,He,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!K(this,gt,"f")&&!(r!=null&&r.length)&&Promise.reject(s),K(this,$t,"f").call(this,s),K(this,Ht,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!K(this,gt,"f")&&!(r!=null&&r.length)&&Promise.reject(s),K(this,$t,"f").call(this,s),K(this,Ht,"f").call(this,s),this._emit("end")}}_emitFinal(){}}Cn=new WeakMap,vn=new WeakMap,$t=new WeakMap,jt=new WeakMap,xn=new WeakMap,Ht=new WeakMap,He=new WeakMap,Wt=new WeakMap,$n=new WeakMap,jn=new WeakMap,gt=new WeakMap,ts=new WeakSet,ko=function(e){if(Oe(this,$n,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Me),e instanceof Me)return Oe(this,jn,!0,"f"),this._emit("abort",e);if(e instanceof q)return this._emit("error",e);if(e instanceof Error){const t=new q(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new q(String(e)))};function Ro(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function on(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function du(n,e){return!e||!Co(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:Ts(n,e)}function Ts(n,e){const t=n.choices.map(r=>{var s;if(r.finish_reason==="length")throw new so;if(r.finish_reason==="content_filter")throw new io;return{...r,message:{...r.message,tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(i=>mu(e,i)))??[],parsed:r.message.content&&!r.message.refusal?hu(e,r.message.content):null}}});return{...n,choices:t}}function hu(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function mu(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:on(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function pu(n,e){var r;if(!n)return!1;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return on(t)||(t==null?void 0:t.function.strict)||!1}function Co(n){var e;return Ro(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>on(t)||t.type==="function"&&t.function.strict===!0))??!1}function gu(n){for(const e of n??[]){if(e.type!=="function")throw new q(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new q(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var _e=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},le,ns,Hn,rs,ss,is,vo,as;const Ci=10;class xo extends Po{constructor(){super(...arguments),le.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Eo(e)||Ao(e))&&e.content)this._emit("functionCallResult",e.content);else if(At(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(At(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new q("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),_e(this,le,"m",ns).call(this)}async finalMessage(){return await this.done(),_e(this,le,"m",Hn).call(this)}async finalFunctionCall(){return await this.done(),_e(this,le,"m",rs).call(this)}async finalFunctionCallResult(){return await this.done(),_e(this,le,"m",ss).call(this)}async totalUsage(){return await this.done(),_e(this,le,"m",is).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=_e(this,le,"m",Hn).call(this);t&&this._emit("finalMessage",t);const r=_e(this,le,"m",ns).call(this);r&&this._emit("finalContent",r);const s=_e(this,le,"m",rs).call(this);s&&this._emit("finalFunctionCall",s);const i=_e(this,le,"m",ss).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",_e(this,le,"m",is).call(this))}async _createChatCompletion(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),_e(this,le,"m",vo).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Ts(i,t))}async _runChatCompletion(e,t,r){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var h;const s="function",{function_call:i="auto",stream:a,...o}=t,l=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:c=Ci}=r||{},f={};for(const p of t.functions)f[p.name||p.function.name]=p;const u=t.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(const p of t.messages)this._addMessage(p,!1);for(let p=0;p<c;++p){const m=(h=(await this._createChatCompletion(e,{...o,function_call:i,functions:u,messages:[...this.messages]},r)).choices[0])==null?void 0:h.message;if(!m)throw new q("missing message in ChatCompletion response");if(!m.function_call)return;const{name:g,arguments:P}=m.function_call,w=f[g];if(w){if(l&&l!==g){const R=`Invalid function_call: ${JSON.stringify(g)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:g,content:R});continue}}else{const R=`Invalid function_call: ${JSON.stringify(g)}. Available options are: ${u.map(v=>JSON.stringify(v.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:g,content:R});continue}let _;try{_=Ri(w)?await w.parse(P):P}catch(R){this._addMessage({role:s,name:g,content:R instanceof Error?R.message:String(R)});continue}const S=await w.function(_,this),b=_e(this,le,"m",as).call(this,S);if(this._addMessage({role:s,name:g,content:b}),l)return}}async _runTools(e,t,r){var p,d,m;const s="tool",{tool_choice:i="auto",stream:a,...o}=t,l=typeof i!="string"&&((p=i==null?void 0:i.function)==null?void 0:p.name),{maxChatCompletions:c=Ci}=r||{},f=t.tools.map(g=>{if(on(g)){if(!g.$callback)throw new q("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:g.$callback,name:g.function.name,description:g.function.description||"",parameters:g.function.parameters,parse:g.$parseRaw,strict:!0}}}return g}),u={};for(const g of f)g.type==="function"&&(u[g.function.name||g.function.function.name]=g.function);const h="tools"in t?f.map(g=>g.type==="function"?{type:"function",function:{name:g.function.name||g.function.function.name,parameters:g.function.parameters,description:g.function.description,strict:g.function.strict}}:g):void 0;for(const g of t.messages)this._addMessage(g,!1);for(let g=0;g<c;++g){const w=(d=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:h,messages:[...this.messages]},r)).choices[0])==null?void 0:d.message;if(!w)throw new q("missing message in ChatCompletion response");if(!((m=w.tool_calls)!=null&&m.length))return;for(const _ of w.tool_calls){if(_.type!=="function")continue;const S=_.id,{name:b,arguments:R}=_.function,v=u[b];if(v){if(l&&l!==b){const T=`Invalid tool_call: ${JSON.stringify(b)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:S,content:T});continue}}else{const T=`Invalid tool_call: ${JSON.stringify(b)}. Available options are: ${Object.keys(u).map(me=>JSON.stringify(me)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:S,content:T});continue}let C;try{C=Ri(v)?await v.parse(R):R}catch(T){const me=T instanceof Error?T.message:String(T);this._addMessage({role:s,tool_call_id:S,content:me});continue}const M=await v.function(C,this),N=_e(this,le,"m",as).call(this,M);if(this._addMessage({role:s,tool_call_id:S,content:N}),l)return}}}}le=new WeakSet,ns=function(){return _e(this,le,"m",Hn).call(this).content??null},Hn=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(At(t)){const{function_call:r,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return r&&(i.function_call=r),i}}throw new q("stream ended without producing a ChatCompletionMessage with role=assistant")},rs=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(At(s)&&(s!=null&&s.function_call))return s.function_call;if(At(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},ss=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Eo(t)&&t.content!=null||Ao(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},is=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},vo=function(e){if(e.n!=null&&e.n>1)throw new q("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},as=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class en extends xo{static runFunctions(e,t,r){const s=new en,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new en,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),At(e)&&e.content&&this._emit("content",e.content)}}const Oo=1,To=2,Mo=4,Io=8,No=16,Fo=32,Bo=64,Lo=128,Do=256,qo=Lo|Do,Uo=No|Fo|qo|Bo,$o=Oo|To|Uo,jo=Mo|Io,_u=$o|jo,re={STR:Oo,NUM:To,ARR:Mo,OBJ:Io,NULL:No,BOOL:Fo,NAN:Bo,INFINITY:Lo,MINUS_INFINITY:Do,INF:qo,SPECIAL:Uo,ATOM:$o,COLLECTION:jo,ALL:_u};class yu extends Error{}class wu extends Error{}function bu(n,e=re.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return Su(n.trim(),e)}const Su=(n,e)=>{const t=n.length;let r=0;const s=h=>{throw new yu(`${h} at position ${r}`)},i=h=>{throw new wu(`${h} at position ${r}`)},a=()=>(u(),r>=t&&s("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?l():n[r]==="["?c():n.substring(r,r+4)==="null"||re.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||re.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||re.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||re.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||re.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||re.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):f()),o=()=>{const h=r;let p=!1;for(r++;r<t&&(n[r]!=='"'||p&&n[r-1]==="\\");)p=n[r]==="\\"?!p:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(h,++r-Number(p)))}catch(d){i(String(d))}else if(re.STR&e)try{return JSON.parse(n.substring(h,r-Number(p))+'"')}catch{return JSON.parse(n.substring(h,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{r++,u();const h={};try{for(;n[r]!=="}";){if(u(),r>=t&&re.OBJ&e)return h;const p=o();u(),r++;try{const d=a();Object.defineProperty(h,p,{value:d,writable:!0,enumerable:!0,configurable:!0})}catch(d){if(re.OBJ&e)return h;throw d}u(),n[r]===","&&r++}}catch{if(re.OBJ&e)return h;s("Expected '}' at end of object")}return r++,h},c=()=>{r++;const h=[];try{for(;n[r]!=="]";)h.push(a()),u(),n[r]===","&&r++}catch{if(re.ARR&e)return h;s("Expected ']' at end of array")}return r++,h},f=()=>{if(r===0){n==="-"&&re.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(p){if(re.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}i(String(p))}}const h=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(re.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(h,r))}catch{n.substring(h,r)==="-"&&re.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(h,n.lastIndexOf("e")))}catch(d){i(String(d))}}},u=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return a()},vi=n=>bu(n,re.ALL^re.NUM);var ft=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},V=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ee,$e,dt,Je,vr,_n,xr,Or,Tr,yn,Mr,xi;class tn extends xo{constructor(e){super(),ee.add(this),$e.set(this,void 0),dt.set(this,void 0),Je.set(this,void 0),ft(this,$e,e,"f"),ft(this,dt,[],"f")}get currentChatCompletionSnapshot(){return V(this,Je,"f")}static fromReadableStream(e){const t=new tn(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const s=new tn(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var a;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),V(this,ee,"m",vr).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)V(this,ee,"m",xr).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new Me;return this._addChatCompletion(V(this,ee,"m",yn).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),V(this,ee,"m",vr).call(this),this._connected();const s=Zt.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(V(this,ee,"m",yn).call(this)),V(this,ee,"m",xr).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new Me;return this._addChatCompletion(V(this,ee,"m",yn).call(this))}[($e=new WeakMap,dt=new WeakMap,Je=new WeakMap,ee=new WeakSet,vr=function(){this.ended||ft(this,Je,void 0,"f")},_n=function(t){let r=V(this,dt,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},V(this,dt,"f")[t.index]=r,r)},xr=function(t){var s,i,a,o,l,c,f,u,h,p,d,m,g,P,w;if(this.ended)return;const r=V(this,ee,"m",xi).call(this,t);this._emit("chunk",t,r);for(const _ of t.choices){const S=r.choices[_.index];_.delta.content!=null&&((s=S.message)==null?void 0:s.role)==="assistant"&&((i=S.message)!=null&&i.content)&&(this._emit("content",_.delta.content,S.message.content),this._emit("content.delta",{delta:_.delta.content,snapshot:S.message.content,parsed:S.message.parsed})),_.delta.refusal!=null&&((a=S.message)==null?void 0:a.role)==="assistant"&&((o=S.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:_.delta.refusal,snapshot:S.message.refusal}),((l=_.logprobs)==null?void 0:l.content)!=null&&((c=S.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(f=_.logprobs)==null?void 0:f.content,snapshot:((u=S.logprobs)==null?void 0:u.content)??[]}),((h=_.logprobs)==null?void 0:h.refusal)!=null&&((p=S.message)==null?void 0:p.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(d=_.logprobs)==null?void 0:d.refusal,snapshot:((m=S.logprobs)==null?void 0:m.refusal)??[]});const b=V(this,ee,"m",_n).call(this,S);S.finish_reason&&(V(this,ee,"m",Tr).call(this,S),b.current_tool_call_index!=null&&V(this,ee,"m",Or).call(this,S,b.current_tool_call_index));for(const R of _.delta.tool_calls??[])b.current_tool_call_index!==R.index&&(V(this,ee,"m",Tr).call(this,S),b.current_tool_call_index!=null&&V(this,ee,"m",Or).call(this,S,b.current_tool_call_index)),b.current_tool_call_index=R.index;for(const R of _.delta.tool_calls??[]){const v=(g=S.message.tool_calls)==null?void 0:g[R.index];v!=null&&v.type&&((v==null?void 0:v.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(P=v.function)==null?void 0:P.name,index:R.index,arguments:v.function.arguments,parsed_arguments:v.function.parsed_arguments,arguments_delta:((w=R.function)==null?void 0:w.arguments)??""}):(v==null||v.type,void 0))}}},Or=function(t,r){var a,o,l;if(V(this,ee,"m",_n).call(this,t).done_tool_calls.has(r))return;const i=(a=t.message.tool_calls)==null?void 0:a[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const c=(l=(o=V(this,$e,"f"))==null?void 0:o.tools)==null?void 0:l.find(f=>f.type==="function"&&f.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:on(c)?c.$parseRaw(i.function.arguments):c!=null&&c.function.strict?JSON.parse(i.function.arguments):null})}else i.type},Tr=function(t){var s,i;const r=V(this,ee,"m",_n).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const a=V(this,ee,"m",Mr).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},yn=function(){if(this.ended)throw new q("stream has ended, this shouldn't happen");const t=V(this,Je,"f");if(!t)throw new q("request ended without sending any chunks");return ft(this,Je,void 0,"f"),ft(this,dt,[],"f"),Eu(t,V(this,$e,"f"))},Mr=function(){var r;const t=(r=V(this,$e,"f"))==null?void 0:r.response_format;return Ro(t)?t:null},xi=function(t){var r,s,i,a;let o=V(this,Je,"f");const{choices:l,...c}=t;o?Object.assign(o,c):o=ft(this,Je,{...c,choices:[]},"f");for(const{delta:f,finish_reason:u,index:h,logprobs:p=null,...d}of t.choices){let m=o.choices[h];if(m||(m=o.choices[h]={finish_reason:u,index:h,message:{},logprobs:p,...d}),p)if(!m.logprobs)m.logprobs=Object.assign({},p);else{const{content:R,refusal:v,...C}=p;Object.assign(m.logprobs,C),R&&((r=m.logprobs).content??(r.content=[]),m.logprobs.content.push(...R)),v&&((s=m.logprobs).refusal??(s.refusal=[]),m.logprobs.refusal.push(...v))}if(u&&(m.finish_reason=u,V(this,$e,"f")&&Co(V(this,$e,"f")))){if(u==="length")throw new so;if(u==="content_filter")throw new io}if(Object.assign(m,d),!f)continue;const{content:g,refusal:P,function_call:w,role:_,tool_calls:S,...b}=f;if(Object.assign(m.message,b),P&&(m.message.refusal=(m.message.refusal||"")+P),_&&(m.message.role=_),w&&(m.message.function_call?(w.name&&(m.message.function_call.name=w.name),w.arguments&&((i=m.message.function_call).arguments??(i.arguments=""),m.message.function_call.arguments+=w.arguments)):m.message.function_call=w),g&&(m.message.content=(m.message.content||"")+g,!m.message.refusal&&V(this,ee,"m",Mr).call(this)&&(m.message.parsed=vi(m.message.content))),S){m.message.tool_calls||(m.message.tool_calls=[]);for(const{index:R,id:v,type:C,function:M,...N}of S){const T=(a=m.message.tool_calls)[R]??(a[R]={});Object.assign(T,N),v&&(T.id=v),C&&(T.type=C),M&&(T.function??(T.function={name:M.name??"",arguments:""})),M!=null&&M.name&&(T.function.name=M.name),M!=null&&M.arguments&&(T.function.arguments+=M.arguments,pu(V(this,$e,"f"),T)&&(T.function.parsed_arguments=vi(T.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Zt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Eu(n,e){const{id:t,choices:r,created:s,model:i,system_fingerprint:a,...o}=n,l={...o,id:t,choices:r.map(({message:c,finish_reason:f,index:u,logprobs:h,...p})=>{if(!f)throw new q(`missing finish_reason for choice ${u}`);const{content:d=null,function_call:m,tool_calls:g,...P}=c,w=c.role;if(!w)throw new q(`missing role for choice ${u}`);if(m){const{arguments:_,name:S}=m;if(_==null)throw new q(`missing function_call.arguments for choice ${u}`);if(!S)throw new q(`missing function_call.name for choice ${u}`);return{...p,message:{content:d,function_call:{arguments:_,name:S},role:w,refusal:c.refusal??null},finish_reason:f,index:u,logprobs:h}}return g?{...p,index:u,finish_reason:f,logprobs:h,message:{...P,role:w,content:d,refusal:c.refusal??null,tool_calls:g.map((_,S)=>{const{function:b,type:R,id:v,...C}=_,{arguments:M,name:N,...T}=b||{};if(v==null)throw new q(`missing choices[${u}].tool_calls[${S}].id
${wn(n)}`);if(R==null)throw new q(`missing choices[${u}].tool_calls[${S}].type
${wn(n)}`);if(N==null)throw new q(`missing choices[${u}].tool_calls[${S}].function.name
${wn(n)}`);if(M==null)throw new q(`missing choices[${u}].tool_calls[${S}].function.arguments
${wn(n)}`);return{...C,id:v,type:R,function:{...T,name:N,arguments:M}}})}}:{...p,message:{...P,content:d,role:w,refusal:c.refusal??null},finish_reason:f,index:u,logprobs:h}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return du(l,e)}function wn(n){return JSON.stringify(n)}class kt extends tn{static fromReadableStream(e){const t=new kt(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const s=new kt(null),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new kt(t),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}let Ho=class extends W{parse(e,t){return gu(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>Ts(r,e))}runFunctions(e,t){return e.stream?kt.runFunctions(this._client,e,t):en.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?kt.runTools(this._client,e,t):en.runTools(this._client,e,t)}stream(e,t){return tn.createChatCompletion(this._client,e,t)}},Wo=class extends W{constructor(){super(...arguments),this.completions=new Ho(this._client)}};(function(n){n.Completions=Ho})(Wo);class Vo extends W{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Ms extends W{constructor(){super(...arguments),this.sessions=new Vo(this._client)}}Ms.Sessions=Vo;var I=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ee=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},ae,os,qe,On,Te,tt,wt,Ze,Wn,Ae,Tn,Mn,zt,Vt,Jt,Oi,Ti,Mi,Ii,Ni,Fi,Bi;class Ie extends Po{constructor(){super(...arguments),ae.add(this),os.set(this,[]),qe.set(this,{}),On.set(this,{}),Te.set(this,void 0),tt.set(this,void 0),wt.set(this,void 0),Ze.set(this,void 0),Wn.set(this,void 0),Ae.set(this,void 0),Tn.set(this,void 0),Mn.set(this,void 0),zt.set(this,void 0)}[(os=new WeakMap,qe=new WeakMap,On=new WeakMap,Te=new WeakMap,tt=new WeakMap,wt=new WeakMap,Ze=new WeakMap,Wn=new WeakMap,Ae=new WeakMap,Tn=new WeakMap,Mn=new WeakMap,zt=new WeakMap,ae=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Ie;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=Zt.fromReadableStream(e,this.controller);for await(const a of s)I(this,ae,"m",Vt).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new Me;return this._addRun(I(this,ae,"m",Jt).call(this))}toReadableStream(){return new Zt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,i){const a=new Ie;return a._run(()=>a._runToolAssistantStream(e,t,r,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,r,s,i){var c;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},l=await e.submitToolOutputs(t,r,o,{...i,signal:this.controller.signal});this._connected();for await(const f of l)I(this,ae,"m",Vt).call(this,f);if((c=l.controller.signal)!=null&&c.aborted)throw new Me;return this._addRun(I(this,ae,"m",Jt).call(this))}static createThreadAssistantStream(e,t,r){const s=new Ie;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){const i=new Ie;return i._run(()=>i._runAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return I(this,Tn,"f")}currentRun(){return I(this,Mn,"f")}currentMessageSnapshot(){return I(this,Te,"f")}currentRunStepSnapshot(){return I(this,zt,"f")}async finalRunSteps(){return await this.done(),Object.values(I(this,qe,"f"))}async finalMessages(){return await this.done(),Object.values(I(this,On,"f"))}async finalRun(){if(await this.done(),!I(this,tt,"f"))throw Error("Final run was not received.");return I(this,tt,"f")}async _createThreadAssistantStream(e,t,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const l of a)I(this,ae,"m",Vt).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new Me;return this._addRun(I(this,ae,"m",Jt).call(this))}async _createAssistantStream(e,t,r,s){var l;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const c of o)I(this,ae,"m",Vt).call(this,c);if((l=o.controller.signal)!=null&&l.aborted)throw new Me;return this._addRun(I(this,ae,"m",Jt).call(this))}static accumulateDelta(e,t){for(const[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(Cr(i)&&Cr(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(const a of s){if(!Cr(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=i[o];l==null?i.push(a):i[o]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,i){return await this._createToolAssistantStream(r,e,t,s,i)}}Vt=function(e){if(!this.ended)switch(Ee(this,Tn,e,"f"),I(this,ae,"m",Mi).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":I(this,ae,"m",Bi).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":I(this,ae,"m",Ti).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":I(this,ae,"m",Oi).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Jt=function(){if(this.ended)throw new q("stream has ended, this shouldn't happen");if(!I(this,tt,"f"))throw Error("Final run has not been received");return I(this,tt,"f")},Oi=function(e){const[t,r]=I(this,ae,"m",Ni).call(this,e,I(this,Te,"f"));Ee(this,Te,t,"f"),I(this,On,"f")[t.id]=t;for(const s of r){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=I(this,wt,"f")){if(I(this,Ze,"f"))switch(I(this,Ze,"f").type){case"text":this._emit("textDone",I(this,Ze,"f").text,I(this,Te,"f"));break;case"image_file":this._emit("imageFileDone",I(this,Ze,"f").image_file,I(this,Te,"f"));break}Ee(this,wt,s.index,"f")}Ee(this,Ze,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(I(this,wt,"f")!==void 0){const s=e.data.content[I(this,wt,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,I(this,Te,"f"));break;case"text":this._emit("textDone",s.text,I(this,Te,"f"));break}}I(this,Te,"f")&&this._emit("messageDone",e.data),Ee(this,Te,void 0,"f")}},Ti=function(e){const t=I(this,ae,"m",Ii).call(this,e);switch(Ee(this,zt,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==I(this,Wn,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(I(this,Ae,"f")&&this._emit("toolCallDone",I(this,Ae,"f")),Ee(this,Wn,i.index,"f"),Ee(this,Ae,t.step_details.tool_calls[i.index],"f"),I(this,Ae,"f")&&this._emit("toolCallCreated",I(this,Ae,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Ee(this,zt,void 0,"f"),e.data.step_details.type=="tool_calls"&&I(this,Ae,"f")&&(this._emit("toolCallDone",I(this,Ae,"f")),Ee(this,Ae,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Mi=function(e){I(this,os,"f").push(e),this._emit("event",e)},Ii=function(e){switch(e.event){case"thread.run.step.created":return I(this,qe,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=I(this,qe,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=Ie.accumulateDelta(t,r.delta);I(this,qe,"f")[e.data.id]=s}return I(this,qe,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":I(this,qe,"f")[e.data.id]=e.data;break}if(I(this,qe,"f")[e.data.id])return I(this,qe,"f")[e.data.id];throw new Error("No snapshot available")},Ni=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=I(this,ae,"m",Fi).call(this,i,a)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Fi=function(e,t){return Ie.accumulateDelta(t,e)},Bi=function(e){switch(Ee(this,Mn,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Ee(this,tt,e.data,"f"),I(this,Ae,"f")&&(this._emit("toolCallDone",I(this,Ae,"f")),Ee(this,Ae,void 0,"f"));break}};let Is=class extends W{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return Se(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Ns,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}};class Ns extends Ne{}Is.MessagesPage=Ns;class Fs extends W{retrieve(e,t,r,s={},i){return Se(s)?this.retrieve(e,t,r,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,r={},s){return Se(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Bs,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Bs extends Ne{}Fs.RunStepsPage=Bs;class ln extends W{constructor(){super(...arguments),this.steps=new Fs(this._client)}create(e,t,r){const{include:s,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return Se(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Ls,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return Ie.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await sn(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return Ie.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,s){const i=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,r,s){return Ie.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}}class Ls extends Ne{}ln.RunsPage=Ls;ln.Steps=Fs;ln.RunStepsPage=Bs;class Ct extends W{constructor(){super(...arguments),this.runs=new ln(this._client),this.messages=new Is(this._client)}create(e={},t){return Se(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return Ie.createThreadAssistantStream(e,this._client.beta.threads,t)}}Ct.Runs=ln;Ct.RunsPage=Ls;Ct.Messages=Is;Ct.MessagesPage=Ns;const Au=async n=>{const e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};let Ds=class extends W{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},r){return Se(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,rr,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...r,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=i.response.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await sn(o);break;case"failed":case"completed":return a}}}async upload(e,t,r){const s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){const s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}};class rr extends Ne{}Ds.VectorStoreFilesPage=rr;class Jo extends W{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r={},s){return Se(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,rr,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await sn(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,t.length),o=this._client,l=t.values(),c=[...r];async function f(h){for(let p of h){const d=await o.files.create({file:p,purpose:"assistants"},s);c.push(d.id)}}const u=Array(a).fill(l).map(f);return await Au(u),await this.createAndPoll(e,{file_ids:c})}}class vt extends W{constructor(){super(...arguments),this.files=new Ds(this._client),this.fileBatches=new Jo(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return Se(e)?this.list({},e):this._client.getAPIList("/vector_stores",qs,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class qs extends Ne{}vt.VectorStoresPage=qs;vt.Files=Ds;vt.VectorStoreFilesPage=rr;vt.FileBatches=Jo;let Ge=class extends W{constructor(){super(...arguments),this.realtime=new Ms(this._client),this.vectorStores=new vt(this._client),this.chat=new Wo(this._client),this.assistants=new xs(this._client),this.threads=new Ct(this._client)}};Ge.Realtime=Ms;Ge.VectorStores=vt;Ge.VectorStoresPage=qs;Ge.Assistants=xs;Ge.AssistantsPage=Os;Ge.Threads=Ct;let Xo=class extends W{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};class Ko extends W{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class Us extends W{create(e,t){return this._client.post("/files",Rt({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Se(e)?this.list({},e):this._client.getAPIList("/files",$s,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await sn(t),a=await this.retrieve(e),Date.now()-i>r)throw new Ps({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class $s extends Ne{}Us.FileObjectsPage=$s;class js extends W{list(e,t={},r){return Se(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Hs,{query:t,...r})}}class Hs extends Ne{}js.FineTuningJobCheckpointsPage=Hs;class xt extends W{constructor(){super(...arguments),this.checkpoints=new js(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Se(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Ws,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return Se(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Vs,{query:t,...r})}}class Ws extends Ne{}class Vs extends Ne{}xt.FineTuningJobsPage=Ws;xt.FineTuningJobEventsPage=Vs;xt.Checkpoints=js;xt.FineTuningJobCheckpointsPage=Hs;class cn extends W{constructor(){super(...arguments),this.jobs=new xt(this._client)}}cn.Jobs=xt;cn.FineTuningJobsPage=Ws;cn.FineTuningJobEventsPage=Vs;class zo extends W{createVariation(e,t){return this._client.post("/images/variations",Rt({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Rt({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}let Js=class extends W{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Xs,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}};class Xs extends fu{}Js.ModelsPage=Xs;class Go extends W{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class Qo extends W{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,Rt({body:t,...r}))}}class Ks extends W{constructor(){super(...arguments),this.parts=new Qo(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}}Ks.Parts=Qo;var Yo;class $ extends Yc{constructor({baseURL:e=gn("OPENAI_BASE_URL"),apiKey:t=gn("OPENAI_API_KEY"),organization:r=gn("OPENAI_ORG_ID")??null,project:s=gn("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new q("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:r,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&cu())throw new q(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new Xo(this),this.chat=new Rs(this),this.embeddings=new Ko(this),this.files=new Us(this),this.images=new zo(this),this.audio=new an(this),this.moderations=new Go(this),this.models=new Js(this),this.fineTuning=new cn(this),this.beta=new Ge(this),this.batches=new Cs(this),this.uploads=new Ks(this),this._options=a,this.apiKey=t,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Fc(e,{arrayFormat:"brackets"})}}Yo=$;$.OpenAI=Yo;$.DEFAULT_TIMEOUT=6e5;$.OpenAIError=q;$.APIError=be;$.APIConnectionError=er;$.APIConnectionTimeoutError=Ps;$.APIUserAbortError=Me;$.NotFoundError=Za;$.ConflictError=eo;$.RateLimitError=no;$.BadRequestError=Ga;$.AuthenticationError=Qa;$.InternalServerError=ro;$.PermissionDeniedError=Ya;$.UnprocessableEntityError=to;$.toFile=co;$.fileFromPath=Ka;$.Completions=Xo;$.Chat=Rs;$.Embeddings=Ko;$.Files=Us;$.FileObjectsPage=$s;$.Images=zo;$.Audio=an;$.Moderations=Go;$.Models=Js;$.ModelsPage=Xs;$.FineTuning=cn;$.Beta=Ge;$.Batches=Cs;$.BatchesPage=vs;$.Uploads=Ks;const _t="0.33.1";let Li=!1,Gt,Zo,ls,el,tl,nl;function ku(n,e={auto:!1}){if(Li)throw new Error(`you must \`import '@anthropic-ai/sdk/shims/${n.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(Gt)throw new Error(`can't \`import '@anthropic-ai/sdk/shims/${n.kind}'\` after \`import '@anthropic-ai/sdk/shims/${Gt}'\``);Li=e.auto,Gt=n.kind,Zo=n.fetch,ls=n.File,el=n.ReadableStream,tl=n.getDefaultAgent,nl=n.fileFromPath}class Pu{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function Ru({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from '@anthropic-ai/sdk'`:\n- `import '@anthropic-ai/sdk/shims/node'` (if you're running on Node)\n- `import '@anthropic-ai/sdk/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new Pu(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:a=>!1}}Gt||ku(Ru(),{auto:!0});class X extends Error{}class ue extends X{constructor(e,t,r,s){super(`${ue.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["request-id"],this.error=t}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new sr({message:r,cause:cs(t)});const i=t;return e===400?new sl(e,i,r,s):e===401?new il(e,i,r,s):e===403?new al(e,i,r,s):e===404?new ol(e,i,r,s):e===409?new ll(e,i,r,s):e===422?new cl(e,i,r,s):e===429?new ul(e,i,r,s):e>=500?new fl(e,i,r,s):new ue(e,i,r,s)}}class nt extends ue{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class sr extends ue{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class rl extends sr{constructor({message:e}={}){super({message:e??"Request timed out."})}}class sl extends ue{}class il extends ue{}class al extends ue{}class ol extends ue{}class ll extends ue{}class cl extends ue{}class ul extends ue{}class fl extends ue{}class ze{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=ze.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(ze.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new X(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new X(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new X("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}ze.NEWLINE_CHARS=new Set([`
`,"\r"]);ze.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class Ke{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of Cu(e,t)){if(a.event==="completion")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event==="message_start"||a.event==="message_delta"||a.event==="message_stop"||a.event==="content_block_start"||a.event==="content_block_delta"||a.event==="content_block_stop")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event!=="ping"&&a.event==="error")throw ue.generate(void 0,`SSE Error: ${a.data}`,a.data,ml(e.headers))}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Ke(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new ze,o=zs(e);for await(const l of o)for(const c of a.decode(l))yield c;for(const l of a.flush())yield l}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Ke(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new Ke(()=>s(e),this.controller),new Ke(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new el({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*Cu(n,e){if(!n.body)throw e.abort(),new X("Attempted to iterate over a response with no body");const t=new Ou,r=new ze,s=zs(n.body);for await(const i of vu(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*vu(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=xu(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function xu(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}class Ou{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=Tu(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function Tu(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function zs(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Mu=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Iu=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&ir(n),ir=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function";async function Nu(n,e,t){var s;if(n=await n,Iu(n))return n;if(Mu(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=ir(i)?[await i.arrayBuffer()]:[i];return new ls(a,e,t)}const r=await Fu(n);if(e||(e=Lu(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new ls(r,e,t)}async function Fu(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(ir(n))e.push(await n.arrayBuffer());else if(Du(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${Bu(n)}`);return e}function Bu(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Lu(n){var e;return Ir(n.name)||Ir(n.filename)||((e=Ir(n.path))==null?void 0:e.split(/[\\/]/).pop())}const Ir=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Du=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Di=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var qu=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Uu=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},bn;async function dl(n){const{response:e}=n;if(n.options.stream)return Pt("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Ke.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return Pt("response",e.status,e.url,e.headers,i),hl(i,e)}const s=await e.text();return Pt("response",e.status,e.url,e.headers,s),s}function hl(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}class ar extends Promise{constructor(e,t=dl){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new ar(this.responsePromise,async t=>hl(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class $u{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Nr("maxRetries",t),this.timeout=Nr("timeout",r),this.httpAgent=s,this.fetch=i??Zo}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Xu(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Yu()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&ir(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var m;const{method:r,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:Di(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),c=this.buildURL(s,i);"timeout"in e&&Nr("timeout",e.timeout);const f=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??tl(c),h=f+1e3;typeof((m=u==null?void 0:u.options)==null?void 0:m.timeout)=="number"&&h>(u.options.timeout??0)&&(u.options.timeout=h),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const p=this.buildHeaders({options:e,headers:a,contentLength:l,retryCount:t});return{req:{method:r,...o&&{body:o},headers:p,...u&&{agent:u},signal:e.signal??null},url:c,timeout:f}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const a=this.defaultHeaders(e);return ji(i,a),ji(i,t),Di(e.body)&&Gt!=="node"&&delete i["content-type"],Hi(a,"x-stainless-retry-count")===void 0&&Hi(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return ue.generate(e,t,r,s)}request(e,t=null){return new ar(this.makeRequest(e,t))}async makeRequest(e,t){var u,h;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),Pt("request",a,r,i.headers),(u=r.signal)!=null&&u.aborted)throw new nt;const l=new AbortController,c=await this.fetchWithTimeout(a,i,o,l).catch(cs);if(c instanceof Error){if((h=r.signal)!=null&&h.aborted)throw new nt;if(t)return this.retryRequest(r,t);throw c.name==="AbortError"?new rl:new sr({cause:c})}const f=ml(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const w=`retrying, ${t} attempts remaining`;return Pt(`response (error; ${w})`,c.status,a,f),this.retryRequest(r,t,f)}const p=await c.text().catch(w=>cs(w).message),d=Ku(p),m=d?void 0:p;throw Pt(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,f,m),this.makeStatusError(c.status,d,m,f)}return{response:c,options:r,controller:l}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new Hu(this,r,e)}buildURL(e,t){const r=Gu(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Vn(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new X(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r);return this.fetch.call(void 0,e,{signal:s.signal,...a}).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Qu(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${_t}`}}class ju{constructor(e,t,r,s){bn.set(this,void 0),qu(this,bn,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new X("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await Uu(this,bn,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(bn=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Hu extends ar{constructor(e,t,r){super(t,async s=>new r(e,s.response,await dl(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const ml=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),Wu={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},rt=n=>typeof n=="object"&&n!==null&&!Vn(n)&&Object.keys(n).every(e=>pl(Wu,e)),Vu=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_t,"X-Stainless-OS":Ui(Deno.build.os),"X-Stainless-Arch":qi(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_t,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_t,"X-Stainless-OS":Ui(process.platform),"X-Stainless-Arch":qi(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=Ju();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_t,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_t,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Ju(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const qi=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Ui=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let $i;const Xu=()=>$i??($i=Vu()),Ku=n=>{try{return JSON.parse(n)}catch{return}},zu=/^[a-z][a-z0-9+.-]*:/i,Gu=n=>zu.test(n),Qu=n=>new Promise(e=>setTimeout(e,n)),Nr=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new X(`${n} must be an integer`);if(e<0)throw new X(`${n} must be a positive integer`);return e},cs=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(String(n))},Fr=n=>{var e,t,r,s,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,n))==null?void 0:i.trim()};function Vn(n){if(!n)return!0;for(const e in n)return!1;return!0}function pl(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function ji(n,e){for(const t in e){if(!pl(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function Pt(n,...e){var t;typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"&&console.log(`Anthropic:DEBUG:${n}`,...e)}const Yu=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),Zu=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",ef=n=>typeof(n==null?void 0:n.get)=="function",Hi=(n,e)=>{var r;const t=e.toLowerCase();if(ef(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=n.get(i);if(a)return a}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};class or extends ju{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.first_id=r.first_id||null,this.last_id=r.last_id||null}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var t;if((t=this.options.query)!=null&&t.before_id){const r=this.first_id;return r?{params:{before_id:r}}:null}const e=this.last_id;return e?{params:{after_id:e}}:null}}class Qe{constructor(e){this._client=e}}let Gs=class extends Qe{retrieve(e,t){return this._client.get(`/v1/models/${e}?beta=true`,t)}list(e={},t){return rt(e)?this.list({},e):this._client.getAPIList("/v1/models?beta=true",Qs,{query:e,...t})}};class Qs extends or{}Gs.BetaModelInfosPage=Qs;class lr{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new ze;for await(const t of this.iterator)for(const r of e.decode(t))yield JSON.parse(r);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),new X("Attempted to iterate over a response with no body");return new lr(zs(e.body),t)}}let Ys=class extends Qe{create(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages/batches?beta=true",{body:s,...t,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}retrieve(e,t={},r){if(rt(t))return this.retrieve(e,{},t);const{betas:s}=t;return this._client.get(`/v1/messages/batches/${e}?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}list(e={},t){if(rt(e))return this.list({},e);const{betas:r,...s}=e;return this._client.getAPIList("/v1/messages/batches?beta=true",Zs,{query:s,...t,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}cancel(e,t={},r){if(rt(t))return this.cancel(e,{},t);const{betas:s}=t;return this._client.post(`/v1/messages/batches/${e}/cancel?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}async results(e,t={},r){if(rt(t))return this.results(e,{},t);const s=await this.retrieve(e);if(!s.results_url)throw new X(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);const{betas:i}=t;return this._client.get(s.results_url,{...r,headers:{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers},__binaryResponse:!0})._thenUnwrap((a,o)=>lr.fromResponse(o.response,o.controller))}};class Zs extends or{}Ys.BetaMessageBatchesPage=Zs;let cr=class extends Qe{constructor(){super(...arguments),this.batches=new Ys(this._client)}create(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages?beta=true",{body:s,timeout:this._client._options.timeout??6e5,...t,headers:{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0,...t==null?void 0:t.headers},stream:e.stream??!1})}countTokens(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:s,...t,headers:{"anthropic-beta":[...r??[],"token-counting-2024-11-01"].toString(),...t==null?void 0:t.headers}})}};cr.Batches=Ys;cr.BetaMessageBatchesPage=Zs;class un extends Qe{constructor(){super(...arguments),this.models=new Gs(this._client),this.messages=new cr(this._client)}}un.Models=Gs;un.BetaModelInfosPage=Qs;un.Messages=cr;class gl extends Qe{create(e,t){return this._client.post("/v1/complete",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}}class ei extends Qe{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/v1/messages/batches/${e}`,t)}list(e={},t){return rt(e)?this.list({},e):this._client.getAPIList("/v1/messages/batches",ti,{query:e,...t})}cancel(e,t){return this._client.post(`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const r=await this.retrieve(e);if(!r.results_url)throw new X(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);return this._client.get(r.results_url,{...t,__binaryResponse:!0})._thenUnwrap((s,i)=>lr.fromResponse(i.response,i.controller))}}class ti extends or{}ei.MessageBatchesPage=ti;const tf=n=>{let e=0,t=[];for(;e<n.length;){let r=n[e];if(r==="\\"){e++;continue}if(r==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(r==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(r==="["){t.push({type:"paren",value:"["}),e++;continue}if(r==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(r===":"){t.push({type:"separator",value:":"}),e++;continue}if(r===","){t.push({type:"delimiter",value:","}),e++;continue}if(r==='"'){let o="",l=!1;for(r=n[++e];r!=='"';){if(e===n.length){l=!0;break}if(r==="\\"){if(e++,e===n.length){l=!0;break}o+=r+n[e],r=n[++e]}else o+=r,r=n[++e]}r=n[++e],l||t.push({type:"string",value:o});continue}if(r&&/\s/.test(r)){e++;continue}let i=/[0-9]/;if(r&&i.test(r)||r==="-"||r==="."){let o="";for(r==="-"&&(o+=r,r=n[++e]);r&&i.test(r)||r===".";)o+=r,r=n[++e];t.push({type:"number",value:o});continue}let a=/[a-z]/i;if(r&&a.test(r)){let o="";for(;r&&a.test(r)&&e!==n.length;)o+=r,r=n[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},yt=n=>{if(n.length===0)return n;let e=n[n.length-1];switch(e.type){case"separator":return n=n.slice(0,n.length-1),yt(n);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return n=n.slice(0,n.length-1),yt(n);case"string":let r=n[n.length-2];if((r==null?void 0:r.type)==="delimiter")return n=n.slice(0,n.length-1),yt(n);if((r==null?void 0:r.type)==="brace"&&r.value==="{")return n=n.slice(0,n.length-1),yt(n);break;case"delimiter":return n=n.slice(0,n.length-1),yt(n)}return n},nf=n=>{let e=[];return n.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?n.push({type:"brace",value:"}"}):t==="]"&&n.push({type:"paren",value:"]"})}),n},rf=n=>{let e="";return n.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},sf=n=>JSON.parse(rf(nf(yt(tf(n)))));var ge=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},D=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ve,Xe,Sn,En,Ft,Bt,An,Lt,je,Dt,kn,Pn,ht,Br,Wi,Lr,Dr,qr,Ur,Vi;const Ji="__json_buf";class Jn{constructor(){ve.add(this),this.messages=[],this.receivedMessages=[],Xe.set(this,void 0),this.controller=new AbortController,Sn.set(this,void 0),En.set(this,()=>{}),Ft.set(this,()=>{}),Bt.set(this,void 0),An.set(this,()=>{}),Lt.set(this,()=>{}),je.set(this,{}),Dt.set(this,!1),kn.set(this,!1),Pn.set(this,!1),ht.set(this,!1),Lr.set(this,e=>{if(ge(this,kn,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new nt),e instanceof nt)return ge(this,Pn,!0,"f"),this._emit("abort",e);if(e instanceof X)return this._emit("error",e);if(e instanceof Error){const t=new X(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new X(String(e)))}),ge(this,Sn,new Promise((e,t)=>{ge(this,En,e,"f"),ge(this,Ft,t,"f")}),"f"),ge(this,Bt,new Promise((e,t)=>{ge(this,An,e,"f"),ge(this,Lt,t,"f")}),"f"),D(this,Sn,"f").catch(()=>{}),D(this,Bt,"f").catch(()=>{})}static fromReadableStream(e){const t=new Jn;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){const s=new Jn;for(const i of t.messages)s._addMessageParam(i);return s._run(()=>s._createMessage(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},D(this,Lr,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){var a;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),D(this,ve,"m",Dr).call(this);const i=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)D(this,ve,"m",qr).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new nt;D(this,ve,"m",Ur).call(this)}_connected(){this.ended||(D(this,En,"f").call(this),this._emit("connect"))}get ended(){return D(this,Dt,"f")}get errored(){return D(this,kn,"f")}get aborted(){return D(this,Pn,"f")}abort(){this.controller.abort()}on(e,t){return(D(this,je,"f")[e]||(D(this,je,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=D(this,je,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(D(this,je,"f")[e]||(D(this,je,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{ge(this,ht,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){ge(this,ht,!0,"f"),await D(this,Bt,"f")}get currentMessage(){return D(this,Xe,"f")}async finalMessage(){return await this.done(),D(this,ve,"m",Br).call(this)}async finalText(){return await this.done(),D(this,ve,"m",Wi).call(this)}_emit(e,...t){if(D(this,Dt,"f"))return;e==="end"&&(ge(this,Dt,!0,"f"),D(this,An,"f").call(this));const r=D(this,je,"f")[e];if(r&&(D(this,je,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!D(this,ht,"f")&&!(r!=null&&r.length)&&Promise.reject(s),D(this,Ft,"f").call(this,s),D(this,Lt,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!D(this,ht,"f")&&!(r!=null&&r.length)&&Promise.reject(s),D(this,Ft,"f").call(this,s),D(this,Lt,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",D(this,ve,"m",Br).call(this))}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),D(this,ve,"m",Dr).call(this),this._connected();const s=Ke.fromReadableStream(e,this.controller);for await(const a of s)D(this,ve,"m",qr).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new nt;D(this,ve,"m",Ur).call(this)}[(Xe=new WeakMap,Sn=new WeakMap,En=new WeakMap,Ft=new WeakMap,Bt=new WeakMap,An=new WeakMap,Lt=new WeakMap,je=new WeakMap,Dt=new WeakMap,kn=new WeakMap,Pn=new WeakMap,ht=new WeakMap,Lr=new WeakMap,ve=new WeakSet,Br=function(){if(this.receivedMessages.length===0)throw new X("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Wi=function(){if(this.receivedMessages.length===0)throw new X("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new X("stream ended without producing a content block with type=text");return t.join(" ")},Dr=function(){this.ended||ge(this,Xe,void 0,"f")},qr=function(t){if(this.ended)return;const r=D(this,ve,"m",Vi).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{const s=r.content.at(-1);t.delta.type==="text_delta"&&s.type==="text"?this._emit("text",t.delta.text,s.text||""):t.delta.type==="input_json_delta"&&s.type==="tool_use"&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{ge(this,Xe,r,"f");break}}},Ur=function(){if(this.ended)throw new X("stream has ended, this shouldn't happen");const t=D(this,Xe,"f");if(!t)throw new X("request ended without sending any chunks");return ge(this,Xe,void 0,"f"),t},Vi=function(t){let r=D(this,Xe,"f");if(t.type==="message_start"){if(r)throw new X(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new X(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{const s=r.content.at(t.index);if((s==null?void 0:s.type)==="text"&&t.delta.type==="text_delta")s.text+=t.delta.text;else if((s==null?void 0:s.type)==="tool_use"&&t.delta.type==="input_json_delta"){let i=s[Ji]||"";i+=t.delta.partial_json,Object.defineProperty(s,Ji,{value:i,enumerable:!1,writable:!0}),i&&(s.input=sf(i))}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("streamEvent",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Ke(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class ur extends Qe{constructor(){super(...arguments),this.batches=new ei(this._client)}create(e,t){return e.model in Xi&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${Xi[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}stream(e,t){return Jn.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}const Xi={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024"};ur.Batches=ei;ur.MessageBatchesPage=ti;class ni extends Qe{retrieve(e,t){return this._client.get(`/v1/models/${e}`,t)}list(e={},t){return rt(e)?this.list({},e):this._client.getAPIList("/v1/models",ri,{query:e,...t})}}class ri extends or{}ni.ModelInfosPage=ri;var _l;class J extends $u{constructor({baseURL:e=Fr("ANTHROPIC_BASE_URL"),apiKey:t=Fr("ANTHROPIC_API_KEY")??null,authToken:r=Fr("ANTHROPIC_AUTH_TOKEN")??null,...s}={}){const i={apiKey:t,authToken:r,...s,baseURL:e||"https://api.anthropic.com"};if(!i.dangerouslyAllowBrowser&&Zu())throw new X(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new gl(this),this.messages=new ur(this),this.models=new ni(this),this.beta=new un(this),this._options=i,this.apiKey=t,this.authToken=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(e,t){if(!(this.apiKey&&e["x-api-key"])&&t["x-api-key"]!==null&&!(this.authToken&&e.authorization)&&t.authorization!==null)throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){const t=this.apiKeyAuth(e),r=this.bearerAuth(e);return t!=null&&!Vn(t)?t:r!=null&&!Vn(r)?r:{}}apiKeyAuth(e){return this.apiKey==null?{}:{"X-Api-Key":this.apiKey}}bearerAuth(e){return this.authToken==null?{}:{Authorization:`Bearer ${this.authToken}`}}}_l=J;J.Anthropic=_l;J.HUMAN_PROMPT=`

Human:`;J.AI_PROMPT=`

Assistant:`;J.DEFAULT_TIMEOUT=6e5;J.AnthropicError=X;J.APIError=ue;J.APIConnectionError=sr;J.APIConnectionTimeoutError=rl;J.APIUserAbortError=nt;J.NotFoundError=ol;J.ConflictError=ll;J.RateLimitError=ul;J.BadRequestError=sl;J.AuthenticationError=il;J.InternalServerError=fl;J.PermissionDeniedError=al;J.UnprocessableEntityError=cl;J.toFile=Nu;J.fileFromPath=nl;J.Completions=gl;J.Messages=ur;J.Models=ni;J.ModelInfosPage=ri;J.Beta=un;const us="siyuan-ai-plugin-setting",yl="siyuan-ai-plugin-chat-history",fs="siyuan-ai-plugin-prompts",Ki=atob("aHR0cHM6Ly9vbmVhcGkuZ2Vla3NwaGVyZS5vbmxpbmU=");class si{constructor(e,t){pe(this,"plugin");pe(this,"name");pe(this,"file");this.name=t,this.plugin=e}}class af extends si{constructor(t,r){super(t,r);pe(this,"data",[]);this.name=r??yl,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this._defaultSettings()}async load(){let t=await this.plugin.loadData(this.file);return console.debug("Load Chat Data:",t),t&&(this.data=t),this.plugin.data[this.name]=t,t}async save(t){return t=t??this.dump(),await this.plugin.saveData(this.file,t),this.plugin.data[this.name]=t,t}add(t){this.data=[t,...this.data],this.save()}update(t){this.data=this.data.map(r=>r.id===t.id?t:r),this.save()}delete(t){this.data=this.data.filter(r=>r.id!==t),this.save()}get(t){return this.data.find(r=>r.id===t)}set(t){this.data.push(t),this.save()}dump(){return this.data}_defaultSettings(){this.data=[{id:1,title:"翻译",time:"2025/1/22 17:06:59",messages:[{role:"system",content:"你是一个乐于助人的助手。你可以通过回答我的问题来帮助我。如果信息不足，你也可以问我问题。"},{role:"user",content:"你好，我是一名翻译员，请翻译以下内容：目前，我国大部正在经历一场大回暖，晴暖当道。但很快天气格局将发生明显转折，预计23日至27日，今年首场寒潮过程将影响我国，带来剧烈降温和大风雨雪天气。"},{role:"assistant",content:`你好！以下是你要翻译的内容的英文版本：

Currently, most parts of our country are experiencing a significant warm-up, with sunny and warm weather prevailing. However, the weather pattern is about to undergo a noticeable shift. From the 23rd to the 27th, the first cold wave of the year is expected to affect our country, bringing sharp temperature drops, strong winds, and snowstorms.

希望这对你有帮助！如果有其他问题，随时问我。`}]},{id:2,title:"打招呼",time:"2025/1/22 17:05:59",messages:[{role:"system",content:"你是一个乐于助人的助手。你可以通过回答我的问题来帮助我。如果信息不足，你也可以问我问题。"},{role:"user",content:"你好"},{role:"assistant",content:"你好，很高兴为你服务。"}]}],this.load(),this.save()}}class of extends si{constructor(t,r){super(t,r);pe(this,"prompts",[]);this.name=r??fs,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this._defaultSettings()}async load(){let t=await this.plugin.loadData(this.file);return console.debug("Load Prompt Data:",t),t&&(this.prompts=t),this.plugin.data[this.name]=t,t}async save(t){return t=t??this.dump(),await this.plugin.saveData(this.file,t),this.plugin.data[this.name]=t,t}addPrompt(t){this.prompts=[...this.prompts,t],this.save()}updatePrompt(t){this.prompts=this.prompts.map(r=>r.id===t.id?t:r),this.save()}deletePrompt(t){this.prompts=this.prompts.filter(r=>r.id!==t),this.save()}get(t){return this.prompts.find(r=>r.id===t)}set(t){this.prompts.push(t),this.save()}dump(){return this.prompts}_defaultSettings(){this.prompts=[{id:0,title:"翻译、拼写纠正、改进",content:"请对以上内容进行翻译。要求：我希望你用更优美优雅的高级英语单词和句子替换我简化的 A0 级单词和句子。保持相同的意思，但使它们更文艺。你只需要翻译该内容，不必对内容中提出的问题和要求做解释，不要回答文本中的问题而是翻译它。"},{id:1,title:"提取标题",content:"请为上面这篇文章生成简洁且完整概括的标题。"},{id:2,title:"提取摘要",content:"请为上面这篇文章生成简明扼要的摘要。"},{id:3,title:"提取标签",content:"请为上面这篇文章生成标签，单个标签不超过6个字符，多个标签用英文逗号分隔，最多返回5个标签。"},{id:4,title:"论文摘要生成",content:`请你充当一名论文编辑专家，为上面这篇文章，在论文评审的角度去生成论文摘要部分，使其更加流畅，优美。下面是具体要求：
能让读者快速获得文章的要点或精髓，让文章引人入胜；能让读者了解全文中的重要信息、分析和论点；帮助读者记住论文的要点
字数限制在300字以下
用简洁、明了的语言描述论文的方法和结果，以便评审更容易理解论文`},{id:5,title:"文本总结助手",content:`你是一个擅长总结长文本的助手，请对上面的文本进行总结，并生成摘要。
标题：xxx
作者：xxx
标签：阅读文章内容后给文章打上标签，标签通常是领域、学科或专有名词
一句话总结这篇文文章:xxx
总结文章内容并写成摘要:xxx
越详细地列举文章的大纲，越详细越好，要完整体现文章要点；`},{id:6,title:"标题党",content:"请问上面的文本生成花哨的标题"}],this.load(),this.save()}}class lf extends si{constructor(t,r){super(t,r);pe(this,"settings",new Map);this.name=r??us,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this._defaultSettings()}async load(){let t=await this.plugin.loadData(this.file);if(console.debug("Load Setting Config:",t),t)for(let[r,s]of this.settings)s.value=(t==null?void 0:t[r])??s.value;return this.plugin.data[this.name]=t,t}async save(t){return t=t??this.dump(),await this.plugin.saveData(this.file,t),console.debug("Save Setting Config:",t),t}get(t){return this.settings.get(t)}getValue(t){var r;return(r=this.settings.get(t))==null?void 0:r.value}getSettingItems(t){let r=[];for(let[s,i]of this.settings)t&&i.group!==t||r.push(i);return r}set(t,r){this.settings.set(t,r)}setValue(t,r){let s=this.settings.get(t);s.value=r}dump(){let t={};for(let[r,s]of this.settings)t[r]=s.value;return t}_defaultSettings(){const t={group:"🌈 设置",title:"密钥",description:'<a href="https://item.taobao.com/item.htm?ft=t&id=877591591207&spm=a21dvs.23580594.0.0.621e2c1bjqRPCl&skuId=5719376381355">密钥购买链接</a>, 售后QQ群: 710607849',type:"textinput",key:"apiKey",value:"",placeholder:"Enter your Key"};this.settings.set(t.key,t);const r={group:"custom",title:"是否获取页面文本",description:"当未选中文本使用指令模式时，是否获取当前页面的全部文本作为大模型的输入。默认为 否。",type:"checkbox",key:"isPageContent",value:!1};this.settings.set(r.key,r);const s={group:"custom",title:"温度",description:"温度值越小，模型生成的内容越准确。温度值越高，模型生成内容越多样。默认为 1.0。",type:"slider",key:"temperature",slider:{min:0,max:2,step:.1},value:1};this.settings.set(s.key,s);const i={group:"custom",title:"最大长度",description:"输出文本的最大长度,默认为 4k。",type:"number",key:"maxOutputLength",value:4e3};this.settings.set(i.key,i);const a={group:"custom",title:"请求超时时间",description:"发起请求的超时时间，超过该时间，取消请求，单位：秒。默认为 90 秒。",type:"number",key:"responseTimeout",value:90};this.settings.set(a.key,a);const o={group:"model",title:"模型",description:"选择模型",type:"select",key:"modelSelections",value:"deepseek-chat",options:{"deepseek-chat":"DeepSeek Chat","deepseek-reasoner":"DeepSeek Reasoner","qwen-turbo-latest":"Qwen Turbo","qwen-plus-latest":"Qwen Plus","qwen-max-latest":"Qwen Max","gpt-4o":"GPT 4o","gpt-4o-mini":"GPT 4o mini","gpt-4-turbo":"GPT 4 Turbo","claude-3-5-haiku-20241022":"Claude 3.5 Haiku","claude-3-5-sonnet-latest":"Claude 3.5 Sonnet","claude-3-opus-latest":"Claude 3 Opus"}};this.settings.set(o.key,o),this.load()}}function Xn(n,{delay:e=0,duration:t=400,easing:r=Oa}={}){const s=+getComputedStyle(n).opacity;return{delay:e,duration:t,easing:r,css:i=>`opacity: ${i*s}`}}function zi(n){let e;return{c(){e=k("div"),e.innerHTML='<span style="color: var(--b3-theme-primary);">生成中...</span>',x(e,"width","100%"),x(e,"text-align","center"),x(e,"border-top","1px solid var(--b3-border-color)")},m(t,r){H(t,e,r)},d(t){t&&U(e)}}}function cf(n){let e,t,r,s,i,a,o=n[2]&&zi();return{c(){e=k("div"),t=k("div"),r=se(n[1]),s=O(),o&&o.c(),x(t,"max-height","250px"),x(t,"overflow-y","auto"),x(t,"margin-top","10px"),x(t,"white-space","pre-wrap"),x(t,"line-height","1.3"),x(t,"scrollbar-width","thin"),x(e,"width","94%"),x(e,"padding","3%"),x(e,"align-self","center"),x(e,"background","var(--b3-card-background)")},m(l,c){H(l,e,c),y(e,t),y(t,r),n[3](t),y(e,s),o&&o.m(e,null),a=!0},p(l,[c]){(!a||c&2)&&Ce(r,l[1]),l[2]?o||(o=zi(),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i(l){a||(l&&lt(()=>{a&&(i||(i=Un(e,Xn,{duration:200},!0)),i.run(1))}),a=!0)},o(l){l&&(i||(i=Un(e,Xn,{duration:200},!1)),i.run(0)),a=!1},d(l){l&&U(e),n[3](null),o&&o.d(),l&&i&&i.end()}}}function uf(n,e,t){let{outputContent:r}=e,{isGenerating:s}=e,{outputContainer:i}=e;function a(o){ie[o?"unshift":"push"](()=>{i=o,t(0,i)})}return n.$$set=o=>{"outputContent"in o&&t(1,r=o.outputContent),"isGenerating"in o&&t(2,s=o.isGenerating),"outputContainer"in o&&t(0,i=o.outputContainer)},[i,r,s,a]}class ff extends he{constructor(e){super(),de(this,e,uf,cf,fe,{outputContent:1,isGenerating:2,outputContainer:0})}}function Gi(n,e,t){const r=n.slice();return r[0]=e[t][0],r[18]=e[t][1],r}function df(n){let e,t,r,s,i,a,o;return{c(){e=k("div"),t=k("input"),A(t,"id","fontSize"),A(t,"min",r=n[5].min),A(t,"max",s=n[5].max),A(t,"step",i=n[5].step),A(t,"type","range"),A(t,"style",n[8]),z(t,"b3-slider",!0),z(t,"fn__size200",n[7]),A(e,"class","b3-tooltips b3-tooltips__n"),A(e,"aria-label",n[0])},m(l,c){H(l,e,c),y(e,t),we(t,n[0]),a||(o=[j(t,"change",n[16]),j(t,"input",n[16]),j(t,"change",n[10])],a=!0)},p(l,c){c&32&&r!==(r=l[5].min)&&A(t,"min",r),c&32&&s!==(s=l[5].max)&&A(t,"max",s),c&32&&i!==(i=l[5].step)&&A(t,"step",i),c&256&&A(t,"style",l[8]),c&17&&we(t,l[0]),c&128&&z(t,"fn__size200",l[7]),c&17&&A(e,"aria-label",l[0])},d(l){l&&U(e),a=!1,oe(o)}}}function hf(n){let e,t,r,s=xe(Object.entries(n[4])),i=[];for(let a=0;a<s.length;a+=1)i[a]=Qi(Gi(n,s,a));return{c(){e=k("select");for(let a=0;a<i.length;a+=1)i[a].c();A(e,"id","iconPosition"),A(e,"style",n[8]),n[0]===void 0&&lt(()=>n[15].call(e)),z(e,"b3-select",!0),z(e,"fn__flex-center",!0),z(e,"fn__size200",n[7])},m(a,o){H(a,e,o);for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(e,null);gi(e,n[0],!0),t||(r=[j(e,"change",n[15]),j(e,"change",n[10])],t=!0)},p(a,o){if(o&16){s=xe(Object.entries(a[4]));let l;for(l=0;l<s.length;l+=1){const c=Gi(a,s,l);i[l]?i[l].p(c,o):(i[l]=Qi(c),i[l].c(),i[l].m(e,null))}for(;l<i.length;l+=1)i[l].d(1);i.length=s.length}o&256&&A(e,"style",a[8]),o&17&&gi(e,a[0]),o&128&&z(e,"fn__size200",a[7])},d(a){a&&U(e),Ln(i,a),t=!1,oe(r)}}}function mf(n){let e,t=n[6].label+"",r,s,i;return{c(){e=k("button"),r=se(t),A(e,"id",n[2]),A(e,"style",n[8]),z(e,"b3-button",!0),z(e,"b3-button--outline",!0),z(e,"fn__flex-center",!0),z(e,"fn__size200",n[7])},m(a,o){H(a,e,o),y(e,r),s||(i=j(e,"click",n[9]),s=!0)},p(a,o){o&64&&t!==(t=a[6].label+"")&&Ce(r,t),o&4&&A(e,"id",a[2]),o&256&&A(e,"style",a[8]),o&128&&z(e,"fn__size200",a[7])},d(a){a&&U(e),s=!1,i()}}}function pf(n){let e,t,r;return{c(){e=k("input"),A(e,"id",n[2]),A(e,"type","number"),A(e,"style",n[8]),z(e,"b3-text-field",!0),z(e,"fn__flex-center",!0),z(e,"fn__size200",n[7])},m(s,i){H(s,e,i),we(e,n[0]),t||(r=[j(e,"input",n[14]),j(e,"change",n[10])],t=!0)},p(s,i){i&4&&A(e,"id",s[2]),i&256&&A(e,"style",s[8]),i&17&&Vr(e.value)!==s[0]&&we(e,s[0]),i&128&&z(e,"fn__size200",s[7])},d(s){s&&U(e),t=!1,oe(r)}}}function gf(n){let e,t,r,s;return{c(){e=k("textarea"),A(e,"class","b3-text-field fn__block"),A(e,"style",t=`resize: vertical; height: 10em; white-space: nowrap; ${n[8]}`)},m(i,a){H(i,e,a),we(e,n[0]),r||(s=[j(e,"input",n[13]),j(e,"change",n[10])],r=!0)},p(i,a){a&256&&t!==(t=`resize: vertical; height: 10em; white-space: nowrap; ${i[8]}`)&&A(e,"style",t),a&17&&we(e,i[0])},d(i){i&&U(e),r=!1,oe(s)}}}function _f(n){let e,t,r;return{c(){e=k("input"),A(e,"id",n[2]),A(e,"placeholder",n[3]),A(e,"style",n[8]),z(e,"b3-text-field",!0),z(e,"fn__flex-center",!0),z(e,"fn__size200",n[7])},m(s,i){H(s,e,i),we(e,n[0]),t||(r=[j(e,"input",n[12]),j(e,"change",n[10])],t=!0)},p(s,i){i&4&&A(e,"id",s[2]),i&8&&A(e,"placeholder",s[3]),i&256&&A(e,"style",s[8]),i&17&&e.value!==s[0]&&we(e,s[0]),i&128&&z(e,"fn__size200",s[7])},d(s){s&&U(e),t=!1,oe(r)}}}function yf(n){let e,t,r;return{c(){e=k("input"),A(e,"class","b3-switch fn__flex-center"),A(e,"id",n[2]),A(e,"type","checkbox"),A(e,"style",n[8])},m(s,i){H(s,e,i),e.checked=n[0],t||(r=[j(e,"change",n[11]),j(e,"change",n[10])],t=!0)},p(s,i){i&4&&A(e,"id",s[2]),i&256&&A(e,"style",s[8]),i&17&&(e.checked=s[0])},d(s){s&&U(e),t=!1,oe(r)}}}function Qi(n){let e,t=n[18]+"",r,s;return{c(){e=k("option"),r=se(t),e.__value=s=n[0],we(e,e.__value)},m(i,a){H(i,e,a),y(e,r)},p(i,a){a&16&&t!==(t=i[18]+"")&&Ce(r,t),a&16&&s!==(s=i[0])&&(e.__value=s,we(e,e.__value))},d(i){i&&U(e)}}}function wf(n){let e;function t(i,a){if(i[1]==="checkbox")return yf;if(i[1]==="textinput")return _f;if(i[1]==="textarea")return gf;if(i[1]==="number")return pf;if(i[1]==="button")return mf;if(i[1]==="select")return hf;if(i[1]=="slider")return df}let r=t(n),s=r&&r(n);return{c(){s&&s.c(),e=As()},m(i,a){s&&s.m(i,a),H(i,e,a)},p(i,[a]){r===(r=t(i))&&s?s.p(i,a):(s&&s.d(1),s=r&&r(i),s&&(s.c(),s.m(e.parentNode,e)))},i:ne,o:ne,d(i){i&&U(e),s&&s.d(i)}}}function bf(n,e,t){let{type:r}=e,{key:s}=e,{value:i}=e,{placeholder:a=""}=e,{options:o={}}=e,{slider:l={min:0,max:100,step:1}}=e,{button:c={label:i,callback:()=>{}}}=e,{fnSize:f=!0}=e,{style:u=""}=e;const h=Zn();function p(){c==null||c.callback(),h("click",{key:s})}function d(){h("changed",{key:s,value:i})}function m(){i=this.checked,t(0,i),t(4,o)}function g(){i=this.value,t(0,i),t(4,o)}function P(){i=this.value,t(0,i),t(4,o)}function w(){i=Vr(this.value),t(0,i),t(4,o)}function _(){i=lc(this),t(0,i),t(4,o)}function S(){i=Vr(this.value),t(0,i),t(4,o)}return n.$$set=b=>{"type"in b&&t(1,r=b.type),"key"in b&&t(2,s=b.key),"value"in b&&t(0,i=b.value),"placeholder"in b&&t(3,a=b.placeholder),"options"in b&&t(4,o=b.options),"slider"in b&&t(5,l=b.slider),"button"in b&&t(6,c=b.button),"fnSize"in b&&t(7,f=b.fnSize),"style"in b&&t(8,u=b.style)},[i,r,s,a,o,l,c,f,u,p,d,m,g,P,w,_,S]}class Kn extends he{constructor(e){super(),de(this,e,bf,wf,fe,{type:1,key:2,value:0,placeholder:3,options:4,slider:5,button:6,fnSize:7,style:8})}}function Sf(n){let e,t,r,s,i,a,o,l,c,f,u,h,p;function d(g){n[13](g)}let m={type:"select",key:"modelSelections",fnSize:!1,options:n[4].get("modelSelections").options,style:"margin-right: 5px; font-size: 12px; padding: 2px 4px; border-radius: 4px; border: 1px solid #ddd; height: 2em; background: transparent; align-self: center;"};return n[2]!==void 0&&(m.value=n[2]),s=new Kn({props:m}),ie.push(()=>Pe(s,"value",d)),s.$on("changed",n[14]),{c(){e=k("div"),t=k("textarea"),r=O(),Y(s.$$.fragment),a=O(),o=k("button"),o.textContent="超参数",l=O(),c=k("button"),c.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" class="svelte-1x8hi4t"></path></svg>',A(t,"placeholder","输入 AI 指令... Shift + Enter 换行， /触发命令"),A(t,"class",".b3-text-field fn__block fn__flex-center"),x(t,"width","calc(100% - 120px)"),x(t,"height","2em"),x(t,"line-height","1.5em"),x(t,"white-space","pre-wrap"),x(t,"background","transparent"),x(t,"border","0"),x(t,"outline","none"),x(t,"margin-left","0.5em"),x(t,"resize","none"),x(t,"overflow-y","auto"),x(t,"padding","0"),A(o,"type","button"),A(o,"class","ai-instruction-params-button svelte-1x8hi4t"),x(o,"font-size","12px"),x(o,"color","#666"),x(o,"text-decoration","none"),x(o,"background","none"),x(o,"border","none"),x(o,"padding","0"),x(o,"cursor","pointer"),x(o,"margin-right","5px"),x(o,"white-space","nowrap"),x(o,"height","2em"),x(o,"line-height","2em"),x(o,"align-self","center"),x(o,"color","var(--b3-theme-on-surface)"),A(c,"type","button"),A(c,"class","ai-instruction-submit-button svelte-1x8hi4t"),x(c,"height","2em"),x(c,"display","flex"),x(c,"align-items","center"),x(c,"opacity","0.6"),x(c,"cursor","pointer"),x(c,"background","none"),x(c,"border","none"),x(c,"padding","0"),x(c,"align-self","center"),x(e,"width","100%"),x(e,"height","100%"),x(e,"display","flex"),x(e,"position","relative"),x(e,"align-items","center"),x(e,"margin","10px 0")},m(g,P){H(g,e,P),y(e,t),n[8](t),we(t,n[0]),y(e,r),G(s,e,null),y(e,a),y(e,o),y(e,l),y(e,c),u=!0,h||(p=[j(t,"input",n[9]),j(t,"keydown",n[10]),j(t,"focus",n[11]),j(t,"blur",n[12]),j(o,"click",n[15]),j(c,"click",function(){Qt(n[5])&&n[5].apply(this,arguments)}),j(c,"keydown",function(){Qt(n[6])&&n[6].apply(this,arguments)})],h=!0)},p(g,[P]){n=g,P&1&&we(t,n[0]);const w={};P&16&&(w.options=n[4].get("modelSelections").options),!i&&P&4&&(i=!0,w.value=n[2],ke(()=>i=!1)),s.$set(w)},i(g){u||(F(s.$$.fragment,g),g&&lt(()=>{u&&(f||(f=Un(e,Xn,{duration:200},!0)),f.run(1))}),u=!0)},o(g){L(s.$$.fragment,g),g&&(f||(f=Un(e,Xn,{duration:200},!1)),f.run(0)),u=!1},d(g){g&&U(e),n[8](null),Q(s),g&&f&&f.end(),h=!1,oe(p)}}}function Ef(n,e,t){let{inputValue:r}=e,{inputElement:s}=e,{selectedModel:i}=e,{settingStorage:a}=e,{showParams:o}=e,{handleSubmit:l}=e,{handleKeydown:c}=e,f=!1;function u(_){ie[_?"unshift":"push"](()=>{s=_,t(1,s)})}function h(){r=this.value,t(0,r)}const p=_=>{_.key==="Enter"&&!_.shiftKey&&(_.preventDefault(),l()),c(_)},d=()=>t(7,f=!0),m=()=>t(7,f=!1);function g(_){i=_,t(2,i)}const P=({detail:_})=>{a.setValue(_.key,_.value),a.save()},w=()=>{t(3,o=!o),o||a.save()};return n.$$set=_=>{"inputValue"in _&&t(0,r=_.inputValue),"inputElement"in _&&t(1,s=_.inputElement),"selectedModel"in _&&t(2,i=_.selectedModel),"settingStorage"in _&&t(4,a=_.settingStorage),"showParams"in _&&t(3,o=_.showParams),"handleSubmit"in _&&t(5,l=_.handleSubmit),"handleKeydown"in _&&t(6,c=_.handleKeydown)},[r,s,i,o,a,l,c,f,u,h,p,d,m,g,P,w]}class Af extends he{constructor(e){super(),de(this,e,Ef,Sf,fe,{inputValue:0,inputElement:1,selectedModel:2,settingStorage:4,showParams:3,handleSubmit:5,handleKeydown:6})}}function kf(n){let e,t,r,s,i,a,o=zn(n[1],n[3])+"",l,c,f,u;const h=n[5].default,p=ys(h,n,n[4],null);return{c(){e=k("div"),t=k("div"),r=k("span"),s=se(n[0]),i=O(),a=k("div"),l=O(),c=k("span"),f=O(),p&&p.c(),A(r,"class","title svelte-ikiu6h"),A(a,"class","b3-label__text"),A(t,"class","fn__flex-1"),A(c,"class","fn__space"),A(e,"class","item-wrap fn__flex b3-label config__item svelte-ikiu6h")},m(d,m){H(d,e,m),y(e,t),y(t,r),y(r,s),y(t,i),y(t,a),a.innerHTML=o,y(e,l),y(e,c),y(e,f),p&&p.m(e,null),u=!0},p(d,m){(!u||m&1)&&Ce(s,d[0]),(!u||m&10)&&o!==(o=zn(d[1],d[3])+"")&&(a.innerHTML=o),p&&p.p&&(!u||m&16)&&bs(p,h,d,d[4],u?ws(h,d[4],m,null):Ss(d[4]),null)},i(d){u||(F(p,d),u=!0)},o(d){L(p,d),u=!1},d(d){d&&U(e),p&&p.d(d)}}}function Pf(n){let e,t,r,s,i,a,o=zn(n[1],n[3])+"",l,c,f,u,h;const p=n[5].default,d=ys(p,n,n[4],null);return{c(){e=k("div"),t=k("div"),r=k("span"),s=se(n[0]),i=O(),a=k("div"),l=O(),c=k("div"),f=O(),u=k("div"),d&&d.c(),A(r,"class","title svelte-ikiu6h"),A(a,"class","b3-label__text"),A(c,"class","fn__hr"),x(u,"display","flex"),x(u,"flex-direction","column"),x(u,"gap","5px"),x(u,"position","relative"),A(t,"class","fn__block"),A(e,"class","item-wrap b3-label svelte-ikiu6h"),A(e,"data-key","CustomCSS")},m(m,g){H(m,e,g),y(e,t),y(t,r),y(r,s),y(t,i),y(t,a),a.innerHTML=o,y(t,l),y(t,c),y(t,f),y(t,u),d&&d.m(u,null),h=!0},p(m,g){(!h||g&1)&&Ce(s,m[0]),(!h||g&10)&&o!==(o=zn(m[1],m[3])+"")&&(a.innerHTML=o),d&&d.p&&(!h||g&16)&&bs(d,p,m,m[4],h?ws(p,m[4],g,null):Ss(m[4]),null)},i(m){h||(F(d,m),h=!0)},o(m){L(d,m),h=!1},d(m){m&&U(e),d&&d.d(m)}}}function Rf(n){let e,t,r,s;const i=[Pf,kf],a=[];function o(l,c){return l[2]==="row"?0:1}return e=o(n),t=a[e]=i[e](n),{c(){t.c(),r=As()},m(l,c){a[e].m(l,c),H(l,r,c),s=!0},p(l,[c]){let f=e;e=o(l),e===f?a[e].p(l,c):(it(),L(a[f],1,1,()=>{a[f]=null}),at(),t=a[e],t?t.p(l,c):(t=a[e]=i[e](l),t.c()),F(t,1),t.m(r.parentNode,r))},i(l){s||(F(t),s=!0)},o(l){L(t),s=!1},d(l){l&&U(r),a[e].d(l)}}}function zn(n,e=!1){return e&&n.length>20?n.slice(0,20)+"...":n}function Cf(n,e,t){let{$$slots:r={},$$scope:s}=e,{title:i}=e,{description:a}=e,{direction:o="column"}=e,{isSimple:l=!1}=e;return n.$$set=c=>{"title"in c&&t(0,i=c.title),"description"in c&&t(1,a=c.description),"direction"in c&&t(2,o=c.direction),"isSimple"in c&&t(3,l=c.isSimple),"$$scope"in c&&t(4,s=c.$$scope)},[i,a,o,l,s,r]}class vf extends he{constructor(e){super(),de(this,e,Cf,Rf,fe,{title:0,description:1,direction:2,isSimple:3})}}const wl={Wrap:vf,Input:Kn};function bl(n,e){return function(){return n.apply(e,arguments)}}const{toString:xf}=Object.prototype,{getPrototypeOf:ii}=Object,fr=(n=>e=>{const t=xf.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Fe=n=>(n=n.toLowerCase(),e=>fr(e)===n),dr=n=>e=>typeof e===n,{isArray:Ot}=Array,nn=dr("undefined");function Of(n){return n!==null&&!nn(n)&&n.constructor!==null&&!nn(n.constructor)&&Re(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Sl=Fe("ArrayBuffer");function Tf(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&Sl(n.buffer),e}const Mf=dr("string"),Re=dr("function"),El=dr("number"),hr=n=>n!==null&&typeof n=="object",If=n=>n===!0||n===!1,In=n=>{if(fr(n)!=="object")return!1;const e=ii(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Nf=Fe("Date"),Ff=Fe("File"),Bf=Fe("Blob"),Lf=Fe("FileList"),Df=n=>hr(n)&&Re(n.pipe),qf=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Re(n.append)&&((e=fr(n))==="formdata"||e==="object"&&Re(n.toString)&&n.toString()==="[object FormData]"))},Uf=Fe("URLSearchParams"),[$f,jf,Hf,Wf]=["ReadableStream","Request","Response","Headers"].map(Fe),Vf=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function fn(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,s;if(typeof n!="object"&&(n=[n]),Ot(n))for(r=0,s=n.length;r<s;r++)e.call(null,n[r],r,n);else{const i=t?Object.getOwnPropertyNames(n):Object.keys(n),a=i.length;let o;for(r=0;r<a;r++)o=i[r],e.call(null,n[o],o,n)}}function Al(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,s;for(;r-- >0;)if(s=t[r],e===s.toLowerCase())return s;return null}const st=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,kl=n=>!nn(n)&&n!==st;function ds(){const{caseless:n}=kl(this)&&this||{},e={},t=(r,s)=>{const i=n&&Al(e,s)||s;In(e[i])&&In(r)?e[i]=ds(e[i],r):In(r)?e[i]=ds({},r):Ot(r)?e[i]=r.slice():e[i]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&fn(arguments[r],t);return e}const Jf=(n,e,t,{allOwnKeys:r}={})=>(fn(e,(s,i)=>{t&&Re(s)?n[i]=bl(s,t):n[i]=s},{allOwnKeys:r}),n),Xf=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Kf=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},zf=(n,e,t,r)=>{let s,i,a;const o={};if(e=e||{},n==null)return e;do{for(s=Object.getOwnPropertyNames(n),i=s.length;i-- >0;)a=s[i],(!r||r(a,n,e))&&!o[a]&&(e[a]=n[a],o[a]=!0);n=t!==!1&&ii(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},Gf=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},Qf=n=>{if(!n)return null;if(Ot(n))return n;let e=n.length;if(!El(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},Yf=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&ii(Uint8Array)),Zf=(n,e)=>{const r=(n&&n[Symbol.iterator]).call(n);let s;for(;(s=r.next())&&!s.done;){const i=s.value;e.call(n,i[0],i[1])}},ed=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},td=Fe("HTMLFormElement"),nd=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,s){return r.toUpperCase()+s}),Yi=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),rd=Fe("RegExp"),Pl=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};fn(t,(s,i)=>{let a;(a=e(s,i,n))!==!1&&(r[i]=a||s)}),Object.defineProperties(n,r)},sd=n=>{Pl(n,(e,t)=>{if(Re(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(Re(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},id=(n,e)=>{const t={},r=s=>{s.forEach(i=>{t[i]=!0})};return Ot(n)?r(n):r(String(n).split(e)),t},ad=()=>{},od=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e,$r="abcdefghijklmnopqrstuvwxyz",Zi="0123456789",Rl={DIGIT:Zi,ALPHA:$r,ALPHA_DIGIT:$r+$r.toUpperCase()+Zi},ld=(n=16,e=Rl.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function cd(n){return!!(n&&Re(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const ud=n=>{const e=new Array(10),t=(r,s)=>{if(hr(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const i=Ot(r)?[]:{};return fn(r,(a,o)=>{const l=t(a,s+1);!nn(l)&&(i[o]=l)}),e[s]=void 0,i}}return r};return t(n,0)},fd=Fe("AsyncFunction"),dd=n=>n&&(hr(n)||Re(n))&&Re(n.then)&&Re(n.catch),Cl=((n,e)=>n?setImmediate:e?((t,r)=>(st.addEventListener("message",({source:s,data:i})=>{s===st&&i===t&&r.length&&r.shift()()},!1),s=>{r.push(s),st.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Re(st.postMessage)),hd=typeof queueMicrotask<"u"?queueMicrotask.bind(st):typeof process<"u"&&process.nextTick||Cl,E={isArray:Ot,isArrayBuffer:Sl,isBuffer:Of,isFormData:qf,isArrayBufferView:Tf,isString:Mf,isNumber:El,isBoolean:If,isObject:hr,isPlainObject:In,isReadableStream:$f,isRequest:jf,isResponse:Hf,isHeaders:Wf,isUndefined:nn,isDate:Nf,isFile:Ff,isBlob:Bf,isRegExp:rd,isFunction:Re,isStream:Df,isURLSearchParams:Uf,isTypedArray:Yf,isFileList:Lf,forEach:fn,merge:ds,extend:Jf,trim:Vf,stripBOM:Xf,inherits:Kf,toFlatObject:zf,kindOf:fr,kindOfTest:Fe,endsWith:Gf,toArray:Qf,forEachEntry:Zf,matchAll:ed,isHTMLForm:td,hasOwnProperty:Yi,hasOwnProp:Yi,reduceDescriptors:Pl,freezeMethods:sd,toObjectSet:id,toCamelCase:nd,noop:ad,toFiniteNumber:od,findKey:Al,global:st,isContextDefined:kl,ALPHABET:Rl,generateString:ld,isSpecCompliantForm:cd,toJSONObject:ud,isAsyncFn:fd,isThenable:dd,setImmediate:Cl,asap:hd};function B(n,e,t,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}E.inherits(B,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:E.toJSONObject(this.config),code:this.code,status:this.status}}});const vl=B.prototype,xl={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{xl[n]={value:n}});Object.defineProperties(B,xl);Object.defineProperty(vl,"isAxiosError",{value:!0});B.from=(n,e,t,r,s,i)=>{const a=Object.create(vl);return E.toFlatObject(n,a,function(l){return l!==Error.prototype},o=>o!=="isAxiosError"),B.call(a,n.message,e,t,r,s),a.cause=n,a.name=n.name,i&&Object.assign(a,i),a};const md=null;function hs(n){return E.isPlainObject(n)||E.isArray(n)}function Ol(n){return E.endsWith(n,"[]")?n.slice(0,-2):n}function ea(n,e,t){return n?n.concat(e).map(function(s,i){return s=Ol(s),!t&&i?"["+s+"]":s}).join(t?".":""):e}function pd(n){return E.isArray(n)&&!n.some(hs)}const gd=E.toFlatObject(E,{},null,function(e){return/^is[A-Z]/.test(e)});function mr(n,e,t){if(!E.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=E.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!E.isUndefined(g[m])});const r=t.metaTokens,s=t.visitor||f,i=t.dots,a=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&E.isSpecCompliantForm(e);if(!E.isFunction(s))throw new TypeError("visitor must be a function");function c(d){if(d===null)return"";if(E.isDate(d))return d.toISOString();if(!l&&E.isBlob(d))throw new B("Blob is not supported. Use a Buffer instead.");return E.isArrayBuffer(d)||E.isTypedArray(d)?l&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function f(d,m,g){let P=d;if(d&&!g&&typeof d=="object"){if(E.endsWith(m,"{}"))m=r?m:m.slice(0,-2),d=JSON.stringify(d);else if(E.isArray(d)&&pd(d)||(E.isFileList(d)||E.endsWith(m,"[]"))&&(P=E.toArray(d)))return m=Ol(m),P.forEach(function(_,S){!(E.isUndefined(_)||_===null)&&e.append(a===!0?ea([m],S,i):a===null?m:m+"[]",c(_))}),!1}return hs(d)?!0:(e.append(ea(g,m,i),c(d)),!1)}const u=[],h=Object.assign(gd,{defaultVisitor:f,convertValue:c,isVisitable:hs});function p(d,m){if(!E.isUndefined(d)){if(u.indexOf(d)!==-1)throw Error("Circular reference detected in "+m.join("."));u.push(d),E.forEach(d,function(P,w){(!(E.isUndefined(P)||P===null)&&s.call(e,P,E.isString(w)?w.trim():w,m,h))===!0&&p(P,m?m.concat(w):[w])}),u.pop()}}if(!E.isObject(n))throw new TypeError("data must be an object");return p(n),e}function ta(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function ai(n,e){this._pairs=[],n&&mr(n,this,e)}const Tl=ai.prototype;Tl.append=function(e,t){this._pairs.push([e,t])};Tl.toString=function(e){const t=e?function(r){return e.call(this,r,ta)}:ta;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};function _d(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ml(n,e,t){if(!e)return n;const r=t&&t.encode||_d;E.isFunction(t)&&(t={serialize:t});const s=t&&t.serialize;let i;if(s?i=s(e,t):i=E.isURLSearchParams(e)?e.toString():new ai(e,t).toString(r),i){const a=n.indexOf("#");a!==-1&&(n=n.slice(0,a)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n}class na{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){E.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Il={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},yd=typeof URLSearchParams<"u"?URLSearchParams:ai,wd=typeof FormData<"u"?FormData:null,bd=typeof Blob<"u"?Blob:null,Sd={isBrowser:!0,classes:{URLSearchParams:yd,FormData:wd,Blob:bd},protocols:["http","https","file","blob","url","data"]},oi=typeof window<"u"&&typeof document<"u",ms=typeof navigator=="object"&&navigator||void 0,Ed=oi&&(!ms||["ReactNative","NativeScript","NS"].indexOf(ms.product)<0),Ad=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",kd=oi&&window.location.href||"http://localhost",Pd=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:oi,hasStandardBrowserEnv:Ed,hasStandardBrowserWebWorkerEnv:Ad,navigator:ms,origin:kd},Symbol.toStringTag,{value:"Module"})),ce={...Pd,...Sd};function Rd(n,e){return mr(n,new ce.classes.URLSearchParams,Object.assign({visitor:function(t,r,s,i){return ce.isNode&&E.isBuffer(t)?(this.append(r,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function Cd(n){return E.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function vd(n){const e={},t=Object.keys(n);let r;const s=t.length;let i;for(r=0;r<s;r++)i=t[r],e[i]=n[i];return e}function Nl(n){function e(t,r,s,i){let a=t[i++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),l=i>=t.length;return a=!a&&E.isArray(s)?s.length:a,l?(E.hasOwnProp(s,a)?s[a]=[s[a],r]:s[a]=r,!o):((!s[a]||!E.isObject(s[a]))&&(s[a]=[]),e(t,r,s[a],i)&&E.isArray(s[a])&&(s[a]=vd(s[a])),!o)}if(E.isFormData(n)&&E.isFunction(n.entries)){const t={};return E.forEachEntry(n,(r,s)=>{e(Cd(r),s,t,0)}),t}return null}function xd(n,e,t){if(E.isString(n))try{return(e||JSON.parse)(n),E.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(0,JSON.stringify)(n)}const dn={transitional:Il,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",s=r.indexOf("application/json")>-1,i=E.isObject(e);if(i&&E.isHTMLForm(e)&&(e=new FormData(e)),E.isFormData(e))return s?JSON.stringify(Nl(e)):e;if(E.isArrayBuffer(e)||E.isBuffer(e)||E.isStream(e)||E.isFile(e)||E.isBlob(e)||E.isReadableStream(e))return e;if(E.isArrayBufferView(e))return e.buffer;if(E.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Rd(e,this.formSerializer).toString();if((o=E.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return mr(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return i||s?(t.setContentType("application/json",!1),xd(e)):e}],transformResponse:[function(e){const t=this.transitional||dn.transitional,r=t&&t.forcedJSONParsing,s=this.responseType==="json";if(E.isResponse(e)||E.isReadableStream(e))return e;if(e&&E.isString(e)&&(r&&!this.responseType||s)){const a=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?B.from(o,B.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ce.classes.FormData,Blob:ce.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};E.forEach(["delete","get","head","post","put","patch"],n=>{dn.headers[n]={}});const Od=E.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Td=n=>{const e={};let t,r,s;return n&&n.split(`
`).forEach(function(a){s=a.indexOf(":"),t=a.substring(0,s).trim().toLowerCase(),r=a.substring(s+1).trim(),!(!t||e[t]&&Od[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},ra=Symbol("internals");function qt(n){return n&&String(n).trim().toLowerCase()}function Nn(n){return n===!1||n==null?n:E.isArray(n)?n.map(Nn):String(n)}function Md(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const Id=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function jr(n,e,t,r,s){if(E.isFunction(r))return r.call(this,e,t);if(s&&(e=t),!!E.isString(e)){if(E.isString(r))return e.indexOf(r)!==-1;if(E.isRegExp(r))return r.test(e)}}function Nd(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function Fd(n,e){const t=E.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(s,i,a){return this[r].call(this,e,s,i,a)},configurable:!0})})}class ye{constructor(e){e&&this.set(e)}set(e,t,r){const s=this;function i(o,l,c){const f=qt(l);if(!f)throw new Error("header name must be a non-empty string");const u=E.findKey(s,f);(!u||s[u]===void 0||c===!0||c===void 0&&s[u]!==!1)&&(s[u||l]=Nn(o))}const a=(o,l)=>E.forEach(o,(c,f)=>i(c,f,l));if(E.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(E.isString(e)&&(e=e.trim())&&!Id(e))a(Td(e),t);else if(E.isHeaders(e))for(const[o,l]of e.entries())i(l,o,r);else e!=null&&i(t,e,r);return this}get(e,t){if(e=qt(e),e){const r=E.findKey(this,e);if(r){const s=this[r];if(!t)return s;if(t===!0)return Md(s);if(E.isFunction(t))return t.call(this,s,r);if(E.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=qt(e),e){const r=E.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||jr(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let s=!1;function i(a){if(a=qt(a),a){const o=E.findKey(r,a);o&&(!t||jr(r,r[o],o,t))&&(delete r[o],s=!0)}}return E.isArray(e)?e.forEach(i):i(e),s}clear(e){const t=Object.keys(this);let r=t.length,s=!1;for(;r--;){const i=t[r];(!e||jr(this,this[i],i,e,!0))&&(delete this[i],s=!0)}return s}normalize(e){const t=this,r={};return E.forEach(this,(s,i)=>{const a=E.findKey(r,i);if(a){t[a]=Nn(s),delete t[i];return}const o=e?Nd(i):String(i).trim();o!==i&&delete t[i],t[o]=Nn(s),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return E.forEach(this,(r,s)=>{r!=null&&r!==!1&&(t[s]=e&&E.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[ra]=this[ra]={accessors:{}}).accessors,s=this.prototype;function i(a){const o=qt(a);r[o]||(Fd(s,a),r[o]=!0)}return E.isArray(e)?e.forEach(i):i(e),this}}ye.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);E.reduceDescriptors(ye.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});E.freezeMethods(ye);function Hr(n,e){const t=this||dn,r=e||t,s=ye.from(r.headers);let i=r.data;return E.forEach(n,function(o){i=o.call(t,i,s.normalize(),e?e.status:void 0)}),s.normalize(),i}function Fl(n){return!!(n&&n.__CANCEL__)}function Tt(n,e,t){B.call(this,n??"canceled",B.ERR_CANCELED,e,t),this.name="CanceledError"}E.inherits(Tt,B,{__CANCEL__:!0});function Bl(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new B("Request failed with status code "+t.status,[B.ERR_BAD_REQUEST,B.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Bd(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Ld(n,e){n=n||10;const t=new Array(n),r=new Array(n);let s=0,i=0,a;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),f=r[i];a||(a=c),t[s]=l,r[s]=c;let u=i,h=0;for(;u!==s;)h+=t[u++],u=u%n;if(s=(s+1)%n,s===i&&(i=(i+1)%n),c-a<e)return;const p=f&&c-f;return p?Math.round(h*1e3/p):void 0}}function Dd(n,e){let t=0,r=1e3/e,s,i;const a=(c,f=Date.now())=>{t=f,s=null,i&&(clearTimeout(i),i=null),n.apply(null,c)};return[(...c)=>{const f=Date.now(),u=f-t;u>=r?a(c,f):(s=c,i||(i=setTimeout(()=>{i=null,a(s)},r-u)))},()=>s&&a(s)]}const Gn=(n,e,t=3)=>{let r=0;const s=Ld(50,250);return Dd(i=>{const a=i.loaded,o=i.lengthComputable?i.total:void 0,l=a-r,c=s(l),f=a<=o;r=a;const u={loaded:a,total:o,progress:o?a/o:void 0,bytes:l,rate:c||void 0,estimated:c&&o&&f?(o-a)/c:void 0,event:i,lengthComputable:o!=null,[e?"download":"upload"]:!0};n(u)},t)},sa=(n,e)=>{const t=n!=null;return[r=>e[0]({lengthComputable:t,total:n,loaded:r}),e[1]]},ia=n=>(...e)=>E.asap(()=>n(...e)),qd=ce.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,ce.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(ce.origin),ce.navigator&&/(msie|trident)/i.test(ce.navigator.userAgent)):()=>!0,Ud=ce.hasStandardBrowserEnv?{write(n,e,t,r,s,i){const a=[n+"="+encodeURIComponent(e)];E.isNumber(t)&&a.push("expires="+new Date(t).toGMTString()),E.isString(r)&&a.push("path="+r),E.isString(s)&&a.push("domain="+s),i===!0&&a.push("secure"),document.cookie=a.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function $d(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function jd(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Ll(n,e){return n&&!$d(e)?jd(n,e):e}const aa=n=>n instanceof ye?{...n}:n;function ct(n,e){e=e||{};const t={};function r(c,f,u,h){return E.isPlainObject(c)&&E.isPlainObject(f)?E.merge.call({caseless:h},c,f):E.isPlainObject(f)?E.merge({},f):E.isArray(f)?f.slice():f}function s(c,f,u,h){if(E.isUndefined(f)){if(!E.isUndefined(c))return r(void 0,c,u,h)}else return r(c,f,u,h)}function i(c,f){if(!E.isUndefined(f))return r(void 0,f)}function a(c,f){if(E.isUndefined(f)){if(!E.isUndefined(c))return r(void 0,c)}else return r(void 0,f)}function o(c,f,u){if(u in e)return r(c,f);if(u in n)return r(void 0,c)}const l={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(c,f,u)=>s(aa(c),aa(f),u,!0)};return E.forEach(Object.keys(Object.assign({},n,e)),function(f){const u=l[f]||s,h=u(n[f],e[f],f);E.isUndefined(h)&&u!==o||(t[f]=h)}),t}const Dl=n=>{const e=ct({},n);let{data:t,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:i,headers:a,auth:o}=e;e.headers=a=ye.from(a),e.url=Ml(Ll(e.baseURL,e.url),n.params,n.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let l;if(E.isFormData(t)){if(ce.hasStandardBrowserEnv||ce.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((l=a.getContentType())!==!1){const[c,...f]=l?l.split(";").map(u=>u.trim()).filter(Boolean):[];a.setContentType([c||"multipart/form-data",...f].join("; "))}}if(ce.hasStandardBrowserEnv&&(r&&E.isFunction(r)&&(r=r(e)),r||r!==!1&&qd(e.url))){const c=s&&i&&Ud.read(i);c&&a.set(s,c)}return e},Hd=typeof XMLHttpRequest<"u",Wd=Hd&&function(n){return new Promise(function(t,r){const s=Dl(n);let i=s.data;const a=ye.from(s.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:c}=s,f,u,h,p,d;function m(){p&&p(),d&&d(),s.cancelToken&&s.cancelToken.unsubscribe(f),s.signal&&s.signal.removeEventListener("abort",f)}let g=new XMLHttpRequest;g.open(s.method.toUpperCase(),s.url,!0),g.timeout=s.timeout;function P(){if(!g)return;const _=ye.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),b={data:!o||o==="text"||o==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:_,config:n,request:g};Bl(function(v){t(v),m()},function(v){r(v),m()},b),g=null}"onloadend"in g?g.onloadend=P:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(P)},g.onabort=function(){g&&(r(new B("Request aborted",B.ECONNABORTED,n,g)),g=null)},g.onerror=function(){r(new B("Network Error",B.ERR_NETWORK,n,g)),g=null},g.ontimeout=function(){let S=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const b=s.transitional||Il;s.timeoutErrorMessage&&(S=s.timeoutErrorMessage),r(new B(S,b.clarifyTimeoutError?B.ETIMEDOUT:B.ECONNABORTED,n,g)),g=null},i===void 0&&a.setContentType(null),"setRequestHeader"in g&&E.forEach(a.toJSON(),function(S,b){g.setRequestHeader(b,S)}),E.isUndefined(s.withCredentials)||(g.withCredentials=!!s.withCredentials),o&&o!=="json"&&(g.responseType=s.responseType),c&&([h,d]=Gn(c,!0),g.addEventListener("progress",h)),l&&g.upload&&([u,p]=Gn(l),g.upload.addEventListener("progress",u),g.upload.addEventListener("loadend",p)),(s.cancelToken||s.signal)&&(f=_=>{g&&(r(!_||_.type?new Tt(null,n,g):_),g.abort(),g=null)},s.cancelToken&&s.cancelToken.subscribe(f),s.signal&&(s.signal.aborted?f():s.signal.addEventListener("abort",f)));const w=Bd(s.url);if(w&&ce.protocols.indexOf(w)===-1){r(new B("Unsupported protocol "+w+":",B.ERR_BAD_REQUEST,n));return}g.send(i||null)})},Vd=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let r=new AbortController,s;const i=function(c){if(!s){s=!0,o();const f=c instanceof Error?c:this.reason;r.abort(f instanceof B?f:new Tt(f instanceof Error?f.message:f))}};let a=e&&setTimeout(()=>{a=null,i(new B(`timeout ${e} of ms exceeded`,B.ETIMEDOUT))},e);const o=()=>{n&&(a&&clearTimeout(a),a=null,n.forEach(c=>{c.unsubscribe?c.unsubscribe(i):c.removeEventListener("abort",i)}),n=null)};n.forEach(c=>c.addEventListener("abort",i));const{signal:l}=r;return l.unsubscribe=()=>E.asap(o),l}},Jd=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let r=0,s;for(;r<t;)s=r+e,yield n.slice(r,s),r=s},Xd=async function*(n,e){for await(const t of Kd(n))yield*Jd(t,e)},Kd=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},oa=(n,e,t,r)=>{const s=Xd(n,e);let i=0,a,o=l=>{a||(a=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:c,value:f}=await s.next();if(c){o(),l.close();return}let u=f.byteLength;if(t){let h=i+=u;t(h)}l.enqueue(new Uint8Array(f))}catch(c){throw o(c),c}},cancel(l){return o(l),s.return()}},{highWaterMark:2})},pr=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ql=pr&&typeof ReadableStream=="function",zd=pr&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),Ul=(n,...e)=>{try{return!!n(...e)}catch{return!1}},Gd=ql&&Ul(()=>{let n=!1;const e=new Request(ce.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),la=64*1024,ps=ql&&Ul(()=>E.isReadableStream(new Response("").body)),Qn={stream:ps&&(n=>n.body)};pr&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Qn[e]&&(Qn[e]=E.isFunction(n[e])?t=>t[e]():(t,r)=>{throw new B(`Response type '${e}' is not supported`,B.ERR_NOT_SUPPORT,r)})})})(new Response);const Qd=async n=>{if(n==null)return 0;if(E.isBlob(n))return n.size;if(E.isSpecCompliantForm(n))return(await new Request(ce.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(E.isArrayBufferView(n)||E.isArrayBuffer(n))return n.byteLength;if(E.isURLSearchParams(n)&&(n=n+""),E.isString(n))return(await zd(n)).byteLength},Yd=async(n,e)=>{const t=E.toFiniteNumber(n.getContentLength());return t??Qd(e)},Zd=pr&&(async n=>{let{url:e,method:t,data:r,signal:s,cancelToken:i,timeout:a,onDownloadProgress:o,onUploadProgress:l,responseType:c,headers:f,withCredentials:u="same-origin",fetchOptions:h}=Dl(n);c=c?(c+"").toLowerCase():"text";let p=Vd([s,i&&i.toAbortSignal()],a),d;const m=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let g;try{if(l&&Gd&&t!=="get"&&t!=="head"&&(g=await Yd(f,r))!==0){let b=new Request(e,{method:"POST",body:r,duplex:"half"}),R;if(E.isFormData(r)&&(R=b.headers.get("content-type"))&&f.setContentType(R),b.body){const[v,C]=sa(g,Gn(ia(l)));r=oa(b.body,la,v,C)}}E.isString(u)||(u=u?"include":"omit");const P="credentials"in Request.prototype;d=new Request(e,{...h,signal:p,method:t.toUpperCase(),headers:f.normalize().toJSON(),body:r,duplex:"half",credentials:P?u:void 0});let w=await fetch(d);const _=ps&&(c==="stream"||c==="response");if(ps&&(o||_&&m)){const b={};["status","statusText","headers"].forEach(M=>{b[M]=w[M]});const R=E.toFiniteNumber(w.headers.get("content-length")),[v,C]=o&&sa(R,Gn(ia(o),!0))||[];w=new Response(oa(w.body,la,v,()=>{C&&C(),m&&m()}),b)}c=c||"text";let S=await Qn[E.findKey(Qn,c)||"text"](w,n);return!_&&m&&m(),await new Promise((b,R)=>{Bl(b,R,{data:S,headers:ye.from(w.headers),status:w.status,statusText:w.statusText,config:n,request:d})})}catch(P){throw m&&m(),P&&P.name==="TypeError"&&/fetch/i.test(P.message)?Object.assign(new B("Network Error",B.ERR_NETWORK,n,d),{cause:P.cause||P}):B.from(P,P&&P.code,n,d)}}),gs={http:md,xhr:Wd,fetch:Zd};E.forEach(gs,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const ca=n=>`- ${n}`,eh=n=>E.isFunction(n)||n===null||n===!1,$l={getAdapter:n=>{n=E.isArray(n)?n:[n];const{length:e}=n;let t,r;const s={};for(let i=0;i<e;i++){t=n[i];let a;if(r=t,!eh(t)&&(r=gs[(a=String(t)).toLowerCase()],r===void 0))throw new B(`Unknown adapter '${a}'`);if(r)break;s[a||"#"+i]=r}if(!r){const i=Object.entries(s).map(([o,l])=>`adapter ${o} `+(l===!1?"is not supported by the environment":"is not available in the build"));let a=e?i.length>1?`since :
`+i.map(ca).join(`
`):" "+ca(i[0]):"as no adapter specified";throw new B("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return r},adapters:gs};function Wr(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Tt(null,n)}function ua(n){return Wr(n),n.headers=ye.from(n.headers),n.data=Hr.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),$l.getAdapter(n.adapter||dn.adapter)(n).then(function(r){return Wr(n),r.data=Hr.call(n,n.transformResponse,r),r.headers=ye.from(r.headers),r},function(r){return Fl(r)||(Wr(n),r&&r.response&&(r.response.data=Hr.call(n,n.transformResponse,r.response),r.response.headers=ye.from(r.response.headers))),Promise.reject(r)})}const jl="1.7.9",gr={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{gr[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const fa={};gr.transitional=function(e,t,r){function s(i,a){return"[Axios v"+jl+"] Transitional option '"+i+"'"+a+(r?". "+r:"")}return(i,a,o)=>{if(e===!1)throw new B(s(a," has been removed"+(t?" in "+t:"")),B.ERR_DEPRECATED);return t&&!fa[a]&&(fa[a]=!0,console.warn(s(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,a,o):!0}};gr.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function th(n,e,t){if(typeof n!="object")throw new B("options must be an object",B.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let s=r.length;for(;s-- >0;){const i=r[s],a=e[i];if(a){const o=n[i],l=o===void 0||a(o,i,n);if(l!==!0)throw new B("option "+i+" must be "+l,B.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new B("Unknown option "+i,B.ERR_BAD_OPTION)}}const Fn={assertOptions:th,validators:gr},Le=Fn.validators;class ot{constructor(e){this.defaults=e,this.interceptors={request:new na,response:new na}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=ct(this.defaults,t);const{transitional:r,paramsSerializer:s,headers:i}=t;r!==void 0&&Fn.assertOptions(r,{silentJSONParsing:Le.transitional(Le.boolean),forcedJSONParsing:Le.transitional(Le.boolean),clarifyTimeoutError:Le.transitional(Le.boolean)},!1),s!=null&&(E.isFunction(s)?t.paramsSerializer={serialize:s}:Fn.assertOptions(s,{encode:Le.function,serialize:Le.function},!0)),Fn.assertOptions(t,{baseUrl:Le.spelling("baseURL"),withXsrfToken:Le.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&E.merge(i.common,i[t.method]);i&&E.forEach(["delete","get","head","post","put","patch","common"],d=>{delete i[d]}),t.headers=ye.concat(a,i);const o=[];let l=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(t)===!1||(l=l&&m.synchronous,o.unshift(m.fulfilled,m.rejected))});const c=[];this.interceptors.response.forEach(function(m){c.push(m.fulfilled,m.rejected)});let f,u=0,h;if(!l){const d=[ua.bind(this),void 0];for(d.unshift.apply(d,o),d.push.apply(d,c),h=d.length,f=Promise.resolve(t);u<h;)f=f.then(d[u++],d[u++]);return f}h=o.length;let p=t;for(u=0;u<h;){const d=o[u++],m=o[u++];try{p=d(p)}catch(g){m.call(this,g);break}}try{f=ua.call(this,p)}catch(d){return Promise.reject(d)}for(u=0,h=c.length;u<h;)f=f.then(c[u++],c[u++]);return f}getUri(e){e=ct(this.defaults,e);const t=Ll(e.baseURL,e.url);return Ml(t,e.params,e.paramsSerializer)}}E.forEach(["delete","get","head","options"],function(e){ot.prototype[e]=function(t,r){return this.request(ct(r||{},{method:e,url:t,data:(r||{}).data}))}});E.forEach(["post","put","patch"],function(e){function t(r){return function(i,a,o){return this.request(ct(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}ot.prototype[e]=t(),ot.prototype[e+"Form"]=t(!0)});class li{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(s=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](s);r._listeners=null}),this.promise.then=s=>{let i;const a=new Promise(o=>{r.subscribe(o),i=o}).then(s);return a.cancel=function(){r.unsubscribe(i)},a},e(function(i,a,o){r.reason||(r.reason=new Tt(i,a,o),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new li(function(s){e=s}),cancel:e}}}function nh(n){return function(t){return n.apply(null,t)}}function rh(n){return E.isObject(n)&&n.isAxiosError===!0}const _s={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(_s).forEach(([n,e])=>{_s[e]=n});function Hl(n){const e=new ot(n),t=bl(ot.prototype.request,e);return E.extend(t,ot.prototype,e,{allOwnKeys:!0}),E.extend(t,e,null,{allOwnKeys:!0}),t.create=function(s){return Hl(ct(n,s))},t}const Z=Hl(dn);Z.Axios=ot;Z.CanceledError=Tt;Z.CancelToken=li;Z.isCancel=Fl;Z.VERSION=jl;Z.toFormData=mr;Z.AxiosError=B;Z.Cancel=Z.CanceledError;Z.all=function(e){return Promise.all(e)};Z.spread=nh;Z.isAxiosError=rh;Z.mergeConfig=ct;Z.AxiosHeaders=ye;Z.formToJSON=n=>Nl(E.isHTMLForm(n)?new FormData(n):n);Z.getAdapter=$l.getAdapter;Z.HttpStatusCode=_s;Z.default=Z;async function da(n){if(!n||n.length==0)return[0,0];const e={method:"POST",url:atob("aHR0cHM6Ly9hcGkuZ2Vla3NwaGVyZS5vbmxpbmUvYWRtaW4tYXBpL2FpZ2MvYmFsYW5jZS90b2tlbg=="),headers:{"content-type":"application/json"},data:{apikey:n.replace("sk-","")}};let t=await Z.request(e);return!t||t.status!=200?[0,0]:t.data.data}function sh(n){let e,t,r,s,i,a,o,l,c,f,u=new Date(n[2]).toLocaleString()+"",h,p,d,m,g,P,w;return{c(){e=k("label"),t=k("div"),r=k("span"),r.textContent="余额查询",s=O(),i=k("div"),a=se("账 户 余 额 : "),o=se(n[1]),l=se(` ¥
            `),c=k("br"),f=se(` 
            有 效 期 : `),h=se(u),p=O(),d=k("span"),m=O(),g=k("button"),g.textContent="刷新",A(r,"class","title"),A(i,"class","b3-label__text"),A(t,"class","fn__flex-1"),A(d,"class","fn__space"),A(g,"class","b3-button b3-button--outline fn__flex-center fn__size200"),A(e,"class","item-wrap fn__flex b3-label config__item")},m(_,S){H(_,e,S),y(e,t),y(t,r),y(t,s),y(t,i),y(i,a),y(i,o),y(i,l),y(i,c),y(i,f),y(i,h),y(e,p),y(e,d),y(e,m),y(e,g),P||(w=j(g,"click",n[3]),P=!0)},p(_,[S]){S&2&&Ce(o,_[1]),S&4&&u!==(u=new Date(_[2]).toLocaleString()+"")&&Ce(h,u)},i:ne,o:ne,d(_){_&&U(e),P=!1,w()}}}function ih(n,e,t){let{apiKey:r}=e,s=0,i=0;La(()=>{da(r).then(o=>{t(1,s=Math.round(o.money*10)/10),t(2,i=o.expiredTime*1e3)})});const a=async()=>{da(r).then(o=>{t(2,i=o.expiredTime*1e3),t(1,s=Math.round(o.money*10)/10)})};return n.$$set=o=>{"apiKey"in o&&t(0,r=o.apiKey)},[r,s,i,a]}let ah=class extends he{constructor(e){super(),de(this,e,ih,sh,fe,{apiKey:0})}};function ha(n,e,t){const r=n.slice();return r[11]=e[t],r[12]=e,r[13]=t,r}function oh(n){var a,o,l,c;let e,t,r;function s(f){n[8](f,n[11])}let i={type:n[11].type,key:n[11].key,placeholder:(a=n[11])==null?void 0:a.placeholder,options:(o=n[11])==null?void 0:o.options,slider:(l=n[11])==null?void 0:l.slider,button:(c=n[11])==null?void 0:c.button};return n[11].value!==void 0&&(i.value=n[11].value),e=new wl.Input({props:i}),ie.push(()=>Pe(e,"value",s)),e.$on("click",n[4]),e.$on("changed",n[5]),{c(){Y(e.$$.fragment)},m(f,u){G(e,f,u),r=!0},p(f,u){var p,d,m,g;n=f;const h={};u&4&&(h.type=n[11].type),u&4&&(h.key=n[11].key),u&4&&(h.placeholder=(p=n[11])==null?void 0:p.placeholder),u&4&&(h.options=(d=n[11])==null?void 0:d.options),u&4&&(h.slider=(m=n[11])==null?void 0:m.slider),u&4&&(h.button=(g=n[11])==null?void 0:g.button),!t&&u&4&&(t=!0,h.value=n[11].value,ke(()=>t=!1)),e.$set(h)},i(f){r||(F(e.$$.fragment,f),r=!0)},o(f){L(e.$$.fragment,f),r=!1},d(f){Q(e,f)}}}function ma(n,e){var i;let t,r,s;return r=new wl.Wrap({props:{title:e[11].title,description:e[11].description,direction:(i=e[11])==null?void 0:i.direction,$$slots:{default:[oh]},$$scope:{ctx:e}}}),{key:n,first:null,c(){t=As(),Y(r.$$.fragment),this.first=t},m(a,o){H(a,t,o),G(r,a,o),s=!0},p(a,o){var c;e=a;const l={};o&4&&(l.title=e[11].title),o&4&&(l.description=e[11].description),o&4&&(l.direction=(c=e[11])==null?void 0:c.direction),o&516&&(l.$$scope={dirty:o,ctx:e}),r.$set(l)},i(a){s||(F(r.$$.fragment,a),s=!0)},o(a){L(r.$$.fragment,a),s=!1},d(a){a&&U(t),Q(r,a)}}}function pa(n){let e,t;return e=new ah({props:{apiKey:n[1].getValue("apiKey")}}),{c(){Y(e.$$.fragment)},m(r,s){G(e,r,s),t=!0},p(r,s){const i={};s&2&&(i.apiKey=r[1].getValue("apiKey")),e.$set(i)},i(r){t||(F(e.$$.fragment,r),t=!0)},o(r){L(e.$$.fragment,r),t=!1},d(r){Q(e,r)}}}function lh(n){let e,t,r=[],s=new Map,i,a,o;const l=n[7].default,c=ys(l,n,n[9],null);let f=xe(n[2]);const u=p=>p[11].key;for(let p=0;p<f.length;p+=1){let d=ha(n,f,p),m=u(d);s.set(m,r[p]=ma(m,d))}let h=n[0]==="🌈 设置"&&pa(n);return{c(){e=k("div"),c&&c.c(),t=O();for(let p=0;p<r.length;p+=1)r[p].c();i=O(),h&&h.c(),A(e,"class",a="config__tab-container "+n[3]),A(e,"data-name",n[0])},m(p,d){H(p,e,d),c&&c.m(e,null),y(e,t);for(let m=0;m<r.length;m+=1)r[m]&&r[m].m(e,null);y(e,i),h&&h.m(e,null),o=!0},p(p,[d]){c&&c.p&&(!o||d&512)&&bs(c,l,p,p[9],o?ws(l,p[9],d,null):Ss(p[9]),null),d&52&&(f=xe(p[2]),it(),r=qa(r,d,u,1,p,f,s,e,Ec,ma,i,ha),at()),p[0]==="🌈 设置"?h?(h.p(p,d),d&1&&F(h,1)):(h=pa(p),h.c(),F(h,1),h.m(e,null)):h&&(it(),L(h,1,1,()=>{h=null}),at()),(!o||d&8&&a!==(a="config__tab-container "+p[3]))&&A(e,"class",a),(!o||d&1)&&A(e,"data-name",p[0])},i(p){if(!o){F(c,p);for(let d=0;d<f.length;d+=1)F(r[d]);F(h),o=!0}},o(p){L(c,p);for(let d=0;d<r.length;d+=1)L(r[d]);L(h),o=!1},d(p){p&&U(e),c&&c.d(p);for(let d=0;d<r.length;d+=1)r[d].d();h&&h.d()}}}function ch(n,e,t){let r,{$$slots:s={},$$scope:i}=e,{group:a}=e,{settingStorage:o}=e,{display:l=!0}=e,c=o.getSettingItems(a);const f=Zn();function u({detail:d}){f("click",{key:d.key})}function h({detail:d}){f("changed",{group:a,...d})}function p(d,m){n.$$.not_equal(m.value,d)&&(m.value=d,t(2,c))}return n.$$set=d=>{"group"in d&&t(0,a=d.group),"settingStorage"in d&&t(1,o=d.settingStorage),"display"in d&&t(6,l=d.display),"$$scope"in d&&t(9,i=d.$$scope)},n.$$.update=()=>{n.$$.dirty&64&&t(3,r=l?"":"fn__none")},[a,o,c,r,u,h,l,s,p,i]}class Wl extends he{constructor(e){super(),de(this,e,ch,lh,fe,{group:0,settingStorage:1,display:6})}}function uh(n){let e,t,r;return t=new Wl({props:{group:"custom",settingStorage:n[0],display:!0}}),t.$on("changed",n[1]),{c(){e=k("div"),Y(t.$$.fragment),x(e,"margin-top","10px"),x(e,"padding","10px"),x(e,"background","none"),x(e,"border-radius","4px"),x(e,"border","1px solid var(--b3-border-color)")},m(s,i){H(s,e,i),G(t,e,null),r=!0},p(s,[i]){const a={};i&1&&(a.settingStorage=s[0]),t.$set(a)},i(s){r||(F(t.$$.fragment,s),r=!0)},o(s){L(t.$$.fragment,s),r=!1},d(s){s&&U(e),Q(t)}}}function fh(n,e,t){let{settingStorage:r}=e;const s=({detail:i})=>{r.setValue(i.key,i.value),r.save()};return n.$$set=i=>{"settingStorage"in i&&t(0,r=i.settingStorage)},[r,s]}class dh extends he{constructor(e){super(),de(this,e,fh,uh,fe,{settingStorage:0})}}function hh(){var t;let n=((t=window.getSelection())==null?void 0:t.toString())||"";return n||(document.querySelectorAll(".protyle-wysiwyg--select").forEach(r=>{const s=r.textContent;n+=`
`+s}),n)}function mh(){let n="",e="";return n=document.getElementsByClassName("protyle-title__input")[0].textContent,document.querySelectorAll("[data-node-index]").forEach(r=>{e+=r.textContent+`
`}),{title:n,content:e}}async function ph(n){const e=document.querySelectorAll(".protyle-wysiwyg--select");if(e.length===0){console.warn("没有选中的内容");return}let r=e[e.length-1].getAttribute("data-node-id");if(!r){console.warn("无法获取节点ID");return}const s=await Xl("markdown","",r);for(const i of e)await zl(i.getAttribute("data-node-id"));await Kl("markdown",n,s[0].doOperations[0].id)}async function gh(n,e,t,r,s){let i="";const a=await n.messages.stream({model:e,max_tokens:t,messages:r});for await(const o of a)if(o.type==="content_block_delta"){const l="text"in o.delta?o.delta.text:o.delta.toString();i+=l,s(i)}return i}async function _h(n,e,t,r,s,i){var l,c,f;let a="";const o=await n.chat.completions.create({model:e,max_tokens:t,temperature:r,stream:!0,messages:s});for await(const u of o)if((f=(c=(l=u.choices)==null?void 0:l[0])==null?void 0:c.delta)!=null&&f.content){const h=u.choices[0].delta.content;a+=h,i(a)}return a}async function yh(n,e=!1,t=!1){if(window.focus(),await navigator.clipboard.writeText(n),e&&t){ph(n);return}va("生成内容已自动复制到剪贴板")}async function wh(n,e,t,r,s,i,a){var l,c;let o="";try{const f=(l=r.get("maxOutputLength"))==null?void 0:l.value;switch(!0){case t.includes("claude"):o=await gh(e,t,f,s,a);break;default:const u=(c=r.get("temperature"))==null?void 0:c.value;o=await _h(n,t,f,u,s,a);break}return o}catch(f){console.error("生成回答时出错:",f);const u=`
生成回答时出错: `+f.message;return o+=u,a(o),o}finally{await yh(o,i,r.getValue("isReplaceSelected"))}}function bh(n){let e,t,r,s,i,a=[{type:"button"},n[4],{class:r=["b3-button",n[3],n[2]].join(" ")},{style:n[1]}],o={};for(let l=0;l<a.length;l+=1)o=Bn(o,a[l]);return{c(){e=k("button"),t=se(n[0]),pi(e,o)},m(l,c){H(l,e,c),y(e,t),e.autofocus&&e.focus(),s||(i=j(e,"click",n[8]),s=!0)},p(l,[c]){c&1&&oc(t,l[0],o.contenteditable),pi(e,o=Ac(a,[{type:"button"},c&16&&l[4],c&12&&r!==(r=["b3-button",l[3],l[2]].join(" "))&&{class:r},c&2&&{style:l[1]}]))},i:ne,o:ne,d(l){l&&U(e),s=!1,i()}}}function Sh(n,e,t){let r,s,i,{text:a=!1}=e,{outline:o=!1}=e,{backgroundColor:l=void 0}=e,{label:c=""}=e;function f(u){mc.call(this,n,u)}return n.$$set=u=>{t(4,e=Bn(Bn({},e),mi(u))),"text"in u&&t(5,a=u.text),"outline"in u&&t(6,o=u.outline),"backgroundColor"in u&&t(7,l=u.backgroundColor),"label"in u&&t(0,c=u.label)},n.$$.update=()=>{n.$$.dirty&64&&t(3,r=o?"b3-button--outline":""),n.$$.dirty&32&&t(2,s=a?"b3-button--text":""),n.$$.dirty&128&&t(1,i=l?`background-color: ${l}`:"")},e=mi(e),[c,i,s,r,e,a,o,l,f]}class Yn extends he{constructor(e){super(),de(this,e,Sh,bh,fe,{text:5,outline:6,backgroundColor:7,label:0})}}function Eh(n){let e,t,r,s=n[1].title?"编辑提示词":"新增提示词",i,a,o,l,c,f,u,h,p,d,m,g,P,w,_;function S(C){n[3](C)}let b={type:"textinput",placeholder:"标题",key:"title",style:"width: 100%; margin-bottom: 10px;"};n[1].title!==void 0&&(b.value=n[1].title),o=new Kn({props:b}),ie.push(()=>Pe(o,"value",S));function R(C){n[4](C)}let v={type:"textarea",placeholder:"内容",key:"content",style:"width: 100%; white-space: pre-wrap; word-wrap: break-word;"};return n[1].content!==void 0&&(v.value=n[1].content),f=new Kn({props:v}),ie.push(()=>Pe(f,"value",R)),d=new Yn({props:{label:"取消",text:!0,outline:!0}}),d.$on("click",n[5]),w=new Yn({props:{label:"确认",text:!1,outline:!1}}),w.$on("click",n[6]),{c(){e=k("div"),t=k("div"),r=k("h3"),i=se(s),a=O(),Y(o.$$.fragment),c=O(),Y(f.$$.fragment),h=O(),p=k("div"),Y(d.$$.fragment),m=O(),g=k("div"),P=O(),Y(w.$$.fragment),A(r,"class","b3-label"),A(g,"class","fn__space"),A(p,"class","b3-dialog__action"),A(t,"class","edit-content svelte-1ftxwb0"),A(e,"class","edit-panel svelte-1ftxwb0")},m(C,M){H(C,e,M),y(e,t),y(t,r),y(r,i),y(t,a),G(o,t,null),y(t,c),G(f,t,null),y(t,h),y(t,p),G(d,p,null),y(p,m),y(p,g),y(p,P),G(w,p,null),_=!0},p(C,[M]){(!_||M&2)&&s!==(s=C[1].title?"编辑提示词":"新增提示词")&&Ce(i,s);const N={};!l&&M&2&&(l=!0,N.value=C[1].title,ke(()=>l=!1)),o.$set(N);const T={};!u&&M&2&&(u=!0,T.value=C[1].content,ke(()=>u=!1)),f.$set(T)},i(C){_||(F(o.$$.fragment,C),F(f.$$.fragment,C),F(d.$$.fragment,C),F(w.$$.fragment,C),_=!0)},o(C){L(o.$$.fragment,C),L(f.$$.fragment,C),L(d.$$.fragment,C),L(w.$$.fragment,C),_=!1},d(C){C&&U(e),Q(o),Q(f),Q(d),Q(w)}}}function Ah(n,e,t){let{showEditPanel:r=!1}=e,{currentPrompt:s}=e;const i=Zn();function a(f){n.$$.not_equal(s.title,f)&&(s.title=f,t(1,s))}function o(f){n.$$.not_equal(s.content,f)&&(s.content=f,t(1,s))}const l=()=>t(0,r=!1),c=()=>i("save");return n.$$set=f=>{"showEditPanel"in f&&t(0,r=f.showEditPanel),"currentPrompt"in f&&t(1,s=f.currentPrompt)},[r,s,i,a,o,l,c]}class kh extends he{constructor(e){super(),de(this,e,Ah,Eh,fe,{showEditPanel:0,currentPrompt:1})}}function ga(n,e,t){const r=n.slice();return r[5]=e[t],r}function _a(n,e){let t,r,s,i=e[5].title+"",a,o,l,c,f,u,h,p,d,m,g;function P(){return e[2](e[5])}function w(){return e[3](e[5])}function _(){return e[4](e[5])}return{key:n,first:null,c(){t=k("div"),r=k("div"),s=k("span"),a=se(i),o=O(),l=k("div"),c=k("button"),c.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconTrashcan"></use></svg>',f=O(),u=k("button"),u.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconEdit"></use></svg>',h=O(),p=k("button"),p.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconPlay"></use></svg>',d=O(),A(s,"class","title"),A(r,"class","fn__flex-1"),A(c,"class","b3-list-item"),A(c,"title","删除"),A(u,"class","b3-list-item"),A(u,"title","编辑"),A(p,"class","b3-list-item"),A(p,"title","使用"),A(l,"class","fn__flex"),A(t,"class","item-wrap fn__flex b3-label config__item"),x(t,"height","1.5em"),this.first=t},m(S,b){H(S,t,b),y(t,r),y(r,s),y(s,a),y(t,o),y(t,l),y(l,c),y(l,f),y(l,u),y(l,h),y(l,p),y(t,d),m||(g=[j(c,"click",P),j(u,"click",w),j(p,"click",_)],m=!0)},p(S,b){e=S,b&1&&i!==(i=e[5].title+"")&&Ce(a,i)},d(S){S&&U(t),m=!1,oe(g)}}}function Ph(n){let e,t=[],r=new Map,s=xe(n[0]);const i=a=>a[5].id;for(let a=0;a<s.length;a+=1){let o=ga(n,s,a),l=i(o);r.set(l,t[a]=_a(l,o))}return{c(){e=k("div");for(let a=0;a<t.length;a+=1)t[a].c();A(e,"class","b3-tab-bar b3-list b3-list--background")},m(a,o){H(a,e,o);for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(e,null)},p(a,[o]){o&3&&(s=xe(a[0]),t=qa(t,o,i,1,a,s,r,e,Sc,_a,null,ga))},i:ne,o:ne,d(a){a&&U(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function Rh(n,e,t){const r=Zn();let{prompts:s}=e;const i=l=>r("delete",l.id),a=l=>r("edit",l),o=l=>r("use",l);return n.$$set=l=>{"prompts"in l&&t(0,s=l.prompts)},[s,r,i,a,o]}class Ch extends he{constructor(e){super(),de(this,e,Rh,Ph,fe,{prompts:0})}}function ya(n){let e,t,r,s;function i(l){n[14](l)}function a(l){n[15](l)}let o={};return n[0]!==void 0&&(o.showEditPanel=n[0]),n[1]!==void 0&&(o.currentPrompt=n[1]),e=new kh({props:o}),ie.push(()=>Pe(e,"showEditPanel",i)),ie.push(()=>Pe(e,"currentPrompt",a)),e.$on("save",n[6]),{c(){Y(e.$$.fragment)},m(l,c){G(e,l,c),s=!0},p(l,c){const f={};!t&&c&1&&(t=!0,f.showEditPanel=l[0],ke(()=>t=!1)),!r&&c&2&&(r=!0,f.currentPrompt=l[1],ke(()=>r=!1)),e.$set(f)},i(l){s||(F(e.$$.fragment,l),s=!0)},o(l){L(e.$$.fragment,l),s=!1},d(l){Q(e,l)}}}function vh(n){let e,t,r,s,i,a,o,l;s=new Ch({props:{prompts:n[2]}}),s.$on("edit",n[11]),s.$on("delete",n[12]),s.$on("use",n[13]);let c=n[0]&&ya(n);return{c(){e=k("div"),t=k("button"),t.textContent="+ 新建 Prompt",r=O(),Y(s.$$.fragment),i=O(),c&&c.c(),A(t,"class","add-prompt-btn"),x(t,"width","90%"),x(t,"margin","8px auto"),x(t,"display","block"),x(t,"padding","4px 8px"),x(t,"border-radius","4px"),x(t,"border","none"),x(t,"cursor","pointer"),x(t,"background","var(--b3-theme-surface)"),x(t,"color","var(--b3-theme-on-surface)"),x(e,"background","none"),x(e,"border-radius","4px"),x(e,"max-height","300px"),x(e,"overflow-y","auto")},m(f,u){H(f,e,u),y(e,t),y(e,r),G(s,e,null),y(e,i),c&&c.m(e,null),a=!0,o||(l=j(t,"click",n[10]),o=!0)},p(f,[u]){const h={};u&4&&(h.prompts=f[2]),s.$set(h),f[0]?c?(c.p(f,u),u&1&&F(c,1)):(c=ya(f),c.c(),F(c,1),c.m(e,null)):c&&(it(),L(c,1,1,()=>{c=null}),at())},i(f){a||(F(s.$$.fragment,f),F(c),a=!0)},o(f){L(s.$$.fragment,f),L(c),a=!1},d(f){f&&U(e),Q(s),c&&c.d(),o=!1,l()}}}function xh(n,e,t){let r,{promptStorage:s}=e,{searchText:i}=e,a=!1,o={id:Date.now(),title:"",content:""},l=s.prompts;function c(_){s.deletePrompt(_),t(9,l=s.prompts)}function f(_){_?t(1,o={..._}):t(1,o={id:Date.now(),title:"",content:""}),t(0,a=!0)}function u(_){t(7,i=_.content)}function h(){l.findIndex(S=>S.id===o.id)===-1?s.addPrompt(o):s.updatePrompt(o),s.save(l),t(0,a=!1),t(9,l=s.prompts)}const p=()=>f(),d=_=>f(_.detail),m=_=>c(_.detail),g=_=>u(_.detail);function P(_){a=_,t(0,a)}function w(_){o=_,t(1,o)}return n.$$set=_=>{"promptStorage"in _&&t(8,s=_.promptStorage),"searchText"in _&&t(7,i=_.searchText)},n.$$.update=()=>{n.$$.dirty&640&&t(2,r=l.filter(_=>_.title.toLowerCase().includes(i.slice(1).toLowerCase())||_.content.toLowerCase().includes(i.slice(1).toLowerCase())))},[a,o,r,c,f,u,h,i,s,l,p,d,m,g,P,w]}class Oh extends he{constructor(e){super(),de(this,e,xh,vh,fe,{promptStorage:8,searchText:7})}}function wa(n){let e,t,r;function s(a){n[17](a)}let i={outputContent:n[7],isGenerating:n[8]};return n[9]!==void 0&&(i.outputContainer=n[9]),e=new ff({props:i}),ie.push(()=>Pe(e,"outputContainer",s)),{c(){Y(e.$$.fragment)},m(a,o){G(e,a,o),r=!0},p(a,o){const l={};o&128&&(l.outputContent=a[7]),o&256&&(l.isGenerating=a[8]),!t&&o&512&&(t=!0,l.outputContainer=a[9],ke(()=>t=!1)),e.$set(l)},i(a){r||(F(e.$$.fragment,a),r=!0)},o(a){L(e.$$.fragment,a),r=!1},d(a){Q(e,a)}}}function ba(n){let e,t;return e=new dh({props:{settingStorage:n[1]}}),{c(){Y(e.$$.fragment)},m(r,s){G(e,r,s),t=!0},p(r,s){const i={};s&2&&(i.settingStorage=r[1]),e.$set(i)},i(r){t||(F(e.$$.fragment,r),t=!0)},o(r){L(e.$$.fragment,r),t=!1},d(r){Q(e,r)}}}function Sa(n){let e,t,r,s;function i(l){n[22](l)}function a(l){n[23](l)}let o={};return n[2]!==void 0&&(o.searchText=n[2]),n[0]!==void 0&&(o.promptStorage=n[0]),e=new Oh({props:o}),ie.push(()=>Pe(e,"searchText",i)),ie.push(()=>Pe(e,"promptStorage",a)),{c(){Y(e.$$.fragment)},m(l,c){G(e,l,c),s=!0},p(l,c){const f={};!t&&c&4&&(t=!0,f.searchText=l[2],ke(()=>t=!1)),!r&&c&1&&(r=!0,f.promptStorage=l[0],ke(()=>r=!1)),e.$set(f)},i(l){s||(F(e.$$.fragment,l),s=!0)},o(l){L(e.$$.fragment,l),s=!1},d(l){Q(e,l)}}}function Th(n){let e,t,r,s,i,a,o,l,c,f,u,h=n[6]&&wa(n);function p(S){n[18](S)}function d(S){n[19](S)}function m(S){n[20](S)}function g(S){n[21](S)}let P={settingStorage:n[1],handleSubmit:n[11],handleKeydown:n[12]};n[2]!==void 0&&(P.inputValue=n[2]),n[4]!==void 0&&(P.inputElement=n[4]),n[5]!==void 0&&(P.selectedModel=n[5]),n[3]!==void 0&&(P.showParams=n[3]),r=new Af({props:P}),ie.push(()=>Pe(r,"inputValue",p)),ie.push(()=>Pe(r,"inputElement",d)),ie.push(()=>Pe(r,"selectedModel",m)),ie.push(()=>Pe(r,"showParams",g));let w=n[3]&&ba(n),_=n[10]&&Sa(n);return{c(){e=k("div"),h&&h.c(),t=O(),Y(r.$$.fragment),l=O(),c=k("div"),w&&w.c(),f=O(),_&&_.c(),x(c,"width","100%"),x(e,"width","100%")},m(S,b){H(S,e,b),h&&h.m(e,null),y(e,t),G(r,e,null),y(e,l),y(e,c),w&&w.m(c,null),y(c,f),_&&_.m(c,null),u=!0},p(S,[b]){S[6]?h?(h.p(S,b),b&64&&F(h,1)):(h=wa(S),h.c(),F(h,1),h.m(e,t)):h&&(it(),L(h,1,1,()=>{h=null}),at());const R={};b&2&&(R.settingStorage=S[1]),!s&&b&4&&(s=!0,R.inputValue=S[2],ke(()=>s=!1)),!i&&b&16&&(i=!0,R.inputElement=S[4],ke(()=>i=!1)),!a&&b&32&&(a=!0,R.selectedModel=S[5],ke(()=>a=!1)),!o&&b&8&&(o=!0,R.showParams=S[3],ke(()=>o=!1)),r.$set(R),S[3]?w?(w.p(S,b),b&8&&F(w,1)):(w=ba(S),w.c(),F(w,1),w.m(c,f)):w&&(it(),L(w,1,1,()=>{w=null}),at()),S[10]?_?(_.p(S,b),b&1024&&F(_,1)):(_=Sa(S),_.c(),F(_,1),_.m(c,null)):_&&(it(),L(_,1,1,()=>{_=null}),at())},i(S){u||(F(h),F(r.$$.fragment,S),F(w),F(_),u=!0)},o(S){L(h),L(r.$$.fragment,S),L(w),L(_),u=!1},d(S){S&&U(e),h&&h.d(),Q(r),w&&w.d(),_&&_.d()}}}function Mh(n,e,t){let r,{openai:s}=e,{claude:i}=e,{settingStorage:a}=e,{promptStorage:o}=e,{selectedText:l}=e,{pageContent:c}=e,f="",u,h=!1,p=a.getValue("modelSelections"),d=!1,m="",g=!1,P;async function w(){t(6,d=!0),t(8,g=!0),t(7,m="");let T=f.startsWith("/")?f.slice(1):f,me=[];const Ue=l.trim().length>0;Ue?me.push({role:"user",content:`${l}

${T}`}):a.getValue("isPageContent")?me.push({role:"user",content:`${c.title}

${c.content}

${T}`}):me.push({role:"user",content:`${T}`});try{await wh(s,i,p,a,me,Ue,Ve=>{t(7,m=Ve),P&&t(9,P.scrollTop=P.scrollHeight,P)})}finally{t(8,g=!1)}}function _(T){T.key==="Enter"?w():T.key==="Escape"&&console.debug("ai指令取消")}La(()=>{u.focus()});function S(T){P=T,t(9,P)}function b(T){f=T,t(2,f)}function R(T){u=T,t(4,u)}function v(T){p=T,t(5,p)}function C(T){h=T,t(3,h)}function M(T){f=T,t(2,f)}function N(T){o=T,t(0,o)}return n.$$set=T=>{"openai"in T&&t(13,s=T.openai),"claude"in T&&t(14,i=T.claude),"settingStorage"in T&&t(1,a=T.settingStorage),"promptStorage"in T&&t(0,o=T.promptStorage),"selectedText"in T&&t(15,l=T.selectedText),"pageContent"in T&&t(16,c=T.pageContent)},n.$$.update=()=>{n.$$.dirty&12&&t(10,r=f.trim().startsWith("/")&&!h)},[o,a,f,h,u,p,d,m,g,P,r,w,_,s,i,l,c,S,b,R,v,C,M,N]}class Ih extends he{constructor(e){super(),de(this,e,Mh,Th,fe,{openai:13,claude:14,settingStorage:1,promptStorage:0,selectedText:15,pageContent:16})}}function Ea(n,e,t){const r=n.slice();return r[12]=e[t],r}function Aa(n,e,t){const r=n.slice();return r[15]=e[t],r[17]=t,r}function ka(n){let e,t,r,s=n[15].title+"",i,a,o,l=n[15].time+"",c,f,u,h,p,d;function m(){return n[8](n[17])}return{c(){e=k("div"),t=k("div"),r=k("span"),i=se(s),a=O(),o=k("span"),c=se(l),f=O(),u=k("button"),u.innerHTML='<svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none"><path d="M18 6L6 18M6 6l12 12"></path></svg>',h=O(),A(r,"class","svelte-1f176q4"),A(o,"class","time svelte-1f176q4"),A(t,"class","history-content svelte-1f176q4"),A(u,"class","delete-btn svelte-1f176q4"),A(u,"title","删除对话"),A(e,"class","history-item svelte-1f176q4")},m(g,P){H(g,e,P),y(e,t),y(t,r),y(r,i),y(t,a),y(t,o),y(o,c),y(e,f),y(e,u),y(e,h),p||(d=j(u,"click",rc(m)),p=!0)},p(g,P){n=g,P&1&&s!==(s=n[15].title+"")&&Ce(i,s),P&1&&l!==(l=n[15].time+"")&&Ce(c,l)},d(g){g&&U(e),p=!1,d()}}}function Pa(n){let e,t=n[12].content+"",r,s,i;return{c(){e=k("div"),r=se(t),s=O(),A(e,"class",i="message "+(n[12].role==="user"?"user":"ai")+" svelte-1f176q4")},m(a,o){H(a,e,o),y(e,r),y(e,s)},p(a,o){o&2&&t!==(t=a[12].content+"")&&Ce(r,t),o&2&&i!==(i="message "+(a[12].role==="user"?"user":"ai")+" svelte-1f176q4")&&A(e,"class",i)},d(a){a&&U(e)}}}function Nh(n){let e,t,r,s,i,a,o,l,c,f,u,h,p,d,m,g,P,w=xe(n[0]),_=[];for(let R=0;R<w.length;R+=1)_[R]=ka(Aa(n,w,R));let S=xe(n[1]),b=[];for(let R=0;R<S.length;R+=1)b[R]=Pa(Ea(n,S,R));return{c(){e=k("div"),t=k("div"),r=k("div"),r.innerHTML='<h3 class="svelte-1f176q4">思源AI</h3>',s=O(),i=k("div"),a=k("button"),a.textContent="+ 新建聊天",o=O();for(let R=0;R<_.length;R+=1)_[R].c();l=O(),c=k("div"),f=k("div");for(let R=0;R<b.length;R+=1)b[R].c();u=O(),h=k("div"),h.innerHTML='<button class="svelte-1f176q4">设置</button> <button class="svelte-1f176q4">用户</button> <button class="svelte-1f176q4">主题</button> <button class="svelte-1f176q4">搜索</button> <button class="svelte-1f176q4">表情</button> <button class="svelte-1f176q4">文件</button> <button class="svelte-1f176q4">图片</button> <button class="svelte-1f176q4">应用</button> <button class="svelte-1f176q4">卡片</button>',p=O(),d=k("div"),m=k("textarea"),A(r,"class","history-header svelte-1f176q4"),A(a,"class","add-history-btn svelte-1f176q4"),A(a,"style",""),A(i,"class","history-list svelte-1f176q4"),A(t,"class","history-panel svelte-1f176q4"),A(f,"class","messages-container svelte-1f176q4"),A(h,"class","toolbar svelte-1f176q4"),A(m,"placeholder","Enter 发送，Shift + Enter 换行，/触发命令"),A(m,"class","svelte-1f176q4"),A(d,"class","input-container svelte-1f176q4"),A(c,"class","chat-panel svelte-1f176q4"),A(e,"class","chat-container svelte-1f176q4")},m(R,v){H(R,e,v),y(e,t),y(t,r),y(t,s),y(t,i),y(i,a),y(i,o);for(let C=0;C<_.length;C+=1)_[C]&&_[C].m(i,null);y(e,l),y(e,c),y(c,f);for(let C=0;C<b.length;C+=1)b[C]&&b[C].m(f,null);n[9](f),y(c,u),y(c,h),y(c,p),y(c,d),y(d,m),we(m,n[2]),g||(P=[j(a,"click",Fh),j(m,"input",n[10]),j(m,"keydown",n[11])],g=!0)},p(R,[v]){if(v&33){w=xe(R[0]);let C;for(C=0;C<w.length;C+=1){const M=Aa(R,w,C);_[C]?_[C].p(M,v):(_[C]=ka(M),_[C].c(),_[C].m(i,null))}for(;C<_.length;C+=1)_[C].d(1);_.length=w.length}if(v&2){S=xe(R[1]);let C;for(C=0;C<S.length;C+=1){const M=Ea(R,S,C);b[C]?b[C].p(M,v):(b[C]=Pa(M),b[C].c(),b[C].m(f,null))}for(;C<b.length;C+=1)b[C].d(1);b.length=S.length}v&4&&we(m,R[2])},i:ne,o:ne,d(R){R&&U(e),Ln(_,R),Ln(b,R),n[9](null),g=!1,oe(P)}}}const Fh=()=>{};function Bh(n,e,t){let{settingStorage:r}=e,{chatHistoryStorage:s}=e,i=s.dump();console.debug(r);let a=[],o="",l;hc(()=>{l&&t(3,l.scrollTop=l.scrollHeight,l)});function c(){o.trim()&&(t(1,a=[...a,{role:"user",content:o}]),t(2,o=""))}function f(m){t(0,i=i.filter((g,P)=>P!==m)),s.save(i)}const u=m=>f(m);function h(m){ie[m?"unshift":"push"](()=>{l=m,t(3,l)})}function p(){o=this.value,t(2,o)}const d=m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),c())};return n.$$set=m=>{"settingStorage"in m&&t(6,r=m.settingStorage),"chatHistoryStorage"in m&&t(7,s=m.chatHistoryStorage)},n.$$.update=()=>{n.$$.dirty&3&&i.length>0&&a.length===0&&t(1,a=i[0].messages||[])},[i,a,o,l,c,f,r,s,u,h,p,d]}class Lh extends he{constructor(e){super(),de(this,e,Bh,Nh,fe,{settingStorage:6,chatHistoryStorage:7})}}function Dh(n,e,t,r){const s=new et.Dialog({title:"",content:'<div id="ai-instruction""></div>',width:"40%",hideCloseIcon:!0}),i=hh(),a=mh();n.getValue("apiKey").trim().length<=0&&xa("请先设置API Key"),new Ih({target:s.element.querySelector("#ai-instruction"),props:{openai:e,claude:t,settingStorage:n,promptStorage:r,selectedText:i,pageContent:a}})}function qh(n,e,t,r){const s=new et.Dialog({title:"",content:'<div id="ai-chat" style="height: 100%; margin:0px; padding:0px;"></div>',width:"60%",height:"70%",hideCloseIcon:!0});new Lh({target:s.element.querySelector("#ai-chat"),props:{openai:e,claude:t,settingStorage:n,chatHistoryStorage:r}})}function Uh(n){let e,t,r,s,i,a,o,l,c,f,u,h,p,d,m,g,P,w,_,S,b,R,v;return{c(){e=k("div"),t=k("h2"),t.textContent="token",r=O(),s=k("p"),s.textContent=`token
        是模型用来表示自然语言文本的基本单位，可以直观的理解为“字”或“词”；通常 1
        个中文词语、1 个英文单词、1 个数字或 1 个符号计为 1 个 token。`,i=O(),a=k("h2"),a.textContent="Temperature 设置",o=O(),l=k("p"),l.innerHTML=`​<span data-type="code">temperature</span>​ 参数默认为
        1.0。建议您根据如下表格，按使用场景设置
        <span data-type="code">temperature</span>​。`,c=O(),f=k("table"),f.innerHTML="<thead><tr><th>场景</th> <th>温度</th></tr></thead> <tbody><tr><td>代码生成/数学解题</td> <td>0.0</td></tr> <tr><td>数据抽取/分析</td> <td>1.0</td></tr> <tr><td>通用对话</td> <td>1.3</td></tr> <tr><td>翻译</td> <td>1.3</td></tr> <tr><td>创意类写作/诗歌创作</td> <td>1.5</td></tr></tbody>",u=O(),h=k("h2"),h.textContent="model",p=O(),d=k("p"),d.textContent="扣减费用 = token 消耗量 × 模型单价，对应的费用将直接余额中进行扣减。",m=O(),g=k("table"),g.innerHTML='<thead><tr><th>模型</th> <th>上下文长度</th> <th>最大输出长度</th> <th>输入价格<br/></th> <th>输出价格</th></tr></thead> <tbody><tr><td><span data-type="strong">deepseek-chat</span></td> <td>64K</td> <td>8K</td> <td>1元/百万tokens</td> <td>2元/百万tokens</td></tr> <tr><td>qwen-max</td> <td>32,768</td> <td>8,192</td> <td>20元/百万tokens</td> <td>60元/百万tokens</td></tr> <tr><td>qwen-plus</td> <td>129,024</td> <td>8,192</td> <td>0.8元/百万tokens</td> <td>2元/百万tokens</td></tr> <tr><td>qwen-turbo</td> <td>1,000,000</td> <td>8,192</td> <td>0.3元/百万tokens</td> <td>0.6元/百万tokens</td></tr> <tr><td>qwen-long</td> <td>10,000,000</td> <td>6,000</td> <td>0.25元/百万tokens</td> <td>1元/百万tokens</td></tr> <tr><td><span data-type="s">gpt-3.5-turbo</span></td> <td></td> <td></td> <td><span data-type="s">6元/百万tokens</span></td> <td><span data-type="s">18元/百万tokens</span></td></tr> <tr><td>gpt-4o-mini</td> <td></td> <td></td> <td>1.8元/百万tokens</td> <td>7.2元/百万tokens</td></tr> <tr><td>gpt-4o</td> <td></td> <td></td> <td>30元/百万tokens</td> <td>120元/百万tokens</td></tr> <tr><td><span data-type="strong text" style="color: var(--b3-font-color8);">gpt-4-turbo</span></td> <td></td> <td></td> <td>120元/百万tokens</td> <td>360元/百万tokens</td></tr> <tr><td>claude-3-5-haiku</td> <td></td> <td></td> <td>12元/百万tokens</td> <td>60元/百万tokens</td></tr> <tr><td>claude-3-5-sonnet</td> <td></td> <td></td> <td>36元/百万tokens</td> <td>180元/百万tokens</td></tr> <tr><td><span data-type="strong text" style="color: var(--b3-font-color8);">claude-3-opus</span></td> <td></td> <td></td> <td>180元/百万tokens</td> <td>900元/百万tokens</td></tr> <tr><td>gemini-1.5-flash</td> <td></td> <td></td> <td>0.896元/百万tokens</td> <td>3.6元/百万tokens</td></tr> <tr><td>gemini-1.5-pro</td> <td></td> <td></td> <td>15元/百万tokens</td> <td>60元/百万tokens</td></tr></tbody>',P=O(),w=k("h3"),w.textContent="排行榜",_=O(),S=k("p"),S.innerHTML='<a href="https://www.datalearner.com/ai-models/leaderboard/datalearner-llm-leaderboard">大模型综合能力排行榜</a>',b=O(),R=k("p"),R.innerHTML='<a href="https://www.datalearner.com/ai-models/leaderboard/datalearner-llm-coding-leaderboard#google_vignette">大模型编程能力排行榜</a>',A(e,"class",v="b3-typography "+n[0]),x(e,"margin","10px auto"),x(e,"max-height","80vh"),x(e,"overflow-y","auto"),x(e,"width","95%"),x(e,"max-width","1200px")},m(C,M){H(C,e,M),y(e,t),y(e,r),y(e,s),y(e,i),y(e,a),y(e,o),y(e,l),y(e,c),y(e,f),y(e,u),y(e,h),y(e,p),y(e,d),y(e,m),y(e,g),y(e,P),y(e,w),y(e,_),y(e,S),y(e,b),y(e,R)},p(C,[M]){M&1&&v!==(v="b3-typography "+C[0])&&A(e,"class",v)},i:ne,o:ne,d(C){C&&U(e)}}}function $h(n,e,t){let r,{display:s=!0}=e;return n.$$set=i=>{"display"in i&&t(1,s=i.display)},n.$$.update=()=>{n.$$.dirty&2&&t(0,r=s?"":"fn__none")},[r,s]}let jh=class extends he{constructor(e){super(),de(this,e,$h,Uh,fe,{display:1})}};function Hh(n){let e,t,r,s,i,a,o,l,c,f,u,h,p,d,m,g,P,w,_,S,b,R,v,C,M,N,T,me,Ue,Ve,Mt,_r,ci,yr,ui,wr,fi,Ye,di,hn;return{c(){e=k("div"),t=k("h1"),t.textContent="功能介绍",r=O(),s=k("h2"),s.textContent="指令模式",i=O(),a=k("p"),a.textContent="快捷键：option + command + k",o=O(),l=k("div"),l.innerHTML='<img src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/yyy.jpg" alt=""/>',c=O(),f=k("h3"),f.textContent="设置超参数",u=O(),h=k("div"),h.innerHTML='<img src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/xx.jpg" alt=""/>',p=O(),d=k("h3"),d.textContent="选择模型",m=O(),g=k("div"),g.innerHTML='<img src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/WechatIMG252.jpg" alt=""/>',P=O(),w=k("h3"),w.textContent="无中生有",_=O(),S=k("p"),S.textContent="当前文档中没有写入任何内容，直接通过指令让大模型帮助生成内容。",b=O(),R=k("div"),R.innerHTML=`<video controls="" src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/%E6%97%A0%E4%B8%AD%E7%94%9F%E6%9C%89.mp4" data-src=""><track kind="captions" label="中文字幕" src="" default=""/>
            不支持视频播放。</video>`,v=O(),C=k("h3"),C.textContent="修改润色",M=O(),N=k("div"),N.innerHTML=`<video controls="" src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3.mp4" data-src=""><track kind="captions" label="中文字幕" src="" default=""/>
            不支持视频播放。</video>`,T=O(),me=k("h3"),me.textContent="扩写",Ue=O(),Ve=k("div"),Ve.innerHTML=`<video controls="" src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/%E6%89%A9%E5%86%99.mp4" data-src=""><track kind="captions" label="中文字幕" src="" default=""/>
            不支持视频播放。</video>`,Mt=O(),_r=k("h2"),_r.textContent="聊天模式",ci=O(),yr=k("p"),yr.textContent="开发中...",ui=O(),wr=k("h2"),wr.textContent="来提意见",fi=O(),Ye=k("img"),A(a,"id","20250116161508-2ifhw0n"),A(l,"class","iframe"),A(h,"class","iframe"),A(g,"class","iframe"),A(R,"class","iframe"),A(N,"class","iframe"),A(Ve,"class","iframe"),Gl(Ye.src,di="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/WechatIMG6765.jpg")||A(Ye,"src",di),A(Ye,"alt",""),x(Ye,"width","50%"),x(Ye,"height","auto"),A(e,"class",hn="b3-typography "+n[0]),x(e,"max-width","800px"),x(e,"margin","0 auto")},m(It,br){H(It,e,br),y(e,t),y(e,r),y(e,s),y(e,i),y(e,a),y(e,o),y(e,l),y(e,c),y(e,f),y(e,u),y(e,h),y(e,p),y(e,d),y(e,m),y(e,g),y(e,P),y(e,w),y(e,_),y(e,S),y(e,b),y(e,R),y(e,v),y(e,C),y(e,M),y(e,N),y(e,T),y(e,me),y(e,Ue),y(e,Ve),y(e,Mt),y(e,_r),y(e,ci),y(e,yr),y(e,ui),y(e,wr),y(e,fi),y(e,Ye)},p(It,[br]){br&1&&hn!==(hn="b3-typography "+It[0])&&A(e,"class",hn)},i:ne,o:ne,d(It){It&&U(e)}}}function Wh(n,e,t){let r,{display:s=!0}=e;return n.$$set=i=>{"display"in i&&t(1,s=i.display)},n.$$.update=()=>{n.$$.dirty&2&&t(0,r=s?"":"fn__none")},[r,s]}let Vh=class extends he{constructor(e){super(),de(this,e,Wh,Hh,fe,{display:1})}};function Ra(n,e,t){const r=n.slice();return r[8]=e[t],r}function Ca(n){let e,t,r,s,i;function a(){return n[4](n[8])}return{c(){e=k("li"),t=k("span"),t.textContent=`${n[8]}`,r=O(),A(t,"class","b3-list-item__text"),A(e,"data-name","editor"),A(e,"class","b3-list-item"),z(e,"b3-list-item--focus",n[8]===n[2])},m(o,l){H(o,e,l),y(e,t),y(e,r),s||(i=[j(e,"click",a),j(e,"keydown",Xh)],s=!0)},p(o,l){n=o,l&12&&z(e,"b3-list-item--focus",n[8]===n[2])},d(o){o&&U(e),s=!1,oe(i)}}}function Jh(n){let e,t,r,s,i,a,o,l,c,f,u,h,p,d,m,g,P,w,_=xe(n[3]),S=[];for(let b=0;b<_.length;b+=1)S[b]=Ca(Ra(n,_,b));return i=new Wl({props:{group:n[3][0],settingStorage:n[0],display:n[2]===n[3][0]}}),i.$on("changed",n[5]),o=new jh({props:{display:n[2]===n[3][2]}}),c=new Vh({props:{display:n[2]===n[3][3]}}),h=new Yn({props:{label:"取消",text:!0,outline:!0}}),h.$on("click",n[6]),g=new Yn({props:{label:"确认",text:!1,outline:!1}}),g.$on("click",n[7]),{c(){e=k("div"),t=k("ul");for(let b=0;b<S.length;b+=1)S[b].c();r=O(),s=k("div"),Y(i.$$.fragment),a=O(),Y(o.$$.fragment),l=O(),Y(c.$$.fragment),f=O(),u=k("div"),Y(h.$$.fragment),p=O(),d=k("div"),m=O(),Y(g.$$.fragment),A(t,"class","b3-tab-bar b3-list b3-list--background"),A(d,"class","fn__space"),A(u,"class",P="b3-dialog__action "+(n[2]==n[3][0]?"":"fn__none")),A(s,"class","config__tab-wrap"),A(e,"class","fn__flex-1 fn__flex config__panel")},m(b,R){H(b,e,R),y(e,t);for(let v=0;v<S.length;v+=1)S[v]&&S[v].m(t,null);y(e,r),y(e,s),G(i,s,null),y(s,a),G(o,s,null),y(s,l),G(c,s,null),y(s,f),y(s,u),G(h,u,null),y(u,p),y(u,d),y(u,m),G(g,u,null),w=!0},p(b,[R]){if(R&12){_=xe(b[3]);let N;for(N=0;N<_.length;N+=1){const T=Ra(b,_,N);S[N]?S[N].p(T,R):(S[N]=Ca(T),S[N].c(),S[N].m(t,null))}for(;N<S.length;N+=1)S[N].d(1);S.length=_.length}const v={};R&1&&(v.settingStorage=b[0]),R&4&&(v.display=b[2]===b[3][0]),i.$set(v);const C={};R&4&&(C.display=b[2]===b[3][2]),o.$set(C);const M={};R&4&&(M.display=b[2]===b[3][3]),c.$set(M),(!w||R&4&&P!==(P="b3-dialog__action "+(b[2]==b[3][0]?"":"fn__none")))&&A(u,"class",P)},i(b){w||(F(i.$$.fragment,b),F(o.$$.fragment,b),F(c.$$.fragment,b),F(h.$$.fragment,b),F(g.$$.fragment,b),w=!0)},o(b){L(i.$$.fragment,b),L(o.$$.fragment,b),L(c.$$.fragment,b),L(h.$$.fragment,b),L(g.$$.fragment,b),w=!1},d(b){b&&U(e),Ln(S,b),Q(i),Q(o),Q(c),Q(h),Q(g)}}}const Xh=()=>{};function Kh(n,e,t){let r=["🌈 设置","💬 公告","✨ 功能"],s=r[0],{settingStorage:i}=e,{dialog:a}=e;const o=u=>{t(2,s=u)},l=({detail:u})=>{i.setValue(u.key,u.value)},c=()=>{i.load(),a.destroy()},f=()=>{i.save(),a.destroy()};return n.$$set=u=>{"settingStorage"in u&&t(0,i=u.settingStorage),"dialog"in u&&t(1,a=u.dialog)},[i,a,s,r,o,l,c,f]}class zh extends he{constructor(e){super(),de(this,e,Kh,Jh,fe,{settingStorage:0,dialog:1})}}const Gh=`<symbol id="iconFace" viewBox="0 0 32 32">
<path d="M13.667 17.333c0 0.92-0.747 1.667-1.667 1.667s-1.667-0.747-1.667-1.667 0.747-1.667 1.667-1.667 1.667 0.747 1.667 1.667zM20 15.667c-0.92 0-1.667 0.747-1.667 1.667s0.747 1.667 1.667 1.667 1.667-0.747 1.667-1.667-0.747-1.667-1.667-1.667zM29.333 16c0 7.36-5.973 13.333-13.333 13.333s-13.333-5.973-13.333-13.333 5.973-13.333 13.333-13.333 13.333 5.973 13.333 13.333zM14.213 5.493c1.867 3.093 5.253 5.173 9.12 5.173 0.613 0 1.213-0.067 1.787-0.16-1.867-3.093-5.253-5.173-9.12-5.173-0.613 0-1.213 0.067-1.787 0.16zM5.893 12.627c2.28-1.293 4.040-3.4 4.88-5.92-2.28 1.293-4.040 3.4-4.88 5.92zM26.667 16c0-1.040-0.16-2.040-0.44-2.987-0.933 0.2-1.893 0.32-2.893 0.32-4.173 0-7.893-1.92-10.347-4.92-1.4 3.413-4.187 6.093-7.653 7.4 0.013 0.053 0 0.12 0 0.187 0 5.88 4.787 10.667 10.667 10.667s10.667-4.787 10.667-10.667z"></path>
</symbol>`,Qh=`<symbol id="iconSaving" viewBox="0 0 32 32">
<path d="M20 13.333c0-0.733 0.6-1.333 1.333-1.333s1.333 0.6 1.333 1.333c0 0.733-0.6 1.333-1.333 1.333s-1.333-0.6-1.333-1.333zM10.667 12h6.667v-2.667h-6.667v2.667zM29.333 10v9.293l-3.76 1.253-2.24 7.453h-7.333v-2.667h-2.667v2.667h-7.333c0 0-3.333-11.28-3.333-15.333s3.28-7.333 7.333-7.333h6.667c1.213-1.613 3.147-2.667 5.333-2.667 1.107 0 2 0.893 2 2 0 0.28-0.053 0.533-0.16 0.773-0.187 0.453-0.347 0.973-0.427 1.533l3.027 3.027h2.893zM26.667 12.667h-1.333l-4.667-4.667c0-0.867 0.12-1.72 0.347-2.547-1.293 0.333-2.347 1.293-2.787 2.547h-8.227c-2.573 0-4.667 2.093-4.667 4.667 0 2.507 1.627 8.867 2.68 12.667h2.653v-2.667h8v2.667h2.68l2.067-6.867 3.253-1.093v-4.707z"></path>
</symbol>`;class Yh extends et.Plugin{constructor(t){super(t);pe(this,"_isMobile");pe(this,"_settingStorage");pe(this,"_promptStorage");pe(this,"_chatHistoryStorage");pe(this,"_openai");pe(this,"_claude");this._settingStorage=new lf(this,us),this._promptStorage=new of(this,fs),this._chatHistoryStorage=new af(this,yl),this._isMobile=et.getFrontend()==="mobile"||et.getFrontend()==="browser-mobile"}async onload(){console.log("onload...."),this._settingStorage.load().then(()=>{const t=this._settingStorage.getValue("apiKey");this._openai=new $({baseURL:`${Ki}/v1`,apiKey:t,dangerouslyAllowBrowser:!0}),this._claude=new J({baseURL:`${Ki}/claude`,apiKey:t,dangerouslyAllowBrowser:!0})}),this._promptStorage.load(),this._chatHistoryStorage.load(),this.addIcons(Gh),this.addIcons(Qh),this.addCommand({langKey:"Instruction",hotkey:"⌥⌘K",callback:()=>Dh(this._settingStorage,this._openai,this._claude,this._promptStorage)}),this.addCommand({langKey:"Chat",hotkey:"⌥⌘L",callback:()=>qh(this._settingStorage,this._openai,this._claude,this._chatHistoryStorage)}),console.log("onload....end")}onLayoutReady(){}uninstall(){this.removeData(us),this.removeData(fs),xa("数据已清除，思源AI插件卸载成功！")}openSetting(){if(!this._settingStorage)return;if(this._isMobile){va("请在桌面端使用");return}let t=new et.Dialog({title:"思源AI设置",width:"70%",height:"60%",content:'<div class="b3-dialog__content" id="AISettingPanel" ></div>'});new zh({target:t.element.querySelector("#AISettingPanel"),props:{settingStorage:this._settingStorage,dialog:t}})}}module.exports=Yh;
