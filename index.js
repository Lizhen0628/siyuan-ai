"use strict";var zl=Object.defineProperty;var Wl=(n,e,t)=>e in n?zl(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Se=(n,e,t)=>Wl(n,typeof e!="symbol"?e+"":e,t);const Ze=require("siyuan");async function rn(n,e){let t=await Ze.fetchSyncPost(n,e);return t.code===0?t.data:null}async function Vl(n,e,t,r,s){return rn("/api/block/insertBlock",{dataType:n,data:e,nextID:t,previousID:r,parentID:s})}async function Jl(n,e,t){return rn("/api/block/appendBlock",{dataType:n,data:e,parentID:t})}async function Xl(n){return rn("/api/block/deleteBlock",{id:n})}async function Ra(n,e=7e3){return rn("/api/notification/pushMsg",{msg:n,timeout:e})}async function Ca(n,e=7e3){return rn("/api/notification/pushErrMsg",{msg:n,timeout:e})}function Z(){}const xa=n=>n;function Bn(n,e){for(const t in e)n[t]=e[t];return n}function va(n){return n()}function fi(){return Object.create(null)}function ae(n){n.forEach(va)}function wt(n){return typeof n=="function"}function fe(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let mn;function Kl(n,e){return n===e?!0:(mn||(mn=document.createElement("a")),mn.href=e,n===mn.href)}function Gl(n){return Object.keys(n).length===0}function ys(n,e,t,r){if(n){const s=Oa(n,e,t,r);return n[0](s)}}function Oa(n,e,t,r){return n[1]&&r?Bn(t.ctx.slice(),n[1](r(e))):t.ctx}function bs(n,e,t,r){if(n[2]&&r){const s=n[2](r(t));if(e.dirty===void 0)return s;if(typeof s=="object"){const i=[],a=Math.max(e.dirty.length,s.length);for(let o=0;o<a;o+=1)i[o]=e.dirty[o]|s[o];return i}return e.dirty|s}return e.dirty}function ws(n,e,t,r,s,i){if(s){const a=Oa(e,t,r,i);n.p(a,s)}}function Ss(n){if(n.ctx.length>32){const e=[],t=n.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function di(n){const e={};for(const t in n)t[0]!=="$"&&(e[t]=n[t]);return e}const Ql=["",!0,1,"true","contenteditable"],Ta=typeof window<"u";let Yl=Ta?()=>window.performance.now():()=>Date.now(),Es=Ta?n=>requestAnimationFrame(n):Z;const St=new Set;function Ma(n){St.forEach(e=>{e.c(n)||(St.delete(e),e.f())}),St.size!==0&&Es(Ma)}function Zl(n){let e;return St.size===0&&Es(Ma),{promise:new Promise(t=>{St.add(e={c:n,f:t})}),abort(){St.delete(e)}}}function b(n,e){n.appendChild(e)}function Ia(n){if(!n)return document;const e=n.getRootNode?n.getRootNode():n.ownerDocument;return e&&e.host?e:n.ownerDocument}function ec(n){const e=R("style");return e.textContent="/* empty */",tc(Ia(n),e),e.sheet}function tc(n,e){return b(n.head||n,e),e.sheet}function q(n,e,t){n.insertBefore(e,t||null)}function U(n){n.parentNode&&n.parentNode.removeChild(n)}function Ln(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function R(n){return document.createElement(n)}function le(n){return document.createTextNode(n)}function O(){return le(" ")}function As(){return le("")}function H(n,e,t,r){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}function A(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}const nc=["width","height"];function hi(n,e){const t=Object.getOwnPropertyDescriptors(n.__proto__);for(const r in e)e[r]==null?n.removeAttribute(r):r==="style"?n.style.cssText=e[r]:r==="__value"?n.value=n[r]=e[r]:t[r]&&t[r].set&&nc.indexOf(r)===-1?n[r]=e[r]:A(n,r,e[r])}function Wr(n){return n===""?null:+n}function rc(n){return Array.from(n.childNodes)}function Ie(n,e){e=""+e,n.data!==e&&(n.data=e)}function sc(n,e){e=""+e,n.wholeText!==e&&(n.data=e)}function ic(n,e,t){~Ql.indexOf(t)?sc(n,e):Ie(n,e)}function _e(n,e){n.value=e??""}function x(n,e,t,r){t==null?n.style.removeProperty(e):n.style.setProperty(e,t,"")}function mi(n,e,t){for(let r=0;r<n.options.length;r+=1){const s=n.options[r];if(s.__value===e){s.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function ac(n){const e=n.querySelector(":checked");return e&&e.__value}function K(n,e,t){n.classList.toggle(e,!!t)}function Na(n,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:r})}const Dn=new Map;let $n=0;function oc(n){let e=5381,t=n.length;for(;t--;)e=(e<<5)-e^n.charCodeAt(t);return e>>>0}function lc(n,e){const t={stylesheet:ec(e),rules:{}};return Dn.set(n,t),t}function pi(n,e,t,r,s,i,a,o=0){const l=16.666/r;let c=`{
`;for(let p=0;p<=1;p+=l){const k=e+(t-e)*i(p);c+=p*100+`%{${a(k,1-k)}}
`}const f=c+`100% {${a(t,1-t)}}
}`,u=`__svelte_${oc(f)}_${o}`,h=Ia(n),{stylesheet:m,rules:d}=Dn.get(h)||lc(h,n);d[u]||(d[u]=!0,m.insertRule(`@keyframes ${u} ${f}`,m.cssRules.length));const g=n.style.animation||"";return n.style.animation=`${g?`${g}, `:""}${u} ${r}ms linear ${s}ms 1 both`,$n+=1,u}function cc(n,e){const t=(n.style.animation||"").split(", "),r=t.filter(e?i=>i.indexOf(e)<0:i=>i.indexOf("__svelte")===-1),s=t.length-r.length;s&&(n.style.animation=r.join(", "),$n-=s,$n||uc())}function uc(){Es(()=>{$n||(Dn.forEach(n=>{const{ownerNode:e}=n.stylesheet;e&&U(e)}),Dn.clear())})}let Yt;function Xt(n){Yt=n}function Fa(){if(!Yt)throw new Error("Function called outside component initialization");return Yt}function Ba(n){Fa().$$.on_mount.push(n)}function Zn(){const n=Fa();return(e,t,{cancelable:r=!1}={})=>{const s=n.$$.callbacks[e];if(s){const i=Na(e,t,{cancelable:r});return s.slice().forEach(a=>{a.call(n,i)}),!i.defaultPrevented}return!0}}function fc(n,e){const t=n.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}const mt=[],ie=[];let Et=[];const Vr=[],dc=Promise.resolve();let Jr=!1;function hc(){Jr||(Jr=!0,dc.then(La))}function ot(n){Et.push(n)}function ke(n){Vr.push(n)}const Sr=new Set;let ut=0;function La(){if(ut!==0)return;const n=Yt;do{try{for(;ut<mt.length;){const e=mt[ut];ut++,Xt(e),mc(e.$$)}}catch(e){throw mt.length=0,ut=0,e}for(Xt(null),mt.length=0,ut=0;ie.length;)ie.pop()();for(let e=0;e<Et.length;e+=1){const t=Et[e];Sr.has(t)||(Sr.add(t),t())}Et.length=0}while(mt.length);for(;Vr.length;)Vr.pop()();Jr=!1,Sr.clear(),Xt(n)}function mc(n){if(n.fragment!==null){n.update(),ae(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(ot)}}function pc(n){const e=[],t=[];Et.forEach(r=>n.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),Et=e}let Ft;function gc(){return Ft||(Ft=Promise.resolve(),Ft.then(()=>{Ft=null})),Ft}function Er(n,e,t){n.dispatchEvent(Na(`${e?"intro":"outro"}${t}`))}const Rn=new Set;let He;function st(){He={r:0,c:[],p:He}}function it(){He.r||ae(He.c),He=He.p}function F(n,e){n&&n.i&&(Rn.delete(n),n.i(e))}function L(n,e,t,r){if(n&&n.o){if(Rn.has(n))return;Rn.add(n),He.c.push(()=>{Rn.delete(n),r&&(t&&n.d(1),r())}),n.o(e)}else r&&r()}const _c={duration:0};function Un(n,e,t,r){let i=e(n,t,{direction:"both"}),a=r?0:1,o=null,l=null,c=null,f;function u(){c&&cc(n,c)}function h(d,g){const p=d.b-a;return g*=Math.abs(p),{a,b:d.b,d:p,duration:g,start:d.start,end:d.start+g,group:d.group}}function m(d){const{delay:g=0,duration:p=300,easing:k=xa,tick:_=Z,css:w}=i||_c,y={start:Yl()+g,b:d};d||(y.group=He,He.r+=1),"inert"in n&&(d?f!==void 0&&(n.inert=f):(f=n.inert,n.inert=!0)),o||l?l=y:(w&&(u(),c=pi(n,a,d,p,g,k,w)),d&&_(0,1),o=h(y,p),ot(()=>Er(n,d,"start")),Zl(S=>{if(l&&S>l.start&&(o=h(l,p),l=null,Er(n,o.b,"start"),w&&(u(),c=pi(n,a,o.b,o.duration,0,k,i.css))),o){if(S>=o.end)_(a=o.b,1-a),Er(n,o.b,"end"),l||(o.b?u():--o.group.r||ae(o.group.c)),o=null;else if(S>=o.start){const P=S-o.start;a=o.a+o.d*k(P/o.duration),_(a,1-a)}}return!!(o||l)}))}return{run(d){wt(i)?gc().then(()=>{i=i({direction:d?"in":"out"}),m(d)}):m(d)},end(){u(),o=l=null}}}function xe(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function yc(n,e){n.d(1),e.delete(n.key)}function bc(n,e){L(n,1,1,()=>{e.delete(n.key)})}function Da(n,e,t,r,s,i,a,o,l,c,f,u){let h=n.length,m=i.length,d=h;const g={};for(;d--;)g[n[d].key]=d;const p=[],k=new Map,_=new Map,w=[];for(d=m;d--;){const C=u(s,i,d),T=t(C);let I=a.get(T);I?w.push(()=>I.p(C,e)):(I=c(T,C),I.c()),k.set(T,p[d]=I),T in g&&_.set(T,Math.abs(d-g[T]))}const y=new Set,S=new Set;function P(C){F(C,1),C.m(o,f),a.set(C.key,C),f=C.first,m--}for(;h&&m;){const C=p[m-1],T=n[h-1],I=C.key,N=T.key;C===T?(f=C.first,h--,m--):k.has(N)?!a.has(I)||y.has(I)?P(C):S.has(N)?h--:_.get(I)>_.get(N)?(S.add(I),P(C)):(y.add(N),h--):(l(T,a),h--)}for(;h--;){const C=n[h];k.has(C.key)||l(C,a)}for(;m;)P(p[m-1]);return ae(w),p}function wc(n,e){const t={},r={},s={$$scope:1};let i=n.length;for(;i--;){const a=n[i],o=e[i];if(o){for(const l in a)l in o||(r[l]=1);for(const l in o)s[l]||(t[l]=o[l],s[l]=1);n[i]=o}else for(const l in a)s[l]=1}for(const a in r)a in t||(t[a]=void 0);return t}function Pe(n,e,t){const r=n.$$.props[e];r!==void 0&&(n.$$.bound[r]=t,t(n.$$.ctx[r]))}function Y(n){n&&n.c()}function G(n,e,t){const{fragment:r,after_update:s}=n.$$;r&&r.m(e,t),ot(()=>{const i=n.$$.on_mount.map(va).filter(wt);n.$$.on_destroy?n.$$.on_destroy.push(...i):ae(i),n.$$.on_mount=[]}),s.forEach(ot)}function Q(n,e){const t=n.$$;t.fragment!==null&&(pc(t.after_update),ae(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Sc(n,e){n.$$.dirty[0]===-1&&(mt.push(n),hc(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function de(n,e,t,r,s,i,a=null,o=[-1]){const l=Yt;Xt(n);const c=n.$$={fragment:null,ctx:[],props:i,update:Z,not_equal:s,bound:fi(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:fi(),dirty:o,skip_bound:!1,root:e.target||l.$$.root};a&&a(c.root);let f=!1;if(c.ctx=t?t(n,e.props||{},(u,h,...m)=>{const d=m.length?m[0]:h;return c.ctx&&s(c.ctx[u],c.ctx[u]=d)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](d),f&&Sc(n,u)),h}):[],c.update(),f=!0,ae(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const u=rc(e.target);c.fragment&&c.fragment.l(u),u.forEach(U)}else c.fragment&&c.fragment.c();e.intro&&F(n.$$.fragment),G(n,e.target,e.anchor),La()}Xt(l)}class he{constructor(){Se(this,"$$");Se(this,"$$set")}$destroy(){Q(this,1),this.$destroy=Z}$on(e,t){if(!wt(t))return Z;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!Gl(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Ec="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ec);const Xr="RFC3986",Kr={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},Ac="RFC1738",kc=Array.isArray,Be=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),Ar=1024,Pc=(n,e,t,r,s)=>{if(n.length===0)return n;let i=n;if(typeof n=="symbol"?i=Symbol.prototype.toString.call(n):typeof n!="string"&&(i=String(n)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=Ar){const l=i.length>=Ar?i.slice(o,o+Ar):i,c=[];for(let f=0;f<l.length;++f){let u=l.charCodeAt(f);if(u===45||u===46||u===95||u===126||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||s===Ac&&(u===40||u===41)){c[c.length]=l.charAt(f);continue}if(u<128){c[c.length]=Be[u];continue}if(u<2048){c[c.length]=Be[192|u>>6]+Be[128|u&63];continue}if(u<55296||u>=57344){c[c.length]=Be[224|u>>12]+Be[128|u>>6&63]+Be[128|u&63];continue}f+=1,u=65536+((u&1023)<<10|l.charCodeAt(f)&1023),c[c.length]=Be[240|u>>18]+Be[128|u>>12&63]+Be[128|u>>6&63]+Be[128|u&63]}a+=c.join("")}return a};function Rc(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function gi(n,e){if(kc(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const Cc=Object.prototype.hasOwnProperty,$a={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},De=Array.isArray,xc=Array.prototype.push,Ua=function(n,e){xc.apply(n,De(e)?e:[e])},vc=Date.prototype.toISOString,ne={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Pc,encodeValuesOnly:!1,format:Xr,formatter:Kr[Xr],indices:!1,serializeDate(n){return vc.call(n)},skipNulls:!1,strictNullHandling:!1};function Oc(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const kr={};function ja(n,e,t,r,s,i,a,o,l,c,f,u,h,m,d,g,p,k){let _=n,w=k,y=0,S=!1;for(;(w=w.get(kr))!==void 0&&!S;){const N=w.get(n);if(y+=1,typeof N<"u"){if(N===y)throw new RangeError("Cyclic object value");S=!0}typeof w.get(kr)>"u"&&(y=0)}if(typeof c=="function"?_=c(e,_):_ instanceof Date?_=h==null?void 0:h(_):t==="comma"&&De(_)&&(_=gi(_,function(N){return N instanceof Date?h==null?void 0:h(N):N})),_===null){if(i)return l&&!g?l(e,ne.encoder,p,"key",m):e;_=""}if(Oc(_)||Rc(_)){if(l){const N=g?e:l(e,ne.encoder,p,"key",m);return[(d==null?void 0:d(N))+"="+(d==null?void 0:d(l(_,ne.encoder,p,"value",m)))]}return[(d==null?void 0:d(e))+"="+(d==null?void 0:d(String(_)))]}const P=[];if(typeof _>"u")return P;let C;if(t==="comma"&&De(_))g&&l&&(_=gi(_,l)),C=[{value:_.length>0?_.join(",")||null:void 0}];else if(De(c))C=c;else{const N=Object.keys(_);C=f?N.sort(f):N}const T=o?String(e).replace(/\./g,"%2E"):String(e),I=r&&De(_)&&_.length===1?T+"[]":T;if(s&&De(_)&&_.length===0)return I+"[]";for(let N=0;N<C.length;++N){const v=C[N],we=typeof v=="object"&&typeof v.value<"u"?v.value:_[v];if(a&&we===null)continue;const ze=u&&o?v.replace(/\./g,"%2E"):v,ct=De(_)?typeof t=="function"?t(I,ze):I:I+(u?"."+ze:"["+ze+"]");k.set(n,y);const It=new WeakMap;It.set(kr,k),Ua(P,ja(we,ct,t,r,s,i,a,o,t==="comma"&&g&&De(_)?null:l,c,f,u,h,m,d,g,p,It))}return P}function Tc(n=ne){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||ne.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Xr;if(typeof n.format<"u"){if(!Cc.call(Kr,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=Kr[t];let s=ne.filter;(typeof n.filter=="function"||De(n.filter))&&(s=n.filter);let i;if(n.arrayFormat&&n.arrayFormat in $a?i=n.arrayFormat:"indices"in n?i=n.indices?"indices":"repeat":i=ne.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:ne.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:ne.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:ne.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:ne.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?ne.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:ne.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:ne.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:ne.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:ne.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:ne.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:ne.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:ne.strictNullHandling}}function Mc(n,e={}){let t=n;const r=Tc(e);let s,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):De(r.filter)&&(i=r.filter,s=i);const a=[];if(typeof t!="object"||t===null)return"";const o=$a[r.arrayFormat],l=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);const c=new WeakMap;for(let h=0;h<s.length;++h){const m=s[h];r.skipNulls&&t[m]===null||Ua(a,ja(t[m],m,o,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}const f=a.join(r.delimiter);let u=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),f.length>0?u+f:""}const pt="4.78.1";let _i=!1,Kt,qa,Ha,Gr,za,Wa,Va,Ja,Xa;function Ic(n,e={auto:!1}){if(_i)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(Kt)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${Kt}'\``);_i=e.auto,Kt=n.kind,qa=n.fetch,Ha=n.FormData,Gr=n.File,za=n.ReadableStream,Wa=n.getMultipartRequestOptions,Va=n.getDefaultAgent,Ja=n.fileFromPath,Xa=n.isFsReadStream}let Nc=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Fc({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new Nc(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}Kt||Ic(Fc(),{auto:!0});class $ extends Error{}let ye=class Qr extends ${constructor(e,t,r,s){super(`${Qr.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new er({message:r,cause:es(t)});const i=t==null?void 0:t.error;return e===400?new Ka(e,i,r,s):e===401?new Ga(e,i,r,s):e===403?new Qa(e,i,r,s):e===404?new Ya(e,i,r,s):e===409?new Za(e,i,r,s):e===422?new eo(e,i,r,s):e===429?new to(e,i,r,s):e>=500?new no(e,i,r,s):new Qr(e,i,r,s)}},Te=class extends ye{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},er=class extends ye{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},ks=class extends er{constructor({message:e}={}){super({message:e??"Request timed out."})}},Ka=class extends ye{},Ga=class extends ye{},Qa=class extends ye{},Ya=class extends ye{},Za=class extends ye{},eo=class extends ye{},to=class extends ye{},no=class extends ye{};class ro extends ${constructor(){super("Could not parse response content as the length limit was reached")}}class so extends ${constructor(){super("Could not parse response content as the request was rejected by the content filter")}}let tr=class Yr{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=Yr.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(Yr.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new $(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new $(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new $("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};tr.NEWLINE_CHARS=new Set([`
`,"\r"]);tr.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let Zt=class jt{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of Bc(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null){let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(o&&o.error)throw new ye(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(a.event=="error")throw new ye(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new jt(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new tr,o=io(e);for await(const l of o)for(const c of a.decode(l))yield c;for(const l of a.flush())yield l}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new jt(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new jt(()=>s(e),this.controller),new jt(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new za({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}};async function*Bc(n,e){if(!n.body)throw e.abort(),new $("Attempted to iterate over a response with no body");const t=new $c,r=new tr,s=io(n.body);for await(const i of Lc(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*Lc(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=Dc(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function Dc(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}let $c=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=Uc(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function Uc(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function io(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const ao=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",oo=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&nr(n),nr=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",jc=n=>oo(n)||ao(n)||Xa(n);async function lo(n,e,t){var s;if(n=await n,oo(n))return n;if(ao(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=nr(i)?[await i.arrayBuffer()]:[i];return new Gr(a,e,t)}const r=await qc(n);if(e||(e=zc(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new Gr(r,e,t)}async function qc(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(nr(n))e.push(await n.arrayBuffer());else if(Wc(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${Hc(n)}`);return e}function Hc(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function zc(n){var e;return Pr(n.name)||Pr(n.filename)||((e=Pr(n.path))==null?void 0:e.split(/[\\/]/).pop())}const Pr=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Wc=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",yi=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",Ct=async n=>{const e=await Vc(n.body);return Wa(e,n)},Vc=async n=>{const e=new Ha;return await Promise.all(Object.entries(n||{}).map(([t,r])=>Zr(e,t,r))),e},Zr=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(jc(t)){const r=await lo(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>Zr(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>Zr(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Jc=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Xc=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},pn;async function co(n){const{response:e}=n;if(n.options.stream)return At("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Zt.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return At("response",e.status,e.url,e.headers,i),uo(i,e)}const s=await e.text();return At("response",e.status,e.url,e.headers,s),s}function uo(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}let fo=class ho extends Promise{constructor(e,t=co){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new ho(this.responsePromise,async t=>uo(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Kc=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Rr("maxRetries",t),this.timeout=Rr("timeout",r),this.httpAgent=s,this.fetch=i??qa}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...tu(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${iu()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&nr(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var g;const{method:r,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:yi(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),c=this.buildURL(s,i);"timeout"in e&&Rr("timeout",e.timeout);const f=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??Va(c),h=f+1e3;typeof((g=u==null?void 0:u.options)==null?void 0:g.timeout)=="number"&&h>(u.options.timeout??0)&&(u.options.timeout=h),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const m=this.buildHeaders({options:e,headers:a,contentLength:l,retryCount:t});return{req:{method:r,...o&&{body:o},headers:m,...u&&{agent:u},signal:e.signal??null},url:c,timeout:f}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const a=this.defaultHeaders(e);return Ei(i,a),Ei(i,t),yi(e.body)&&Kt!=="node"&&delete i["content-type"],Ai(a,"x-stainless-retry-count")===void 0&&Ai(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return ye.generate(e,t,r,s)}request(e,t=null){return new fo(this.makeRequest(e,t))}async makeRequest(e,t){var u,h;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),At("request",a,r,i.headers),(u=r.signal)!=null&&u.aborted)throw new Te;const l=new AbortController,c=await this.fetchWithTimeout(a,i,o,l).catch(es);if(c instanceof Error){if((h=r.signal)!=null&&h.aborted)throw new Te;if(t)return this.retryRequest(r,t);throw c.name==="AbortError"?new ks:new er({cause:c})}const f=Qc(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const _=`retrying, ${t} attempts remaining`;return At(`response (error; ${_})`,c.status,a,f),this.retryRequest(r,t,f)}const m=await c.text().catch(_=>es(_).message),d=nu(m),g=d?void 0:m;throw At(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,f,g),this.makeStatusError(c.status,d,g,f)}return{response:c,options:r,controller:l}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new Gc(this,r,e)}buildURL(e,t){const r=su(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return po(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new $(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r),l={signal:s.signal,...a};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await sn(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${pt}`}},mo=class{constructor(e,t,r,s){pn.set(this,void 0),Jc(this,pn,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new $("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await Xc(this,pn,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(pn=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},Gc=class extends fo{constructor(e,t,r){super(t,async s=>new r(e,s.response,await co(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}};const Qc=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),Yc={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},be=n=>typeof n=="object"&&n!==null&&!po(n)&&Object.keys(n).every(e=>go(Yc,e)),Zc=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pt,"X-Stainless-OS":wi(Deno.build.os),"X-Stainless-Arch":bi(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pt,"X-Stainless-OS":wi(process.platform),"X-Stainless-Arch":bi(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=eu();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function eu(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const bi=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",wi=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Si;const tu=()=>Si??(Si=Zc()),nu=n=>{try{return JSON.parse(n)}catch{return}},ru=/^[a-z][a-z0-9+.-]*:/i,su=n=>ru.test(n),sn=n=>new Promise(e=>setTimeout(e,n)),Rr=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new $(`${n} must be an integer`);if(e<0)throw new $(`${n} must be a positive integer`);return e},es=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)},gn=n=>{var e,t,r,s,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,n))==null?void 0:i.trim()};function po(n){if(!n)return!0;for(const e in n)return!1;return!0}function go(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ei(n,e){for(const t in e){if(!go(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function At(n,...e){var t;typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const iu=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),au=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",ou=n=>typeof(n==null?void 0:n.get)=="function",Ai=(n,e)=>{var r;const t=e.toLowerCase();if(ou(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=n.get(i);if(a)return a}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};function Cr(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}let lu=class extends mo{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}};class Ne extends mo{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}}let z=class{constructor(e){this._client=e}},_o=class extends z{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},Ps=class extends z{constructor(){super(...arguments),this.completions=new _o(this._client)}};Ps.Completions=_o;class yo extends z{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class bo extends z{create(e,t){return this._client.post("/audio/transcriptions",Ct({body:e,...t}))}}class wo extends z{create(e,t){return this._client.post("/audio/translations",Ct({body:e,...t}))}}class an extends z{constructor(){super(...arguments),this.transcriptions=new bo(this._client),this.translations=new wo(this._client),this.speech=new yo(this._client)}}an.Transcriptions=bo;an.Translations=wo;an.Speech=yo;let Rs=class extends z{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return be(e)?this.list({},e):this._client.getAPIList("/batches",Cs,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}};class Cs extends Ne{}Rs.BatchesPage=Cs;class xs extends z{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return be(e)?this.list({},e):this._client.getAPIList("/assistants",vs,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class vs extends Ne{}xs.AssistantsPage=vs;function ki(n){return typeof n.parse=="function"}const kt=n=>(n==null?void 0:n.role)==="assistant",So=n=>(n==null?void 0:n.role)==="function",Eo=n=>(n==null?void 0:n.role)==="tool";var ve=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},X=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ts,Cn,xn,qt,Ht,vn,zt,qe,Wt,jn,qn,gt,Ao;class ko{constructor(){ts.add(this),this.controller=new AbortController,Cn.set(this,void 0),xn.set(this,()=>{}),qt.set(this,()=>{}),Ht.set(this,void 0),vn.set(this,()=>{}),zt.set(this,()=>{}),qe.set(this,{}),Wt.set(this,!1),jn.set(this,!1),qn.set(this,!1),gt.set(this,!1),ve(this,Cn,new Promise((e,t)=>{ve(this,xn,e,"f"),ve(this,qt,t,"f")}),"f"),ve(this,Ht,new Promise((e,t)=>{ve(this,vn,e,"f"),ve(this,zt,t,"f")}),"f"),X(this,Cn,"f").catch(()=>{}),X(this,Ht,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},X(this,ts,"m",Ao).bind(this))},0)}_connected(){this.ended||(X(this,xn,"f").call(this),this._emit("connect"))}get ended(){return X(this,Wt,"f")}get errored(){return X(this,jn,"f")}get aborted(){return X(this,qn,"f")}abort(){this.controller.abort()}on(e,t){return(X(this,qe,"f")[e]||(X(this,qe,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=X(this,qe,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(X(this,qe,"f")[e]||(X(this,qe,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{ve(this,gt,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){ve(this,gt,!0,"f"),await X(this,Ht,"f")}_emit(e,...t){if(X(this,Wt,"f"))return;e==="end"&&(ve(this,Wt,!0,"f"),X(this,vn,"f").call(this));const r=X(this,qe,"f")[e];if(r&&(X(this,qe,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!X(this,gt,"f")&&!(r!=null&&r.length)&&Promise.reject(s),X(this,qt,"f").call(this,s),X(this,zt,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!X(this,gt,"f")&&!(r!=null&&r.length)&&Promise.reject(s),X(this,qt,"f").call(this,s),X(this,zt,"f").call(this,s),this._emit("end")}}_emitFinal(){}}Cn=new WeakMap,xn=new WeakMap,qt=new WeakMap,Ht=new WeakMap,vn=new WeakMap,zt=new WeakMap,qe=new WeakMap,Wt=new WeakMap,jn=new WeakMap,qn=new WeakMap,gt=new WeakMap,ts=new WeakSet,Ao=function(e){if(ve(this,jn,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Te),e instanceof Te)return ve(this,qn,!0,"f"),this._emit("abort",e);if(e instanceof $)return this._emit("error",e);if(e instanceof Error){const t=new $(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new $(String(e)))};function Po(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function on(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function cu(n,e){return!e||!Ro(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:Os(n,e)}function Os(n,e){const t=n.choices.map(r=>{var s;if(r.finish_reason==="length")throw new ro;if(r.finish_reason==="content_filter")throw new so;return{...r,message:{...r.message,tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(i=>fu(e,i)))??[],parsed:r.message.content&&!r.message.refusal?uu(e,r.message.content):null}}});return{...n,choices:t}}function uu(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function fu(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:on(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function du(n,e){var r;if(!n)return!1;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return on(t)||(t==null?void 0:t.function.strict)||!1}function Ro(n){var e;return Po(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>on(t)||t.type==="function"&&t.function.strict===!0))??!1}function hu(n){for(const e of n??[]){if(e.type!=="function")throw new $(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new $(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var pe=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},oe,ns,Hn,rs,ss,is,Co,as;const Pi=10;class xo extends ko{constructor(){super(...arguments),oe.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(So(e)||Eo(e))&&e.content)this._emit("functionCallResult",e.content);else if(kt(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(kt(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new $("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),pe(this,oe,"m",ns).call(this)}async finalMessage(){return await this.done(),pe(this,oe,"m",Hn).call(this)}async finalFunctionCall(){return await this.done(),pe(this,oe,"m",rs).call(this)}async finalFunctionCallResult(){return await this.done(),pe(this,oe,"m",ss).call(this)}async totalUsage(){return await this.done(),pe(this,oe,"m",is).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=pe(this,oe,"m",Hn).call(this);t&&this._emit("finalMessage",t);const r=pe(this,oe,"m",ns).call(this);r&&this._emit("finalContent",r);const s=pe(this,oe,"m",rs).call(this);s&&this._emit("finalFunctionCall",s);const i=pe(this,oe,"m",ss).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",pe(this,oe,"m",is).call(this))}async _createChatCompletion(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),pe(this,oe,"m",Co).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Os(i,t))}async _runChatCompletion(e,t,r){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var h;const s="function",{function_call:i="auto",stream:a,...o}=t,l=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:c=Pi}=r||{},f={};for(const m of t.functions)f[m.name||m.function.name]=m;const u=t.functions.map(m=>({name:m.name||m.function.name,parameters:m.parameters,description:m.description}));for(const m of t.messages)this._addMessage(m,!1);for(let m=0;m<c;++m){const g=(h=(await this._createChatCompletion(e,{...o,function_call:i,functions:u,messages:[...this.messages]},r)).choices[0])==null?void 0:h.message;if(!g)throw new $("missing message in ChatCompletion response");if(!g.function_call)return;const{name:p,arguments:k}=g.function_call,_=f[p];if(_){if(l&&l!==p){const P=`Invalid function_call: ${JSON.stringify(p)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:p,content:P});continue}}else{const P=`Invalid function_call: ${JSON.stringify(p)}. Available options are: ${u.map(C=>JSON.stringify(C.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:p,content:P});continue}let w;try{w=ki(_)?await _.parse(k):k}catch(P){this._addMessage({role:s,name:p,content:P instanceof Error?P.message:String(P)});continue}const y=await _.function(w,this),S=pe(this,oe,"m",as).call(this,y);if(this._addMessage({role:s,name:p,content:S}),l)return}}async _runTools(e,t,r){var m,d,g;const s="tool",{tool_choice:i="auto",stream:a,...o}=t,l=typeof i!="string"&&((m=i==null?void 0:i.function)==null?void 0:m.name),{maxChatCompletions:c=Pi}=r||{},f=t.tools.map(p=>{if(on(p)){if(!p.$callback)throw new $("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:p.$callback,name:p.function.name,description:p.function.description||"",parameters:p.function.parameters,parse:p.$parseRaw,strict:!0}}}return p}),u={};for(const p of f)p.type==="function"&&(u[p.function.name||p.function.function.name]=p.function);const h="tools"in t?f.map(p=>p.type==="function"?{type:"function",function:{name:p.function.name||p.function.function.name,parameters:p.function.parameters,description:p.function.description,strict:p.function.strict}}:p):void 0;for(const p of t.messages)this._addMessage(p,!1);for(let p=0;p<c;++p){const _=(d=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:h,messages:[...this.messages]},r)).choices[0])==null?void 0:d.message;if(!_)throw new $("missing message in ChatCompletion response");if(!((g=_.tool_calls)!=null&&g.length))return;for(const w of _.tool_calls){if(w.type!=="function")continue;const y=w.id,{name:S,arguments:P}=w.function,C=u[S];if(C){if(l&&l!==S){const v=`Invalid tool_call: ${JSON.stringify(S)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:y,content:v});continue}}else{const v=`Invalid tool_call: ${JSON.stringify(S)}. Available options are: ${Object.keys(u).map(we=>JSON.stringify(we)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:y,content:v});continue}let T;try{T=ki(C)?await C.parse(P):P}catch(v){const we=v instanceof Error?v.message:String(v);this._addMessage({role:s,tool_call_id:y,content:we});continue}const I=await C.function(T,this),N=pe(this,oe,"m",as).call(this,I);if(this._addMessage({role:s,tool_call_id:y,content:N}),l)return}}}}oe=new WeakSet,ns=function(){return pe(this,oe,"m",Hn).call(this).content??null},Hn=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(kt(t)){const{function_call:r,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return r&&(i.function_call=r),i}}throw new $("stream ended without producing a ChatCompletionMessage with role=assistant")},rs=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(kt(s)&&(s!=null&&s.function_call))return s.function_call;if(kt(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},ss=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(So(t)&&t.content!=null||Eo(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},is=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Co=function(e){if(e.n!=null&&e.n>1)throw new $("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},as=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class en extends xo{static runFunctions(e,t,r){const s=new en,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new en,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),kt(e)&&e.content&&this._emit("content",e.content)}}const vo=1,Oo=2,To=4,Mo=8,Io=16,No=32,Fo=64,Bo=128,Lo=256,Do=Bo|Lo,$o=Io|No|Do|Fo,Uo=vo|Oo|$o,jo=To|Mo,mu=Uo|jo,re={STR:vo,NUM:Oo,ARR:To,OBJ:Mo,NULL:Io,BOOL:No,NAN:Fo,INFINITY:Bo,MINUS_INFINITY:Lo,INF:Do,SPECIAL:$o,ATOM:Uo,COLLECTION:jo,ALL:mu};class pu extends Error{}class gu extends Error{}function _u(n,e=re.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return yu(n.trim(),e)}const yu=(n,e)=>{const t=n.length;let r=0;const s=h=>{throw new pu(`${h} at position ${r}`)},i=h=>{throw new gu(`${h} at position ${r}`)},a=()=>(u(),r>=t&&s("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?l():n[r]==="["?c():n.substring(r,r+4)==="null"||re.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||re.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||re.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||re.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||re.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||re.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):f()),o=()=>{const h=r;let m=!1;for(r++;r<t&&(n[r]!=='"'||m&&n[r-1]==="\\");)m=n[r]==="\\"?!m:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(h,++r-Number(m)))}catch(d){i(String(d))}else if(re.STR&e)try{return JSON.parse(n.substring(h,r-Number(m))+'"')}catch{return JSON.parse(n.substring(h,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{r++,u();const h={};try{for(;n[r]!=="}";){if(u(),r>=t&&re.OBJ&e)return h;const m=o();u(),r++;try{const d=a();Object.defineProperty(h,m,{value:d,writable:!0,enumerable:!0,configurable:!0})}catch(d){if(re.OBJ&e)return h;throw d}u(),n[r]===","&&r++}}catch{if(re.OBJ&e)return h;s("Expected '}' at end of object")}return r++,h},c=()=>{r++;const h=[];try{for(;n[r]!=="]";)h.push(a()),u(),n[r]===","&&r++}catch{if(re.ARR&e)return h;s("Expected ']' at end of array")}return r++,h},f=()=>{if(r===0){n==="-"&&re.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(m){if(re.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}i(String(m))}}const h=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(re.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(h,r))}catch{n.substring(h,r)==="-"&&re.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(h,n.lastIndexOf("e")))}catch(d){i(String(d))}}},u=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return a()},Ri=n=>_u(n,re.ALL^re.NUM);var ft=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},W=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},te,Ue,dt,We,xr,_n,vr,Or,Tr,yn,Mr,Ci;class tn extends xo{constructor(e){super(),te.add(this),Ue.set(this,void 0),dt.set(this,void 0),We.set(this,void 0),ft(this,Ue,e,"f"),ft(this,dt,[],"f")}get currentChatCompletionSnapshot(){return W(this,We,"f")}static fromReadableStream(e){const t=new tn(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const s=new tn(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var a;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),W(this,te,"m",xr).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)W(this,te,"m",vr).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new Te;return this._addChatCompletion(W(this,te,"m",yn).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),W(this,te,"m",xr).call(this),this._connected();const s=Zt.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(W(this,te,"m",yn).call(this)),W(this,te,"m",vr).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new Te;return this._addChatCompletion(W(this,te,"m",yn).call(this))}[(Ue=new WeakMap,dt=new WeakMap,We=new WeakMap,te=new WeakSet,xr=function(){this.ended||ft(this,We,void 0,"f")},_n=function(t){let r=W(this,dt,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},W(this,dt,"f")[t.index]=r,r)},vr=function(t){var s,i,a,o,l,c,f,u,h,m,d,g,p,k,_;if(this.ended)return;const r=W(this,te,"m",Ci).call(this,t);this._emit("chunk",t,r);for(const w of t.choices){const y=r.choices[w.index];w.delta.content!=null&&((s=y.message)==null?void 0:s.role)==="assistant"&&((i=y.message)!=null&&i.content)&&(this._emit("content",w.delta.content,y.message.content),this._emit("content.delta",{delta:w.delta.content,snapshot:y.message.content,parsed:y.message.parsed})),w.delta.refusal!=null&&((a=y.message)==null?void 0:a.role)==="assistant"&&((o=y.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:w.delta.refusal,snapshot:y.message.refusal}),((l=w.logprobs)==null?void 0:l.content)!=null&&((c=y.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(f=w.logprobs)==null?void 0:f.content,snapshot:((u=y.logprobs)==null?void 0:u.content)??[]}),((h=w.logprobs)==null?void 0:h.refusal)!=null&&((m=y.message)==null?void 0:m.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(d=w.logprobs)==null?void 0:d.refusal,snapshot:((g=y.logprobs)==null?void 0:g.refusal)??[]});const S=W(this,te,"m",_n).call(this,y);y.finish_reason&&(W(this,te,"m",Tr).call(this,y),S.current_tool_call_index!=null&&W(this,te,"m",Or).call(this,y,S.current_tool_call_index));for(const P of w.delta.tool_calls??[])S.current_tool_call_index!==P.index&&(W(this,te,"m",Tr).call(this,y),S.current_tool_call_index!=null&&W(this,te,"m",Or).call(this,y,S.current_tool_call_index)),S.current_tool_call_index=P.index;for(const P of w.delta.tool_calls??[]){const C=(p=y.message.tool_calls)==null?void 0:p[P.index];C!=null&&C.type&&((C==null?void 0:C.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(k=C.function)==null?void 0:k.name,index:P.index,arguments:C.function.arguments,parsed_arguments:C.function.parsed_arguments,arguments_delta:((_=P.function)==null?void 0:_.arguments)??""}):(C==null||C.type,void 0))}}},Or=function(t,r){var a,o,l;if(W(this,te,"m",_n).call(this,t).done_tool_calls.has(r))return;const i=(a=t.message.tool_calls)==null?void 0:a[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const c=(l=(o=W(this,Ue,"f"))==null?void 0:o.tools)==null?void 0:l.find(f=>f.type==="function"&&f.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:on(c)?c.$parseRaw(i.function.arguments):c!=null&&c.function.strict?JSON.parse(i.function.arguments):null})}else i.type},Tr=function(t){var s,i;const r=W(this,te,"m",_n).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const a=W(this,te,"m",Mr).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},yn=function(){if(this.ended)throw new $("stream has ended, this shouldn't happen");const t=W(this,We,"f");if(!t)throw new $("request ended without sending any chunks");return ft(this,We,void 0,"f"),ft(this,dt,[],"f"),bu(t,W(this,Ue,"f"))},Mr=function(){var r;const t=(r=W(this,Ue,"f"))==null?void 0:r.response_format;return Po(t)?t:null},Ci=function(t){var r,s,i,a;let o=W(this,We,"f");const{choices:l,...c}=t;o?Object.assign(o,c):o=ft(this,We,{...c,choices:[]},"f");for(const{delta:f,finish_reason:u,index:h,logprobs:m=null,...d}of t.choices){let g=o.choices[h];if(g||(g=o.choices[h]={finish_reason:u,index:h,message:{},logprobs:m,...d}),m)if(!g.logprobs)g.logprobs=Object.assign({},m);else{const{content:P,refusal:C,...T}=m;Object.assign(g.logprobs,T),P&&((r=g.logprobs).content??(r.content=[]),g.logprobs.content.push(...P)),C&&((s=g.logprobs).refusal??(s.refusal=[]),g.logprobs.refusal.push(...C))}if(u&&(g.finish_reason=u,W(this,Ue,"f")&&Ro(W(this,Ue,"f")))){if(u==="length")throw new ro;if(u==="content_filter")throw new so}if(Object.assign(g,d),!f)continue;const{content:p,refusal:k,function_call:_,role:w,tool_calls:y,...S}=f;if(Object.assign(g.message,S),k&&(g.message.refusal=(g.message.refusal||"")+k),w&&(g.message.role=w),_&&(g.message.function_call?(_.name&&(g.message.function_call.name=_.name),_.arguments&&((i=g.message.function_call).arguments??(i.arguments=""),g.message.function_call.arguments+=_.arguments)):g.message.function_call=_),p&&(g.message.content=(g.message.content||"")+p,!g.message.refusal&&W(this,te,"m",Mr).call(this)&&(g.message.parsed=Ri(g.message.content))),y){g.message.tool_calls||(g.message.tool_calls=[]);for(const{index:P,id:C,type:T,function:I,...N}of y){const v=(a=g.message.tool_calls)[P]??(a[P]={});Object.assign(v,N),C&&(v.id=C),T&&(v.type=T),I&&(v.function??(v.function={name:I.name??"",arguments:""})),I!=null&&I.name&&(v.function.name=I.name),I!=null&&I.arguments&&(v.function.arguments+=I.arguments,du(W(this,Ue,"f"),v)&&(v.function.parsed_arguments=Ri(v.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Zt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function bu(n,e){const{id:t,choices:r,created:s,model:i,system_fingerprint:a,...o}=n,l={...o,id:t,choices:r.map(({message:c,finish_reason:f,index:u,logprobs:h,...m})=>{if(!f)throw new $(`missing finish_reason for choice ${u}`);const{content:d=null,function_call:g,tool_calls:p,...k}=c,_=c.role;if(!_)throw new $(`missing role for choice ${u}`);if(g){const{arguments:w,name:y}=g;if(w==null)throw new $(`missing function_call.arguments for choice ${u}`);if(!y)throw new $(`missing function_call.name for choice ${u}`);return{...m,message:{content:d,function_call:{arguments:w,name:y},role:_,refusal:c.refusal??null},finish_reason:f,index:u,logprobs:h}}return p?{...m,index:u,finish_reason:f,logprobs:h,message:{...k,role:_,content:d,refusal:c.refusal??null,tool_calls:p.map((w,y)=>{const{function:S,type:P,id:C,...T}=w,{arguments:I,name:N,...v}=S||{};if(C==null)throw new $(`missing choices[${u}].tool_calls[${y}].id
${bn(n)}`);if(P==null)throw new $(`missing choices[${u}].tool_calls[${y}].type
${bn(n)}`);if(N==null)throw new $(`missing choices[${u}].tool_calls[${y}].function.name
${bn(n)}`);if(I==null)throw new $(`missing choices[${u}].tool_calls[${y}].function.arguments
${bn(n)}`);return{...T,id:C,type:P,function:{...v,name:N,arguments:I}}})}}:{...m,message:{...k,content:d,role:_,refusal:c.refusal??null},finish_reason:f,index:u,logprobs:h}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return cu(l,e)}function bn(n){return JSON.stringify(n)}class Pt extends tn{static fromReadableStream(e){const t=new Pt(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const s=new Pt(null),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new Pt(t),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}let qo=class extends z{parse(e,t){return hu(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>Os(r,e))}runFunctions(e,t){return e.stream?Pt.runFunctions(this._client,e,t):en.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Pt.runTools(this._client,e,t):en.runTools(this._client,e,t)}stream(e,t){return tn.createChatCompletion(this._client,e,t)}},Ho=class extends z{constructor(){super(...arguments),this.completions=new qo(this._client)}};(function(n){n.Completions=qo})(Ho);class zo extends z{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Ts extends z{constructor(){super(...arguments),this.sessions=new zo(this._client)}}Ts.Sessions=zo;var M=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ee=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},se,os,$e,On,Oe,et,bt,Ye,zn,Ae,Tn,Mn,Gt,Vt,Jt,xi,vi,Oi,Ti,Mi,Ii,Ni;class Me extends ko{constructor(){super(...arguments),se.add(this),os.set(this,[]),$e.set(this,{}),On.set(this,{}),Oe.set(this,void 0),et.set(this,void 0),bt.set(this,void 0),Ye.set(this,void 0),zn.set(this,void 0),Ae.set(this,void 0),Tn.set(this,void 0),Mn.set(this,void 0),Gt.set(this,void 0)}[(os=new WeakMap,$e=new WeakMap,On=new WeakMap,Oe=new WeakMap,et=new WeakMap,bt=new WeakMap,Ye=new WeakMap,zn=new WeakMap,Ae=new WeakMap,Tn=new WeakMap,Mn=new WeakMap,Gt=new WeakMap,se=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Me;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=Zt.fromReadableStream(e,this.controller);for await(const a of s)M(this,se,"m",Vt).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new Te;return this._addRun(M(this,se,"m",Jt).call(this))}toReadableStream(){return new Zt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,i){const a=new Me;return a._run(()=>a._runToolAssistantStream(e,t,r,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,r,s,i){var c;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},l=await e.submitToolOutputs(t,r,o,{...i,signal:this.controller.signal});this._connected();for await(const f of l)M(this,se,"m",Vt).call(this,f);if((c=l.controller.signal)!=null&&c.aborted)throw new Te;return this._addRun(M(this,se,"m",Jt).call(this))}static createThreadAssistantStream(e,t,r){const s=new Me;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){const i=new Me;return i._run(()=>i._runAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return M(this,Tn,"f")}currentRun(){return M(this,Mn,"f")}currentMessageSnapshot(){return M(this,Oe,"f")}currentRunStepSnapshot(){return M(this,Gt,"f")}async finalRunSteps(){return await this.done(),Object.values(M(this,$e,"f"))}async finalMessages(){return await this.done(),Object.values(M(this,On,"f"))}async finalRun(){if(await this.done(),!M(this,et,"f"))throw Error("Final run was not received.");return M(this,et,"f")}async _createThreadAssistantStream(e,t,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const l of a)M(this,se,"m",Vt).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new Te;return this._addRun(M(this,se,"m",Jt).call(this))}async _createAssistantStream(e,t,r,s){var l;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const c of o)M(this,se,"m",Vt).call(this,c);if((l=o.controller.signal)!=null&&l.aborted)throw new Te;return this._addRun(M(this,se,"m",Jt).call(this))}static accumulateDelta(e,t){for(const[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(Cr(i)&&Cr(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(const a of s){if(!Cr(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=i[o];l==null?i.push(a):i[o]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,i){return await this._createToolAssistantStream(r,e,t,s,i)}}Vt=function(e){if(!this.ended)switch(Ee(this,Tn,e,"f"),M(this,se,"m",Oi).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":M(this,se,"m",Ni).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":M(this,se,"m",vi).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":M(this,se,"m",xi).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Jt=function(){if(this.ended)throw new $("stream has ended, this shouldn't happen");if(!M(this,et,"f"))throw Error("Final run has not been received");return M(this,et,"f")},xi=function(e){const[t,r]=M(this,se,"m",Mi).call(this,e,M(this,Oe,"f"));Ee(this,Oe,t,"f"),M(this,On,"f")[t.id]=t;for(const s of r){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=M(this,bt,"f")){if(M(this,Ye,"f"))switch(M(this,Ye,"f").type){case"text":this._emit("textDone",M(this,Ye,"f").text,M(this,Oe,"f"));break;case"image_file":this._emit("imageFileDone",M(this,Ye,"f").image_file,M(this,Oe,"f"));break}Ee(this,bt,s.index,"f")}Ee(this,Ye,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(M(this,bt,"f")!==void 0){const s=e.data.content[M(this,bt,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,M(this,Oe,"f"));break;case"text":this._emit("textDone",s.text,M(this,Oe,"f"));break}}M(this,Oe,"f")&&this._emit("messageDone",e.data),Ee(this,Oe,void 0,"f")}},vi=function(e){const t=M(this,se,"m",Ti).call(this,e);switch(Ee(this,Gt,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==M(this,zn,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(M(this,Ae,"f")&&this._emit("toolCallDone",M(this,Ae,"f")),Ee(this,zn,i.index,"f"),Ee(this,Ae,t.step_details.tool_calls[i.index],"f"),M(this,Ae,"f")&&this._emit("toolCallCreated",M(this,Ae,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Ee(this,Gt,void 0,"f"),e.data.step_details.type=="tool_calls"&&M(this,Ae,"f")&&(this._emit("toolCallDone",M(this,Ae,"f")),Ee(this,Ae,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Oi=function(e){M(this,os,"f").push(e),this._emit("event",e)},Ti=function(e){switch(e.event){case"thread.run.step.created":return M(this,$e,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=M(this,$e,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=Me.accumulateDelta(t,r.delta);M(this,$e,"f")[e.data.id]=s}return M(this,$e,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":M(this,$e,"f")[e.data.id]=e.data;break}if(M(this,$e,"f")[e.data.id])return M(this,$e,"f")[e.data.id];throw new Error("No snapshot available")},Mi=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=M(this,se,"m",Ii).call(this,i,a)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Ii=function(e,t){return Me.accumulateDelta(t,e)},Ni=function(e){switch(Ee(this,Mn,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Ee(this,et,e.data,"f"),M(this,Ae,"f")&&(this._emit("toolCallDone",M(this,Ae,"f")),Ee(this,Ae,void 0,"f"));break}};let Ms=class extends z{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return be(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Is,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}};class Is extends Ne{}Ms.MessagesPage=Is;class Ns extends z{retrieve(e,t,r,s={},i){return be(s)?this.retrieve(e,t,r,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,r={},s){return be(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Fs,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Fs extends Ne{}Ns.RunStepsPage=Fs;class ln extends z{constructor(){super(...arguments),this.steps=new Ns(this._client)}create(e,t,r){const{include:s,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return be(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Bs,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return Me.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await sn(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return Me.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,s){const i=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,r,s){return Me.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}}class Bs extends Ne{}ln.RunsPage=Bs;ln.Steps=Ns;ln.RunStepsPage=Fs;class xt extends z{constructor(){super(...arguments),this.runs=new ln(this._client),this.messages=new Ms(this._client)}create(e={},t){return be(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return Me.createThreadAssistantStream(e,this._client.beta.threads,t)}}xt.Runs=ln;xt.RunsPage=Bs;xt.Messages=Ms;xt.MessagesPage=Is;const wu=async n=>{const e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};let Ls=class extends z{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},r){return be(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,rr,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...r,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=i.response.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await sn(o);break;case"failed":case"completed":return a}}}async upload(e,t,r){const s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){const s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}};class rr extends Ne{}Ls.VectorStoreFilesPage=rr;class Wo extends z{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r={},s){return be(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,rr,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(o=c)}}await sn(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,t.length),o=this._client,l=t.values(),c=[...r];async function f(h){for(let m of h){const d=await o.files.create({file:m,purpose:"assistants"},s);c.push(d.id)}}const u=Array(a).fill(l).map(f);return await wu(u),await this.createAndPoll(e,{file_ids:c})}}class vt extends z{constructor(){super(...arguments),this.files=new Ls(this._client),this.fileBatches=new Wo(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return be(e)?this.list({},e):this._client.getAPIList("/vector_stores",Ds,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Ds extends Ne{}vt.VectorStoresPage=Ds;vt.Files=Ls;vt.VectorStoreFilesPage=rr;vt.FileBatches=Wo;let Ke=class extends z{constructor(){super(...arguments),this.realtime=new Ts(this._client),this.vectorStores=new vt(this._client),this.chat=new Ho(this._client),this.assistants=new xs(this._client),this.threads=new xt(this._client)}};Ke.Realtime=Ts;Ke.VectorStores=vt;Ke.VectorStoresPage=Ds;Ke.Assistants=xs;Ke.AssistantsPage=vs;Ke.Threads=xt;let Vo=class extends z{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};class Jo extends z{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class $s extends z{create(e,t){return this._client.post("/files",Ct({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return be(e)?this.list({},e):this._client.getAPIList("/files",Us,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await sn(t),a=await this.retrieve(e),Date.now()-i>r)throw new ks({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class Us extends Ne{}$s.FileObjectsPage=Us;class js extends z{list(e,t={},r){return be(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,qs,{query:t,...r})}}class qs extends Ne{}js.FineTuningJobCheckpointsPage=qs;class Ot extends z{constructor(){super(...arguments),this.checkpoints=new js(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return be(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Hs,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return be(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,zs,{query:t,...r})}}class Hs extends Ne{}class zs extends Ne{}Ot.FineTuningJobsPage=Hs;Ot.FineTuningJobEventsPage=zs;Ot.Checkpoints=js;Ot.FineTuningJobCheckpointsPage=qs;class cn extends z{constructor(){super(...arguments),this.jobs=new Ot(this._client)}}cn.Jobs=Ot;cn.FineTuningJobsPage=Hs;cn.FineTuningJobEventsPage=zs;class Xo extends z{createVariation(e,t){return this._client.post("/images/variations",Ct({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Ct({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}let Ws=class extends z{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Vs,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}};class Vs extends lu{}Ws.ModelsPage=Vs;class Ko extends z{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class Go extends z{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,Ct({body:t,...r}))}}class Js extends z{constructor(){super(...arguments),this.parts=new Go(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}}Js.Parts=Go;var Qo;class j extends Kc{constructor({baseURL:e=gn("OPENAI_BASE_URL"),apiKey:t=gn("OPENAI_API_KEY"),organization:r=gn("OPENAI_ORG_ID")??null,project:s=gn("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new $("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:r,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&au())throw new $(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new Vo(this),this.chat=new Ps(this),this.embeddings=new Jo(this),this.files=new $s(this),this.images=new Xo(this),this.audio=new an(this),this.moderations=new Ko(this),this.models=new Ws(this),this.fineTuning=new cn(this),this.beta=new Ke(this),this.batches=new Rs(this),this.uploads=new Js(this),this._options=a,this.apiKey=t,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Mc(e,{arrayFormat:"brackets"})}}Qo=j;j.OpenAI=Qo;j.DEFAULT_TIMEOUT=6e5;j.OpenAIError=$;j.APIError=ye;j.APIConnectionError=er;j.APIConnectionTimeoutError=ks;j.APIUserAbortError=Te;j.NotFoundError=Ya;j.ConflictError=Za;j.RateLimitError=to;j.BadRequestError=Ka;j.AuthenticationError=Ga;j.InternalServerError=no;j.PermissionDeniedError=Qa;j.UnprocessableEntityError=eo;j.toFile=lo;j.fileFromPath=Ja;j.Completions=Vo;j.Chat=Ps;j.Embeddings=Jo;j.Files=$s;j.FileObjectsPage=Us;j.Images=Xo;j.Audio=an;j.Moderations=Ko;j.Models=Ws;j.ModelsPage=Vs;j.FineTuning=cn;j.Beta=Ke;j.Batches=Rs;j.BatchesPage=Cs;j.Uploads=Js;const _t="0.33.1";let Fi=!1,Qt,Yo,ls,Zo,el,tl;function Su(n,e={auto:!1}){if(Fi)throw new Error(`you must \`import '@anthropic-ai/sdk/shims/${n.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(Qt)throw new Error(`can't \`import '@anthropic-ai/sdk/shims/${n.kind}'\` after \`import '@anthropic-ai/sdk/shims/${Qt}'\``);Fi=e.auto,Qt=n.kind,Yo=n.fetch,ls=n.File,Zo=n.ReadableStream,el=n.getDefaultAgent,tl=n.fileFromPath}class Eu{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function Au({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from '@anthropic-ai/sdk'`:\n- `import '@anthropic-ai/sdk/shims/node'` (if you're running on Node)\n- `import '@anthropic-ai/sdk/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new Eu(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:a=>!1}}Qt||Su(Au(),{auto:!0});class J extends Error{}class ue extends J{constructor(e,t,r,s){super(`${ue.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["request-id"],this.error=t}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new sr({message:r,cause:cs(t)});const i=t;return e===400?new rl(e,i,r,s):e===401?new sl(e,i,r,s):e===403?new il(e,i,r,s):e===404?new al(e,i,r,s):e===409?new ol(e,i,r,s):e===422?new ll(e,i,r,s):e===429?new cl(e,i,r,s):e>=500?new ul(e,i,r,s):new ue(e,i,r,s)}}class tt extends ue{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class sr extends ue{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class nl extends sr{constructor({message:e}={}){super({message:e??"Request timed out."})}}class rl extends ue{}class sl extends ue{}class il extends ue{}class al extends ue{}class ol extends ue{}class ll extends ue{}class cl extends ue{}class ul extends ue{}class Xe{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=Xe.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(Xe.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new J(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new J(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new J("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}Xe.NEWLINE_CHARS=new Set([`
`,"\r"]);Xe.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class Je{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of ku(e,t)){if(a.event==="completion")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event==="message_start"||a.event==="message_delta"||a.event==="message_stop"||a.event==="content_block_start"||a.event==="content_block_delta"||a.event==="content_block_stop")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event!=="ping"&&a.event==="error")throw ue.generate(void 0,`SSE Error: ${a.data}`,a.data,hl(e.headers))}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Je(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new Xe,o=Xs(e);for await(const l of o)for(const c of a.decode(l))yield c;for(const l of a.flush())yield l}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Je(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new Je(()=>s(e),this.controller),new Je(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new Zo({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*ku(n,e){if(!n.body)throw e.abort(),new J("Attempted to iterate over a response with no body");const t=new Cu,r=new Xe,s=Xs(n.body);for await(const i of Pu(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*Pu(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=Ru(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function Ru(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}class Cu{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=xu(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function xu(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function Xs(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const vu=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Ou=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&ir(n),ir=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function";async function Tu(n,e,t){var s;if(n=await n,Ou(n))return n;if(vu(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=ir(i)?[await i.arrayBuffer()]:[i];return new ls(a,e,t)}const r=await Mu(n);if(e||(e=Nu(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new ls(r,e,t)}async function Mu(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(ir(n))e.push(await n.arrayBuffer());else if(Fu(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${Iu(n)}`);return e}function Iu(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Nu(n){var e;return Ir(n.name)||Ir(n.filename)||((e=Ir(n.path))==null?void 0:e.split(/[\\/]/).pop())}const Ir=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Fu=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Bi=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var Bu=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Lu=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},wn;async function fl(n){const{response:e}=n;if(n.options.stream)return Rt("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Je.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return Rt("response",e.status,e.url,e.headers,i),dl(i,e)}const s=await e.text();return Rt("response",e.status,e.url,e.headers,s),s}function dl(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}class ar extends Promise{constructor(e,t=fl){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new ar(this.responsePromise,async t=>dl(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Du{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Nr("maxRetries",t),this.timeout=Nr("timeout",r),this.httpAgent=s,this.fetch=i??Yo}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...zu(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Ku()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&ir(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var g;const{method:r,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:Bi(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),c=this.buildURL(s,i);"timeout"in e&&Nr("timeout",e.timeout);const f=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??el(c),h=f+1e3;typeof((g=u==null?void 0:u.options)==null?void 0:g.timeout)=="number"&&h>(u.options.timeout??0)&&(u.options.timeout=h),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const m=this.buildHeaders({options:e,headers:a,contentLength:l,retryCount:t});return{req:{method:r,...o&&{body:o},headers:m,...u&&{agent:u},signal:e.signal??null},url:c,timeout:f}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const a=this.defaultHeaders(e);return Ui(i,a),Ui(i,t),Bi(e.body)&&Qt!=="node"&&delete i["content-type"],ji(a,"x-stainless-retry-count")===void 0&&ji(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return ue.generate(e,t,r,s)}request(e,t=null){return new ar(this.makeRequest(e,t))}async makeRequest(e,t){var u,h;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),Rt("request",a,r,i.headers),(u=r.signal)!=null&&u.aborted)throw new tt;const l=new AbortController,c=await this.fetchWithTimeout(a,i,o,l).catch(cs);if(c instanceof Error){if((h=r.signal)!=null&&h.aborted)throw new tt;if(t)return this.retryRequest(r,t);throw c.name==="AbortError"?new nl:new sr({cause:c})}const f=hl(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const _=`retrying, ${t} attempts remaining`;return Rt(`response (error; ${_})`,c.status,a,f),this.retryRequest(r,t,f)}const m=await c.text().catch(_=>cs(_).message),d=Wu(m),g=d?void 0:m;throw Rt(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,f,g),this.makeStatusError(c.status,d,g,f)}return{response:c,options:r,controller:l}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new Uu(this,r,e)}buildURL(e,t){const r=Ju(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Wn(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new J(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r);return this.fetch.call(void 0,e,{signal:s.signal,...a}).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Xu(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${_t}`}}class $u{constructor(e,t,r,s){wn.set(this,void 0),Bu(this,wn,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new J("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await Lu(this,wn,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(wn=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Uu extends ar{constructor(e,t,r){super(t,async s=>new r(e,s.response,await fl(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const hl=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),ju={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},nt=n=>typeof n=="object"&&n!==null&&!Wn(n)&&Object.keys(n).every(e=>ml(ju,e)),qu=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_t,"X-Stainless-OS":Di(Deno.build.os),"X-Stainless-Arch":Li(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_t,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_t,"X-Stainless-OS":Di(process.platform),"X-Stainless-Arch":Li(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=Hu();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_t,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_t,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Hu(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const Li=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Di=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let $i;const zu=()=>$i??($i=qu()),Wu=n=>{try{return JSON.parse(n)}catch{return}},Vu=/^[a-z][a-z0-9+.-]*:/i,Ju=n=>Vu.test(n),Xu=n=>new Promise(e=>setTimeout(e,n)),Nr=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new J(`${n} must be an integer`);if(e<0)throw new J(`${n} must be a positive integer`);return e},cs=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(String(n))},Fr=n=>{var e,t,r,s,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,n))==null?void 0:i.trim()};function Wn(n){if(!n)return!0;for(const e in n)return!1;return!0}function ml(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ui(n,e){for(const t in e){if(!ml(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function Rt(n,...e){var t;typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"&&console.log(`Anthropic:DEBUG:${n}`,...e)}const Ku=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),Gu=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Qu=n=>typeof(n==null?void 0:n.get)=="function",ji=(n,e)=>{var r;const t=e.toLowerCase();if(Qu(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=n.get(i);if(a)return a}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};class or extends $u{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.first_id=r.first_id||null,this.last_id=r.last_id||null}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var t;if((t=this.options.query)!=null&&t.before_id){const r=this.first_id;return r?{params:{before_id:r}}:null}const e=this.last_id;return e?{params:{after_id:e}}:null}}class Ge{constructor(e){this._client=e}}let Ks=class extends Ge{retrieve(e,t){return this._client.get(`/v1/models/${e}?beta=true`,t)}list(e={},t){return nt(e)?this.list({},e):this._client.getAPIList("/v1/models?beta=true",Gs,{query:e,...t})}};class Gs extends or{}Ks.BetaModelInfosPage=Gs;class lr{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new Xe;for await(const t of this.iterator)for(const r of e.decode(t))yield JSON.parse(r);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),new J("Attempted to iterate over a response with no body");return new lr(Xs(e.body),t)}}let Qs=class extends Ge{create(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages/batches?beta=true",{body:s,...t,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}retrieve(e,t={},r){if(nt(t))return this.retrieve(e,{},t);const{betas:s}=t;return this._client.get(`/v1/messages/batches/${e}?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}list(e={},t){if(nt(e))return this.list({},e);const{betas:r,...s}=e;return this._client.getAPIList("/v1/messages/batches?beta=true",Ys,{query:s,...t,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}cancel(e,t={},r){if(nt(t))return this.cancel(e,{},t);const{betas:s}=t;return this._client.post(`/v1/messages/batches/${e}/cancel?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}async results(e,t={},r){if(nt(t))return this.results(e,{},t);const s=await this.retrieve(e);if(!s.results_url)throw new J(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);const{betas:i}=t;return this._client.get(s.results_url,{...r,headers:{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers},__binaryResponse:!0})._thenUnwrap((a,o)=>lr.fromResponse(o.response,o.controller))}};class Ys extends or{}Qs.BetaMessageBatchesPage=Ys;let cr=class extends Ge{constructor(){super(...arguments),this.batches=new Qs(this._client)}create(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages?beta=true",{body:s,timeout:this._client._options.timeout??6e5,...t,headers:{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0,...t==null?void 0:t.headers},stream:e.stream??!1})}countTokens(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:s,...t,headers:{"anthropic-beta":[...r??[],"token-counting-2024-11-01"].toString(),...t==null?void 0:t.headers}})}};cr.Batches=Qs;cr.BetaMessageBatchesPage=Ys;class un extends Ge{constructor(){super(...arguments),this.models=new Ks(this._client),this.messages=new cr(this._client)}}un.Models=Ks;un.BetaModelInfosPage=Gs;un.Messages=cr;class pl extends Ge{create(e,t){return this._client.post("/v1/complete",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}}class Zs extends Ge{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/v1/messages/batches/${e}`,t)}list(e={},t){return nt(e)?this.list({},e):this._client.getAPIList("/v1/messages/batches",ei,{query:e,...t})}cancel(e,t){return this._client.post(`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const r=await this.retrieve(e);if(!r.results_url)throw new J(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);return this._client.get(r.results_url,{...t,__binaryResponse:!0})._thenUnwrap((s,i)=>lr.fromResponse(i.response,i.controller))}}class ei extends or{}Zs.MessageBatchesPage=ei;const Yu=n=>{let e=0,t=[];for(;e<n.length;){let r=n[e];if(r==="\\"){e++;continue}if(r==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(r==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(r==="["){t.push({type:"paren",value:"["}),e++;continue}if(r==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(r===":"){t.push({type:"separator",value:":"}),e++;continue}if(r===","){t.push({type:"delimiter",value:","}),e++;continue}if(r==='"'){let o="",l=!1;for(r=n[++e];r!=='"';){if(e===n.length){l=!0;break}if(r==="\\"){if(e++,e===n.length){l=!0;break}o+=r+n[e],r=n[++e]}else o+=r,r=n[++e]}r=n[++e],l||t.push({type:"string",value:o});continue}if(r&&/\s/.test(r)){e++;continue}let i=/[0-9]/;if(r&&i.test(r)||r==="-"||r==="."){let o="";for(r==="-"&&(o+=r,r=n[++e]);r&&i.test(r)||r===".";)o+=r,r=n[++e];t.push({type:"number",value:o});continue}let a=/[a-z]/i;if(r&&a.test(r)){let o="";for(;r&&a.test(r)&&e!==n.length;)o+=r,r=n[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},yt=n=>{if(n.length===0)return n;let e=n[n.length-1];switch(e.type){case"separator":return n=n.slice(0,n.length-1),yt(n);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return n=n.slice(0,n.length-1),yt(n);case"string":let r=n[n.length-2];if((r==null?void 0:r.type)==="delimiter")return n=n.slice(0,n.length-1),yt(n);if((r==null?void 0:r.type)==="brace"&&r.value==="{")return n=n.slice(0,n.length-1),yt(n);break;case"delimiter":return n=n.slice(0,n.length-1),yt(n)}return n},Zu=n=>{let e=[];return n.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?n.push({type:"brace",value:"}"}):t==="]"&&n.push({type:"paren",value:"]"})}),n},ef=n=>{let e="";return n.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},tf=n=>JSON.parse(ef(Zu(yt(Yu(n)))));var me=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},D=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ce,Ve,Sn,En,Bt,Lt,An,Dt,je,$t,kn,Pn,ht,Br,qi,Lr,Dr,$r,Ur,Hi;const zi="__json_buf";class Vn{constructor(){Ce.add(this),this.messages=[],this.receivedMessages=[],Ve.set(this,void 0),this.controller=new AbortController,Sn.set(this,void 0),En.set(this,()=>{}),Bt.set(this,()=>{}),Lt.set(this,void 0),An.set(this,()=>{}),Dt.set(this,()=>{}),je.set(this,{}),$t.set(this,!1),kn.set(this,!1),Pn.set(this,!1),ht.set(this,!1),Lr.set(this,e=>{if(me(this,kn,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new tt),e instanceof tt)return me(this,Pn,!0,"f"),this._emit("abort",e);if(e instanceof J)return this._emit("error",e);if(e instanceof Error){const t=new J(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new J(String(e)))}),me(this,Sn,new Promise((e,t)=>{me(this,En,e,"f"),me(this,Bt,t,"f")}),"f"),me(this,Lt,new Promise((e,t)=>{me(this,An,e,"f"),me(this,Dt,t,"f")}),"f"),D(this,Sn,"f").catch(()=>{}),D(this,Lt,"f").catch(()=>{})}static fromReadableStream(e){const t=new Vn;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){const s=new Vn;for(const i of t.messages)s._addMessageParam(i);return s._run(()=>s._createMessage(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},D(this,Lr,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){var a;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),D(this,Ce,"m",Dr).call(this);const i=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)D(this,Ce,"m",$r).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new tt;D(this,Ce,"m",Ur).call(this)}_connected(){this.ended||(D(this,En,"f").call(this),this._emit("connect"))}get ended(){return D(this,$t,"f")}get errored(){return D(this,kn,"f")}get aborted(){return D(this,Pn,"f")}abort(){this.controller.abort()}on(e,t){return(D(this,je,"f")[e]||(D(this,je,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=D(this,je,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(D(this,je,"f")[e]||(D(this,je,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{me(this,ht,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){me(this,ht,!0,"f"),await D(this,Lt,"f")}get currentMessage(){return D(this,Ve,"f")}async finalMessage(){return await this.done(),D(this,Ce,"m",Br).call(this)}async finalText(){return await this.done(),D(this,Ce,"m",qi).call(this)}_emit(e,...t){if(D(this,$t,"f"))return;e==="end"&&(me(this,$t,!0,"f"),D(this,An,"f").call(this));const r=D(this,je,"f")[e];if(r&&(D(this,je,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!D(this,ht,"f")&&!(r!=null&&r.length)&&Promise.reject(s),D(this,Bt,"f").call(this,s),D(this,Dt,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!D(this,ht,"f")&&!(r!=null&&r.length)&&Promise.reject(s),D(this,Bt,"f").call(this,s),D(this,Dt,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",D(this,Ce,"m",Br).call(this))}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),D(this,Ce,"m",Dr).call(this),this._connected();const s=Je.fromReadableStream(e,this.controller);for await(const a of s)D(this,Ce,"m",$r).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new tt;D(this,Ce,"m",Ur).call(this)}[(Ve=new WeakMap,Sn=new WeakMap,En=new WeakMap,Bt=new WeakMap,Lt=new WeakMap,An=new WeakMap,Dt=new WeakMap,je=new WeakMap,$t=new WeakMap,kn=new WeakMap,Pn=new WeakMap,ht=new WeakMap,Lr=new WeakMap,Ce=new WeakSet,Br=function(){if(this.receivedMessages.length===0)throw new J("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},qi=function(){if(this.receivedMessages.length===0)throw new J("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new J("stream ended without producing a content block with type=text");return t.join(" ")},Dr=function(){this.ended||me(this,Ve,void 0,"f")},$r=function(t){if(this.ended)return;const r=D(this,Ce,"m",Hi).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{const s=r.content.at(-1);t.delta.type==="text_delta"&&s.type==="text"?this._emit("text",t.delta.text,s.text||""):t.delta.type==="input_json_delta"&&s.type==="tool_use"&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{me(this,Ve,r,"f");break}}},Ur=function(){if(this.ended)throw new J("stream has ended, this shouldn't happen");const t=D(this,Ve,"f");if(!t)throw new J("request ended without sending any chunks");return me(this,Ve,void 0,"f"),t},Hi=function(t){let r=D(this,Ve,"f");if(t.type==="message_start"){if(r)throw new J(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new J(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{const s=r.content.at(t.index);if((s==null?void 0:s.type)==="text"&&t.delta.type==="text_delta")s.text+=t.delta.text;else if((s==null?void 0:s.type)==="tool_use"&&t.delta.type==="input_json_delta"){let i=s[zi]||"";i+=t.delta.partial_json,Object.defineProperty(s,zi,{value:i,enumerable:!1,writable:!0}),i&&(s.input=tf(i))}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("streamEvent",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Je(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class ur extends Ge{constructor(){super(...arguments),this.batches=new Zs(this._client)}create(e,t){return e.model in Wi&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${Wi[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}stream(e,t){return Vn.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}const Wi={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024"};ur.Batches=Zs;ur.MessageBatchesPage=ei;class ti extends Ge{retrieve(e,t){return this._client.get(`/v1/models/${e}`,t)}list(e={},t){return nt(e)?this.list({},e):this._client.getAPIList("/v1/models",ni,{query:e,...t})}}class ni extends or{}ti.ModelInfosPage=ni;var gl;class V extends Du{constructor({baseURL:e=Fr("ANTHROPIC_BASE_URL"),apiKey:t=Fr("ANTHROPIC_API_KEY")??null,authToken:r=Fr("ANTHROPIC_AUTH_TOKEN")??null,...s}={}){const i={apiKey:t,authToken:r,...s,baseURL:e||"https://api.anthropic.com"};if(!i.dangerouslyAllowBrowser&&Gu())throw new J(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new pl(this),this.messages=new ur(this),this.models=new ti(this),this.beta=new un(this),this._options=i,this.apiKey=t,this.authToken=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(e,t){if(!(this.apiKey&&e["x-api-key"])&&t["x-api-key"]!==null&&!(this.authToken&&e.authorization)&&t.authorization!==null)throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){const t=this.apiKeyAuth(e),r=this.bearerAuth(e);return t!=null&&!Wn(t)?t:r!=null&&!Wn(r)?r:{}}apiKeyAuth(e){return this.apiKey==null?{}:{"X-Api-Key":this.apiKey}}bearerAuth(e){return this.authToken==null?{}:{Authorization:`Bearer ${this.authToken}`}}}gl=V;V.Anthropic=gl;V.HUMAN_PROMPT=`

Human:`;V.AI_PROMPT=`

Assistant:`;V.DEFAULT_TIMEOUT=6e5;V.AnthropicError=J;V.APIError=ue;V.APIConnectionError=sr;V.APIConnectionTimeoutError=nl;V.APIUserAbortError=tt;V.NotFoundError=al;V.ConflictError=ol;V.RateLimitError=cl;V.BadRequestError=rl;V.AuthenticationError=sl;V.InternalServerError=ul;V.PermissionDeniedError=il;V.UnprocessableEntityError=ll;V.toFile=Tu;V.fileFromPath=tl;V.Completions=pl;V.Messages=ur;V.Models=ti;V.ModelInfosPage=ni;V.Beta=un;const us="siyuan-ai-plugin-setting",fs="siyuan-ai-plugin-prompts",Vi=atob("aHR0cHM6Ly9vbmVhcGkuZ2Vla3NwaGVyZS5vbmxpbmU=");class _l{constructor(e,t){Se(this,"plugin");Se(this,"name");Se(this,"file");this.name=t,this.plugin=e}}class nf extends _l{constructor(t,r){super(t,r);Se(this,"prompts",[]);this.name=r??fs,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this._defaultSettings()}async load(){let t=await this.plugin.loadData(this.file);return console.debug("Load Prompt Data:",t),t&&(this.prompts=t),this.plugin.data[this.name]=t,t}async save(t){return t=t??this.dump(),await this.plugin.saveData(this.file,t),this.plugin.data[this.name]=t,t}addPrompt(t){this.prompts=[...this.prompts,t],this.save()}updatePrompt(t){this.prompts=this.prompts.map(r=>r.id===t.id?t:r),this.save()}deletePrompt(t){this.prompts=this.prompts.filter(r=>r.id!==t),this.save()}get(t){return this.prompts.find(r=>r.id===t)}set(t){this.prompts.push(t),this.save()}dump(){return this.prompts}_defaultSettings(){this.prompts=[{id:0,title:"翻译、拼写纠正、改进",content:"请对以上内容进行翻译。要求：我希望你用更优美优雅的高级英语单词和句子替换我简化的 A0 级单词和句子。保持相同的意思，但使它们更文艺。你只需要翻译该内容，不必对内容中提出的问题和要求做解释，不要回答文本中的问题而是翻译它。"},{id:1,title:"提取标题",content:"请为上面这篇文章生成简洁且完整概括的标题。"},{id:2,title:"提取摘要",content:"请为上面这篇文章生成简明扼要的摘要。"},{id:3,title:"提取标签",content:"请为上面这篇文章生成标签，单个标签不超过6个字符，多个标签用英文逗号分隔，最多返回5个标签。"},{id:4,title:"论文摘要生成",content:`请你充当一名论文编辑专家，为上面这篇文章，在论文评审的角度去生成论文摘要部分，使其更加流畅，优美。下面是具体要求：
能让读者快速获得文章的要点或精髓，让文章引人入胜；能让读者了解全文中的重要信息、分析和论点；帮助读者记住论文的要点
字数限制在300字以下
用简洁、明了的语言描述论文的方法和结果，以便评审更容易理解论文`},{id:5,title:"文本总结助手",content:`你是一个擅长总结长文本的助手，请对上面的文本进行总结，并生成摘要。
标题：xxx
作者：xxx
标签：阅读文章内容后给文章打上标签，标签通常是领域、学科或专有名词
一句话总结这篇文文章:xxx
总结文章内容并写成摘要:xxx
越详细地列举文章的大纲，越详细越好，要完整体现文章要点；`},{id:6,title:"标题党",content:"请问上面的文本生成花哨的标题"}],this.load(),this.save()}}class rf extends _l{constructor(t,r){super(t,r);Se(this,"settings",new Map);this.name=r??us,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this._defaultSettings()}async load(){let t=await this.plugin.loadData(this.file);if(console.debug("Load Setting Config:",t),t)for(let[r,s]of this.settings)s.value=(t==null?void 0:t[r])??s.value;return this.plugin.data[this.name]=t,t}async save(t){return t=t??this.dump(),await this.plugin.saveData(this.file,t),console.debug("Save Setting Config:",t),t}get(t){return this.settings.get(t)}getValue(t){var r;return(r=this.settings.get(t))==null?void 0:r.value}getSettingItems(t){let r=[];for(let[s,i]of this.settings)t&&i.group!==t||r.push(i);return r}set(t,r){this.settings.set(t,r)}setValue(t,r){let s=this.settings.get(t);s.value=r}dump(){let t={};for(let[r,s]of this.settings)t[r]=s.value;return t}_defaultSettings(){const t={group:"🌈 设置",title:"密钥",description:'<a href="https://item.taobao.com/item.htm?ft=t&id=877591591207&spm=a21dvs.23580594.0.0.621e2c1bjqRPCl&skuId=5719376381355">密钥购买链接</a>, 售后QQ群: 710607849',type:"textinput",key:"apiKey",value:"",placeholder:"Enter your Key"};this.settings.set(t.key,t);const r={group:"🌈 设置",title:"是否使用指令面板",description:"当开启时，会在输入框下方显示保存的指令，默认为 否。",type:"checkbox",key:"isShowPrompts",value:!1};this.settings.set(r.key,r);const s={group:"custom",title:"是否获取页面文本",description:"当未选中文本使用指令模式时，是否获取当前页面的全部文本作为大模型的输入。默认为 否。",type:"checkbox",key:"isPageContent",value:!1};this.settings.set(s.key,s);const i={group:"custom",title:"温度",description:"温度值越小，模型生成的内容越准确。温度值越高，模型生成内容越多样。默认为 1.0。",type:"slider",key:"temperature",slider:{min:0,max:2,step:.1},value:1};this.settings.set(i.key,i);const a={group:"custom",title:"最大长度",description:"输出文本的最大长度,默认为 4k。",type:"number",key:"maxOutputLength",value:4e3};this.settings.set(a.key,a);const o={group:"custom",title:"请求超时时间",description:"发起请求的超时时间，超过该时间，取消请求，单位：秒。默认为 90 秒。",type:"number",key:"responseTimeout",value:90};this.settings.set(o.key,o);const l={group:"model",title:"模型",description:"选择模型",type:"select",key:"modelSelections",value:"deepseek-chat",options:{"deepseek-chat":"DeepSeek Chat","deepseek-reasoner":"DeepSeek Reasoner","qwen-turbo-latest":"Qwen Turbo","qwen-plus-latest":"Qwen Plus","qwen-max-latest":"Qwen Max","gpt-4o":"GPT 4o","gpt-4o-mini":"GPT 4o mini","gpt-4-turbo":"GPT 4 Turbo","claude-3-5-haiku-20241022":"Claude 3.5 Haiku","claude-3-5-sonnet-latest":"Claude 3.5 Sonnet","claude-3-opus-latest":"Claude 3 Opus"}};this.settings.set(l.key,l),this.load()}}function Jn(n,{delay:e=0,duration:t=400,easing:r=xa}={}){const s=+getComputedStyle(n).opacity;return{delay:e,duration:t,easing:r,css:i=>`opacity: ${i*s}`}}function Ji(n){let e;return{c(){e=R("div"),e.innerHTML='<span style="color: var(--b3-theme-primary);">生成中...</span>',x(e,"width","100%"),x(e,"text-align","center"),x(e,"border-top","1px solid var(--b3-border-color)")},m(t,r){q(t,e,r)},d(t){t&&U(e)}}}function sf(n){let e,t,r,s,i,a,o=n[2]&&Ji();return{c(){e=R("div"),t=R("div"),r=le(n[1]),s=O(),o&&o.c(),x(t,"max-height","250px"),x(t,"overflow-y","auto"),x(t,"margin-top","10px"),x(t,"white-space","pre-wrap"),x(t,"line-height","1.3"),x(t,"scrollbar-width","thin"),x(e,"width","94%"),x(e,"padding","3%"),x(e,"align-self","center"),x(e,"background","var(--b3-card-background)")},m(l,c){q(l,e,c),b(e,t),b(t,r),n[3](t),b(e,s),o&&o.m(e,null),a=!0},p(l,[c]){(!a||c&2)&&Ie(r,l[1]),l[2]?o||(o=Ji(),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i(l){a||(l&&ot(()=>{a&&(i||(i=Un(e,Jn,{duration:200},!0)),i.run(1))}),a=!0)},o(l){l&&(i||(i=Un(e,Jn,{duration:200},!1)),i.run(0)),a=!1},d(l){l&&U(e),n[3](null),o&&o.d(),l&&i&&i.end()}}}function af(n,e,t){let{outputContent:r}=e,{isGenerating:s}=e,{outputContainer:i}=e;function a(o){ie[o?"unshift":"push"](()=>{i=o,t(0,i)})}return n.$$set=o=>{"outputContent"in o&&t(1,r=o.outputContent),"isGenerating"in o&&t(2,s=o.isGenerating),"outputContainer"in o&&t(0,i=o.outputContainer)},[i,r,s,a]}class of extends he{constructor(e){super(),de(this,e,af,sf,fe,{outputContent:1,isGenerating:2,outputContainer:0})}}function Xi(n,e,t){const r=n.slice();return r[0]=e[t][0],r[18]=e[t][1],r}function lf(n){let e,t,r,s,i,a,o;return{c(){e=R("div"),t=R("input"),A(t,"id","fontSize"),A(t,"min",r=n[5].min),A(t,"max",s=n[5].max),A(t,"step",i=n[5].step),A(t,"type","range"),A(t,"style",n[8]),K(t,"b3-slider",!0),K(t,"fn__size200",n[7]),A(e,"class","b3-tooltips b3-tooltips__n"),A(e,"aria-label",n[0])},m(l,c){q(l,e,c),b(e,t),_e(t,n[0]),a||(o=[H(t,"change",n[16]),H(t,"input",n[16]),H(t,"change",n[10])],a=!0)},p(l,c){c&32&&r!==(r=l[5].min)&&A(t,"min",r),c&32&&s!==(s=l[5].max)&&A(t,"max",s),c&32&&i!==(i=l[5].step)&&A(t,"step",i),c&256&&A(t,"style",l[8]),c&17&&_e(t,l[0]),c&128&&K(t,"fn__size200",l[7]),c&17&&A(e,"aria-label",l[0])},d(l){l&&U(e),a=!1,ae(o)}}}function cf(n){let e,t,r,s=xe(Object.entries(n[4])),i=[];for(let a=0;a<s.length;a+=1)i[a]=Ki(Xi(n,s,a));return{c(){e=R("select");for(let a=0;a<i.length;a+=1)i[a].c();A(e,"id","iconPosition"),A(e,"style",n[8]),n[0]===void 0&&ot(()=>n[15].call(e)),K(e,"b3-select",!0),K(e,"fn__flex-center",!0),K(e,"fn__size200",n[7])},m(a,o){q(a,e,o);for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(e,null);mi(e,n[0],!0),t||(r=[H(e,"change",n[15]),H(e,"change",n[10])],t=!0)},p(a,o){if(o&16){s=xe(Object.entries(a[4]));let l;for(l=0;l<s.length;l+=1){const c=Xi(a,s,l);i[l]?i[l].p(c,o):(i[l]=Ki(c),i[l].c(),i[l].m(e,null))}for(;l<i.length;l+=1)i[l].d(1);i.length=s.length}o&256&&A(e,"style",a[8]),o&17&&mi(e,a[0]),o&128&&K(e,"fn__size200",a[7])},d(a){a&&U(e),Ln(i,a),t=!1,ae(r)}}}function uf(n){let e,t=n[6].label+"",r,s,i;return{c(){e=R("button"),r=le(t),A(e,"id",n[2]),A(e,"style",n[8]),K(e,"b3-button",!0),K(e,"b3-button--outline",!0),K(e,"fn__flex-center",!0),K(e,"fn__size200",n[7])},m(a,o){q(a,e,o),b(e,r),s||(i=H(e,"click",n[9]),s=!0)},p(a,o){o&64&&t!==(t=a[6].label+"")&&Ie(r,t),o&4&&A(e,"id",a[2]),o&256&&A(e,"style",a[8]),o&128&&K(e,"fn__size200",a[7])},d(a){a&&U(e),s=!1,i()}}}function ff(n){let e,t,r;return{c(){e=R("input"),A(e,"id",n[2]),A(e,"type","number"),A(e,"style",n[8]),K(e,"b3-text-field",!0),K(e,"fn__flex-center",!0),K(e,"fn__size200",n[7])},m(s,i){q(s,e,i),_e(e,n[0]),t||(r=[H(e,"input",n[14]),H(e,"change",n[10])],t=!0)},p(s,i){i&4&&A(e,"id",s[2]),i&256&&A(e,"style",s[8]),i&17&&Wr(e.value)!==s[0]&&_e(e,s[0]),i&128&&K(e,"fn__size200",s[7])},d(s){s&&U(e),t=!1,ae(r)}}}function df(n){let e,t,r,s;return{c(){e=R("textarea"),A(e,"class","b3-text-field fn__block"),A(e,"style",t=`resize: vertical; height: 10em; white-space: nowrap; ${n[8]}`)},m(i,a){q(i,e,a),_e(e,n[0]),r||(s=[H(e,"input",n[13]),H(e,"change",n[10])],r=!0)},p(i,a){a&256&&t!==(t=`resize: vertical; height: 10em; white-space: nowrap; ${i[8]}`)&&A(e,"style",t),a&17&&_e(e,i[0])},d(i){i&&U(e),r=!1,ae(s)}}}function hf(n){let e,t,r;return{c(){e=R("input"),A(e,"id",n[2]),A(e,"placeholder",n[3]),A(e,"style",n[8]),K(e,"b3-text-field",!0),K(e,"fn__flex-center",!0),K(e,"fn__size200",n[7])},m(s,i){q(s,e,i),_e(e,n[0]),t||(r=[H(e,"input",n[12]),H(e,"change",n[10])],t=!0)},p(s,i){i&4&&A(e,"id",s[2]),i&8&&A(e,"placeholder",s[3]),i&256&&A(e,"style",s[8]),i&17&&e.value!==s[0]&&_e(e,s[0]),i&128&&K(e,"fn__size200",s[7])},d(s){s&&U(e),t=!1,ae(r)}}}function mf(n){let e,t,r;return{c(){e=R("input"),A(e,"class","b3-switch fn__flex-center"),A(e,"id",n[2]),A(e,"type","checkbox"),A(e,"style",n[8])},m(s,i){q(s,e,i),e.checked=n[0],t||(r=[H(e,"change",n[11]),H(e,"change",n[10])],t=!0)},p(s,i){i&4&&A(e,"id",s[2]),i&256&&A(e,"style",s[8]),i&17&&(e.checked=s[0])},d(s){s&&U(e),t=!1,ae(r)}}}function Ki(n){let e,t=n[18]+"",r,s;return{c(){e=R("option"),r=le(t),e.__value=s=n[0],_e(e,e.__value)},m(i,a){q(i,e,a),b(e,r)},p(i,a){a&16&&t!==(t=i[18]+"")&&Ie(r,t),a&16&&s!==(s=i[0])&&(e.__value=s,_e(e,e.__value))},d(i){i&&U(e)}}}function pf(n){let e;function t(i,a){if(i[1]==="checkbox")return mf;if(i[1]==="textinput")return hf;if(i[1]==="textarea")return df;if(i[1]==="number")return ff;if(i[1]==="button")return uf;if(i[1]==="select")return cf;if(i[1]=="slider")return lf}let r=t(n),s=r&&r(n);return{c(){s&&s.c(),e=As()},m(i,a){s&&s.m(i,a),q(i,e,a)},p(i,[a]){r===(r=t(i))&&s?s.p(i,a):(s&&s.d(1),s=r&&r(i),s&&(s.c(),s.m(e.parentNode,e)))},i:Z,o:Z,d(i){i&&U(e),s&&s.d(i)}}}function gf(n,e,t){let{type:r}=e,{key:s}=e,{value:i}=e,{placeholder:a=""}=e,{options:o={}}=e,{slider:l={min:0,max:100,step:1}}=e,{button:c={label:i,callback:()=>{}}}=e,{fnSize:f=!0}=e,{style:u=""}=e;const h=Zn();function m(){c==null||c.callback(),h("click",{key:s})}function d(){h("changed",{key:s,value:i})}function g(){i=this.checked,t(0,i),t(4,o)}function p(){i=this.value,t(0,i),t(4,o)}function k(){i=this.value,t(0,i),t(4,o)}function _(){i=Wr(this.value),t(0,i),t(4,o)}function w(){i=ac(this),t(0,i),t(4,o)}function y(){i=Wr(this.value),t(0,i),t(4,o)}return n.$$set=S=>{"type"in S&&t(1,r=S.type),"key"in S&&t(2,s=S.key),"value"in S&&t(0,i=S.value),"placeholder"in S&&t(3,a=S.placeholder),"options"in S&&t(4,o=S.options),"slider"in S&&t(5,l=S.slider),"button"in S&&t(6,c=S.button),"fnSize"in S&&t(7,f=S.fnSize),"style"in S&&t(8,u=S.style)},[i,r,s,a,o,l,c,f,u,m,d,g,p,k,_,w,y]}class Xn extends he{constructor(e){super(),de(this,e,gf,pf,fe,{type:1,key:2,value:0,placeholder:3,options:4,slider:5,button:6,fnSize:7,style:8})}}function _f(n){let e,t,r,s,i,a,o,l,c,f,u,h,m;function d(p){n[12](p)}let g={type:"select",key:"modelSelections",fnSize:!1,options:n[4].get("modelSelections").options,style:"margin-right: 5px; font-size: 12px; padding: 2px 4px; border-radius: 4px; border: 1px solid #ddd; height: 2em; background: transparent; align-self: center;"};return n[2]!==void 0&&(g.value=n[2]),s=new Xn({props:g}),ie.push(()=>Pe(s,"value",d)),s.$on("changed",n[13]),{c(){e=R("div"),t=R("textarea"),r=O(),Y(s.$$.fragment),a=O(),o=R("button"),o.textContent="超参数",l=O(),c=R("button"),c.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" class="svelte-1x8hi4t"></path></svg>',A(t,"placeholder","输入 AI 指令... "),A(t,"class",".b3-text-field fn__block fn__flex-center"),x(t,"width","calc(100% - 120px)"),x(t,"height","2em"),x(t,"line-height","1.5em"),x(t,"white-space","pre-wrap"),x(t,"background","transparent"),x(t,"border","0"),x(t,"outline","none"),x(t,"margin-left","0.5em"),x(t,"resize","none"),x(t,"overflow-y","auto"),x(t,"padding","0"),A(o,"type","button"),A(o,"class","ai-instruction-params-button svelte-1x8hi4t"),x(o,"font-size","12px"),x(o,"color","#666"),x(o,"text-decoration","none"),x(o,"background","none"),x(o,"border","none"),x(o,"padding","0"),x(o,"cursor","pointer"),x(o,"margin-right","5px"),x(o,"white-space","nowrap"),x(o,"height","2em"),x(o,"line-height","2em"),x(o,"align-self","center"),A(c,"type","button"),A(c,"class","ai-instruction-submit-button svelte-1x8hi4t"),x(c,"height","2em"),x(c,"display","flex"),x(c,"align-items","center"),x(c,"opacity","0.6"),x(c,"cursor","pointer"),x(c,"background","none"),x(c,"border","none"),x(c,"padding","0"),x(c,"align-self","center"),x(e,"width","100%"),x(e,"height","100%"),x(e,"display","flex"),x(e,"position","relative"),x(e,"align-items","center"),x(e,"margin","10px 0")},m(p,k){q(p,e,k),b(e,t),n[8](t),_e(t,n[0]),b(e,r),G(s,e,null),b(e,a),b(e,o),b(e,l),b(e,c),u=!0,h||(m=[H(t,"input",n[9]),H(t,"keydown",function(){wt(n[6])&&n[6].apply(this,arguments)}),H(t,"focus",n[10]),H(t,"blur",n[11]),H(o,"click",n[14]),H(c,"click",function(){wt(n[5])&&n[5].apply(this,arguments)}),H(c,"keydown",function(){wt(n[6])&&n[6].apply(this,arguments)})],h=!0)},p(p,[k]){n=p,k&1&&_e(t,n[0]);const _={};k&16&&(_.options=n[4].get("modelSelections").options),!i&&k&4&&(i=!0,_.value=n[2],ke(()=>i=!1)),s.$set(_)},i(p){u||(F(s.$$.fragment,p),p&&ot(()=>{u&&(f||(f=Un(e,Jn,{duration:200},!0)),f.run(1))}),u=!0)},o(p){L(s.$$.fragment,p),p&&(f||(f=Un(e,Jn,{duration:200},!1)),f.run(0)),u=!1},d(p){p&&U(e),n[8](null),Q(s),p&&f&&f.end(),h=!1,ae(m)}}}function yf(n,e,t){let{inputValue:r}=e,{inputElement:s}=e,{selectedModel:i}=e,{settingStorage:a}=e,{showParams:o}=e,{handleSubmit:l}=e,{handleKeydown:c}=e,f=!1;function u(_){ie[_?"unshift":"push"](()=>{s=_,t(1,s)})}function h(){r=this.value,t(0,r)}const m=()=>t(7,f=!0),d=()=>t(7,f=!1);function g(_){i=_,t(2,i)}const p=({detail:_})=>{a.setValue(_.key,_.value),a.save()},k=()=>{t(3,o=!o),o||a.save()};return n.$$set=_=>{"inputValue"in _&&t(0,r=_.inputValue),"inputElement"in _&&t(1,s=_.inputElement),"selectedModel"in _&&t(2,i=_.selectedModel),"settingStorage"in _&&t(4,a=_.settingStorage),"showParams"in _&&t(3,o=_.showParams),"handleSubmit"in _&&t(5,l=_.handleSubmit),"handleKeydown"in _&&t(6,c=_.handleKeydown)},[r,s,i,o,a,l,c,f,u,h,m,d,g,p,k]}class bf extends he{constructor(e){super(),de(this,e,yf,_f,fe,{inputValue:0,inputElement:1,selectedModel:2,settingStorage:4,showParams:3,handleSubmit:5,handleKeydown:6})}}function wf(n){let e,t,r,s,i,a,o=Kn(n[1],n[3])+"",l,c,f,u;const h=n[5].default,m=ys(h,n,n[4],null);return{c(){e=R("div"),t=R("div"),r=R("span"),s=le(n[0]),i=O(),a=R("div"),l=O(),c=R("span"),f=O(),m&&m.c(),A(r,"class","title svelte-ikiu6h"),A(a,"class","b3-label__text"),A(t,"class","fn__flex-1"),A(c,"class","fn__space"),A(e,"class","item-wrap fn__flex b3-label config__item svelte-ikiu6h")},m(d,g){q(d,e,g),b(e,t),b(t,r),b(r,s),b(t,i),b(t,a),a.innerHTML=o,b(e,l),b(e,c),b(e,f),m&&m.m(e,null),u=!0},p(d,g){(!u||g&1)&&Ie(s,d[0]),(!u||g&10)&&o!==(o=Kn(d[1],d[3])+"")&&(a.innerHTML=o),m&&m.p&&(!u||g&16)&&ws(m,h,d,d[4],u?bs(h,d[4],g,null):Ss(d[4]),null)},i(d){u||(F(m,d),u=!0)},o(d){L(m,d),u=!1},d(d){d&&U(e),m&&m.d(d)}}}function Sf(n){let e,t,r,s,i,a,o=Kn(n[1],n[3])+"",l,c,f,u,h;const m=n[5].default,d=ys(m,n,n[4],null);return{c(){e=R("div"),t=R("div"),r=R("span"),s=le(n[0]),i=O(),a=R("div"),l=O(),c=R("div"),f=O(),u=R("div"),d&&d.c(),A(r,"class","title svelte-ikiu6h"),A(a,"class","b3-label__text"),A(c,"class","fn__hr"),x(u,"display","flex"),x(u,"flex-direction","column"),x(u,"gap","5px"),x(u,"position","relative"),A(t,"class","fn__block"),A(e,"class","item-wrap b3-label svelte-ikiu6h"),A(e,"data-key","CustomCSS")},m(g,p){q(g,e,p),b(e,t),b(t,r),b(r,s),b(t,i),b(t,a),a.innerHTML=o,b(t,l),b(t,c),b(t,f),b(t,u),d&&d.m(u,null),h=!0},p(g,p){(!h||p&1)&&Ie(s,g[0]),(!h||p&10)&&o!==(o=Kn(g[1],g[3])+"")&&(a.innerHTML=o),d&&d.p&&(!h||p&16)&&ws(d,m,g,g[4],h?bs(m,g[4],p,null):Ss(g[4]),null)},i(g){h||(F(d,g),h=!0)},o(g){L(d,g),h=!1},d(g){g&&U(e),d&&d.d(g)}}}function Ef(n){let e,t,r,s;const i=[Sf,wf],a=[];function o(l,c){return l[2]==="row"?0:1}return e=o(n),t=a[e]=i[e](n),{c(){t.c(),r=As()},m(l,c){a[e].m(l,c),q(l,r,c),s=!0},p(l,[c]){let f=e;e=o(l),e===f?a[e].p(l,c):(st(),L(a[f],1,1,()=>{a[f]=null}),it(),t=a[e],t?t.p(l,c):(t=a[e]=i[e](l),t.c()),F(t,1),t.m(r.parentNode,r))},i(l){s||(F(t),s=!0)},o(l){L(t),s=!1},d(l){l&&U(r),a[e].d(l)}}}function Kn(n,e=!1){return e&&n.length>20?n.slice(0,20)+"...":n}function Af(n,e,t){let{$$slots:r={},$$scope:s}=e,{title:i}=e,{description:a}=e,{direction:o="column"}=e,{isSimple:l=!1}=e;return n.$$set=c=>{"title"in c&&t(0,i=c.title),"description"in c&&t(1,a=c.description),"direction"in c&&t(2,o=c.direction),"isSimple"in c&&t(3,l=c.isSimple),"$$scope"in c&&t(4,s=c.$$scope)},[i,a,o,l,s,r]}class kf extends he{constructor(e){super(),de(this,e,Af,Ef,fe,{title:0,description:1,direction:2,isSimple:3})}}const yl={Wrap:kf,Input:Xn};function bl(n,e){return function(){return n.apply(e,arguments)}}const{toString:Pf}=Object.prototype,{getPrototypeOf:ri}=Object,fr=(n=>e=>{const t=Pf.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Fe=n=>(n=n.toLowerCase(),e=>fr(e)===n),dr=n=>e=>typeof e===n,{isArray:Tt}=Array,nn=dr("undefined");function Rf(n){return n!==null&&!nn(n)&&n.constructor!==null&&!nn(n.constructor)&&Re(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const wl=Fe("ArrayBuffer");function Cf(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&wl(n.buffer),e}const xf=dr("string"),Re=dr("function"),Sl=dr("number"),hr=n=>n!==null&&typeof n=="object",vf=n=>n===!0||n===!1,In=n=>{if(fr(n)!=="object")return!1;const e=ri(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Of=Fe("Date"),Tf=Fe("File"),Mf=Fe("Blob"),If=Fe("FileList"),Nf=n=>hr(n)&&Re(n.pipe),Ff=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Re(n.append)&&((e=fr(n))==="formdata"||e==="object"&&Re(n.toString)&&n.toString()==="[object FormData]"))},Bf=Fe("URLSearchParams"),[Lf,Df,$f,Uf]=["ReadableStream","Request","Response","Headers"].map(Fe),jf=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function fn(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,s;if(typeof n!="object"&&(n=[n]),Tt(n))for(r=0,s=n.length;r<s;r++)e.call(null,n[r],r,n);else{const i=t?Object.getOwnPropertyNames(n):Object.keys(n),a=i.length;let o;for(r=0;r<a;r++)o=i[r],e.call(null,n[o],o,n)}}function El(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,s;for(;r-- >0;)if(s=t[r],e===s.toLowerCase())return s;return null}const rt=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Al=n=>!nn(n)&&n!==rt;function ds(){const{caseless:n}=Al(this)&&this||{},e={},t=(r,s)=>{const i=n&&El(e,s)||s;In(e[i])&&In(r)?e[i]=ds(e[i],r):In(r)?e[i]=ds({},r):Tt(r)?e[i]=r.slice():e[i]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&fn(arguments[r],t);return e}const qf=(n,e,t,{allOwnKeys:r}={})=>(fn(e,(s,i)=>{t&&Re(s)?n[i]=bl(s,t):n[i]=s},{allOwnKeys:r}),n),Hf=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),zf=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},Wf=(n,e,t,r)=>{let s,i,a;const o={};if(e=e||{},n==null)return e;do{for(s=Object.getOwnPropertyNames(n),i=s.length;i-- >0;)a=s[i],(!r||r(a,n,e))&&!o[a]&&(e[a]=n[a],o[a]=!0);n=t!==!1&&ri(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},Vf=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},Jf=n=>{if(!n)return null;if(Tt(n))return n;let e=n.length;if(!Sl(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},Xf=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&ri(Uint8Array)),Kf=(n,e)=>{const r=(n&&n[Symbol.iterator]).call(n);let s;for(;(s=r.next())&&!s.done;){const i=s.value;e.call(n,i[0],i[1])}},Gf=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},Qf=Fe("HTMLFormElement"),Yf=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,s){return r.toUpperCase()+s}),Gi=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),Zf=Fe("RegExp"),kl=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};fn(t,(s,i)=>{let a;(a=e(s,i,n))!==!1&&(r[i]=a||s)}),Object.defineProperties(n,r)},ed=n=>{kl(n,(e,t)=>{if(Re(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(Re(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},td=(n,e)=>{const t={},r=s=>{s.forEach(i=>{t[i]=!0})};return Tt(n)?r(n):r(String(n).split(e)),t},nd=()=>{},rd=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e,jr="abcdefghijklmnopqrstuvwxyz",Qi="0123456789",Pl={DIGIT:Qi,ALPHA:jr,ALPHA_DIGIT:jr+jr.toUpperCase()+Qi},sd=(n=16,e=Pl.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function id(n){return!!(n&&Re(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const ad=n=>{const e=new Array(10),t=(r,s)=>{if(hr(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const i=Tt(r)?[]:{};return fn(r,(a,o)=>{const l=t(a,s+1);!nn(l)&&(i[o]=l)}),e[s]=void 0,i}}return r};return t(n,0)},od=Fe("AsyncFunction"),ld=n=>n&&(hr(n)||Re(n))&&Re(n.then)&&Re(n.catch),Rl=((n,e)=>n?setImmediate:e?((t,r)=>(rt.addEventListener("message",({source:s,data:i})=>{s===rt&&i===t&&r.length&&r.shift()()},!1),s=>{r.push(s),rt.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Re(rt.postMessage)),cd=typeof queueMicrotask<"u"?queueMicrotask.bind(rt):typeof process<"u"&&process.nextTick||Rl,E={isArray:Tt,isArrayBuffer:wl,isBuffer:Rf,isFormData:Ff,isArrayBufferView:Cf,isString:xf,isNumber:Sl,isBoolean:vf,isObject:hr,isPlainObject:In,isReadableStream:Lf,isRequest:Df,isResponse:$f,isHeaders:Uf,isUndefined:nn,isDate:Of,isFile:Tf,isBlob:Mf,isRegExp:Zf,isFunction:Re,isStream:Nf,isURLSearchParams:Bf,isTypedArray:Xf,isFileList:If,forEach:fn,merge:ds,extend:qf,trim:jf,stripBOM:Hf,inherits:zf,toFlatObject:Wf,kindOf:fr,kindOfTest:Fe,endsWith:Vf,toArray:Jf,forEachEntry:Kf,matchAll:Gf,isHTMLForm:Qf,hasOwnProperty:Gi,hasOwnProp:Gi,reduceDescriptors:kl,freezeMethods:ed,toObjectSet:td,toCamelCase:Yf,noop:nd,toFiniteNumber:rd,findKey:El,global:rt,isContextDefined:Al,ALPHABET:Pl,generateString:sd,isSpecCompliantForm:id,toJSONObject:ad,isAsyncFn:od,isThenable:ld,setImmediate:Rl,asap:cd};function B(n,e,t,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}E.inherits(B,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:E.toJSONObject(this.config),code:this.code,status:this.status}}});const Cl=B.prototype,xl={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{xl[n]={value:n}});Object.defineProperties(B,xl);Object.defineProperty(Cl,"isAxiosError",{value:!0});B.from=(n,e,t,r,s,i)=>{const a=Object.create(Cl);return E.toFlatObject(n,a,function(l){return l!==Error.prototype},o=>o!=="isAxiosError"),B.call(a,n.message,e,t,r,s),a.cause=n,a.name=n.name,i&&Object.assign(a,i),a};const ud=null;function hs(n){return E.isPlainObject(n)||E.isArray(n)}function vl(n){return E.endsWith(n,"[]")?n.slice(0,-2):n}function Yi(n,e,t){return n?n.concat(e).map(function(s,i){return s=vl(s),!t&&i?"["+s+"]":s}).join(t?".":""):e}function fd(n){return E.isArray(n)&&!n.some(hs)}const dd=E.toFlatObject(E,{},null,function(e){return/^is[A-Z]/.test(e)});function mr(n,e,t){if(!E.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=E.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,p){return!E.isUndefined(p[g])});const r=t.metaTokens,s=t.visitor||f,i=t.dots,a=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&E.isSpecCompliantForm(e);if(!E.isFunction(s))throw new TypeError("visitor must be a function");function c(d){if(d===null)return"";if(E.isDate(d))return d.toISOString();if(!l&&E.isBlob(d))throw new B("Blob is not supported. Use a Buffer instead.");return E.isArrayBuffer(d)||E.isTypedArray(d)?l&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function f(d,g,p){let k=d;if(d&&!p&&typeof d=="object"){if(E.endsWith(g,"{}"))g=r?g:g.slice(0,-2),d=JSON.stringify(d);else if(E.isArray(d)&&fd(d)||(E.isFileList(d)||E.endsWith(g,"[]"))&&(k=E.toArray(d)))return g=vl(g),k.forEach(function(w,y){!(E.isUndefined(w)||w===null)&&e.append(a===!0?Yi([g],y,i):a===null?g:g+"[]",c(w))}),!1}return hs(d)?!0:(e.append(Yi(p,g,i),c(d)),!1)}const u=[],h=Object.assign(dd,{defaultVisitor:f,convertValue:c,isVisitable:hs});function m(d,g){if(!E.isUndefined(d)){if(u.indexOf(d)!==-1)throw Error("Circular reference detected in "+g.join("."));u.push(d),E.forEach(d,function(k,_){(!(E.isUndefined(k)||k===null)&&s.call(e,k,E.isString(_)?_.trim():_,g,h))===!0&&m(k,g?g.concat(_):[_])}),u.pop()}}if(!E.isObject(n))throw new TypeError("data must be an object");return m(n),e}function Zi(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function si(n,e){this._pairs=[],n&&mr(n,this,e)}const Ol=si.prototype;Ol.append=function(e,t){this._pairs.push([e,t])};Ol.toString=function(e){const t=e?function(r){return e.call(this,r,Zi)}:Zi;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};function hd(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Tl(n,e,t){if(!e)return n;const r=t&&t.encode||hd;E.isFunction(t)&&(t={serialize:t});const s=t&&t.serialize;let i;if(s?i=s(e,t):i=E.isURLSearchParams(e)?e.toString():new si(e,t).toString(r),i){const a=n.indexOf("#");a!==-1&&(n=n.slice(0,a)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n}class ea{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){E.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Ml={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},md=typeof URLSearchParams<"u"?URLSearchParams:si,pd=typeof FormData<"u"?FormData:null,gd=typeof Blob<"u"?Blob:null,_d={isBrowser:!0,classes:{URLSearchParams:md,FormData:pd,Blob:gd},protocols:["http","https","file","blob","url","data"]},ii=typeof window<"u"&&typeof document<"u",ms=typeof navigator=="object"&&navigator||void 0,yd=ii&&(!ms||["ReactNative","NativeScript","NS"].indexOf(ms.product)<0),bd=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",wd=ii&&window.location.href||"http://localhost",Sd=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ii,hasStandardBrowserEnv:yd,hasStandardBrowserWebWorkerEnv:bd,navigator:ms,origin:wd},Symbol.toStringTag,{value:"Module"})),ce={...Sd,..._d};function Ed(n,e){return mr(n,new ce.classes.URLSearchParams,Object.assign({visitor:function(t,r,s,i){return ce.isNode&&E.isBuffer(t)?(this.append(r,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function Ad(n){return E.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function kd(n){const e={},t=Object.keys(n);let r;const s=t.length;let i;for(r=0;r<s;r++)i=t[r],e[i]=n[i];return e}function Il(n){function e(t,r,s,i){let a=t[i++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),l=i>=t.length;return a=!a&&E.isArray(s)?s.length:a,l?(E.hasOwnProp(s,a)?s[a]=[s[a],r]:s[a]=r,!o):((!s[a]||!E.isObject(s[a]))&&(s[a]=[]),e(t,r,s[a],i)&&E.isArray(s[a])&&(s[a]=kd(s[a])),!o)}if(E.isFormData(n)&&E.isFunction(n.entries)){const t={};return E.forEachEntry(n,(r,s)=>{e(Ad(r),s,t,0)}),t}return null}function Pd(n,e,t){if(E.isString(n))try{return(e||JSON.parse)(n),E.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(0,JSON.stringify)(n)}const dn={transitional:Ml,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",s=r.indexOf("application/json")>-1,i=E.isObject(e);if(i&&E.isHTMLForm(e)&&(e=new FormData(e)),E.isFormData(e))return s?JSON.stringify(Il(e)):e;if(E.isArrayBuffer(e)||E.isBuffer(e)||E.isStream(e)||E.isFile(e)||E.isBlob(e)||E.isReadableStream(e))return e;if(E.isArrayBufferView(e))return e.buffer;if(E.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Ed(e,this.formSerializer).toString();if((o=E.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return mr(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return i||s?(t.setContentType("application/json",!1),Pd(e)):e}],transformResponse:[function(e){const t=this.transitional||dn.transitional,r=t&&t.forcedJSONParsing,s=this.responseType==="json";if(E.isResponse(e)||E.isReadableStream(e))return e;if(e&&E.isString(e)&&(r&&!this.responseType||s)){const a=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?B.from(o,B.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ce.classes.FormData,Blob:ce.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};E.forEach(["delete","get","head","post","put","patch"],n=>{dn.headers[n]={}});const Rd=E.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Cd=n=>{const e={};let t,r,s;return n&&n.split(`
`).forEach(function(a){s=a.indexOf(":"),t=a.substring(0,s).trim().toLowerCase(),r=a.substring(s+1).trim(),!(!t||e[t]&&Rd[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},ta=Symbol("internals");function Ut(n){return n&&String(n).trim().toLowerCase()}function Nn(n){return n===!1||n==null?n:E.isArray(n)?n.map(Nn):String(n)}function xd(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const vd=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function qr(n,e,t,r,s){if(E.isFunction(r))return r.call(this,e,t);if(s&&(e=t),!!E.isString(e)){if(E.isString(r))return e.indexOf(r)!==-1;if(E.isRegExp(r))return r.test(e)}}function Od(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function Td(n,e){const t=E.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(s,i,a){return this[r].call(this,e,s,i,a)},configurable:!0})})}class ge{constructor(e){e&&this.set(e)}set(e,t,r){const s=this;function i(o,l,c){const f=Ut(l);if(!f)throw new Error("header name must be a non-empty string");const u=E.findKey(s,f);(!u||s[u]===void 0||c===!0||c===void 0&&s[u]!==!1)&&(s[u||l]=Nn(o))}const a=(o,l)=>E.forEach(o,(c,f)=>i(c,f,l));if(E.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(E.isString(e)&&(e=e.trim())&&!vd(e))a(Cd(e),t);else if(E.isHeaders(e))for(const[o,l]of e.entries())i(l,o,r);else e!=null&&i(t,e,r);return this}get(e,t){if(e=Ut(e),e){const r=E.findKey(this,e);if(r){const s=this[r];if(!t)return s;if(t===!0)return xd(s);if(E.isFunction(t))return t.call(this,s,r);if(E.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ut(e),e){const r=E.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||qr(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let s=!1;function i(a){if(a=Ut(a),a){const o=E.findKey(r,a);o&&(!t||qr(r,r[o],o,t))&&(delete r[o],s=!0)}}return E.isArray(e)?e.forEach(i):i(e),s}clear(e){const t=Object.keys(this);let r=t.length,s=!1;for(;r--;){const i=t[r];(!e||qr(this,this[i],i,e,!0))&&(delete this[i],s=!0)}return s}normalize(e){const t=this,r={};return E.forEach(this,(s,i)=>{const a=E.findKey(r,i);if(a){t[a]=Nn(s),delete t[i];return}const o=e?Od(i):String(i).trim();o!==i&&delete t[i],t[o]=Nn(s),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return E.forEach(this,(r,s)=>{r!=null&&r!==!1&&(t[s]=e&&E.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[ta]=this[ta]={accessors:{}}).accessors,s=this.prototype;function i(a){const o=Ut(a);r[o]||(Td(s,a),r[o]=!0)}return E.isArray(e)?e.forEach(i):i(e),this}}ge.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);E.reduceDescriptors(ge.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});E.freezeMethods(ge);function Hr(n,e){const t=this||dn,r=e||t,s=ge.from(r.headers);let i=r.data;return E.forEach(n,function(o){i=o.call(t,i,s.normalize(),e?e.status:void 0)}),s.normalize(),i}function Nl(n){return!!(n&&n.__CANCEL__)}function Mt(n,e,t){B.call(this,n??"canceled",B.ERR_CANCELED,e,t),this.name="CanceledError"}E.inherits(Mt,B,{__CANCEL__:!0});function Fl(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new B("Request failed with status code "+t.status,[B.ERR_BAD_REQUEST,B.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Md(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Id(n,e){n=n||10;const t=new Array(n),r=new Array(n);let s=0,i=0,a;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),f=r[i];a||(a=c),t[s]=l,r[s]=c;let u=i,h=0;for(;u!==s;)h+=t[u++],u=u%n;if(s=(s+1)%n,s===i&&(i=(i+1)%n),c-a<e)return;const m=f&&c-f;return m?Math.round(h*1e3/m):void 0}}function Nd(n,e){let t=0,r=1e3/e,s,i;const a=(c,f=Date.now())=>{t=f,s=null,i&&(clearTimeout(i),i=null),n.apply(null,c)};return[(...c)=>{const f=Date.now(),u=f-t;u>=r?a(c,f):(s=c,i||(i=setTimeout(()=>{i=null,a(s)},r-u)))},()=>s&&a(s)]}const Gn=(n,e,t=3)=>{let r=0;const s=Id(50,250);return Nd(i=>{const a=i.loaded,o=i.lengthComputable?i.total:void 0,l=a-r,c=s(l),f=a<=o;r=a;const u={loaded:a,total:o,progress:o?a/o:void 0,bytes:l,rate:c||void 0,estimated:c&&o&&f?(o-a)/c:void 0,event:i,lengthComputable:o!=null,[e?"download":"upload"]:!0};n(u)},t)},na=(n,e)=>{const t=n!=null;return[r=>e[0]({lengthComputable:t,total:n,loaded:r}),e[1]]},ra=n=>(...e)=>E.asap(()=>n(...e)),Fd=ce.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,ce.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(ce.origin),ce.navigator&&/(msie|trident)/i.test(ce.navigator.userAgent)):()=>!0,Bd=ce.hasStandardBrowserEnv?{write(n,e,t,r,s,i){const a=[n+"="+encodeURIComponent(e)];E.isNumber(t)&&a.push("expires="+new Date(t).toGMTString()),E.isString(r)&&a.push("path="+r),E.isString(s)&&a.push("domain="+s),i===!0&&a.push("secure"),document.cookie=a.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Ld(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Dd(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Bl(n,e){return n&&!Ld(e)?Dd(n,e):e}const sa=n=>n instanceof ge?{...n}:n;function lt(n,e){e=e||{};const t={};function r(c,f,u,h){return E.isPlainObject(c)&&E.isPlainObject(f)?E.merge.call({caseless:h},c,f):E.isPlainObject(f)?E.merge({},f):E.isArray(f)?f.slice():f}function s(c,f,u,h){if(E.isUndefined(f)){if(!E.isUndefined(c))return r(void 0,c,u,h)}else return r(c,f,u,h)}function i(c,f){if(!E.isUndefined(f))return r(void 0,f)}function a(c,f){if(E.isUndefined(f)){if(!E.isUndefined(c))return r(void 0,c)}else return r(void 0,f)}function o(c,f,u){if(u in e)return r(c,f);if(u in n)return r(void 0,c)}const l={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(c,f,u)=>s(sa(c),sa(f),u,!0)};return E.forEach(Object.keys(Object.assign({},n,e)),function(f){const u=l[f]||s,h=u(n[f],e[f],f);E.isUndefined(h)&&u!==o||(t[f]=h)}),t}const Ll=n=>{const e=lt({},n);let{data:t,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:i,headers:a,auth:o}=e;e.headers=a=ge.from(a),e.url=Tl(Bl(e.baseURL,e.url),n.params,n.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let l;if(E.isFormData(t)){if(ce.hasStandardBrowserEnv||ce.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((l=a.getContentType())!==!1){const[c,...f]=l?l.split(";").map(u=>u.trim()).filter(Boolean):[];a.setContentType([c||"multipart/form-data",...f].join("; "))}}if(ce.hasStandardBrowserEnv&&(r&&E.isFunction(r)&&(r=r(e)),r||r!==!1&&Fd(e.url))){const c=s&&i&&Bd.read(i);c&&a.set(s,c)}return e},$d=typeof XMLHttpRequest<"u",Ud=$d&&function(n){return new Promise(function(t,r){const s=Ll(n);let i=s.data;const a=ge.from(s.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:c}=s,f,u,h,m,d;function g(){m&&m(),d&&d(),s.cancelToken&&s.cancelToken.unsubscribe(f),s.signal&&s.signal.removeEventListener("abort",f)}let p=new XMLHttpRequest;p.open(s.method.toUpperCase(),s.url,!0),p.timeout=s.timeout;function k(){if(!p)return;const w=ge.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders()),S={data:!o||o==="text"||o==="json"?p.responseText:p.response,status:p.status,statusText:p.statusText,headers:w,config:n,request:p};Fl(function(C){t(C),g()},function(C){r(C),g()},S),p=null}"onloadend"in p?p.onloadend=k:p.onreadystatechange=function(){!p||p.readyState!==4||p.status===0&&!(p.responseURL&&p.responseURL.indexOf("file:")===0)||setTimeout(k)},p.onabort=function(){p&&(r(new B("Request aborted",B.ECONNABORTED,n,p)),p=null)},p.onerror=function(){r(new B("Network Error",B.ERR_NETWORK,n,p)),p=null},p.ontimeout=function(){let y=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const S=s.transitional||Ml;s.timeoutErrorMessage&&(y=s.timeoutErrorMessage),r(new B(y,S.clarifyTimeoutError?B.ETIMEDOUT:B.ECONNABORTED,n,p)),p=null},i===void 0&&a.setContentType(null),"setRequestHeader"in p&&E.forEach(a.toJSON(),function(y,S){p.setRequestHeader(S,y)}),E.isUndefined(s.withCredentials)||(p.withCredentials=!!s.withCredentials),o&&o!=="json"&&(p.responseType=s.responseType),c&&([h,d]=Gn(c,!0),p.addEventListener("progress",h)),l&&p.upload&&([u,m]=Gn(l),p.upload.addEventListener("progress",u),p.upload.addEventListener("loadend",m)),(s.cancelToken||s.signal)&&(f=w=>{p&&(r(!w||w.type?new Mt(null,n,p):w),p.abort(),p=null)},s.cancelToken&&s.cancelToken.subscribe(f),s.signal&&(s.signal.aborted?f():s.signal.addEventListener("abort",f)));const _=Md(s.url);if(_&&ce.protocols.indexOf(_)===-1){r(new B("Unsupported protocol "+_+":",B.ERR_BAD_REQUEST,n));return}p.send(i||null)})},jd=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let r=new AbortController,s;const i=function(c){if(!s){s=!0,o();const f=c instanceof Error?c:this.reason;r.abort(f instanceof B?f:new Mt(f instanceof Error?f.message:f))}};let a=e&&setTimeout(()=>{a=null,i(new B(`timeout ${e} of ms exceeded`,B.ETIMEDOUT))},e);const o=()=>{n&&(a&&clearTimeout(a),a=null,n.forEach(c=>{c.unsubscribe?c.unsubscribe(i):c.removeEventListener("abort",i)}),n=null)};n.forEach(c=>c.addEventListener("abort",i));const{signal:l}=r;return l.unsubscribe=()=>E.asap(o),l}},qd=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let r=0,s;for(;r<t;)s=r+e,yield n.slice(r,s),r=s},Hd=async function*(n,e){for await(const t of zd(n))yield*qd(t,e)},zd=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},ia=(n,e,t,r)=>{const s=Hd(n,e);let i=0,a,o=l=>{a||(a=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:c,value:f}=await s.next();if(c){o(),l.close();return}let u=f.byteLength;if(t){let h=i+=u;t(h)}l.enqueue(new Uint8Array(f))}catch(c){throw o(c),c}},cancel(l){return o(l),s.return()}},{highWaterMark:2})},pr=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Dl=pr&&typeof ReadableStream=="function",Wd=pr&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),$l=(n,...e)=>{try{return!!n(...e)}catch{return!1}},Vd=Dl&&$l(()=>{let n=!1;const e=new Request(ce.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),aa=64*1024,ps=Dl&&$l(()=>E.isReadableStream(new Response("").body)),Qn={stream:ps&&(n=>n.body)};pr&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Qn[e]&&(Qn[e]=E.isFunction(n[e])?t=>t[e]():(t,r)=>{throw new B(`Response type '${e}' is not supported`,B.ERR_NOT_SUPPORT,r)})})})(new Response);const Jd=async n=>{if(n==null)return 0;if(E.isBlob(n))return n.size;if(E.isSpecCompliantForm(n))return(await new Request(ce.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(E.isArrayBufferView(n)||E.isArrayBuffer(n))return n.byteLength;if(E.isURLSearchParams(n)&&(n=n+""),E.isString(n))return(await Wd(n)).byteLength},Xd=async(n,e)=>{const t=E.toFiniteNumber(n.getContentLength());return t??Jd(e)},Kd=pr&&(async n=>{let{url:e,method:t,data:r,signal:s,cancelToken:i,timeout:a,onDownloadProgress:o,onUploadProgress:l,responseType:c,headers:f,withCredentials:u="same-origin",fetchOptions:h}=Ll(n);c=c?(c+"").toLowerCase():"text";let m=jd([s,i&&i.toAbortSignal()],a),d;const g=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let p;try{if(l&&Vd&&t!=="get"&&t!=="head"&&(p=await Xd(f,r))!==0){let S=new Request(e,{method:"POST",body:r,duplex:"half"}),P;if(E.isFormData(r)&&(P=S.headers.get("content-type"))&&f.setContentType(P),S.body){const[C,T]=na(p,Gn(ra(l)));r=ia(S.body,aa,C,T)}}E.isString(u)||(u=u?"include":"omit");const k="credentials"in Request.prototype;d=new Request(e,{...h,signal:m,method:t.toUpperCase(),headers:f.normalize().toJSON(),body:r,duplex:"half",credentials:k?u:void 0});let _=await fetch(d);const w=ps&&(c==="stream"||c==="response");if(ps&&(o||w&&g)){const S={};["status","statusText","headers"].forEach(I=>{S[I]=_[I]});const P=E.toFiniteNumber(_.headers.get("content-length")),[C,T]=o&&na(P,Gn(ra(o),!0))||[];_=new Response(ia(_.body,aa,C,()=>{T&&T(),g&&g()}),S)}c=c||"text";let y=await Qn[E.findKey(Qn,c)||"text"](_,n);return!w&&g&&g(),await new Promise((S,P)=>{Fl(S,P,{data:y,headers:ge.from(_.headers),status:_.status,statusText:_.statusText,config:n,request:d})})}catch(k){throw g&&g(),k&&k.name==="TypeError"&&/fetch/i.test(k.message)?Object.assign(new B("Network Error",B.ERR_NETWORK,n,d),{cause:k.cause||k}):B.from(k,k&&k.code,n,d)}}),gs={http:ud,xhr:Ud,fetch:Kd};E.forEach(gs,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const oa=n=>`- ${n}`,Gd=n=>E.isFunction(n)||n===null||n===!1,Ul={getAdapter:n=>{n=E.isArray(n)?n:[n];const{length:e}=n;let t,r;const s={};for(let i=0;i<e;i++){t=n[i];let a;if(r=t,!Gd(t)&&(r=gs[(a=String(t)).toLowerCase()],r===void 0))throw new B(`Unknown adapter '${a}'`);if(r)break;s[a||"#"+i]=r}if(!r){const i=Object.entries(s).map(([o,l])=>`adapter ${o} `+(l===!1?"is not supported by the environment":"is not available in the build"));let a=e?i.length>1?`since :
`+i.map(oa).join(`
`):" "+oa(i[0]):"as no adapter specified";throw new B("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return r},adapters:gs};function zr(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Mt(null,n)}function la(n){return zr(n),n.headers=ge.from(n.headers),n.data=Hr.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Ul.getAdapter(n.adapter||dn.adapter)(n).then(function(r){return zr(n),r.data=Hr.call(n,n.transformResponse,r),r.headers=ge.from(r.headers),r},function(r){return Nl(r)||(zr(n),r&&r.response&&(r.response.data=Hr.call(n,n.transformResponse,r.response),r.response.headers=ge.from(r.response.headers))),Promise.reject(r)})}const jl="1.7.9",gr={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{gr[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const ca={};gr.transitional=function(e,t,r){function s(i,a){return"[Axios v"+jl+"] Transitional option '"+i+"'"+a+(r?". "+r:"")}return(i,a,o)=>{if(e===!1)throw new B(s(a," has been removed"+(t?" in "+t:"")),B.ERR_DEPRECATED);return t&&!ca[a]&&(ca[a]=!0,console.warn(s(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,a,o):!0}};gr.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function Qd(n,e,t){if(typeof n!="object")throw new B("options must be an object",B.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let s=r.length;for(;s-- >0;){const i=r[s],a=e[i];if(a){const o=n[i],l=o===void 0||a(o,i,n);if(l!==!0)throw new B("option "+i+" must be "+l,B.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new B("Unknown option "+i,B.ERR_BAD_OPTION)}}const Fn={assertOptions:Qd,validators:gr},Le=Fn.validators;class at{constructor(e){this.defaults=e,this.interceptors={request:new ea,response:new ea}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=lt(this.defaults,t);const{transitional:r,paramsSerializer:s,headers:i}=t;r!==void 0&&Fn.assertOptions(r,{silentJSONParsing:Le.transitional(Le.boolean),forcedJSONParsing:Le.transitional(Le.boolean),clarifyTimeoutError:Le.transitional(Le.boolean)},!1),s!=null&&(E.isFunction(s)?t.paramsSerializer={serialize:s}:Fn.assertOptions(s,{encode:Le.function,serialize:Le.function},!0)),Fn.assertOptions(t,{baseUrl:Le.spelling("baseURL"),withXsrfToken:Le.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&E.merge(i.common,i[t.method]);i&&E.forEach(["delete","get","head","post","put","patch","common"],d=>{delete i[d]}),t.headers=ge.concat(a,i);const o=[];let l=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(t)===!1||(l=l&&g.synchronous,o.unshift(g.fulfilled,g.rejected))});const c=[];this.interceptors.response.forEach(function(g){c.push(g.fulfilled,g.rejected)});let f,u=0,h;if(!l){const d=[la.bind(this),void 0];for(d.unshift.apply(d,o),d.push.apply(d,c),h=d.length,f=Promise.resolve(t);u<h;)f=f.then(d[u++],d[u++]);return f}h=o.length;let m=t;for(u=0;u<h;){const d=o[u++],g=o[u++];try{m=d(m)}catch(p){g.call(this,p);break}}try{f=la.call(this,m)}catch(d){return Promise.reject(d)}for(u=0,h=c.length;u<h;)f=f.then(c[u++],c[u++]);return f}getUri(e){e=lt(this.defaults,e);const t=Bl(e.baseURL,e.url);return Tl(t,e.params,e.paramsSerializer)}}E.forEach(["delete","get","head","options"],function(e){at.prototype[e]=function(t,r){return this.request(lt(r||{},{method:e,url:t,data:(r||{}).data}))}});E.forEach(["post","put","patch"],function(e){function t(r){return function(i,a,o){return this.request(lt(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}at.prototype[e]=t(),at.prototype[e+"Form"]=t(!0)});class ai{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(s=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](s);r._listeners=null}),this.promise.then=s=>{let i;const a=new Promise(o=>{r.subscribe(o),i=o}).then(s);return a.cancel=function(){r.unsubscribe(i)},a},e(function(i,a,o){r.reason||(r.reason=new Mt(i,a,o),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new ai(function(s){e=s}),cancel:e}}}function Yd(n){return function(t){return n.apply(null,t)}}function Zd(n){return E.isObject(n)&&n.isAxiosError===!0}const _s={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(_s).forEach(([n,e])=>{_s[e]=n});function ql(n){const e=new at(n),t=bl(at.prototype.request,e);return E.extend(t,at.prototype,e,{allOwnKeys:!0}),E.extend(t,e,null,{allOwnKeys:!0}),t.create=function(s){return ql(lt(n,s))},t}const ee=ql(dn);ee.Axios=at;ee.CanceledError=Mt;ee.CancelToken=ai;ee.isCancel=Nl;ee.VERSION=jl;ee.toFormData=mr;ee.AxiosError=B;ee.Cancel=ee.CanceledError;ee.all=function(e){return Promise.all(e)};ee.spread=Yd;ee.isAxiosError=Zd;ee.mergeConfig=lt;ee.AxiosHeaders=ge;ee.formToJSON=n=>Il(E.isHTMLForm(n)?new FormData(n):n);ee.getAdapter=Ul.getAdapter;ee.HttpStatusCode=_s;ee.default=ee;async function ua(n){if(!n||n.length==0)return[0,0];const e={method:"POST",url:atob("aHR0cHM6Ly9hcGkuZ2Vla3NwaGVyZS5vbmxpbmUvYWRtaW4tYXBpL2FpZ2MvYmFsYW5jZS90b2tlbg=="),headers:{"content-type":"application/json"},data:{apikey:n.replace("sk-","")}};let t=await ee.request(e);return!t||t.status!=200?[0,0]:t.data.data}function eh(n){let e,t,r,s,i,a,o,l,c,f,u=new Date(n[2]).toLocaleString()+"",h,m,d,g,p,k,_;return{c(){e=R("label"),t=R("div"),r=R("span"),r.textContent="余额查询",s=O(),i=R("div"),a=le("账 户 余 额 : "),o=le(n[1]),l=le(` ¥
            `),c=R("br"),f=le(` 
            有 效 期 : `),h=le(u),m=O(),d=R("span"),g=O(),p=R("button"),p.textContent="刷新",A(r,"class","title"),A(i,"class","b3-label__text"),A(t,"class","fn__flex-1"),A(d,"class","fn__space"),A(p,"class","b3-button b3-button--outline fn__flex-center fn__size200"),A(e,"class","item-wrap fn__flex b3-label config__item")},m(w,y){q(w,e,y),b(e,t),b(t,r),b(t,s),b(t,i),b(i,a),b(i,o),b(i,l),b(i,c),b(i,f),b(i,h),b(e,m),b(e,d),b(e,g),b(e,p),k||(_=H(p,"click",n[3]),k=!0)},p(w,[y]){y&2&&Ie(o,w[1]),y&4&&u!==(u=new Date(w[2]).toLocaleString()+"")&&Ie(h,u)},i:Z,o:Z,d(w){w&&U(e),k=!1,_()}}}function th(n,e,t){let{apiKey:r}=e,s=0,i=0;Ba(()=>{ua(r).then(o=>{t(1,s=Math.round(o.money*10)/10),t(2,i=o.expiredTime*1e3)})});const a=async()=>{ua(r).then(o=>{t(2,i=o.expiredTime*1e3),t(1,s=Math.round(o.money*10)/10)})};return n.$$set=o=>{"apiKey"in o&&t(0,r=o.apiKey)},[r,s,i,a]}let nh=class extends he{constructor(e){super(),de(this,e,th,eh,fe,{apiKey:0})}};function fa(n,e,t){const r=n.slice();return r[11]=e[t],r[12]=e,r[13]=t,r}function rh(n){var a,o,l,c;let e,t,r;function s(f){n[8](f,n[11])}let i={type:n[11].type,key:n[11].key,placeholder:(a=n[11])==null?void 0:a.placeholder,options:(o=n[11])==null?void 0:o.options,slider:(l=n[11])==null?void 0:l.slider,button:(c=n[11])==null?void 0:c.button};return n[11].value!==void 0&&(i.value=n[11].value),e=new yl.Input({props:i}),ie.push(()=>Pe(e,"value",s)),e.$on("click",n[4]),e.$on("changed",n[5]),{c(){Y(e.$$.fragment)},m(f,u){G(e,f,u),r=!0},p(f,u){var m,d,g,p;n=f;const h={};u&4&&(h.type=n[11].type),u&4&&(h.key=n[11].key),u&4&&(h.placeholder=(m=n[11])==null?void 0:m.placeholder),u&4&&(h.options=(d=n[11])==null?void 0:d.options),u&4&&(h.slider=(g=n[11])==null?void 0:g.slider),u&4&&(h.button=(p=n[11])==null?void 0:p.button),!t&&u&4&&(t=!0,h.value=n[11].value,ke(()=>t=!1)),e.$set(h)},i(f){r||(F(e.$$.fragment,f),r=!0)},o(f){L(e.$$.fragment,f),r=!1},d(f){Q(e,f)}}}function da(n,e){var i;let t,r,s;return r=new yl.Wrap({props:{title:e[11].title,description:e[11].description,direction:(i=e[11])==null?void 0:i.direction,$$slots:{default:[rh]},$$scope:{ctx:e}}}),{key:n,first:null,c(){t=As(),Y(r.$$.fragment),this.first=t},m(a,o){q(a,t,o),G(r,a,o),s=!0},p(a,o){var c;e=a;const l={};o&4&&(l.title=e[11].title),o&4&&(l.description=e[11].description),o&4&&(l.direction=(c=e[11])==null?void 0:c.direction),o&516&&(l.$$scope={dirty:o,ctx:e}),r.$set(l)},i(a){s||(F(r.$$.fragment,a),s=!0)},o(a){L(r.$$.fragment,a),s=!1},d(a){a&&U(t),Q(r,a)}}}function ha(n){let e,t;return e=new nh({props:{apiKey:n[1].getValue("apiKey")}}),{c(){Y(e.$$.fragment)},m(r,s){G(e,r,s),t=!0},p(r,s){const i={};s&2&&(i.apiKey=r[1].getValue("apiKey")),e.$set(i)},i(r){t||(F(e.$$.fragment,r),t=!0)},o(r){L(e.$$.fragment,r),t=!1},d(r){Q(e,r)}}}function sh(n){let e,t,r=[],s=new Map,i,a,o;const l=n[7].default,c=ys(l,n,n[9],null);let f=xe(n[2]);const u=m=>m[11].key;for(let m=0;m<f.length;m+=1){let d=fa(n,f,m),g=u(d);s.set(g,r[m]=da(g,d))}let h=n[0]==="🌈 设置"&&ha(n);return{c(){e=R("div"),c&&c.c(),t=O();for(let m=0;m<r.length;m+=1)r[m].c();i=O(),h&&h.c(),A(e,"class",a="config__tab-container "+n[3]),A(e,"data-name",n[0])},m(m,d){q(m,e,d),c&&c.m(e,null),b(e,t);for(let g=0;g<r.length;g+=1)r[g]&&r[g].m(e,null);b(e,i),h&&h.m(e,null),o=!0},p(m,[d]){c&&c.p&&(!o||d&512)&&ws(c,l,m,m[9],o?bs(l,m[9],d,null):Ss(m[9]),null),d&52&&(f=xe(m[2]),st(),r=Da(r,d,u,1,m,f,s,e,bc,da,i,fa),it()),m[0]==="🌈 设置"?h?(h.p(m,d),d&1&&F(h,1)):(h=ha(m),h.c(),F(h,1),h.m(e,null)):h&&(st(),L(h,1,1,()=>{h=null}),it()),(!o||d&8&&a!==(a="config__tab-container "+m[3]))&&A(e,"class",a),(!o||d&1)&&A(e,"data-name",m[0])},i(m){if(!o){F(c,m);for(let d=0;d<f.length;d+=1)F(r[d]);F(h),o=!0}},o(m){L(c,m);for(let d=0;d<r.length;d+=1)L(r[d]);L(h),o=!1},d(m){m&&U(e),c&&c.d(m);for(let d=0;d<r.length;d+=1)r[d].d();h&&h.d()}}}function ih(n,e,t){let r,{$$slots:s={},$$scope:i}=e,{group:a}=e,{settingStorage:o}=e,{display:l=!0}=e,c=o.getSettingItems(a);const f=Zn();function u({detail:d}){f("click",{key:d.key})}function h({detail:d}){f("changed",{group:a,...d})}function m(d,g){n.$$.not_equal(g.value,d)&&(g.value=d,t(2,c))}return n.$$set=d=>{"group"in d&&t(0,a=d.group),"settingStorage"in d&&t(1,o=d.settingStorage),"display"in d&&t(6,l=d.display),"$$scope"in d&&t(9,i=d.$$scope)},n.$$.update=()=>{n.$$.dirty&64&&t(3,r=l?"":"fn__none")},[a,o,c,r,u,h,l,s,m,i]}class Hl extends he{constructor(e){super(),de(this,e,ih,sh,fe,{group:0,settingStorage:1,display:6})}}function ah(n){let e,t,r;return t=new Hl({props:{group:"custom",settingStorage:n[0],display:!0}}),t.$on("changed",n[1]),{c(){e=R("div"),Y(t.$$.fragment),x(e,"margin-top","10px"),x(e,"padding","10px"),x(e,"background","none"),x(e,"border-radius","4px"),x(e,"border","1px solid var(--b3-border-color)")},m(s,i){q(s,e,i),G(t,e,null),r=!0},p(s,[i]){const a={};i&1&&(a.settingStorage=s[0]),t.$set(a)},i(s){r||(F(t.$$.fragment,s),r=!0)},o(s){L(t.$$.fragment,s),r=!1},d(s){s&&U(e),Q(t)}}}function oh(n,e,t){let{settingStorage:r}=e;const s=({detail:i})=>{r.setValue(i.key,i.value),r.save()};return n.$$set=i=>{"settingStorage"in i&&t(0,r=i.settingStorage)},[r,s]}class lh extends he{constructor(e){super(),de(this,e,oh,ah,fe,{settingStorage:0})}}function ch(){var t;let n=((t=window.getSelection())==null?void 0:t.toString())||"";return n||(document.querySelectorAll(".protyle-wysiwyg--select").forEach(r=>{const s=r.textContent;n+=`
`+s}),n)}function uh(){let n="",e="";return n=document.getElementsByClassName("protyle-title__input")[0].textContent,document.querySelectorAll("[data-node-index]").forEach(r=>{e+=r.textContent+`
`}),{title:n,content:e}}async function fh(n){const e=document.querySelectorAll(".protyle-wysiwyg--select");if(e.length===0){console.warn("没有选中的内容");return}let r=e[e.length-1].getAttribute("data-node-id");if(!r){console.warn("无法获取节点ID");return}const s=await Vl("markdown","",r);for(const i of e)await Xl(i.getAttribute("data-node-id"));await Jl("markdown",n,s[0].doOperations[0].id)}async function dh(n,e,t,r,s){let i="";const a=await n.messages.stream({model:e,max_tokens:t,messages:r});for await(const o of a)if(o.type==="content_block_delta"){const l="text"in o.delta?o.delta.text:o.delta.toString();i+=l,s(i)}return i}async function hh(n,e,t,r,s,i){var l,c,f;let a="";const o=await n.chat.completions.create({model:e,max_tokens:t,temperature:r,stream:!0,messages:s});for await(const u of o)if((f=(c=(l=u.choices)==null?void 0:l[0])==null?void 0:c.delta)!=null&&f.content){const h=u.choices[0].delta.content;a+=h,i(a)}return a}async function mh(n,e=!1,t=!1){if(window.focus(),await navigator.clipboard.writeText(n),e&&t){fh(n);return}Ra("生成内容已自动复制到剪贴板")}async function ph(n,e,t,r,s,i,a){var l,c;let o="";try{const f=(l=r.get("maxOutputLength"))==null?void 0:l.value;switch(!0){case t.includes("claude"):o=await dh(e,t,f,s,a);break;default:const u=(c=r.get("temperature"))==null?void 0:c.value;o=await hh(n,t,f,u,s,a);break}return o}catch(f){console.error("生成回答时出错:",f);const u=`
生成回答时出错: `+f.message;return o+=u,a(o),o}finally{await mh(o,i,r.getValue("isReplaceSelected"))}}function gh(n){let e,t,r,s,i,a=[{type:"button"},n[4],{class:r=["b3-button",n[3],n[2]].join(" ")},{style:n[1]}],o={};for(let l=0;l<a.length;l+=1)o=Bn(o,a[l]);return{c(){e=R("button"),t=le(n[0]),hi(e,o)},m(l,c){q(l,e,c),b(e,t),e.autofocus&&e.focus(),s||(i=H(e,"click",n[8]),s=!0)},p(l,[c]){c&1&&ic(t,l[0],o.contenteditable),hi(e,o=wc(a,[{type:"button"},c&16&&l[4],c&12&&r!==(r=["b3-button",l[3],l[2]].join(" "))&&{class:r},c&2&&{style:l[1]}]))},i:Z,o:Z,d(l){l&&U(e),s=!1,i()}}}function _h(n,e,t){let r,s,i,{text:a=!1}=e,{outline:o=!1}=e,{backgroundColor:l=void 0}=e,{label:c=""}=e;function f(u){fc.call(this,n,u)}return n.$$set=u=>{t(4,e=Bn(Bn({},e),di(u))),"text"in u&&t(5,a=u.text),"outline"in u&&t(6,o=u.outline),"backgroundColor"in u&&t(7,l=u.backgroundColor),"label"in u&&t(0,c=u.label)},n.$$.update=()=>{n.$$.dirty&64&&t(3,r=o?"b3-button--outline":""),n.$$.dirty&32&&t(2,s=a?"b3-button--text":""),n.$$.dirty&128&&t(1,i=l?`background-color: ${l}`:"")},e=di(e),[c,i,s,r,e,a,o,l,f]}class Yn extends he{constructor(e){super(),de(this,e,_h,gh,fe,{text:5,outline:6,backgroundColor:7,label:0})}}function yh(n){let e,t,r,s=n[1].title?"编辑提示词":"新增提示词",i,a,o,l,c,f,u,h,m,d,g,p,k,_,w;function y(T){n[3](T)}let S={type:"textinput",placeholder:"标题",key:"title",style:"width: 100%; margin-bottom: 10px;"};n[1].title!==void 0&&(S.value=n[1].title),o=new Xn({props:S}),ie.push(()=>Pe(o,"value",y));function P(T){n[4](T)}let C={type:"textarea",placeholder:"内容",key:"content",style:"width: 100%; white-space: pre-wrap; word-wrap: break-word;"};return n[1].content!==void 0&&(C.value=n[1].content),f=new Xn({props:C}),ie.push(()=>Pe(f,"value",P)),d=new Yn({props:{label:"取消",text:!0,outline:!0}}),d.$on("click",n[5]),_=new Yn({props:{label:"确认",text:!1,outline:!1}}),_.$on("click",n[6]),{c(){e=R("div"),t=R("div"),r=R("h3"),i=le(s),a=O(),Y(o.$$.fragment),c=O(),Y(f.$$.fragment),h=O(),m=R("div"),Y(d.$$.fragment),g=O(),p=R("div"),k=O(),Y(_.$$.fragment),A(r,"class","b3-label"),A(p,"class","fn__space"),A(m,"class","b3-dialog__action"),A(t,"class","edit-content svelte-1ftxwb0"),A(e,"class","edit-panel svelte-1ftxwb0")},m(T,I){q(T,e,I),b(e,t),b(t,r),b(r,i),b(t,a),G(o,t,null),b(t,c),G(f,t,null),b(t,h),b(t,m),G(d,m,null),b(m,g),b(m,p),b(m,k),G(_,m,null),w=!0},p(T,[I]){(!w||I&2)&&s!==(s=T[1].title?"编辑提示词":"新增提示词")&&Ie(i,s);const N={};!l&&I&2&&(l=!0,N.value=T[1].title,ke(()=>l=!1)),o.$set(N);const v={};!u&&I&2&&(u=!0,v.value=T[1].content,ke(()=>u=!1)),f.$set(v)},i(T){w||(F(o.$$.fragment,T),F(f.$$.fragment,T),F(d.$$.fragment,T),F(_.$$.fragment,T),w=!0)},o(T){L(o.$$.fragment,T),L(f.$$.fragment,T),L(d.$$.fragment,T),L(_.$$.fragment,T),w=!1},d(T){T&&U(e),Q(o),Q(f),Q(d),Q(_)}}}function bh(n,e,t){let{showEditPanel:r=!1}=e,{currentPrompt:s}=e;const i=Zn();function a(f){n.$$.not_equal(s.title,f)&&(s.title=f,t(1,s))}function o(f){n.$$.not_equal(s.content,f)&&(s.content=f,t(1,s))}const l=()=>t(0,r=!1),c=()=>i("save");return n.$$set=f=>{"showEditPanel"in f&&t(0,r=f.showEditPanel),"currentPrompt"in f&&t(1,s=f.currentPrompt)},[r,s,i,a,o,l,c]}class wh extends he{constructor(e){super(),de(this,e,bh,yh,fe,{showEditPanel:0,currentPrompt:1})}}function ma(n,e,t){const r=n.slice();return r[5]=e[t],r}function pa(n,e){let t,r,s,i=e[5].title+"",a,o,l,c,f,u,h,m,d,g,p;function k(){return e[2](e[5])}function _(){return e[3](e[5])}function w(){return e[4](e[5])}return{key:n,first:null,c(){t=R("div"),r=R("div"),s=R("span"),a=le(i),o=O(),l=R("div"),c=R("button"),c.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconTrashcan"></use></svg>',f=O(),u=R("button"),u.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconEdit"></use></svg>',h=O(),m=R("button"),m.innerHTML='<svg class="b3-list-item__hinticon" style="width: 1.5em;"><use xlink:href="#iconPlay"></use></svg>',d=O(),A(s,"class","title"),A(r,"class","fn__flex-1"),A(c,"class","b3-list-item"),A(c,"title","删除"),A(u,"class","b3-list-item"),A(u,"title","编辑"),A(m,"class","b3-list-item"),A(m,"title","使用"),A(l,"class","fn__flex"),A(t,"class","item-wrap fn__flex b3-label config__item"),x(t,"height","1.5em"),this.first=t},m(y,S){q(y,t,S),b(t,r),b(r,s),b(s,a),b(t,o),b(t,l),b(l,c),b(l,f),b(l,u),b(l,h),b(l,m),b(t,d),g||(p=[H(c,"click",k),H(u,"click",_),H(m,"click",w)],g=!0)},p(y,S){e=y,S&1&&i!==(i=e[5].title+"")&&Ie(a,i)},d(y){y&&U(t),g=!1,ae(p)}}}function Sh(n){let e,t=[],r=new Map,s=xe(n[0]);const i=a=>a[5].id;for(let a=0;a<s.length;a+=1){let o=ma(n,s,a),l=i(o);r.set(l,t[a]=pa(l,o))}return{c(){e=R("div");for(let a=0;a<t.length;a+=1)t[a].c();A(e,"class","b3-tab-bar b3-list b3-list--background")},m(a,o){q(a,e,o);for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(e,null)},p(a,[o]){o&3&&(s=xe(a[0]),t=Da(t,o,i,1,a,s,r,e,yc,pa,null,ma))},i:Z,o:Z,d(a){a&&U(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function Eh(n,e,t){const r=Zn();let{prompts:s}=e;const i=l=>r("delete",l.id),a=l=>r("edit",l),o=l=>r("use",l);return n.$$set=l=>{"prompts"in l&&t(0,s=l.prompts)},[s,r,i,a,o]}class Ah extends he{constructor(e){super(),de(this,e,Eh,Sh,fe,{prompts:0})}}function ga(n){let e,t,r,s;function i(l){n[14](l)}function a(l){n[15](l)}let o={};return n[0]!==void 0&&(o.showEditPanel=n[0]),n[1]!==void 0&&(o.currentPrompt=n[1]),e=new wh({props:o}),ie.push(()=>Pe(e,"showEditPanel",i)),ie.push(()=>Pe(e,"currentPrompt",a)),e.$on("save",n[6]),{c(){Y(e.$$.fragment)},m(l,c){G(e,l,c),s=!0},p(l,c){const f={};!t&&c&1&&(t=!0,f.showEditPanel=l[0],ke(()=>t=!1)),!r&&c&2&&(r=!0,f.currentPrompt=l[1],ke(()=>r=!1)),e.$set(f)},i(l){s||(F(e.$$.fragment,l),s=!0)},o(l){L(e.$$.fragment,l),s=!1},d(l){Q(e,l)}}}function kh(n){let e,t,r,s,i,a,o,l;s=new Ah({props:{prompts:n[2]}}),s.$on("edit",n[11]),s.$on("delete",n[12]),s.$on("use",n[13]);let c=n[0]&&ga(n);return{c(){e=R("div"),t=R("button"),t.textContent="+ 新建 Prompt",r=O(),Y(s.$$.fragment),i=O(),c&&c.c(),A(t,"class","add-prompt-btn"),x(t,"width","90%"),x(t,"margin","8px auto"),x(t,"display","block"),x(t,"padding","4px 8px"),x(t,"border-radius","4px"),x(t,"border","none"),x(t,"cursor","pointer"),x(t,"background","var(--b3-theme-surface)"),x(e,"background","none"),x(e,"border-radius","4px"),x(e,"max-height","300px"),x(e,"overflow-y","auto")},m(f,u){q(f,e,u),b(e,t),b(e,r),G(s,e,null),b(e,i),c&&c.m(e,null),a=!0,o||(l=H(t,"click",n[10]),o=!0)},p(f,[u]){const h={};u&4&&(h.prompts=f[2]),s.$set(h),f[0]?c?(c.p(f,u),u&1&&F(c,1)):(c=ga(f),c.c(),F(c,1),c.m(e,null)):c&&(st(),L(c,1,1,()=>{c=null}),it())},i(f){a||(F(s.$$.fragment,f),F(c),a=!0)},o(f){L(s.$$.fragment,f),L(c),a=!1},d(f){f&&U(e),Q(s),c&&c.d(),o=!1,l()}}}function Ph(n,e,t){let r,{promptStorage:s}=e,{searchText:i}=e,a=!1,o={id:Date.now(),title:"",content:""},l=s.prompts;function c(w){s.deletePrompt(w),t(9,l=s.prompts)}function f(w){w?t(1,o={...w}):t(1,o={id:Date.now(),title:"",content:""}),t(0,a=!0)}function u(w){t(7,i=w.content)}function h(){l.findIndex(y=>y.id===o.id)===-1?s.addPrompt(o):s.updatePrompt(o),s.save(l),t(0,a=!1),t(9,l=s.prompts)}const m=()=>f(),d=w=>f(w.detail),g=w=>c(w.detail),p=w=>u(w.detail);function k(w){a=w,t(0,a)}function _(w){o=w,t(1,o)}return n.$$set=w=>{"promptStorage"in w&&t(8,s=w.promptStorage),"searchText"in w&&t(7,i=w.searchText)},n.$$.update=()=>{n.$$.dirty&640&&t(2,r=l.filter(w=>w.title.toLowerCase().includes(i.toLowerCase())||w.content.toLowerCase().includes(i.toLowerCase())))},[a,o,r,c,f,u,h,i,s,l,m,d,g,p,k,_]}class Rh extends he{constructor(e){super(),de(this,e,Ph,kh,fe,{promptStorage:8,searchText:7})}}function _a(n){let e,t,r;function s(a){n[17](a)}let i={outputContent:n[7],isGenerating:n[8]};return n[9]!==void 0&&(i.outputContainer=n[9]),e=new of({props:i}),ie.push(()=>Pe(e,"outputContainer",s)),{c(){Y(e.$$.fragment)},m(a,o){G(e,a,o),r=!0},p(a,o){const l={};o&128&&(l.outputContent=a[7]),o&256&&(l.isGenerating=a[8]),!t&&o&512&&(t=!0,l.outputContainer=a[9],ke(()=>t=!1)),e.$set(l)},i(a){r||(F(e.$$.fragment,a),r=!0)},o(a){L(e.$$.fragment,a),r=!1},d(a){Q(e,a)}}}function ya(n){let e,t;return e=new lh({props:{settingStorage:n[1]}}),{c(){Y(e.$$.fragment)},m(r,s){G(e,r,s),t=!0},p(r,s){const i={};s&2&&(i.settingStorage=r[1]),e.$set(i)},i(r){t||(F(e.$$.fragment,r),t=!0)},o(r){L(e.$$.fragment,r),t=!1},d(r){Q(e,r)}}}function ba(n){let e,t,r,s;function i(l){n[22](l)}function a(l){n[23](l)}let o={};return n[3]!==void 0&&(o.searchText=n[3]),n[0]!==void 0&&(o.promptStorage=n[0]),e=new Rh({props:o}),ie.push(()=>Pe(e,"searchText",i)),ie.push(()=>Pe(e,"promptStorage",a)),{c(){Y(e.$$.fragment)},m(l,c){G(e,l,c),s=!0},p(l,c){const f={};!t&&c&8&&(t=!0,f.searchText=l[3],ke(()=>t=!1)),!r&&c&1&&(r=!0,f.promptStorage=l[0],ke(()=>r=!1)),e.$set(f)},i(l){s||(F(e.$$.fragment,l),s=!0)},o(l){L(e.$$.fragment,l),s=!1},d(l){Q(e,l)}}}function Ch(n){let e,t,r,s,i,a,o,l,c,f,u,h=n[6]&&_a(n);function m(y){n[18](y)}function d(y){n[19](y)}function g(y){n[20](y)}function p(y){n[21](y)}let k={settingStorage:n[1],handleSubmit:n[11],handleKeydown:n[12]};n[3]!==void 0&&(k.inputValue=n[3]),n[4]!==void 0&&(k.inputElement=n[4]),n[5]!==void 0&&(k.selectedModel=n[5]),n[2]!==void 0&&(k.showParams=n[2]),r=new bf({props:k}),ie.push(()=>Pe(r,"inputValue",m)),ie.push(()=>Pe(r,"inputElement",d)),ie.push(()=>Pe(r,"selectedModel",g)),ie.push(()=>Pe(r,"showParams",p));let _=n[2]&&ya(n),w=n[10]&&ba(n);return{c(){e=R("div"),h&&h.c(),t=O(),Y(r.$$.fragment),l=O(),c=R("div"),_&&_.c(),f=O(),w&&w.c(),x(c,"width","100%"),x(e,"width","100%")},m(y,S){q(y,e,S),h&&h.m(e,null),b(e,t),G(r,e,null),b(e,l),b(e,c),_&&_.m(c,null),b(c,f),w&&w.m(c,null),u=!0},p(y,[S]){y[6]?h?(h.p(y,S),S&64&&F(h,1)):(h=_a(y),h.c(),F(h,1),h.m(e,t)):h&&(st(),L(h,1,1,()=>{h=null}),it());const P={};S&2&&(P.settingStorage=y[1]),!s&&S&8&&(s=!0,P.inputValue=y[3],ke(()=>s=!1)),!i&&S&16&&(i=!0,P.inputElement=y[4],ke(()=>i=!1)),!a&&S&32&&(a=!0,P.selectedModel=y[5],ke(()=>a=!1)),!o&&S&4&&(o=!0,P.showParams=y[2],ke(()=>o=!1)),r.$set(P),y[2]?_?(_.p(y,S),S&4&&F(_,1)):(_=ya(y),_.c(),F(_,1),_.m(c,f)):_&&(st(),L(_,1,1,()=>{_=null}),it()),y[10]?w?(w.p(y,S),S&1024&&F(w,1)):(w=ba(y),w.c(),F(w,1),w.m(c,null)):w&&(st(),L(w,1,1,()=>{w=null}),it())},i(y){u||(F(h),F(r.$$.fragment,y),F(_),F(w),u=!0)},o(y){L(h),L(r.$$.fragment,y),L(_),L(w),u=!1},d(y){y&&U(e),h&&h.d(),Q(r),_&&_.d(),w&&w.d()}}}function xh(n,e,t){let r,{openai:s}=e,{claude:i}=e,{settingStorage:a}=e,{promptStorage:o}=e,{selectedText:l}=e,{pageContent:c}=e,f="",u,h=!1,m=a.getValue("modelSelections"),d=!1,g="",p=!1,k;async function _(){t(6,d=!0),t(8,p=!0),t(7,g="");let v=[];const we=l.trim().length>0;we?v.push({role:"user",content:`文本:${l}

指令:${f}`}):a.getValue("isPageContent")?v.push({role:"user",content:`标题:${c.title}

内容:${c.content}

指令:${f}`}):v.push({role:"user",content:`指令:${f}`});try{await ph(s,i,m,a,v,we,ze=>{t(7,g=ze),k&&t(9,k.scrollTop=k.scrollHeight,k)})}finally{t(8,p=!1)}}function w(v){v.key==="Enter"?_():v.key==="Escape"&&console.debug("ai指令取消")}Ba(()=>{u.focus()});function y(v){k=v,t(9,k)}function S(v){f=v,t(3,f)}function P(v){u=v,t(4,u)}function C(v){m=v,t(5,m)}function T(v){h=v,t(2,h)}function I(v){f=v,t(3,f)}function N(v){o=v,t(0,o)}return n.$$set=v=>{"openai"in v&&t(13,s=v.openai),"claude"in v&&t(14,i=v.claude),"settingStorage"in v&&t(1,a=v.settingStorage),"promptStorage"in v&&t(0,o=v.promptStorage),"selectedText"in v&&t(15,l=v.selectedText),"pageContent"in v&&t(16,c=v.pageContent)},n.$$.update=()=>{n.$$.dirty&6&&t(10,r=a.getValue("isShowPrompts")&&!h)},[o,a,h,f,u,m,d,g,p,k,r,_,w,s,i,l,c,y,S,P,C,T,I,N]}class vh extends he{constructor(e){super(),de(this,e,xh,Ch,fe,{openai:13,claude:14,settingStorage:1,promptStorage:0,selectedText:15,pageContent:16})}}function wa(n,e,t){const r=n.slice();return r[6]=e[t],r}function Sa(n,e,t){const r=n.slice();return r[9]=e[t],r}function Ea(n){let e,t,r,s,i;return{c(){e=R("div"),t=R("span"),t.textContent=`${n[9].title}`,r=O(),s=R("span"),s.textContent=`${n[9].time}`,i=O(),A(s,"class","time svelte-14zbzx8"),A(e,"class","history-item svelte-14zbzx8")},m(a,o){q(a,e,o),b(e,t),b(e,r),b(e,s),b(e,i)},p:Z,d(a){a&&U(e)}}}function Aa(n){let e,t=n[6].text+"",r,s,i;return{c(){e=R("div"),r=le(t),s=O(),A(e,"class",i="message "+(n[6].isUser?"user":"ai")+" svelte-14zbzx8")},m(a,o){q(a,e,o),b(e,r),b(e,s)},p(a,o){o&1&&t!==(t=a[6].text+"")&&Ie(r,t),o&1&&i!==(i="message "+(a[6].isUser?"user":"ai")+" svelte-14zbzx8")&&A(e,"class",i)},d(a){a&&U(e)}}}function Oh(n){let e,t,r,s,i,a,o,l,c,f,u,h,m,d,g,p=xe(n[2]),k=[];for(let y=0;y<p.length;y+=1)k[y]=Ea(Sa(n,p,y));let _=xe(n[0]),w=[];for(let y=0;y<_.length;y+=1)w[y]=Aa(wa(n,_,y));return{c(){e=R("div"),t=R("div"),r=R("div"),r.innerHTML='<h2 class="svelte-14zbzx8">思源AI</h2>',s=O(),i=R("div");for(let y=0;y<k.length;y+=1)k[y].c();a=O(),o=R("div"),l=R("div");for(let y=0;y<w.length;y+=1)w[y].c();c=O(),f=R("div"),f.innerHTML='<button class="svelte-14zbzx8">设置</button> <button class="svelte-14zbzx8">用户</button> <button class="svelte-14zbzx8">主题</button> <button class="svelte-14zbzx8">搜索</button> <button class="svelte-14zbzx8">表情</button> <button class="svelte-14zbzx8">文件</button> <button class="svelte-14zbzx8">图片</button> <button class="svelte-14zbzx8">应用</button> <button class="svelte-14zbzx8">卡片</button>',u=O(),h=R("div"),m=R("textarea"),A(r,"class","history-header svelte-14zbzx8"),A(i,"class","history-list svelte-14zbzx8"),A(t,"class","history-panel svelte-14zbzx8"),A(l,"class","messages-container svelte-14zbzx8"),A(f,"class","toolbar svelte-14zbzx8"),A(m,"placeholder","Enter 发送，Shift + Enter 换行，/触发补全，:触发命令"),A(m,"class","svelte-14zbzx8"),A(h,"class","input-container svelte-14zbzx8"),A(o,"class","chat-panel svelte-14zbzx8"),A(e,"class","chat-container svelte-14zbzx8")},m(y,S){q(y,e,S),b(e,t),b(t,r),b(t,s),b(t,i);for(let P=0;P<k.length;P+=1)k[P]&&k[P].m(i,null);b(e,a),b(e,o),b(o,l);for(let P=0;P<w.length;P+=1)w[P]&&w[P].m(l,null);b(o,c),b(o,f),b(o,u),b(o,h),b(h,m),_e(m,n[1]),d||(g=[H(m,"input",n[4]),H(m,"keydown",n[5])],d=!0)},p(y,[S]){if(S&4){p=xe(y[2]);let P;for(P=0;P<p.length;P+=1){const C=Sa(y,p,P);k[P]?k[P].p(C,S):(k[P]=Ea(C),k[P].c(),k[P].m(i,null))}for(;P<k.length;P+=1)k[P].d(1);k.length=p.length}if(S&1){_=xe(y[0]);let P;for(P=0;P<_.length;P+=1){const C=wa(y,_,P);w[P]?w[P].p(C,S):(w[P]=Aa(C),w[P].c(),w[P].m(l,null))}for(;P<w.length;P+=1)w[P].d(1);w.length=_.length}S&2&&_e(m,y[1])},i:Z,o:Z,d(y){y&&U(e),Ln(k,y),Ln(w,y),d=!1,ae(g)}}}function Th(n,e,t){let r=[{id:1,title:"新的聊天",messages:[],time:"2025/1/22 17:06:16"},{id:2,title:"新的聊天",messages:[],time:"2025/1/22 17:05:59"},{id:1,title:"新的聊天",messages:[],time:"2025/1/22 17:06:16"},{id:2,title:"新的聊天",messages:[],time:"2025/1/22 17:05:59"},{id:1,title:"新的聊天",messages:[],time:"2025/1/22 17:06:16"},{id:2,title:"新的聊天",messages:[],time:"2025/1/22 17:05:59"},{id:1,title:"新的聊天",messages:[],time:"2025/1/22 17:06:16"},{id:2,title:"新的聊天",messages:[],time:"2025/1/22 17:05:59"},{id:1,title:"新的聊天",messages:[],time:"2025/1/22 17:06:16"},{id:2,title:"新的聊天",messages:[],time:"2025/1/22 17:05:59"},{id:1,title:"新的聊天",messages:[],time:"2025/1/22 17:06:16"},{id:2,title:"新的聊天",messages:[],time:"2025/1/22 17:05:59"}],s=[],i="";function a(){i.trim()&&(t(0,s=[...s,{text:i,isUser:!0}]),t(1,i=""))}function o(){i=this.value,t(1,i)}return[s,i,r,a,o,c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),a())}]}class Mh extends he{constructor(e){super(),de(this,e,Th,Oh,fe,{})}}function Ih(n,e,t,r){const s=new Ze.Dialog({title:"",content:'<div id="ai-instruction""></div>',width:"40%",hideCloseIcon:!0}),i=ch(),a=uh();n.getValue("apiKey").trim().length<=0&&Ca("请先设置API Key"),new vh({target:s.element.querySelector("#ai-instruction"),props:{openai:e,claude:t,settingStorage:n,promptStorage:r,selectedText:i,pageContent:a}})}function Nh(n,e,t,r){const s=new Ze.Dialog({title:"",content:'<div id="ai-chat" style="height: 100%"></div>',width:"60%",height:"70%",hideCloseIcon:!0});new Mh({target:s.element.querySelector("#ai-chat"),props:{openai:e,claude:t,settingStorage:n,promptStorage:r}})}function Fh(n){let e,t,r,s,i,a,o,l,c,f,u,h,m,d,g,p,k,_,w,y,S,P,C;return{c(){e=R("div"),t=R("h2"),t.textContent="token",r=O(),s=R("p"),s.textContent=`token
        是模型用来表示自然语言文本的基本单位，可以直观的理解为“字”或“词”；通常 1
        个中文词语、1 个英文单词、1 个数字或 1 个符号计为 1 个 token。`,i=O(),a=R("h2"),a.textContent="Temperature 设置",o=O(),l=R("p"),l.innerHTML=`​<span data-type="code">temperature</span>​ 参数默认为
        1.0。建议您根据如下表格，按使用场景设置
        <span data-type="code">temperature</span>​。`,c=O(),f=R("table"),f.innerHTML="<thead><tr><th>场景</th> <th>温度</th></tr></thead> <tbody><tr><td>代码生成/数学解题</td> <td>0.0</td></tr> <tr><td>数据抽取/分析</td> <td>1.0</td></tr> <tr><td>通用对话</td> <td>1.3</td></tr> <tr><td>翻译</td> <td>1.3</td></tr> <tr><td>创意类写作/诗歌创作</td> <td>1.5</td></tr></tbody>",u=O(),h=R("h2"),h.textContent="model",m=O(),d=R("p"),d.textContent="扣减费用 = token 消耗量 × 模型单价，对应的费用将直接余额中进行扣减。",g=O(),p=R("table"),p.innerHTML='<thead><tr><th>模型</th> <th>上下文长度</th> <th>最大输出长度</th> <th>输入价格<br/></th> <th>输出价格</th></tr></thead> <tbody><tr><td><span data-type="strong">deepseek-chat</span></td> <td>64K</td> <td>8K</td> <td>1元/百万tokens</td> <td>2元/百万tokens</td></tr> <tr><td>qwen-max</td> <td>32,768</td> <td>8,192</td> <td>20元/百万tokens</td> <td>60元/百万tokens</td></tr> <tr><td>qwen-plus</td> <td>129,024</td> <td>8,192</td> <td>0.8元/百万tokens</td> <td>2元/百万tokens</td></tr> <tr><td>qwen-turbo</td> <td>1,000,000</td> <td>8,192</td> <td>0.3元/百万tokens</td> <td>0.6元/百万tokens</td></tr> <tr><td>qwen-long</td> <td>10,000,000</td> <td>6,000</td> <td>0.25元/百万tokens</td> <td>1元/百万tokens</td></tr> <tr><td><span data-type="s">gpt-3.5-turbo</span></td> <td></td> <td></td> <td><span data-type="s">6元/百万tokens</span></td> <td><span data-type="s">18元/百万tokens</span></td></tr> <tr><td>gpt-4o-mini</td> <td></td> <td></td> <td>1.8元/百万tokens</td> <td>7.2元/百万tokens</td></tr> <tr><td>gpt-4o</td> <td></td> <td></td> <td>30元/百万tokens</td> <td>120元/百万tokens</td></tr> <tr><td><span data-type="strong text" style="color: var(--b3-font-color8);">gpt-4-turbo</span></td> <td></td> <td></td> <td>120元/百万tokens</td> <td>360元/百万tokens</td></tr> <tr><td>claude-3-5-haiku</td> <td></td> <td></td> <td>12元/百万tokens</td> <td>60元/百万tokens</td></tr> <tr><td>claude-3-5-sonnet</td> <td></td> <td></td> <td>36元/百万tokens</td> <td>180元/百万tokens</td></tr> <tr><td><span data-type="strong text" style="color: var(--b3-font-color8);">claude-3-opus</span></td> <td></td> <td></td> <td>180元/百万tokens</td> <td>900元/百万tokens</td></tr> <tr><td>gemini-1.5-flash</td> <td></td> <td></td> <td>0.896元/百万tokens</td> <td>3.6元/百万tokens</td></tr> <tr><td>gemini-1.5-pro</td> <td></td> <td></td> <td>15元/百万tokens</td> <td>60元/百万tokens</td></tr></tbody>',k=O(),_=R("h3"),_.textContent="排行榜",w=O(),y=R("p"),y.innerHTML='<a href="https://www.datalearner.com/ai-models/leaderboard/datalearner-llm-leaderboard">大模型综合能力排行榜</a>',S=O(),P=R("p"),P.innerHTML='<a href="https://www.datalearner.com/ai-models/leaderboard/datalearner-llm-coding-leaderboard#google_vignette">大模型编程能力排行榜</a>',A(e,"class",C="b3-typography "+n[0]),x(e,"margin","10px auto"),x(e,"max-height","80vh"),x(e,"overflow-y","auto"),x(e,"width","95%"),x(e,"max-width","1200px")},m(T,I){q(T,e,I),b(e,t),b(e,r),b(e,s),b(e,i),b(e,a),b(e,o),b(e,l),b(e,c),b(e,f),b(e,u),b(e,h),b(e,m),b(e,d),b(e,g),b(e,p),b(e,k),b(e,_),b(e,w),b(e,y),b(e,S),b(e,P)},p(T,[I]){I&1&&C!==(C="b3-typography "+T[0])&&A(e,"class",C)},i:Z,o:Z,d(T){T&&U(e)}}}function Bh(n,e,t){let r,{display:s=!0}=e;return n.$$set=i=>{"display"in i&&t(1,s=i.display)},n.$$.update=()=>{n.$$.dirty&2&&t(0,r=s?"":"fn__none")},[r,s]}let Lh=class extends he{constructor(e){super(),de(this,e,Bh,Fh,fe,{display:1})}};function Dh(n){let e,t,r,s,i,a,o,l,c,f,u,h,m,d,g,p,k,_,w,y,S,P,C,T,I,N,v,we,ze,ct,It,_r,oi,yr,li,br,ci,Qe,ui,hn;return{c(){e=R("div"),t=R("h1"),t.textContent="功能介绍",r=O(),s=R("h2"),s.textContent="指令模式",i=O(),a=R("p"),a.textContent="快捷键：option + command + k",o=O(),l=R("div"),l.innerHTML='<img src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/yyy.jpg" alt=""/>',c=O(),f=R("h3"),f.textContent="设置超参数",u=O(),h=R("div"),h.innerHTML='<img src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/xx.jpg" alt=""/>',m=O(),d=R("h3"),d.textContent="选择模型",g=O(),p=R("div"),p.innerHTML='<img src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/WechatIMG252.jpg" alt=""/>',k=O(),_=R("h3"),_.textContent="无中生有",w=O(),y=R("p"),y.textContent="当前文档中没有写入任何内容，直接通过指令让大模型帮助生成内容。",S=O(),P=R("div"),P.innerHTML=`<video controls="" src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/%E6%97%A0%E4%B8%AD%E7%94%9F%E6%9C%89.mp4" data-src=""><track kind="captions" label="中文字幕" src="" default=""/>
            不支持视频播放。</video>`,C=O(),T=R("h3"),T.textContent="修改润色",I=O(),N=R("div"),N.innerHTML=`<video controls="" src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/%E6%80%BB%E7%BB%93%E6%96%87%E6%A1%A3.mp4" data-src=""><track kind="captions" label="中文字幕" src="" default=""/>
            不支持视频播放。</video>`,v=O(),we=R("h3"),we.textContent="扩写",ze=O(),ct=R("div"),ct.innerHTML=`<video controls="" src="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/%E6%89%A9%E5%86%99.mp4" data-src=""><track kind="captions" label="中文字幕" src="" default=""/>
            不支持视频播放。</video>`,It=O(),_r=R("h2"),_r.textContent="聊天模式",oi=O(),yr=R("p"),yr.textContent="开发中...",li=O(),br=R("h2"),br.textContent="来提意见",ci=O(),Qe=R("img"),A(a,"id","20250116161508-2ifhw0n"),A(l,"class","iframe"),A(h,"class","iframe"),A(p,"class","iframe"),A(P,"class","iframe"),A(N,"class","iframe"),A(ct,"class","iframe"),Kl(Qe.src,ui="https://pub-a4fc15e05e5b45ae93e81825f01bfb69.r2.dev/file-repository/files/%E5%BD%92%E6%A1%A3_1737019531739/WechatIMG6765.jpg")||A(Qe,"src",ui),A(Qe,"alt",""),x(Qe,"width","50%"),x(Qe,"height","auto"),A(e,"class",hn="b3-typography "+n[0]),x(e,"max-width","800px"),x(e,"margin","0 auto")},m(Nt,wr){q(Nt,e,wr),b(e,t),b(e,r),b(e,s),b(e,i),b(e,a),b(e,o),b(e,l),b(e,c),b(e,f),b(e,u),b(e,h),b(e,m),b(e,d),b(e,g),b(e,p),b(e,k),b(e,_),b(e,w),b(e,y),b(e,S),b(e,P),b(e,C),b(e,T),b(e,I),b(e,N),b(e,v),b(e,we),b(e,ze),b(e,ct),b(e,It),b(e,_r),b(e,oi),b(e,yr),b(e,li),b(e,br),b(e,ci),b(e,Qe)},p(Nt,[wr]){wr&1&&hn!==(hn="b3-typography "+Nt[0])&&A(e,"class",hn)},i:Z,o:Z,d(Nt){Nt&&U(e)}}}function $h(n,e,t){let r,{display:s=!0}=e;return n.$$set=i=>{"display"in i&&t(1,s=i.display)},n.$$.update=()=>{n.$$.dirty&2&&t(0,r=s?"":"fn__none")},[r,s]}let Uh=class extends he{constructor(e){super(),de(this,e,$h,Dh,fe,{display:1})}};function ka(n,e,t){const r=n.slice();return r[8]=e[t],r}function Pa(n){let e,t,r,s,i;function a(){return n[4](n[8])}return{c(){e=R("li"),t=R("span"),t.textContent=`${n[8]}`,r=O(),A(t,"class","b3-list-item__text"),A(e,"data-name","editor"),A(e,"class","b3-list-item"),K(e,"b3-list-item--focus",n[8]===n[2])},m(o,l){q(o,e,l),b(e,t),b(e,r),s||(i=[H(e,"click",a),H(e,"keydown",qh)],s=!0)},p(o,l){n=o,l&12&&K(e,"b3-list-item--focus",n[8]===n[2])},d(o){o&&U(e),s=!1,ae(i)}}}function jh(n){let e,t,r,s,i,a,o,l,c,f,u,h,m,d,g,p,k,_,w=xe(n[3]),y=[];for(let S=0;S<w.length;S+=1)y[S]=Pa(ka(n,w,S));return i=new Hl({props:{group:n[3][0],settingStorage:n[0],display:n[2]===n[3][0]}}),i.$on("changed",n[5]),o=new Lh({props:{display:n[2]===n[3][2]}}),c=new Uh({props:{display:n[2]===n[3][3]}}),h=new Yn({props:{label:"取消",text:!0,outline:!0}}),h.$on("click",n[6]),p=new Yn({props:{label:"确认",text:!1,outline:!1}}),p.$on("click",n[7]),{c(){e=R("div"),t=R("ul");for(let S=0;S<y.length;S+=1)y[S].c();r=O(),s=R("div"),Y(i.$$.fragment),a=O(),Y(o.$$.fragment),l=O(),Y(c.$$.fragment),f=O(),u=R("div"),Y(h.$$.fragment),m=O(),d=R("div"),g=O(),Y(p.$$.fragment),A(t,"class","b3-tab-bar b3-list b3-list--background"),A(d,"class","fn__space"),A(u,"class",k="b3-dialog__action "+(n[2]==n[3][0]?"":"fn__none")),A(s,"class","config__tab-wrap"),A(e,"class","fn__flex-1 fn__flex config__panel")},m(S,P){q(S,e,P),b(e,t);for(let C=0;C<y.length;C+=1)y[C]&&y[C].m(t,null);b(e,r),b(e,s),G(i,s,null),b(s,a),G(o,s,null),b(s,l),G(c,s,null),b(s,f),b(s,u),G(h,u,null),b(u,m),b(u,d),b(u,g),G(p,u,null),_=!0},p(S,[P]){if(P&12){w=xe(S[3]);let N;for(N=0;N<w.length;N+=1){const v=ka(S,w,N);y[N]?y[N].p(v,P):(y[N]=Pa(v),y[N].c(),y[N].m(t,null))}for(;N<y.length;N+=1)y[N].d(1);y.length=w.length}const C={};P&1&&(C.settingStorage=S[0]),P&4&&(C.display=S[2]===S[3][0]),i.$set(C);const T={};P&4&&(T.display=S[2]===S[3][2]),o.$set(T);const I={};P&4&&(I.display=S[2]===S[3][3]),c.$set(I),(!_||P&4&&k!==(k="b3-dialog__action "+(S[2]==S[3][0]?"":"fn__none")))&&A(u,"class",k)},i(S){_||(F(i.$$.fragment,S),F(o.$$.fragment,S),F(c.$$.fragment,S),F(h.$$.fragment,S),F(p.$$.fragment,S),_=!0)},o(S){L(i.$$.fragment,S),L(o.$$.fragment,S),L(c.$$.fragment,S),L(h.$$.fragment,S),L(p.$$.fragment,S),_=!1},d(S){S&&U(e),Ln(y,S),Q(i),Q(o),Q(c),Q(h),Q(p)}}}const qh=()=>{};function Hh(n,e,t){let r=["🌈 设置","💬 公告","✨ 功能"],s=r[0],{settingStorage:i}=e,{dialog:a}=e;const o=u=>{t(2,s=u)},l=({detail:u})=>{i.setValue(u.key,u.value)},c=()=>{i.load(),a.destroy()},f=()=>{i.save(),a.destroy()};return n.$$set=u=>{"settingStorage"in u&&t(0,i=u.settingStorage),"dialog"in u&&t(1,a=u.dialog)},[i,a,s,r,o,l,c,f]}class zh extends he{constructor(e){super(),de(this,e,Hh,jh,fe,{settingStorage:0,dialog:1})}}const Wh=`<symbol id="iconFace" viewBox="0 0 32 32">
<path d="M13.667 17.333c0 0.92-0.747 1.667-1.667 1.667s-1.667-0.747-1.667-1.667 0.747-1.667 1.667-1.667 1.667 0.747 1.667 1.667zM20 15.667c-0.92 0-1.667 0.747-1.667 1.667s0.747 1.667 1.667 1.667 1.667-0.747 1.667-1.667-0.747-1.667-1.667-1.667zM29.333 16c0 7.36-5.973 13.333-13.333 13.333s-13.333-5.973-13.333-13.333 5.973-13.333 13.333-13.333 13.333 5.973 13.333 13.333zM14.213 5.493c1.867 3.093 5.253 5.173 9.12 5.173 0.613 0 1.213-0.067 1.787-0.16-1.867-3.093-5.253-5.173-9.12-5.173-0.613 0-1.213 0.067-1.787 0.16zM5.893 12.627c2.28-1.293 4.040-3.4 4.88-5.92-2.28 1.293-4.040 3.4-4.88 5.92zM26.667 16c0-1.040-0.16-2.040-0.44-2.987-0.933 0.2-1.893 0.32-2.893 0.32-4.173 0-7.893-1.92-10.347-4.92-1.4 3.413-4.187 6.093-7.653 7.4 0.013 0.053 0 0.12 0 0.187 0 5.88 4.787 10.667 10.667 10.667s10.667-4.787 10.667-10.667z"></path>
</symbol>`,Vh=`<symbol id="iconSaving" viewBox="0 0 32 32">
<path d="M20 13.333c0-0.733 0.6-1.333 1.333-1.333s1.333 0.6 1.333 1.333c0 0.733-0.6 1.333-1.333 1.333s-1.333-0.6-1.333-1.333zM10.667 12h6.667v-2.667h-6.667v2.667zM29.333 10v9.293l-3.76 1.253-2.24 7.453h-7.333v-2.667h-2.667v2.667h-7.333c0 0-3.333-11.28-3.333-15.333s3.28-7.333 7.333-7.333h6.667c1.213-1.613 3.147-2.667 5.333-2.667 1.107 0 2 0.893 2 2 0 0.28-0.053 0.533-0.16 0.773-0.187 0.453-0.347 0.973-0.427 1.533l3.027 3.027h2.893zM26.667 12.667h-1.333l-4.667-4.667c0-0.867 0.12-1.72 0.347-2.547-1.293 0.333-2.347 1.293-2.787 2.547h-8.227c-2.573 0-4.667 2.093-4.667 4.667 0 2.507 1.627 8.867 2.68 12.667h2.653v-2.667h8v2.667h2.68l2.067-6.867 3.253-1.093v-4.707z"></path>
</symbol>`;class Jh extends Ze.Plugin{constructor(t){super(t);Se(this,"_isMobile");Se(this,"_settingStorage");Se(this,"_promptStorage");Se(this,"_openai");Se(this,"_claude");this._settingStorage=new rf(this,us),this._promptStorage=new nf(this,fs),this._isMobile=Ze.getFrontend()==="mobile"||Ze.getFrontend()==="browser-mobile"}async onload(){console.log("onload...."),this._settingStorage.load().then(()=>{const t=this._settingStorage.getValue("apiKey");this._openai=new j({baseURL:`${Vi}/v1`,apiKey:t,dangerouslyAllowBrowser:!0}),this._claude=new V({baseURL:`${Vi}/claude`,apiKey:t,dangerouslyAllowBrowser:!0})}),this._promptStorage.load(),this.addIcons(Wh),this.addIcons(Vh),this.addCommand({langKey:"Instruction",hotkey:"⌥⌘K",callback:()=>Ih(this._settingStorage,this._openai,this._claude,this._promptStorage)}),this.addCommand({langKey:"Chat",hotkey:"⌥⌘L",callback:()=>Nh(this._settingStorage,this._openai,this._claude,this._promptStorage)}),console.log("onload....end")}onLayoutReady(){}uninstall(){this.removeData(us),this.removeData(fs),Ca("数据已清除，思源AI插件卸载成功！")}openSetting(){if(!this._settingStorage)return;if(this._isMobile){Ra("请在桌面端使用");return}let t=new Ze.Dialog({title:"思源AI设置",width:"70%",height:"60%",content:'<div class="b3-dialog__content" id="AISettingPanel" ></div>'});new zh({target:t.element.querySelector("#AISettingPanel"),props:{settingStorage:this._settingStorage,dialog:t}})}}module.exports=Jh;
